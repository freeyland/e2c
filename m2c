#!/bin/bash

declare -r m2c_version="0.2.18"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner &
    m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]; then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]; then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                m2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && m2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $(((res_count + error_count)))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

m2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
    darwin | linux)
        m2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
        m2c_result 1 1
        pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=m2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/e2c
        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
    darwin)
        if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$m2c_global_dir"/mutagen/
            chmod 0755 "$m2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]; then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]; then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
        darwin)
            sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                test=1
            fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]; then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]; then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Emma2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]; then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]; then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
    global)
        shift
        m2c_log="$m2c_global_dir"/log
        m2c_global $@
        ;;
    init)
        shift
        m2c_init $@
        ;;
    sign)
        shift
        m2c_sign $@
        ;;
    --version)
        echo -n "$m2c_version"
        ;;
    --help)
        m2c_help
        ;;
    *)
        case "$1" in
        up)
            m2c_local_project_check_dir
            m2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            m2c_local_project_check
            m2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            m2c_local_active_project_check

            m2c_res=$1
            shift

            if [[ "$m2c_res" == "m" ]]; then
                m2c_res="magento"
            elif [[ "$m2c_res" == "mr" ]]; then
                m2c_res="magerun"
            fi

            [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                exit 1
            else
                m2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ʝ] ]w۸(x^GQV:vnm;>qh;&);gݧ;0wܵܵa|yYk~%SU H)vX
B qkP4n*}6Z)lw;nnFn~fF*ǡ;tCo d;>.#ڑ|N?Fvݾx~6X;F?_k;fgm???-*'(8Q^GZ{?_@N[kχR{Kcp|ɇ:si ט{'_؉~Ѹx ˚3k_fuu?`ʆsǏ`,t!Q0:#`AVco>f'n{	Enx;1O0Ϗb.;rGy1v} K`<vzoWUV(e3v%
7m/ـX 8e
=6't$cPfD/v0g8\#pm(23D3H4;؍h#] uVoxn_|q0b:[]k܏;y3~^	<ogT}_s+m̅rYިB!Bwk,3t:mRc"ҎQ+x
=p;23&>Gu 2L0tAWEE.$ e/ݹ'nZm;bwnmߏx>ӟ#':Tc-}F8<GF@5i,U7xhzb!nG0S,q4b|~t^qy0x@ c>܏^̚cR!bgN{!NȶjnUYc7lnwD7\'heVu(jUۥۦ-ۤ*;}(!..v	dw1-"0-"0- kwymjl0kfm&m&y1	5JYVpG6[OT#Dl0C_]Zk
-f꒒hۮVe2Vك>:
ABVadݶ=ш5p9,͸.Ja&Lĺd373$Kg|Jə)% (Ƭ	bHժLA^pȑKv/[[[8\fO3yEF3	)oMrvG5<J3t?N0fؾ7q{ky,wx&2X-[1VG?#<RU+kobA+]	O"&ѫ±>y0O|d+7>{|vfk}WW՚߅ &=m`ldΜ753(RSc/&Y
!1xyrUk[ʿ|{XnZҰ6/-z_xڼR2վ=k_Zr\3rgmRV4%fN:fsN7N㘾,_üN	Hzw%j@*3E{O4M@) 7"L&A 83WMpt8qEkS8ATzMF88|_Ә ڡ;-jlJG4[K4bsogko{sw^׼$dAc BHj+/mo0X9ѪHZQw^cB!n1ѬI͝W6_n_}A%j)PmNeыKߚd&p|2O`K}>Cj	#~To" ɋi"o?9zxŧ0@I.%^z̢uXɂ} .huӃ6ʤ(/9DR`{uU-
[Y׬Yc_.AjLP$*߭aBE2}8ݏ1J7p%-GϸJI-͘8jt!BV8oF|c@X%g}cۯ_	uJoI īv^, o~|SP*	=M|, Ћ
@n?ٛ|+ ğ7w_8ȶ*3
@irsfhOE-*F /`%벨0 5$kDԔM/6ŒaĬ)s&=*:p P^Mh# :9.Z0NPo d:AN} H(Oߎ.X8}w3 Rψ*щ3 3bn㟸CYԾXaV3#
n:uG@JgxtIMM$Tl1w^}-
̄Q[X4/Ē5dlK-e Y:4	LA;,'wBV6rNG  Kɜޟ^ޭ2kMOw0<~so[Ӓ@7dt<4|xfU5|H!mb|x8E!(Akv`*u@pY R`0%H5Ʈ_Li;՛,}/!ǹ19)F݄`j>n(}'Spd@|,b-:{7%šlΫw>y?:xT!k3-a-
,.a--S<,sH>p1bKYlb&b2CgKwzݣzGg+PzAB֫/MVե)AW+4-xkx̈G8ޱ|=F D`Ǩ^cA'#_d-ȂoZ!+vFS&g+|#{iwK_=_l@>Ug%3F*}Ϫ&4LD5eHV:ҞiqTAשׁ	nlBLOF@|	9tKR"^tNW Y-agNx2%҃;fS_,P,pWoeYx<	HXOXb"aJO@^>9o+V?C 1g0 f+
췈my'gxޫDJ9^>HkN W0Ɠخ$GI4SK.APz@,$Y8P@5*5 !ҏV#s	?"*PQ!!k\W'޸Z/؉U@`䝲Ү`*<,ɮIc	T0"\)):NQ6T:|KL.0iCu>+Z6n$xWSiR;/ahgvSy'eJݹ$,.0=Cb(v#PK>HG.?گSJ2:t-+MxE|/@7W@˙P$̺Dhi
nJV
3 ihbPSW8)D$$QQ&&?oFF_`=ciT_7n!R~&.}/{_\<uMIIۮΪIfh8S,	eWMTͥ115MUYl rrE'FBp-q\(6fd겜ŤQ,!7VvYؠXDя{X܏|Zffߤe;giIf_¹XL]^wR{iԶ5wɤf=܄4TT>f@IjwABr`9zEj1uWW~7zNX֥v%-ZY$_&_kPoǬ̝>njRtSdAK[`fA_;G?|d<bhAS(іrrĸcXjRaw4W/j-s(hz?KKjrTA
`'V=c_^lbOƎml-e\*oE27o9WuH01
i`	/,s. -kH]z:;U<(:-GVl{~:)O}&q~1!9E0O虏hsc~;s8Jn$(EfBbΞ'2m[A:hà2~ޭ,>̪a	x+K^E'	I yFC2<Y.FU^+2Rmn3qr8ڨl7.̮ziNǊ^0i:NlBҹ~t7`(v]sA]
1'HAd`bN}(2-I5\#vp:JsYxŹ'k$ag':`_C:֊;;#װH:b]G-9Sj?T;s1ci5?0F7@igh:K?r	ܡ		i#\o
9Yp6{|pY4ƧN͎k)"Mfl&r0〉]_QYDM'v 
K5!7KrAC:r,G`}/QCTLv7Ц#M1I/`Hzdqt2NJ3v%;HY]iy;J%[ܨ#ά'g-jXySxBkn-f[:ΒMFq8թ"w:;.^6i0?[|Mi@Z̺e9<+>)PF		^%9У{#I֊ 00_T"~o)YTL#(
|?c2Wѳw#":I&s<\8.256.a(LE{y!@_R| Jq+>ӒHǹ FWIȀZֆʷqZNq^*=\c==-jIbK)xxʔ<b%'5!YRdfnCsYR>>~	mʗ?H@\^**HE|/[Hb?z'#3;oN' a>^и=]uLRԤ{փ6ZKR$h`RyVuV'IA"1P~3~Rlx<v9zۓz&O]*ʸ9ݺJZCHs!^y\&UUjCKg9#ð>o(Q 6٩s^a%WRxxWA[ 1=`#C*MγO0)&Lˤhf
g?`C75`baEƫ'A	x7Ae"]>hފN1U_9`3R8I7H`:aY7yGG⤗!UG!rA3(}ķ%cC
DLbl H%x;zSKA9#WW)Cd{xiS0uS^J@

\#e{hU%DUEBQXDN:Q9dFL1fITS
2SoWntJ/G:2Kt),|=G AEx}*` +O }(`Lk4`Y➽hbj^Ć5VP@2^(T!ݱBT*P_U2WLZmD//f)v2؉i9B!H*sMc~Hh%.JŵOv.+ETv?OmI~j[*e(m2턮7MctGG4G>6ﺸ/VZEpXkBķX۹ct9<kPh&h
pC{4(GCDFbP-Ҳ"D[0z\ksU|vgG|`h2Bss˪ҕ_:K[~i/M~CJd
Y />MD!oHD!oHf-k:dYA_|"=Ԡa3L&d,׍zm-|$ɷV!$K
^+JJ  4,͢,$KÜeoYDo[~:83iY2|%eJ) lBhi$ҔKY2M;g%QRRA64iG}e+2Ni+GR=}zd^qdѨ_6qWW{UKb'\%Rt}ϯ{$J_@XKgn-=ZAL*p@C*	} YUA2eX
yJ"=lp7CbQbR~xpRѓB>͖OɄ<)zLE>Q>|OO哰H&lFnN$>Ѝ=,/.8JG\T*\%	dͳLeQeE,na4]k,&aO~X >o`$,Oд*LNwK޷/nyZrKJeml+BlNYW9ֿ!jkk1nfs϶$Z m	k"LºߥD)zqhnRu-vЖ̀O3`|+0(tiMۓ̥\sZtܳ>E,!>" kneX#u1ƮBB?MX)dDfG2r-s3>Ed#5(0G&aܜ,Hl3>EG˱̓wI'sqOԓ;|
gp1?	J^kJ4~j)7ڏ)V\yU⪛/,8!F,3	>M;o\+Нϭo#Y\Ix3yz_^uia}yP-^;62z9gnrΎqLx?R&
PMyczqPn"Jk3NK<azm&TnXК-\h0K`VgeϏF,rd^M7ږ0uLC-z<_vTVPQLvɜlcq0
peQZсt9piw}਻ҷk nуn f8&a_|#<.w8N4Sc:QSKh:tٟ3j-MKxE=䨣췔l`ڲ|F%
ހ=[D9g"YD.@YPWe۝:)rEQ+j{+6cqtL
Vz-?[OjΧ/m4W\!ϚJ͚e9l'{xGьmsVeҚ5P0j^NZt`9J֙EkeL5޲jjhֳf1:_133zD1+ZTakb K:?[&|p@|'Pܯ=tje|UH\a;ܖ5_ѬLg\6򠬉;5m[2s\6W)w[FJ3i\(P͖FU۹,ah|_F7$~Nc,ce)N.ˣBx"cjw4=I*ITr.lGRNVG%سܗAr,h_Egz}2="ɶ~HھˋkMɴT?S?US4ׯiTlG՚cNFW?j!?zbk{Pc=fz/SR!D4GO'F;raurGb]qct4S;ɟl^+J
$ILSfY[rDu$KaђQ8EBVe2|7aړB]v?f V.IB
Ec=xxd35XiO/mo~}UT
]J-,1q<Ro63sI3`vY7׎03;{T8nKݬ.~͕_ːW3PEe,uH16z#?W*%^|Q&?\(ٷn\ y/_ B<bVW3w/C7q!uaBCTqTjnݒ=EdlƁ^	, .dӌxywxh>D/CXM<ƈũ;sUWg J~p/B>CZrM\	dw|3aM*t <8y;t'-: d(\B2\	! !@[sGI:(aāis6..,W:btR\?|pMظ}]N6͗QQՅMH,B+P&o,ŉN{茼dI䂌P΂-Γ8Ӆ¯9~/=E(}<[jgeU?V.0:a&Xo:X]s{[<WN2]:=^MN^%*	,`?焖oP~͝Bl3cPiX>xnٖǬhbRl?eʭS-xt_Ԕſ
L們1T$2o.#;$R Iu0m\;2kw<7cM]c.NLQ5Pr=j's~I 	T߆{Zޓх?R]TH{(_E#םfMF&ߌiKK-4ꯈ{-5F_e+*G_'d5&Kd*>NMDzَ&:kka G2N.dRCqce,yk֬Xyj5RڋkM2)}㩚mL:ӣ:E|I:ժʖ7NB[&	ӘY\I2js1l
"3b(QR%:[o 1ru/0D)iJ`!Oy(ExdYdՌ&szJ{̖e:fh?٫*
hd+l|Y~旍$guG3G#Bs6mSoV_,iJ:<;[9-eJ8k'#L|[r$.(7?:*I06ܜaцsӨ7A7iq6PG.sǓ![řǧ a57NoqZK5Y6␙O(3;P22)UgA`gMHH",x
tR/UsRh:Κka5[OqWD7vRg"+xx>Gxh:ZĂj>3	!5qV1.I" 7ta2-&wcfk0"n8B \'<n`yQ
+S,g~O}n*(' ;"48׊|a9;~2u̻M1~UI2i!0'sjS(jp&^Iz[@%MRbd#'%AS(5@=Y[O3`7?eܬAmT/$5'\In<Əb'MX%ė,) wF|$P9ȣBE\)t5ĞOtv5lSGj.|lEe]Ͱ'm{-3U"!cqVWK\t\6LxkfOFE{r̕apJ\XzNp\VGC`;0W݉1_e`A VFfV4$Yi$}\d҇MĵpaF(W:ZV!DHK(>H z(3 )iK>8K^y>c@pTcW"Fh&^wql41~3BER3 Hq+CZ<	s`/yܳZAQb*AP"yq1kM2[H/(DL4rgsd?vDS,2ujdjIV)RJQݥm򪖁UÑHi|KZ4\
KW(k]f8
^>]Rg]:2%$~1tEMCt+5xBX,[e,POYgSȤcf078K&ኚ2TQ-[g >.fSZxbZ7ּj{'ۭ0\(>=kyzvv<2\&ZqGs/ݷKRiQ)?-j>+_ye_F&BnaI#А׬%e00i]<
8)&TȍrnNS4%Χ~Q$ט
'E])Y	;Mr(IOT0xޙVG1WrQls`r!K.g.N}Wl?|g[;l0-]#/fY
ԼyU线x\iZ8Og:M"L$ƣ>d
Snn.?1EETni{sײ\nG]O8HndӮ"V感aBӾj^HY=fbZ4vVxs֕kMua޺Mz7kq޸v)m	z/doDdEK;+5	'6L8i2B(\52r3e"cdͥ3:FRi*?StƁ2JhcNM͆n'
I U0V>\v	tJ]%zwnէM1yK$lwcD/Hdmԥ(4pHV;M&0zo##wǻ<-,_mѸQ,~=&D6|Y8VG m9lS ߬1\MA~})s?7{mY:`rLIQ4oa<;'3VYjgLwV\|e-}z( ]Q/mp6d-d铽W DjY?jTOk$0LԸwiִ5zhjD}-$$=g]\e!!ʦtE;/^mR6enp_رsLuC2m[A\MHlʰ{87ݽ@|'C9(`6_xX !j-|ǔr"$q8YLooNյS,!^Dط	72,Η:7'0RKikL',էreG])<)Y*( 2Pd:{onNPkZߍ eD<~;fKmɩťpppmr9r1n.d5{UF97{Pl_%<? z	j2mQ,ҷg~1h8V&VK9:Gz])j⊗r_6:u<RNw=0bW왾TvG,Խ5<+6^r|(ѭ* ~f0kr'gǼjw}S&a	"dLF6td]Ϗ0k+)7IJ:4Z嗔
gzT[X-]*|ظQTs`Pf3Gէ/ fč.x4;44:ѧx̚?jbվaW˦zN>*@AHJ|K7ZZYYk2KSm2A>۝+;Q]{-ߨYˏqJ;UYMnЮM.(WI6
ג)0ۜ$nQF70Ss"r$-9ޚŞd7DMy5,ܓ,'&d1{3"j-K|gB	sSbbf&zggvýB4ˊ	Q4欸[=<u%QNŋD25L7baF'5E%t+o#ϗ6AB5H97-юB&C:A=W |C7g9o'w-jkݏ}ć
>S?o&%s$:0H|e=w/ݺ6f1Xҏ[pra&hS$v7	`hMoI0W33xcQ6䰛\rBg]H'2&%d#JRs-zzWWy^(9ĔpWn]>J3m4UJ"34zMx)^Ѿ%`8h+>-OyGŘ րU L2[IPbgӽkbW\87KV M?E?/9owgj:ƺ-u5@x8%M'`ս;=r!b'jQ=vЯd\+TgmyM>7M 9I>xte}\!l_>>*@=(|A=bx`Ya0B)S9k~AY$XQMiDC]\4/phrLu{55/0Dy
;FFkPQ.p0 ܶ&,R@',T.suxN澹g[Ѓ<K{<[$N鵗FT /<?l]	YDBK^8]W*n; `(#CρД~c$udX#鋨yVINRq2HbՖ:Lꩶw5"\aLFCXz:g*-JUJEsk R`V\1yd<^шODN?(7|%	2dN3sC %R>R0UFo5݄mѬ/qºX\{w#:˙=P
	 x=$v9q@V@~4q䚷Ȯvkj#w5|/!X6v5Īj,ஆ$%z7Sǈ	h \0^TJblXG?S-'[qV\rtQFlJO3-ymXI/NuB'I%x8Pfjk䞹~gު-9QXF@ed!>ҝbvL/#/ˬ+-qmJyJ' 7ʧQf|+Oq \@Xf4tO0(wF
nE`{73Wf+y`.z~֪vH0=z_xN?^fr'yElC0I|UJ 7=P%U_(tOaX}T׼Xݨ5'UyEutIFo\cZ>~-Q#)y3\,dm-VYRC4Il83HQ.pO5Gyw.3wbdA1v6tMS$2
jA9oOI/ހL{_,!Sqq_Uy)ţw'hW@F&Q52ȱ
:0 fێ\ڞ/K_ wHVNebR%4i*l͞\Xs$rp; mS߇nczUR0Rc'!}q)쎘mwH|'?O'Og">鞏Hs8}p`}t<#w|+u>6O2Lr%	ω`e1;"^?^P */nNPצfm9pJxqLcdW
´-1E7!qiNq3P&ɽ9ЁFarĢ)7WI`3q(&qs"jDމQ<)9zÛL^o}W˼rF!J쨟-G&HQ{Wr6(ȱgGgL]{ѪY\*?i{V*?c'g tTMBf	 "Gϣ-$T	~ sV5^|2']u?9ٲ3CSj#eJCѫ^mMk>3@_k3.4jKZ&lN7)_;CO>\<wZj$
hc\M !I-n0UMYO@~Z$XgiX/HY蠯̂i]:qhoBrDQ٨|BGa63|~ٯo 'R4*߂]wI݉E}Ԧ'yd.)EګFsF
,z̕钭MsI֦= %<WD1mmr`hU0[HOqnsGe9zYgO6!t{}(KmzX(V kX+J謮xA뛿sn⣻ PC1
w06EYʜ?ӷgDa_xW7AE1G}`=_^.fT<Xq{B6^ǣi֙u2JMOEjK#Ֆb#dղ-X ni)$1q1]q/H':ʫݧG\-σmq<$@,"h"1E:o[B%5R0b</T5 7q~cweT A	>RC;I^Ҭl'K̻-Kd^H)u}qfh!>r~|o}
 v,%kUܚ(jYe0Q<kl~C"0_y-9#7>w]a뉃+ov7ke;!͛E|IBXv;[=}eoTbȧ_|7*dU&A,T#k?QΒ('uފ§#oK4x[%;30LM6Oxɐ~%Cjh }yB'~[`1޲D;CȌЙLF߃5qPC("%'LI&$>h8	4wC/v:iSM$wTh#)ny6NaYsp]64=eY%%!rR0'Әkuу6h%d@ŉf/O]gr?p70)?ɾ@׳|/+sϚ?zidP.He9Og8fP剱EGr|^ QnSDX'xyX}?)cAaͪ"V0CKG-0<{Zsu>knm7Ymuo3urC4PH>'rFwV;~3qo5.\ojS-|WkƭaP;JCyЋ&.);umr7ga6&:r	B#aDVу4bC 8q}yJةz%-	<͐WlC5ګ#A{GO@㻛jM@>ܹj?}2GFilRwma&Q
LˊR)Pw(vWȬV~ŌuR_L6	7nhq4cXU"8eU5W_}X3˨2v>Z38̥llj^9&lɝ3h7vpPhJ0z|.ED|<oGj#rCùLhCkoBכ,)LʹŭIסnˋ͗<p|E#lU_nm?~soTDr y7Hy}EHQb#c*h+Mf2"!ݠ$:t8H6^B;^osiР+SǌZth_xWar0`?0)AB'/Q/uL4A+5~)3a$
g k<3:=fm:8rc7zzkOG烴%=49_v&`:I$o9)0ug)0~R)O;jbk $AĽf@'*) C~"Z?.j%#

S7	UΝxpx21	":畻Lbn|`kZ0xJUvZȀ=MLΡ"dW!.t0HsWc ܿեBL=Q@֍3O{,tBC̈z<u٤(~O7gj-jq7O׆Tהr*vǠ܋.p=¯~y=i7׮`<-2w,B#q0<JxH֏͝;867a@4֞TR QjO6+9"?skw'fNfߝ<e_VtNy/cZ6E>lg뚘\L<o&6Zā>nJCNJ<UIS%_F ?_g[,b?]X{X&X^B/Ϥ?ۧf_dw7j}FL{ۻBfͼOw^>HaNxb &Izj۽gIyj/|)_?`M?`o%ʼFt^%_~ϓzo'yM"2$\=;o7_+MOiI'Io~|_[Jݝg;g;{Ha+6˧ɻO}Ɨ?o'gko̔ͦ~j7V.2?ŔܜPz&Cɒy)AueNQ0u"g	A=[KVXRכ|).ew._)o
`o7[O?ڽg_X/wxu<+{;,#jsbsvwsw $}脂"rov_u~|>PDPg@w KG̜ݤd^xaƉ>y}4`&sh>g_d;@]-zDIֽT^r#Ef=&R/r:xQXC/Z!Ȝ<lK2g:Z9@D_x6-H}9;7gn}os7%. j(4g{J%v֭J79~ukltڙVcN9Y;
U]נrv5&v$!{i̔st_n0̲]ke}/)PY!{V7Tzq֚G5NF"}Pf;Ik{:hU[d,i,mœtۆ[\,neѽG:x큻YHso|(ԿF4>E:y3 Wfᕾ.h67i ƤTIA=?|YGoZ/0nN'6^ZyH'WV uOi`=#|v^b/O0iO<E)_=sTQׯ{?tQcFlqjЍGasX)RhTNFO#h2؋Ë$rc#KGl,>GBg0{~MM>#2v?띀>p#~:ӈ0jޑ{ >e P{{l-b:yǀP9rLCO<
8xTf5=uNNctyS=7qa6*)ΔPN8=_|2:Q8m;O-٘y!|/j
FU{@L	Lih_nu`D otXb{X" ǎֲhlJ(:[]mcg=-n-X~{N7[	tVYmY:)lfXX4FƬ(li:'BN[j͵&f-`Z蔂hv˹\;)@lhe Ѻ6G!H!ߪӉcgpJF+&	a.ɝ7ebnm<KY:qZiEcg42	s!:FX/<N(;I;Rވ(%.a{0%d 44tnM|w6NzgYCg25i# L?Zw
# !'pHJN ^VLT<ʚsѧ'So"hN0ڹ H13_88:
BPŭzSzG`^<;#@Ұ:.Q!C..r`N,?dO˓l"G
Enf顾_x`cA-tRͬ_̎D1ݑ2c'u?M	Bzgl0b,VS#=W*9(^¤]jUT
ZwV>9pJ-ڝgٰ_}M4:tZXךfnSՌ<k57Fc<a!30
D6ϫukuN K[X^~Rښj|QT`)"|vJ4v{mG_y	H"v5;vf>ٶWl6X{A:<k#5vlk^kﭮzjۭn˂恮hFjwfcjmثu <[Uev ,%~6l
b* 6֨n% ӵvk^X!N75hp{cvӶZM{6)́26˯FnBQ[SP6vkVJjz{ٴ(6h:^D wg͂vږFawVNgjntF{i A;jn?%݋kׄY6nmVYvs.:Џ]lnb{C汀R9-{s`BukxmtVBZvV,n[а5h0Plc%5mxo_WNѢE?m4֠
l.l5J] ,ZTm
}@+f\A8\'Ġ"㴩?'G'?o7*0/4 fāBFӔ'x/WeiO[F0C#gIl0CR ^81I'5/j^sj
]J;,$V037~>~rp&->dGܒfdDj"4N'u6=c.?mwjoyNRKf<Ufj} iieJVī8 OQyԨ]-reOF3:V(,~SFj'ްÄ֝I|`lܗII=%BWavI<%?#.ƶ>I]yIYnH/.	x%=GI-!h^lAN*/1@ןt^UWNK231alI
:	,l"X1(xg!@/AdHU􀒣N,jٌ&/2I/~VXu|3=/	ߍWz2<w2y~!Y߽c0M"dfƥ2$@=L;8<Fw߽j8GB%K/Sr#$]Lr="y"ҵW0N>c e&s=QP(˺q荳BT+q!wU6W"Gj$#>vdJGQ/}íi9srMs92*YTfVe~
0|QE<jd. Wj,0OH?8.R-c~I1T0^n3W_ҦD]Z8RVG~T
M)qVG,+洕;k$:ɉ>@ۂQn,_Z<U65G?8H,đ
[	00*6]!B3گ7t|+sD%0Yih(i
S,aJYC(>y	oXu	TYϪ?U奚pQ s~D7#hsm##)td_e?%BGQ 	^URnR^#5Eak<*bkU	g/IRGI?sFЉjאz_n F Pѩwb]6ϰ8@p}gq?FF!~^ATUVoRX7	aL}oC"M6E_i'TTV MW=FHfI`FtyMK+Z>"2%HOU1sm~N2V %˞4ffgV(oR)~}{hDO Kt(}L
5?TA%C/0mN"WrT[YI@uM)>pU*E {^]*:e*C$&{FQ\ ľV;bGruE)5xG/G[2L̛$RDՕq%>T\a)$і>%NL+RYI:缔2J/666ї?&?:3O͞ռRE
gQi\1NAGn_(y+Y8P脡s^1ꘙpuKY4,Hd},Qc"}#E36U/S/KYCrjͮw[ c}2?y˱Ny#}EEƪ	\wjŲ9A&}R.!=OJ[$~Í`ٸ7`.-v?Y4"}Wʎ !^]eO助&K"99ŎG3K@ ԉNE9*u"$r%2^S'qn9FYeND<Fs*"̉`h&ʔd6UJD*y#$TI7&Y鋐mTC7h۴i3F΢cp&#h)&[maWrc|vkb%ŵ0(JR3, Q3덷d"bgovKNMtEzsF\`:$TdYa n]F+>aUFqKGH^ps/sׄ\bz(PA3%S͠o@[GݱqUimO5	/]=1P !KDl;mu¬-o(AfS8MT6{I{Uz{&JY^ÃtcS-Oi(vj}~6p4r̼x=gkg	7tev~qW{,`7f"*b@\!4 -fMffd"eOb?vŧ#$HBȅnV?49y:jPa'Ջ00+XzCNV,ӎg>tU[ 2>}yjY{1`DcMR'X;p_4UQ)Iy!?׈h'"Gh'%luVHO1?<5sFW ^km0q} ÀOaF*TT|K4L;xp8slIi$N<[\{,"$
,qwncC7	!W<!Y]4=_Sӌ+ԻmYX|(YOesXlqovIUe)&9#˴9od=`tY`4^yG_#IAM*Rz)c#6dGr4no^
a/Y"bL_QAxB<,g8C!Ľx+LVNxQ{18u`!S߻ cp1@|^l#VCUe6:dLOUi&pѶPdDn)pѴ<B8j'4>#6k`:{+3o!9Zq#Ʃ,:(A_֋"vMZs1swsAx[ Uc|IJaDi(ϓ1%G>d-V`;|XT`EGPrQMic=\ZQiB:m~b3%V`:8U,*y#_g%9#GS	e8[j0J`!,/:|of[ X(#NQ Ԉw6[#˵Nb)-%Y~йx~
MS&mpRMfdٔT :wgPBk%2zA36w*Wc-YAƑF5g%01!M\\E|Aģ.cx
ŖfUe~ۆ(S%&\K)z=t3t08f\C#w!ݩ~(9uG\9O	THĞrr]P
Pp3jdtS=0atIϲ}dPBg!X4%Nw6R.L;ċ sI`+/?Qy7Vknj]m>v, [J<h
K0w,Xx|o(|DgN-?#ctLSsg:嘆H4,|jzLǉ	8&$a ~8Xw\C6U=|D䒉]Ms&{uc&|L	>E?qRt6~QאL;syqM*cs
*h1B:R|q%xDESW*6\,Ge24g4@X?NxBwaFZgPuyV28fq8˚܈,hP7ȗ{?3?4k͵ν;yZi  CW(l14zuB4r"NT<øgtd EA }+{74(,` 	Ĝcܹ[5"~N%BOmYS~qaKkH^( y~D2♸vqHW`S"u:m4)eġJ`#(s1whI3 S|<\܋pRA.䮍!wzR6]gg,fL2$Nk5[-aňD<-/gL'"F *jjY$f.X-j؁fMm_&ht(Ibt۽n>NJ x'J56ipSZ;-
9	IIS?x.$'V̌h*:[<B!C8b}jt+ց1xMeYÔvytaE'p"JJV9dVyg.2[ۭ+HH$kgKwdǿbtkun;;Ow8806ps5W*(KWHAHgIb82/qe{LC4Ã2{~HT0X($ZbQ+CXe<y
Ȕ/>k)Qևh;$@%($A!u8	]>5!7Y.v1!$Cj(u'"b<.N$ x?Cǿ^KqF<%p_onu8+wh1ܡ8[7\\HlЂH]1AhqMI]wnLu}Y"+ )eN:a/F?WZl1]55(vO{1|z4#{kSY2.j_Z	L%@`ZB%^,Bݓl ?km`JZoB
iZ{RO3tۢ2}b@vB SZP|emoeZ3Kw$xoRg%LD:7+ Dkx
sh,Ij#,O7
\Hoۮ|K,(^]w2zDCċ~;XcȺɩ g!^m9^3ZI>=}EMh6[]o@Y:v511:~5n
9a}<a-`8 a+mnԑd15tQ6#)>tT`Q6*v1	@!rA"RwKCdm@J/
8)Wp,Ax!4lPZ!-P ,d/DR2tڏ;@z5n)كA4)gپ4zkoY/w=꘵Zm5K+Xs*#315q&FHj94@EGn&s?83 N 