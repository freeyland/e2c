#!/bin/bash

declare -r m2c_version="0.2.18"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner &
    m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]; then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]; then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                m2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && m2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $(((res_count + error_count)))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

m2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
    darwin | linux)
        m2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
        m2c_result 1 1
        pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=m2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/m2c
        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
    darwin)
        if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$m2c_global_dir"/mutagen/
            chmod 0755 "$m2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]; then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]; then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
        darwin)
            sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                test=1
            fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]; then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/m2c" ]]; then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(m2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]; then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Emma2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]; then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]; then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
    global)
        shift
        m2c_log="$m2c_global_dir"/log
        m2c_global $@
        ;;
    init)
        shift
        m2c_init $@
        ;;
    sign)
        shift
        m2c_sign $@
        ;;
    --version)
        echo -n "$m2c_version"
        ;;
    --help)
        m2c_help
        ;;
    *)
        case "$1" in
        up)
            m2c_local_project_check_dir
            m2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            m2c_local_project_check
            m2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            m2c_local_active_project_check

            m2c_res=$1
            shift

            if [[ "$m2c_res" == "m" ]]; then
                m2c_res="magento"
            elif [[ "$m2c_res" == "mr" ]]; then
                m2c_res="magerun"
            fi

            [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                exit 1
            else
                m2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] r9(8_XMJy答bQTukRI
fheFdEDb;Ogalk__K Uͨ388Q_4n*}6Z)lw;nnFn~f$*G?$d;:GC}N?IvݾxQ6X;Fo?_k;fgmo?;;-.w+0{Qw$A&Z{o$>_@NgZx7ګ5:0;4 0wVNq/>~NkϬյ+}{Σ	Drμ0eXz'XE1s'~\ώi,H'(F,=	Â0IJFg,Aȇ1[	#WYh2x:bȗ+tgkbx+t_|뭻q;Xpk0 <@"r}x!}ż pMwx(	I@~B<Fo(ur<܊ ثSzƛtoM55ouq7oGdi|*
B=zCFI}r0v1&qcFR,] t=^c1^~icFcv^iÄWoݾQ`н1)
/!abR*r~qp
(+~.<uuLZWw6KN*s~eKѡ7<z`<DMC1gwvmvscRn0F,q$,R|^qy0<G #>AʚR}!b^NȶjmUY6|n%iO|/eVu(Uۥۦ-ۤ*{'FPB]%]Qb [E`ZE`Z ;</z6a&M M b
kwv8lRcFRX M2>ԪzZ{9b%-g]?v
md{=o^VX*D9\ɺZ'!k=CksXϛqU5\,uɜx3$Ogc|ZɩPWe	1`1gX7R|*FPr-\^ѴaniB
[Go:pԳ}ͳ4O8S{w_zcj!뽭<}gD˭RC=Б\Eu)J|WЃڪ5J{b`Ń	xiUDK{O'>2E}L;}ŵjBMalRǞs60m20wW9xboiW,s<*GQoy_W|9n9p6/#pye}έ}kɥrʱN58IEZ{Ӕotxq'>95#"9	RƳ|w8%H#mݥ;'ѻ̔=P6B:-nD0UC (3WMxx0ғEk8ATzEFxwf0Aks44N[ֈMI\>i`7K"By0%FfBlv~4{B^N?7Ӂ̡zN}F0kcU=:-&uM8|/D=é,zq[{7dΓ_V#7vSH aDLۯ1р&wV$y1M)|:ݐ["E,Q7u,.fArE(.}j)LMJKw黴jd]Ya+K5k+eȠZME"ȫ
&T$cxɇ*$fs	sX2|lZWI0sr%L{GDfν]Λ	*؀*[>/^>r>aBcqo2 /`p},<_7
?{}iv|?Ȟ?{;Ovg3ߊ(筽?ˌPܜ,Z?SY˶~?M'^?'P(uYpUIWJX^5eSSڦX2b73a!Gy7N/ m|22skbm4C_S$9%Jx^|ˠc @<xy|_1q+ӷsO Q)Qψ*% 3?Y[ͭz_zZّCwr38<* xӐ	sid根2Dj⃃B23!#1,wIzeqVN*+MGN3/;|êТ!꒚sӳ7;{U鯶'[1Ŵd$еC)9!-{y0g=(jo1[v:HG2j>FNow	4J|К=JB} F w[){PL	㌂c_!-s~aǿoL%dބ8 4';aZ[ \<$װ=zCo=~ӫu3rRt[A{PK!3#e/
,.a--Sc,sHҿ1bKdYlb&b2BgObiVlK	YڿV7	[QIl/ ]JHTQڦ0#Ggo2{j'?	TzQ J1k\عCu⚜}ݥ-a_ǯ_sWmǜ1v>N12{VAPӄ6EմYBR)=iY5؄\Cb/ IP7/r`d]ex19]d5	?YȼxBV~^.ۛbه`чz-Ib=aUT"aڣʦ0j|fszW8.w @4d^V4oOh[={˛^/-QM Mgj$ƾ|#SadƩ[QGIߩ%O (d= uL.Dq TC i ^zk;	Ʉ	}MuhА'ْ޺Z/K'@`N[{
iW^PfhWZiZ|,-J
;<@N5Uaߔ)B&m2#^7
|J7m2aLh\UT~
>=(*__
_^dԝMA{+Ki٣T.2
Y`dZtD:r~ÜR51yEG_XhR+u~	_άr]&1f%]]e#hVt]j~V`L|ƘS2A\M!RLD
T8oFJ_`=ciT׫n!RK~".}/y.:T;*MWOCd8tT T%KBLJ\Z.`]ԬIk? W4}lL!!=#γ`!@}V&8|4t1ঞ}߉>."4HqOnJsd6Q/ ś[8W
KY*;=֕s4;̿
2y!()[rU\=p^BPWՃmڜw!؄U˩[470'a#u.Khe~Y|ie8A!W0*}2(CȂ$l9A}ry4w)&NO[^H\+la5窥K7q\"hXܡ6{7#֡'?OjrRwл+^_p֏cٟoaMՑ< as1W[깚cUld6yWsfIΛmDafc4&)-vLȷGH,G#vT1ܠD(?3 )[L^uL%bB>wai?-E,$*([!J1[
a;{P',PVr7hàiHAYwu4& ,=z!߻ $DddnU{њ)BbT{C,/ĉh]g0>eC;'yƤN읹Az29	I)
zӉTew!Lw*X#ĉk7lQdp0Z$kFmdusO*HέE5uO>tFv=vJ|%at0<'?CZw
C&~h
[#ܩ2R9|r-lF/'&<6$4ܧMꃺ@r\d$MO }z q3TE7pˏw?`6ꛌݜA^;D×"7˦rAC:r,Gs`ѷ}p(QcTlf7Ц#MQO`P=2I8x*{N9'%Y,˯4мv;-7ko)ZVԨ nx1hrCY͈8'&U9GS f),@D2mx^ɞٴA"GEŧ0rD:!#PzJ(w Ч*3ur"H4W6Pӗ-3m#aE6bTs=' sqGLn27Z"[cv1G@d*+!30ъC_|hGx<,1JbFԲ6TӲRy)53{Bs8	˥{ZՒĖS3hiyJN kD=ZRճU!Y,O	YKq+~ FD׊bgSd.g/BBmIN[H`?'C3w"^A:|(q=F{~Cs\P&_6!ՏQ@(Hp<)ouou
]u6oOb{ysyfUUVeeX@?Ԭ)8.Z1Lj3r.E7F8;N8,$^~|J<}$8qdAeqy}½)l
M=2i7,yYO=;>XXCpx75(:! ȱZ0[:+gAzMRvPxj!8󃂣Re0z"7<bmfEK\&]Wx*Zkd):"|02QV+<Rx;z=@]xW_+Cd{xYS0usQ^J@
\#d{hU%DUEbQ$XwDN&Q=xFLfISJ2SoWatJ/G:rKl),|=G A%x}*` +}k`eLk4`Y枽lcj_Ė5VPB2^hL!۱FT*P_+Ĉt6r3;]BO4EdŦ@!J?A2BӔĦRcwS9ET6MmwS|RnjƦʴi69kvBכz`???Aw]ܗΪYH`"8Q5![B5(|G4
I8=ڣ!"Tk#1imp-BNXY`P
j=~5*>#>E0]hY9X9eU~/-䗦b!^Zd%YAVOD!oHD!oH@Zd%YAVOt |FߚaRVcnoۚuԷ*RZ
^K  4UfYҰgYe[I5[S}+c\c/F8"GF5$1^)[H#Cc)Q06	s\$JT"sM3F9AzʫLSa+#p5B
=gO+.t"J*{exXmO+wyB}9<%*Y,;{~e#&QZtOp`
vZ;uki"tsV3S=8N R*BgJTɴaI(l@9:	[~,-GG7h?xRl+џ\ȓjT]>Erak7r}"ano g*D({>ڵ
UM$7ϲ=Ŵ,(j9$fw|,̅%Jc2|B|C<CnPq֓o
䢐r-ƕEV5vM5&WbjmQZdm	յSFewinʞ|밄80~]3S
#
]oZ3$.
)Wr;w,OKȨO9/Y밇=u}%mx1>e'PM0O`
:,ۑ(\-
wOcYmX#E~]=%Wb;ah|1^y5N1.IWz
#w<O#.' A+AYƛ؏W#Z1wb<+jQ\MW&C^^XҮ"ڱSܴv̕b~;L~:k;	^yc W]vpYXcT7-n_{J=BKS_R9)\BJߗ{ h{U/MDi-<L\Г]ju8łlB!t>\EjT0cuO'yW7k/2Yݎ$i|S]ZAG%3>O䞏0:㕥FrFӁ[N7W5V7$[qjןo;
Clϳl-λehaajLc/d?|gi-Z{KnSdR&l=^Qrn=h-SYt0IdcY>{A̭	"ל3hAΜh}+6cqtlJ֏z8[Ojg/m4W^ΡڭlgͳPVi?^(Q4grۜUf͡|m4L_Vfc)wVr03-.<ژ;{˪M{j^bTt~6)Y٢X8,^k(}u2[Stwow^W%Xٹ<.gf'f8i-ʪܩoTܒcݰ:M`ǽX4t喞EH>Ӆ^li4_兝[6&W9e|sIm=2&PBjtQ<('2Q (?1vڬy[ZO4вDHU.-̅j?}$.]4S=B9glF*:kݬǓCrG8__L[ZK)3c[A(8M!~*FqR9K98nYd{SI鈫+F`ʟAYgp 5#rg{a%e
!Mt_Is{dlu?_CVw>wt/vKvOG8c"UM*a<IN`o}L!^nUҢSFr,Uq9e=nPô'~U]]s:8Ro7Szò׸Fic?=;xz˲RP^i$gQ<(zO/KA׏d,cȺ0vtIk&_<Mm4kiܽUGׯ;ir- ,TgQ4p R'Zg/϶Z7{{;/Hk_>/Jj 9cD7iua=@TqXj~ݒ=7Edlǁ^
,6dӎxy{xѺy<H^ǰ 8tI]]uO J0|B1CZrM\	w|3aUq:S rBi$^Ob2 B#2'7| jwv1gᾢHފIqqp R>abfu:}v\¸)<SG!FbM/ŊtM8qi&:#/-k\yYc^yA}PicKOg~Js)4jF.0:a&Xo:X]s{[4WN2]:=\mN^#*X*	ؠ⢛;fǠ
Ұ|i[bbKJ)7ZO4M~&[S:R2	L@bD;ȼE}<H~Q4`#w71V
ȭͣ!nYmpq*`Q{?#D
@m|}I}i}/uE% dcN'qӼ7cRRK9Mz+"^fKͿW
JZDqlػcVEه`3qddm#`HΩ>7T1ۻ]ZXYa+K5k+ElZ0`F=vA3M\oJxfsN]r*$teKF5OxkryLT\Z<I j$eN5oTR[Zz.&ЛmVA}B#JDK5>]z]Šơh6dvѾ` jLŴ̓;x7Mbn]Mi/ַlL VPQƗNr񐂤֊bJcFy(kDwfQm$%:MZ$ <ι.ѝ^6sqo;BȷSe{VBGkm87zEpbW\&+ gh߀A1; XE8$z[RM6v8daA,L` |}kⳄ&*TO!T,R*yya|sI6N_3	?wEDxc~^j٥
<;;.#b4#L:^goBHef{jSL&n,pUG%W Vd
p$fШrCBs'SǼ@]W+!n>Wk̵OQsJ.irv%=(	zT=BDzњzY(fjkf!q?,h8bnq6~`9i<i%>T}	yrGAJpǹRj=Zu+tv5lDj.||e]ͰGmw-3[VJVXPα	{DD28LGm.}:BB	&1qQޚ#*q1\f!.sxXfBb9^ʵCy$ap?D51倹Vv~悥yԭܬ8^YH![|pK>v_k^ÎѮtZVf
!%$F~ӥsG$ 3nǴ%SQL=6~)GwP6Ug]#a_c )RpJC6(VR؊bP2sn~E̻2p<x~,ҋ4 ӛI\Ƴ9aCՏpr_BBƎWnTK\pY"*SRTCwiEex^rJbc9 C{*TOW.JQ] Q/x]/.DW]pBy:]&ߡU//=J..`/y9`댖yXj)t
Vt٬w)])CҰE|B3LrZkw,&A\>KzBoë>g-|r
]A鈸Vgi3:N!5j5w4};$3p߰8^grӫa7/#BnaI#В׮%Xe00[i]>J8)&TȍrnNS4%Χ~Q$kX'E_Iڄ~_
9T\d'*wL+ÚK]@\"hҟߴߕ@L;8cƙV~/LwCL˙nֵ="g_Uo+M0ly>.R&}Y(sӶlO.`n[أ+N|Q34g,W1{io"r3+ҳ;sٴèHp9g񴯸7%Ru^tXMݾ51^?\Mesb]lnw5Ze7n]ڤsS^Ye}%Ûf1Ѳy=Yi`Jt fߐ)^'MV%f&XnzMxLA\::sh8/a1c1NWn(4˨&<zh$nXfq*jj-bO3E+ku>[^'gk#rUO|Y=WvǷEz5QɎ`PL#9[Z4Nr0a6a𼮰|uEzVP'exY% ~j9íD('@rWyDAY;gR~nRS'&#t9ߑ8h8+4xzwOfT{sӪYzg=wV\|,}/ ]Q/Mp6d-d铻]hw)2s<?~FSդH98׿a̩q)r:[	=jkqXN:5*;	Q67[/|jf<X_D4Tmt#u_	arF5pAS5z˟>>ׄU.WqL+ BΚINKrfrssr`,-=(ل꼌#¾-<M9gyq\9Ȍ..D
7Y*l~m>+(ȵĵ9e8@)!$mDɥ"1{SB]Ӓn0(CTLچ-qf1'á7Ù7ɕŸq!tWY$tNU?Rlf*FgQSɴGLߞA`	bȢXΚX5^ʑ׹>r7OPWٍ{/<6/#EDA]IQ6"ļd_B>zU`YQfG	lsB#5)f^+;~xK:xG)lhP)q'7%n Bƴ^nCiA(Xv"r_ísyj\R/Lׯ^~IaIOoegԪ꾆u0@%a8lls؁Vե[OB3}2
jI
K	'Xvl{x_n 7Z9:ZoӘfuߴSݵgBAF[~,T55/դjuqmp@UnH"Q\$E9ė.L%N=^ot,!jʫ9W'etBnppkBf#aa1
c>jhNX03c4O=;'7kťJx(+&|VGZnTd3F9/_X2\Et}0n~^3\ɝ^hAHv,JT\Eޜ弝ܵ?Ro^#>W{?Fl	*[]SAjEOxO7%a@vҎynyM$Y6&\hpEQڐnp)Et2O9,^Gp[9//DY#P
iᤧ E'|e۾Y!nEfh~+6S}Kq0H+?-OEGŘ NU L%2۔r%f{Wb)^,Y5:8TQ.~ΓvYGd 4osdhU~?8
ȅ,z|<T`A[GmwNzIf[Aufdj }ӄ~EȌ1lG*Eܧc/F4AqOD_P><su!zA(=CyJz.]O:(+CՏ4$;),4`6TGXSzC}Hl>&/kb	7mŚb:a2Wt2͕<Mqe`J=,8YFRK|r7HNH06s-fk\*gLf$J1{uh&_dn]߫&3DE"DHcCS~Eed.Y%e:Y!J	"9'Ί="V[0-ƚ-Pr1M3kai!=Sva4E^h]U4p19jJ&IhوPBF~Z r,A_2+06{)`E~;hVB+X>R0F]MѼ/qºX\yw#9˙=T
	 x=$v9y8   f?8
[dWj]SI1|bw5_pWCT=OcD+Fi3H8e61^TR"DQKCx4иÏw+.8%EFqI(x	CPS2-ymYI/NuA'ISֳ	p.?μUAc[s1ɉDC|&Ʌ?\$_y;[Y%K#|TZr"(8˗VҠ0'In|kOq \@Xn41(wN
nD`{׽3hVf+y`.z~֪vH03/<xa&Qfs'E䱋ɇhx8P ozJ<>'Pџ `^ȻVkVUyEutIFo\c:!~-Q+)ys\&LY>ɾ-t?,[ihؘqfQ.pOGywUٻj1 VB;ftMSO(tsᷧˤo@=/zi`/*Дaջ'h@F65i,P`L`toA>p8ڞ/K?M ,T+ZŮ/,奮a,ާlФ1{^qEOcMݒ)
6G~}NFAcWIH=	BS=1lk(
ՇS/|`}O^<I>1~zc)~'HBG)yGc@h6>}0C%hCv$;J~'C^/ 4-ϳ:5bS)S={˕3ca]+ӶxބƈFE܄ğW;"y*VxWʽ5I؃FarbQGm8ӫ(X=I`v58)a=ҍM./7^y %v˗	e]B$Z+i_eyom&﮽h<.ZߛN8c3mw:A!
!٬B G!hK3	U.qBb4H#}_̪e;'_Vc=fimUm V\ihz3A;1s[+ߴ3<>eJ1BïdoBbASsŬ
BPTXD+庈᯷,?L&d|V5Fg}>[DҰ_d&A_Ϙhw\	8Q	s	4+LªgZaP-H	Р|vI~Wǧ u^S6#ˮ4=	\<SWsF
,z̕-{I%Pb
b&nЪ`w0,bl\lІg5WC'dS<{	z[|Thfb%/[jʷ~;/>:p'qlQDA*l5?oyߔKC*]]aayțG
(S#ӥ*+nor[hh8;*ZWI,ZHSdca3Mjbbj,_Wwj|rۚ:涸rhn#.8bx >Su|12UQeCJTB&/d䱏\ɻ2CZw!KQ	"U}$47[v	\y׼~In/N--$vCO!w߉{ڻ*nMXXZƈ|5{<D0j	wبOH0aB!I<ءU4Y2zqy >$Hh	[2[x7*1(f/>O2
h ~~a[pM⇟hY*'wIE*6A_([1Ttm4"V);!{;b,A!^~_ʐӌ C<~4{|yoYdF}|CAؚep8N!h)A'LH&$>h8=4 v*iSM$wRj#)ܜX?<dN\uv~(+pL>AH$ORsEN;E)it'b_`_NFQ1>VszZpeekYf}"#ԫRYNyF2(THK !-:MLh	Klw1h;ٸj۟r8$ƬZ-:as<t4Sjhu>WWOfYv;v5ZXQ)>\*G?@% 8wh/7n+gsO?CWZo)~ zv:kzjoSK>x_ܿ϶dy4a'cB.]4 0DP~6A=ǐUhba48;I0zVD!CTlG;Lzu\d;<A2Ck2G3$FODgnePezgA%cP^+aQm?Ρ$uZO̑v]ۘI51ETz}	2_&~|>#'d]<7㲬MB;u7?Ǵ	kX3ˤ2>:'7v8{l=X~sMԝSha0pRhJ0zB.E$|<o#rCùLpgɇ`Lכ)MғʙQZP7|fgqz^?:o6*LIާ/w~7*t y7Hy}EHQbECk*i+Mf2"ݠ$:҃4H6AAz	^os}iТk7SǌZth_xpnaO@90I	2'~abⴟlfh!e)Y|D:~`Gqou_p#N  z}kOG烴%=[/{qq4goLj`{OW=1	N}GI?g^T Ign~{ޑWdѩ[M*cg^? ptJN@GIщm_.|1md0K?F5Z-m<`eUnZȀԛL'CE\#ɮ\|n7(aZʂ_ pVq1KCXcT Y7I?Gf}u
1+EkȪ]9fZFnS>5t*vmAC/k'+4%,ǁEhCD?GEڨ~\9ޑ!(9#Ơ~nڛI%LksA߈{590sovrm7m<ƿX*l|yzw{gkoMg]7bry=qj%q3E8	3xK*2OQ8:fvk4WkwVX	&X[OC7{zϥ?M1:ɿDLD~T("yŹzw̚{jk^=|f<{l F%nySzο|/@ftxQ0rݒW
S뽗/_d}W?3^'\ݽoY?iMӊYI{W?ꭹ-֓{͆uΓ^mdgۘ佭}O=?o&g9+o̔f^ovm<SrsjBRSXϣՏG4]T 
]\(o7!/s0Hbbi
aʺK]`7{f!V~ֺg_X/wxs4i{;m:?;:Gt?D
뽭<h
\
sA{;(_XK/h%:%O%`Xj>e&-=~NP//%3٬?"ȋh:VT/Rqd(7kߤo"5
܁R;kjG5Y^,;-7XG@7bx񫢷%~zCa
紻gg' ^Goڝw+)F=znkDM;Fe̛OK*L?j6:EƝgNoWuVBlW5\qP;}HN-?3kLkym[yeRng历XN䅐7tzq֚G5Va>Y(d|Q=e4uK{t[;npK%ۭ\6wo>+ yǅ^{y
o>覉C0IuNȕcx$6Z:Mg.1)i1BR*sPC7{u9볻?M1}7[k/0nVG~ӫ?@
{U?>@z4SO^zUJt?¤= J^4P骒F	\zғGӡyN5E@?`e'sQ;%o?ix' U #{GONsX|&9`Α7
lQ27<d5W͗ihśQ3cya,O9M̖Mx1c@`GPa&Fi
ɿ:<J*sMuORtyG=7Qi6Õ*)ΔPON8>_|2:ެptn[012C&>[*tFcGcҎ᰷Uz~) 讱N&ٷJe W<`}	XgPfubYGzV^[zoP謲f"Hk t|3BښbGbd]6|g98ӈo5y/4;nFg*jw:7kG!5 MxfqFQ pj8.럐ъMhCKGr'4176t%d׼l{UZjؓ&KFphgBRub}|au"K{'Q[ŸSAL	94~Ľ[Пk+^dݳM&8C?׭#-Voi.u£>"@g@}}	<28:wi$I1Ǵf\pq8va$1j>OZT44(9bPŝzG`A:;#K@а:Bї^
\](Na!,?O˓l-&GJEnD}
=
IF;M3I5&1?"bC3E#ʏBaT˛#ԋ2?NYHXf#OUe'ԫrP.|]SI*XCP>v-Wzg\>~ţ*M;;]O0 Z%AqmXNt:mwlkuQg֩jsngݐGIV"ݧպVkzs%mEV/?)mm](*jez@g{}iH}
I
>ͦ^[qhHit͎9Ogo6[w5^gР* Z_5A, Ys{뢾pnry+:v]XsZjci7 ϖCU9)K_w:-Ż
5*5k@	tアZw6ֆE퍾D^8贝Vpj
~csF͠+kQdAj)T/5  xCXmA_bc;rEY['ڋ_9Zh5:͍h;2h[m Gw^{>vp𲃿6 Kŭ*7.p.>6V-Zlo<Pj"7YtoUnc_Nj_hYm>*Msmlf-*@#Z7vy#絍&rw7W%m7Z&at#Wߠkź\k6_o;c]X\@A`¿"cLVk ~kdq~4'~0~A慦C8й_<1[h/,]khnЈv@٠It\9; 2&yߚW-N9UEkO[f">OkAi
S}{O'OxdC?4=[lH5ZΕfpw_?B'\{n#Yi6sT*aIÜA05,\Ϳ`<-L`ITjS+KrPxzkbr7-+n`z<Ljݹ`+f|]4SKʯ+!ef4S><rl٣R,聯򒀗*?9J	b[]\2uPy	edr:%s:N4^U8d!g`Т$ MA"z%'C3X䩰zٜNƽ/2I/~V5Xu|3}.,9_/#[;? eyHg
6C}`f'͌KeH:DKK56{uQ!$Mo{Y5p<.#Lȍ<$zDExk/ѽ?`bF ʪ}g4Fp8]Oq|{o7}|ƯD*#>vdRxlhC~nc֧i9srM{92ȚRW̬l10{KM-ealRKK*+x6\LQ<h8/aHH?8>R#c~**/W,ԧڤܥjej5sGpaQO>Bd_4,YS'I^s4fҊiY>yg8MWJOgQzE ^Ok[N6KMCTR)#:IF21VPA(%?A҃aUHzS]\	%2NojMwA^H96gچ?DE ;WH9JI e%&)5RS4Ɠ2%yR;D--uSov-eVj;h/`	h*ѻ囜G*KUkKtG@;{,zii6O+5j2=9BRS{Lj>1$dљqBUH~

.5̈N0t<rviGҦɡ*qa c/Iޚ@[ ^cV
MU*;/O\c/艂 q /I1s:(5z#!J0TI.pʊ5+O{|ɢVU{${u],T"j>)MF	pZ>g M}rqoeb$1Jǆ .e,/) &
|N!I;1H	'RQs)ա_xB_~VM(Yf9៚NR++!Ffp!t2	~CVsq/ c<4/>g#tC17YꖲX2B\XU1DLFg4Jmf_&ALt#(Ԛ_oO>d:By>˱^ EEƪ
X;5b >O)PrȐ'e-Pp#Y6.9ٙp=RLxm_╲C@a~VlbɲHD. '^?GEIi">k
rN[q?DkJXb<Nm10KGhΔS%G$9	MULQ	R|6RW&Ru\d
!0	[oжifީEpU#h)Ɖ;maWr|J vuvOYr0*xj$I-e:5$sV ;F>0p6g :y<ǵWa}´˲,떎#$ 3g]^ 1`s3	ńLQ$fJZy_w'͠o@[GݱqYO>5	/]=1P !KD.l{mu̜mo(A5f8ML6,{I{Uz{HM<yة_/(:?p0W6GU;b.6xҕ^l6>9֟9Bc\H10@~ 3.o ϴ9J>~8HO&8IN)BЇnH,V?49xxj@taǿ+ԋ00'XfCNFрV<SЎg>tU[n2>}L/Rղ|&[L=OUvRӿ%iS>U}A	xkDSaM>+y$'ꘇx0
Lxp Yo6!a'q1Vw*DtTQX:E6&a-<g\;rSe_wyګFN`l.U/{iFԻ]yX|> rű#\.W"bSMs3Gm#wXȺǒ qŰh$ZS{'MtU44j|姜5Dڴ56ЧI6vsL&fb\bǳe5KM6!❘3R8;XYp{yyăL}`pDPµ cnMva,Xt1;UxVvԹDAAeGZ"rV
ܪA,ج`̢euTFFSY0uPHO@ٿE슴(bM샤Ʒ)hcd2b'$
P1%fG9-V`;|XT`EG PrQU4+.Yʨ5!1vy2R+i4hEļ(sI 2BW-5s%EmmVp>5\f>@VPwG8i;P#޽V^_,unW[d1b)7N|6$ёN5Ab{)&UQ0 FPhߝAm]H`\dj#F`%0!MB\E|Aē.Ch
ŖóvUm~hFrK4M8K)zlɤ߇8fC#p!IGɉ?YyBgވM<](gF"uA*:BtGLp2%=˺A#Ԡf;X+C2'h4J3#Ͽ-mS0 0wqAV^~~'d)պ|l:, [J<hf
K0w,4Rɴb4Ŕϝt;aN."ۛ蘒ϧhd\+04,|zzLǉ18&$a~8eXw\C6U=|H䂉]Ms=p:1\c>U'"PapG}!c`㰬kH8\fVN9_]4 y!M)>x}<"Ţ̫Q]RVU5@M.2j3 ߄Bdn/>;0#-}gPu}V8q8-˚,i7ȗ{?3?ZF5kջ߷L+@*yQc0`8"I	9>8k[Mh-(GX=x`źxp.KytFd"	d5zAhY/.
	 A=ꥈbiK#Oĵ#OelM-RYF#Zv?28's4}>.&ۋc?
_h)LBrgӖ8MdǙYQ9Ō*Ύ*1sZj{.F$
7H;6`(#p3x"ʂ*(0%I=M|λ*cVbfVE6ua{ҡ&6mov`<UJ ;Q6)7IEmQxŤQU$W'̈́?:_t6|33K[wnyrp	V^ǰLW7A@fڕa/ O҃4(*Y	T^}%d̶[$7k&ɏ͈1v~7;wny`Hmopso+5W*(KWH~Lg*1VPSsƗǴ2	_&I?; P:HT4cFS3dq][dJ| ƀրRAC	OwI :H\=E?|WLU&.f=4dHmXTD)VG rkُ9p9ްUaϿc/~]Vm=?0y7aKB Z+9Vc4	b<YNIz!KcXw% _)ImϕiJ~M* 7^^3HiTLėV5[Aa?AaI<?D!ZZX㥖[FGZ)g4^0|Փ5"{'/j?|'Ȕ$_u2x̒0	Lb*IQCsE(pN`
6n4@ zdӭg;oK'p7Do+|Yw~0>c<l"d 4kY8xX`/zI2c}(zzW@  ;Gn|lEq_7ij`xZ!q0ǳ7_oW*5#bklFR|m
U R.B"zDn<c9ۀdA >p,RYBhؠCNp08@8 Ȟ$5ty.'jRGd<%>2WgcOk-hg.`a^/IN4ęy[C~ /M{m N 