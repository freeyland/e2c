#!/bin/bash

declare -r m2c_version="0.2.18"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner &
    m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]; then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]; then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                m2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && m2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $(((res_count + error_count)))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

m2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
    darwin | linux)
        m2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
        m2c_result 1 1
        pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=m2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/e2c
        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
    darwin)
        if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$m2c_global_dir"/mutagen/
            chmod 0755 "$m2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]; then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]; then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
        darwin)
            sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                test=1
            fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]; then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]; then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Emma2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]; then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]; then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
    global)
        shift
        m2c_log="$m2c_global_dir"/log
        m2c_global $@
        ;;
    init)
        shift
        m2c_init $@
        ;;
    sign)
        shift
        m2c_sign $@
        ;;
    --version)
        echo -n "$m2c_version"
        ;;
    --help)
        m2c_help
        ;;
    *)
        case "$1" in
        up)
            m2c_local_project_check_dir
            m2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            m2c_local_project_check
            m2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            m2c_local_active_project_check

            m2c_res=$1
            shift

            if [[ "$m2c_res" == "m" ]]; then
                m2c_res="magento"
            elif [[ "$m2c_res" == "mr" ]]; then
                m2c_res="magerun"
            fi

            [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                exit 1
            else
                m2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ȝ] ]w۸(x^GQV:vnm;>qh;&);gݧ;0wܵܵa|yYk~%SU H)vX
B qkP4n*}6Z)lw;nnFn~fF*ǡ;tCo d;>.#ڑ|N?Fvݾx~6X;F?_k;fgm???-*'(8Q^GZ{?_@N[kχR{Kcp|ɇ:si ט{'_؉~Ѹx ˚3k_fuu?`ʆsǏ`,t!Q0:#`AVco>f'n{	Enx;1O0Ϗb.;rGy1v} K`<vzoWUV(e3v%
7m/ـX 8e
=6't$cPfD/v0g8\#pm(23D3H4;؍h#] uVoxn_|q0b:[]k܏;y3~^	<ogT}_s+m̅rYިB!Bwk,3t:mRc"ҎQ+x
=p;23&>Gu 2L0tAWEE.$ e/ݹ'nZm;bwnmߏx>ӟ#':Tc-}F8<GF@5i,U7xhzb!nG0S,q4b|~t^qy0x@ c>܏^̚cR!bgN{!NȶjnUYc7lnwD7\'heVu(jUۥۦ-ۤ*;}(!..v	dw1-"0-"0- kwymjl0kfm&m&y1	5JYVpG6[OT#Dl0C_]Zk
-f꒒hۮVe2Vك>:
ABVadݶ=ш5p9,͸.Ja&Lĺd373$Kg|Jə)% (Ƭ	bHժLA^pȑKv/[[[8\fO3yEF3	)oMrvG5<J3t?N0fؾ7q{ky,wx&2X-[1VG?#<RU+kobA+]	O"&ѫ±>y0O|d+7>{|vfk}WW՚߅ &=m`ldΜ753(RSc/&Y
!1xyrUk[ʿ|{XnZҰ6/-z_xڼR2վ=k_Zr\3rgmRV4%fN:fsN7N㘾,_üN	Hzw%j@*3E{O4M@) 7"L&A 83WMpt8qEkS8ATzMF88|_Ә ڡ;-jlJG4[K4bsogko{sw^׼$dAc BHj+/mo0X9ѪHZQw^cB!n1ѬI͝W6_n_}A%j)PmNeыKߚd&p|2O`K}>Cj	#~To" ɋi"o?9zxŧ0@I.%^z̢uXɂ} .huӃ6ʤ(/9DR`{uU-
[Y׬Yc_.AjLP$*߭aBE2}8ݏ1J7p%-GϸJI-͘8jt!BV8oF|c@X%g}cۯ_	uJoI īv^, o~|SP*	=M|, Ћ
@n?ٛ|+ ğ7w_8ȶ*3
@irsfhOE-*F /`%벨0 5$kDԔM/6ŒaĬ)s&=*:p P^Mh# :9.Z0NPo d:AN} H(Oߎ.X8}w3 Rψ*щ3 3bn㟸CYԾXaV3#
n:uG@JgxtIMM$Tl1w^}-
̄Q[X4/Ē5dlK-e Y:4	LA;,'wBV6rNG  Kɜޟ^ޭ2kMOw0<~so[Ӓ@7dt<4|xfU5|H!mb|x8E!(Akv`*u@pY R`0%H5Ʈ_Li;՛,}/!ǹ19)F݄`j>n(}'Spd@|,b-:{7%šlΫw>y?:xT!k3-a-
,.a--S<,sH>p1bKYlb&b2CgKwzݣzGg+PzAB֫/MVե)AW+4-xkx̈G8ޱ|=F D`Ǩ^cA'#_d-ȂoZ!+vFS&g+|#{iwK_=_l@>Ug%3F*}Ϫ&4LD5eHV:ҞiqTAשׁ	nlBLOF@|	9tKR"^tNW Y-agNx2%҃;fS_,P,pWoeYx<	HXOXb"aJO@^>9o+V?C 1g0 f+
췈my'gxޫDJ9^>HkN W0Ɠخ$GI4SK.APz@,$Y8P@5*5 !ҏV#s	?"*PQ!!k\W'޸Z/؉U@`䝲Ү`*<,ɮIc	T0"\)):NQ6T:|KL.0iCu>+Z6n$xWSiR;/ahgvSy'eJݹ$,.0=Cb(v#PK>HG.?گSJ2:t-+MxE|/@7W@˙P$̺Dhi
nJV
3 ihbPSW8)D$$QQ&&?oFF_`=ciT_7n!R~&.}/{_\<uMIIۮΪIfh8S,	eWMTͥ115MUYl rrE'FBp-q\(6fd겜ŤQ,!7VvYؠXDя{X܏|Zffߤe;giIf_¹XL]^wR{iԶ5wɤf=܄4TT>f@IjwABr`9zEj1uWW~7zNX֥v%-ZY$_&_kPoǬ̝>njRtSdAK[`fA_;G?|d<bhAS(іrrĸcXjRaw4W/j-s(hz?KKjrTA
`'V=c_^lbOƎml-e\*oE27o9WuH01
i`	/,s. -kH]z:;U<(:-GVl{~:)O}&q~1!9E0O虏hsc~;s8Jn$(EfBbΞ'2m[A:hà2~ޭ,>̪a	x+K^E'	I yFC2<Y.FU^+2Rmn3qr8ڨl7.̮ziNǊ^0i:NlBҹ~t7`(v]sA]
1'HAd`bN}(2-I5\#vp:JsYxŹ'k$ag':`_C:֊;;#װH:b]G-9Sj?T;s1ci5?0F7@igh:K?r	ܡ		i#\o
9Yp6{|pY4ƧN͎k)"Mfl&r0〉]_QYDM'v 
K5!7KrAC:r,G`}/QCTLv7Ц#M1I/`Hzdqt2NJ3v%;HY]iy;J%[ܨ#ά'g-jXySxBkn-f[:ΒMFq8թ"w:;.^6i0?[|Mi@Z̺e9<+>)PF		^%9У{#I֊ 00_T"~o)YTL#(
|?c2Wѳw#":I&s<\8.256.a(LE{y!@_R| Jq+>ӒHǹ FWIȀZֆʷqZNq^*=\c==-jIbK)xxʔ<b%'5!YRdfnCsYR>>~	mʗ?H@\^**HE|/[Hb?z'#3;oN' a>^и=]uLRԤ{փ6ZKR$h`RyVuV'IA"1P~3~Rlx<v9zۓz&O]*ʸ9ݺJZCHs!^y\&UUjCKg9#ð>o(Q 6٩s^a%WRxxWA[ 1=`#C*MγO0)&Lˤhf
g?`C75`baEƫ'A	x7Ae"]>hފN1U_9`3R8I7H`:aY7yGG⤗!UG!rA3(}ķ%cC
DLbl H%x;zSKA9#WW)Cd{xiS0uS^J@

\#e{hU%DUEBQXDN:Q9dFL1fITS
2SoWntJ/G:2Kt),|=G AEx}*` +O }(`Lk4`Y➽hbj^Ć5VP@2^(T!ݱBT*P_U2WLZmD//f)v2؉i9B!H*sMc~Hh%.JŵOv.+ETv?OmI~j[*e(m2턮7MctGG4G>6ﺸ/VZEpXkBķX۹ct9<kPh&h
pC{4(GCDFbP-Ҳ"D[0z\ksU|vgG|`h2Bss˪ҕ_:K[~i/M~CJd
Y />MD!oHD!oHf-k:dYA_|"=Ԡa3L&d,׍zm-|$ɷV!$K
^+JJ  4,͢,$KÜeoYDo[~:83iY2|%eJ) lBhi$ҔKY2M;g%QRRA64iG}e+2Ni+GR=}zd^qdѨ_6qWW{UKb'\%Rt}ϯ{$J_@XKgn-=ZAL*p@C*	} YUA2eX
yJ"=lp7CbQbR~xpRѓB>͖OɄ<)zLE>Q>|OO哰H&lFnN$>Ѝ=,/.8JG\T*\%	dͳLeQeE,na4]k,&aO~X >o`$,Oд*LNwK޷/nyZrKJeml+BlNYW9ֿ!jkk1nfs϶$Z m	k"LºߥD)zqhnRu-vЖ̀O3`|+0(tiMۓ̥\sZtܳ>E,!>" kneX#u1ƮBB?MX)dDfG2r-s3>Ed#5(0G&aܜ,Hl3>EG˱̓wI'sqOԓ;|
gp1?	J^kJ4~j)7ڏ)V\yU⪛/,8!F,3	>M;o\+Нϭo#Y\Ix3yz_^uia}yP-^;62z9gnrΎqLx?R&
PMyczqPn"Jk3NK<azm&TnXК-\h0K`VgeϏF,rd^M7ږ0uLC-z<_vTVPQLvɜlcq0
peQZсt9piw}਻ҷk nуn f8&a_|#<.w8N4Sc:QSKh:tٟ3j-MKxE=䨣췔l`ڲ|F%
ހ=[D9g"YD.@YPWe۝:)rEQ+j{+6cqtL
Vz-?[OjΧ/m4W\!ϚJ͚e9l'{xGьmsVeҚ5P0j^NZt`9J֙EkeL5޲jjhֳf1:_133zD1+ZTakb K:?[&|p@|'Pܯ=tje|UH\a;ܖ5_ѬLg\6򠬉;5m[2s\6W)w[FJ3i\(P͖FU۹,ah|_F7$~Nc,ce)N.ˣBx"cjw4=I*ITr.lGRNVG%سܗAr,h_Egz}2="ɶ~HھˋkMɴT?S?US4ׯiTlG՚cNFW?j!?zbk{Pc=fz/SR!D4GO'F;raurGb]qct4S;ɟl^+J
$ILSfY[rDu$KaђQ8EBVe2|7aړB]v?f V.IB
Ec=xxd35XiO/mo~}UT
]J-,1q<Ro63sI3`vY7׎03;{T8nKݬ.~͕_ːW3PEe,uH16z#?W*%^|Q&?\(ٷn\ y/_ B<bVW3w/C7q!uaBCTqTjnݒ=EdlƁ^	, .dӌxywxh>D/CXM<ƈũ;sUWg J~p/B>CZrM\	dw|3aM*t <8y;t'-: d(\B2\	! !@[sGI:(aāis6..,W:btR\?|pMظ}]N6͗QQՅMH,B+P&o,ŉN{茼dI䂌P΂-Γ8Ӆ¯9~/=E(}<[jgeU?V.0:a&Xo:X]s{[<WN2]:=^MN^%*	,`?焖oP~͝Bl3cPiX>xnٖǬhbRl?eʭS-xt_Ԕſ
L們1T$2o.#;$R Iu0m\;2kw<7cM]c.NLQ5Pr=j's~I 	T߆{Zޓх?R]TH{(_E#םfMF&ߌiKK-4ꯈ{-5F_e+*G_'d5&Kd*>NMDzَ&:kka G2N.dRCqce,yk֬Xyj5RڋkM2)}㩚mL:ӣ:E|I:ժʖ7NB[&	ӘY\I2js1l
"3b(QR%:[o 1ru/0D)iJ`!Oy(ExdYdՌ&szJ{̖e:fh?٫*
hd+l|Y~旍$guG3G#Bs6mSoV_,iJ:<;[9-eJ8k'#L|[r$.(7?:*I06ܜaцsӨ7A7iq6PG.sǓ![řǧ a57NoqZK5Y6␙O(3;P22)UgA`gMHH",x
tR/UsRh:Κka5[OqWD7vRg"+xx>Gxh:ZĂj>3	!5qV1.I" 7ta2-&wcfk0"n8B \'<n`yQ
+S,g~O}n*(' ;"48׊|a9;~2u̻M1~UI2i!0'sjS(jp&^Iz[@%MRbd#'%AS(5@=Y[O3`7?eܬAmT/$5'\In<Əb'MX%ė,) wF|$P9ȣBE\)t5ĞOtv5lSGj.|lEe]Ͱ'm{-3U"!cqVWK\t\6LxkfOFE{r̕apJ\XzNp\VGC`;0W݉1_e`A VFfV4$Yi$}\d҇MĵpaF(W:ZV!DHK(>H z(3 )iK>8K^y>c@pTcW"Fh&^wql41~3BER3 Hq+CZ<	s`/yܳZAQb*AP"yq1kM2[H/(DL4rgsd?vDS,2ujdjIV)RJQݥm򪖁UÑHi|KZ4\
KW(k]f8
^>]Rg]:2%$~1tEMCt+5xBX,[e,POYgSȤcf078K&ኚ2TQ-[g >.fSZxbZ7ּj{'ۭ0\(>=kyzvv<2\&ZqGs/ݷKRiQ)?-j>+_ye_F&BnaI#А׬%e00i]<
8)&TȍrnNS4%Χ~Q$ט
'E])Y	;Mr(IOT0xޙVG1WrQls`r!K.g.N}Wl?|g[;l0-]#/fY
ԼyU线x\iZ8Og:M"L$ƣ>d
Snn.?1EETni{sײ\nG]O8HndӮ"V感aBӾj^HY=fbZ4vVxs֕kMua޺Mz7kq޸v)m	z/doDdEK;+5	'6L8i2B(\52r3e"cdͥ3:FRi*?StƁ2JhcNM͆n'
I U0V>\v	tJ]%zwnէM1yK$lwcD/Hdmԥ(4pHV;M&0zo##wǻ<-,_mѸQ,~=&D6|Y8VG m9lS ߬1\MA~})s?7{mY:`rLIQ4oa<;'3VYjgLwV\|e-}z( ]Q/mp6d-d铽W DjY?jTOk$0LԸwiִ5zhjD}-$$=g]\e!!ʦtE;/^mR6enp_رsLuC2m[A\MHlʰ{87ݽ@|'C9(`6_xX !j-|ǔr"$q8YLooNյS,!^Dط	72,Η:7'0RKikL',էreG])<)Y*( 2Pd:{onNPkZߍ eD<~;fKmɩťpppmr9r1n.d5{UF97{Pl_%<? z	j2mQ,ҷg~1h8V&VK9:Gz])j⊗r_6:u<RNw=0bW왾TvG,Խ5<+6^r|(ѭ* ~f0kr'gǼjw}S&a	"dLF6td]Ϗ0k+)7IJ:4Z嗔
gzT[X-]*|ظQTs`Pf3Gէ/ fč.x4;44:ѧx̚?jbվaW˦zN>*@AHJ|K7ZZYYk2KSm2A>۝+;Q]{-ߨYˏqJ;UYMnЮM.(WI6
ג)0ۜ$nQF70Ss"r$-9ޚŞd7DMy5,ܓ,'&d1{3"j-K|gB	sSbbf&zggvýB4ˊ	Q4欸[=<u%QNŋD25L7baF'5E%t+o#ϗ6AB5H97-юB&C:A=W |C7g9o'w-jkݏ}ć
>S?o&%s$:0H|e=w/ݺ6f1Xҏ[pra&hS$v7	`hMoI0W33xcQ6䰛\rBg]H'2&%d#JRs-zzWWy^(9ĔpWn]>J3m4UJ"34zMx)^Ѿ%`8h+>-OyGŘ րU L2[IPbgӽkbW\87KV M?E?/9owgj:ƺ-u5@x8%M'`ս;=r!b'jQ=vЯd\+TgmyM>7M 9I>xte}\!l_>>*@=(|A=bx`Ya0B)S9k~AY$XQMiDC]\4/phrLu{55/0Dy
;FFkPQ.p0 ܶ&,R@',T.suxN澹g[Ѓ<K{<[$N鵗FT /<?l]	YDBK^8]W*n; `(#CρД~c$udX#鋨yVINRq2HbՖ:Lꩶw5"\aLFCXz:g*-JUJEsk R`V\1yd<^шODN?(7|%	2dN3sC %R>R0UFo5݄mѬ/qºX\{w#:˙=P
	 x=$v9q@V@~4q䚷Ȯvkj#w5|/!X6v5Īj,ஆ$%z7Sǈ	h \0^TJblXG?S-'[qV\rtQFlJO3-ymXI/NuB'I%x8Pfjk䞹~gު-9QXF@ed!>ҝbvL/#/ˬ+-qmJyJ' 7ʧQf|+Oq \@Xf4tO0(wF
nE`{73Wf+y`.z~֪vH0=z_xN?^fr'yElC0I|UJ 7=P%U_(tOaX}T׼Xݨ5'UyEutIFo\cZ>~-Q#)y3\,dm-VYRC4Il83HQ.pO5Gyw.3wbdA1v6tMS$2
jA9oOI/ހL{_,!Sqq_Uy)ţw'hW@F&Q52ȱ
:0 fێ\ڞ/K_ wHVNebR%4i*l͞\Xs$rp; mS߇nczUR0Rc'!}q)쎘mwH|'?O'Og">鞏Hs8}p`}t<#w|+u>6O2Lr%	ω`e1;"^?^P */nNPצfm9pJxqLcdW
´-1E7!qiNq3P&ɽ9ЁFarĢ)7WI`3q(&qs"jDމQ<)9zÛL^o}W˼rF!J쨟-G&HQ{Wr6(ȱgGgL]{ѪY\*?i{V*?c'g tTMBf	 "Gϣ-$T	~ sV5^|2']u?9ٲ3CSj#eJCѫ^mMk>3@_k3.4jKZ&lN7)_;CO>\<wZj$
hc\M !I-n0UMYO@~Z$XgiX/HY蠯̂i]:qhoBrDQ٨|BGa63|~ٯo 'R4*߂]wI݉E}Ԧ'yd.)EګFsF
,z̕钭MsI֦= %<WD1mmr`hU0[HOqnsGe9zYgO6!t{}(KmzX(V kX+J謮xA뛿sn⣻ PC1
w06EYʜ?ӷgDa_xW7AE1G}`=_^.fT<Xq{B6^ǣi֙u2JMOEjK#Ֆb#dղ-X ni)$1q1]q/H':ʫݧG\-σmq<$@,"h"1E:o[B%5R0b</T5 7q~cweT A	>RC;I^Ҭl'K̻-Kd^H)u}qfh!>r~|o}
 v,%kUܚ(jYe0Q<kl~C"0_y-9#7>w]a뉃+ov7ke;!͛E|IBXv;[=}eoTbȧ_|7*dU&A,T#k?QΒ('uފ§#oK4x[%;30LM6Oxɐ~%Cjh }yB'~[`1޲D;CȌЙLF߃5qPC("%'LI&$>h8	4wC/v:iSM$wTh#)ny6NaYsp]64=eY%%!rR0'Әkuу6h%d@ŉf/O]gr?p70)?ɾ@׳|/+sϚ?zidP.He9Og8fP剱EGr|^ QnSDX'xyX}?)cAaͪ"V0CKG-0<{Zsu>knm7Ymuo3urC4PH>'rFwV;~3qo5.\ojS-|WkƭaP;JCyЋ&.);umr7ga6&:r	B#aDVу4bC 8q}yJةz%-	<͐WlC5ګ#A{GO@㻛jM@>ܹj?}2GFilRwma&Q
LˊR)Pw(vWȬV~ŌuR_L6	7nhq4cXU"8eU5W_}X3˨2v>Z38̥llj^9&lɝ3h7vpPhJ0z|.ED|<oGj#rCùLhCkoBכ,)LʹŭIסnˋ͗<p|E#lU_nm?~soTDr y7Hy}EHQb#c*h+Mf2"!ݠ$:t8H6^B;^osiР+SǌZth_xWar0`?0)AB'/Q/uL4A+5~)3a$
g k<3:=fm:8rc7zzkOG烴%=49_v&`:I$o9)0ug)0~R)O;jbk $AĽf@'*) C~"Z?.j%#

S7	UΝxpx21	":畻Lbn|`kZ0xJUvZȀ=MLΡ"dW!.t0HsWc ܿեBL=Q@֍3O{,tBC̈z<u٤(~O7gjVs?)OᚲWn@%n޼t{1r!q=¯~y=i7׮`<-2w,B#q0<JxH֏͝;867a@4֞TR QjO6+9"?skw'fNflk]Њ)erA˦ȇ{;[{ۛ[?U{]SɝF18MpZI1
1>`>yCv%۝n*k\m;yb/lc"sl>{	;>|gwoJcp}=̫mE/Pw'c3m5?}{ 	V;$qo%;/T5˟􂂙~+-x`j~~>Oڗzsn6pp?|a 4=O˧%IS$Mn)evw6}o6촛vv#-<S,&n~?_Dѿ؊?4⯽	0S7Yڽwi/3ڟ3J7XϣON..sI+g=K٢XX޼3LQw)+w08wO~LV 34Zw̐%~'ceo~AMC`Plnn?@P5XdSCBcҏѧ<L<.cy/:8B݇;϶^zCcd~~-lc'K5peTuԝ ɺ7[\KnđH֬G1DjCr:<RZG/33*xkE1'Ҽ-x}ivZF,XGk2G7bx񫢶%n;#a
gg' Doڽw'%. j(4g{J%v֭J79~uklt_{Ϝ߬ZfcXٮkPP;qP;ͽ4[~f9:/7f5ֲ۾weRng历X=m?v|ȉ\|m]]kͣ'a>Y(|Q=e4-24Z?I_m-[co2G:x큻YHso|(ԿF4>E:y3 Wfᕾ.h67i ƤTIA=?|YGo_`ֽ<O<{ӛm?@OUׯ>@z2vcG~sk*^^<raҞyR%HztUI_=iiяǌ8#+<B*R3pѨ8Fd<B賱I #{CGX|"9`ֱ3F=6 8|GcGe~Dm;m}G a=<>Nua4z#cA|@2[at!ܡrCxq0%j(j/{+ũ띜Ʀ7$>zfmo6:lb}1G+UR)|q<zU{2GetDݫpv[012C&>_*tFc6ҎѨU:`1 讱N&ٷJE W'`}e	Xu)kPfubYzZ^[zoP謲f"Hk t\S\m 
#iՍ.[__Y]Q=puN2"kMN [3)^sSvRX$ 4u6:mBCUkq)VLF\:;o$#y10\u1VeU&hdBRuR^y~Q$twsywQK\
`J@ih=ݚl(_z hodkҐG0nl9:XKsGZCrOD-(̝&@8 x5O73
N8DМ`s#AVcVg	6hQA9Gqqu[33,Gxv93Gn7au\B
\]$#w#X~'ٚGE01̾]C}r=3
IF[餚Yb#3dE#%OBaR˛ԋ2?`DXGUe{ܯ>TrP.|]SI*X#P>v-WzgX>}r§*M[;]u\?!Z%aݱmXNv:m{lkuQgk֩jsvgՐGIV"պRkzs
%-EV/?)mm^(*Ujez@gk}yH}I	>m]%|M#$m茚] Zwl۫mnwkΠAU@ڵڑkvXf5VVF}a5VeA@WZm{mvf6ƺn -V;SSVvouZ6Pw1]_gkk}U`k@7aZEnmn?4ޱmi[au
Y@fAWjYWɂ(RЭ^j(evJ+Fc}lZ@Fm_kmh/~q" FfACkmKPհW׻[vj57vg=4ˠlkXUzق ۵kڀ,MZTެw@XXZ.~[h!X@Nwdн9V5F}:ue-_P7-h4(ђ6FhQn߿6vk^J6nxh]E\%~]o vs ~l uaq}m
NG3[EbPuGqT	ړR؟ηPn
h 3e@~QvRpl!iʓFTޫ4wէH#N̀A Kv6d~) {[s$֚59o5+N_j?F?NRqp`rSؖ?\nIm2"Uh5
'ړ:W^P]iўs1݆tZU<m6yzȉN+PGaVȃ[Uaf0Vt0hEIjS+Kr-Wd9Ckbr7%+np<Ljݙ`f|}ɛSKʯ+!fS>=bl铤ޕ⒀WRsҟŶ*,d4tIYu$s:Ζ^pB&Cw&RorM<4I$]K(9"/	Hh_Y-3_K-jPU7?wi0@ݘw(#s*S;3$bNff\j^-CI$ZZôӏy1 i4y؀s$98Zڻ2e(7K%$#"/"+]{3&1	P&l?758.A	>򏯾z]{?^e3~%?|L2rcAqoڭwY1zIvAC<)*4#EefUf*G_j*/ cZJUYQDNʣFbqE_ras@L3 29'̙C&a8s%mJܥ+ej5}Gpa(HguҿBiN[YN-eiFBPeZ}ËςIпlb"$90`A껟{Cȷl>=MTR)#ZQF20VPA(%=AÑUHS]^	2NjMwA~SK96چ;2BGUY [+t$~H U%&)5RSƓ"V%y6R;D-/u3gveWj;h/`)h*ѻz*KUkKt@ݗ|ohd4'A5_euޞ!F*܏u1$dQљqBUHm`ݔq5cd
fD'qY:g
A9_d#)STP87 j~$Cou^)Mc{nv+n*W'ݱWLDA иDmqYCCT2#!
TI.p(H_הb|<i'[RTQ '寢Y2Dhg4E
Bk3j*v$WWR7`zT{r~%cļIb(1@T]ʫi_b铫A
I5MVBmS"Ĵ"%YϞsKy!Tracc}cCI;3	Y+Udpxƅt$f厒euN:yc>
WEÂJ1&b7R8Qj3]u2BA1-:u0'S??^1ޑ7X^a^qX,d)JtI7Q˼-~v2bE	 bۗxP2hU4]mt,s3PQxy~;tBOTĚ"Y9
]'A-G8Q"5%q	,1'cdu\vDDc4gЩ!ʜfRLIfPL7M9Hqc%݆NE<zM;6so,:m29"o)f1v)06g'_>.VR\/5RE1x[oz@+//v_1+nDW$1gZ(,L X L>KIF_PλU>nļb]mdtdL~'y8>8k^}M%.&g"4Szx~w>%
huW՚&i6$PB5cjb2}I4J ʶ_'bTa6eSidJo0G>1WW˽~`Đ5<H76䙆bڇG~]`l. G#[_<ϋwZCxvV@|MJWfgx5X|va`X) R.,Qp!	b@b֤ifF,`HP($c'^|:=M !D\膨>}n3Nǡ3vK}+\8?
}7t)`^β>9xCPui`*Gy!g>F46d)ubHJ,I]⑜iphv2l r|\Vg<$DxccP#<gt 0$f9nBu@`ʗD#{7
:ȦF=ϳŵ"KwGa66k0t#NйX{"uEӣju?5ͨ~ٯoBۦY'>pT)1wevNn7PU"ho>xΟ9L
|FM+Fc,UkwtN124Tޤ"ը20k@}$m,OlF%RM!"F.ĸձgpX.4rC8@܋B4Ho}`Q?S21A	7ԏq7酱>bU?TUfCTfYQmEM䆙MkX)syB0b.ܾ20j5z|7b:̂Bz9Zh(bפ5@c:~7gDuaPE9G$K;!<	QbzNSNblw:Q5Lu	^tDO \,dFz9%E&ġ3aJ;?'<SBj%SŲR78UQ2c1r4`_FcX=q(-Cf+й5 m<1L@8xm5i\+X$2]m"\ `Nܔ;u!n*YloKMIEy -P@}w)[")4osgr5ڒ%dkTs_2ՠU1Oۏq_t@<z,=Xl?>??L\m6PUWm:=;\o%$PُI71]Mchƅ<4r؝1Sw4999μpLPD)'E_7ӡFF1F,k+H/t6_a88AiP┝qAxmn/´Cɸ2wwc5&Kyօm9U٭Sx :nz00;.}Bb8Hʊ Kd|3r9_^?Fǔl>=GK|Zih$}AhΧ6JXJ̄{xnc>@0{Z3XOI}>˅1kP+#Gt-N.х/x0gp[?&k§ɔS*l.X/eLlc5{ɴ3ԪR>\0章C`8/DQ!W⋉GX4y5KʪbdZ&@MsF['tf~U'?;g%cfڰɍxAku|K7xhl_3s{ntX^}O7Q+ wxM?v!QONyFYiT_g|(h aee$u\"<{;tFd"	dzAhi-˙x/.r	0C}KŠ?Vb$/ݏ(V_<.)J7zJN&?#Z8T~d %pN6-i@}*O68{ξPS ܵ1NϔXʦ`⬘8ŌIFife7(_G5Eɷ3@Y(WDEMMSt;kblu%P˴Em;0,Бp61InmקI@D4&~nJKqE"G5!:i*!1҅/wd_]j_9ݺu'ϻ}EȐ#/X$u` y?onxSzd0]iorQ4>H>UUޙv
I-?1Z3wΎf>ӝ<N:$ܻBxU
-ReYA*㩹LKc\/S($V*1֩`TJVY2O޸-2%pK cZi@
T!ڎ;P4
	aP@`$.NB?|OMM}]L{ iɐ0J	S2	@4^/+t3xs@rQO	08}'Jz<wsFo}/Ζͅ|9! RsWsڭ.48qzGS4yCם+xr_@2'>@
@w%N-ϕqLnM* ^=^=HiTLėV5SAa/Aa?D1ZaX㵒[BGZ!g^0|5f"{gj?~+Ȕ$_du2[{̒0)'TdI**Q>Q %Z'Kҟ@,` /+ ")םLQ;bgVnorxx+D?;CxrEiL+<pa/z{Q4uC(໿VC7yCt [ ;Gn]l{M5q_{B@GXdxX?&7x:kX`J;d[[u$YL]HXԢM@
]EPHD\HݒG|0Yx,΃yJU:!K^sc)zCcЅޡDC@`MYp|/,-3{#|?]:f2[}߻y
HzDM9w,P|w?}5w N 