#!/bin/bash

declare -r m2c_version="0.2.18"
declare -r m2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r m2c_global_dir="$(echo ~/.m2c)"
declare m2c_loading_pid=

m2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$m2c_version
\033[0m"
}

m2c_loading() {
    tput civis
    m2c_start_spinner &
    m2c_loading_pid=$!
    sleep 0.1
}

m2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

m2c_stop_spinner() {
    if [[ -n ${m2c_loading_pid} ]]; then
        kill ${m2c_loading_pid}
        wait ${m2c_loading_pid} >/dev/null 2>&1
        m2c_loading_pid=
    fi

    printf "\b\033[0m"
}

m2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

m2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

m2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

m2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

m2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

m2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

m2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    m2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        m2c_info_bold "\b✔\n"
    else
        m2c_error_bold "\b✘\n"

        if [[ -f "$m2c_log" ]]; then
            error="$(echo $(cat "$m2c_log"))"
            [[ -n ${error} ]] && m2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

m2c_ask_bool() {
    local message=$(m2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(m2c_msg "$message $(m2c_info_bold "$opts")") " res
        m2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            m2c_msg "$message $(m2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    m2c_res=${res}

    stty -echo
    tput civis
}

m2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(m2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(m2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                m2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && m2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        m2c_erase_prev_lines $(((res_count + error_count)))

        res=$(m2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            m2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(m2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

m2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

m2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

m2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

m2c_requirements() {
    local test pass=1

    m2c_info_bold "\n[Checking requirements]\n\n"

    m2c_msg "OS compatibility check.................................................  "
    m2c_loading

    case ${m2c_os} in
    darwin | linux)
        m2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
        m2c_result 1 1
        pass=0
        ;;
    esac

    m2c_msg "Docker installation check..............................................  "
    m2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    m2c_msg "Docker-compose installation check......................................  "
    m2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$m2c_log"

    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    m2c_msg "Ports 80 and 443 availability check....................................  "
    m2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=m2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$m2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$m2c_log"
            test=1
        fi
    fi
    m2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

m2c_install() {
    local archive test

    m2c_info_bold "\n[Installing commands]\n\n"

    m2c_msg "Locating archive.......................................................  "
    m2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    m2c_result ${test}

    m2c_msg "Extracting data........................................................  "
    m2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$m2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$m2c_global_dir"/bin/m2c /usr/local/bin/e2c
        if [[ ! -f "$m2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$m2c_global_dir"/ssl/config/v3_ext.blank.conf "$m2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$m2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    m2c_result ${test}

    case ${m2c_os} in
    darwin)
        if [[ ! -f "$m2c_global_dir"/mutagen/mutagen || "$(echo "$("$m2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            m2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$m2c_global_dir"/mutagen >"$m2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$m2c_global_dir"/mutagen/
            chmod 0755 "$m2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$m2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$m2c_global_dir"/ssl/private/rootCA.key ]]; then
        m2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$m2c_os" == "darwin" ]]; then
            pass="m2c"
        else
            pass="m2c0"
        fi

        m2c_msg "Generating private key for CA certificate..............................  "
        m2c_loading
        mkdir -p "$m2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$m2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$m2c_global_dir"/ssl/private/rootCA.key 4096 >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Signing CA certificate.................................................  "
        m2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=m2c.local" \
            -config "$m2c_global_dir"/ssl/config/rootca.conf \
            -key "$m2c_global_dir"/ssl/private/rootCA.key \
            -out "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
        test=$?
        m2c_result ${test}

        m2c_msg "Password is required to trust CA certificate...........................  "
        m2c_loading
        m2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        m2c_erase_prev_lines 1

        m2c_msg "Trusting root CA certificate ..........................................  "
        m2c_loading
        case "$m2c_os" in
        darwin)
            sudo security delete-certificate -c 'm2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$m2c_global_dir"/ssl/certs/rootCA.crt >"$m2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$m2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/m2c-root-ca.crt >"$m2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $m2c_os based OS yet." >"$m2c_log"
                test=1
            fi
            ;;
        esac
        m2c_result ${test}
    fi
}

m2c_on_exit() {
    m2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "m2c" ]]; then
        rm -- "$0"
    fi
}

trap m2c_on_exit EXIT

m2c_log="$m2c_global_dir"/log
touch "$m2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    m2c_logo

    if [[ ! -f "$m2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        m2c_is_update=1
        m2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$m2c_res" == "$m2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$m2c_res is found on your system. Update it to v$m2c_version?"
        fi
    fi

    m2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${m2c_res} ]]; then
        exit 0
    fi

    m2c_requirements
    rm -rf "$m2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    m2c_install
    . "$m2c_global_dir"/functions/m2c
    m2c_sign "m2c.test"
    m2c_global up

    m2c_info_bold "\n[Installation finished]\n\n"
    m2c_msg "Emma2click toolset is successfully installed! \n\nRun \`m2c --help\` command for usage information. \nVisit local https://m2c.test to check useful links to included services.\n\n"

    if [[ -z ${m2c_is_update} ]]; then
        m2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${m2c_res} ]]; then
            m2c_init
        fi
    fi
else
    . "$m2c_global_dir"/functions/m2c
    declare -r m2c_project_dir="$(m2c_get_project_dir)"
    m2c_log="$m2c_project_dir"/.m2c/log
    m2c_load_project_env

    case "$1" in
    global)
        shift
        m2c_log="$m2c_global_dir"/log
        m2c_global $@
        ;;
    init)
        shift
        m2c_init $@
        ;;
    sign)
        shift
        m2c_sign $@
        ;;
    --version)
        echo -n "$m2c_version"
        ;;
    --help)
        m2c_help
        ;;
    *)
        case "$1" in
        up)
            m2c_local_project_check_dir
            m2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            m2c_local_project_check
            m2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            m2c_local_active_project_check

            m2c_res=$1
            shift

            if [[ "$m2c_res" == "m" ]]; then
                m2c_res="magento"
            elif [[ "$m2c_res" == "mr" ]]; then
                m2c_res="magerun"
            fi

            [[ $(type -t m2c_${m2c_res}) == "function" ]] && m2c_${m2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                m2c_error "Unknown argument \`$@\`. Run \`m2c --help\` for usage information.\n"
                exit 1
            else
                m2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 #ϝ] r9(8_XMJy答bQTukRI
fheFdEDb;Ogalk__K Uͨ38 Q_4n*}6Z)lw;nnFn~f$*G?$d;:GC}N?IvݾxQ6X;Fo?_k;fgmo?;;-.w+0{Qw$A&Z{o$>_@NgZx7ګ5:0;4 0wVNq/>~NkϬյ+}{Σ	Drμ0eXz'XE1s'~\ώi,H'(F,=	Â0IJFg,Aȇ1[	#WYh2x:bȗ+tgkbx+t_|뭻q;Xpk0 <@"r}x!}ż pMwx(	I@~B<Fo(ur<܊ ثSzƛtoM55ouq7oGdi|*
B=zCFI}r0v1&qcFR,] t=^c1^~icFcv^iÄWoݾQ`н1)
/!nabR*r~qp
(+~.<9:jsVU=9J%8_'`at`^24QӐDY]~9>gf;!L&K,9&$W\ƈ(cf(T~&'fةArr9mou[UVj-zIߋFUwʬkwvoo6oމ>d@v	d@rTii);t65M	6l6lA],d+a~z0@#'T"֟1Hj|ӫ.jރFxsXuIYw]?<?s^۴:
D Wq}pZ8Vf\%|M0B&b]r2'ީ$t_@0%Er*9UYB0}b#To#_j)`Ǳ?f>~2{+67MHb譒WS?zy6fGqʰ}^W[,bY-t8lhq`Bju:.EzP[uF	~O,ҿxu8a/X?(yiS Gӳ(W`wyY](<Mjbsnw@P1O-5
ao.2^'W(pv4-ʷo=-_{e$s>56/Lo߹q-T[YY9I6Hko/\ć9ƿ|D$'QJxa^ZI|td5@ zW߽'&RHECS?9o:9>s4c/=Y6DWdwkԾ?w@S;GڹeTą~zKo铜vmqټ( wSbjfz.$&j'Gc'k0XyѪq9ZQwn<Vph5dT|[w.̾5JJ
ťo2O]8:O~Z]܀A4N>#52mD*7[4pN6_ #PvwCld2Fq滰}
 
Z]tOR<S4 %'PwiȺV5kWz=Aҙ	DW5LH1eUPI簤eBش`,yKf`{!+7TUV}Y_t|}΋/:#7d@^X/yW?*)of~Ł&n=~=$% vgn(筽?ˌPܜ,Z?SY˶~?M'^?'P(uYpUIWJX^5eSSڦX2bF̙0oQAͯ }~Ŝl ں~-@fXkĜ7D	opTւQr|D^0 h Ǔ Op rMPx J"~FFhc$fg/<n5"}sjfG>܎s*Kɕ *MC$Tl1nv^.
̄P[X4/6a(4 TV&}ɏ ٝ[g_v;nUEk!꒚sӳ7;{U鯶'[1Ŵd$еC)9!-{y0g=(jo1[ՠ4ґAߔSh8).FZS]d`n+Ş|w)ArQ0|+=vk0^D_BMsbNsR	ƪhBP '!Ȝ}[֋zt^[Ϟϖ/v޲z>x݃:\
٘h,|iP`q!kijEf7E[J$OXL[92BgZzz'[dP6%W_MVhejA+4m/xox̈[8Q |MFyOy3OXYVʅ+1T'6]ZAk	W?~(ǿjFs8eYAMATf	5cK?LCEeUHа	0=^
,_&ACA@ܼ]u)th&Fg!	*}w~v$>gh>M;'IZ,jUa*<L{AZ /Yꜷ+΄0!3S`޳YBۢ		lW-$ؗod*8u+jK )T;ui ĢI؅(XR~p9 -Ko=z:8 Qe*4$-d-Ŏs.֋$IbA5G֞Bڕl'!}a->FZ^^
\k%9ܣ@N5UqLU:ʌ|{#?$M<+)5dѸhUT0ݞO!EAAAߋs)HuoeY^`a<-6Kb(';%OM-Z?Yo|eL1F^ї61p_n$ė3\׬Iu|nWH3]~%f@2؟1&ŔqWS$$B*)XoXj4⭤j.[Ԓxn!K~-.|˦UpP1Yu2-63UɒP-ӄ]UK+bbkکjRe8Q+>Q6` TY0ʅBpbR4a<?#(/bؠDЏX܏|ZftwҒ&@xSs{ﺟӨm]i0GﺓI{ai04TU>̫f@Ij-Uq z	A]=XVW8>C	Szyi0'a#u.Khe~Y|ie8A!W0*}2(CȂ$l9A}ry4w)&P|'
bVzZpP'ͥ(o۔Uf咽mWthN:䟧5{9|g]]rM/8RTWxtFVȺ̱Ϸ0eȏGkm8s1W[s58Wy-2~]͹%Owl$
319NoA`0eB=BZq4hשN#J=NNˑ^N$)]$o_/&s۸fMmax/zgg!Q)EaoYd(P:n)`*yBLCYniUіAӐAYwu4FV]XVr"ex:dܽh!?R_^e*[ݽr'/#C5e0>es:Nɣ:wp&$(@뙥 $/BG`s?lGw&NX$d"?В$X5o'hЍŭW{$ܚ\TSMkC:i`cWVHGs:AgQKNaԤr;o0cǭi5߳fۂ@ip2K?	O+		^}PBN˞{|L鉗oC7CUH\&c3ǻW
0ӈ	PYBMn@^;ă/UEnMt&ґc9K5b5F6n؀78CFFJf`P=2IptTmN9'%YV	|r,˯4x;Y;-7ko)QAAb\њ3mgICi<1"-#M1/ss fgP]} 
I6dt<DOa
'tBWGQ ҽOUfvӊ 8_TBM_Ҟ-ηL=9x$<foEQ1iоO#&7O"[cbІ"T<8/h4K^JD+}gZ60*Ym2K):Hh].G$t05VGF3)eP+_=Xub=e)5aӧ'/m\
ǣ_3 i5ۙ˝J!RQ6$-^!;N a>^и{~Cs\P'Mh#|lB$Qݏ<wxR3Rf-mހ9?w1z1:IGo󠗿=.syfUUVeeX@?Ԭ)8.Z1Lj3r.E7!x_KpE/W?w%` V82Ġ28s<>	6Цiz<7,yYO=v}0B=/	5(:! ȱZ0uLW΂$8"gBpGp}umaD<bmfœyM>r'8z/8)<;GT-aB RtD$`dkiuW#wBL'"{f+V.lxYS0usQ^J@
\#d{hU%DUEbQ$XwDN&Q=xFLfISJ2SoWatJ/G:rKl),|=G A%x}*` +}k`eLk4`Y枽lcj_Ė5VPB2^hL!XSX#	A*/Jb{cVKiE8?L2N_;S=y(d)Yea)Pxҏr?i4%28T|ݤێeHj<_m>p7MmwSvcS[e4Ji2;M=CmbX]mMѠ.KgU,WF(Ɔ-v]s>Z?$
*ԋܶ8!',,0(?\]".ZЁ*t嗎Җ_ZKS~e-YB +PŧzC"ߐ7$|C"ߐ7$|Î|C pe-YB +P'r}:p>oM0)fn _7ԷumM}[U:[[}kWYJPh)x-R Ze *K,KCeiس$˚1J{##W^-$F!Kɱ㈉(c6ιjILD3$G}+2Ny[ZcO( ɡ2H;IrWW{z.O3'$S>ι=:#&QZtON~0;a-c麵4Hv"tsfzq4Tu
iÒ<P؀X$  oͯ}\ V)6.d	q.=SHgjSDr!Oa2XM,'Q,[d3tcO~8S%G޻e8<g	׮E4U
n* ,#|YL2}Lbx2\XҮ4,ݰ8,d 70So0<M*Uz޳b^\RŸRٹc[z(ۊ\S`*jd^cmr}%ͭvE,!b(֕L{ǡKhוX1>è
%`QzӚa(\qZY:X2Q
l9/Y밇ak^wOcS&[	0uY$/
)Wb1)c?+Cj5Q`,uj(I21zzG֤Ÿ(&]m)>X%4eqo+Fʵ1wb<+jQ\)2NMڼ]Em;&hv̕bݪϾo}mؓ%Od+7f>y?Z̧-lwڛWZjqLa{R&
P:sx27},潪&<-<L\Г]ju8ǉC|	9&xQyVԏ1lԩ?u^Qt{m~Ybfv<K&]>եTx1]0[DX3?^Yj.k!=e{}\c{juSZNpt0A4N-vV<Z^k2Q,Lsp3Li%ӘZ'Yz'Z{K)R&l=^Qrn=h)fL~ҷ7Xh^Fk`Ci:X r9j dkP@_O[/IkZYۧMb3(Ik}+{.]׊eqG|&q|ʋs(SjҳY(4فd/(;rۜU<͚CO34L/FZ@jNZt+`9J֙ekmLLkeyj~kS3;NoMQUxaX+@ϯ	_/ꠝJ|kn	ky9_&buν`򸜹+՞ጧͷ<(r&A{hcݰ:M`ǽX4t喞EH>Ӆ帊n4岄C]$*o?Ih~NKc,ce)NA)<a~Af5Fϻ@EzCN-#Ua3`teL	$:d.²WYf>d7?R$Ozw^Jd\Oџ)۪BAiW4*LI,ษg5ϳZ(N%#*e_˝텁k(4=&͡<}X5-}W\=sa'[ԊTa6$9aA1)xAT-TYJNŻ)T5Ls5p=aړB_v?d?V.IBv\1Mxp35{XiOl~k粬/zWZb%Y
^m˽'g#n-̯q/Ow_S)ьf-ֻY}tZ(?V,G^ΪBe^xAQ"XXًx\xr{Y	|oe~b'{4Fygq8{Mt^Pփ9NuJߩ-YسzX$LvխJ/oJ6xGkǃ4zqX8hNMu]TvPA
qpk9Q6sG7l|UOܰ8)NCAߍq  9
O!4\B'1 B#2'7| jwiv1gᾢHފIqqp R>abfu}v\¸)<SG!FbM/ŊtM8qi&:#/-k\yYc^yA}PicoKOg~Js)4jnF.860ub횿us§Q'[9dt>;Gvs-;yelS`9'bnf	F*@H!<f5h_/*&KJ)7ZO4M~&[S:R2	L@Rd"]>wI@~Q4`#w71V
ȭͣ!ܬͶeCU80E@zS"H9//φ&a_K50}}̚D<n7r71).,Ӥ"eg7*s}[P)59]K0.P#9X숨`3qȶF#9fTRlwi
[Y
׬Yc_.dj؇</nn:<MOlnbҙ)KW7 UV䟮lnzX~ C)!V(:t$ 5a2Ϛk7*-SZIf>VA}B#JDK5>]z]Šơh=CmRMhqgz(E<8wӔ1B̭)eduӖmx}e*he+N_N8&I{fJrcFQֈ͢h2$%:MZ$sys]z^6O	符qo;BȷSe{VBGkm8?2(5\q8P>GU<gS!tz_Ɇp|B9NSF?d
si0 qP>ƾⳄ&*Tw!T,R*yya|GYt{#lfx~)|Kxww]<Gxh:FuzW>Nn8+ltզ#L@)X .!^ʆ`h_XAF+قߓP羛A		εf&_XΎL6R#t_T&#]Hr.^-|1>E+. B_`|>=YZ̖cD$S1Gknq,Wf5@ᄋ=꺍ǅQ,	򤕗R><7<gg\G'B 
ŹRj=Zu+tv5lDj.||e]ͰGmw-3[VJVXPα	{DD28쌙\]g
%EykfFż{r̕ÂaqI\X]p\V#	{l\[Ʒ4,=nefBMd⃫\QJ\vdvSdb2SH(!1.8 q <&|3OF1=llSv؏1	l8걫lb]#a_c R!O<	s۠`/xܳZIQb+AP2yq1kmr[H/PL5ȗCP4W?1|	;;^ES,ruzdSLRJQݥzU*eKdj|&Z4\1+Pצz*wU(:zbpxAu!耋ӦYmB_^z,+5sN,[g<POygSȤmf4BY8SwwUUT2FKts3}iQޱܲq .ZY滀K#eߧqHҮ16gtBkFk>hv0`I*3j?g:aq6"Wyoze_F&N=2F%]KRaa2Һ|<qRL橐ʹ::4O(u>")_Ƃ8Id,WOj&Rȡ"&Q{gbvXy\ꢬx %͍,<wg\98cƙV~/LwCL˙nֵ="g_Uo+M0ly>.R&}Y(sӶ'l0Va-3_TJÙa;c
8[h =93M{>Tg'"WD*Aכ.ղ۷&k\ynZ-֍naһܰXƍKtnJUW2i-ד.	[H'@A6" Ame[dPrj~mGϴ4(K[gsY23&Uۦ2zxP˨&zxI`cŎ]8痋[<TqʠW~F}]&gk#rUO|Y=WvǷEz5QɎ`PL#9[Z4NrF`0EFzwx^W|uEzVP6p%JAr;@ Yɮ:N8X;gR~nRS'&:h|HS4oa<='39Vi,3wV\|,}/ ],V%2_^dmzӑEaO'XHRLs>\foԳ"795.E]CZ5c9G^4rm5">W^I}P3fY]e!!ft؂/_mR6p(amnq7AERz_wN5|Vo'rP\nsxMX !Y*)}DxfqRsj939?xז8B6yu^a&³<_8ܲad..D
?L[Tda^}&WPޑkɎk0sM'e8@)!$jB?Ci7v~!Y<~3q8;1'á7Ù7ɕŸqVPkro:mSϡ[^%,? z
56(3}?@Y4YK9:Gz]	j⊗v_6u]}%x((w=8RWsܙ,T2%Tѫݶ{E!&P7	ݪ<y!^ĿY1/AsS[m1hP)f7	xH!cZUv~7[4 Cj~,s"r_ísk\R/Lׯ^~IaIOoegT1}3s= *aps`0U^>ʏAkU]Z2|JF3dlx+q$)|.5&jbo岭IJ}i (	I)oʼZ9:ZoӘ\lwtߴ]ݵg?".SwcԼ`V*kSKڕ$Ҍ
>N[1EQɫs"v$5=ojIYjNmwM0{="˱0P>s	ǧ}bfG|N!h͞RJx(+&|lr-Ⲛz*E2˓F9/_dv5>	,a+:f?Bn;+_͑pcX 
Z5	s|9y;k[߼F|(ݽ/~	$lu^LbI-gYNw<[oF|zތۆu2K;%;f6EbgH Cl*xM҅fhpEQڐnp)Et2O9,^Gp[9//DY#P
iᤧ E'|ef,ՐZ"34zM)^Ѿ%`q;h?bs^Uy 	ϪR@&mJPrg3XqWB87KV UԟŇ/9owgjƺ-u5bKy79O24cB=F>wO*0Ԡ6ٻPy$r_;[Aufdj o}ӄ~EȌ1l[*Eܧm/F4AqOD_P><CPzB0]tPV|+i4Iȣw죿SYh%m.c2OE'(|^M^*żbnV 6irs^
脅\7W,7+ 7|^7BVdIE.r 9r h=ϵst1!2(s
!|uVqMpg_?DE|[% \DͳJtB<g(s(8+Xmôk\s/Ci6\kuL陊/u6)B*9Q+W2IB+.Fb4dyEw^1L#5-2۩]FӐ:,Z \irV6xFH\nP:|~7Foj}T~i+I#
>u#9˙G~]*E ^CAYhqUj1)uFRa%oª!V_ت!VIRK<#*&X1JA)&/覒ea%ZzGX.o;~\Rtpk70d0,bږTt4o= 粙x[LS[4E9xk^Klz?g\P.E]e|?g+`i/JKn\[VgJƶV$ɍo	3#.]Lcr無84mLX]Vz;fxl=s[oZ#-7̌1^	AԧdoElC4q}UZ 7=P%T(tOaP}0ּN]ؚUpUjQ]=[-טN$j%%o|d|{)'ٷeFWbb%sV?{93BY(oYuf#/9^o cpNۤ?9 I8WZq|~{Lz[b0 M)&=\n.}Bv	dhdc]#60Y F~]]ۓe) JK\R^}9&M+zkbDNQq>t0]RO70~J
FaL`r)e;]CQ'>lz{IO;_Dz"U<b׽O8Ga舯Ž·CI*F[ P =5zl  iō|թQ,[N-W'Vm	."_L橐[I_yhC{kDŢ܏&	qЧWQ{8TլIpOJNb釋M./7^y %v˗	e]B$Z+i_eyom&﮽h<.ZߛN8c3mw:A!
!٬B G!hK3	U.qBa1wΊƋ/Ff_2፝/[4嶪Q^[+44zϹ-VQ:3|n-ÛP9|Ч=|yEh1B!J.b-˫ !I-0UMYOB0u?-,4,$,vt348af7WB!D9$lT\M>!
&ÿjeoV?_o 'R4*߂]|
Rw%I=in3Vva_LpHvml	b'm(p`C6R`ac\loٻwj>(S8L0wV?pwdA[NgbC6Y8[:!@e~MȤ׃$/݂B6{=,+yZV{WWnEЦwN/>:p'qlӡ6KUoki7uoJ}!|2gWǲYX!摂2
B=maF̓?or[hh8;*ZWѓfYکj6bg#X$:2*5u6mq/ˑNt{5G\.σmyHfPJc9u^ǷjW
ԴѰ@P\H c4MF.:>	L#5bŜ RIKzj
w[0藴+;hd^(u}qji%=~tBZ	d]M%40VaDKtDnF|;lB;$Q0!$WyKNcO|_U<v7X2vc}m|1A(+2;!o-<{3͂

Hmdo?_ȭwtwwS IE*6A_ꨣbzH2GiD<RvB
LͶ6Oxɒ~)CN;hDK:GǾ8O@׏%;sp>>>!{pf~aD'q4IG GH&$>xq{xߏhڍEMCDr'g$E+s|9sp]><;?zqK&GF	C h')9OJ]h'ݔ4tt'b_`_NFQ1>VszZpeekYf}"#Wħ71EC:lQD@DC[ Ek5?=^p^&,9slD羛AUKű iŰ0fj)㡥wR=FceJV5j鶛7JP9PM#ڡ>'Ҁpu\;G
?B7ךwO7Vc)_׫V0[J}u1A
MGv</(%-g!
mLu>#FAFCÈ0a%I4"8/8DņApdq}~gZԫz%+ _x<Hb=/1@]m
LO,H8t<nkz%8
g9V1kJݵD)P3)Sd/+J'@݁KY29!j繑5=emүh'GG$h8Ӫj>'aϨ/Tngb=/!<¦B,E۫'RDRv̬1-74љ?pƸ0 !|tɁO}o8$=yAZu=o=|gv Fa}ro{[|"Lg
 Jkw.'Wd%Q4kPʠrD!j?!.rJ/=Ht& H3S/mB;Zmf17W\[kwZUW69ܬ0i-L6p47?0)A|8bS/Nfh& >"+H/"p3sp|m2OolS\{>$H`oij3r7?d1Ir2`sO)0~R)w;zb8~Ľf@''R@5E~\JxG^48Fnb7٫yi$S	)9dc%G'*5\b~Z,/kvF3GlljV+zɴ9T5|>ŗp3,.ouy? fIkr
 &ɐߙs|ˬ9=Na fE}<uYU|3?t㿱l_ލ[yǿ1zܜ~JݼyEdu^;Y?M6.a<YdX 9Fq08T_A}d]ZqNazsy37GqD4ޏM{3A+Q_g#ɍѼLF/&sʃb\0ia7UwɝF180P'b6-1JUeE!pzu̒N7g[mn屈8D+csfY{?F'(ݓϽځjeAw<!8WYs_m˽'=plUg/7{{;/_>/vzRv֌3
f־"V5[JajbǗ{fҫ{$!K53g==$MJzޚn=lY7<uF[`|'Va4:e#LlZN3MϺ~1?+7+ ,0ee<ZxMAu
ePumvb2$z(&(pJ]o4
]+̿(Na)on2OXk[yf/H2hXt ~&
뽭<h
 (][搃~wQĮK/7xKuf_K~K
ܶԼ}MZ{Lfh';/_<Ǐcd~~.l#/<K?@˨MQuo|"cMF;_j{Cmu2387ACP9y"+؂חeehC\&Y-*zQȁǡ7Gv聳V7߹q;)F=znkDM;FeFI*L?=ltw69]퇭r*TvcZ#qD7u>${s'?t5Yky[y2DyzviѐkF]G^9ȥkW֋յ<蓅r$勞3a^]FWWnNպqM7\,nqwvBw\
g!ϽP{n?Y̀\1W@ndJx x|6&e/-FHJey(7f.s}vC^g:fkMnnVG~ӫ?@
{U?>@z4SO^zUJt?¤= J^4P骒F	\zғGӡyN5E@?`e'sQ%o?iȸ' U #{GONsX|&9`Α7
lQ27<d5W͗ihśQ3cya,O9M̖Mx1c@`GPa&Fi
ɿ:<J*sMuORtyG=7Qi6Õ*)ΔPON8>_|2:ެptn[012C&>[n0]Wao4_w 8ÔvZV@ LFwu0!7ȾU*_/zyE k-wNƪ@82ko[o*=ֳڂ׻G| ,n ͂4jkUNnt*oڌs"L#bK4 BL>[ ګj 6 4	i 6G!H!ߪ⸔KSBVlF\:;oqN,!c`e`MւW4Y2Cp?hL{	\r<2ފ(%
`JAih#=ݚl(_[z hx\hҀG0nl9:|Ks%:rOD-%4Qs`/':ӚsѧkF`"hN0څ H13?6hQt<?8W0AwboLgZy?sf7,n@h
!F_{!(p1tvV 85A;+>,OY+a(bXϻff(*d$4m$̚Pi=̐k+?Q/o*P/ 8e!Oc<WQz_ApuM&PcTA}m_Ur17Uua4@<vm۬q]X\ow6Vݵ溨u[T59O[j3OnL$_j]Zuw96"殃jx5Xg=C4A>$OmvW	fm8o4I$C4:ft7jk3hPgvv mᬹkUuQ_o8um9<Vh;l9wgˡԔįՆA;T]LDZ_ 5-,P0]븠hݵ!btg{/Q;N6:mt7n_8(l3hZm0*4YZ
5Kelm6@i4 P?V[׫Φ\ot@vAu։'`;k4v5Zwu먵v:Nsv6NVn].-^]k \&tѴZbfrƺ@?vE2ZtMnݛ}g[CokSZZrۀ
eh@֠@l5~]%w7:hDn8OuDn[*TvĳF?/.r*tzXwk-P+mgy;hTWdv6ijrݯ~p?,{ڏf;hǏHa<5*0/45 fāBFӔ;/Wei摒_F#`МC#g'q	l0ȘR	k^81V֚==D|QBׂă/5ONß|/^x88~4>il9{*MljMQ+/͠w/}.vPNNvg=C/9T@91.&nUajYxZZƠx):*WZ0:<X
Őߴ<q00au碃aR=w%SLɿ//)Їe]1OO|v˱gJ^R[K^ (i$d?̋mwUrYf!K(s,'gd5)K֙0v!9+eT\5 !h*]K(9"Ow2,MO\;wa0@ݚw(#sG:Sg'[38a^nf\j^.Cq$ZZكӏ,1 i2~˪؀s$ywTwe@h\;൮,FAp{0b+{Fau8ÅzV<t?>}Woݤ\V/?sAI1JaM5Z.9[R]R m5@֔eefUf+[jj/cZZUYDNƣVb*QE_a{@zEBdYƙAT9Px*g>&.T+SW?*c*l }J"K
9meqΚr8Nжh릑$0VOCjMQγ>i"BV}?M{,o-]#ߊw\nL9IIb5J44)j\F,%m7Ec՟BO8/a9pzPWkzF!96&/Ȇ)BGQJ/+79N5d.ęg-IRGK?Kjגz _&~of?F PIpb]6ϰ8@x~w6fC\C?˼.ۓ#$5Ȥﳮ
aL}oC"M6M_i'TT᧱ 1!zXÌ#.O'L!#lV|D mJXb >B/d	=ia`TR	ĵ;bFO Kt(}L3 ?A!	QW1JrK\ VV诿iX}N=
_e d#٫_%e٧Q8Oi2J5zgtHH9ϖnRM}+&T:6@ Qu)+fi\|O)$49WpXs
IOJ܉iEJ '=U眗CN}acc	}Y5djn:K]dpxt$f[Qq/м0UUd[b`A%scW1
(:~1]
zSk~>`޿ί桗/zip>u}*b+@esL<8\0B!CXC%~<Ȳqox|&0JY2"}W[e劭&"x+%+FE}%'"Lj(tɷ!<Eה<	&xhm1`֑ٙ8SNP$0w4U2E&J	H%od_dsJqm)H_tnä"n'lAfNͼS/za&GRMw0,î5\kb%ŵ8P`fY$:bΫM gw^0'͛[tj+5H7DMcv|al&,&2Atd-ytk1a}´2Cդ#$Cn/xps虳./sׄ\bz(PA3%;ORпfD7ظYe\v'i[w(OqYT=ж?:f67i6N=ȔI߆epC0WA~{$_!k6䙆bOG~]Pt:á~`歯|m;v!<[;G\mnxҕ^l6>9֟9Bc\H10@~ 3.o ϴ9J>qLqz  RݐYí~i s8F΁xpsW_aaN̆y6ç|㷷>Le|^),eM{J2b	KdWE%|$<	A	xkDSaM>+y$'ꘇx0
Lxp Yo6!a'q1Vw*DtTQX:E6&a-<g\h9؀O`;F<an#'Oxb6iLªhFԻ]yX|> rű#\.W"(Ms3G̀۬d2@\1N`4Fj-B#IATd5>S4D`}mZE%ibh!$A&r	>Dć:ulY#EX`x'L(V^|^?`!S?#p1@|]˙2[2f4ʎjh;(2h"̔x܇B<jP$4>#6k2`2F󽓃YԷ,!@܈q0}
Ih=#]\"Eݜ}3޸r66II?,(-,!Qx\YB(1'l)'blvﴣ k,h *X5jFVաZ3lw_"SBj%&dQ"1op>d4bp:Uz`AF	,DQ[r6+H8yMV*ʺ5ۺŉcv95o!muOZRGՖ-%Y~;~&C܉φq6:ҩ&=_lR!x:3MIY@`*WcY2eǠÑFpK`bBFB\E| Cq!7p<<}Ca2xvv~@UoR=;\o©t^,9
0v?1ɤ߇8fM#p!I<Qr~V5rО7bzJ.(ZB[(hL] ']ҳr/L6_a8C8.;;p*fWn>.}OTOnM^{_ǆYe٪Y+q^.8m+O0z.KYHiih)v\.D71%OB/ɸV`"/hX FiK)Ɖ18&$a~8eXw\C6U=|H1/T6pfc1OE`OQ_Ș.8,k kg!/?n.kSN9_]4B:u)>}"Ţ̫Q]RVU3\,e24g4@2|~PÌݻA)NYv1gᄶ,k
#^C7C/}#-+fnߍ5hv3J{ _(yQc0`8"I	9>8k[Mh-(GX=xR[.Ńs\bNd;[5"~N%BϚ88~qaPHpP/EH]^Q?"]yR.c.Xolj:6<ʡJa#Yhs1whISb\pVA.䮋!w6mStA{YY̨235۰bD
.jz+ٱof2	;'Q,Stܳy(7K2iu,,0,8ؓp6In{ۮORB QމiFOI -:ܴhΈ+&E":i&&1҅/_0034`ۭ__W98҄XYcX+ ~7A@&da/ O҃<PcU:CG*oW^B̴ݪl%I__4O~kn㿻msV}/}ց
76^sUB"|TǴWap5i|~L+0eq<ܸ!)gJvԎ`TJ VY2Op]Ȕ/>ka8LLAD)b"7\Ŭ8*D9_z-B7\>G.Vp Q|de0;o&|i4.bBsqp8X<O`6p{eCsȒ@]H.cdvbsņ~_ӳJ."o ĩL>R1E1v@VPb D؏FCP*Y9O?~Vix%%lh-AVY/h$<>Cm!ǮdǞO/	2eW;yvL6^fE8d|Lr*}JeR%*fб\ !
\;DB5$<4A;²p!tNDeA  ?A췇>;a?1n
p62 ^Q5
d`$>zzW@  ;Gn|lEq_7ij`׸Z!q0ǽ7_oW*5#bklFR|m
U R.B"zDn<c9ۀdA >p,RYBxAk1 08@8 Ȟ$5ty.'jRGd<%>2Wgcj43V0UNC\'L `i\&s=w[oa N 