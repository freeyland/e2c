#!/bin/bash

declare -r e2c_version="0.2.18"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.e2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80 and 443 availability check....................................  "
    e2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
        fi
    fi
    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.e2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rG(8[_,A̺@E	A	Ӽ5@@ͪRf@y:{v=f؇]udDfd] Qypw֠j4.^~k^鶛lZ/IŀQ8/IɎfPOѧۿm6.ja4xǟoNsyqQo7{wV.jH+ݵm\h}B
k۸ 04<o7]i0~2NgV^gPʮoo|nyQOc?
*
~'o0{/_oܵm\F_w5ou{7[`G<aS&؀}o~:~N5X3/<gQzǕ/Q0c?Mi?>ј'ABiX&)\K|v>! )H4P<w+a"+q{MOF^~.=6&f!GL_K/:n3n@(`pBD" Yxݗׄ9|2:OFP@8$DI
t`n'c4\g!í:%7[J7/~4ny}j[7;a:ozoR}W*.YusQ7.:Ag1/?1!Hxw^h⦣_݁Q0ӽ^P&	B,×I;ӪH?/$)p˘[zf>nջq}qvR	o0Wxz譗e's|V}h4i7ǯpOq0-vn4G!KNh(/0M{1=Y9
*?߉"vapl_vVU;nZ˧G^⁑n@N{K;M[IUV K %@LL Lޱwx_*m¬M	d@	d@
 ov$lVcDR` K69֪Z{9b-e]v
Lm${}o>V똗
F9\κGZk=CKsXϫqU3u\Z뒓9N}Eg IΠ*&)S)b=dc;Rt*FSPrNk`Q.(7\5!J
J\O=9d_d(0a^ǝW/^XĲZHjokv_"q$:t+Ց>H.O確%+JCir%}1Y0rA}	`4r"xǏOϢ>A&9rw_nqZPbE Ķ¼Lo`̩7
c4+AD&:/]Ѩkn_i8q׼վ}־ƹJmfeOqۤ"}iJW:8sՆSƜ7yHNxa\ZI|}ʓ [U&J|h(RH!"l!msYi<:xɲi 
"#=xW3h ځ?-|J{4.[+0tk%G`Mc#T3s!6IT; }!/3~`獢:GAt s1GުS۽<X"pWpF]NF/m>?xllQcbp*V\ތ 7لo}DT9R#H,kLT].xI^|'ɛƻK>qnHr"}L'<Nf|V "TU@`VW>ST&M&@|I9TmZ5}͚5%~dPtf"E~_T$cx*$fu	s2|lZgI0sr|%FD&]Λ	*X*[>/^^>aBc~o2 ϡs}(<_d/2?{}iv?Ȟ?{;w3_(筽?ˌPܜ[-?SYͶ~ճ? ' /`(uY찛UIgJ>9eSSڦ2d3e!Fi7N/ mr22sbmTC_U$:%Jx^|Ӡc !@<FyC|]1q)ݷsOӽ Q.ψ*%3?[͈z[EV#	n9G@Lgxx**MCE/+CDz&>8,d3r0FmaI<Ss|[@g</HeI`MgYxK|hV-A TWԘ٫2grk^=Fal~yjSLKM]>Ҳw҈6Y.#t _ʩa4f@ك6 2ˊ_b 7 98Nz>r=vk0YD_BucbNcR	.ƪ
SAOC9{ӭ?ShW?[OMCgIΓ;{oػͿ~_REHf@syKz1H^d|S$xD2,I1iVNkW3Wzz[f+P6W_ba	-($?Ҷ.K%$Wh^(mSp 
׳7=ȓ}uΎPƌOFؾZBR.\Y:qM>V|~Ͼܯ{c;f= aB"j(:v{Ҟiy4TN`	.lBOF@i0x_7/ricd]ex19]d5߇YȼxJVo^.ۛbڇͽ`҇z-Ib=aR9LEôǻMaiR缕q&\Fthļ h_#TQ7;W띞i[%4OOwHM|E5nEmI%*$ŞSK.APz@L$]8PbG9*U7!2L ܓw	?(*P!o!\7k:/v)u:^$Ns46Ү<L`<,*5Eky^l˘jsvGA
sF'(L)B&mA.6'~H7
Jm2a{tMhR\UTX/z
^5y)*__
_^d]MAk+KiY.Ɓ2
Y`yeZER9kcB'1ҊдW·t-$![fI-KvzQ+a01 -5MeB L%V1DMq |{Po%e?_WriBX4e1^R+qӔ]6twT.ɪInꨴJj&U&]<YT*fDAhDYBfCCk cGgA/
C͉`1)l%MpxT(cM=]e6h,6+>=#W5ߕ-l^ 7cp6Zy]TvZ+uh2]72-,!`Ee"hCSŕ8zl=۴8>E	Szyi.`NqGăi]Ɓ	GyYhe8A!0ʃm2(CȒ$l5A}|y9h_Jߧ%/$qŰsҡz8i.E]4^ZnSViʶ_
de䟧U{5_+՚^^p΁ַ-ucɟoaMՑ=ZasP]ꅪcUld_7yVsjIΛDane4&-vLGH,{#vT1ܠD(3 )[L^uD%rB>aiߢ-tE,7$*([!J1[
n;P;,PVr7*h͠YHAYwu," ,=z!۰ $Ddd.U{њ)Bb<T6{M,/ĉh]g0??eC;'yʤN읹Az2=´	I)
z҉Teg!Lw(#ŃtGaDOC,2g-I9\up2BIܺ)
sscsRMS4뤑{_cXA"1ɂ,УBWšIr;o0Lcǭi%߳}eB7@ih:C?	OK	i<7Pna,C=,I/-Cf5uUavugf3lspiĪͨ,7gGͲlbА1XzimU[/>^HSTg-0hM<5,ÜU	rRghNRʝ
ٵ7*ojySɸ5#mgI6#4T+cX^m8ZBUHw@J̦e9>**>P&		3RG9<HF>mUARqd)zok(L
#G
|?ΐ	d;bpzPnKl*[Q<B$S^qQфiIJ\TmGZ6qD*YPPJ$&i%fK[2Lå39DjvJ	WO"fg	<*,g}
|Ƒp2U6+_-NYT
q8k"fxy2Ļ56wYC߳{&-M#|l[?FI0 ƣE2+g~ݿ	HgRۼ!sʏb|[?buG߮A~{\\[ϥEgY9!{ۗCghiKs^DSfle0Pìcط!o(Q ىw^a%gRxKxVA[ >=
`=Ct*S3p`S mꙦId5BnfA2u'Ar N
˩E.м[y~,HOiʎ#rV
Z)Gz~Ppqn`ލa{IW]G{8e!u1rA3(|ė&c,C>荵4VKܑRx7zS<@]x
Q!5:29(-@
\#|e}pV%EVYb%|ሷ,8Foi'7kRDMIbjm?zZOx#7Ȧ	ė_NӰ!/BW veq~C cSvT;L%Ɉi`:iLla%+N6(kk$a?H%YBxoBj(1|caOSPy(d)Yda)Pҏ iL4%081=v7$Ijv7-&nhnlhڟFie'tvhM ?=??-?y@7y):EpX"ź.dkᡁ_@O4OڣA="BE4z'"%]=+Y2E
Hơʛi˛i;,E"ːEd
AoHD!oHD!oؑo,E"ːEd
Eq;让bp@muuSwuVwR*I	
-TZ
@@S%i%i${JwMuW(&^썱G:j $_YH	MGFLۄ&̝sŒ(QLA64G}2QOi_
)P~zZqdѤ_U+K=b^j	NTg	9g<1m=:u(	k\׭G2 =z!qJPR`/<+*HuK@ab5I@@ޚ^f@?
^Rl\ț.@6\&zrVHkfUDr!O.1ST/[|OWX$x#'fƞ6pS$ҽpt
]hPNT@{y,+ܗŬ$(j%fw,̅ݕe x:byjT[e߭π{_=!jE͵W*;wlKge[b)طʺڶ5ט\䞯ĸRR-:!b(֕.-MٕCs&ӕ1Z
#
]oX3$.
o8V:X
-a	5%X#u0.rWb܂cP%'PM0w`
:,[([9
-a?k/Y\밇uqXda1zzG֠Ÿ(S*lƠ,NM芫Z1wbZ4_XJqqZo=ݵXDcv݀R,[][_{yGfqm%OV/b~v.?뛿j9ƶkoGhw}v^?*1K\(@itvx27DyA;(%gK{<az]!TnX0-\h0;~KhVʳr~aN}t[m[XeM&іDM^,x+k((g`&`{4Eg~Ҩ]hCz6pn&2Vf~Xp40A4I--[aEVEpRb+Lp3i%ZLFӡ,UkkeXʄm9+\.챧@me2&?۫lLTܜb/Q}#5PXCt<As-$r	2<נ>#5^ޙ95bf8CQ-V	VM;XG~YMcʳ~9YUyCR)B^9¤5kkt<ma|6MԭKbdhmqP6ĬJ[m[Qf<F+fvYoPJ'Uxa+@Ϗ	ן/jI|k(xSr*M$.νq9wW6=6oyPVNM}[l#-h{:ƢQS.7,B/n-(UK
/\P޲PW6ne?Q@-'	E˘@Y|
>EU)<`qAUFODAX`$$ZB*pif.#)wh'/qt@|'?Ki3WYf>d7?P$Ow&=<%B}6mUk 4DՋppKIษg5/2[(HW~}?tjïGA@J%B螿r~b>|얾+힎q9zǰ-jE*3Nԋ49aA>)xAT-TIJŻ)Tuk@Þ>0T9{tIBgZ(HݔNm:3>՟֫w.rB;{9&^E?{lωz?!Q'i|dwo埑Ѭqn^f]r OgeˑW̶ʳPgGe,¡sHVz#/<Wj9zZ&kɷ_<ɞ!Ql_^</)hY>̮8/)^d&Ԅ`iSQTV,YY,c;Vp{A%XW%v<ã5A@B=	$@lXQ FKz躮{uPGΗ	rl犏XH^l0\' YwVU3a(?\  GE+^Q4& hk( )hd|Y|C27E[[vlyk׏`,b_wRll~]N.˧QQ5u(H,i֠Xô&':-Dge i27C)K"r,ʷ;O2hN
2m~/Ci=CZ%^hbEfk'ⵓVk}/{DI&KG'9bPmsDa/8+Tts0L1B?kc^5bR,IP	4F˩<	od_UUـ1ToHϝt)8l{&Z y47kmc.O|kzNH$Ps_Wky_چ&@K]l5tY	K a-5y4ooŘ8ҒnNR;aj'(ɆilN9V`U佟*6'MM6 [䜚Lrm6-Zz}͚5%"O6XF{
Rڋ4MTo<]AgzX.IGu T9[%#䚻e<b;bA<S&B*Qcet$ 5a2g<`-ߴZͺ/&ЛoVA}L=JD+5^]x]ŠơsfCuRU}PT0i3&'n2Y7)ܺ^f%/mٶ
[A	:WkUeleYӹ/'&I[ŶubǜbQֈ͢h2Uci StT!I@vysMz+lZ	VMu^wkogldOR/'X4%ek]q,;pCIz~ `Sp1NWqsU:bYL(ⵀ;0gp#SN!>Ŋ:PF܅PRK§a&F8}:|R፽yg"+xx~3t0	ʂzW>Nc!5qV.N	G0S8H[35@\W	7!^F`h_XA+قi(s͠Q	`Zq2O,Oyt)[=K!N>Gi̵OQsJ.ir6%=(	zT<BDzz+)fJkGf&q>h8bnQ4`d9i<i!>5U\	ErGAJpŹRj=:;Ye">x2fökuԭeH%,C(؄=h"FURfcB>mWM(o!Jlt\̳'Wkyx\9,8gX.nWlj2rPIC\Qz,t8`1_e`A -u*#7*.Wlf$/ҏWZװ#@#$BFD	p{	e 1->adcjqεљ&? uG=vZ.<-uzXWxá X$3@7\~<0
V=d$,+Üǰ[w88)%"2Hg&Gqcd*x?M(A*b`*S#TU$Ze&Rj讬i_էZVI,["3c5\ФB\`r@VeV j o5օh.2_H#O^j+ǂ]#5gl3Bb?abЯN
=!FV4y:5e>ZO@fCN䖵։;pIkXmxWn@aԃQ}@P"Y4F󜆷S"pͺht:,IEzHG7,fI"oX.ę[ZfRk	NY5,"L'VZ1N"r)SC*Mo_I%I"9%gl8{R6_~gB'1َ
;谦Re_<8672y67o6z*N^E3^3ݼczeX>,r߆W`4-|\MܳPVWm+㫲>9e
Cna80IET.k2_a}l=X-Ϭ8Hn.dӞ"Ն9感`@ݾlޔHy=zrZ6vxs6+M5eܺ-zuܸziM	z.doDdEC3#5	P@P?!S<l+vJWïLqLu8G/Lc*Rd嶁J뱌d]MKvVt{X_\,[^:3=ĩV7ReKK86"Wuėseo|KWu%,[Y4IrkQ6Q0|uEVP'e~xY% ~j9ÍD('@VsZV[EGDAV;g9RxnLS#&\#t9ܑ8g8+0xzwOfT{sӪZzcL<4w&\||B D,V92W^diz"[MGw%Û
m/R*s<}FwSդH98׿aSR#uZ3H{MM#f#sU!ݯqxӬhft؁/lR21p(v
6VnqWA"^.Rr_sN5|VGO\>@kh
_>ϜM;k:-E*XZ[jKP#d<0@&2s#-o-mRmek{\A@y?%e^7\,J	!i&J.-N؛z虖wc@"of6L39tμI>G.Ǎ\{fϸ*'C~Iub)b6W	4B?=BM}z9殟#\,U_y#xP=(5qK;.غ6>c<R6;tE)`|ܹ,T2VK[G+5*6:@>uNPU}f0Sv$EI'(0֖9*%YۦK"DĘVۍ|>2HP`<VDCnqkxu.ۡ77Kʅa(S=<,)ԷX:UR2#d%S0q]95`-|
[A+*pQ)W6Ydt&CO'?^C#Iwq5V-V]x1ߞ~! J"RZremmN۷ih\wѸo.ٳh\?VY* {ĚjRe5ݺ85U8s*#(XK.|kuڢiK`rW'7DP I:c{k{F5ɜtMr6!e45!Xmr1W&,Oe	Z'F#֓Rv{hܗ>blpS߾S)YP7XR]|B3[ts!k];StYNWHuz2&yUf
i#GcH*vh$*/(<`W<xO@VWT*6D{~d}'mħ/hr0NRB_iBP]dLѦ@/@,
^Btag4Ƭ(m_72|'G]u|M.RJ-Z|z"A/|bD8ktQe	o֐Z"34zM놸)>/P`q;h?bLsNUygRl@&mFLr_+,Y58TQ.Ë~͓vYGid b4koμqW' 8
ȃ,:|T`A[CmNtI,?"Oo 9'b40Tx@^.{#D!tShω'7!	w#}x.ޫC{Jbw頤	7T;"VTxCGw2P5K7<SobIG2GEX)^U^*bnV 65WC҅1YtLeRw˻c+9{:[_	^E'Yie$T''sӁӁYj]?t`Fҁ{΀lˠ)W8lk;C$]0%BD?<t% ɜD-2KtB39Cr9/mݴsr/CiѳF6tՅ2f׻\ŗZۅ{yV
+$O^d=Bi+nRýH_1.*0fV{`e~;hVB+@_S>1F]MѼϽq\yu#9ә5T
	 x5$V9E8 X  f;8
[fUJUSI1\|bW5qUCT-O_DkFn3F8y61\TR"DAKCx4ϥѭиÏg+.8%YFqJ,x	#P	3-y!mI/OuAI3֓	p,%?G΢EAe[r1ɉDCɅ?^$_&y;[Y$K=|TZr"(8ʗVҠз§Ik=Op \@Xn41&wN
9nD\k=3hf+y`!FkRG$ZoB]<0%bϲtoEl}4
qUZ3=P%>#Pџ°]ew/֬bZ)^k9tBKVRH40>*L'Ǳ71}m[*,K2ihuؘgQ.pGkGyWUٛj1 VA;atMSO(tc˟᧧ˤ@>/zi`8khJ(ps#JK KF#,(
&0:$vێbwylO柉&_ gHV^eBR0&3h=8&nI# >Kat	XV}q)]5֩Ht0'o&o9כ_x/}"U8bOΓ8 GӐaŹCFI)%[ P =1zh  Yŉ|թqԼ%N7k{ZF:0D4(&$T~ڙ"":n%Wʀ[$=NT(hG!\ڪF9œ^'#YOq1|ɥ1w'oN<ar@lChW|&W?m$=>~~*ϭ<ٵ{xE+4.#<wyg5X!b \ }%Q<\BKnЂpjgxƃ/Fb_3ፍ[>T嶊Q^F[+44z)AϹ-ΝVQ/Z:uF2MuW[1'sb?OI)zyعb^uF!(
K庈᯷,?Dd|^1Fgc1[D0_d&A_Ϙh;q
ͩo.BrBIO٨|@eLa3(x}UߖMhQ%$/U/IMk*J0&8$;|6	b'6k8!)1UIM;5[ B&Yl{K@QAz?8w; \-gq"@,\i&dAnA3R?<l-ZR=ګ+_E˾p5׹򁘇b$`m2(hXEƚ?3 }v_y_e,,yHA}bdt[Qa`Mn-^"xyg6WE)3=ivF|l_?*vF=I~_-@H\K,#"n[Z`[;;n]t={ԭz"ؖG,B4"B=7D7yjLծ*iYQ*OpW/d䱏\ɳ2}Zw"K	"U|$057[t	\q<~I랷
n-Ƨ[^vCN!Wߊ{*.MXXYƈt5{<D0s+vq4J;$:0Gޒ;3عfwQfؾX/v_5o>K -;! 
߹8^/鮐@Xµ(ǰx=;*dE"@|$T#7kѶNUOۓX}LoRÑe,x[;0L1Ͷ6OxRFeh%hxv7/#<evpdW7p;ak IB>glτ0y< [F\g8ߏhڍX!L5I(ss~eeho);q H,kR]292H"!Et2My:VZ-B=),!ӝgqQ5Co'7JOjt_|q'8)@jJYidP.Ie9_o8fPآP">/ȷjj>1`H=qQ&,96sߍƠF㪥oXlXjL?,rш̻PF2_qfunnֽyT'~Q~}I:Hvt4\Z/
v6.)'(
56BgoG)m~_Ͻzs0qjJ/Zb ;GyP_ȥOZ\V*G 
m0ta8	Bh:Bp"_phje>R,Wǣ#MChrا]'9Ypd~Yptɂ<JqBϼsI1l,kb*$Ĥƃ56&@ϤL=ȕ ubyh_Lԏ礄3#iz>)K$_`O`bWIpf=#`Ϩ-Tng'b9!aS~OG-Kv >Hxڎ!FsBɽ(:g&$d79Cѩc(7MO*g^Fkml@@g[*yYyxcIgaJ>ys?~YYf3iD+B(Y~XePIDZoG5)h%с2
*Kd--iA LsfNn7+L.&|k8ğC CwF)/Nfhfj|R&p@G{F@o 
8o496[w%WO_جg4tQ^AHkr# J/7GIŤ&ɀ9?&=JQnwhO v8Ni>wdOq7qVyEVEd2v楃 O!v'xOA^)&Q|pbr[_̍5̓gmhw6.ɪm[TdDM\N-LΡ"dWNLq0~-%[}ܿեA^1ʀ$#~ho=hY<YxC5dUVWslgm\YT=Sn6zqh 64>!q=}v}ϛNm_4xcdY 9J~0<T rF2/z8r0}ͻf\FQQl7M#u^M)hgZv?KFݫɁnn۸f闓FA1U.4tkN0by=qXHfp(FN1g
񕖿1JyY.pze̓NWuk[,b/c"Sl=~	^={>+I#Jf8svا@w`ΕG d[bq$6[m;}?0뽽?_?V/_>wRv֌~Sf־"V3[Iajūb櫗/\*	|ݽWZ?kUӊoQQW^<{[7nL{;w]flc^m}g%>x7_s?ϩ_y`o6\ Fw'o㚥gM[PejK0ci"ZdAu
 fPumub2$z>+,QZ^>#LYsi+v08WO~\V sRn;V9i/_၏d2h@PM4v`	Wҗ(K,r)!r?lcɺʏ/ЩnK~K
ܶԢm,LZ[Dfh;/?1CKFyMp;k>EBA84jyԭ jޛ.?|FP$o־IA(<rGmuxmCggT0Hcʲ Odi[4t`mux$"^EZGwee}SE9J ٱ8Fsiw\OB8olu[֝w)KFdZ>zjkDN;JeċOK*\?
駵j6:w_x-(5o7ߊUKcV%a"ɾIk r!`/h_۸fKe\.g劆,X[N셐tzq[o-ްA̔[N2j	2:ju]t֝۸TKm$ze̓z{w-]gp$ c<OBRCw76 4~鑳!ޓ7eXa] Iтmao%<<cu^h2&#$2<qO>?M17[rv{[{bO/wCE*<Wo|o:ñz_=q6S#Q'a2WO*ig0=}<zț7r8~Y- (n+À=._	(yIh@(ր>i|B8z2wu5q sq0:d(7)A$ٛ|0?vc>z1Qo/xYHCA|AnUjƃ#BC?<aѸWIeN@;n4?Ij9hg^f9:*M&xV%ř^ԓ?Glo-0鯢':
GFq=2dݵAe{@L1iGh_nu`
D ?讳NA l<`c.xG(Fs^oח̿=jg-:=v[ic}ufAh6{9 z92NtFW>'{w78rpf\oVhv &ێ ڽlnj5׏B
T	Y :mB]bKSopBF+6	ua.ɝ7$'y1]u1X&kY`O,{M	Ii4fY&B)6OL"gprh{OA&?V`c/#<ڻg74!LqF~Y [?6X ǉ}DEΐQMi
dptHF`Yı5Q04'BO}՘|h6iqsŠ;72<t~n7nu4C/T+Q Ce	'ZGM01MJZ~鎍g2Nw6fjnIbG(4G&UzJօΧ7e~'XTNb_BKAyMPc>VQ}6[*jY}Ul*;:]O0!	Z%aq6kt:mw<Qf6hSFcvC&?&aZ|>ֵRp7:,Anc)xKPGQWe(3:O2'JvlM@v;Ψq;uwͶk\g yW#nXg]o}뢾pnrz+:nƆn -rz)s^ N@.D76:<m {Nmtw\P[bt` Q
7:N6:mt8Uo8XfPqy{PeA)T.Un Vzׂac=rEY ڋ'N;Tv5ZumNi>躝A\``-|p	}lAbyzB5c@K[e/.p.~lȧVڱ5v-4Pj!7Ytoވ7-@n/Ԭԃh@֡@Zhg
#wt:PL6pxunlvgۍll'l.rdvXlnڶ yh;T-2F;o5W?֏AM=ᤩ?񣇤?Zl5
0.45 fm@~I~Ph!iրWen摒^F%`p9Fz)O@`!1cl:oy/0Q֚o=_j4_5vHa<c?}2~xf&->d\f;dDj"4Nu6Ka=ѧZcv|PƝ\_ܣ?JLib"VF)m:
XMAxmQ\CotuQYn%<La	C;_b.uros5OY9͇Er~?W_gzv7osu򜀗9Wb[v]\2uQyeyer:#q:NW4^U<d!g`آl$ MAE=z|`ys;VwW'KUZ}[waI0@ݚo(!sG:Sg'#$a^nd\i^«HRqYE1XbDdwU;ѝs$y{To囡\ȣ$Ѥ""w(BkM{Y`(XV/D G<q0PӅ?|/ϗ_f7߽zOHWzJS)<I}!li+1x3KMY=d(Yg^a~
/+M-eapJKEV4m
x\q_X^}F¬<)U
U0`Y(OIi+k/jfUsaà
̈gܿBnN[YSv'H^r4F>ylVkpt~pY4Iq[ɷ	>&!ɁYBWTYF~d4D%r0Y(4X5s*e<Pz0
^
d~UyByW.ooΙᏬF0}G64hRG{Yɸ!vxq'u	$l-"οW:Sov-ofj7.`)hVѷ囜Gw[Օ蝹E%Rcg|ǻil4r
r=Pɗy]'GHjI-?`]/dјqBEH~

.5̈Nt<rveHGi!aM*G|p~\xUt&V/W|1=C7?BRJ#=FkE6z  h\6@Q싸૘9Ccb}uXc$ATRmmM뚖'}>`QyS*
@=e6\m5MbZC}7FMǎT3jl&nT߷21J}CtUj/1) tbh+Ê@Nn?.8.5R<?Ǫ	%k('8csi^"{m3#֨.N#7ӓ?R_E>;28s8@s6@W}Tsn))#k+*jPFo٬iӡ<]pgh9>Pjzp(f`Vwً+fL46GɤS=2dI|5oWZ2yۜFgF)K@ĺB!0dPs?uQ6]dY_$"oX
$F#~
QODĚB@'#DǷ(8W۰12:>;3T	eNcGS+ߨT)A>+lR2M2鳐mTMm4hٴi3F޲}۪xDS6tLqy:W~% \Nql/
ܿ,S9vDGy~	dqyj9srKNMtE	FcN"%DY&Hr,6޵E 7s-kXeBmIGH^ps虣.ωc)ׄTrz(PA3%;RпfD7ظYeo\v'逪X[w(땏rYT=ж?:a67ikZ}"S&}=
ȅl*=ZCM=?yةƧ8y{fxQbbTorV6?ëCps3r1fa@h@|!}h1gR^5;#&A%jcqLqx  R͐ԇYݭ~i S8^@|tǿB+ï00'XfENѐVo<UЎw>tU[ 2>|R&2{|ƈ&[L=U1wRӿ%iSޓU}	A	xkDSԓaM>*y$Gjxt?LxBw Yo6!a'q1V)n* ,<QXEV&a-<f\&:rCe n wyڽn#'Ox0c6iLª4uU}9.<,>xYeX.oyk6KIUe(&9Ioyl]mVd:xG\3,0cfF_#AAM*2~)g#.6-d|䢅%ib\o!$A&r	^Dć':ulUuR",o8tC!ĵx'L({V^|^>8`"S?c}1&;0[ZKꇺluȘH</9Ƞ2Rui-y 3xaՠHhFletNfQ߲ڪZ q#Ʃ(:('Q\䟏"vEZslƗ)xi}dPDn(ϳ-1̶	s[pU#cwTW`E[\iW`=:PB{Ճ+e/2%tpYU*G8#rFLF
U1{`KAz	LDQ[b$<WULl'y`դԈomF=Wk%Se)ՖxY~;~E<&mtSMe{XvƴIT :ZwgPFk&Z0*gc-Z HeQ-~	L,[|QP+W*?ouqi 8v/p?}d~>q@U[_gRVHtz??	 ,򍞣 cCm=&[,664q2rc`o?^r&oV58sҞ7bxr5eN#kB[(%2:op0wIϲ|թm|a.
	Mc쌻ovL.$H-b\;$U0kjj]m>6VUj%	G4qbFO%wbRlxnɆdV6DlJv0'mt|OmhtR+0u-tzrLƉ1'$a
tJj,;{BX.!"@_q>hqrD.O0Zg?L5CdJ)',k21*ȽYHˍimfU)/?.uUA0^"фk-R̚ɼ%eUUbye&S@MsN}tFNqtJ6:'mZ%6=d܇xq8"kz;n^\JG osn6y53zwB4r"Nٖ=x>ZK@0ʂf~l0+%z$X,Kc&Fg9	絃H7tV~Vm&ąA;Pvߨ(}-v@28vqIך`E*th3yD-C4G~cДf ԧrSϳZv
C.ٴɦK`򬨜cFPgG2sZj{.G$
7H;PF>`gD2JQߪJ:<mb䛬u%P˴eu+0,$ؓp4In{ۮORB QމaFsAZi5WUEEuLMOc\!z.m\F7fnFSl&&yW20HgFg2aS!<sÛ0 )J0x헃JNDYrpRycfKۭsx$sw~ftce^vfeA:Pd*3W*4)xgHAL{e<z4~h7$eB@`e7z	FE̴`%*"SO{Z2JvH݁BILB "q9["7Y.v1k!ԝ8*D9</<VUf|x
/qt?90VY7^Aύ|>N$CAX []j4hd/,MwnLӣH}IHü+yo˘1:OZl)5=z0Bzwzgo}|ˢt@͖Qb D؏ƾCP*Y:OţgxU5^hxJ6fȠH+_rf6=d+ٱ'zӋ{LYFA^'Ϯ;ĳ1%;`t[&UbBA:Kz+TKҟSG#a OT@D]/?apm=,>$	ďqw䶏Vxd-$k`M>$ԏmh g6﫽[S|@A =GN}Eq]7שfj`WZ>q0~ǽ7_o)G*!5#blFR|m
V R.B"zDn<cdA >p,RYBhؠCNq0:@8 ȞWsMg(]*OT$d6K|Ϸe/yO7PƼz.oѼ{;BZҼ^W9)^qh3FR΃*2sM]\?%$ X 