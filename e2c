#!/bin/bash

declare -r e2c_version="0.2.18"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.e2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80 and 443 availability check....................................  "
    e2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
        fi
    fi
    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.e2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 }A] v7(__&VfIVɦ)nݚzooQJ٪,gfEu<Üs:s֚YsyYkd"2u!)&l2@ @7^w:>lOXiu:Nz4IR/TcA}I>v|<h$?IVٺHޏ?,z"Qod7h$H+^Hè}BHǓQ|XDV"Z=Z{Py6>7s&iO\co]$[}E2_|(EӬ'{.	DJν0eXZ'XE1~;Cvi MXg~84H($E#Wk? F#R9%x=&gC/Y|	v.,Csߺ.g>hm,5 IFO)d9⾏_f` &Pgo4fBhv%)Ё(JGwI ([\M7hxuS40	u0xm4MǕ>ʻ~cosC9QKF~?}GXg+h[X<;o4qa+nߏ8{0
/!näCiE|_2QVx_]H9:ZiZj]/ϑ.-06+[;FGްxl4b*VmVcts|ҏ1n)v g#v	L8XrMF)?I
<^< Q e`iiiwbyq$=Αm۬JmTKҠ^7ʬPf]kCEAv(F(!vdg1M$0M$0M Shw-jl0kf-"-"y17uF;Y.ioGG6[T#D?c[Y^%zZ9fe-gMvmd]o^VjX*D9\ɚ'V'!k>CksXϛq]5\KX늓9|Eg IΠ'.)S)b=coz?&T/8O%;1[םvo$W4my[n[%%~9l_l(0a^ǝ뭃XV
vƉ6X[)<=XtAGry>ե(]QCj,V(AłQ$L1cV#/V>~`ܗ~z
2 w*U{%6IMl{Ȝy` j^s(^!LB߫b9
z+[u2:WZ귇nk\K.WWVVtιM*ڛ|űwk60T7 48N5K wWRA} LeP
)آ!7YjKOMQ5j0Aks4?-klJG$.[4|k`w{gkof#ȂG	L酐 $ӏ~`G'At sh1G֬Q
fyJqQML4p2*>}bke֋TʞpY	VHTAFoG/^T*PET9R#H,L4`I\f+L*wW|:ݐ[&E,Q7u,yV #TU@`ZA+@g*p r0=L+FUYʾdVLP$Я%^RVl.~KZ&M*	&qNΒDihֹנrf76V*/8닮I[?<x%4&&ׇ/}ϳ uIqx3/ߗ6aow )tw?sSD	?oq]f2fşZ/4xl@@Ba$eQaV!Aj_)aIxDJ4MOibL	41g¼1(CFy7N m|:0sh 6!c)sw%/>ePYF	
my pOC܃<inW4EByvtIbßEFFhc$fgS/<n%"}
sjՎ|&U+Q-B7sݩ'+CDz&>8(d*3r0BmaAмSkJR- |U^ge褲$0K~:wq;8-Z3@ T՜U3?O06<:~kӒ@7m䄴d44|xnUn:HG|SN5T{GpS]fRad`n+Ş~w)ArQ0b+=vk0^D_BMsbNsR	c|4(sT'pdN_޾-|m:;%š㳕t˝W]_zW51sp1YҠB>~eN"^7Fl):s?)fb1-ld˸m4j9jߟ>nVB٬Ֆ-V)V7	oZQIlm/ ]JHTQڦ0#nڳ7eD>`Ǩ^cAC_d-ȂoZ!+vP&g+|#wy%/_/.}cÔ#Og5MhSQM%@؎}/"^gZ\0}U]#A&{!(x2	E?m쒬["^LN YM|oat2/>Щß;e{P,P,Ъ7I`2,ܞJ('QjTV<$ôFMqy+]Lѐy>0~xjPE[
0[ެwzmQVׄ	im?U` I4FhKjKh{aX4p	BC bQ$aJXR~p9 -Ko=z':8 /Qe4K[M[΋lIo]cI꥓\j 0z=+/(3
OB<WZiZ|,-JsGA
k(*:|SG*>0iO}e>wl 4|߮Tj(043Iq`!ĩ`ѓݞ)gIQRRPR2\h
]]nXOR(d,82edER,K㔒	8+:B^1K-rf5510.*iFүUHc3Ƅ20!z
d0$RhXŠ5y4KCBYͥuZRSq-xIϧlP]=U'Qi8S,	2MU*&]<:$V}3e#f
YBLp\(mo.
'&YI{1V`:}߉>."N~ȧef?Z,-l^ 7Z8WKY*;=ֵs4;̿FCCXђ2y!()[e"d8[/!+66arVL$~7z=Xev.߯~/ǁ5(cVVeπj eYòؙDЗ?O~y	FruuCdB:^@JRUK{Z8iD]<X+ܦ6ʶ_ӡ;앤~U;C+^_pַ+uc_\laM< qb'jqv[d sɻs5KIf6Fcr߂`G`ʄ|{4hѮS=<(:9-GVl{q:)Ww>{Imf6[19Ra$g(
{"3D)qKS1lgje,w+H:
ʢ#,!,UaAHZˉ0Ji4pUS(J}yluj˝g&N}~,Ք&L58s&޹{	,t~ eN,k.ay׫u	RPQ8bƓ-CKbW/ퟎC7~B&^qOIع5񉹨)?؇u}Έ5 t,ѣ|PũI??4wnW`FƏ[)j~`{9C?^΢di7Pia,, IS/-CfG5@;n8vMgfɏßW
0ӈ	PYBMn@^;/EnMt&ґc9\ K5b5F6n؀0сO30x8x*6y)+<NV)NFqvMʟQAAb\њ3-mgICi<1"-#O1/b=AY
@(>Q|6du<DOa
&tBWGQ ҽOUfvӊ 8_TBM_Ҟ-η<(<\(܇\Ei4:G$!MӃrs']dkl]\P$~KhšLK>f#S<y\%1kԲ6TӲRy)5c=`}=-Ob$xHZeZ@QϠVA|,b-`|aԄNKq+~ FD׊bgSlg.w^**HE|8{~NNfwSD>tPz	C{ggsw&OgFG~ل~`FAw?eG<|HUHyv4]Ƀ^h[婙UWY9!́35G,q/YYSp\JS2CaV1anT%)#C8;8,$^|J<}$8qdAeqy})l
M=2yn4YD3Пz4ơ`baÅJ	51uB.MAc9a`e	u|*ﯜi4IIDCBH
z".յ?8҇Si!Ot
4]W#n*ZkdOtD$`d'Z׸#wBL'"{f+V.lxYSnFR!Ipy$e=|	CX	m8⩽&{(VĚfC#+RMf
ÄtcmW.r[+dkG.S`"2X&g*{0 +VYxGCeD}cI2dŔ}677Z[XA	Ŋ-2E&Lc$K$%t?6Ґpk;|$=cJKDJVYX5
܏`X'(DK^`2sOMѓ^ona;<kxPEطM(r'i3%*oPC
)Phʱ7aWcrH٨]$)'ɥi[(@s08X!ctGG4G>q:3u
NA1\y
EGspdWQ/&cFSZQ&Hm-TPsC|5m)[2E
HΡ/kKG~i/-)4;G⵬EV"Ud
AKD.KD.ۑ뮬EV"Ud
Dqۜ[C}#L[j,Gۆom5K,%(4Tmh* 2 QY6xYVe] Pߊ%WoG@𕤗#+=acxF!{c)Q8mB'sՒ(RAI<4q''W^a~: PA<"'G$#m&ݒ_Y^mʽPg>Ppqe~X:ȏDkcByoM;ӛki4쐀1D=4qJ	АR	e*Q$ӆ%9I@@ޚ_wgi@e
&)6. dqg.=I42{0S.
JYo*W];
=]&"H6L 90C8_3r@_hq+Ov-BU T1
OlYq-eEQViw&1K`L3g	~X`*O{S} }W%'7b\ܳ-ʶ/wʺNX\~_qs{Jꦇ3XW2]ZЛMsƯkԽg0dPtlZ3l'לr{JKXB*E kdny2Z3x3UZ{`nL!݄%rkEyTi	cYRs, sdnVekJa1ƌzѤŸ,>Sl1,tmctxr#{=*<Eq5/,ЭjF,m3	N0
t>;bO~:k?[ޘ~v?OA{c[27o#;>;n//~L.:<twe#?VY<|]DyZB9Q4}cnsBIpFW2sMTrc$3%~:Ϣ^'L.hxDM/LUTxW]2=[HXs?^]WV!=e{}`{juSZNpt0C/||+a
l-5Z(S|94iL-L,=sV%a)j(r5u4{3&?ۛl,g4\b/|P!4,NA\(-owxF5EƦXofPfncU@kٲ_>GV>{Y~F@LsEKX9Y 5[Y,N=&;S=EsGn*Ys(`i)hU
Hm7[s~/o,_:blͣi<o5C6qbt*:bfgx)Y"X8,^k(}2;S}-nϛ蝗s_i"q-V&kYx|*km&9fӴ|a˭.PM\nY4[`.(ulu|,%&W9e|sNB](!ݍ5(,_(NmVcT-'I~h1$$2R˹0svIK;yAW2͔`OPN ^*,h|nj]ovCT}gïD>[^Kx&J h~NtTrzq^<-q|}s(K.>zthl/,^C!ʉ,7i}/+v羯nughg/(٢V
X= q1)xAT{2TYJNŻOTuMs5p=aړB_v?dF VyBv\DMxp35XiO{O߹*+ 
앖{IrŃB[j墳$tHGYkGAf˳ݽ*?8Ѭz7`%w ӊ+V[@YYϢ2h9AXK={ѡL+_mo=/Am/ov^nd/#(W/Kj 9cDiI OYYN5M?n"`2@TyxpUaC;<h>E/bXƊũ?Fs`Toz׮뺧;<7+3(GaH^l2k`@>wfVYUULqyp
n#WtQx
!W:td ښ?0n(,hjh2M80u^ޥp#90Fŵc'AOw~˚ͯK_hE^r2
C:*òI7W+݁qXC?ƛ蟼dQrAe(gIyvIBY9/=e(ͽ<[{īm6l։ckSk}/{Eql$YtL)v{-;yelS`9'bnf	z*@H!<f5h_]/*&KJ)ZO4m~&[S:R3	L@/Rw"]>wI@~'Q4`#Àx1Vȭ!ܬͶeC_8S{?كt@M3nW~y_%|E% dcL'qӼɍ1q)`)ݜ&U/;KͿW*FOZHqٰw)2XefGDGM6"95#ܙ7T1*azOz}U% OYJ{
R7"iri	{St6&Q@$q}PjUHʖkqo722eqy!ILP&)sfqRZzUiC*ٲtu|1rK\+`Rz8NPTSx` jic<2On/N0e~zJ{)mݴef*l_٪AZbH9×N5~IA_xvyIC^SQmp5Ht;g(ڶL{#j2	bn<D4	i\ު崴S9bPs=-qAٮ6Qꁵ6zMprMV#qzq\`Oǧ kH9j!m!3P4	bv`La: طS|hU.^^e4/,ztN5I7"k7o.EV!)w|3qy0	8!5c1.M	0SH[35@\W	?8B }/ ?$(8V'}7F'"C*SǼ@]Wk!n>Wh̵OsQO.ir	;Kscvv@"=xm>Ճ^,sh4pPr04afZS>Z|T}"(P	ZJ]kyNmHͅ"zF]u+jR
96a)Hgs1Q!BL(o1}踘wOqrXp<,`3	!^ʵCy$ar\uv~A悥ԭܬ8^Y![L_˥EĵpaGhW:Mh-m3DY#?97@c2>acƯ8eڀ\ ʆʖ2O\YXk
o00d 0$#4!xy~HɣUKb[Qn~D  jmrX-lIL4nY̑#PP2fW>	|	W^r1r*z
S]˫!U9X%Z0Yv6l4_)ε\br>^갪UK %%u֥K.3_J#O{Wd|mpC~ywp<rPȓ;Xl3BB8aTL^IJy'i|ZSWpUԡ8T2FKa4sLWpZk+&wA\>KzBo9&A@a{4Q}@PY5~񌎷S"pͶhͽtm,IyFLGԷ,ΦWI*oYMĩ[Xfk	AY5̣"LVZ1N<5RPUΧ~QXX'E_x"H-~_
9T\d#w+jÚKw\"ؼaҟ貉yMW~Yeg_qf߸ߵm ru;@ϻWEpnw5eTMyܴ-stMb|UfK6[+0ltŉ/*rE01_rK{܈X-cݘ'-Ȧ=FEM3N~	7튫yS"^MjT[{΍zTF=7-Ŗyz0`nXUyۥM:%]*2i-!宺[nH_>A6" AmEYdPrGj;}mN;QBX.V`4G$gُZze
UUV>(Ѝ	t:gS6[N|ef|깶#gl7CW;qa6aO8suktvٝDV	<_j%gG k9Bg6~YLW,c3_݌_'*Aqd{Bgo=s᭳2LgdF7GZ*w,3Q\|,B sTRKd^5,Âl%c?O~yQS|'}:^wuwS%e5EzZ95D]Y+Uc9G^84rm5"nW^+I}Vk].^67/Ʈyf<XD<[0ks+u_	4V5pA~S5+?k rk!)
)}DxjqOR_ޜX|:kKlğ8B6Iq^&³<_۲Pd./~jȶ)L ՒM2`樛
O@q`RBH2Dɕ"18SʇBl0(C2ܩyv&movbNN-.C;o3o+oΑq#hN#BwqUN?(ƟB)jJyGjӣXo 01c@v7IraE*	4[*jvWa}'s(mo8R<x%1ʹ3YdXKW;mwC<Mnd$<<y!^n,t xO)fg4^h	My|`-
{E)|dz=}QM*MōIRoPlW-ZZ/WTR?OUਤڧGjTI	\z9qf090v̍/ 'yč.zS>e%g2*d<U8>YgUOdoՊIJ PR.ߔyst8*nߦ1#c⁼i4S	4XcyUҏ'$VO77
[Lg?_E}Dݐ(cʥ+Ӎ'/7DPI:e{k{F5m듲&92afD4c[aO O	2O'sEC֓=ťڕPVLSG䚧ԳT$nޓ<(.c7f70_àݙpBͯӫ` .
AB5H	m8Ta;+&AyAA7gM'G)C/ >ѯtwogO!6,ۋ\l 	"'C'ۈOW\ua@vΎny`M17,
^Cta33\gcQ6*;c\
Bg]L^rn)\xi=B</|bB8jtQe7{j[_~juh߲4RwSE09B<tgd)n ap6%[qɆmZ8w87KV UԟŇ/9ow'jƺ-u5bKy7y?8t+c}F>wON%0ȟ6aSüsvq:/ț-Y1䷾iB]dFΉq-d"ӶpyhtD||P=d.ā9|wq@JOhS.;_ᦁGĊjMiUfxDs^cD|i>!Go"6
kÒ/p1؆Հirb:a2W͵Me`JcSѱF[˯2\ӿ@rz@q$!{ϟj90[#zW=cB6ceP!CE6skIÿ~8h?<Mi7JA5gd x6P0qᬨbӢzjr3yC<s!1F>g*.,h .&G\$	c2j<^шKk_%+~Pn.צL
͞w4ovAMC0ThpQ+GZyhqA1w+|([n֍T,gJl5t	 xC@Vq^d6 bQh"V֬z#I1zjVXf3Z5$IE.tp3e`(m禰^&FꢛJ*Xa(^s.b|"c݊G[/.IEo4aa
Y0/-+ũ.B;h
z6e3񶔃g۞*hlr}#&94ּh!P9buXi\P.e]e|?g+`i/JKn\[VgJƶV$ɍo	3c]Lca無84m@O,j+AB<悹QmgRzfF/W}/̄`N|	CQb27y >^{yG T*/C0|5ּNݨؚUXSjQ]=[-טN$j%%o|d|{)'ٷeFWbb%sV׆{9|3FY(oYuf#/9^ocVwvӠ?9IW8WZqL=]&xrKsL-~Vq.7?Dd4Oc`r kk?Q.S qdyZj.j|a)/uc>@vy=51wK"Gg(8}Y:	C.^^%0
Of(Tμ`H=9J?yKL7wϿAP9@>80\>:hHOB҆c:ڧxI ů1α	wRJf M/nNԦf8rJcorf8ٵ0m&0:3(GH|3A*3OSJCJި[$=h>NTh}zGрȗ L\Ϫ'aNPl/p1呞1vw+oPb'|0/&AD_Z .~VwZv^>e=VUԯ3z=syg<5X!ʕ ^ }%Q<@LBKnЂpbC靳j<`_#⯻ɗVYYrWU[(/#W^}`n(ʍ|g|Li7f|Sy]dUMٜXl>Sҿrp|<l"p]Q
kJ.b-˫ !I-0UMޘOB0u?-,4,$,vts48af7WB!D9$lT\M>!
&JUwf^ԶeL)to.[E?{IEOmZ*OЃ?S'`wZXÁqHQr]ezܩrJL0Qd[-XZf\|ܑBl9flz|lgO6!t
PekֲVZEؿ^]A9;p5׹rOC1pv146(hYE&{~Sm,`_WuW ~vuQO򠎷Qا FG
3lyB6^IޙuѲʎ4N.;%1o:$O:WciPS(ּ0wŽt.G:	W_=Tq2%#!Iq"B{(n*O̩&UV %_,ͅ F/^=}cwe Ƈ A=<|X,D I`iVk47TtCyqE}wn/Fg[Gvs!SHXKV+h(#ZU$t4Bv̭B;$Q0!4WyKNcO}_U<v7X2vc}m|1I ѝ 
qL[!8qibF>bzF,С FQj}oJ?|wG:S;P~T<&KuVL/K|:Lr|Y熝9b,A!^~<Qz4%hw߭c_\$ kx\OǨOzx<D{n&	H>~cdoArǝ>'8UP4QM$wRzFRԹ92Yy7(;q3#sCYѬdrd`9DB&xrt&zЅvRi.MICGwr ŉf/N}or谿doqShŬԕ|%K/+[sϚ?6k$1<@ '>A.aB%z"(]DXa 2aəc#lo`6X:ώIφ1VʤNaXo3jՈ|uN}֛m)k:Ni5XiunbRP9z_O#ڡ>'Ii:N"O?AZ"?x~ku =o[iA7: 뷆wo7B}v_|{`ˇ{/y4a?q(ƺDb{xЈkP٩/{AKnFeѹ*}iD}a48*5HexG72`,.[<|j]Ye,n㿱R}}ݸwpbsIE7@l<rν'hxFn2N(7Ŋ鬟lfPx0{3/(5!2*qSo5_vP#G~
fVMpDeYG@{KcU^Wo<ο!&IMrБs|O}UW.:fnw^Lh0LQcl~īя^	k-B6{s/f x
q8szx21{Kw5\T~F,f~/"	[&N@wXi9TR|@|6(aLʂ_ pV'bhMQd$c|C[bVԧ#QאUE7sL[knwǿ18^x9ls6+yhd
7Xr@G~9A#8 r^hFhr?]͟_pqQ^7M#uL*)hgZ?K01soiouZi7~19`SX傑M;ϷvwtCLLp.&7ā9n>ay okv[%G ݧϚ1KekwV_$YRW sKK2.=@1:ͿDLF~T("yŹzw̚{zk^=U`F<| F=~ryr+ܷ^罟@ftxSrݒW
SWy־ޏׯ\.	|ݽ7[-`wgӬ$i]Tգ?Mﻍunǭg1g~şz/~"OlikfFC5X__[wY/gsڟ=2LY`?V?ytyP([
6Qn:B_`DŇ%J+R[|).ͺy
/ozO3-![V34: {ϝa?/Kx<l;m:?j:{8{l]&^-:7 qjW22_b,4/y9e^޼'"u{Owzۯ^>c
G:p~-l#/<K?@MWCwHk|U={nR(4
݁R1iKxuc$1'-x}YvZo:6^:<	o"Y=_xkIo9J 98@瞙]t=pd_z^wԭZ#
=E"&yo|sf2z}b#$}N)A8<_wvɩP=uT.ԎiP;ͽ4[N3L֟PwZ{i]DgYfN䅐c|mY[oΣѰȁ>Y(g2Z=e4uKK;H(4r{^:x{YHs`(Կ%L(yOb]oSo¿k7YsEzgLi1BR*ͣG7{uK(yuL溴;6N>^?@
O?<Y'7xBO=9滕7ϜxEfz\O(A?GB%hpy0HO5O~<A7t8~Q)I?(R+À=N&_pڞ*Nh@&ik@4PM<Y:I/dc1EMa:`α7
lQ27<d5̗hś,B`@ms?Fslb:9G|9L|xi4*<0_PC/~prޠ?8GQoK$VHq/[0鮠
GFI	#30dݕ:uz}GËҎ᰻ex~) ~YgLGXdߣ5*_+vyE MwN5pez֚l1|ʷZ&j5tic}ﵧAh4֚3@@lQmlƬ(?NiDl7:@cpxԞ
֙MAH:@&|<@Q?xQQ pJ8.qц0}417ɶ2k^dMx5i%#o8	s!T>0IAAJ%(Sb(ԩ  ~?SЭIφȋAw2yǅ&x`G̷4:@QbQ3 D>Z_B3_@/5w 	rh,18}at=	Fy U	b4:OS`sy~pFѯQ* @478 oX݀B4BPbR- Fqjw`>W|'Xdk59^*PİV#w&+uP6UH۝iژI5y0
*kFH)Pf1Bg?b,V2'?VrP.|]SI"X#P+>vMWzg\<y|§
M;dg~O%Av-wn?ZsFmnPՌ<k6f$>L"yViYnۧ YZd򓞭vE^u,rY@hool<pO#OmtFmo8?j Hۮ;O{oܵp;u`Р Zk_uF,[ fE}46f@@Wt-QiuF}i>rNx6YkNYJZm$n@([_k {N}tC L.(w/Q6N-p9:5q69PQŠ+kPlkdAj)T/5GnVzZz{p6(.h^D w{݁v[Fmt~56v{i<G~\`k[&t/خ._^#pѴ\bfrن~`wg<Pj"7X	to5}:u	eM_kP4l{)5-xo_׈G64I}j'~:~^@n:Ttg[&~ll_557ڍ:`6֛juW#,.mR_1Zhq5tqõv@ji?N=><&| rü@y~h:K'fOmP6t"K|WyrAsfZ
ߟF'%^B cK	{5 XOZk_h>4-vXHbǧ|'~l2{j
L?7Lc[|.3if;tTXh*hk\yAmxS٘5(lwx@%KKaIÜ3q~*05,\ɿ`<-NhcIT\
wǫJPV}V)l%?eU<\B!V\@"|-e}ɛ4ߗ_WC2.iO+-Ƕ%nzIYfy^^R=GIAy-KW%WiU7Ẍ2Lټ>#N\ĄeM/*Jb4C%E6x{8AdPu'C3XHzٜNՕ/
I/~V_hj?g{.-9_/#[;? eyXg
@}`f'͌ˍxt<R t w*{;Hsx3'*T<}Q]="B"ֵWŀafɨc\(K05(C+N#||?탷WW|/E/sAI1JNqCoZwy1""=ܷ)+װYSjU FrCFκԣaKx6\LQ<Zq_X[}FƬ<9U1T0DWOIi<}VZ5G~X
9Bw/ӧ[YW(icp[tE\7w]PeR}ËEg8MWߥ|c1b"$90`A۟j;Kȷl> 	kVkh(4X
*Uhse$ƍ06Hx*Pº]V./e2] za<96gچ?De ;WH9JI RMSkhl;YelK q"˭#jaw=?Kj_&~wf?F O7zC8ےw<C7P`g[,m9͆	{~PWy]'GHjjI-g5MgA4}EtEPRƶnƸBKb3<3 /h]^5Q^mJX*b &c~N2ք %Ϟ4'gVho*R)y}{Vd'
%:h7>3 ?A!	QW1Jr+\ VW诿jX}N=
_e dc٫+_&SmԨhg4%Bk3:v$WWQg+o7w+ѦƾyP*b Wg\|O)$sU>D[ĝVrrٓ\ey9P=zQPr?66ƕ.WW9C<ajBd/ފr#v0d8.r8@6@W]Tsn))#kT"Ƙ]PFO٪IO[P=C˩5nd:w<jX/aƱhbUS],2p%~Rbu~+-ɼm~v34Qʒ7˼Rv(4O݊Voec\@O~I5i">Sk
rN[qߢDkHXBچccs/!
qrDBP'j6UJF*y#$TLA,#t&q<au2-y[t[59"ohaiBה@smW+׶@Qe)9כ@'/wv^2'͛[tj+5H7DMcv|A	KLYa n]F+lXU!f!7a<89Ho9@XkB.t1a=S	V^^yiWc5.&ԿmuUj*{GL$tĸC(w_/Ȣ큶1sٿ՘MqjFL-{l"z{xdM<yةV =3o}kx4/YsYu>*msÛ\/`Fݵ̱B@D\Y#}_gZ72"smI;	NoD? :q8d7{=^^~	9>0r:zv/SA;=-Tooo}1H3XTb#lo1>1dHWځK%NɮJNHVyv?׈h'"Gh'%l}VH1a?<5"W hm4C ÀOc'TT&|麩4|2wOFapt3HEYFrIXuN|~ܩG4x	ku9yBăIdrVfG3jtwj/QviVaĉD{|*ǎre{ n_HZ*7AI:f#Yd2@\5N`GJ5D#IATd5~)wF]6,d<@ra	}dc7ZH/Ʉpܼn0CT_8Rzd@ ĜiYyjσ؋/j/,dj c#xP?oc9&*!cJ3s;"&rLǣD>U"1-ج`NfQ߲ڪZo q#Ʃ,(Q\쟏֋"vMZs>샤M ՔcL$%Y(_DayŒ;LD-pƜr'V`awN;
,(^@%˹zE-ȪW`=\:QkB{c:-2%<]JIT;Y$1s>d4bh:m_;0.`B%gsEnͶnq]IjFfV[,uI\mɊG(hN=4ʝl7Ilcj,.y)&UQ8 'P@#;4ZƁo{r5%Sv:kT
G&-dn+Ԡ-qc]t@<y(=Ǔ_Px(LWjUZVE,hp9/	zQo;ḧYldCC3.䦑?x$d?QrǇ?\9OhGTHMYid_hP#4 F,jGAmvwW`e(6N4(θ(xn3ʅYոrwSqU&KyԄꬲlլ/L6'=`,4Rɴb4Ŕt;aN."ۛ$OB/d\-04,|zz1R
f&qF _NN]g:!Ci.FB sc<jrDX/&~9=?ƘkS*lTӗ21݅YO8LyT2+rC;x^@GnńǽQ,	*%TE;	ʶ>Q*o!ri;tdl'sNhz&?Kl,<t=ܷwohd_yMVoIWj=Tz=߼(l1kjC$GxnEGx·}`#<`Z`K Ib]<8%MϽU#2MY َ A]ꥈbű'3_낍nᑟ#Zv?28's4}>.>8οЊS Ʌu1ΦT6]ggElf3:;`fӭw1"Q?CEf2	;'Q,TGqY+f.X)kjȦ/`8bO:&1:N6J	Dy'ʦm.iᦵDwF^1)rTIUM37?q//w/]j_>"r'mnIȐQ&˚8u`
H7?x4XÄ<:tW|I%]VS9^+ȘK/ၒ݃Myʏӭ1cw:o]}/}VO{\A*D"O
i^zP]s/$~=<7$eBGt0piI;LujG0J,xnȔ/>k>ĳ0AT2IbB2XeSwŧtrg@cxZJ1SlihK/ײf|x%,_ů,~uxa+[;<1	4_r>.$hA^Axnu9K88Q,'{`麳p$=ހ%	_)Im&iJ~U* 7^^{k(fw|i%P %3	Rٜ⧀<d}Y]x=K-ZH##^/Ix|wCfsO\Ȏ=ӗH^d

캃?m̊pf7ul1IQCsE(pN`
6n4@ zd泭;K "fpOQ 8	Rog=!d	ԏqW/v䶏.ZI.
|0HC l {otջ9tuckboCt>YI+4Wv`lX@'kL\l;w+7$I?Z(VKH 
[ oU8pATyHN;d	ap6` {.z5t<Q2=',i8>ߗV_mm>_GB?\fqn\Z¼^W9)^qh31R΃*28rw|>ݧt}O>ݧt}O>nU X 