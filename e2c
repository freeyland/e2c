#!/bin/bash

declare -r e2c_version="0.3.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_res="$(pwd)"
    e2c_global up
    cd "$e2c_res"

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 o] v8(د_U-dSrJ%U[Kr]VQv&E2%,u<Üs:s֚YsyYkfD  Af$Uݢ  {yF2_qfunjkNU9ݡz q	юwrQ44x}E?mv{Fi..#-U*F???-N.Q0p>xw}E<硁?ޏ;?FWKnk|*ywֿt/yC=>|.	z?;/4~YSfn/U=d;"a/c&Ȁ]gn<nΈ4X2ǿ`A|ꆕىǞ¼8baĎ`S/4DˎQp^{]$](?x5
#'t]	MČ?(顸Oѱ;qs82;?$B8.8>yÜ1@kCSd$	CiŀfnDFouz_dfk7_ů-1kwr5{4=vxۏË7w8T3+wn}1TR>n5ƐD{;3fG:6&1Qx=p;21|$Fe2=H%;we?P/tzF6aw~9i`֯l(8rF0ZiNfzh5i78GЛlqv;i7dߐEt4d~;~b֬{o+v愾td_vVU;vZ˦vGN{ugAJ{K;M[IUv F K WK lii\CȋǿMnScT6լM M =o͠5*nuVe+Dan|8	B#'*D"6!pjү.L·jDhYuIIYWwm??Sk	AkjR DVa&gݶ=ш%sX˛q*g@G(pߒBv
~@"Ug;	~ `z_}w_Zl̚`Sw-]H)H9rcvNBweue4V6M|kJe]-'y3uT}͓!K8	a7?kYͥ~Ý7Hļl)#޲`ȁEL-Q
"%b9qܾXqhq>:ID`6r"pOL6ʍσ_F9QyEǫjB!tf{s6mEeΜ7Y/;3U/KM|++U9
m{+;u熵ڧ^JIT}ҥrHʡOC58Ii\Ҕm:a\dߧ.L\5~oz1$_+v%9&'ѷL=P6PRlmQai?
`eU4NtJ^4"}-6w's1.5s'9lqѼXIЂ	̫ʪ ĪhLܾC`ztFIW'f)b^zN}wp+K֪\uz*uu8)~C/(G=ı,zq[s7vd/_FVC7T0rQA5%CTo ΋D~R]0 y'"cM'(bPf8iF*	@ `RK$OE&Ej'@|J9K jIWVʒǾfuY<VKo"+ȋHh'pcVDo.LƥL_	1eiƹW!i3BP|'/9鋮/7~ZHL0Sd}M
 ^fx㛂eVN9Ͼ/lgu^T bw, }, *( ͙"?lw_9t@@Bp.ˢdìJԼR𱟮)P6eDnZL։YSL@.Hu| 0oI!@Xkb="kΛo	qTԂqt|X7h'72\|+'o]pg DDvcTxBN;wCN̊hx
̭)㶬SwXYNtGdlpHǸޝ%@saP~ULyfB(-,gb 6גa(sGyqVN*Mn#Hv'>{y*hEs:<P]JܟnY7{{z2c˳7u6-	.t#nLI^NǓYOcﴷϬjP]UG
H!_Q0n@#ف}k Ee/ؿ3bϾ oPSdYcoZM*-9_7z%d8`iNʵQ7!Xb*T /rdC5Pjo[z{ӛm~D8\՟m?y?Gr!dm%3,AŅ<P'9|[(8%G,$ŴЕ.:x6Ts#w0]G'd٨ח^͵7oZVlwl/ ]rH.TƮ#nx7Dɓ=uQƌ(OFؿHZBRlY&:qI<WdG
jK_=_l}g%3F}Ϫ&4L5eHV:d(jqÔ@׬	*6!AEK"x|1g9KR^tJW IM>s)6۝bه`чZiÖag$`"!=aΒRMMEմ;)aiR紕XqFF`Ĝ (b=-o{5Ӗ(CKq^$`@I0qFxەdK. =ui ĢIĘXR~p".K_5=9'*803//J  Fuey.yghϖYW
$VVؖKHOZLc+xhqFyŸ!(dy)cf'%^$9"X1:ESp8T] |+3҉ԯhɸmT}PbHFq0k5Hu)Yˬ+IWKKKsUSR84h~٥C؉^H^?=76rj53_tytD1ZZW&Њ6P{PP\fJlPdl7)Iet7nWHӚkf@SѦD.bq2Fui]e._l}3;I"/^R2=?$8$;?ӺVd^Q1]YɅe)g)[Les^좩8)~;IpIu:ɌD`,;Y,Ve0XmH5{eN&1.Rh,9NHpEcfZJuYhKK_"E9&s^7;`&r܁k "z(rޤnC@wqyM^% (wc!G]wyu?K)Q`&u'R +(}.'Q̀6nTI3#Iɵj1vWWy{S\\'S
x,}W5ɏF <g@JBiU,HaiD"˖cĄOgWWo^@]]~t\Q[bao5W"ښj-ۺvcLFn?󍼃ArM-;N%]ZT'3{J&m 5$y7ׯdڢv[Umsj4ƽ*lBy[BcGƠl{7@CZ~4hWN--r-t%(NS4/]9^eN3fo{/;[{o_oܹ4F|y~E!<!2HFhٹ7ѩl0ƣ&|OtbhC/"|_@%X%~A^nEo\3_mҭ>/˱ǍQi'_RΛ~Z+8vu!ɬ<$/INДc?tbRz;Um-Sr"iQRjIf\D*tzf[pY=T:)Ֆe
[(eZ[XTae6	FAdX^&G"d5sMg!;bW,Ғ2gTFn9D҆y`B1tGSu#{1r!:bWxx$Ve	"Q<XV>[>!׬5%6:8CNPe$v]|8͚CJ҉)]kŁe012sG(;g0XqrR'K[Zd̙4riL#ʡTESq{79ycEE8s&o$4؈WrrTkm P:qz<r^CI*"y?&o? &OLִGbZUtt2'c@-'?.#|a`D"#Y1y_KzdU"tДϵOi=2&Ye(z~7qFȯ@qf-I=jaQeVk~`EP/)C,NO2[{!b:;.Qu{TfҹgQ!8&FwQkЍq^ɍL4ޗ.I83xd14LNn4N
ڦY4K'b'HM8!tEI0L9R-G,4^[>8Nkgʂy+ScNY/kBT5'JO4B0a
xg0U|O~2g#\0K+4\dQs%^
.Qh'*t1/js)x4bE) Y%Sd&CsS3:>ډ[25*7"V;k;3/*"eSOCl9蝜'ޗI{s:tƇGIn	k{C1_=H&gFKڀn`^4?G%W).~Uo	d\HCfyD0~4]΂^$WIS׋ʯ2vR' Ҝd-оd"q"u1N#!)#C>oȺQ Ռ9HTz)o'o< wyt(bP¤f^{I5	t(#=
eaL`C75ԢbyV:u$ԙލB(^AAk~Fs $#E=^xl l[ywقiNO?>J)GI$oArQLjiO8$>E`l(Fnx<b4꼸~[22AQ+-16T7Ғz7!SKAx!cT J3s)-ŃP`Kl.%7
?B!K(kxk΂NaƜv2P#1&9WK$ޖSn0.cH.RrrrK,9UD?	X@a  D{:P6m(1%"GђMy97tX@*,RqG4TNC%)xdj#ޙ>J5LU!&@N7_ ;qcsbdc~ph(%\w02{CM57τ3~&	g7VdlJH~?MzA?wMHYH-`bRU$" \1]ikP i&i2sЃ?5(SC0ʗFlPҲ"0Q[&jDGkwUoWvį{$G-#t@5+:nz+o:-oZ)ogY,D!%!+ߐo7dY|CVa|CTaRd!Y,AHI5$	]O֒䮗uvr*$)B+J൒6 " $I(I#I0'Yy ɪ~L9	1L˒k%-=N#ɐe	Aˣ	:4!g%RRLA5GZ>BG«LSN(G|mBt}ר_5Z{UbVW+\%Rkd-ӯldJy]##KuBaer!^PYU2eXC )"9xczչblRK1];d,WiU=J2q.VOԦW@Uty%$MdP#3UB[LȨK%^ktr#.eP.ᒨ3hƺrBeIfa԰ڟgcxKûkv?,7ZS	)n>{	v-K.sonDRع'[(ي*]a)*7$^mmryfV;dKJ)r8,!]Q{)ål8ԞERb p9RPwiMI\\sZh:I
- 	/GY	yhH#'*0vND!C<ބ$2ܛkENyOTha%QfHC:đ	yӗE*{BF#=5'FNf2zSOnwfТGFO@ך`QW͍1Z(U7cXHpo<Kû-zO$xv<ހV;o{$h^D~qcSE/\~={b!Fmaø+3@hO4'9LWitx"{FzB9(%/@I"M Cu9I&2U9,fw!E>8ucc7؀g.FNuQts
LfCSQ%QwѪ<(&U]ZA'¯dK`˟!Qp+Kr6ˁv7WK+jQk=h `0:x-1;Weh0A05ơ4CE?sKoޒjXJm8-,\(ERfQd'}seKer:"ל3p,"@s+ⲅN]h"llgEp8N:&XV1z-?[wjTm4W!/ϚJM%9W*%١d/01m*LZf|(JUUjZ`9J֙EkeL5L޲hjh֓f:e_03zD0+\Te ÂV%{-n^A[E5q	l1fiv+q-Ns*kYl呷mRm*9fӔt`6F/1d'MQz/ۀ5sglvW9SF\`ޠ+3r(Ƅjӵ;'PEn`RhY	(*()ƨi([ZL8ߠHRQ$"4s̆b?=1ed]6=}9$ɛSnٌUtLQOGݏcy>p3 O|'g}WnZ#9H0گ_ӨPG՚cNhZ5N4V9n[<ق>[\21Q0Мx	@H̤9r:1:ؑ;;;ad|楢$tCF̲`홉^Frx$Ia֒RμZ!{$QW䏙Ç资-(.HݐVM^G;>{WE0 B.۽'΃pfso_>3DN&ɠfϔucf~"8LyOK͘{2{6s*,[b!U<,,
4g9R拂jm|bo*UA	;+tC/va5Gz~Lq$8?:.{CHsȽ:.{~d "r`6ׁ>I6QA-ǻ2zwWVY=Z_!&XSw4
欃V_9ծJ78^pC>A2RM\&:膻Cp:y;ofUߥ~`8)NCI`8 }iHQbp@MeRN|Cw2
.6y{6s󬺯$x$w%~s;]})bdgWuژl@㟭<0,nRF.j1XrVnvkzC/xp(QJYd^{AgpP1- 34Jso7f`{9,
fNX,֮['oל[b>щ'Gt'<>bhkiDaʟsB7(~#ab 6(4,<L2A+*w8(?Q'?Lrqn%2?WaV:@9` :[ITY:b-\
x?7<	!kGf-%oPgl)98*wRs?CKBH%x_}OF@TOQ(%P`F;an9NiK-	5ꯈ5[
j%q E0w_ٲSѤَ:ikK2&wM9 >F ++lec_f}źHV%	RkQԭW<UIgzT6qG\uTZ\ؒ48VC7%V(
tbt( 1a3k<`U[i{*qLTo()-Io7`sx}wu.0& jSҔ40ES5XPX4m:QΓU\Я	E4[j˴͔
z/DWUHV(,Te&q%EI{ŤNrcFY)c`fmF e&󰢑G&:gV5grrHȷ%}#MUƆ,pn52Ubr\%6ex_܂1;$Xy9(,=-N&kf^21E0.	JF?;(cԱ	II0w!NY*jShxYd{-nfx)41~^jlSBp?GXpp\-1S{ƕRB쒴)pC&brik*#u"& 0NBp`98<Ez$0 숪Vacޥ mt0V&IEHSOڣř&Dg4;K	Ȟ` t*vX#o=dn=͔Fϔ5S=8:gs']4Wrвe7aV|_T͍.<^ JtFAP\)BĞ쵧Iuw5lS\gK-Z{ҶW3=+"U(=@#i8諥L\vJ0^đ3{B6j]c)Y20M9\P]qXv$Jԇ$vun`;}3ʈLsRAYqzQJ(7*&{b~\dn®ser39 xf:(jI؍p2TOxhXc㧟#o@~tnxN EQoeiOLichg8}}f O46A_hĔ塘~E5a毻WgOoFbil#F@9~G>	3#XJeTՠ;$NRZKE.(_O/xDJ5\ҢR\bbA^+uUMu% :Rtե)/%+O^mrm<dήrHe#5clвSgBMBeaiPr#!NR4kaj*+M"5e1Zπʽt/&q䖵2pAo9KwWFۭUa4}zC(m,myFǛ1d`z[M^:<S~[fg|.W^-3¾O,e=Ty&@CZ`R<"tbux*`$S 7ʹ284OҔ:Eo\bi+$Suņd&4R	RW=QلϘV}1Urlcs`!s.g]ZM+O^qf߸/1D7Xv3*T06k6N"zUEǹq[xTK6[0tt/*2RqN瘯e~G]DܧV$g7viׅQ+s0!n_~5str^-J}xsօkMua޺Mz7kq޸v)m1z2JZoDurEC3#5?'PAq7Li2B(8\5E2r3e"mdͥ3:FPni*lSxƁ*2J)kmN~2n;I/!"0>?_v=zKzgnM19Ku8qE/-ڞ8Hdmԥ4p0niE$(a{	m>imajlN6peeΗS0n%w,Җ^ufrw+pD7졦OfGtJ9ܣ8#h:)4xvwf{32IΘ8hs.@ZP B,V9R_^ۚdi|"['{ÛW& Ɨhw)jYn?jTOK$0|ͱq%R:[i	=J"+q*Gu9~P#(;)13~ѶWL72'UرsuUjnZoBbPV{ù뜖Pdh?}">z5CF[*)uDhY3OVq)FP8YLooN6=֖oB{u&³8]Sܰ8H./nL[3da\|WP֑kk0}ԕJ"P80@)@$jʀϽ38Caiɵ7v iyv&m͖85ۘRoJ;ۡۤʛSb8A-$k{JUF>':RsFi6Wjn|zIb=ČE#5>ʑǹ<' OQG鉭֩SIA6<"_ˑ~`ϞKɀ%M_ŌPukWTnP9SU@ q=LϲN(187ݑ5aƾ)p0MUew#ՅOԮG	є$n]rayCJE}\E
}vt-,cL>[ɅVTl\({*sԠfO/fFEn<?(>fFMg2lt2q8~Yc5l7jT	G!T D˷DjY*Zo㐑ow޺lFu홷PH|f-?Va* {ʚjTe5պA;6;t*6$j~%a9IrܢnKa2G.7PQZ5<ohQY,G䖌Fd5l(|ys/3\LЄ>B,ݮWbWXǲ`PuMYU=<v%8QNŋD15L7ba'5E%x_WWG/#qrJ`k9⯯YDMVup{BB7g9o'w-A/c}(᳝׻?FldΖbC,ggYNw2[w`ŹUfIJhv,m[-90~)H;JESh}Fso̊܆vsPYD/bI⠯EI%l9=BNU}(kT/d|\ŔpWN>JroVJ"14zM놸)>Ѿ%`~;p+-1zU$"IAr2iJ;;dꖯE%^s%ǹIuQhYt-豜&ti?sW6ֵo .ilgyӯM܁wY=?yP`xI,>"oU	9%b80Pံl#CGx藏ϧ
P="_~A|nCGB̡CtD!69kAIn$ӈ<z.<#i$^"~Kj>70Dy
;FFkPQ.p0 ܶ&$\'TsqxN澹g[Z-XyyvkYR*on9^{9a4KeZ̖U8qϘHt)|!!~uUWqCpXIk]1"zCSn<Ea/Y%2Y.J	i"9ξ{DaO5׿Uitn42ʎǫCzKD^h]4p19*
&Ih%鈼LH4xp/K&yFi睯*FjZd7c;ǌ*kt* (rR6xBHTa&t~?Fokf}T~i-i c
>v#:˙Gv]F P#8
 Ѭ5ovkZcZ(Kj5)߆VCڿVCj5$JE*d:FL`E˭	b<JI, -Q}*3Dx+4pCيC^催ã~#$]x	CP	%O-V\>a%8Es$[M&jszLm3w[4E)>:
iވo1z?k]S.e\urEr4t%3Bɏ|QƶR4ʌo	#.H+љ	0Ca4mLX]TWz3zh悹P5V-{De1ԓCwf@2;asX_LG]N?#	_ZUͯ`yQQ%@wG"F-GלW!3	ri9TFTgP00>+L''3,Y>ɾ-RU~3sܓgt0Q:Ese殚,H<0fYxNXænI1z_T? ']\"h'"i^%x*.nXđR<zj	9%ő|TrdN-Hٶ#]ۓeK LR^D@Bvy=51wK$g8Y<}6`N\%#u0&pr)fmMPp(>l9ވO{~4:1_g"~s߿Hs8}p`}x*y<IF
W|l>dJC%hcvE;J~ŧ#<^/ T^Q.MR9pLxqL1r+a[袈Si{XwNq3u(ޜFq@uĢ)7OM`3q(&qs"RwgOzf=>%Ǜ@|2Q|;g!I)D^\rl՞hY[~ɳkv<Z5[Oո6;r!ڌB"GLϣ-DT1	>Dk9+5|']u?e9ټ3CSh#eJC^ibJk>3@_$k3..2jKZ$lJ7)_;CO>\<w\j*$᥍rYD[6߇D&x|V1Fgm>[i a f!L3VuLDa6='B&c4=+_AiFC~}K8AG쒬濟'M遬=I/8$9|6qD1t."&a0T$ D4<nlms9JLd3&
P	p?9odUSq!+-\-8Ԫ2&ћAgnAu~^J`KE)^mk~SK5OCY e(&0K߲7P#<]?c˯t$ d}|OO.a8@W
ը%#˥6O]U6OGӬ/V)<i-T[[7bpV^;Sbaeƴ0wEd#}x+vvkZ$M3H	7yj,ծ*iGI@L\x'}F<.:>LqbPXl${Q+z.K/0`-i(n*B[W廝{\wR 朵*j&p,`,p[DC9wEnG{\s#*{`sHt+%1v+L=qpfgج/ʛ/9E֊MH$wn0%p;1'/^P	HG%_?~_XjdVCt|;\|S;nY{ -6A]$bzHqR,!V;93rߢ-Aӝ!}2l 5;hLܾܠ F6E~,>9t&{pf>rD'q4EznBē~$>hq:h^0duCQDR12`q
ȒΚAP5),$|i<<*Cir'/N\0/Gxf~:F'x5>(VA\)JW 1c>Bґ,<JQOZ
Q{$GQbi5k08/kgcv~qw?~Zbfj?_-ʷ_FXvzhuXnef~UPۇthG;ʟ[/cזּ;UjR"2^鶛7WV?ϽjkZJG>|_<|6шzBE0e?l1bJzFź4!0EPG`1|?SaE	N(
T#mˋ?Pʀ%c}NךiGwrN6#٘M}rޣ]'sVa3:>us/ե' sʹZ+b'm?w. 'EXbTHI;u&`@s^+>fp_P^嗩^H	I{ZbRI~~z|kJ#z(+{IQ_F:uű`gfe%'Sb9/>LkAFw^AUt%ʧi;zRɔy
%wFZ\T*!}&t2͂\ i|Z9w5	xyY^V/cpT:Tݭon훊RN`)Ͼ"rL`dbAi	|np̚HyHnȉ0?=PϝDw41coR,Y]ߍ
hCw`
dwkO t7lm>&ha7e9IAL	`pFSgu[P	['Gn~c^/ʪWroԩ# Q{Cc&>'dCL'(f1|O}WyDWܩ/Se'a0l"L}Xy='ѥ½;򚤠:u*vعNS |<8=z
]/yۥh2SVѺwqMVmj"coN >s
!$Zȟq{4E)	"@.j)'
HQ4]*8rh3V<2Jex9n&^Mfnv8xk?kʍr{ʁ{ptA#g+ꇝWa5,'#>!ChD2G-n'ÔQ+NlܟO_~#gQh_rAm07r
1Jn"Y_|=>0sovݻwqZ/s2|#cВ)b֏V^'crz3~jSrSL穄}%<F|t}+anvfk\/qg"Sl>{		;ñg?ۧf?"co7i}+䱇FL{ۻh5?}?6[[/ [oww_m,yr_XWOQSi/({	2j?~O6zozz7I%vދT$"z͏ovKɳ~aݴlgߵ)la֦s_-ODl5SF 3=;i/&3ԟg,o̟G2QD'29
&QnX_e`_fŗ9
,)M>u]
/Z߰`0.[*jqfsb|'cE"݆Rq?=
k0(wtЄE't&~XY5CCu4²Am6qG=HsD䐙}y;癳w%z8Cه;϶^zCkLuhc~-lc'(Kֆ˭;Qq6ܐ$Koᑲ;xQuC/Z (˜4dKj{ÂOsAxIϬjee{SEm9r 9wFVKOzWr͔ћȁV7ouwr]WXcֈLsGMmlHI:  ^ܚ٨_Yds#ϟ~^fB{ל,9fcXɮkPP;qP;d͕/oCȋǿ`
eXvUe/VɥB,6նA;>D*5_[.nv{yDd4,b'3eEZ4>ER_:v]\IK{2fvk5%|V?^3<$'EdpOqM#`[k=y3 7tut-wX4).jiTq4 սۺ/2O}_f\O<{ӛm@OUׯ>>dƎZU|x>M#=7JF 瞣U%$~ƧEyqFV7y@C7E<V`5`ϸޗ½I~ A;q;>^^$A̏m;/dc:

;Y]lqӠ?M>c#J	H=(74jGƑ{q<>e P{72[atĀ<ܡqC(`{2n@_7_N]46}AǪ'a03o{&i8ZL/ǣ_щF}޶ނrڃh,`tqSڱ7j[];,=?U^l{^`w8y k-{Nzm UXbkYZl,{N7[(	tz,Ah6{ z08RNֻlm[=Xw52$MN [@3)u˩\=)@hj@8ZShaU  p]r`:qN&a!̹#M2g	5['Ìn|*{dL\pNQ;
bs\z.>lho(.a{0%d 44tnM|w6NrgYCg25iȣ L?Zw# !'Pi
w|a%s	 /+&@j=ʚsѧ'So"pN0ڹ H13_Gqqu [33l>xs&/,nHD/:P
ˁI(GZG>#O5G
Y-dabXλf&d$n4jfIbvD$iLi)?I/o*OP.;cEcOWqPIApuM&cG >VQ|6[Uȝb3Ss*vV-RWW3CCʇ/x՗r8tjY٫5QfnQOyjۍV_L$~L/ޚ*_k)OVl*!ꪽ(҆g7|FKdP־m7=}iW~]M@ vT4:ftW-hkg;h^*k1@V:j;6fZW=qڸiX5mY:V^o[lZuXhUˢ^ԔSaw@NC.UxZ' J}jڱa!ZWWGXn4ֱmi[nuas z͠zA{dj)\j(evB9:!Ea;rсҽFO	P#|Zjh5Zqfw:=޵;A``-|}lAbyPk>CVnF~VSs2ZtG87V[Eo˫kfh/e>yqSBc-l3|z4E}l@_@ϫMv5h`ou%m7Z*kH=7ڵbn`)a7^o;Hc]X<AA`%o0ڳ9~}?R?68;(STQNZo,>9
>udP 鲩0<()<s#&Q 6ٷm@U1tiZF>%8N
 _g0Wꀼ1>$)li/6O`@јa-́}ϧOjY*-w?dGԳmUp5Gړ:PCֵ/9|'\eWM]mvpVlvzzȉN+X`Iˬ0js |cieJV0opeQZ򞌂#gtPgn$\NaGEW&c3p>MroߋsOi9yr>T#l׶^÷2w8'+9yk[t]\,2:/!)/3BxI|fM;[RXzEDqO">0V
ޙ8HI(a4|*^z@N%x-o{G/2I/~Xu3=/)'L_G?3_Fw@:JHqJz~є߽c0M"dfƥ2:	EKK5~vq2y>&{Uվ9EB%O_[ȗoRK7I\xXoGgix)0eL2!e}%8H8^'y݃wd}U6W"Gj$!>v$J1vk]did9m|Ms>+)YgVaMGTbыK-5.YQXNJFlqE_(ra<j(Db?Wj	LR6%R<>zᇹpa6e"s
9npϚr8Nrж`馱E0f&(Gi8пlc1jQ%90cA껟{Cȯl>(cc+eBKX@mRtp"ǀG?V],UOUvy("uzPWkjڛ#hs*m##(ʾV<-+t$p U%&)5Sƍ"V90y7R;Z_(Ϝ7tb5=_)ߠ!9 [qG"
wtsULeW; 1`{{%7dC􄽂TCTUV o\X7>wAx)L;"_FnJ1B2sbf'qY<g
9_d)aE
G|rqxi5p:V/V\1=c7;BRBgث]F"> 4A@P|2kJX_HZhsDAJJkJ6>Vv4ENOiU'寢Y2jhg4E@Jjg_]sBހ-۠7/G[2D̛$RXՕ,K,}r%H&+898ҧ݉iEr +=U眗CF~a}})yPr?57ʲWV8A<eZMB^d$fzrGWϲNC'Lyc>
WD	#KK*Xg
m3]u2B:n	nt5SB]Nze*~"'=g;Ft ڋ^Ub+TAes L0l0BGoX#yz$#ot]*v?Y4F)}ʎ
CpcʞSMEBr"n2X/Ϗbg4gHԉNEA*u"$
X$90QKǊ6s򎝁Ν0xl<U2HBLoD)>klT%ee	/:nC"nGli?g7rƅ#3LW jDz JG-hJ.Sk
-/5j;cfl5`ٌ7/v_1+`mB6ysF(\`ڽD8LґL[zA5|(5@4*+%>gr+ Ya'c Yd4s>{؊9' ,0%\%,f%gCQD		ĔoJF*Tbʈbk
ylY=]9Q"ӇY{A! 0sbPaDkb葝l?;<OrkG8h|kG\45m4wDAx@MӉlA{7a:zhܕ,.X}u¬-8zR4J{3Yej*!H]On(s}~+C{|6`-Myk eSV͇4]gRG2;QR=@D3Kb^h=ŬIq̄,/XÐx4J6OtziyAQ}8g2!Cg<uG}+\8?
3}7tY,[|裮:6J|(\̉]{1{N#M8S'U\㿀$iR24gp}7sh'"E՞K4şcc=,jd]z:	#Y=(L"e#=ͅQ[dM\OCwsf%RB,4g>vp&Sp4t.`f	3Ge~j'T_z³Mb5|,a-/^~;!ÄН|z٨MŵX4|h@FFF_ᜉN=@P=1͒m4hGt+hc7XH,Iyrܬh!1ra"F5U}ųd8,a9áE	 nY!']@~ҷ>(t܋㈠7ԏq7Ռ/9lO(r[XmYz	X(sKyDpfM]L'de`-C?$vk2a݈p0	ip=#&9GsOsAuZx)cd!?BeL165F'/`	S]u9C<g_D.VsjJ#\pjQB	qLO;Y~(m%S̭R5o
k˄\kIU,®P¸QP
z!~3K}nshdukŸߎcv9qfk[z}VI̶T#O t.);uP'w겑C$kXhٮ+{ߖ5:C@G@JSpmRQ/h*Z6&jM9;DQRt"Ǎ?~mic~Xl<>??LTmVԫlN@'
5%
l@)?Uq~,UU:!	O·jv*D8C7-=mN
PH4r>``w곃 ;uGMG\wO~kxr+	#^ ۡDFGF!N$VJx4*_au< 8^ۼ_Jixa$v>"ʜMa~7V_T].պpA鬉:S'Zu`*%JwYb<~7d1TX>[25d5,?uS|MptRh8 F)+0P3+	8h  xJ/IG\\x EDAK&xx)9CeL0Մ)y"\/j/eX*lc5;>ʴ3WéeRø@TPAWfiwW⋉5u5*KEKSLk(h}𑸝L !g%ld2ͨ8M,hlQKCEbÜ9ʘN\ChHw..bËo8[wFEtf/ug"?(zfG4W{wrr9\1fĀaEԻlaϦ!JQ4
7i1ӏaUX=J",_*³U̞iTE"?2g:HhORX3''r/a0Z"UUZ%ݏq_<G2)	dZƆĶiyo)]V&N )iEH*tο6g{f~PS0X	lc4R
^:^nJ_|4IRj2Tjs/?
oy7f̮üq
ׄ*Q4*VZ.7ΚvCuXDh5!4!Б^q2n{ۮOR#$.)M}sh:4R5hy+l߯~W:qñQƼ]xu.l;[93cm[z}xVVxÓ$Cx涮GS!/ϟLÉ4*Yu9kH*[E2~O;_+;[+ctw׻Cjk0	7.}T^x[/<.[BhO^
.RM㪗c\/SMځ(TF-S1{!,eA{AJRJLhL*00ÀIota>ki 5mv1V/:ZB<W?.Up}	3AxޯE)}s7gln bBsǡw4Eg&}a躳6P{eAHAbx_Z#v?1z\i9bԤ
 =q9靹-B&ߋL`5SFY@^0v-R!K/y!D1cҰZy@7)1In!e>0l5A&OlȚ=W^hJ3
:YrG&iN,)IeMeR$'1}T &
T;SD7d`ISn@4Ѐ!{ :x{`oDًNCxx3VnorhD?;C |En~F*<.Pl|EM@N$BQphrr3@!G
a*.ʒvХMx2؂V:]N `-\}`.gDDAGIMfR<%5,N
Xڕ@`Ao'1 <4D\r "X ~ IP_Q	P=@$vLOЪ@$ /f*::UZ>-j<=GD)T\\?I&ţ%$S J?zD*Aht?] Q:FqVʣ^:~"Jqy9C"k jȀr.;7
F(C   b 