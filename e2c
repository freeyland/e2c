#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8Pd=y)XUiݚzFd V& IDsalk__@@fUMTK\<<<<<<<qsP{NoKf5ZN}\k5u>3\tM	7P#ڑN.?FvIՀouZ>g#yZ h]\G
ouN.@kӽG߆^G1u;?FWn[t:6)__{}\5Vg~4v_p+vk_ڃ/k׬flwq=d"ac&Ȁ]gjn<nΈ4X2ǿ`A|Kٱ7r7=yq"7<sÈŧ^DiG1.;rGy1|v}( xB^WGt|.+_⿽MuQ&Cq[?EncƭP2v dv~N	I@q\q|9!1@kCSd$	CiŀfnDE9Vߐ=pK^5ޤmvGXǬ+?Zfѥh܏3;~^	<ooTyMS_bL}1*
1$^=x}lvטw(r͕Fv<xa{{_>Gu#2|qE^NB;we? Q:kFWkNs9rӥ%~e˟'a^14QӐrYjk|jp7-vn0g!Nh /Gw0T`}GыYc[Z!`gN{is$jc7+Ҷj6;rD<]{t5ۥۦ-ۤ[C1g^ ١";TdvbE6&ӤbTLɵ;tx5E٢"[TdlTN .TfDIzl>Q$4S^eyur>V;HdhV0U5uGv
.0ؿ}0/U8Ld39k͞ֆY͟FC]ތ낄if\^YWͣ	~-% 
3W},Xx'~I~}I^j4c1kM;ߵt
"! kxɑKv;+i&m`ׄJX-'y30ɾɐ%Rw}a̞^Ϋ˝ozz]M;hiD7{qgf|{EU 9tsO0iLow̚AMCD&4m<c&¸,1X@^y:E rmѼ4XN\y'NZ_Nx1%'P^EWɃ9#_y~H>G6o|uUW<tNbx!
c/K3gAsPpcuEekyTӨ.e;
/|S*_Yo79֯[ֿԭ8W?wWJ귇vk\/WWQ4sr!|iȡE0t.2S*.kqz1$_üNJb [E&}/KBOM@`rm'>-6DwIAUz_ް	edwǓHLE.BQ?st'9?qٸ &	0.6iVA0q{gk^B'5VO<ȬbbY#:98Pھ>II˭WW[/wz_P*{	Rnyč]8~RY Z?rA5	#*XR<g
8=i{	ѻ+>a ][&E,NP~u̸yWҌ0S(N%h!y,zF**$*(Ga{u-*[]׬Qe_r:VVLH yU[ɒŉ>cc* 6%/)H\@4jA,J)FH3&0^K6#\`*擄KN%˭@-:)&-Ea?*͏o
×Y_:<	{[ϾUȞ;"v*\uTPğ^8g͙"U?lw^7r退=Ʌ#/<r1Rs^LNMV8h
>X1g'v`&
C6'_jb"!`7d!y2p8/Pun(r3B7F2 :qcF]68uwhW2+0>TfSmY\Yj) xCx`q;Kͅ!BUaԀ13deYP6׷e<*΋s'(75ҹD:>]eټkxT:-MnM+ɜ^iI6śz٪[;:ÕHNǓ"20ˈG:%/ŘE9KRAt`q,rY(Mسy7J7vb&@K%/Wo,&>2iw.*Q
E髌: #
[~m?[/^M(e+QW;{G=_txRZ2J3$=\¢3y1ybɷrXz![r-BwOXu
7-gKU"Q-rŽ}R
Zmk\`uSjuvGfRU!2Ee m(1~w]ym>H!JO.1ʡI aCVHʙ-Ѥ.L^^EW?~ '*}X2c|b*!&)@]',^j-:t*R`z
dHnL}OJ؋N
 igNx2%sß;f{S_G/R`uiÖag^#`"!=abVZϒ4iwR63KVڻbiQs;y0s {I)-©*Nzfu(xMx!Nd(	&"Ob{)_K4HapO],iBĺIĘqGΉ2~,AܸZ%g!ѫSقVZ֙eVRdG_*+>l%$QLc+cqFyy3NROϦ1JNac% $7%Sd%awBnX|W|ouF:1LzKZ2n%U'd*T$DQLR%L9z5 xeJ|)p|)0|){bw.0.73,Ab\LE2\;|i+ZsC5RIטG/(FK+:DBZ
e6HvYHwv4YMW@ٹfFIaj4e'^䧌EW`w%{4?S.zQlLܞKKfZiQF~_@1cuЩ2
~ɿެº4UP3q-ƂSwtT$:d^"a_*OVB#lUXHT
WFW+2ZWfCR5#sx3$.n;BL W+8d/#ɇn O"ہk QvN旨+2kP>}R+f;e=gnf\A87c!]xu?KQ.`&u'ӂH[K@Y2~ %)[mAEIa6I$DIH_`cruk8K#u<+i'yU5Лh$8^8CzWwbU
Jy),mH~J<铽+>_
Xrk99?+Q-S-qko~㨹Yv|VDUdF$G*8fD5Qok+Vj}qrr1jn29/S28Ԑ&4lK_ر8of[>Ws4m&O,iz- lB[BcGƠl{7@j~4hWNKZ[{FMVui\>rP38yf~AΝ(O#VwXAP("h*{,h<`]T[L'{J~9"_P_6QǵCAzBʱMQi^R~R-QᖞYcBd2) KeE.3%$5ݽ1sAN}f,33sV;h(C
!rol)o-wˀ[Yw}&}BC+ KWE +AN0܀!q4yA!N][~:	qLd-ՖL6e.79Jv]~V!KvVIS9O`MafBԹ~nC- (vZUY'A`2mL >[ԥ*:8C[e$vM|ZMʲ3]7ES0okŁ]07st(;g0TqjR+KZd4biL#ΡT?q8tycED8sp#3T9)-\k;KoS@i|ĹЩpq$UE6{~bV-f79P+3[1FTI3GhXIҩlQF$t7 H"iݮϯËtw$}.iƋ@S>WfSf(xI^]Mď"r:uę$U\C6AEruZ	A0^,tغ"KnOJT+&So.2J
P՗*bF;6[+=}X,|lԊiQOџ
DJBv^
فiXʍ*2pf2Ԧt~8!wI
*,%SaTιa?LZqgb(G"dt630|	R`i!|9@rQpzT[.Q6@mHy'ϵ3y賄%ScNi/a`BV5'JO<`0o	)%<n?_S%; ~uF;R&87iщ'Yrb:&.5@($#K,%t$-.2%P-BBMK(AQ5(C(s(&,v$ 3dk 7"V Z3;|jp_Xe0Z4˖{؏`	G<>6nqgֶ7t4y&=ۄ6Z­&uCTFmEx4CzXxWkL2i=d@vokgNHaFOەl+ߞ7M3ijzUuVo[ʆdh(Ҝd.bu0QR4Ҡ22{e	hk:g1I͏o8yFۜsOJ&5g c#R"ʣJ|uC0K0Z	n)^aQTk~N2r]^x[yOiNGJ-TtjA[L?<R3ZR<HZGcAVHk$I	SV kq&7!;SKf9#WWChZԉK>fc	$4x,ƺ%ޚ$5ޘN7Ƥ4iI{z_Ȝ[K)vPz:|%q%"?
D??	24 D}|J=4(4Ah5Bj^@MVPol)+$M73({ gw\p0mhG>ʭ,GPI1O";!Cde 1Fh(0%ES7$3of&5iۃJ.iLU}3MyOyYٞ(qI)4CʹfCe6%SSq?jK@ "VL5.6ipMӟZZQk:jRQ`l1ziP)?4OsM.bk#߇|Ȳ~wv
*7aZ"0!β7x-hKڒd-p+	%Jaҡ'x+o:-oZ)o\,k:dYAR5^%u	|]_%u	|]_7_mYD!5
/Ct@Iw 'nv#[O֒nrNZ]$IͤfR^3iC3)YT@#I(JROIy^+H&z5G֟83ƑiY2[ĸ7gtw\ɐeBˣKG\2K)DsT4i{2=f+0Ny+_vrGiV|DxO,T#2S-z_?E	x}9O1ɗ-N:M̮t5^4Q61tX^,YНw%3&^,$PdgrTʔaILmTP!/ޘ^ujh {^m\ʛ^o.~Rq.e=Uly;SL`hyWT'jG=g(*Bc2͑ćo°&Qu]";T+$σ-Vi,,6O{3Y{/4sixw`^a!C}<sTaBwJ[^{qK+Ēܛvɖ/J/QgwJʎW[\fE=RRarIDRKHWzaJ\+}&$,N/kԽ'0*^TUlZt7ל2{JHB:̑EVM ioBz2|-(	*- 2GD!c^ބ$2ܛkENyOTia9QfHC:đF3	yӗE*{JFA#=5'FNf2zSOnwfҢGO@ךķQW͍1WZ(8U7cXHpo<Kû-zO$xv<ހV`;o{$h^D^qcSU/\>{bgmaø+:	gW1j^r9G D\no7\吢H8%87}cN¡+5TbXК-0,|/"Go!ƀ<s1 t2⦛{-uPe2ZǘbŒ-fHi\U"O&d|I8n\^TiCpn&*Vwiu_ :j;ܢ &A?:XPϣ6Wt$4Ls۔W'hyc&0r/ГGi5$4I֍'e*μKe3#.Xff:9Ln-̌h44eQy2É)?H&^dź9<HqDe|^ZFS@~&ۊI]j?hکwjc
D8a&k׵N4_x$j3i#Daf"ѫ,PDe۝jreR)#]"(*ZX2*뵼 7r)(I?ŌhS̷uC#Βz`+֢a4cޘU4΀|JTn9A<=}2qn)ΝjzyDj6H|fݬo6KhHjG%"%2aj݀rƺx COb6̜GZ`e&s̒V$iT ?.-ܺ
;e9XT}qC(q-NtW38Es0L5|/us̻6W)'}RD,CP]2ByOc(wPk*2|I^3^Sϵ蛣VD""s+?]ohn
_@gSQajUM'_ PRQ.P6Fq0A3DIHUh^t̆j?C˰Ӊ1Ď\]O!(mzL197Ifd<aeEut<D82!q;;LgʗJvv*3
{E$"ߔ͍0]3+c4Z)_%9l@IⷥV~ݚ=ĲJA&{P
D8W	Kj28jH9BCm.Y(C
K7:t¢7_7qp:'$$̗Sܠm~x:,}%5-TcBo<㩹ƙ_;ٟnmО*̲ 8&%
v0k D&U͚̙WKDOT]ch>%fӸ"(m~]JL&*lt2ih,mJ6|YW}|xTUJ?E[;WEp9^aEA8zOs913?Qi&W>?%qW͘7fev1pB. ,[B}	U<,,RZ!$}W O@J^ɭJ{{;2g j/w w [^FF>'?ָgM0SkGQeB[6gvaOw*8naC|;8ep4oRD/<&Bc9aЪץŹN?\OOzgE"f^8n`0-ysT]XvӐ7s%(C5p``Q- b螹 c^f4:(*Za]i\YA(F\>8b-g_̎𱨜G6Ғwja}:*:ð)p:Ԃ(-Cx0&)*2f'|/}'SJYݒ*38](f٘ㆰI[&f٫fRvX^u4an+٭VkI#5!σp@ē1:&<дYMu<oP~}l3EP0iX>xYuKZMN`"D02V#"k25e~Uu&@@hPoRŭXb-cx??sC6vf~co5׎Z k<acM]C/|JO0[0[P]ogeJ?UE6值lu')G^?ޜq]ϕ1qlv)#DU 8=mVqId<.qZpntCT	َu֢fR<L2b80䒯e}U MY:%e J-r6ә]6J61LjLIL[(UV/&<PƍbJzkt 2
@Lƚ92yՒoLG9xm8ψ`DIlYF	@8ARjW^oD'M%ES584;:wCɪ]j.b"mUemB6+Up75TxL1R嗍^1)SQm8G|.oYۖoRt`0Ԟea6ݒ洰CCL2=4G4`gD) tTpsE.Rr3*fgnQ|2w</n|קf)PXzP[RM֘8dcxq$GD*ƄRof*PT!ޅH:e*O)+H3ڢ&Zeu]Gf?/7)(ϐG?AP&:ؘZvjzgCݴ%Y=%bϸBJ(3.c]6EP=Oښ|5'f#׉0ЦeyQZW0\9[<Ez$0P!Bq%|aG~3#yiS<cj7I"-zDR.:xL]t@_`h8>3\YJČp㈩S\L'kvi7z#bLQsS˞t\m|A˖qcY3R"P47`8+OĪDEkE8/:dOlҁ<[khYgI^LrEP%+,(={)DTRjݦ6@>mWQYLÒ3aOVB¢^͂C@0KH9r.(TC|W'0.RV>!ICst^eӹRC6X1̬8\i_zYkxxHBk1$Z$LbF8]ZGaA\5 13tӲf8">c@pTþPKg%E&"EK#9áB/z/5O>+>%ajS)KxZX bG8TRGaPV&TpbdQouy5};ޓ|R5xD˰UP%풄Ka(rIP#jIY/_]~Gӓ%\jL2~OAlpe&S[\^4)/3[jReقS<F͖YHf͑:m5*ŝq^SSID!\C0%^x(t84u2vmA'ЬaKwŊWF0>=!vLy|vIW:O&'e+鄙 ˫`cB+udZ-uݼ+G$$$RY";m~R^J5[ }:1J.jFnsRXoŶj*<QzU.EV~!/DwK:D7\YM陥<m8߼⚍ӢyަkOfuܸ-rvMd<*;H
L9A~b5̗[뽴ǵ܀twnz _70*be:a&DE/tn6].֫ESoou;7a]ܴX[ܤwaV[o2,Ri--eLO9O my?'T
m̈LIXvB*[1IKa)76N+vؓV+e{.'8n[WyzL^,S^#ou\\gjt{7/-*˫&QFoY(FB9Gf<-l8!ծfs+MU_j%##dT3?,&S\9zO2de7m4KE=Sj&O֐K$'(ZdKn36epcWaj#@(^WsObdTvgP%I'%K#l,L&N&%UfDٙ(+µNf<;pBU H_Y˟>RUsI(@ydVb2}vuF:%݉}2Zaò6&o	#~W".!񿕪D2NTaT}-$ V='k]eF7wE"NMV	f;ЃY7;*ZS
ZoBbTԵ
BzPJ1FʧOt@\%kAo5rh]1.OWT\;Mְt>3lpW%2"h"^LmDy[aBj73CvjAeͯ 39,E/*P3˔qSPRbIDWN;S9[=Q J!0-%n]5dФD(&KwF޷GڷMַCҋ3ЦeIȉ:UB4ri칐(y勲xZdtZJ}7>jg6},b2LmZuiI0׌3F_?Ѓ^IĆޑಏG OQdgѮESTAY7<K_+~Ϟtɀ%m ]zDռovGC戎_
3sg??K8EntGV6nf4^=POn
R 馲ܬ=tٕD	s`rHlʛ-lnt3zALyS[U3}\U
}vt-NL>[ͅQrs@PfKէρbfBUu+7PM

/[Ĉi2Lp%(cրAj/Z138uB=QPj
AUzjyuu,jAqH+nη;o[ /%NT\˫☙z=e]f%j9̝"R[I}y\>,9?U\nO2G7PHQZ=<oQY.GFd5ݒgPyqj0\LLL.^vm<KB0ˊ	(\7kh:>=!/^9=FT0n~_y3|v2f#[NmMRuKCgM>,+ӈD!sw좑G0C!vv^
 (oeٜ-Iņ_YjΒ Fc7OOS^e+@fԖjOo;LG)&Y4&\h4fƬoȷ7c'vX>9ݟ8+㗲8Q@65_GB7,Ya<a+~ӷoPW_֪l7}qy-+- GIyņ9Vk
$I!Bb+?W]a]).w^r$+Zg&؟EТiL63w5m>^lePy}^z7N0xyE=@JhMvOerjVB4_Y0#D<9&F#ƗpDR/ G2 	w9}t!l+UAKt{J&b̵n$PQMiDοC]c{\4/h&Lu{55S
Ebz5y~XR.p0y3{JLH:7' O&n}s-g{%4(XSy| F  M+"Ur :r ]ϵ-sp1!AR1b_8]S57,: o0'sRsol.k$}5*)rMQ0fq0%bӼx๢yehCX7ԹV(x陂/u2s{uRQW0IB+.LGe2/hDG"%ܤi{V20J=|W	,	Eovkt(* (rR6xBHTa&t~?Fokf~i-i c >v#:˙Gv]F
JZyuT8:\j@mP8毯Ո.VCmh5Īk5_P!Q*R'שᨗ/lbt"-	{`\&
pb9@GiD$,4pCk> W/Iϧat4b؆X-{VL@sL`F;
ۤE@rgbSG!**[MFKgz9\f-meX˺ВFY(wrc[|eƷR'
Ӄ3R	;,љ	0Ca4__0,+OB4[Cws^W[cRhHí'oxe6_!?>M~F_jEͯj9QQ%1\]o+uͻMލZ>9[-sg0xsDϠr0ΰd$H**VSD4>3HLΑ/p5"GyIj2E1Ӟv6twFHz
j7N{dCf	[1Vq䁤57?!G82*@tR)6vC˃{,u)\ N,XZ̈́-奬-K4i*d͞\XsDrpӑ; iS߇nc<{:OVRRO'q)쎘mw֙㍈t@
?Oßc)u&W<GxXIb^ N0\><O`@O}c';Qy)Q``f1;"3V;PT^QQ.MR9pLxqL1q+a[p͊SigXwNq+u(ޚFq@u)7OIGgP4T?J#jDI֑FbTbICScl滋O(#ǎz<~'G14+5@@m|ΠVڷȓk;1yzHdaQ=oZ|9o3	jL;x2 I\^=^Ddz:1QŜ'4ϟjAjj/xEKt׽ycdVMx+E.Hg03n3U|g(&3|Ю.kóP)1\u7}pyEp1@ (*K+岈ϻ(mR01B0Y4doKNEdp(0.(5Y06;ݬ#lЌfr0 G~
K'LhzV<뷽݃ڶY$9@-%Y/+u'NЩY-{_qHrةo	b\DlI(ÂaH~A2=eyܨ޲ rf-.
&}	.~r^<!,|C 7W8[Z>+2o+ћ$O݂{JK:{9,*yZkX*JhXE9Tk(+rC}anf)qa\*,O++隃p8qRӓe+,z@ {90\+Ȩy&wmGӬ7eZ4b.	GOG8ne[0}A`:hƴwaz,GzW_=TIq2$Sf=Co&Y]o'TbӠvQoKKZs?AÃ^o2rGv1ppfBRd ދ"XvYC~aEy՞w)n/g^Gvs!WSHPXsV+(±(cy"U͹(t8
E57H?QD!0_y`>9#7>w]aꉃ+ou7KW<`f]|QU|1R$TmGB"sq].0kQa>!~zNwP& "@|,}aYpMo(YgI<_uXފeOGۖ-yZ%>33L}Mw6Nx*fw١E`xճQR."c<dfp}2ȊL&#T lβ}eD'p4~nB	>2'nC֪_0%a
M$E+SF'|,ى9._ZAEYӞ,,'oٖg9XR0'Ә
S5у6=M׉qN8qکS#._"/B7}P q(]AggidP,e9_g8fPz"W#9:/(oMĲ#Oaɱ)lo`6:/q/6VNnX-$(ދ1kn~6k:fi;4:J*@9!R}(HɎKH~'RpuV{^]\jSPǼtڝVq? _.G.&~񏟻uf~k\z}~iCufЋ\.);um sUҤah&uH%P`F#:ЈeXJ`:D(F#ˋ?PEHNpfxp?IK/VmI[lC>5g]	Α˚ ϽK' q]Z+b'm?w. '>Z`,͑]mL$rIs^+>p_ Lw闩^H	IZbRA@qC*o)BU=U辤Q_FKcu:c:˥x\LMǈО-9 |-.q:wDOӶ)54JF;&L1 !}&tɂ\Ii|txqqkP7˥4r1FXs1iy߾YYʉ\ݴ,K 5X2r>q6 .Ri#9Q߉q,8-@~DxӠAWoےd&#n.1;6>q0t7?0A|BwS(3fh6k|KR&>
ERп=^`DX+g8e8ɩ욍/֫QGn%pfVSsEyn!)ǂ&Mz}N$0N/:6uNZlo:Y$_WrcLb@zSp:--G{$R3^]ǅ{Aw5IA)G-6{s'p:dbDG+tΗjF,o6=KllJTd<M-~&PH/f)fKI]Pܿդ#DcI7F߫hR
0#ephC`x9n&nE.Vsxk?krʁxpOmA#g+Wi5,'L^>4"ãXUƳFʨgl!xL!}9
m ~nI9ev7ڬd97fޏJcZ9B>1hbk`w{gkoMkk|b19?h)9B)TBо{
jܕ0nY";.dwqROX8+ȥ%bKHvEXw(?ُȘ۳|ځj_ya~w2v8SAfk^=V;=ׇov^m{,yyr_^	JWy')^MhLׯiҦӛz7L*Yϻ{o^Sjo{d;vv_J?C=y75z}Qۃ{V*@Ӳy?}/Sk|Q҆]+Kʻf~_Ј`o5EvlvboN?AHZ&Aɒy)At lNA0qwe"u*SlV|Y޼LQw)LT~Q~ړ5߂j6wml 7;fXXQi-M~FME`P(gv	WN(K3)!/F~cZg`_nKuwҏKKGJG$dۭ<Ϝ=$^syƹ>o~||,fQ0<ZD/
܏s.&YDjIwrlK3Nc{~TgG;y߲qP9#M+Hח&%kn0ŃZ-KD% wC	K/=%]]3?q"&rɬz^b%!j4g{Jv͙JOK:L?j)޺wqK}%|eHC&2YͶܵu#Cd5]Me8*5p=&涙?txYkiu]\e_vk^}\$dŊVBoZ-CJ|m5Ѱ=̔i-_|/S-r@7Oi+\,jet{N.Bx"w'!}!S<	?Zɛ96c]oSo¿k7i/4WGRz׍駫8B;tb6(<NN'>^@Ozׯ<]73|J؍9{ϭ{}L{RoAz3=GB%Hpʹ7O{C%O3f㌬kThzCW)+=__
A0vJ T
}6"	#ކБB6`x30{M6 8|GGc~Di;i}G &{x|LhmnSj&[a+zx0|cxwǐ<
8^jj7WS;9M_UIL}ިǅbV+$8ӋZtvWmepGtKYCh <5adcD}

FUkҎѨU8`1YcLoKkEw'_ZӞz}".ZmƬcg=j-sJ7(	4Y%]]VBm(#-nFwyck3nΑ)MZB]ZM \hvʩX;)XIkѺB!S, Uq)4&aɝ7elnm<KY:qr5SYjl|qzIaaK 퍀b"lL	4A[ߝ]NrgYCg25i Ll94XJsG䞈Z:@틯̝yYq0P(k&EnP(8	zl!TF+7iguK)*((҃5~Dq+tzN8g2"4KD1A\1	z]2٧aQ#k,Yk5ylR_x`cA)tTͬ_̎D0ݑ	2#'5!?0?`DXG~Ua{ܫ<TRP*|]SI"X;&R,wfzN\ΪнE{phCvaնaiv^k]{. nt:xʳfcî7[?_le"Sg_yX<uafg^oO>	6*!ښ(@WZWgiE?g7|FKdPB߲.AhحgFղѶ۝5^-bvZb gݶ|j٭6blXkZ+#un7;MPl-ձ5awVjZTmLK<uv	j7m8d[ t}zW>AakD'hA9 ҵ溽6B(:6>64hpkmZvݲ{ԩ)xY@FA-l!]dj)^j(evB9C	tEv6,@z	{kmp/8 "|nYZhzqn]ѱA`ݎ݂,:])؄ ڵ:׀m|ڀ$Uw.e/
@m˧f-V7d0pT5X	xo.Tޖֱ/`l_hYn<yqSAcMԨ3|z64I}ӨC_@kV9cow!m՛&k:H]7:@n7֚@з,mHٜF¾ꆁq?df)(E-7O:|J2RtPbyPSyeJGL2ho/b@5XjyHsAoE[ठb>1g{5@aO|_Դ\a0*Ɯ}M>q'	W,-w?dGԳUp5GړPCֵ/9|\uv]{wr=|@DKKY!5'BU@0 (	^NAa@?rzR=GΨ#R@an$塮\'ްc+*_Q{8u&979*ȧ4<9W<]3/	p%x#"}|4/EUa"2B^^2#.$.gBٲҗD\$6	c8lc(i4r	o?^͗Ѥ[a?7?EWP)_Ґ?c?1J7QBShESYm1'3+.7VI(Z^bt6L8<Fw߽JC4]BãeO_aݐfg&`g:J|ihTV&p>7^ꏲ48DAG?W_{n06߿tU&JHM$]8Q:."hi5e!$K K50FQY2n4erCG/-7TRR5Y~2,V7RIUK0eBhUMZ˫'VVpN#Qqi0#J"s
9prp.s`鴱E09 \NPeR+Gl/8^@/e#P{y߫7t*Ip.e(VbpShfTjN1NyȨ?4޼2dTaE湜pLA:͆RUFnR!{JkԫL#Cf z a(Ĉ>߫ -@/EcCgj z˭Kjgo}9sFЉ}nnoc? uk社"zwK&*UO ?3$EDDTAvJ4mkrC;`$|6^&&Fw	Z.ZDČ% acfXdY&xgVg8 Ʉ8K݅}$|.{J3ŞAUTFj6ʄ;C'c'hmΕͦ1[׬d䄿|AҦ}@lkeOQ+_E&e$$thr<UP\bw8dpVmRW'3498
]60+	C%}U$FabzEO#ĵ?%L$Xy2T,2/cE/%&(Scj\\S hP&w:A
HQUf4k /çPJj$ߨ0BA!1EЍ)m#]2B:j	5RB]NOFej1d7vbyj/z1VIkhqRZ,zJ@}TM  'IeD9`.C=,Np71A`G АA/خG)>9nzkׄ[|>uSVT:o9@D|ɱ!)#N@_Q#3pٹ&t.#E04jdYJτ*y(UI7FYRn^uhZcnVޭ¶bΙ㍜Fyh{M2D$hq$2,|q+tbxy;q]Kz _RU6?CFQp̬7:+fŅ:4qU-ZSDYv92@BF](q>Xfk+տxkMa4c| ߓٛM%VuQT?E* fU$:x[6M pEt(
. {&WUN0h
OL)V3=¡qݞ$	e-x6"r'/8*_s[F a0QBy/ܬT3H.o*<[ug#IMy@"Y.i(a
1,g J8Sژ41,w5)Q|p|տaW@TT5	L5	^=1'q˟Dw`	ٿ!RHw*s?ȇiIFCi=DpUUV ݔQ bvR8>[m1Vk`e4M.9AX	kN:7TJI|=ie˷Wp.dQ1}?r"Z̰СoeF`n	ٟc=, y献rj*iׇB؉뇑,Ǎ.T8\ñzfoqf#KQBjN<m\!\"iT76|eEh\2n;Ϡ.Uj{]PAm
6ha^3Lv쇹;,s<v{ %"қ#k^&XA<Qpf)rW=vUel%ϕ<g8H tT(nKЫ=Ćy^xG^^NjP^ܸC:oӗ"^b%0TgogtSfYq	P֢x]hL}1 y&{6,-gEpN'ae6zdoz^L>x6_pVeawf$΢^wٹ˛vAB>^&KaOM5tȺPp0:sP
'54jqƮhQġFe.afs t@cdL֜ղhFuGu̅ԙS#;ʋH6R5d2>[QԀiLtWyx-$	Z]0V@aץeuRTkь.!Kl%		L6ʈY/
8XrċOGE[^(	oT>V팣GAwn/>ڱ'\;j%>z,`Q3QIf!j36KeV݈z'ݤJk@{Ȇ,i3D}!T,^ITצ59,J+9-"	Svy 9#.tp.quԗKEuX^Cp&0ꋣHiU#-85 1Ca/󩼧[s4l&iPw%}hosZT#'DU:;?A\<`?SvC&U	loK-IEđe"yˠ66{Keuv}iʉf	+'+䯒A,7Wj$Qrt7`)	GņcO@O}|~~H|BѨӳm:):՝*I'3|'gs:CCm	=*hI ?i0,`oßP:uGß[ dtې\Ml0J6vq	jdo=0aJG"e%T.w
R{"',wF25n5^l M**sW nrPWj" ɒPAih.ajlJAeuB9o0]A8)d0aY~ߛђ7·/c_k:D.K:Fyz 8/g.1o<.Q #t!(oB\\o.G'ԏ/E1qx)dKT@_!R(%i.qp)]NÙN2+nu鹀eEƹ
u@*$A*uP):S^h3_L\4R6]%$_Ml۴4s#sOK<4h}[F5srw?SiAT>$R	4}z;}t+"?0~:fVt;"rF1^wzzܹւ_ɥLTߺf.덵n~UMprﻺc`'pLUU?Cl6k`nhQ~t5sdon5xd;Y$d@bIfYTɜ{Mq')F,˙xĹ6Hi-L>s=W9|t?";~Lh>v,Vܕ^n6;uSTH'86iE	J:tο6g1{f~H?dHN̄JX2R4SIݓFkʆ@(,F	> [tt,869ou$n:g$:NO3ͦ]7bI54M=1S50+«HFҀ[kJzC<kMdZst,tdj2F tWipRDgXF}s(ű4RKjlSq"K]dI?GsUv}׻/o5j]~Ipri5%CǓ >3}_zd=m\=X4Oٷe<Zv,-3gz{ͥW"^݃/A[ct;t5;tR[$Ry!|r-ozچ󯈦=R@0UBZՁ(k4*KL.qݯN&c-IS|珻KjEM/Y_(5{
)~|[b0́83jm9>@of<xLs[l:g9PT;T' i$A@'E5K\Fa)?5iБ;دF e`v["Zbli\BF?BQ2Wɖ>t]n0E	UtC)~;8Dj6~j8Ҭu­c1RV]]^B\a5w 6|`vvsey	Wsy-j LVHz` K3M"EU |Za egdE>mQrkyF#jָ;uR۝콓ϟQj_ӉSUшc3;PRs~Q}^	쒨Y6֊.Q"R],_,+h)W(8f`"͋EPa/CЇ2a  gc4mafmФq_lE<k#39z/'%Ah4a	AgM,tˑCHH}Ƶ}
vzxTeU.1 c,OP}5| yfO3a5~tXTȊ<>s"@
&$_MkxkEb%A/I
86%qU6Our0WbȀWN:W\<skX(Fax_Vly8L/?{{wiUƺ0W+V~z'̙y]~5WZ|۴M۴Mm r 