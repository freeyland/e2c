#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res res_count \
        error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] v8(_'NZJɼ,T\ݾ$޵-,*$Hdәy3{ZgZ0k?03kLD  ̋$Ub  {T^Zmfobfi[ffX3׋i;!T8tn>d3v$礁n6..a0vi:MV}swqQyoað5ioU߾wrQ%..?>,k~7~2 VkV7Ho(5iW|UJo	E?$k=hDU]\Z_{5o;ﬣ?!=f5f3A,X:CVuA5t`tF9S7,=d}N8#vczap-r]v䎂c  xB.ŋ,Q0>9|gJ%۫_X 8e2=w_f%cO)!h97v0g8FڐeGg<fBpvD1ٱ(rGvI U)YXMkxte\5:z~5t(M0x{]4'ǌ~R靛x_bL}1ݍZڀh/t{~l<([@Ą5&ݱ3\s"^ |5n{A^&ƗϑyAq_FU1a\)?;ptw箌yeNS^ko7.hȉNK%~e+'a^14QӐrYlӬp7-vn0g!Nh /Gw06#Ŭ^:J;
V	}/:td[+F[v\ɦvGN{uco@N;M[INkev(F M WM ˁlii \CȋǿMnRcT&լI I h͠:vy^eKDanܟ_*H"L85~W&JDA"FYǬ;ڶ럕vemrR DVa&gն=ш5%sX˛q*g@G(p}@E_eto{z!;? sﳝ? V0ү>Iϻ/Kf?@6fM)pG򻖮RF$$s1d';ao?ʞfҪݦ	Vo}MX$vjy2d]'A3lߛ}uc\A"gHkޖG,bz h<2W(ˉoĊC]	O"&	c'?}`Wn|24ϑ-.:^]+~p3;]h,*s挼!Ȋ}T5a_2>	_(v쭮ڷw/5k=<i/Oǝ]+ՊC7>qjҸ.7h;a\dߧ.L\~z1$_+v%9&'ѷL=P6PRlmQai?
`e,T4'N|li
%BI*__ $6vnQ#:>a_[$[;[{?vkZ>vN`^PV/A0q{_gk^'U^xCy*C/1[

z*uu8)~jU_QaO9b$q,^\܍7مoUX.
2F0"Yd0рw9MyHKA 1
^z̢eXʌCf} *ARpTdRv׭#ɰ⽿:㲖tmxkVXz*D&((߭Dv2$zs.fBZ0st|%FH3&0ν^%N
؀2;V~I_t}ΫBbq"oR `p}, W<d/2tBy}av}?Ȟ;{;v3gޫQyF(om^e[{O33HI.4y	,Jv8H+%	{(5aSKMj5e!肴ݯ+y~Nٜl *~-ZkYs%xNxˠd!@<FyC\9τ|肅St? %Tt> ǌعlp'.gVD#/`n}XT̕Oe#wr3<RA"Fzw ͅ!BUa;Z2$h%k\K-ϳ <*΋2tRQnbtA;Y%_v.:nGe!E+0J2;{efMlgȌ/϶ٴ$DЍC1&-{y8O~g=Uc<AuW)#~)`4).FRSW 2_7bϾ oPSdYcoZM*-9_7z%d8`iNʵQ7!X{X9U J_<ԇ:2k޼bm:7;v`qhl5>yjg{UBEEKfX@gs yXK'o<O,"P>p1dKYI0i+']ulLMϹ{T4tqt[8dk%,nߴ@,H^@
*\)o;>#]3 F=+gwDɓ}uQƌ(OFؿHZBRlY&:qI<WdGjK_=_Wl}g3f?MiB"k,ubQ)UQYU%TlBLO D7cricx]i{)]$5mo\[	Odzw?loe3Ej[ۓ9KZ,JK65%iTP2i+]⌨9<9]R`z*PE[	0;ެjmQ?mM`/-$Kɖ4\A%{bI@%
IE13ʑ%FF7D\1 j{>rNTp4ag^e_p{gJ
$-df-Ŏs7.i=[f_+ <[Yb[.!I<*EP0)eS橏NVNROaϦ<zw>T`%R9NYX]bPv0$ʋI'FS%QRqMvBUPK"Kp$0 U)dQ/&E^	///~/S.TM{k+KӠ1.f"`'z!y6d0DȩT6~S5ѡhiEG_HhZ@+CAAus(19C1ݤ$1%ݸ]E#MkVpSjvI#LmG꺈A\O9.aץYtae~AS$زf?x֋bKdX\2㴒<L7Z9xFtQPKf%-l1-} y}$mOG'$3
g{dA&&Z`+!*5fӊ|V4`\eJuu
~Ď%p\![W}dfHC7vBw  Yt;t'QQg,tt~t!jEwҝײ^0D^_Ǯ{<ﺟ0(_k0ﺓiRI  VPR\&d9emO('iGO'Ɂm6bb얯t~NXvv%-Z[$*zǁ	:7XH|eq'yπJ*PU):$-0/[#'>}w]]1yGtuuK}RI"r-'-zrTKj8jD]4YJf+>^{u6ю,N/٫Q~TՊZw!LZ5*(ON'g8LF^kHbw{ׯdKڢ/͚v[Um|j*mB<9ƎA	nhѮb=JZ[;E>MVo_>rP38fA]ޟww[o^zegt\Dy(
ϼ?`ZF@#y 6@QƧڂf:Sˡ>/ \,? Lm<Z6鎡+52C=n(J;rlJQnLf e!yHr҅DĦ2F0Hܩk6pM30sEJtIwVb/o%;ɳoIׯUig*_a7?B9+N*9a(p#䏄>uo{x,$tAʃEZTZn[ܨ6(MY=^0rL:ι}3h
Scdu/F?DV@1Q
GT$:A$cR+gK9N/UYf.]8NVvFt{
5tk8{3,yftA{nw+NN<(eEnňr((UT~l]WX@0ܡ		w@"<:mCt>7ƧN&NҪ
foAOl&s0〉QnD呰;|,ɦDIǘ 
_(4;H}HVLR%=2Ѹhی4^.ʲkvI4WNM8ʞ{f5谨Q^ݲZ+5?"[hM0p{1cfPu{Tfҹm&WIXѤ.*{ "9<΋>PF҉3R[O<CMG.<3'kZ{~mSdʬ|%aTr:$&]e)ymGy'ϵ3eOs쉈qSYb1,5PJ'Z/
!0<ɣ*q|'wsڑ?sR.1Y.A(Ab(4PHFz*X<\JaJ@ZUM)AWտ!
iP;C t\7PdkTZoD0twNw36aTP!Dʪɞ+wr: Oy#733,A]0<uՅn`T^4?GHWE/~UxV	d<HCfyD0z4]͂^$WISՋʯ2{W/[kh iK2Xh_Dfq"u1N#!)#C>oȺQ ׌9ÀTz)o'o< yt(bP¤fu`jPG(-zHnjEzi;U&,I2wȭQr󆨉!HF{:"ӘRtIވЃ&-8-)H>.-:	xgQȍhyqde]AxVZ"zcl n%oBR"f9#WWChǴAfSZzG ?fc\
Jol~6CPd77,֜9dF|cLJs)HL-`$	\\䶇#"z!X)X0;uP+8@" މ2)-~Q4bJ`%ZS*sa"6,鰀WU|EYhd
JRA
b"F3!_
}Jk#BL򍁜nA&v;!J"skSQx/$QK86y a0e'vWM57τ3~&	g7f#ؔR3vOO4OO~6~Z:
ZPAHRZct<<WC?uSe&ǐQ/ؠa7E|p10
a7߶m_=I@FjVttM[޴MS4M]ޘoϲY,C!K$ů	zMV&+_dk5Y|\|͖BdY, /~j1vՓ;I>q3pm$w]'k%wQ?IRPFk$mh$ E IzQZfN]Au3r	1L˒p%-=N#ɐe	Aˣ	:4!g%2d}k|Vh<œQZ(-~9鑅"IQk⦵(/TbXs,\%Rk%d-ӯldJyWkh\7߅aRS:c!4e!^PYe2eX_!)"9xczGb^lRft'} })X\e͖W*ʄ*[E>Q><
W啐H&n$>0	m-.Q3E.x}-wCQK<Ț=J2\d,0\]k,&aW~X`oo`$$OЊ
LNwK޷{/nxXr{s#=EVPNIW1!jk7ڹ'[*TJXLc	JKVtec݄$t-rЖ@ƒˑ\xMkN2ZFqOThI9ꞗ 4MCSO]fE=aP'm]uw 
)&$H^\,rz{ Bω"5C!4Mè,x-R)PZ@0zA<٨7t2Wכzr#4C>28o~}*jonBG6R}l^^݈Dm{"+*̵ݩϼo}cؓM&O+7f1y?OCg/Z.R-lw;?INn{?>'6V=ȹᆑyzP;JkPs<HPzNRLlt]C|{9hݘc1KEu7k.к$v?lId*%9J"+kDOvɜl9#dq0
pmVZІl.*Vf~5X5p4tC?b|#^Dl̯U$4LP3LqDZLFӡ,ecoI5Ej,6YNÎofQd'}seK%er:"לsp,"@s+Y۝6rEP+j)Vlc#8`Z^2l/#QS~,\q/F;<k
Hf+5i_dnh>0i͚h__rRZ.5w_r03/<ʘ3yˢu{9b^[ObGuqL&Y*-\/.[npڙXT@qcfy_NW=򸚻+AdM;q&A{)Y`߰:M9`N}
fcCqxܠʰXS1Yz!QkQ1|P%(uwbT]aʙ[9gB=tZz@\.IvyTO$XPs] liu0`l|fIEy.T3`v͔9œ|Ent,8쐜'Nu4ʗSmZL?!)D}uZg"NԘ'|FBrOi_UKk%ǎ>ly-rxU#0}\s?/ /<dP5cfvk{i9erTcYt:tb?#{.O|K7G8909͋IIf000+,Fy!~N/v$):c&΢خ">_0EC%c1s}K32;18zãϸ)??:~k(FDzWcDyslg(Q%%쪲j̏({ag:w(r3FM߼.:܁-^2+πeyAqXXd
Txz{EA5>BIvooO7v|˝y4=?K.:.CǏԅUoiJ篁w+,n-"isӝԁԂzp)nxwh̪GA@B5kqFuЊ]+U4Q|<WA.(Ee"to1ԁ`TwfV]6)4НDB5p``y 9w`q0\2r,Q';],(0-uQޥ<k	2M\>8bd_wl\t.C|Uji+,<(Cb&e䢰#j(ƊFNa
k(w=ztœtFy(eAEvRaif9n EUZxy>{7 gW}ZolV	ڵx뤅ZpA8 :dt~HUw{-4;ya(+j'|nHf)Fd"IsgiC5hMc_=/&K	/Snra `zI,UX$00b 
MImFy:b-m
x?<	!FkGf-%wG36۔G_F@]̱z3bH%x_}_ڑF@X]LQ,%0{\wHTt=2>;2.4kԨ&vne{kGƷ'ռ5&+d*>NIt'ͻu#[dLr&14a|BڊǾf
&kRI"a-*'2d=
?zdsJ0m⎸r*8laK7x$byL\YЉ)- Ąi̬[xWMT*-3Q&gDP0Ht"#߀e8&jRjWc,MIShz0MՌ~fZGlӉzu䢀]Oh/VU[mV'F2h( wFe3_6nRW(]^RJWLʯ+852FyYۖoR_,iJ:+ydsKoUsZ˺EqFk%'L|;c\`gD*tTpseͨ\f I:r;`|+oAg3,x~_s0bLE#\uo؄$:ɒIR9)yqxeVuIN]3?EĜc?)ϐH1g1`Z!2Z52~#+!276=%iS1L& N7P UGDM,/Ja1rpy3HTaD)US8JSǼKA$c୚MH!N">*ĵOq31NÊi2v%D=
jT<BG4g{ɺ|))Ji918Kgv'm4Wrвe:aF_T0͍."nJuFAP\*tKĞt썧Iux5lKBgK-Z-{Ҵ3=+2U(=$i8諥LBvJ0^ĳ3{B6j]s*y208M9BP]qXv$Kԇ$v,t`;}3MRAYqzafUoUL/݄]W grZt&Q"0ti	@5e 13tzвDƏCg|B t-q@ Xp;;!I 0V#E2o"h8$Lm*Y1)++CAj-^w'ֶ88)%
#2f&ǳqcdQomeMA0䓪ū 
^=V8.I
&'%O3L*C%0ˏChzr9<$RK^lR2.A\D'sxJeefL\ON/5YAzʑ:ŝ,ճ4s[rp6TqY*~fy--4H֯2vmA'ЬyKfWFkUaC4n}z'V,.LnڈWt	3,,Q@|})fEJf/{sį$Js)YW=b߽#$3cLy3@\6zu;[MJˑW(*#qgS%fD7YM际<mx⚏"yަ0fe¸-sMd<*=H2L9A~b
5]̗[뽴Ǖ܀tWnQosaTt8Ǽ3L_)9+l\Wn5^o>ܨuasr]lnwsZe7n]ʤs[p3/YLlQ;:9k0J<?B|?6B(81Ǉ2rSe"D}2*߲(8/>ymRj̶Wn(14gI&܆9hpq`ʇ>8K78_v=xf(~ܪcr
곗pu\iXZε=-q7ڨKy7,hi&`ȗʚ I@Qb$szhBlWY[&/a8jY-'/:%
peW`*C'oR+~蔚s0GqFмuRi(fP+[ef1q\*Z]p t9XH}nkM&Tl5&OgWWo^a_'Uf9,koQ5-0W0|ͱq%R♶*[h	=J]wWȕՈ8YV[xIX*wX=wjr	xߘNuZhūMJ&V̉ks2v\]znukYFRq7!1oU{ù뜖QPdhV?}>z1CF2)uDxbRdޜarZtY=,jy^KDZfآYN@6l'gSKK,ʕL0ݯUHY3,ؘ-ι0\2d
  4;AtU38g5;1 Qۡ;LFOTt&%%w3I}.\RHZ"MI;t;d»	I/OԼJ:UB42h4*sgJC7)Mjn|zIb?	،ecXְNZ`Gv ENQg]ѕ见CRAY<+_׫~rɞTƀ%m ~Y5WzIUn(P9%@ k%pϲNh210ݑYUpƾ)8/QqVQfz ނϏTwܰ58σ\^RK
g[X,)(f͙.PW,-,c=*>|_]X ]q*zOɀPb]=fuceUaWrN>
 \%zկVRT*o6|fTyӈIddeMQ-,GeVQ*4GC=rقEoKv,9b0m1%h^{n7PQ:c_my6噠룲P:2dFfH{1Kmgsv[Bp13A]`ztc`a5˂>BQ4foVh:v&$0Y.^J3=FFT70v9><_$
 eWܰD;X,d9p"_obM~+4HQ^=Pݽ{?sbΖbC,gYNw2J;ʫIJhkdl{	q%͢4Ie>>Ǔ1fEnCoLK,#1|r)>qiQ^qY6|<!ꪺH)2qbB8)GTVI.վ[7(݊Pꫯתe.@V}hQx?=b#t/=[VFz?@e\!͈UYa[)p{(9.Le3Bϣeh@iL63w5g],/Pl}^z֭1N00r?c:}qթY|Fϡ߲$k(G5]"1rJĸzna$>m{ GX6AO;'A=bICݣaSڵ#fN%Oi#֊JO#rm暦x;T*,T4}_25KCIu߶6lJ Dse0#+tnNVs0l_w͵<pՂzZS
^y7G`."KQ*R%=-k/"A_z~\ˁ1
'9+>q0dӯ?2*n+ic9"XCρ{hJՍU2E"T&˅k@#:MÈٗ0Ֆ:L⩶w*-z_º΍ZƬsꐞ+RG+c;x!}/R
Z``_|$⒏tD^&RFZY}$RMV<Pj3&Ef/:_5.fߌ3UYPFo`)_*e~aL7 DnBch9r;oAkk7S)qdЅ\Pj$ u Ih98 q :\j@iP<毯ՈVCmh5Īk5D-VCT=OGF!es_st1prJ:u7XGШ?Q)ƳWZ:;|ϫ\uxԫ嗤V<a
*aFD<mXI/uBL3&5ln`F;-
۠N4oZT.5.)f2r.2"9X+ВFY(wrc[)|eƷx
LCgP㯠/"Օ^ ˃`np5xiYez0$Н-MzWȽ?/#˃s0P)H97~ J<*$Pёðhy7ȻQ5'Q&yEqtFo\cZ>~T.
Ig,d)]ŃA*svF9{9B4Fy(O92sWAF$,<ފ8'fV]?ݾY@ Npv`qs~)^Y8@RGQWZ+]ZRGg@tR)ѱ%6vZc{,ujr8C6pb%k%;xIS!;m択ƚ%3dlFXht	ObS1l磭	
Ň3`}OF??SLįxI`V׽ϓ0@%>IH]1_sӇ[Jb7v}μz{`VOtzfGyrAKST8&޳w\8t{JF0X.F&$T~ڙ"Ķۊ<Aʀ$Q:(|%Ai|ʶn_XL
Κ"`~zZ;3'FbTbIb *O(#Aޕ<~'':!4U5A@m|Vڷsk;1yvG+gI{Z|;o3	jL;x.*8Pz$Stc>97Nh?!ZY^8{)TXrWE(/eW\\Ύ1Jk4
E$+VZMf"]uuWYڇ'Sb? OI@}pyep1@TPX6eQpQ01B0y4jdoKΧEdpˡld :k9`m;Y9ؠ90`QAfs2* .QM>!d2Fӣruo`>T_Tedjto.j{y?^9;q.jٓ45MbCvmO@C"bvBsHE+zL-sF= <cl"`ҷ0.'To
5#Cg3<jUY_ 3 އ~_J`KE)^mk~]PK5OCY 2rB7MDNId7soF\wC&0H\T/^aqdۯgT,fT"&wU-^":Ml[-^xyfq1~)'mu13%/^<~2٘ 8q殨rxvWԶ6bdiC~?4aF:oZvB%6(i~1RҚ/ u^?{e䰏<ɣ2c ̄wy!fyARE2IB~}=零j/Znxe9\}u\M!BaaY9,fE4sgQ$:qW57b< 8F9D@a{_rcGn|Wny;ͺzb /PdHێބD}x\ap|B>U! ,tZFf5D׾7f%QGPnN*bԥNby+-3\S*ܙa'a/gfB[%hw27ĳOW2,@-'7ĳ5nq?!K4\u@V'}g2ac-AtB@؍_~O<\AN_'nC֬]0%a
M$E)	+ Kv:k{CQִ,{ddtXB
dst*zІvRYuNC;jgV3Ojtq0[Sh&F+E
 U67t($Z^rp̠d䉭EGrt^ o*&V󑉰#Oaɱ~6i70Sq/VmV-qܰ/{ѪT5|ejvoCF՛vlZmV`ۯJrC4Pπ#ڑN.nX[zk}޹ڟEn:~͕4Z4sިn3G>|_*=|ȶzE0e?/ݢWgy"#w@U@0/yt$°"KDtD@e&*2^(e:tbK4#SZzxy@hHtcSt1<CѮ2O܋xu4$H8UK|E$䤨5&,	1i١D"H)0SP(n~Ŝz%/&EIT7nhjǰd,EW9YE;/	;0˨4v>Z38̹{]o,ԴX+~&	gBoM!kSQ`.xږ"B2sBɝ(8w<JD	`3[,g/.nMe>^^o,}p/v/r}zo{[|$&
@Jcw.gߗg9&A02fkP2r>6TfCӮr#xq
܉.-yAMNsz)6;..ܔ얘TDF].g&9Ȑo&AvfluSG42K{&]ʈVpa8ɩevV	đV3j޿(z$mHؤIɱ3dIE&IY>ERU(7RԻ '`;I8RzGTU ;s 7z\ߵ~\BxG^8ZnQnW;wi
'W  >Zs^e"$sMh..ge.J2uմ9)TDLj!Kw4Eq)	"@*O)'
HQ41ߍ8rBNjh3V}VyaՕ&Y>I7wL3kzfYo7qZW׆הM]A#g+Wܵv}
O9sQQr,oQ%eԊE6w7SvȗCtz?B[fRND)M6+"?wk|u}l7;.1-!d
ycdLBo6>pfp@y*!h_IQC1___g[<l&Bީu..W	s)+Y*[^B{/zpw(?ُȘ۳|ځb_ya~w2v/8S Z||OF3֋۽W??K^ׯvz?S{	8j?H~k?AS3VSRMׯiҦӛz7Tϻ{o^)MO5iiN{('n7<{[ϾkvM{;v{m)lmzO_m}?_Dѻ]sX?/h_[	0A~k?d4߂&ӷLK,'cg(tZwW(_`W׳YeaggKѮ`ej闭oX{[NFkmUwqK39~>ZǓk)t܏
?wQ}섂^ę%(ro^6:+?ForcFX_"(3&D[	+y#2oh'<xy?Sgb(lz^4`Gh>_$;@Y.DFInrC,Iv]
7'=T?*#e/v<s(^APi"M+Ȃ&vׂOs1xIϬjee{SIm9r 9wFVKOzWr͕ƛȁF;ojwr]X]bֈLGMmlHI^ܘۨ_Yds#ϟ~^zB{ׂ,9fcXɮkPT;f5&vȚ+_5ё0w=k]BZT[&
Y]i?v|H:,Uj\\owhXƞOfh/iy}M?9ju\ֽPyezK־Kng:x{IsGԿ F4>6{f@^kZ(i	ZM
g*jiTq=tb6˘=xCdۮ߯z탟0'+~i	޸)'c7v<6S#iIQ2"<2I 0>]<-zxț3"`8n^ ( +{ƝɾOaA }6"I`~do`Q|!Q0P^ :vƁDg~OHޙ|?Gv.zѿQv4hlFZ{cO.[e:l<N0ք;?cS_qsxUf]uNNcyS=kqa22	|q<zUsnQo}\w'lLʐ>VkdZmҎѨUh;`1 lV&&f޷١" cXo6;n-auʬ:ۨ>v6xfcf@IavA6AhNkzӘ#iYg66:19M7HĆZ~}{ުf|n?666[3A4;Ԩk 64i1@^;PhaU  p]r`:qN&a!̹#fdx:<kN!F|΢3TZm&[yv)ƺ;q=RXQx<@{
5P6;!A>$פ!3r3:rhܱR0<3*䞈Z:@틯̝&@8 	L> (8	z,s̍1Fy'A
fW(҃5~Dq+tz#/peE iX!C..r`J,?dOoѣGY֬g颼R_z`cA՞%騚[`#dE#%GOB`R˛0?`DX,G~Uf{+?TRP*|]SI,Xe+\,wfʠrN\*ӽE{phCvaٲaAjV^o[{!j\oۍ8)MhX3]OI#/[~^fֽ{:Ɋmc]e#/[_7@EՕXpf76iL7zCƏcjڭZkTo٭mmi]_gju 1NK>f1ЄlZz#m#5a7PhڛMٶuiwjVjXTiA2xj؀qƷPэO6׉OЂr@M[6,$kn9U77ZViZMQ7vl٬74\"0TO1s,B-Keln66A(w <t@G(lgTnZA7#jϭu^oZh:nt6Vc7vk9hՀӶ ^,j^u§MHRQuP6nè t|j"xn6|S SGU5@qmy}5&G<u /n
Xаuh0`ls!&|@"q{ՂF4o5X<y}l65iDZ66vM)C]QZl,%+mki';h-Fs>ѯo翺a`O'ge:i]Q'G'y
0] fe>EQvt$*&( Z#`PȃQBI|0CR ^<|$05)t(X0e`}l9pSOt4uµJ%K \|n=zC
&BH{R2
yҺE?GdNgA?vՀ٦VozzȉNK%X`Iˬǭ0ڍrs |cemJVDB0opmVZ򞌂#ga(:17~TY.jopѕ;z=\yv~S`~NaG}?ŵWmvNjx_d?yڋѢ-r
c<]nWJ9Iu!|F|nM;[QXzIOm>0VZޙ8HJA1O?x>H{E<u'I@z5o{G_nJ_oEȇ
*~¿KCiHt+}NHG	i;N9IO1wfIĜ̸RZW'!heN?B1Pww;HHsxkPq&`)g*7@'Lc|L$}n'lxleI7q6b#	~򟯾z]/?*_e~%?|LrcA(>JPmi6+ek,͂,}ܶ+W7#{eՋ+̔1t(^VJHU?p?zqok"K
IiH6MA8.)X/'YHL/z0m?O?a$*9	+/iS"宬XS7~FMjWY!26.$' mFnQPi+tѿH,đ-e#MW{*ɁBTF~d9jYيB)4J4w
Q`
LI>G?V^,eOevy("uzPޗ+jڛ#hs*m##(ʾV<QWH9* 5>߫RJMSJk$(dEdr an`AfRޟ9#o mxۇ[(ߠ!? 	dKo)ONxỒw"C3v]839zngrJ3=j)r?NdebEl^":R)"]7%^!R3,̳@3h]YQZeZX b,!^C/h$K=bObŭP`%<jȄOC+''<6YJDj@T%d`~Wg|Ҧ gcOU_E(e($$thT
UW\rq8dpVuJ2y($xAdIbM+Ar>$aOĦV>%<LX٫	2Ҳ/cYwf޵W*^[*
yMS~%_E>[0N::@6 f=	33.[)V25+V(YЍji8zet3Cc2*Ope*~"'};Ft ^b9+JAp Lj0BF!.X-y7nz$#ot]s?Y4(}ʎ
Cpc̞SuEBr"n2X,Ϗbg4⇻HԉNEAX&KB!D0H"{HxuIsagh8Z;a2x*e<'+$	G}&TɓFJʸ1H_uTݚEŏFq$h~o,;G.g68`/cA8Lg{-܉hJ+/S	3	-/j;cft7jƛ;g+E3!pͼ9#.0mGeFIg&H}-CBBmv >CKqU Peea~3	HM01,2ٹo(bN.i4 aƺNC.l3NgCQD		ĔoJ*ԗ4bʈbD
ͳyY=]9Q"ӇY{A! 0wbPaDkSd;*,f@p7vĕL\fNsGd$<vxĸے;ïW>]ρ_'fL'EG2SYfUF>p_N:Ҝ羅ī}"4WϚ}#wJa㳅 hyl"/ZXE9
Ű8Ƹ,~WH[X
Hvf`X) Q<vcm+`Wg?@5)nKr/F^9Np -/H#!s[@;amnɯ0r@+p
p0ސq0ddB7ײdWn6*޲ (cv&gNl܋olo1Ý:1.,J$I]ELS p&wC>'v2l R^JshQ: =Ǣ&AVUn8 ZL\00rQ݁ +RDo[."nz?Oמ3P.d]ۄ`F0:sF;NwA]4=+W_R뷽݃+mYX|= 2ٱL7 :LhЪ	G}?ڴv^\EafS
w˕7
L67Ij	ˌ͕vn+n@8IGBbIʃfE1a0Ʈ(&a0(-wH a|C'}B'ѽ:_ 1zq1@x}Jyȡ*1{4K"նe<^pр<BdG4^KWlԥt{IVf^2Cb(֍
`8p as9\/[ksd=w`Z@l26IFN-!G~eLejdAѧ]L74:RK
h:$rUr+V*MCgv=HYD	oKq0*kyW GXM=X&Z#CbX"Ћ{,U1Uխ~;y ըzbomOJJ'R<	Z~йx~
AܩFQmpbMf{};cՔ 	:bPk%2zA3KP*Mb1Qc	nbT\gP[%9ncTnLcx|<bcj^gPt:Q))P`ѧVQyLz`st|7%PQӤ<@G zw!w6 >;Sw499M36ᘊ!ןP5Klm"Jdtz`4¨nmEdE#]'X0]4ǁ&LA歆ԙvD2;QwcuEU2y@^
'2.U^\ 
2oj5/(;ᨩѮ|m!fl88feϖgt>#no.N*9btD9(\`i3<&%8AY" g`6:Ѓ3ZOI~HZKϪBr𯈡u>c5huD?O0eg	{2%[E$mrWEv#27㕗Q *AvW0\"1=Z|1qq?BeIؗhif#ӲJs Z|$n'<!0|w3>Y<Lj3zh2';GT=>dE8@կyk?;ZCwqa^~Egϻ;6`kΝ>쥎ۏί9UohwMVv@rAwfǏÀ3g $<3 0M31JQ40Ϗa4+!zDX,SⵌT̞iCME"?2g:HSX3''r/a0{Z"QU%ݏq_<G)=\ZZW	bj5
t&]V&N )iEG
tο6g{f~PS(K1_r&/IYkJ/yt$T)5ytm4욹	NP緈׼:3f7a޸fkyx(UM}+p-^Iwݳ]x%dZ}tE<tdj2F t>L,춛p2 ˿tJS&Zoq*TrIZ'fފ+pܾsh4[^+V ΍W_};ޅ/Ky8b=֨6J0Obxx$4lJ<: P4O_`sK̙ޗ^CtwQ~/[x=_ؗZsn㿅޺n'ߥ3oKx˗AH۶pT¥4w\KSeRΉy@`e7ju\I,iv%n+/'=CGڅ q
F!U$a`XIotMy5;֌\wb;c+M`o>/KtF%ܰu_ons8+mxoh7ܡ85H|.ChA. <QqMJI_	^D?er5cv͟=5ȍcr00t+jRIa8[!EhtCK) a?A)Ѿ{RxRs7ߘIA$^k~Qʉx|Nw 'd̞+O	4;,#4'HN?qߤK2)
zhp)][~2$P7 yhvyG<|N	X[F﹓#?z'^T>;!p6<> v;
},o囍(9`V[bbk^1hkvVhvf9ZaZ7t8dI&}RSl%5Ko$>r:+`iW)!@o@qɁ`,&AQ~E%8@ fH"] 3=Ak̐|4.l@2<@Z:ViP4Py~rq$AX4Lsp t'$M?T)?#C Z$u
G+t@Ds`-@D` Ԑ\8;voQ0
,  葒 \ 