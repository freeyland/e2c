#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 R] vH(iZmwRRIrv֒{׶Y	Ih  %,uy9u50|MDDf@$%Z,⒗Ȉʨѯ×jZӡZvnwڵ6k?Ir8'psArD;Uᗤi[fn6.._fZYo5~_vEqq;_P[?xֺwr_G*Fz_k_r %y_k^4vN܏_JlGvW|X=}ɥ}^NZ~!;a|o%b1A,YVu~5pBxN%3'XzNܡ:Qz̍B:$G,:sCJ\/qر3/OA!G#%ϷxKq{O/v09%ۭW1:Lez(OѪ0` ( 28sg$B{ `é@39x(	xٙFV!ׅs,UJV7x/~+?.i^ntkؓaE[`vYKOKK$Ň%
rtYisV7@8}O>c6^0]AĄ5݉=sa%Bj\;A䞸}_@u#2|VFHѹ$9GI{kwwJ Q8kfkkZv~7slgKK	fʖ?!N=hf0h!?Q|_ڬq;-vӮ?gp<?/'?T`mGɍX}]Z8}!`vYs$j]iXU#:vt*됧SYۦ-ۤ[;} am*MEHjlWdiP1*A4L؍FMnRcY kRM*IE6欐AviKDaN_V3H"O 85~閖WriDhNXiYIYUw+w^e؃.*
~TA*gRaϫMCx:eyoMA4S	kkozBv
~Ow,S XJf$n?8/1٘5ƦZr	̵Љ;1[vo<Vb&Xiu5fVˎ+)dy2d]~7m}};{aS߼z`[-1v?nnmhC޾2燜6vpzq#ƭ|w$?$INeT1?bjl*˲`ІX
OWAh^Z/'ܾ'-/6P';8֒cGFv-}U^;х|<P>!nq	T6Y8C^N0ewU*Q#Q]w^TV0n_YI{qd}(=ԯDo*Ǹ_.8pI11BDRC7(A`_P'e~]V <sO"IüNZb [I&
/NCOM@`$rfm{c;:˫16DwIAGezʏpwP@9qd$<MK:rfwqw_nmnoY۬_s Vclb#DѥR4+Za;]N`n*xdVrh1ڨ-4T *Apr,yzuOQf9AC%8T*Y܍08oG/^J@HR"aDduVfK
>Yw"m79|_pͧ aq_`H1O7Rfũm 0֥`HSeDq3,%]]e.{ek#Gr9fTW9e|/Yc/r>Eb\ҟTM$Μo4c\i3u6+/^^r$7Bq Ӥ0><?_e~e}nvVȾ3pÜ"wwg:)[~VȮ3rf՟Z{TPd@@BsjsyQ9c7Y~R&tt+TA,=FH8vq ٸĐnZkX3Hys4b6<w sOC3>wiKTC~[z|ɂa %ЍP ŀG!plTJXU[e3	㶬3gXYN=|glpHǸޝ%^j9X)[eRŹPݤ\".l58.	YWQ	&&xO/{v58?A:~`Wgh;C$C&f)(\$%(g y=*Y#69·#OeQ.~?)H$#Ǌ.NTNuOue4I#ļ3`ԕXlb)PpӉ02@oz6{	}]~%܄Vwv_><ãGU%dӐҒV [ui(ˌH^a7lɵ4<=I0b)ߴ	M8.T\8OI*k6eK2CMVե#*HA׹mC;䶑cxĈ1tJMF ֆg+Qd'(bFWC_$-HoZ!)gvY&pa<WǕUT+߼|79(W 鯊vD1v?	L%ӄ2E֔Y"ہcGKCS@QT B!LOMag9Ln蔮_//<f2=y+lE
P5	a2,kLĤ'Llj1WRY>^Rʦց|frJzW,BwC?dvPYR~p*|`y>EJ>^^r/^)J#ȷ0F㨲/%$^0.4TE!ab]$b́rdڸCTmo?P%7VvIxojTɢָ'savũʊrIIX+Ә
星Q&0exhncy)cjq9Si		`YII]lPr0K]NbI6 ^ʐsWDW07qVc`@)P/B^1~@r=?p*Ŵ!CٱE^??62e:7_3+ty҉bM$4ɡm LfJlPdlIutnWHӚ9kMsNu]vEL~JYTa} +3h*v?||xvH]6\L*)sNŔS+v5-w/Ss>˾Lyq\n`Iu2NX?gUF'U1٪,K](%V,5{Vd̆Fj(]GfSIx]:!w{n{AUqZA0&8<,n8}D9(ہ3_"jHjJ1go@Ib.-%u3b߶`v^9,ҿFFםL"m-eKJDt3 luJHH|@d%> MBr%R>vK׺fz⹿4\6,
y.eɏF=7XO|cqyπr"V%癓DD1?Wv޼#>%)'*VSՒ^Z}G͵ȲUTN2lwQW}[ao"H􊚽V+|zTw^RVsOⓋqWvxtiFhE.0a[Gv؀wh35G,]l4`n6yxfIŶH01
6o3 m+H]z2;-ii;MRr<gp{WQ0qBsֻ݃7ín^ؗaFRʭ3C)Q'D)U4pCYFxTd9љ+j)*	rrrEJCEtOE#oCkf&;taΏc*
Ҏy{E-=4hɤRDA']f_Hj{i>Y)e悴(6&,Yfv	f(w`)v3V#hB(=ve tq+R.9֙/Λ-w,9r`_ҕcd5r 7`H0rM^PȲS_BgG<$yG,ӸMٙ͆igFVs𒆡dҔ1/*0M'03!/BZM!ЍL9?@~vFĬSĠx06ƐX>B]	&ԥg*?[e$1eTKn:':֊|;;'9a>oda9JQ~aԤWIGi(Әq+BCL~(fq.NFqL%GgsR[֢XgPa M љeC65}TaV;cBnw3;Lފ6HR̜=FRnLd32"y%['FLh:;/1EzG&/BW My\uNd+e%yYzr7)wc?gTs5pb\s-zaFY^,tغ<KL~%@)7lx@ao%(@=1#yZҝ]p-m>sD6jE촞'O"%⁐BvFv682c/{GꂓaI(oN]r:K>tm)snhVƙX9K2)T~y&<+&z6XZ_MƐ\#=TM;5dk[8R'q3LfcygDH	,!mԘSnKPnU	bZ?fJ	$VDy{ҎI=Ɍr9byAZmtIֆAyXkɅK|
HGw	-$IKLI#TPJb$B$
$L'J	*:~,l팶7@ \DYJ~,<`7	k{z6 }(<le [jgju8ɋQ<oB-l:rH*:r~h8CzXxWk3i=`@vov@aFϢەt+ߞf7MSizUuV`[ʆd`(Ҝd.b?VR4Ҡ2R{e	hk1Io9yFۜuOJ&5g c#)R"ʣ!J|0?ơX	n)aQTk~NRr]\x[yOIN}	GJ-TtjA[L?8VюTU-)I@$ -5ʤ)Um+c58J雐H&E=xr!	pDW%WYwÏ <d	DocoYhӚOoiǣYcRдMNb=/3dN­B楇3;R[`=ra8kxEx@>PHT{>% L	ْR!5/fFj	+Xv7ȃp&=PP~;
.Ɖ6	4`#EH #bf($v'!P̲OMB}u8=bI~TD7Ng73횤MŅJ._hOT};IxOyi(qA)4CʹfCe6%Sq?jK@ "VL+u??-?$)?5
F(tZ#.=8֠Q~i:e2#ѣ(XMFl"e>&UJoT"(VSjX[:Ch@[2Ԗ%mɀ[q-Q0=F7yӖ7-yӔ7yS77gYD!5
ů&Ik&Ik VJd
Y ._"=JTZ4$MQnwZ|׉Z]3k'׈kmh4
IyIjq9:Kw9IDz|zc;G82-K[bk,k7),1Chy9ziKZb)tʚC-wOft%&)`eˎ(ъ)1ɱj\fa7kG7/vU|7g3\>s9	)c_ٕn&ы&{C{B&s%6uīe!J_ T,S@2,?-*DӫN\-x/K+y-%OJrQ4n%'e2
-|gb
,w-Lmzk^yHWL"rLF=0-8[8 =8xKr[|pey%4=M%Qiw*2s|efn4+;,d/70b`x*NwkP"^!\e܊psOt}U}!:þSUvoI*|#Mvɖ*Rd3H"ZL;S]k!	eqz=݈=1P9ĀQ22 GvӚʼᴖtܓUC2a,j9H#xSWFJuOTia7  
6$H^e܈,2z{ Jsϱ"5E7!$mèy#RQUC0z衾o@<tRWW7z2#4C>2pvD'^>F\7S^iW݌a.UF'_yěWw"e[H*xѯs~w3[Z#I\$ț Oۍ$}2"hqWuF?􏥑FϮ:cԼe3Rq}?>2k|S#!Ei-qqnǊɜCWjh]`5[{aX:nHN	;]/ry` xVO+M7Z4 d6.OŊ%[u7Lő(e=$J˫D(Mv싏l3d?/`uV^)ӆtqMMx
tԚwE#^6uEl̯gUˉUMif8)B'N0tɧT`rye^';|eYr6iOIӴ	N2ʀUfG]<-tr6[%hd*i~no'eQY2É)?HI'^ź<HQ`E|^Z@~&ےI]b?hکwza
@8a&k)׵Ns4_x$djSi#Da"֫́PDE۝jre)#]"(ʁZR*f뵬 5r0I>LhϷuC#Nz`+֢a4e^V4N|
Tn)Ay}{P8Vwn9<"5iľDSn6¥hcvY4~$\5AoACE0NYn@9e]g<'1f"fͱ2W9fJ+WKVlf4s* rxlf{B,վ8܏!\KyJցW2:J9YzAR߉Rm:ӔHt)Asd!.	"<姱l;k*RlI^S^7Sϴ蛡VD<"u+?]ohnr_BgSQajUM'^ PR)QQڟ?=fXEмY-ŎMư;v@w{~8>;p['U18;ę1a9zѱ ȉ.vdBBvڱw4ȕ(Ns[ҏ7t,MَH	`e62MuqK;l$`()I#Ўe&dG#$ U26y8	е,n,T	܀)Vi03TQs<:8	3q_oêy ͨ	lod'lA"ٓq.7NHICֵhq~ST[y=aœJ\66SؿpSĶYa7.#s+^|h2p}tǝ0cSqj7iq|?'+[~nYXܢhBF3
jF!R;J-p-N:>D'Z݋nI}O͘WíD,dfMv070`={ؙNj/t!U{<Aw^&Vp"-$lS yypQ꧃?ln}u{o2axL[fǜ՘D*V7T3ȋC_mѴaZfdr/+6s 3`gGX'n?`O'@Jo^maJw2g {j{v w \nz6,;ָM90S x|aޥ}eyEh}h]5u3(x8H ;v#gpV.(Խx[s<9GZf9nQ<Ct|Rnbh>@Yg3;eQ/v0Ӑۯd:Q>$#s} <s.щo .r 
Lj5w{>Gzsy~1=ѼrYW*nۗ390[#~A$M]b8E&61Y^^zғ<塔-Yb9~,@Lw@v:{lo6 ثn7`S=uzv:i=f43x2A ދg/(m
(Y'l}1f	*IYhj8tܼlr	^K{1.SZO)y_ԔٿZV.7F`8A0YHSi|ȱC`{vXmJxЙF@)AAe7)JRӕ~-y$=/¡Y]D%t!ȃ+crCK	"zrѭLQWq{/qڳsO#1鎓Gu2#Ai}	:ËQ8(:J䫫lueY̾am+SH<_^x#Hunq"|髒"&qՅiiսRjUpbaI8kz {K4˫y˫Fg ĄIĬ>YqtWMXFnts6B()/˘I`sx<w<H:BMTx|{)hvN8<dUdJ?fB{2mpe6 3"LdeP
_ܤ P<bQ0q^1)nRRmE
\Qϲ-]*6ztyYKl4]4#)SR=0hl׈vS6\r*8t%|űÜ8\iK(Geeݘǧ@aےO7oqk5Yc6)5E`d3lcaP0ƾ5RY҄
a4.D)9T|Jp^*Dd:klEW／exvr
h<X<$_')Xێp\%%(XR!J)LAN@vBq&b2hk{դ3";İN\Iq@_2ly'RBa=9:}Rd3`LUi47grs\&|jeB9MRBȦ)gUQ](5"p=[4lo|gJejZN$	5YR{o9hRN1c#Z$^10/,{FZ5KٳNey}Dm@5kZYYKL$yP%+(=(	DTRbݦ6@>mW:YLGwbVB¢mYMCxHA0I8r&(TClW0SVS!qC3=^eRXԬ8\IX^I,YkJCk1$ZLb8]ZǁQ6 1StxԲp
 ?r1x2SǤ'6]9-VMPMD,5ƻݡhib *ϊGQ<;{IT
6a/d$ >=<R[ Ҷ8E0p+[3$˫!Q+'V*^mW$L_	Cxuh(z:.ɬW>D+a4yp+ fֹ2,}d-fp`.5e2_j(tyKMb(u^SkgHNJR	{2'[!/~=OuT8frW6h֜R;+@\dyfJ;,>sKyo'urYXdLe3R!_Hb:Vi6}aט~eDQ*A1?bZ
Tv$߽WsYibTW#Y͈m%s)[JK-߶RMe>?J%oKdßOt̕մY*R߆+EtE`buU36u(O e_[K0fىkRlRHt232_f}pOviVm<xӾ"R)fJ_`B]HHi9v|7vVxsօMuaZXf&[8o,]ʤ(FY/%p,&Z6JB>J5K+r@q7>{O%ژL`U5ڱPQTb#$	n;Cm$em=7Wq1U*3V>;+KЭ
p

c{zL>}>toM}&gjd7/-J˫aJoY'0BBΰf<mEUDtdTN9P6fV"~˥F0F@rRNm@ׯNqeN%"?ɐ:>ߐs(~h{D'O)paH%gc-%hMCQo  \.A%TIII|F-K`'>#IqEeQvz}
%o6pO$G8FWHH
kCGj"G&kl%"cϟ+{;o^c_ݝ? #f,mcJa50UOظa-5$q"ҦSkImV+sQ5+Qfy| k(АlNȮd`z fGEPk꽅 }&vHEK]B 5PxhuW>U8^CF_
BpL eCbeN5dq)AZjB[fCEG<Ëx*6(NZ`;LHaonTΩ̴cB0Ϝ]:Ll+.79% tz~xK9?S8ܑ?e򡤡ہӢAZe_3MB"|V3^i/C3ЦeIȉ:UB4ri9(y勲xgtZJ='j6_|,.zTXr6i$mq}K$
kc |$bOs_xp#푏'(2`h׃#oNx")ߏ%.P?Wtɀ%m.]zDռoy1#ܸQlsHǯ @TSϟ?s}%Nl7cpf:Cs7S/'7M?Y\)tSZn؃.:JqK9\0V$6ehvy67HN ݾz>~9/鴜q9 }bQNy`DC%o{^nUun^TQe_|d+1-\&F\{?HeeS=3;@OU(+XZYj92V9n4k;QMr-cfa wʪ3sH9o&ms~T~1>K><B#i7Gi4!lʳv7Ge2xvHtKNύѧg3ƕBp1331!ȗzxƖ`<<B+7o-e,v|,M{C sr;&5	:7a+|]S|vz2f#[NmMRѼuKCM>,KӈD sw좑'0!C!{;{ۇof\lb,gI #ih+)R PRBjKWǃ7Gѝa&\nȣW̛BTvh4S|}cV7ۛ{űf;Hy,mtK( |5_GB7 ,î\a<a+~oP7Weeྸ<C|Âii+5aY	I
 $\#ğ.0.߈	;+9L%3BcOyh@4iKN]}򅻚6op~K]M2n >/f{='n`͢SYc F%4u&;Tl'RU9Xg5y~KZ!io,S"F|p#iqDG.R/	 2 	w9}|)l+UߡK{B&bhVS?|Om#BE5&!9tyN53MH<ӣɛ0T.na~s*9aIup8#Clb%`(Ddg0tfNVs0S1ύ{z#g{4(XSY| F  M+"Ur <r ]/.s+w2!AR1bo^ORU5, t>`L)N?k=4D*I]H"jUR"eţ&a̒iaJjKYT[ssEHІns!QBS_helgO\*
/gV\1yȫx<^шaDJIҊJ"}`a6{XLS©ߌ3*P43ThpQ+#Sί<l\m~.j~m-Ǚ# >v#<˙GzF
JZYuT8:Lj@mj7jp_S!HyZjZWjHTt3uj8l?!y61HÞX6Ш7R-ƃrZ:	;A:8ֲKyi݅j( >I4| a%=?E,t&\6nC>sY6(e#̙VHVJCS&3ʞ\_WiK[Y%/F.ƵQ(qsV*<뉂T$tsSP(M91KJo{SVLeהkX.Z>"~pq(3#3^ߝ#zW/f/&Cg9bgkק\R+32AxTzEEaL<Cңb]^lwϢkV\9jƴ<l*Q#*yS0>+LƧ=(X>ɾSU-OkSbs9oxQEse殚txd̲'ƫZluS;Q=zs%CNHǽxRѡO-8vARaW˟]ZGȋH C:)ߜtP1vdC˃{,u!\ N,HZN,奬-4i*d͞7\XsDӑiEσ^xt16ڏSm1W&(8mwH=R8ysL=9_{򾿌Cqyc d48<}ȈKq$O3;OعBp9M|5g6zOtijʁc=ga]Ӷy.FoV܄ęO"[kWڨCӗ8$8l?	>}K\?c':PV#tOӎ$u8×TZc~WN}Q9vM=J)D^\	rT'jeAъ<zkDZ)RgyӪ]ggyOVc`کmƓ! H""Ӂ8DӇhR;gU{-qŏ	I-YrWU(/CeW\}p`ܚΫĀ+Pmf<]uuW^ڇgSb?8 OI9:o8bZU&PTX"?Ｔq=H`R[̧UӨg5 ,>
Ysldtלf4hwΎASڛaR~s2!.&R_XL?tou2f 5:7g5ݬaE~Jq&5!S' }F;9"=&Jqf{<D6moqGp!U0[NpnzsQe1gbXX}[!ޮ$y_XX/a!W֢XRQ
^V[u_,ZΨ5_CiJe(ӥ0n(q0K㲝Pcyʖ_v_AL}э2H\T/^a~dzjr fXY:Nln
SbyRϋi^ϻ d6o1<$.<Ucnu$ȍie;Y㞬.:zehsl#fAI4 "6{Sm1TNĦA%/G1(:܇ovl2rGv	ppfORd\?CXUvYC~faEy՞w	sC*6^p!WSHPXsJñ(cy"ҕ͹(`<ȍO$۾0$XY{<0ر]80G^0c^l*oKl`)*Ҷ?! 2߹8^o.@µ( Ox;(dUZK ~Hwy;nyϗ -6A]ĖbzYӑⶥEKl^VɄO;3rߢ-A!}2θz&Fhvha;]A'?ptyY\}>=8l*!/؍wO_	>a#[<W4	\!,5asszcep%;Q5եK!/kS=2Yd-۲,K'x@t*zYkOub\h*/N\0믄xfz;ƈ+xҐM@S-@\KSpYecifu"+TKsbYNy\A=ylkD甈7tdbY+mxY0X~6i70SWWBUKy\'3zY[:jZӡZvnwڵ6ۍ?A^\('3@뱏9 IA9R_*P^ǌZkZkk}ťen:}~wqeGW.G~;5F0
O>!:ACgFBc:y҈a0*uI	lS}مVc:eX!OJ32DI;#˃?TeW#mWqdxpMK/t Za1/ă.gjЮt$8kkDgNp\?1kw՚ _!;=h}	9)سr^]fiUPwmc"l
H\`w K`:KLrJJHiҒF㼤uXֵK!*顨zpƌ2\ٟ3[]֮7^-EdjZ5?8|sh;rp͐٩$=CgBl:'LᜧPr{8/5ƅـ;]Px7eOۍ[X_.^-}t.vWKGnh0,IﷶRL:=`);/	"r}haȃr q{<[2̺H٣+D=;E'pT b!SN_@]LSz)6;..9\bR[nql2`LaΦPߜ/&L }ۑ~oDX+oe*
?"JE;jgSE7y2N$gAIaVCԟo`*S}=e8~Nĝo=#*o9=~BZ?j%#oH
J9Zn`U.Ǔ	ث}ixXbns[Mh..JJ$#o6vp9N\-=\|^7?Ic^JX *;Iɫ3tN>FtpόIeط-' 3^7;]6Ίqhv_ԛ8[Z^s'W׆Uה6-gM.&.p.7 V{yӪWkװU{Јx[`9|OW)Vzp8]ŷh.JISJ NGh릹S`Qjwb͊JOZ}	B@nv]\1-!d
}up}թk|b13?hf)B)DBо{
jޕ0[4jtRZeJ]aE/dWˮ=^CY#2f;OP_ Oe;ߝlw+N{OE>:87;cь|rxP@rퟺv◇{vݮp"U}\~`OzIQ\:є|40&i?ఫzf?`Hn륡؃]&-Iwu.?UJZ%}(ۮԒJkR6'~՟j~"Qڰ{`e<~QywTOK7VLz=;(wrOO(2?y[M%(Xb?P?E<N.d³	&QdnZ_ Ί/ssVXPW[|.Ei
oX{XLFڍ:Z=k
<:HnZ)tO|
?4Hz	]Uȋ~wYCU4ª%:FtC4&#ogvfVgƞUݹ<cuvv{o^-8_Cs&i2s?Qt#;pmKe֦;Zs: %ے%&Eo}2P?*۳cewv<QE8(ˌ$KӒ{ӂ5m3axsI%"d{Ӓr;g%מ8y9phV~/wbsFd=jjcDM?pF%Jߧ%uk*[X@^kf%pz6$!,f[͌Nņj΅".E+񷿵m*c7r)`Zm--{W]?2BU&*	YV %rrUj\\owhǞOfJ醴i*\|j\[mڍ{wr/֡~suLZK־>+A7~Ǚ{y!2ZP!D'ֺxOȕcZ%Z5_U&Z\U^h#ĥ<$]|?"(u<vם\>.^@N%+=_7=xNȉl9滥w/yD{VoAs׹@D%Hp҅;κ%O0fcӭ5X)+pJeO~"B;%((?2?w?e0\*(:Gr|vyMH6Y3O( HC?dONhIDcca|N@d+lE/S4C~_-$Yuu&Fp渧g:'=YxV$7X_LjgzQO|܆[^]AGܛUdfN٘x! Q|܅"w8|h6v_$^oXbsPj^֨XDqjIV@f͍u4z}Zo6̿>i&ZVoTڴZ**^4сiYg;1)'^HHSĆZ}{ުA	~lo
hvԨhElA	ФFqzx]V*HCJ츔ӎ"FYQ0Nix:<kdTTY#{841ZZ![/*~nR xg3y{OD{#SBNSЭL/山\od+=g4\pN[GP?-gBZrOD-HҊNSA	p5Ϸ(gQs*	b4j:OexZ~ w=XO|э'1|b!vV'"}Q`{ ٹRXR]ozuߏ [3\,5k6Q^aL=LFjIc:/GD,FHɐ؟UfB?b,-*9*)(^)]bx@zYʗ;SuP=|^.ag"uu9w<00|hlנ[zlU`ijgVlm6:ޮ4	pS7ZcvM&?5&/ޚk+'FXe#/[[?
ЕXpϢhm&7+v+͵g7FլjaUi,hkkݯ7+&[k Y piɧZB4kVF둚U_4PhV6V]֬FS[5hUâN`\S@Vm|5xZ'(lc-!@֪B^YX"V}	4޲JմʆծQS́<&[,D^@Rvz7mT^:Rn*k-XHT@	# ֚m5-FYo:jt+VǪo+fU
vN҄,)؀ ڵW-|ڀ$
_mYXOc[o4`j⨪f^[n-c_рвF	Mml4SքC$^hz:(O<:z^ۨ#u7~{lTmf?k	!z]Z+mki';h-Fs:ѯo:oϪgeY]Qggy>*0]֕Y}6$sPz~ȿj4ZF1\[}zQ?):h)f{
ț3>IOk`:2Z(;6ܔ+Nb2jb^C_>e
rv|^HM=%ZWc!q=r<Tnm]ocC/UGj?zzϖ`7%-\O+`Pҟ}˫8\;iy˵J9tUJ!qQ.Tp<|ƅgl}ߤ男#s|>Gm57o9e}~N+9Yͻrc]oJ)Iu! qx>Η$"+Fe}\$]$f{^~@IáeZՕ/
I/ǇJYU=WߍWwDs$"^a4j٩Yq~N@r#SA'~\z7ut!/
3$<[7qL߈9`-GM@3RP(pG鰹68jgydãu:7"Gj8! *H1
qtA-N,͜,=ܿW7#üyyUf8de/u- ;ܨRK
IHH:gy~0ZR_XH&?#Ot.0V-aq
1h0|tVT6n],.HZ.9G!F⍁+AWǋ+x=%?BaFNp9CRY/^.ӽ菣P{/|10"C=l=X|m&q¹fRP2N[aaҕ
0NeT\i:ء!UxJːĺS]])ϗbb1E6XRYY\]{sIgh$*QSA\ 0t<k聘#	DRn	z#W.7/;=8rz^ߟԑ2"nvxD3-`(-W*2#g4L#QMgtI{	ikin-'qpLM-KD^\8(	:!iK23z@H̰*ȒMd9ϬJ8%1q@>MuKݹ}$|9{N3ŞAUz}b#{He1^[6fS	ױ_]M~^t9Hڴ /cu9{&;j[ݤx~9MN!
{
%1U)v'xfl&տa%;~=uJ#i0w1kLEj&^d4B\ksL"9LJ3NEY"%{R]C7Kz)I&6AVZ@$$AM29	R@2e%Y /Y
hfpF>gjVU3%yB%1'%0pdi?ƸVO
u9>sA|8C<߼9`xڎcwB1keދR\XCZbSoWl0 Y-41zJNr]8p2X2@;tJ=O?y0ԙ>J	p+kFp &WB	a}"zHuIqJ= O.0ys)|-)W+sR}&T7F5YqGt4iAkOX|ZF
v;g幣3 R7
qh01e/щ.Tbij.ݼM+:rK%Qj34j'zn\o^fVCLW%ݒ+OAݼ:Eԡ5aǘ#$Ԟb5a~d3	eJK9y~R֐MovAS=mvn/"ϬM(P0%Y=e@ nUd+KE@?r&0+ [e		í&IPﮋʚb551@?H)HPbg#*|5#1\~  	cuA/R9
2=JcڰYw䍔$ωrK8 DSQ*ICP^yw׫ϱ1?=e׸@\.5	L>5	ް=1'qϢqX\۰Yߐ?)OFJ{;j湟Ht$T4Y"**nxlʨc1
^=oOI!gT>f6YO50"J&VE[~	X	ѹiN:7TJI|=iep.dQ1}?8p"Z̰СmF`n	ٟϹx" yk3j"icǃBة,	T8'\ñzfoqf#KQBj?pO,mܘ!\"iT] k6|eg6h`_2N	n;K.o]Pͻau5
ci!ü 6g:3wX*o~ggxb{%"қ#^&XA\Qpf)t W=rTel%ϕ܅<{0H tT(nKЫ}ĆyU_ǁ\V\lP^ܺC:KN/ѳgL3ʹ8[MTYMkQ.a<<3j"8'cHsyWQ/]ȯ
Aw ;Szg^xo;|}w܉m;נU_BuAT॰RBi:Qd]~(;Ar@vHfe#Gxѫ7(P4̰]D9l: 2q&kNjY4sn :AH̩֑AE$KtN	-̨|n}J&:r{<d4[撄KN/A\K^MаR:z%*h^ ^%S؂Մz*ieȬ9,>xFgcTxʢ-׏q7Iz#S ٣A+TNEvJ|Y f":Fզvm䭺)ZC]OI2h5Bܥ-#+'fQZҢm{BXl"Mkr9XVrZhEc4a|$E]IL1k]][k/djNa$Fq jn/AbQ9fnSyWp%hLB5ӠSJX=z_FZ])(GeW<u$1v~|~'F,L+CMퟨة}Ghs-PeKGVЖ-W;,s3#.CHSN4sY9Y&ļgոJT%9g')KI=|"6pdO~꓋'DF+ݩyr_1wO= {:S4ܖPH@v Is-v	';3g8>9qBFWLX}r9[f!5<n5A^A(d)zG~ht\0p	K/Ɲ٣LwH<>
J@z1&5索Hq$TiPlꚶCq*RwyP蛥:LSYg."7vXpd)}򚌯Pjd%4ΧᆽQ^ń@yك+`?t*M+ʅ@K+`rW24xѕPz5;xu5
y
+o<#?P
Eؼ" DI0ܩZ}y-"9(WH$d8H%V`B+M36A,*aeKضMK3#==2C7o}`T3;8%/0.w3H{)<qE@SJ,JJO7kM"S&/QǴ5tlN[t_(F?|wz[0Ta^ؗZг+v5e<[hЅ{i܏;9:N{=Gwtb~|NIRvțF5ꏹ-*0 ۏfVM&[,b'h;ɬA1"<^YSC	F˲ǮqEo$uEĜ?:'Ol)wzm31׾ZN39h}	2GM2~Q㆒NFYi\&فR1VǞ6g+gfa2TRĤvZ,,%˴e$5MizY8~i#i$NeLQ	l>Q*.Yfnr
*Q$`VZP78<BkoTLm_pt
V M:(0|ۨoeʠ^Rcݼ1_J&KnH%1ŕa0SzZqNˇ%{.ȥ]֨֗@#xh }oX[ۆ_a>,4v^xvhww^R>8N':I 턶qxcɽU'0/Zg߆yƣgcD̄^pȆ-s{j/$x2~7=Ǉc߱K#+{n~K@VFh ?Vnz=%RKq}!f/nts +a*fH
퟊eZ[*O0y$*\B)=B=  $
a2iul&n:<4ԺGPl.C!+%Ɩ òZ\3k'\]Hspeë \ؾK;v~nf{3_nP5Axtl1ƎPJ #O%W(Q^װ~	x#SY4t41]V1jd6-Cog?ՂPKttU)aa}ʅ7r]s lAjT1g7&*pI5,4ʉ!{Os6Qb*z1O"%;P[R2SzD&Ԋ6QĉTG~ֱRS7Pyh`c\NG	9{4//WuW,Dl{xuz;byCthl9_@ њ?LT!/f.(aߡ:{5h5Fd ߒY!c393y6hA%HG[Տ0@`X'F
>q܄t:ԙfjF>@:X*w{^ȋj4d$dTH2vţth=uXC,(Ê`]ây{6U0C6Vtu90*-Wj[6t4ePS:aVZuf*Vbt\'̙y#/~ai@f-]؅]؅Z x 