#!/bin/bash

declare -r e2c_version="0.2.33"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] v8(د_gZJdurJ%UZ{ږʤ$3,)Yeita̞֙<̚Z5K&"  	23%Y]@ D֠{5n*6Z+.lw;nnFnu?3^tM	7PH~'En߷]\`?kZgmڿj޷\G[k5}E~~[hUwW..jQ0p>xw}E<၅}So4|e =V;oawvw@^k|>/%/qއϥ\cAp/?;/4~YUfL?+s.)r?fXuƃzFX!sħnX{#1;qOG,r37qY|Ey~#uّ;
kcz/Ft|.+Woiӿ 8e2}%6_tf$cPfDg;׈9\29uOFP?$Qt`vFa4\î:%7[kJ/~8nY]jsytoqxx>t>{W=I1ߨRy)WSmL/e?joQ76A1/?1!Hxw"\hdǣ_͟ޱ7pӽs^P&	B,×QmAWEE.$ %/ܹ+x~zZ+nA;WhȉN+~eKOF3:zŠ?@M]vp0eՃFM9~c|4	n1vG#v)8YtLGC1~q?i<]< 1QG/fʱWV3'sdJkڱZ6;rD<:Y*mmF>d@v	d@rTii;txZ6UM	6l6lA],d+an|8	B#'*T"6!Hjү.L·jFxYuIIYWwm??Sk	AkjR D0ni}hZO8j\%L0Rĺd373$Kg Jə)% Ƭ	bwzkjU?Tk8ȍ%;		[LZQQojB
kG_)(q&{ē4_$c{[ow7ǲKfosΟwv8l)ղ`ȁGt$Q]
"%b9qܾ,hq>:I^0@9zA8v~'Ɖ~Aa #٨6nrZ3Pby ĶܼLm`̙3cˇAB":/]V/+9֯?78>56Do#K.ՖkFVxM*ʗl=	C"Sm>ua̩; ;'yw8$H#mەvP,Dߪ2QDCYB	Ylq!i>m29>s4G'>]4Dd5	jD]$66nQ%fU2ޣa]_$ov7~5z+JB>vN`HP͌/葨A0qB^gk~'uVO<@PcbU;<X"pWqF]NJg_n:|rPoQcObp*V\܌ 7لo}XR#H,kLT].xI^|'wW|8 ["E,NP7y;iF*	@`V>=HJ)LMr$WA\Ւ%=buY2VKtf"En_T$c8ч*$zu	2|$99aʾь	cF"df7V
NU_rM//G_nk1AN7)Wй>xΫ`݂eVN9Ͼ/gs^T bo, K jgY@UQ J3ES.y0n)R
F^"y.v*	RL	s~:'J@MٔmSLi2F̚2g_G<MN'UbNV ׺~5@jXĜWG	qTTqt|D7h ' \r+.EB~vt©cY~FƸV	(%N;wCN̌hx
_Uk53ඬSwTYNtGdbpHޜ%@seH~ULyfBƨ-,gb 6_%P2 T&d{lN|VėQUhB@u)s÷{UfMw73go6Ŵd$ЍC)!-[y8O~g-(ik>r_:RHG2j>!v4J|КJ:Y\"7S.{0${c׊/&n\Mїi|{؃ӘfBvX5P>yʉ82k`oz{m~D09\՟m?y?r!dm%3LAŉ<̥jHg9|[$8D,I1iVNkסƥ+=Q=r-pZF(z} !\XXM҉펔䠫B	v<J5p<f-#|,dG"yr]cT1#j/$A7|;[N\3mᑽ%5PO~U}ccɈg߳	B2L(CQM%N,EgZ\0+FjSe>l%YW)/:+||o~p3'<UKl/}&}72l,ܞJ$',Qb1WZ4H{x'F-,u[igD`AF-@uy'gxޫDJ>^^Hb' I+ȷгƓخ$[p
IT%O (d= &uL,(G#T*Ci ^9Q	Ʉy}MU(А5+΋tJocQH* 0MM{
iWQ&0ehdgJ$1Ekq^lʘjsvGA
sF(LSLڂ3P|eF: %ox.ڤK$` )^2kJ|)h|)(|){Rw.4WӰFc(\E2NVpjW*ҖKFXk攒18FK+B^:e6rf1%>0,*iZүUHcj3ڀ2ԕ!z
Q2x~,Iaɏ̷gL
VPKf%-DjASe>OECGRvඋt:& TSd&UUsiExyMS:FUV{4\Q#̆k cKgA/
E,g1)l%upxT(cM=]E6h,k>=#7ikΙ[YG=dp65Zy]TvZku`2]72-,!4`e"hCSƕ8zl<=XNlFZLՕ9_ĉu)F^IV>G#qt
U<f*@)*E'E䰴f&e˱sçOγ+7@ӈb|+~[ jTKo~㤹YvxVkMDU+Cw#,M/Q~X;C+ZwKZ^NN'g8Lf5$y{#?;bhsUGiܼn\Ւ֝[#(LN%	vLGH,{#vTܢD(3 d)[H>9Kń|f5t=gޢuE,7$*([!
1[rn;{HvXPNn-7ʐy(=2" ,=z!?'$eDd/U{њ.BBwĮ<T4{Ke,/ĩhd0;?C;+zN'^|:=´	I1
q#3(vQsA*@T(L;	2VgK~ْ$5_`Б,3ĮOY 	;3+>ѧԼ?5ti8y3,yˋ+ِ9Ԓߝ388D%-73;4&܌PQ:-Upvc<fA# JhR>V͂;Kˢ)4>u8nv ^C\MQFnj8m?~f79	L"*o:3&QxM_	Y:Uґk9:] K-}`D܀_r%E1@S O|)$0c]ŃeٹӺTP_[*kj{SxBkn-Ɣ[ВMfq8թ"א:;.Y`i0?Z|MFw,u$rxW}r=,><<KRO9<H'F.m<5ARa`)G2|ma2jQ<f.O;~n3dk48GD"nMFA/adl^2&R$B&L OX| Jvh+>ҒHǹ zWIȄZqXNq+=\c}A-|IbK)x4b.'Y Rd&nCsٞR?>~	mЗ?H@\b
*HY|/Hb?z'#F"vO' a<~x׸ʞNlo:&})j=A-o$h`9@yUu W'IF:"1P~3~Rtx<v9zۓz&M]/*?89ۺJ]ZCHs&^\&UE
B3rFa|Pt*ANO-SKr	襾.go<- .ay0sǞ!:iY
J(@zer4ZD3sCУz0vЉ01"^\Ԡ	9ygAe"M^hn<rŧ4f'o#}?$p78 9Gj7z&<Bw'E[zC^r{'=:8
F#T5cBV ިA@KDourT'}g<ɽ4ہ'yJ"XK4_<`(U:ΏXgURdkΐ%YuK5g_0zcN;g %o
Sk)׻HVy#g)F:&|r%f@AEx*` +O }((`҃A`,FLq^4S15Oۀ?fb(X~/yW`FѐXSP!	A*/*+Dw&t6r
37v4؉sBE&(x+$QOK$6g0'vO]9IT7mC|R~hֆJ4J-;M5CnbY?]?m?MӠ.NLE(F1(F.v.s4	~Z$
1*T<'"! *]+~;Weh:D7+o:-oZ)o7gY,D!%!oHD!oHDaF!oزY,C!K$/rWt Fw0'n'}n7n-[M:];kOJx@@3I,JH4Iy^+H&Z5|F	v8qBg=Ӳd|%)f~Ko@hBhH@o2,eYb@h:4a)DJI!2Y[pM,-D=e~vbFQpAr#׌$$FC,;?O],ɗZ,Cg|~e#S;B\^~8E;b-mĵ0Ij;
I^ggJ}XVRI?4
)ݒ|QtTk7W=j.+𔂗_DԟVh܎KEO){V[^ŎK+25DuaB.E2l<rs"nioPgIuQzpG,=Z
E.	M keĕ{(K2Lb0\]/nW[P>c$,O
LNwK޷{/nyZr{s#ƕ=EVXC&k1nfs϶T"hSe֕u/%MѕHsP&ӵA3Z)(
clX$.so9eV:Y
-`	)ٵX#uЖ.3b̂=cP'Quw`
&,Y̽[9
-`$Ɠ_9o7aekJ=P˱̓wA'qu';r3Th#C/ AkAiXQW͍c9D/PqWnư*#{$w7be[I/	ϻ_vZQtϼo}'_J˟h_\v.?̝j1ڶߕy׏#9s}v^W?&dr92 E#7^כr"QZK$rD\>!sЫm]4jt 8łVmJ!t\SnL|,{~@eO':(ն[d2mI¸˫rhK`˟QQp+Kr6ˁv{[ݥŕ~5X5p440a0-ayVypVfЉʘZLFӡ"UckeXJm8+\'GedEU֦3*ODȭ!\:X r9$r2<7:#./^]+ZQiNofPtocU@ej2_<FV0z>Xl# ⬅_vy}lVj,ˡ/O{xGьmsVaҚ5:P0j^Zvw`L'EsOU޲hjh֓f1:e_133zD1+T"ckb K:??&|pِ|%P=tje|VH\a;ܒ9_ѨLl\6[5mK2s\+6W)鸗[KJ3i\(P͖F[,ah~_.H112RWsba!<`~AQfUFM@AX`$$JB*Bsm9f6+)sh'+Yp 9 Orf4^>dw?RLmߍ&<E\6mUk!'DpKQf-eر13[IW~]tjB'@sJ%䂛2u舞bG.\>,n즎q9z0kEIf6$/&YV9Q]0IR$Α*R7?g^-_jPݏA/U>k:к}@QGmO:<51YԠ?<*sWgo6߾*ʅ ro8Qt\|̜:~$"D֍c/L5_ьqnVf]rn/ʲe+f[@Y3Ϣ2h:A+S=s֑L+/^om(@m.[o_md{cWyϯ_ B<bfW3w3Cwq!5aBC\qTw3 4%{Voȁ،}^P]UɦhѺ}<HV0xSw4
A+^wM]Wud78^e|;ù(#7?50
ʀ;FV]5)ә0Нhp	!Hp'z3d ښ;
0X8.L5ԙoNFE LKuiv1gᾒБ1PwΊӚޣWu}l>.<d0̨nRF.ZbZbD8yi)LN=t^CE iM"doRD昗oiwd.m~-Bi=UC^,f^rQ7	35s\A8r}	jhw,QXO`9|nF)F "@Hs˖<fUhE_~bkOSnjazI/UXH_g(@ϡb$6wytY'yN`ƮQnꑙ`ɽ.mJpq*U%v2GD@e|}A}i]7uE% /	[4r	kvˉxodpŘ8ԒNR;W0dJ-iO'(ɆiLN9`U}&'Mu[dLr&1A|-=VVʒf}ͺȓVў){ ŵ0|Lc&Y7Ơ3=SG#κo
_lXnzXl!ϔЊK+91Oe05`50N-ߴҍZ͸/&ЛmVA}F=JDgK^]x]PӅ{dCuJEfSi3&'n2Y5޺^d%.mr[A):O֪@ʰBE3__e&I%	[ŴubǌbQ9ͼhUCStCD#N8gVWN[YάϽ5"ߖld7OJ^+nNhŹi.eĮKԑ$b wHVq)HXzi5N*k\g_^2	E Jz728(c!ı
IIđw!FY*jSJpxMQt{-|:gx)~^jlSp?HUGXpp\-AS{!23
9%S1&N,pUGDM,/JcÁlfШR#Bs8'(SüKA^୚}7IHţOڧ%Dhsg4KݒqȞ`t*vԀ"=dn=͔v3eܬAiT$5'\In<͕Ʒl'M%<ėL) WF|x%剐9ȣBE\)t5ĞOtv6lSGj.|lEe]Ͱ'm{-2Q"!,cqVgK\]6LxkfOVb⢟=^C`08M%r.,Ts|S'8.+S#	{!IEs̯2\`oVr*#3*·W4TbrE&Z0#@#I--ӅDQH"$nåu$ =~Ǵ$SMl%klSz؏μ0;1Lbi!48Gu!y" T!-燄MP<Y +&1e|Ey(p_<wEx&H-iiA"_Hƽ9aCՏChz7p!c'nTSLpYDҩUJRTAwiEie|e`x˰%R& C{ʷZbY..GX.L)_<mzѪm&/=J./`^9P39V-88(4Sf/,3iY-n$ee!{-M%㒳IUTGW˹>$ޱܲV:qq.h5Zx鞵ʬvk(w z0ʾO_J[ĵ<=Fhf
^WyA%4OhYy1Eʕy¯/#KE!̤hHkPkGEN.Oby
F9RP)UR]S(K	mDrJpڄ~_
9Ĥ;*wL+Ø*9(kj6D0ѐ?ͳn~+VSvpWGYl7tt@ǿf+P.zYe6sͦi<Uo瞁87m|0]*5'CSp1^|"b~,7> =93[M{.Xg~wy]">gjPm[[΍ZXWF=6-ĆqZ77`lXVq:%źQWRi5ד	fH'@lD n	a[dPpj~eg@d0(K[guFy2U٦TʍUe4c)Sф#$wT҅A*Z	8`,|~m蔺KZݪOc򴗮I.ƈ\_Zε-p>ZKe7,Phi$`AҊ`IY^bdsxv-*7:֯s&/8JY5uՙwHድSZ9#>ȏ/ef5x¸m2U{BLn=3歳2gdF7CZY+:TKmN0VO_	@WhŪ55G˫[#,@o2Yd1C~d<bx
c!]].>]]-3ag7UiDz95D<CZ5m:G^)2gj/	n?sϙy,'GM鍙_<ۤdb˜cp(
eXkFV"a/pnqYb!iݽEG|']9(`6__`ZEmbRgNN5d펓YZ[*kP%dګ<0f@f&RFj\ty)pcښ KT #ׂ"`z+'%@% TDWL'x͍)
tMK h0oglS99tμM9G.ƍ\fO('CvMT1JQM׫D/AM}~澟#f|,쬉Uy#xR=,5qK9/zpo:~)J;
;t1a#|왾TVYG,Ե5+6^r|(ѩ* @`q=LyI')87ݑֆ*%ۦM<DȘV=ߍl>2HP&`S?WDCn~u.ڢwʅa)Os=<*(-ԷX:UP2#l%ZS7qfO^> yˋ]Xh)W6iht&cO'7\A#w5?V}îMNpO}T !)-Yziee,N۷qhw޺lFu홷PH|f-?Va* {ʚjTe5պA;6;t*6$(\K&lsE1ėdL%O=o	듴d{k{5ќ듲pM[2͈-X̶|/1	7'̙Oe	G#֣۵J
x,&|RGy'n֟'ɽx>ƒ\>L(賄Y(f?|n;P*3_cX h<s|svrע1G
ć
>zz~ވM AyKlI*6tD{vd}'umħ/(20NRBciKBHnyM_$Y4BTag4g8Ƭ(ma7w	"|'O}ueM/JF[9WWy^(9ĔpWN>Je&fEfh~zM놸)>Q%`~;h+-1zU$"KAr +dr%kb,Y84,>\XΓfYǟid b4moճ޼qW';ȅ,z\<T`ASC؁RC?^q2Oc2[Հdi@`dFΉNr-$E8m/sAqD_P#>sM!:A=Myz1rNltPRI;"VTxGEg33W57\S`Iͧ"Oy'X)v*/kb	maҹ1YtL27Qwdky+qa
=,[RTIGsӁӁY*]?t`F{ƀGK%`qGfյ;G$m0%bD;x% ID3KJu\Ӕ9Dr}9+m4js3s/BiZtnԅ2ʎǫ]zKD^h^4GǾp18*
I%iLP4xp/KyFi*#5-2Fef
M K~}\b2<ހ?k	Y_z41uw0?Ft*3k9t+ k Ir$]〤bh^UoU(V5J.NjD_rUCmjY^X|UIRJ<n&XrA)Xa0:20E-QاR?NB74:(d)&B% &Z\>@0^"NJV	p,!=sGμEAe[r1ѩDCѥ;ҙ^F_'Y;[Y$K=|IWZ2 (8NAo+OLV {;="AQ̚i`P0J3EJozfP/V\0
<֪vH0=z_xN?^fr'yElC0I|UJ 7=P%V_(tOaX}XּXݨ5'UyEqtHzcZ>~%Q#)y3\Ld-̩!$6f$('ag<uIj1 eVB;a:ncf~ 8L±EBeOeEҋW S40KT⍱#4xqa[
Ȓ>F^96YA Flۑ.h qdieJZ&v}n*/um^@vy=51vK"g(8Y<}6`N\%#u0&p'r!fmMQp>l9ވO{~4:1_g"~s߿Hs8|p`8}t<#w|+u>62Lr%	ωw1ڲywRxF( 'yrTAkS8qJgr1q+a[袈Si{TwNq3k(ޜFq@uĢ)7OM`3q(&qs"jDމQ<u4×LZo}W|rF!J쨟G&=HQzgr6(ȱOWeynm3&Ϯh,.Jոʏ6;&r!ٌB ďCBіfXrSm=D8+h&~O76N6oP*HGAxn-?Plv}<8sZ%Axњo2)ڈ+tڒV?<	5}JWГ]**4	:Phz&AL@*ϧ[k Xr>-,4L$,ztsf0f8af7@!D9(̦lT\M> d2Fӣju`>_Ｉo 'R4(߂M]WI݉E}Ԧ@v=I/&8$;|66pL1t."&aA7TBD4<nlms9JLd3&
Rp?9odWsq"@+\-8P_ 3އRhfO^%ZTj/W~;/<eUn|(;
fl"r,%Nz`+3JJ@/+z
D>RAƞFu/A,
3*l]K4h?'͢`jKck}QSMjBbgJ,L_V~qۘ q殸rxn#6bdiC~?4F:oZvB%5Q.b</SU^ 	~=F<.:>	Lq*bX,/Hfffk=)]^(`[< BJ[nW|/S`aY;DnhHW3ΒH4-}17R+<knl~C"0_y-9#7>w]aꉝ+ou7ke;!kbE]FBXj;z	.Kw=~G9|9P! ,֨gY_?N~掲u@9xUP:^*|8Rܶh9KcUr3N~ܷ̄hStgC;d:ngd2@-/7ĳ5n}q<!K4;$3Od=	[lnu"r^~doAN_Ak|7!k7cDrG&ʔgQ%;q5eH9(kR=2Y2H"!x2y:UZ-hC=)mv]ҐND_`_AuF)wY/N@f1>VA])JW 1WFH TCuc%۸NZ
Q[$Q@1ٴML5yfg	L1h;Ѹjhr8$ڨZ-:nfZ8ޒ׼Zwu~kvgn>*k=@8th4 $;>.#N.qשּׂ޷]\jSPƼv&sywq?:~ke =V;oGyjtAwՇ+bhX(0"S|AhqMVN`"#w@k`*4,|?EaE3N |3T֗~Љ:NSni2G#Fj3xODenfu|^%Z+b'u?w. 'XW̑v\[H풢0"W|
E}2_nx1#%$]ԒMBz-~z|ӹJkGPVTs%Ax3}FmUGu&9wux\LMp-9{5.kWB	zQ(I-b$Sj8)swhMp>b@BV MP=4?{b9rxqqmpu(bge{18|5"gq5 LA)(uL; R}_EȘC(
* ~<"̺HyH;6(0?)PNinL;evʘ17WR.v?Ņ
QoC@Y0I	2}'~=jq6z;	G@}%EVп=^D+f801n	đѫKzj(P٤J3dIE&IY>El<JQnr՗hO v0Nq6hdEqCqVPyMVPhIf2vă O>v'xO#A)&A}BrW?	ZMo4̒VѺwqnRa{LCE4#ɮC|{a0h-%[} ֥ܿBL_ݑ{1ʀE#~To񝲁c)W2yP!
IVO7gjlnӼwqpN+7u]7oZ7z9>[iW?մkW0xI?% r1*Rz8csW0}ťfiFqPl;M#Եg&GDk/3gzr`s^wqZ9A>Q.hbs֏=k^bry3qj%~S"rS橂}DL
2W^C82fv_1^eK}aD>+bKHvEbg?C!8~DLߞn6WcxrL8>HaNxb &yvooOϒov^nW}A=?	kJ?0~s?!V3[)y74im_yo{WC&ޛ/`_iiN'v-%͆6~nqg
[{j/"lLO^)ͬX_LO~1?7 m=di<Zd:y	0(亲Gڳؿ ͊/sXRM>5i
/ox͔`0CUcݸwq͐%*؃d,6׳@Ԗt܏ \"%7{wtЄEGt%ݐ{[(Xkt/whe520/5o#<sx?SZ(pWw~sWPÂlVãA "aBs,ā&R=gRw$3lv/.G"Yzoᑲ:xQWC/Z!(˜<lKDgLZ9 DZs\}g$v{Û聳V73ouB欏X#@<5R)>"Ӓ5S<yN;k	]\sbwb&AB(LDCHC/o)Cȋǿ`eXv^U&e/!rͻ&`eICl!%.qZfwu5jEdbVEtחVXXK+iDoYZYmt..B"w\'!ϝP;n	?Zɛy0c.hmߤaJxwN_/MFHJ~y 7cJ=_YFyo'Vy?ɃgͰ՟V(RIէx:çԱؑ}_}湵^b/OhO%HztUI_=iicFlqjЍGrX)wRxfTEO#2؋Ë$^c#sG,^GBgx0{~MM>#1v?띀>p#}Ǿ:>Nt`4z#C@|@2[atrq ܡqC(`{c2fwrOΓ0虅׽t4TIq-epGe?ݫpv[г12C&>_n0]Wo4_$]vF[V@DϏFwu0 70ȾU_/z8y k-{NƪHAX2ko[o=vڂ׻4@g5AZ_:2jkU)Nnt*ڌs"d\kVhv &َN)jZ͵c@*4u6:mB]|ӉcgpJ&+&	ta.ɝ7ebnm<KY:qZiEcg42	s!:FX/<No{\rjoD=2h{OA&;##^odЙLrU%8#7Ӭc-ǏV_i,<"@kH\}4;H`jXpFIgv'>jj>-*(G(5~Tq+tZN8g2"ԭKTAS=u0$[sȑB"iz40A~F!#it˴1T3K="QLCw`LXI](O|zSyzP(hToؿ4tկ
;/TaЮ
5V<xcnWY-;3eP9'|\bcUޢ{phCtaݱaBN^kw:Zs]`ڭuBghljD$_Q}^e`~-UVBһ5{T?QԮҊgW|FMdPb߶U¾ٴk?ͮO& mwQcwkԵ4jk3 Vg4[ȧ ڀ͆f5V}k|a5Ve@Zm{mvf6ƺn@Zev %Vvl8d[@t}|`kč&hA9 ӵֺ6B,>75p{cvӶZM{6*xY@fA-)8BQ0wrWm(7*rֳi)Hؠ[kD{ĉ sg͂vږFawVNgjntF{i C=jn>ˇ*}lAbyZB5c6 Iƥ*e/.
 m˧Vڱ5v7d(鎰W5YtoU(n-c[ՂP|*M*mlSцuXt-jf8O<:~^h"wۭA[{
ٰ]v?k	JM ,Zvڶ<օfb=[RPW7_00v'h2Dᴩ,'G'4y:"@al*<x>XATMm[PA>}ÿj4UF(hW~
'^} cKgzu aO|]Դ|6ϡ`@|a..́}ϧOjY.-w?dG\gd[j"8N'uӡ_zxϑ=*|jNFFlj#':T`7)-BSNZ e5= 2a+JSxr8Q}Ԩ]-ryOF3:1V(t0~TVj'ްϣ+_j>MroߋsOi9yr~>Ç.ƶ^÷2w8'd?yڋ]W95l^BS+U`f$յLL;[RdzED O`9V(ޙ8hJ1a4|P^z@NLhjތ&_e+C?_2!R` 40@͘o(!s*Sh;#$bNfd\j^-ëHT҇i!chWU;ѝs$98ZeJ|f(r&i`kCg*A'LcL8$}n'jxjeY7q6JjCN	~?__޿xU&Zꡚ2Iȩ<Q}!liKe1$K !kA^IY͢<
3eh:F܏^_jTȊ"rR5S~+
B1kYV#!2ӿ
TK֟0eBtD_͕)rVNޛt?̅C&`F8=Drs&5ewDn(Lc7`f&(Gi8оlcpjA ~OuiWMVKݞ&*)̘(xJDE0PAT)%=AÑlU KS]^/.d6NjMmwA~S{suNwd72,AWhH1* $5>߫JMSk(l;ElJ anAvհQޟ9#o kx{7SRSAEwsLA#⎾E;羫ʮ.}W-cw<c|ǻYl42
r=PWY]'CHjJ-;`$r5^&1$
+1ℊ*|
)j,̈Nt2<rviEKGi!aE*G|p~xiUp:V/W\1=c7;BRJgث=FkE&z  h\6*|2kJX_`$D]!ژ*E~d}e~C8Xx^+=aOd.˲M^G=(Vbƨؑ\]sJ"ހ-Qޖ}#*T7DG Qu%S\	RHjL'
xL!)wbXLgr9ǥQ}n<Vu(i{gF9៚=yOYVӸc:LO(*YتQ'脡s^1:pvKI4,H\XUB7>k(pFtPh.3Z ֩;XLOtdzp{Gȃf`V{ыjWzř*hb1mIz(9H7k$/FPd$8.عpbM'Su_ⅲ#@aȠnlWtb*ҾHD!F CEQF5i">:ѩ5CE2sN[qߋEkJXb<V\m>0܉hΖS%C$9ͤX&M@3Jȿ6 URƍI@"#t:q?bǝNNsx#gn\s}I,AҫtvԲy:;q}b9Y0rR3 Q3k{[oo^~Ŭ8Sh̋3B}]`4u&,0IC#='o
75Q)TB4 ѷ3%>gr+	`Ya(c`Y4q>A/bF{IiA4 ¡d
dI6~IsQl5%zR	].8Q0q2=]9Q#ÇY{A! 0s`PaDsbԑl?;<Ot#4#dW՚6r"Sm<*kT!ݛ0>Z$*w%ũsNOʊRè2Ae*͎)Ht2dQ$YȝWl. G#[^k eS6WG4]g˗bGSa Yn6l/D"cLnxb`
1@Y⪙Y^0%.Bi䕘mx)	;r088dCx9mnɯrbG+p
3^q0ddj7ղlWn6󡓺:ڴ(<H3'vem:M6	ORb&˥K`WEUdi
Dn$QODўOK4ğac=,0y献rdV` ,ǍZU(LBJ/-ͅQ[dMRO#wcf%QBЀ,g>vpSh4t.`f	3Ge~j'T
gj;#Y&;[9Yp+<LС~V+W2;gxU,W4sX"ܫ2hk\f8fW}OP5TObfL$ڹo\ʉt,2K%nV502Uǳ;,a9áE	 nY!g=@~з>(t܋c7Ԏ~7:/^b9T5fwtYQmE.y0Qkaf]L'de`-C;$v@k2!n8uÁ[}4szQĮIk."m`X׺}*1^J$9yȏ_"X	C~_Ʋ^>dͧ`-T`Ee\hi.z8c(R8t&L7Y~)m%S̭R78I3c.r4`![7jK`CA/:|ofm΀bn۱.GP#}lo{Z/
f:ٖj]0IcS0eɝl7Ilcj,6s޷%<aP&Z-y
eM9;DaQS-7F	x1.nNGcx
VfkieymC	dA̖{5Yxa w,ǤkƆ&1TB`M}v3%hrsk)` 6ᘊ!_5XR4V/P"Cztsm+H:/46
_a@~Pq?BAxmވ/´AI2I<뚺,ZNOE$	VeMB䄀#긩H ̻]v-)Va')F(-|Fd{ݦd)9Z5rLC]$iHDs:RJxT
F&\DuS0o`o<%5=j.,ϰB z𯈭8i4d"\ މ'w2Yg?L5CdJ)',Kԗ21*]eKOJW^\0櫠]d3p^@ۈ+w̚ʼ%eUbO)ii2u4gT@?NxB`DZgPuyT2Yfq8MӚl,6P!bItnUnݟ,hr R:<ts.JG <J+w.M3>{FJQ41Ǐ0vCs"!`xp>O=Ν:U%jLmik ږL<{V䣈bw%G#ıcGB2sIqYoHNMJG2@/Jl-E;ڜU`E9AN``rƐ[=R6]gī,fL옼L3kZvܾ~&pyL[$^ޡ|0OxE<RAԷIHpz%=TΚ#6k}U2nQŢǬ:dj:F t,MLupR*%W:̨onvY_v7&JbpAt^50~|sJt}/n5On]"dGZze<0'?HM]*C,	̣CI_*?Ƈir2!;sא0]MnU^D~O;o4W+vCVƌ]Q5;.w'an] >sUB"x\|T<GTqZSc\/S-p(TF-Sz!̲d=[@JI~ cZ@
TZk *P4
	aP@`$.NB?lM[ im(u'"b<>N$ x/҇:^9pYΨp7<f?{¦#jߜ[ߋqq!ŉp51Nxi|/ IwE~@w)%N-qFnѡ[SJ.,ocǡW|wǷ,|/JMV	L%@`ZB^,B<
c6ZaXJ́}c&Bz}`E)'Yj:mуLf"%{gj?~'Ȕf$_dux>Y8|Lr>,yˤJO(c¹Bv:0vZoIǒ:n@ { :d~
ȷs'ӡGT<N>!p42O>vQ1
},o^MЄ rzh&{|!:{di䱋5t9|&1hkqZU>>nwN~/8V:Vo@ISEe3Cw'hPis k$u<4;A^$a񂨀`}wA[tkABJN1tzBPy!e y0&,y8>ۖF_o.EroY?LVyny='2R>#<QgmSTd&4~HټG R 