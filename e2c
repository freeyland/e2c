#!/bin/bash

declare -r e2c_version="0.3.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_res="$(pwd)"
    e2c_global up
    cd "$e2c_res"

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 g] rH(د_JL'/T8[TԈ	heY Ky:{v=f؇]u " 2nBUL\n[>h4V]F6Z+.lw;nm7YZm.Q q|(HɎKH~'EIn]\`?	fij?_aho4..B{?3J ]\S{}X7So4|u >zNY6zW;?)!E?$k=hDh]\Z_{eM]5LVQ?`ʆsǏ ,t!Q0:#`AVco>f'n{	Enx;1O0Ϗb,p%r]v䎂cP,A؅1]WY[`:|>rBؕWoiӿ 8e2=w5/:v3n SopJH" Zp㳝7ֈ:\2'#LN(<0;v#*a\îuJVoVyn_q0b*^Gټwqcg:8xx>>{W=I1ߨRy)WSmL/8Z
o	m@=}O?c6^([AƄ5&ݱ3\s"^!|5n{A^&ƗϑyAq_Fu5a\)?;()|~]yuV^Nmw.hȉN+~eKOF3:z`<DMCvp0eՃFM99>gf;wL&K,:!4O.P1QG/fʱWMV3's$JkڱZ6;rD<={Uۣ]ۡmۢMۨ1g^ ٥"TdvbEӢbZTLɵ;tx65M	6٦"TdlTF Vg[!
sIzl>Q$4S~uier>U+$2`@u̪KJʺmYhZKXe_>V똗*	&2PufOCOG#z&e.ouA43	./k+Q	~-% 
3W},Xx'~I~}I^j4c1kM;ߵt*"! kxɑKv/ۭí?.*~ni[G_V*a&'CHq1}[o6CYͥ~Ý7H~6oYfmu"(skP[un_8ܿ8u$b.XM ;qGfr Ǘ|lvlrZ3y ܴD`̙3 +egˇyEp *G`oy_VxXnZܰÓz_xk^)jصqAT[I9ti6)+_~C'Lԅ M>"S8;kܖyE"qC߮$Ǆd5 Vw߽'& JBId 9NU4NtJ^4"}-6w's1|]#j?Or~FcyXIЂWU6U[ }/5n`茂:'f)rh1ުS
zY
8*CSѬb뗛;_mܾ:rS+*IAˢ5w#h7Mv"eju1th$H,]2Ԙh@EỜ
N'0GtH;>DЋTY4lAqs($hyJ.}z\<
VʑdX_qUKV<5kW}AZ"xS)@^E"G;ч*$zs	X3!|lZ0st|%Ĕ}#^/
ol@V}I_t}Bbq"oB^XPīv^Ӭ ;|zγYC/*(bwެEesޏ
VyFAQߜ,sQ6~gKq#gHї\h0eYpUWJ>5Q"j¦LHbM	:1kʜ	C\i7< mr:2ds0 ֚!c)rv,%xNxˠd[!y2p#r2/P	~(r3B7F' :qcF]68uwhW3++0>jfSmY\U% xSx`q;Kͅ!BUawhɔgfX,(kIeRY:(71LɎ ٝ/;|ãE@u)s÷{ۻUfMlgȌ/67ٴ$DЍC1&-{y8O~g= io1YՠԑBcã`4)fRdQ.7S.{^` ,k]+	R;՛,}/KsBNsR	.ƪQ
E鋧; #
潥~o?淛/^MCeQWۻG}_t-\4\dt67tV?2'o'CH3re\&jzݣz褳,C֫/XM+ґ펔B>r5P<b-B}#|(y3(yr]c1#J/$A7A#|3;[VN\3mᑽW~W{5@O~U>dHYTB2M(SaM%N,Y4Z0uUU"A&:>hI/z9q,6vUJ؋N
 i{gNx2%ԃ;fS_,P,P7`2,ܞL$'Yj1WZHx'-eCX@Z>9m+V?练C 1g0 b+JoNTіwo{5ӖCkq^$`@I0qFxەdK. =ui,
I:&cf#?*bJ!foc(^!9Qфy}U
(А5+[΋tIo\;8@{5*VLneUm$4iLy-(2O}w:%w}8/}6e,Ġ$G+:Fq߂!9Pʌtb4+Z2n%Gd7A*T$GQLZR%L9%z4xe4)J|)p|)0|){bw.0,53,Ac\.E2ڐ;|i#V#0C5KOIטG/(FK+:DBZj
e6HvYHwv4YMW@ٹfFIaj>4E,^Ĭv]EfYĠK4<UN-k&Ëo(L&mϏ%%-3N+	ôny#/WhTLu_oVsab*8kybA穻h*NNvztRN2#/p/X'iNK+bU-bR^Yy-K+\YfCR]Wn@/ɜd/#I2wZ;@$f![DEBޛ4^C0߭u..0vK2מ3Dz_\},k.g)E=4ddzXjw4
*JDIl3 lUqR$xf$9)"~FZՕo/ ׉#ޮE+KU@oxtV _Y@I3fWK%=RX391'{ÛW PDWW1DŮ#]""rr|TVzZrpxXG͕ȲuZ'bg]7x?9%5{9ۏ|#~P#w\S󎓳IW d|Ǟh//61aOƎml0-!\`oE07o<;W1H01
m	/s AkH]z:;U4x;MQҼt}gxq8_(Jݿlmn}߯:s"HFUVt%#T0
 9fhDx:,G5>4ӉEh\!~!Ǘc1DyU|q|Ф[}^'c
N~7yV8vu!ɬ<$/INДc?tbRz;Um-Sr"iQRjIf\D*P:A*V\r:ܭ.Z(odQe  ,!9a(p#H6u5qf,$tAEZT[v(MY= /m'Z&-C>oz4	Q12q##*(v@_jmUf Ńh1
p;lAxPCYkJ$mH#up::sIq5egK'z`ῆ.tvvF%ϟ/ǌ.tw`I5,!li1gQ1Qf(>RQNY0		J|#KÍ|%(OEf/ MCϐG5Tao- 7y;M p8`bdMQ}$,_5A7K's2D1rHz~0!
Atj;>/R1eG1Z%BW M\{qf+c%YYv͎7wgʩ	gߒT٬5q[Vk%VrK;Ĳ|	\fk/^̘Yg%znOJtB sGh|7`uC7^C$y'72Hz_3s$ty0S:]L8UF+hr$Wf>X[,; 5ᔆ	$50yH.lxmIG<8i|)杷wcODSL9f)	Z՜P+=!v\|	SJ'y&|Jv@OvܠFzmt~Eֆ p,
xDkX%
|
H6	-HKLI#VVU$dJ$b/z4\ԄŌNߟ[;qOƿf z#kE3бvӞ1
Kai-v_#ioN'aVNи? -amo:&)h{mx ؋hdJ1ů:d$W!z-kY=Gᾭ9!g<ǣoE/{+ˤUzM{[WZkh(Ҝd-оd"h!7d(JjF
yva$XJ*A77UyvpL<wH:1taRzyP$DE:
|sC0&F0jq\`(^?Tk~<숃2b]^x g[y|͂iN
8<J-TtgɩIL?<R3v{jZR<\|W tҳ[y(
+lҸFOZ"zcl %p7!zSKf;9#WWChĴ:J3s)-ՀB(E:bΏXve[͐%Y5K5g	_0zcN;g$%o
So)7HVƗy#W^|r%V@8U
D_?	2o D{W0}(1%FLԼlk4 ceEQ]#YC7졂*P^U2WLȫAD1bote
27V1,%-6^Iࣜpl`OU$)6_o~v?OmSۭMm]r6R;c58Onb.6i&i:]%*`R+X(<gEv;uG|?-?\fbzxgj(CڈYZv[jAm>wMߞߎD28QX:+:nz+o:-oZ)oůϲYCV!k$_S	|Cߐ7$	|Cߐ7$3|ÖJd
Y )_"%=JNotL|v2&v=[KV^rI]$IVR^+iC+)UT@3I,JH4Ix^+H*z5xFv8qBg#Ӳdp%.fqKohςhAo2$eYbBh/1LRJ*)謌5GZ>XBWʫLSɗPZQxXr#uEvF~jQ^!VW-=OQߧ~piK3Fβ6)Cԗ@ЎXKgz. 'RJUmT'{2ݳD9eʰ$=BB*
iϋ7WoZ. +p(d_.I4h܎KYO&*{6[^+y2VQG.D2Øts$aDho`IuAzpG,=RU. k,f;)K2Ld0\]k,&aW~X8jo`$$OΜ*LNwK޷/nxXr{s#=EVPNIW޿!jk7ڹ'[TJ)L^	JK	4VteÁ݄$t-rЖ@iˑ\x`MkN2ZFqOTiI{9 4dMCSO]fE=aP+Quw 
&$H^\,rz{ J/"5C!4Mè,x-R)PUZ@0zP豧A<ـ7t2Wכzr#4C>2m~˽}*jonB6B}l^^݈Dm{"+̵Bݩϼo}cؓ/'qE'ҕ3</h7~<m]Y ?F>pOsc9DdFh'J_uopȼQu}J('D'IĹ#w}>Tjt:łlЃa|{99hݘxL1zߙqAy]i7k.к$v?lId*%6. R4%s?O.(8wÕFjFv7WK+jQk=h `eu<Z`c~Ew8XNjO45NTFdj0]i-{K)Rc)ly^jnA9(5ZLv77Y[h^Z !C:X!r9"r4<7".[/+ZQƦXiwfPtۦoc* ju+{.ğe~GxFa.DF@LsY* ԤYCR1NBʤ5k<EP_V5Fc)\̵w0r03/<ʘ(keպ1h'1q"t:`f&xV`VArb K2??[&|pjT(٢W"/q-Ns*kYUl山jRm*9fӔtK`6F?.dGMqz/ۀ5sgr@)͍<,AQW4	gn8Q/	"jw)OE|>HeyTXH0@K!g4FM@E`E%!U9؜2`9etE~t,8d'Ke3WuF>fw?BR&<Ep1K18&ojJ18E!~*,F8֬L9vɯUD3k#5w9K3][[R!H 4GO'Fw;rauraqc7u4SKɻm^*J2P4it,֞ژC<Ǫ&I
EUfUsp#~̼>\ |@$tVo!}BQGtxjr<<ЩAxT}e67۾*ʅqrm8Qt\7{{z9'tHf0;3cG^řfݽ}_hܨE lwV},̳?C`)RϜu'SJ%ǋ[/
{[%W[?35w^nW5 =؅W1݌l8t萺!!w8ӻj`nݒ<Edl>	|/ 
.dxwph>$D/CXM<ũ;s U;Wgw !x?\OzgE?|"AxPXQ*sNYw;֤"g

Ӑ7Cwآ30A%(C5p`h  5w`Ȗq0\0^RhН(0u^7ޥ`JGZΊ0NC1՗/f;+6.k6.{Ugi(CÊ&ub{C+-N^aY
koS"eM7C)K;O<hN
S66x4l!_o W}3ZoX9l`v넙b횿u`v͹en x2vD{­#F֝2KT!UZAE7w	Aae*YZWE٤P?aeʭS-t_ԔٿZV!יFP)IE#Bs{ `,{+vdXnf݋cߨ( 59b@$b,TWý:1mhtr@^Ih#Qʘ8ԒNR;`ȔZ]K`\&19X"Uqj"@8iz$Ԍ䮸)gqce,yk֬Xij$n8=`Z0@tA3uWUOlncҙ)MWݷP\
_.lɈn_zXl!ϔ K+91Oe05`U0N-ߴҍZ͸/&mVA}F#JDgK^]x]PӅ dCmJEhfSi3&'n<Y5޺^d%LL 'PF2h(vFe/7)+./)Xi-+&u[3GSs6mS7/S4i%FٝfatjN{YhMUW^uoKfFBG%/7'X4 W]q4;p#I|qP!3OcHo84jm6!3Skb~ddp#Sμ!1TDYp"锥Z>8/jtN5Iǩk⯈Ho6EX)	w|3Qup	
9g\	!%V1.I"(ndRL"m  ra\Eppb6rCIaPa1ل/s QNd&_XΎL.-ҦHFooDZ(q\<ZT!=[@8}fN-ǈ	FIPkiJ(9cOVL=͏oL7kP[n?3zF	{ҵOs--[IfleQ+%Ku
8@M肝s>2iD5ΕBWCI^{a:Psgk--j=i۫IAdE e'M$ZJmT*)D:,fn%4*,ٓu,8a3ؔCH(B5wu"eeڑx$aOP41္N*.UJNedfJCJoULX.݄]f`HgrZAt&Q",$ac7:
 =~ ɏI%SMl%:6~)=GgކP4Vk.푆0ƯpCAHޱHj)~xAKԦR<Y +&1e|Ey(p_<wElӛJʸnI#Hb1D5ȗCP4҂W?ݣ	!DS,2ujdjIV)RrQܥk) ^-X/xM'h1+PJ=]*pDt	H}v9<κ]uueKbiӋMM_zٕ\^AIyȖYlв-5-zt
٬wY^SSn)C°Ex}DUrn95w,&A\<zÀoͫ^g-2nFaE\㳰koƐm5ᚏ;{XJO6oWY\y+2<pLf)8(yDĈTI0Bns+u
qhZ)-u>"*߸V(I$$WOɪMȗiCELAee}tS%e_< 8&72yo6j*N^y3^ݬcjEHϼS߆W 8-|m3`Vmk"QO.`n'fJř;crv1?pZqݜߙ-]FEL3	?Ä}ռΑrrͦzh*=|yF=#מbüukn07,*qR&bB/dnDdEC3#5	' }B&V4K(8\52r3e"mdͥ3:FPni*lSxƁ*2J)kmNL͆n;I U0V>?_v	pJ]%
VS<:<zK빶;'#Yu)-rP"ie0Q6rQ𴶰|EFP'Uvxr%	S0n%w,Җ^ufrw+pD7졦OfGtJ9ܣ8#h:)4xvwf{32IΘ8hs.@ZPtFYZSs5&E1Oγ+70A/R2~FSըH9<׿acJ3uZӖ{E"WV#sUm%Gu9~P#(;)13~ѶWL72'd9Xz&ȺBԚV ~[2V 5Pdh?}">z5CF[*)uDhY38IVq)FP8YLooNյo,^Dط	7SdfY.un?OaE7*2l|m>+XP֑kkQa+-O*%JƁD&Nܛ;S>蚖wc2"-`2ΤfsRmQ<z'y;yTys\'fO'CVZ*(ͦ*AK@F"y{'#c5;kb}<#sydO$ x)e[S?#FiG!9~ #lxDп#=ӗK6 =zU=`pv;#x	lsD 9@3?zʙ%N(187ݑ5aƾ)p02Uew#OԮG	є$n]zayCJU}\U
}vt-cL>[ͅVTl\{*Ap9 (S@@$yQՅϏ&Ohљ>Lp%(ߥcքX/[Z638uBt=Q|( !)-Qo~dZN۷qHiη;oWK[($QK+0zv=eMf5jݠ:PDH5
?ג0ۜ$9nQ\nKa2G.7PQZ5<ohQY,GFd5lP{ys/3\LЄ>B,ݮWbWcY1#TEkfUO%fݬ?ciI)N{|L%͹|aD	oMg	8^!7Up X!lkhDU!ܞ+PY]F)x˷<|z~ވM AyKlI*6t`B{vd{'um/(20 NRBciKBHnyMW,
@Tf33xcV6䰛XrLgY'2&% d#JQs-zz<Q.d|`B8+'TV	7}[_}JuChߒR`~;pW[?c#HXVEz? 0)WHl%A劝K2Lu"$Y:(4,:\XNfYǟid b4o׳޼qW&;ȅ,z\<T`ASGm_ņ~$r_	ufd跪	9%b80Pံl##<SP="_~A|nCGB̡ !69kAIn$PQMiDC]\4/phrLu{55S<@bz5y~^Nm]	
ܶ&$\'TsqxN澹g[Ѓ<K{<H,EH|t7N02qs-fK\*gLz$|๤8lGfU];G m0%bD;x[% I_DͳJJe\ӄ9Dr}9+Xm4/jk3s/itn4:ʎǫCzKD^h]T4FbrTLЊK>&/yK1iH	7iZ@^L2f;_UFjZd7c;ǌʀ5:Z \kJHTez$*0w:5F>*41uwX\[L#.R#P%	-GR:H*tPޏfGyh5[j\jD_R!H6b/Ր(Dϓf1!-$m</N*%DQK#hϤиg+9YGF~I(x	CP%<6Ǻpndfm35rQ3oUDLt(y#BEex!^ҝ`vL/#ˬK#|IZ2(8NAnl+OV
<wzE*zGR2:=f(,f8	JozfPV\e5X="Ҳ~I|;3[ zWȝ0/#w.b{焇NCW(@wG"F-GלW!3	ri9TFTgPpa|VNNBgX|}[t̩!$6f$'ag<uZ]5"eVB;amt&}R $<
j,.{r/.^襁YoUy )ţwOѮ -)LJe$#t
`toA:Ͷ8؞</K_
&W 3$K+'V2sKy)khu M
i5W4-!ct@gaN`:;sIH_\x5#pm5Ayx#o<ǘcϑ*{>E/׽ϓ0 SaŹCI$91T>fg^'^|:=c ꁂҋ<9S ԥY*w;.i:]v%#Lz{#]qw*?mOIB:nFSe@_ԛ(hX{4>ec7IYLIX@~zZ;3'FbTbIMc jO(>Dy|٤"jJ~9IzY~j~,ϭmzٵWxEa53vy΀'x1\,6 $cHy*8yTӇhR;gE{ƃ/Z⤋;'Vc}fh]Umģ@_i(r6pA:1q[9 V3<>C7ዄvmׅE_mIkM<%+{g˃.YW@Qa^X)E4EiOϪ'[k@Xr>-$4,D,vA ̂ie8af7À!9(̦dT@\L>!d2Fӣju`>_׷dto.jy?^9;qڔjٓ4MbCncO@C"bknBsHE+zL鑭MsF֦= <D6mmr`U0[NpnFQe9bYcO5!ެ$y_PZ/a!Wɳ֢XRQ
F[uŚ_,ZΩ5OCYJ>PM69a'ѿe;ot- 9w#&e>?=^ QK #˥**nnrW`x4.XOI(XmiڒyT{Zؙ-#-?mLk(8q殨rxnW@[`1J2iC~?4aF:oZvB%6(i~1Rњ/	p~z>'ˠ0:h}"I^ʬl%¥
wC04+;`^H1u}1>3>r||B*vPEDEK+ѐfΝE[^5Cn6x 
8F9ĂN~偷4Ǝu',]=wubEUy ^b#KP	pzCw]~G9|9@! tZFf5D׾7f%?PnN*bԥNby+
-%.Zk\l̰̰33!-4;'+PC:lodC_\Dx> +Cg2ak- :{QD.Kv=OX<O-H}q:h^0duCQDRԹ12`q
ȒΚAP5),$|%x2y:UZ=hC;)mvӐN8qՃS_,"/B7}P5R³Գ揍4
EHG2WĲį33F=ybkDȷ ɦldbY'mxyX}?)CAAͪ"V\7`_GXvzhuX;UhvۍXA_S\,(ǡ;D qI9R_jnkgwwqO!?CtMj |:oG׀_m5:`[;wÇl7ܡ]SvS<0Hҍ-jt	N,ԡ"
͒<Gt˰"8Dtŉ}JCTGjڗ{~kЉ:.rn;i>ԣ#M}rޣ]'9rY۰d~qpdCUk|E$䤰Vu!,	1iޣD"Ȧ)0SPd*LbFJHԒMZ5&GPVUJwF}UGu&ǂ9wux\LM⧍-9'|-.Z{{w EOv)54JF;&1 !}&t$ʂ\\i|Z9w5Iq5bgoe{18<_x3ƨt| ׻[ۏ7( )5M;R}_EȘCȃ
 q<"̚HyH=ȉ0?!ϝw4ʮ1coR,Yƍ
*ho'Cw`
dȷ	O t7lmΌ&hw.eQsh/P$3,F$^3:̮߂ڿ:qPol%@5^Wn*{,H@ohlҤٙL_~$c<줅Y>EtRUǥ(Ho '`;I8{RzGAU ;smkp/&)(hIf2văӴ >|N^G^=LSLhy^	yo4GVhnnRA7PM۞BE,$IC\|7 M`[JX .i髡;rO>FthZ-=6p, 3^7I;]6ɊIhf58vq7:W׆ה7M.p/F?$V;ij+XO<a̝DЈd[`9|$)V#3F^а#8(ڶںan&~KDj/3ǿz|`m]\e_uN~cZ2?lqk\L.@o[؁>nJCNr<^$򀩒/À/z?ۭcow	..[C(Y^B/pwv)?ُș۳|چj_
ya~w2v8S.!f׻x8j'I^|w}(&yvwwO{ϒ;/T5˟~ +-@j~>Mڗ~s+!Jb^4'I}ԓWo~|_[Jݝg;g;{Hi,5h?_3X?/h_[	07YzLO~1?7 m=de<Rd :y	@ Ga	)8z6+,QXaI]o^n
]*L(Lao
`o7[v_`\3~_၏dv@۰@~4:G`tDa
rvwsΟw4}j	yH6FE}[,,ˍ:a$lKG<Ϝݤ$^xaƉ>y}4`&sh>ƿH(p?vBρTZFmX$Yf_Pxɍ82ɚoP86Qk)[#A<5IiZA49-7,XGk27nllx-G H}9)7gnfoBl"@i<̺5Q)>ip]G?_F.9Y;
U]נrv5&v$!{n|st_n0̲]mfn{*e\3R!+Vbj RK-7<q21蓙2$e^GOZ"a)Wca/ns.7Trkt..B8"w?'!]!S(l	?Zɛ?c.hmߤANxx
N_/-FK^y7c>K)&olЗzVyɃgzͰןVRIէx:ç4ؑc_}ZOܧih'uFɈ_=s$Qׯ{?tQ1#o6Ȋf5_ЍGvR3&쌒8FCɸJ^^$C0:2w_u/v1f;cotƁDg~OH6X7ݏ(z' \H `i#H|ʔ@`lY/S "#4GA_-YYMuJpz'z<	YxۛN0X_LJgzQN8=nޫ7'lL̐>dFc61	F'0{QVu2 c(x:]xz׋
X;NՖ=gzmEX=XbkYZ^]0ZoPXmQIkJNfךQDGZDd.[[Vgo4w#!SN[j&f%[@3)-SSz!R
%@V[45;mB Y RL')829w$wRߔI,c`fyb|ւOeŞ6Y4vF#s?hEOw9.=w6NT7K=2%44tnM|wv)_;!Af>$פ!{3r3:c+ͥ`xgT,{"j / @zV2w
eH@8}A9$xꍳSHc՘|/)8K8:
BŭzSZF ^<;	#@Ұ:.!C..r$#w#X~d'ޚG0d1~]Jz~၍gd2NLQ5&1;"4tG&4FJԅΗ7'(a~蝱B.XME'NC_}T8x
vU#(>v-*jܙ9r;Já!Cevǆ9kv:m{暀ٵ[k8)ZujՐO25TċaׅZ5{9$`[lw~p ]i])"J݌-icB	}nv{}iW~]M@ vT4:ftW-hkg;h^*k1@V:j;6@nګoum\4,@Vmvn6VֺkYeQUV05e.k$Ӳ㐽oе5
Ok=5B! HW;6,$Zkv:^HРnۍNj5u۠- gy֛mX܃&PKa@RCo([ۭuHz-Ri*XH [k{đ sgՂvWۖFaֺ[5YYo:`hu6gMt/Ю6\&|:$iڨk(|YvaT :gu}M>:Џ]l<[h.XNw-{s`U}kVBZvO=ȋ4l[_oɧf+kH^t-f:(O<:z^]o"uۭA{.lU]EA׮5 5ڂ z#ua}mEh4W7I$3LQuGy8m*j9(|1OSA˦R43σ2(;W:bI}ր|TenOWbPLz#.
'_g3/<_ޫ~5<V043nj?F?NRe8&0l[!;`ϥmm8ҞԹLB*xϑ=窣|h6OwYi#':T`7%-BNDjj7)[Qbü~ÕFj{2
!Bq񣒔GrpQ{8}Z]r7ɩ~/)oWG>	fP}G]m=7o9e}qN+9y-r.c]JIu!$qx>Ζ^Óڂ&Ѳw&NRxsM<$fʢhk$Լ7ýIenJ_oEȇJYu3=/)'L_G?3_Fw@:JHqJ5z~a|߽c0M"dfƥ2:	EKK5j}vq2y>&{Uվ9EB%O_[ȗoRK7I\8ӵW0R>a˘
"N{QtgC:(V<x!wmWل_)A(cGvk]r?J]Q9,32SЍl_x_j*R(,'Q#p6Ḣ/TcFd5"1|ѫHiy	S&)PI\}I)wieJZM\80Nmf_	:Bd_!7mYS'IN24vf>ilVktqxY0#q[	>FL30,_}SoU|\wCceVbpQSb	+֠UjNNPSxêK}V./E2wXjMw~S{smNwd7,VH9* 5>߫JJMSJk$(dEdr an`AvQޟ9#oPjnn|A0 ފ;៣S8b]6ϰۻ/,whd$'zoO~#ZGwIkLlHKWDg	U!E2E 馄cIfN@FxœyMK+Z:JL	+R8CU K_}K iheOi?v3Xq+/U)oz>q鎽e+29:H(`W! jQ+BS%D@$EuM>pU) {^]*:e*&&{FQT ľV;BG|uE)6ynjxm71oJcC`UWj/ Ftbe)і>%NL+YI:缔2B/OcU/%,'(Ssj^,{eS֨4*N #5ӓ;J|%vj:a\d`lq(:f&+\R
F5>(UЍ)m3]u2B:n1t.:u0+Sy'22cx6ډ#oA0X5)Wző*bl`IF(Hk$/6Pd8.عP1(Ŷ/J0d7i\1dX$$ q#gxy~;?vDϧNt*BT DǷb8m8;;a2xd<'T+$	R}&TFJ1ʒ܆EZq&i~o,:G.g68`vAt81@z[6Og'׹>V],8Z_j@;cfl5`ٌ7/v_1+`mB6ysF(\`ڽ&H}\PA|;F>CKqU Ped
EɰD`J&HVHܷl(bFΉi4(CPC.l3N3!(لbJd7bB	]UM
F1OeD17V<OvxNHa^qH%
]Lt91RaDkbБl?;<OrkG8h|kG\45m4wDA y@MӉlA{7a:zhܕ ~>:aWf
=)w=Rì2J5yjQVG?wA$^eTͮ'7Yȹ~>t?r=>[_1Vk eSV͇4]gRG2;QR=@D3KQ".̃1$760pzŬIq̄,/XÐx4J6Otz,;r08q8dCx67Wxzq ~f8f8@o82kY2+V=G]]ulmQ	2b6F&[LqN)U\㿀$iR24gp}7sh'"E`e4şcc=, y献rx`P:	#Y=L"e#=ͅQ[dM\OCwsf%RB,4g>vp&Sp4t.`f	3Ge~j'T_z³Mb5[;'3Y&;[9^pFDuС~V/i3VÀ1 oTkod4*Ι.oߓ
xՃ,	vn+i@>_IGBbIʃfE1a0Ʈ(-'a~(_3ZD!
č!+DOVNxQ{18u`S߻28"ō cfMzx5K,#ltnD<+9m!ˠy@qᢝ7!y pn hlԥt{IV̼enpB&<`8p a39\/
5q92`{✳z[ "㥌M%rEH"?O2m2 h)'k>6N^=mo./sxΎ \dFբJЙ0lv<QJL["!op <"g0Zh2!iCRk00.`:^tREۜZ:YZ1] FV^_t-Ȼ` `Nɝl5Ihck-6uvےUSRQaP &\-yVi,ujQ@bPrAnW1O@ۏQ2 =\x
VDfkiEJ϶D@>G"J'$V렆
PMcàCE@Mc u;|ɦ#dЄcކ\AJB#-<Hnvёe|tS:ɶC`"+JwCW`])6O  Ga1¸ 6oq!^l7ɰ2A>뚪ӅZ.O45QgDK qj\(;//}U!ʊl8ʲgKgy>#n
o3.Nj9btD9(^`jFt%8A" `:_OI1	~Hʅ!ēP+"r GtH.3w	>L4A3T>OT>:Q})RaCQN-eZtU l.0DcngZ{Ǖb=fMy]<*1CҔ#
3 ,e|$n'<!0-}w3HHY<t3hj(;-[Tu?d/s+"0~:foW6/wwFoѹssKO7^3ّ_z^>ǝ\ed-n %Ẇ@Y1`kij.a?Dn){&ņ1|(
G0*,e%gYłH*fϴS*ʘE"?2g:HhORX3''r/a0Z"UUZ%ݏq_<G2)	d
ZcC	bѼD+rqeT̆c$ :r_]uLH3g?()F,K1e)/HY{J/Yt$T)5ym솹Nʭm5Ќu7Yp^E2JFS
\WYn<Bս:}:D2xQ:K#\&motpRvD!tJS&Z%oq*TrEZ(fފ+pps1o4_^+V@Όh};ޅ/+yyqU&a0ke)ᔶrytHtuaC'p"8Jdu]yg+xnFʎp1n;~n<LMK g.VhK/+6ړᨂK)T%W=Dxv .TZTFS1{!,eA{'=jiJLhL Ia@r$o	@{ݴ6\wb;L`oz-}x_!+Ο
*߄ <q|WڢоrC3z{q67j\\mЂHM]1AxTd9Ɖ;3O0tY2 $ /dvş=ȍc1tkjRIa8[{!Eh&EK) ]JD1cҰZy@7)1In!e>0l5A&OlȚ=W^hJ3
:YrG&iN,)IeMeR$'1}T &
T;SD7d`IS6 yhVyH<拽
ȷdu'ӡGX<Nq++|I79uC|l"x܋!| "7G?#Y(Iڇl|EM` v [[|@!=ܑ]l{M5aA_77i{Տ0?"[J'u)$L+6? Řw(X`(\x##	_KH !$D}KD`5	+* 1C9$	Zc䥠q]`BX@YXұJA'(e'	ڤxĚa[\iGaH@;C3204 U@rZ(JyKOD)Π91tHv@P΅c:F(` zj ` 