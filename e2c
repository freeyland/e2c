#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] r9(84/(*2%E=yRU,.lQʌȊ$E;O<Þ=fg>ald@IQU݌*18p8aW/{UՕVoMzvڮV!aV_W0^t	PO#N.?_ffj5FѸA~1yF	߬xUm..8vN/FuV???mo;A߄ѯ_U_m..ߋ/5Wߝ\|2=faZ+el ~I7.ۮov7_zjcuƫmv愞s4p1?Y6r aG87
jvg@~uAJ܋OYe7zgn<㡛f<gE䂟Yu9^̶m{xר0xW=$aa{o:;$)t|pY/cݐEnx\FIَwV	{X6ZkۮmgN2g0WFec?v!+d{4;ōn/Чޠʘ)Yi6]\8tcWFk^Љ~j=}ɥA Tyi{~?`sǇ'\Yg7UB7
gDDiǿ`Cvbvƴ~m$0r9ap9rA.vAp dpB^ 7b6l/}5c2ΪM/v3n$CX;Ff,#p鳝]kĠ9\2"GQM(SQ؍bv%;:w8 ةPJ«t׎˘6[Wz֦_ݏ`ۏËavػiJOF4gSK9:Z-CB!3fG&1Axs;z21|$FR2H%;we1q7`71ajzta;Ol3Bd9.+&jӀY.+Vw z#b>nG0c,q4=)cr?z1-{}G2D	}/:tdY.zvTΦvN{umBBEAF%v(FPB-"-Qm| N`N` &W9:jTa A A b
+M[i.qWC̖3H"85~Gris*fҢZ4ڮVe~%mRR iV~&gŶJ=՟[8j\%L0Ruśy8.4EҾߒBv
~@"Ug;	~VJ$?$/1 ٘5ªZr	! k8ȍ%;	[WĞgҪsU4_;R$vG5cY"uQl/w_tv^my{iWj7vow:8ҨvAww|}E wsO*0Lowpx}fŠ&1Mr"d6_y7Q0.˂goKbmF1\[TU-͗Sl(uI	O"&ы¡wJ?{0g~dkeWӑ|l!wv7|uU*W,tNl!
c/KRWbM$>e2Q+Q]^[*+-߭+[z8ޗ?WkWJwv1Ke(xL9Q6w0t.2M.e~]V :cIü=NðAەl(OGJ2Q
v	YlQcT		\LAwħE%(.)QO+'5rBll Yw(6SQMGK9:rfgq_nloom^]]qDC4> _.Nۑ}SePwIUqqȬPcb^!:9<X"ھ.I᤭\ue4["sA&Q{S*܀Z7rij	#YP<g
8=i;	ѻ+>I$[	{	#`-34#SI팇ZIi0kҩ@"@\E@90.iIZ}Zȑ\NX1A|/%}ǘ@lҫK_PݬW iH0WjIߨь	s.Ԑ6#\`J	+N%諍A#:ic=}yc?i v-_e~v|[?Vaogci@0 4 ⪣{4 *( ͩ"Uͫ?lv^q7rz退Ʌz/<rV1RsNLNMV8h
>X1ggvq| 0oQ!@VfUhhs	2M`y^s2eu>iT$]p DD_!ё 3bnީ㟸}YԾXa\6#2n:u*˕U4	6׻Sh.Qӫ_A>'h%+\ߒ-ϓ <*΋s'4eQnbktsv)o;f]uָ̙?exeSnӛ-d6u+?~g(zQ$eQ>w;Y#ZÜ?UaYfpY \l0$zC׊/FnTN>yŧ:2Mo}d҈91\=u%']rQ
UF}Y={~ˍ?v6K샟w˗p*rRT~z{{UB!%34A/,:Ӛ<O,36m59,[r-^=!ߴN;xJ=DnoOTa]^,Xb,nߴ@,݁YtU!LQƮ#x*D}uQŌ(ؿHZBRlY&pa<WdG2o^ͫo6`|R#qX!&)ZM%)C/?LAE
RZP0=2$Z7_^CA>fu؋N
 igNx2&s_?f{c_G/R`uqÖag^#DBz&-sJ;iPօ3KVڻbiQsx0sz= {AT`޳wZL%/	/lr'Y)B#W~oadG/%*$^R1.4TXW10f@9A܋s֌oy j.(=^&-hžp5.hq\fe_q* <VYa].!I<EP0)`eS汏`P;Ia>BN\>2fǜ+9*,1@"+)	s}KJ.tZCi6)0,hɸ!T<nUI[HFFq0k*q)0ˬ+Wʗ/E_L[w&4E?,/֊3̍Ab(\LE-d\;|i+\sC5RIטGN}e"qhU2HvZHwz4ZMۯTsHaj47Te'zSƢr[=V_/a7?l,6L&nϏ%%u3N-	Ŵ(ٕPyLY+t*_7+l1M%w~XP8Xe.ⷓ]<TǣK$,VJY$bUY.b!QJ^Yk9^hE#f_6&t5ÛLI'uFwKbEr^Gƹn&}1S;Z+<X@4QTT	*¼Ɗs)Ա~!0B;kYiϘ[6zЯMXf=wR,[i5wɴ [a. +XP\&d9em2(")ƣ"&	KRq떮t~giXz%5Z^,zǁ=7XO|cq'yπr*V癓D/[Û }DWW1D'$64
.ELơۭT2ƛJdA
[*gvs[W}-6HTdUGwX9|˝W,bժ@it:^8d2Zp!Lnؖ>c+p^Ͷ|h[#M.ZҾvk$QZiws m+H]mtvZ"G(3JwlZ5Ke_4ޟv6ot6:%gp\Dy(
ϼ?`F|@#TgV}@QBUU4㑭^CB_bsOh=tЃ:?7 *xߛ7/^E?*ғ;+}LVLf Ed!yHpeD擕2f.H۩olef`ΊrRm7e<V!cWS1M-I(':[A:)hIHe,ʻ>r~BC+KWE+AN0܀!q4yA!N][~:	aLd-L6e.79Jv]~V!K+vVIS9O`af¦sh%݆@7Z@2Q
 !3jQ%f`ic v8ټȠ.=WT!03*%+oѬդQ-)ܟ_]X+,J焹_\+E9Sj_9MO8J#FD19qr>n2'TD8s&nDx*9'Ek-ڀu6{| mM:q:<r >
foAO
e/l&js0@z7FTI3GhXJS9HE<ot$=N??E(]^_^oIIzGxh?
)n3ީS{xe$/.Q&nG_9:[*{!ՠJy9nw:Av%|!\cS,	=e*A)L	`#)3N"<Uʟ<-NEn6yDO;_"r~Z/FAEBvFv6<rc/Gcq$oN=!zst|)Z?3Qιa?LZqgb(G"dt6S0|	R`i!|9ArQpzT[.Q6@MHy'3yg	iKƜrӜ_R՜P*=aY!#@'y~6 c%;4zLIniщ'Yrb:&.5H($#K,%t$RFP$Jb$B$`S`%TN Ŀ?wvF J}wXZ^K/DYJ<TxП{~NNO1=´,qC>#L-7똼3i:n"$,b_Uׯd$7,z)Ȼ,,ӓUΜwKYKߝ7M3i*zQuVwoSʆo iK2n)-R4Ҡ22{e	hk:g1Ic]Nx&B6'A=>ĠҥI(*8H~F߬B~_,p{t[fdySrâf(y/ge"]^x[yOqNGJ)G:5J$o^ra%UprsUKaRIx,
ir2)! >uo&vq3)	1^
OMhS'R\".%bʒӈ~!K(kxkBV}zcN;fJR 1ޗ92'V!tCx)G4YgB$N1Z!OØ `IA )РxQ4`JȖՐy635VKX@A,|cK\ <hACI؏rvG8	F4y@8"fBL򍁜n``|Q1"%-
O8`XGG)aGE.Jz~&I~33ܮI/rXq+|l4".
	Ph2fCe6%SSq?jK@ "VL6i&ipMOBV(t
ZTX+uޥGU?uS?\fb$z4*EX҈w!_,l¤
A",VC2Y%mP[2ؖ%n%!tvn=^iɛiț35Y"e"d	5AJD*JD*
䫶,E"ːEd	|DPc79i]-#L]KV䮝5FrW/$)@'I	zZV$tWdE %w,;rBg#Ӳd!%fqKo?iςh:y!)3G;CG\2KPLA稬q8qdz^bVvrG>hG)Fݢ.QJݜQߧNpKX'd>M3F+}MMTw DMSKmt]댉D]UڇTp({2ݳH9JɔaIL@djyJ7Wj.+^d37?)hܢKYOd.{MW&Xe+QJ]^	d1ćo°&QuG\";+$σ-WijRi-j<LmsxKûkv?,"7CSzv-K.sonDRع'[*ي
Fa)*;7$^mmryfV;dKJ)v$I-!]SW)q݊l8ԞERbx9RPUswiMI\\sZh:I
- 	0GY5FH	yhH#'*0xYsyyh$/soE9==aPD!ю!4Mè,x-R)PZ@0z衾A<7t2Wכzr#4C>2p~-y9(N|UpHsO!z+3n\u3W6#ټ4(ۢDW^iC~kS}y'?M«IW)l
t?rEs^A5_m[0&E#4r(Ug~Q&4:@=}k-u9R$xI8{QUZ"t1b3ЌGzZ)R]&uI~)V,ْhfJ.u*-.#xg6%s?K 8wjjLғv7'7@oZAC7 1tQlϦ7YpVNjM4ùMyvt@< k\Փ0$'Y7jnvlAJ5+M#s0ǡM*7]'imܿ+	RjbR{0SkE=h@Q)M$Mk|5ÔZ9eA#$S#7\VOid<G3<7hu?i?SSjȢEu46ŢT84}B}U9,~`^yb18*b31g-b4(fC2!I$uwcgbXצ&v3(`)	*Z(vvv޼9Lga˛O`v9Wye:HCfP^ׄ>"HW./,KA=)m⦈Fz=nHk <.|n5XAҺx-nS3ĩVƨJeH\a9uyѴ, ,SI;<.KySis:\gt NQf2a#\Gi|ۼnE*6r@tvd@)O΍f+<].hy2HqIJu]w
MأBx"bNv8>ITu&l(C;?#O>y(MQB'&&ɌAzƲ\t,3LQަ 8vz[+rMbyNljNg`\<daЋ\K|ųx
$|a2~UbM /"=1]Нcg,YEy,GQ(>x,$a6-pCʢlř]
Tqɻs6Bm57\-3f¢b_ZZꑯ
U	bre8t݋Ǟ: CK})*s{;	/WS/t>TFƋ"o|9k-|prUΉGktb7jG"锸`z<u:OE&u/q?I6j糤b|v?|,EG:krhYFnǙ[|ϭsMj^tP)f|پo,҃}H|mCq1hWT&(9%Ccv0Je+;S۱'57[k)+yȗ|h\2@}t,#im^Q"[3T,D1^R,a'JeN]S#IR5rrQUpfmIg̫ᆣ"w*3FO1ÝEMmT,G	Wg4Xfc<#UZZt%\S)[B"lhCd{_v66~߾*ʅ6m\o
s(:~.?2m#!Vc/L5?!;Ysu״.FF_Nʖi^;<C+Zqʾ+@1P͍hrޅ|͟@Vq?
`y]PQV,嘥nĴI8{ ĵd=~
Dt:Xy/3&*Dbxbٹ
9Y˨orhXdSnISifZ`M'5eYSXzVō쟍G'ӧw:sUG"pdAԞ"96j]B!MGT]s(,ET2H"r@L7@~ .53QGJ8u`Ff3K9%^p|OQn%sNţsޗ@7PD9ebR	j5jqH'!;00hl䩐O_XbZꬁKn본)n;B,f_L7ڎ[HK6a}2J:àhIY'\׷bR(FD'äSF0|:,ЕP(,ߌn0;736-BiE٫vzp{&f8B6v|v/Gf|IS
o&ٟf3Nh
U|<6cE v7vBt^6)vhݚ0JV)޷LU
$00 F[TXL ϏA]'&pco9W̢ K^?XmSrwoT	y33!f+_qi'y	$=L^EZkr#*t_E8T\Z>p2WY.ԉ~G22/'	O E=gE >I="$g;Nz(I('	31<&I90./E=f2&\R֎ݣt2F`T6&QŃ#Ѫժ-$:zwX|MP[\[\>5:Kr0c0|!ӓ,@o}-"(QR$:[!n282t¹PӅ x`TEtppUDjqid3'5''Q|3ᦪ2mj6SLs
ʠB%YŗOT~ٸ!I_x<c:)frTL0ZmF UaNէI+8eqtjN{Yњ6iP4qDCvn
0Vܜ`ފSA	>&Y%=r;\u	Vy|&ukkZU֘0t8dfcxAߝ02y}μ>1@*$Eܹw!NY,RS楉f<Κ$'ev	OCl_kaHC󈆇c{-\pb/ep|̗y;)%Nq
1b[\	!%!1.I" wa2)&砏fjq\tul' !Irp6y<T!HTaD)!OsG|aq~M4O1R zg13ުwDZ(hL\\!.t	ۃ8}fN8@VKiJŋaVL9m]=S&Vrb&OϨŜ`Zvy4e$lJnR!&hnpglWR<4gPPY=k۫ttgk6lCGj&|lEe=g{%3۳"i*Y`B?N1⤢RV"i
H0K=[z7+,˙P]8L=C`=f2Sى_3pLtg>иy08̊L$gm~oULE#݄]ofd/q
:(IЍp $ J>Ccj-N((:&;G&"rڂ"UFPMD:bm? 3T'dvH+ۢ\d;;
<}a}ƴvOoq8'):	/e1C I>U
B}e*7%	ӗPQs|3LxP9_<ɬ.?ݣeDKa.5yrKÊ fָ2y/-./gesuYK`5NU6ZfZ"G=W+wRzMMb$5^AkrDBL*cxt
xq(5f;<IY燹r=KEo'SrYXxLU0R 쿕2t2KD:n^b#SUD,6?i)/P~ͰnTR{mGt^R:Ům+TS](%<(n<Yǿ覙+i!=TA\۴(XUo3eum[&H e_[K0k2lRHt232_n}8mڭ6[M{.X)}	w"#>g堛MjT[9{΍zXF=7ņyz77`nVyL:97oD͊U#eL7qOny?'TF6T&ԤEUgv,ԦvB*[1IKRn;m$em=7WI"4>;+Ѝt&:O.n5RM1/Hus1"׍os sM6dPb[\42J:19r4#i'[T,BfHp%	ʂ)212jl5'U:i[9zO2de7fN9>1&Ȇ<l!䤉2Rw4[MC
UoZ	  (檛v1y+ϠJH;NK6D4<hYu2s28TO13ŋWPRN/zc:4xHsD#tD@(??}YPd-duu5~:%݉}2Zbò6&oUEJ)׼5D<CXKemm8=r]Y)KPqX*
zX9|˻f)9ʌv<o%9`8v6ZJ&4$s4tB2eh֚zVʾ~;IK]ۭ .K,9-w%Pdhu>*Y%zޓCF[)uDx½lAyd;=ALཾ^08ky|mE62nk^o)ȥ66AoH&v07dX*f1[lF!?ܷ`>B"pɸ)Tа;S9[Q  ]	n]5dФD?/&JwF޷GڷMַC3ЦeIQUB4ri9(y勲xgtRB}7>j*6_|,biba3ɖ֊KN.oaDs8#y`q`:_Dly.x=EFqL9Xzpo:~Z+O[9=@u1uó|'Nbf8Q5[ƣ}Y爎_Ag QO=)xtbgnAw`afJƾ)0+^b:#
2p5Zؔ7[?f 傘vR姶
gut-,NLXɅPr3`0O5t_yUՍ.,xB5+*l3#x4re8~OX	Svd*w{죊=q%Y\^^1KS.:(imzu'>@Kլ)8fbYMqYJ>i<sCŖaRF^<KOm^͹5r$M:a{y_QkʳvoBD!SQ-:}/qF^n+VLL.^vm<KB4Ȃ	(\o-Yn4Gy>\hPLWZDuoѹ	xB7ŧ<aG/*W%e_[D=P#.qO#AgA8y'.I >nyfNU AyKlI*w`R{z 0>uF|:(*]%%4tU{2xfv<Jq5΢`sEQ"!{,,ۙG/bt[_8G	6||!2Kd6Y0:ʡPY~iBMjAV$7<^ٮ[T -xņ9Vk$I1Bb/$T|-R'83I 
MZCzLfY_id+b;o׳qGn;,:\ɟ<bTBSGC_mX;/,>&OoI5m	΂9%b71a6lv$D#<tSQ_P 14Ȁ$хDW}!L,9kAIn$XQIqDοC]c{\4/h&Le{%՞s
Ebժ<g?,sdu]	hŞj.h'4&n=	4,XSY| F  M+IEӿ@tz@/!s_j90]"rW=eBփ֥P1ׇ8l#+IÿcJpa=*7VI"ȰFQR,-5acg_NS"V[0͋ښ+P_6uCaI/!=UVvn4Ak]4p19*
&I%鈼LH4xp/W&L2՞uk.	)p7vMBP47ThpQ+GJ_y(#Qr71z[c4vkk9NRx݀ɵѩX8kB.(5 :$	YuT8 ޏfGzh5[j寯Ո.VCmh5Ī+k5_Q!T=OSQ/e{_():ϳDZ,L:rF~J1҉HXhfW]rAQ_΋>O.TDahV󷺈n߳	x8MېfjkNs֢uJY$w&&:uҼk!Pbth8t ]:ȹ2ki+`i/BKf\g	7ȍmq
YO|g$;,"љ	0Ca4_W0,ͫ+O@4[Cw3\*VX.Z>be
֓P}wGf7GI6_!?>u~v_rIͯj9QQx7Gu;Mލj>9k-sg0x3DM+iʹYa<:	"x0XeN:e 19GF׈h?Y_:']f)G,O{bzժџJ- A+8=jv@"+=%x*.nXđR<:z0\_
%m#$ȑN
:0:7'fێ|wypO&W S$='V3asKy)kh	 4fki[6rpӑic߇nc<{:zOVRRO'q)쎘mwƙt@
_`1uFW<Gx$t1Σ0ca'CFT^H"ybT]>ag^}T*'^|:># @?
<9S ԥi*xKgpx+a[p͊ci{$F9]u(=Gq@u)ףON`3r(|qs#i5"$H^GYOq1|ɤ塩16'gwcGl?ۣAD
_U  6>IgPK[GK-&Oi,.JuzSmwvN(f<$.	/"2=PŜ'4kBj,k/c<%Nq'e9ټ20CUhc;+Ez.Hg03n3UĊ|g|Hhf|]xgY锘.SwΛ><<m1@ (
K岈ϻ(mLj!tblwKNEdpM6d :k9`YgGX)0Q^fs2* .&2џYL7z*ovv*2f U:7gd59QA~JdI&5!c' sz+9"=&憹qfs1D6mnpGpU0[؜0.'TNkG&Pݷ S އ~-O_J`KE)^mk~QK5_CY w2RB7MDNIqY7qoBL}эOO.a8#dj	]aF͂77+xiu<g\-V|b<	!õ1~iQdղ-ϔX 02RI4rcZl`]^2ˑ^t{[eRG\-͂mm,MD$fЄ}꼉s5Fj	iGI3G̥P֛uF.<.>Lq*bPXl${Q+J.K?0`СlWwPy7Ȫ-Ps+΋};j
?
sa	5Em,`,.s[DC9wDr"̍57H6?AD!i'ONcȍ]Wz[M#x'YW/6_T7_%6rĊOH$wn0.[tg@l(Qk	/_?O?|sG:KrܜT*KVL/|:RܶLpђUr3N0Nܷ̄hKtgC;d:ngﯮrkvZFnGnЉgN5%"~^9Ch%3JOh4@u4ۇ[AtB@\O؍_	?a%[F<W$t!,5BIQʔg	+ Kv:k:3CQִ,{d[YB
h@t"zІzRڼ:1.ɀ|'."<zX9uA|ʝVcą%<PYLOJ + \xV٘z^GJ Ҝ,<JQOZ
Q{$GQ@1ٴޘ78+ f㒡~XjXhjel}eTvwݦj?-~5ZZ]ZkWWǪP9>_}(HɎ'5K~';>>dǸa(v/1;u?38ti{C<*!=z[Ԟ#:0O`!i0 8;A 8ZK*^~C^y%nc3lCWN>UghmΑ꭪ X^%|y;eZX,Y`13$ĤZk\(G`+rŧк}!S ^uSRBv4%һnhq4c"aRQ+p 2#GDՑ[Zx89y-"93v5.6J0z|j|:'L✧Prg0]Xf@BV <ނ\[1[8>]8w6	*bgbjgqzpxE)uAo6"dFnÂ,"(l<"7.2Ȭ]!':q7?ҦPNnL/;+"
헁~U8|j-[u[J;^ƌ\i4W++͕}ť?@j5JXθkv^mޯ_ݯL~ݯF)c_k7Y +/0sӲ3`LaЉ8Ecs+&@}ERпmIq"F*q`t3bsVđXT&||R^i`D{z?  IޜSg4~1ƣޚm/f1뻎|ƯGi.W_>4{ =۩ ?DG{(`gnkAJ֏sZkGB6{s' xq8{z{2O1
":w5?lA⇣n4LU[j%,3YaJD)TDFj!Kwi
 $o mϼ0@
R۝-V~$Q&aoy1LN_݁{Iʀ##L'&==RqOƖ,<}d[FA6ɊI=z~TO<fk)ڮ5JU!j.b4,3'R45fX8~}̯yVͮ\Y Lz0wLu	'%0pCD<=qlN;syD#ܗc`1k v~I9;t7ڭ넽iqFloߝ\?cZB>1hrc`gs{coumj|b?XWgr"SD}9x*R:<zW82fiWN.Wx Sllo^v3_PN1ӷ|چb_vy~~2t/8S Z|7{[cH|r  yvooϝ[˃WvGxᬼvϻ?GM[|8ac?igDSޛ74iU_qӛj^I%wvˎRT%9y:@{eOSiNˮC)lmO_m?v_LԁTGT|QywTOVLZ-Q?qGפiL!o+7X"ԏ$Qި5qwe*u*z6+,QXv_my
+L?/Nao
d
_Kz?{;XPQnMw܏0e#t{/vdEy+t+{ۛ8ET5Z|;wAmc6{pg{ɒ3;R3#(IBFLjݝ/v~p~S4bGu?{EBѵC'(KE⺅;~6 ˨9u
,W?*#ew~<Q,8(ˌ$K`jQzxO^]ҡq>iAmd6rמ缦MiZYכ;&XClڈL3GMmHIzA~UZip]?_Vھ_5#kTa_`_k0:V]נvfF]P3ɷd7ё0w[=k]?r^uE&zYVY*5_[.+YDd4c'3e+Z4>ERl_ZtC4[{/wr%/˘vոwq	%YL=XB<	q}SW$PckU'ofZ$kU*OӀw,/4WGRi#
駫;p?m,cᩏoz`ϻ{3A?\|޸N9gC7vVKSyfYQ2"<I uJ^?>]<-zxț3"`8nVQ/F>X)lx%||+Z aA zqxO?	 ̏m;/de:

;Y\aOi:G]`q=)~c0TuĖt蘀AaD1ǐ<
8^Ǭ3n_G_GN]46}A'a03{l&q8X.L/*op֏:Kd>oAxRKcg	tju6ҎMQo9^o	c ZaL5oM+E VǎRgQj
jʬ:[M:vVʜW[Ǎ4@jV Lt$Z>DG
ݬZye+S7zkn!gR#k+5f 4@S֜nMzmXkHbm @VjգU֚BCJӉcwJ*GQ0N$676t&x,o9}ui``bS5Չl}|Iz~u9.=wOT7"zAL	4^[ߝ	A2rUx@87ӭC-z_i.yFEVSQM{}4;H# IĹ7mN0 H:3?6HQd,=Xu [3,@GxzGlקau<A/:P
ˁI(ZG>#O5G
Y)dabXλf*&ddTIҘTSK7#"LCw`LhHYE*|yb!38QK>Kh̑p|iwJ
/_ה`.	1V<xc	VJB,˝2>/Jto䞹~P>4.6~)j4mXiٰWZ^
k-J3^[O?UHT_/^֋\*Vfm"ޭث OuvUV\>Sj"Ӿ]k	ZnmvXA`G5f95fkł6WZZn7تݪ*jaMT[Ml`f+նl\Tڪ]o-h:z^kX]X5]]UUݢvp\]H VnCCDWW
< [[!j>AB4mXHW핵bj6֓AMѰ͆UkVJU[hUY5T\"04Oas,j
k**xEٚݨPN x5yhׁHQXϚMZmBZYO #|nXPJQ֧aj7mֲk^
` `u|6}CbyJBc IF]Mj~VVS	sk2-lpTX^Ym(nmb_^P |S⦀[
CSڀM$n5P:M
'?WjHݍFWnC!kvE4ۨguuE>a״"DoеUbծa)aW^okHc-X<AA`%o09~}?䆁q?df)(5E-7ϟ:lJ2(RtYS@Y}^FٹR{$sPz~j4A-#9n+On	N@`>4ck-U
4->()li/6O7F}m9pSOx0ur9K.2lyX>;`/mmV#!F{V2
yں?~)f)[]\D&__Z.,]CY!N/`ahWKȍc"vɜl(`&\^ʹ'tyewn%)R;fndX`=yv~S`zNaG}?V+yc69]1/	x%x!"}|4+ET%ärYh=m4s
U:JׯSJ	3S1QlQaT갴p%*لƣqzޙ8lI(_7y>HA{^|嚁XծIZF奿/I/X=ߍW/tp;N	-IOa޽c0"df:	%=e}~c>Gw߿JU}4]BãEO0ݐfg&`k`ls$񩛮3>`0|;3z^gϿM1M.^鏲40C_ o~oy:᭿tMH2I; 
%xt)]D>mԇg1`BFA.o嫙ajEyf,2}/;5vXR
IIH:gzz1erD_}ѹXi3LRA(dtMj˰WpN#QȾ6E
3D]/2'9&2' UNQSEJepѽb0#B1+m{|m&ۄs,률@1Q8BVV4 Y2JehUM'r<ddx9^iX~.K"<pL/Ujڛ#hTqA*:S	ʐ}=0bDBJQ @@#352rb#Ylj_Μwb2,cu{|I=?L8/g۱;AKChWWOtN=PWىW(%ӴjݏnpH^؛x'k"޽Lr0$ ꔤ5&fdf
b0 -fUi,9+Q̲SS[TɋB#|.{N3ŞNŨ*_JR~>sc2ē1^VZse	U"`헗S؏΋GI6 EL|=cdG-}KQO=)Tc5vQV$,]Y[zN寿_ʏd@O(vA$gL*W遃,Fk-~NI$2ZiƩ(/YdDs_+ֶcIfbnծTDI9W(; NO *3[V5]z~	Cepjl'=3)SF5l_c0tqj;z[K0\d-8'jT.'wn#3C?Y:$͛}.7;t^b-NBWEx CO&^/S4` jij`(8&';w fx8vT{.~p1}Rs#i[^(v~kj[|>uS	de*Dw!GnXN`Q#sٹQKt2)+$sRLM%\fh7Yvnֶ#|z3iYVOXxjJ
V9g7pf兣3 R7
Qdco J1f<v@ɥCd: ү*TR(8f֮wZ9޼?~ͬPy[ 7tK<=wQJքcPzfJE}$$)5J_[C6jC؅Nd]^bžYES4P `VZgof1CCCW].0#YFedhll&$7$B3Ua_
t IGvԪUEלĖQpc}X$PKK7R+,O'a+1?AT/NB%%L!qR	SƤ!kavVDY՞>eW@\*5	L
mcU	]\>
1-qϢrWY\;iĬMoȟp#>RtUO$:aZ{*PIqAxU7<H7eT G +g{g398mbl8XDIӛ	mV%c'gB?%}p/fځR_OrZkK8qOdQ1}?r[VԘaUQc?ˌ4,gئL]=gp8PSI#> a'F7PA0d73xYY&މk4*΁˵kpaSڨ\2nvih|gVvA7o;;(HǲBŇdms8d~2y;;nP"":v_OeRg&/"7qwnRҟK)3<߷H t%yU^zG^T^N* kK/nܡESAX	9TfZr-c&<֦(^.0S_@	gcn|'3j"<#尲6zdoz>x6_惰VVeaw$μ^wٹvAB^&KaOM5tȺh[XjRY~F-^TkV+ͤ3lsIt@CdLUX4sn :AH̩AE$HZc2>[=T2	_34!$!R!rI	*v]
QVGDM<͉G\2eNXMHVzY'^|:>BmyAF!N0~J?8*gyd.]go7;}	Q+1@EDq'u:tu:qdLުB]VzZIQ%t]2h0{bE -v//VK	!ڴ&GEi%Zġ3bJU?$G:Ƃq0*fyWVZY*G,!<E`؃c4*v`ԡ]ٰuT-ܹ}	@k&iPw)}WouZ,##DQu$Is٩:XVD:8VO\n%)(AYA[F/⛷JSfoeGqpBrsɊ?1+l&=|,ȁe\??M!XJ'bC	O~aD>9??B$n>Lh6NuJ];wp& Ns[cC}eJ5yR ƽ1B%}vJ`tKb㘌xr	k9[j!5<n5A^>A(V$#j4:O uL/A qҋG|7/6d|N'L9+Nb~7V_M9k(KdAIҠP4mRS0sU6:594,a8fA"7vXf 8ZF_֔>ceyG(?zIpޘ^m	rK~3~e7G(]:!.}.]@g˓pǗ"02%*/r Q|IK\\@pjsg:cm~C38-2iԨ80dJLUYj!Q'	0<w݋+' V8D8Kr*WZ>gʀ:eDQ!kn[!#WHK:4k ڰfWov{%XYE@J6 PgP_I=]{/mcہ-_mԱSw^v>'ckzrdjgh3bx~1rҍ܇u<n
nuS'4;]eѢghJN63̙;<"r4$Nw	\zJz0lzמօ.BG	tdzuTɜzOq*5rّ, KҠ)܏t4C{{ږCyzLg:o(D3SI8;8{.f:]JL.e-ut'rmVF7*g3pi0G^}$]ƣ3(+JHR徔U ICoMm$H*F3; ^GLalKa5ӂߛԍAh7*q9B6Iyeʤ&i֚"KoPa!_+"6xos@{߻zuwڽV6xko2wWD~닗,a6$y@,3܅8}'4S{G%wVA J+oӌGB.߂M2lm vzCy+	6VǚvZo5Et|;6LqyRy1昰34D_0	PKM¸>!iݥ'1L@[( ֩(zq0P.T$JcC |i$*A@%"f}4,+dұ3!
V  mhnsYN1 ,;X¨+l\>]N'Y~a|c식QY%xGUG9t]BMMk>{c'I}IO4CNR/!"Ak8p/hթH,4|$̘Kդ lZ@̽ "̾g0hMj!vTbC]F 4#V
a ^"3QQ"DIaRs=@I!b${%gM
1J=w#7uCg_ٹ SQ.	F/ ,Yr&E-{A%&a8W4@צN%z=%mgBko&	9c_Q4J]Qz7^b
k$pƨ+DOty6Ei&!>s+`PƚX45Ӂ?B{/gfJC1F#7Ybp`x^̶k#+ã,0@ 81{	ӱQ:2F{ԑdulƤKOJYGChHO%ϵ[z;<,HQ*%*v]Xip=mXos`ql,@iN^7Os2<t,/ehz&oe_>UIlu?&UF]y"JR$jxN,31h_4aa~?C$  