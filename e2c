#!/bin/bash

declare -r e2c_version="0.2.32"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8_JLT8zF԰LD+X"ه}س1ۇ>G$EUuUbw{^FceJV5j鶛l[.Q q|(HɎKH~'EIn]\`?	kZgmj\G[k05}E~~[wW..Q0p>xw}E<硁So4|u >V;oawmX)__{}\5vw~4v_~Ci4..ů=.z͚W_]C~Cs.)r?fXuƃzFH!sħnXyȎq'̋#F8,>"J<?uّ;
kC!	cv,^e>n	];cW_MQ&Cq_?E`P2v dv~N	I@q\q|˜`õ!Sd$	CiŀfnDE9Vߐ=pQ`No6_;ƣ[cv\lޏ3~^UOxR}7T޹igSK9[oT!Bwg3e+tژD;vFk4Q+c8092/!n˨ ""pzgP%/ݹ+8o#~xj`w>ݟ#':Tc-}B8<GF@5i,U7 &80۹Cݎ`0Y7di01|`t
lr?z1kVJehB9E8#W]UeՎݬֲݑ rpY!ϪFWovoo6@Ev.٥"9]*X-*EŴӂbr#/6MmdmME6٦"Bkwv$dRcF`K29֪0Z:f%%e]Ѷ]
L%}oeuKLκm{Vk=Ck|7 g@Gs䜹	%Y<LhW$t$/?@6fM
#[KW"q0ZKܘ]Нnmn=p=ͤM&`u5VIjy2f~a̰}{q{PVsmn?.M"eZ,bx[9背dt6KAڢ>V],'Q-/tG'<OG"Nܯ~<ٯ<?d$#ŦM.]]Uk~Bl4h,9sFļCb̀_y0/WX2>_W(-ʷw/k=<i/Oǫ+%Q5%j5#)n<}&iKSoў脡si6|0GDttǓ|w8%H#nەdvPDߪ2QCB	YhQa4 7ijÉ.ZB	kFE$6vnQ#fd|DM\pIN/6loomkW-X9)1@13Gڊ~!A0t?g9Xu?|7#iC9VVkBU!f]^yujաƞr^	VIXGo/^T@;&3"aDTگ1рw9MWyHO`5_ vw|lh:Aq2cs($hy.}z\<
KNʑdX_qUKV<5kW}AZ"3S)@^EE}8ݏ1H7`%-GϸJI+!!͘8jx!DV8mF(|c擄KN%_y-$&)&-Ea?*`݂eVN9Ͼ/lgg;
3WEͽW;?*d[Ei|sfhOE-7/TR9t@@Bp.ˢdìJԼR𱟮)P6eDKfZLYSL@:*H:p ʐZkXHys4ر :9.Z0NoP0t4=3z @U$oG,>;
\"u R| s7tOܡ]ͬGj_ZOe#wr3<:W$`ME>T/Q4W}"Ѣ%S%{c,gbl%ɗ-J
xTge褢0&;dwJ,'wBV9#` եdiO/oU5ɾ{ϐ_m~s[gӒA7mdt<4|xfU:RPG
R5w;T4r|JYD,E\@J%YV|1q>v7YF_L[\;uk]Us
O9w2FfB/6_b/o7_˖;ޱݿ>zQ_.,Yhhln`q!k:~4eN$N7lɑ4<u?	fb1-t˸M8.GLCIg+PzC֫/XM+ґ펔Bv<r5P<b-B}vm>H<ٙHO.1טI VHʙ-D'.ə6^ZAm	W?~ '*J}X2c|j*!&)@
]',^3-:tͪ*bR`z
X4L}O*%Et2P}'S*=y黃m7ŲZ{z-IDBz%sJsiwRz¨i+]⌨9<9]Q~p*żgxޫDJ>^^b'Y J+ȷ0Ɠخ$[pI4%M`QHzXX13sPkTjn4{CĥC! WqGΉ &̋nR@E!$ Q]r^8Kzrkb'FT)$ߔveS橏fNvNROϦ6gJNag{Hԩf `t*.1E@-<H'_ђq$&]W&w_Р(&y:D2:y%X8L;_WӠ1T."N48JaR9ḳN}e"ih2PBt9JuÚYHwv4YMW@YaFIaj3ڄ0ԅ!^dX(V7H"ޕXoX*8쭠j.[Ԃxn~#|$mWOCE'$tL
2MUQsiEL*{uMS:FUV{4_Q䉢3̆:%`"@]zqxT([Ɛz\+t,ȋ(6h.;&k>=#7kΙ[Y=W/Np>5zy]vzk`2]w2=,
ee"hCSFrU=Ha6BH,'GH9ob#V-nJW`N}qGāe]JoWҢOf7Hpp:v̪_Y@I3f
@)(E'Ef"e˱sçOγ+7@҈b|BqO*/DĨ1FLt(^7+eoٔMm]EȻ:x'91Gu3tP?Xy9t2pcOdlPCgؽ>c l.jfY=Ws4m&j,iy- lBXBcGƠl{7@Z~4hWN--r=NFʑ۞N8쓳n=_gqQ2L	=mnxzgg!QɍDoYd(P:nA*y"a)9Q
I[n-y =2V  N߁cF2,ax\ҕFU^+2Rmn3qr8RTS3^0ӱLι}ŧӣ),u#{1r!:SbW5x
$!Z,eNd cN} <̖$*:8Cd$v]|8ɲ3}YMS0]kŁeɃX^$]1.Ȇwѧ`I *!lɝQ1Qf(>ҥmNU?oY0\"3wh*qW?$(Bnܡ^:\MCfG5DMn
0l6rSnq3I\qdVQ}Ӊ1wGhRMɜbД\AHzn!싍 ]u^_Ɋ2C#s+|uʸ)I3Kx,@wK%[ި#,%٬75q[^'ۂzaN-YɌ8:Vy̬#^Ll! 4RײhmCq^ɍL4nH.I> !?LNn״WN
ڦ%5eբ0:x"\w"+f\Eip8h'Lr{_b\eLB#H<--!0x+`d3-yYюTxbqDLem(~D繒):5@(].K$dRFD!b&H֧ YIĺ[!VilO	ٟĿcv˟ FC׊|g[to.c1BHY|/[Hb?z'#3S0J?A|hphepu7t4i҃nʨh`9@yUu W"tZ]E:2c g4Ʒ3'^xroOL^U~qru0"͙xMrKK6(bV	VPa1H=a~C֍9=e
gŗ\Kyc]NxZA] 1=`#C*]vϳ8P0	&Lˤhd
eG`C75abaEr'Ԡ	9yge",.ݮ[y܋OiNrWJ-TL?<R3mqyɝgX8(v.h;eG\U-cBV ިI@KDourT'}g<ɽhO3~u<vK4=@(E:bΏXWUe[͐%YuK5g	_0zcN;g$%o
So)7HVƗy#W%F|r%V@ #U
?	2o D4UӀeQ4b5
y97hXA$RG4TcMC%)T+d#ޙڈ>J/#<d+$db'nc2YJV[l
#<DG9-th=Us$)6_o~v?OmSۭMmi6{R;M5CnbY?]?m?MӠ.NLU,VF1(F.v.s4	~Z
1*T<'"! ,]+~;W-cj^$Y7]yӑ7myӒ7Myc.~C|Jd
Y )_JoH!oH!ooEV"UdI)V: pzfrG1zrܭ&w䮝ܵ
OJk%嵒6ZE4$͢$$IÜd祻$k]3ˏg`'t82-K7[b,8D&CR%&-f&3K)D zk|ܷWhϗ+ъ( E9鑅:"I;Qkℯ(6{OS'4K>;_gɔnG hG3!I-tG!L*p#@C*	 YU2eX/
S!F3T7W=Z. +𔂗d_D4h܎KYO){6[^ŎK+25QB.D2l<rs$aioPgIuAzpG,=R
U.	M ke{(K2Ld0\]k,&aW~XP>o`$$O*LNwK޷{/nxXr{s#=EVPNIW޿!jk7ڹ'[TJ)Lw2	JO\KuSte#܄$t-rЖ@F
ʑ\xlMkN2ZFqOTiIO9 4jMCSO]fE=aP'Quw 
&$H^\,rz{ Jω"5CxG&aTN_	*- =._l lLM:]M=ݑ{Jfz1?	L^kJ#6ކ>F\77S^icW݌a!UFlH6//nD"ʶ=W	ϻ_vZQTg޷zGɗIxōOAW]pieTy׶ý~K37guc@&s-	
(OaᆑyzsPN$JkCNs<az>mTXК-\i0,|/"2˞!:sYɼN,n-aiu̦qG[u7y0. 9'r`Rv\=UtJtԚwE0||cB<ؘ_Ϋ240A05ơ4CY?sKoޒjXJ/pWdsO;D͢M֖3/hHfG\sE\ 20;uW<加V)Vlӛ#8*Z^2l/#Qs=~,\q/F;<k
Hf+5iЗdnh92i͚OQ4fUk¹[k~n,_:bhͣF[V[z,Bff7Yof*SdlmzA uIr˄tЖb1k9Cgv^g8sϩ<ffgz`gMܪI}з^ʫd昹f7lNS/q/-:5sgr@)͍<,AQW4	gn8Q/	"iwjLE|ޫEeyTXH0@Qf5FM@E`E%!U2`9etE~t,8d'Ke3Wik^LU) }}Zg"nie.Fȶ5*!	XpZ2ر1ϳZqWV㚻,y%_Ṋ	)אnz L##zsk~[:)%W6/%tLSfY[rXu$Ia֒Q8Gݬ*μZG5L{Qà@*5	[HoP=ǑxۓOMnG:5>՟7ra\{9&N0kws^=3D9ɨfucf~8L~ydG517jfevl.6 ,[bU<,,dX3g9R0BIvooO7v|7;/ wV螇^jnFz.8?:.{CHsȝ+.{~d B90aOw*8(4!>28ZI `1BqF0h镣@yW+(EHl0k`w
fV]54Нp	"Pp'z3d Қ;
0X8.L4ԉoNFE 
Lkwiv1g1PwΊ˚l#-|?[UyȁaXQݤ\b/=?RrU8yq.k c}< 2ǼtKăt0,ecoKgnHs)f`{79fN	,֮['oל^>ʉ'kG':blki+De=/sHm &-SyjЊƾ/&K	/Snja`zMղ
$P^0b =
MImp2rN ][ɵ#{#TmJpq,U%~2GDj\ .:6tQk |\wr$*7?\Zi_R[j~G2RK#kd5&Kd*>NMDzَ&:ik G2NͨLr&1A|-=VVʒǾfu&V=)2d
xdsNm⎸꾅RjUpraKwxbyLV\Z0ȉy- Ąi̬kYApWmnj}1l
B3"(QR$:[.o2ru.0ػ&+jSҔ4.ES5CL48wSɪM."+-Uefmp?U4ACE3//U~ٸIA_xvyIaBk^1)SQm8:睳gmH5tzDI+<44sKoUsZ˺pFk'?#L|[%.07?:*yal9QT.\%v_l\'-CqTV*<>
K!r<]i/d9lˋCf>"@F0WyC`c[!86!"8.D)KT}Jq^N/:klSo>_K̓mSgh._3q:bϸBJ(3㭰c]6EP=܉Eښ¸l:q ,/J
+gH}7DF
;"08Պ|a9;2u̻H"cU&PtIxB\=8$=}q.̜&sag)[2N.PDsǞ٭z0z5a@=愋=ڍ-	3:&hnt9WR4
"TJ!d^a:Psgk--j=ikIAdE e'M$ZJmT*)D:,fn%4*,ٓu,8a3ؔCH(B5wu"eeڑx$aOP41္N*.UJNedfJCJoULX.݄]f`HgrZAt&Q",$ac7:
 =~ ɏI%SMl%:6~)=GgކP4Vk.푆0ƯpCAHޱHj)~xAKԦR<Y +&1e|Ey(p_<wElӛJʸnI#Hb1D5ȗCP4҂W?ݣ	!DS,2ujdjIV)RrQܥk) ^-X/xM'h1+PJ=]*pDt	H}v9<κ]uueKbiӋMM_zٕ\^AIyȖYlв-5-zt
٬wY^SSn)C°Ex}DUrn95w,&A\<zÀoͫ^g-2nFaE\㳰koƐm5ᚏ;{XJO6oWY\y+2<pLf)8(yDĈTI0Bns+u
qhZ)-u>"*߸V(I$$WOɪMȗiCELAee}tS%e_< 8&72yo6j*N^y3^ݬcjEHϼS߆W 8-|m3`Vmk"QO.`n'fJř;cr1?pZqݜߙ-=FEL3	?Ä}ռΑrrͦzh*=|yF=#מbüukn07,*qR&bB/dnDdEC3#5	' }B&V4K(8\52r3e"mdͥ3:FPni*lSxƁ*2J)kmNL͆n;I U0V>?_v	pJ]%
VS<:<zK빶;'#Yu)-rP"ie0Q6rQ𴶰|EFP'Uvxr%	S0n%w,Җ^ufrw+pD7졦OfGtJ9ܣ8#h:)4xvwf{32IΘ8hs.@ZPtFYZSs5&E1Oγ+70A/R2~FSըH9<׿acJ3uZӖ{"+qX:yP?wrraxߘNQ[h[ūMJ&V޽	k9;vV	nP6߄zùe0wJ|O䠀\gAorh_1m;k'*.'˙ɃTtP%xګ<4f,<ӥ3ԸRƴ5CESeRdJ)@$jʀϽ38Cai7v@)#&Lښ-qj1'CwBCI7ŨqZPIk|O:dul`n|4nA,g ~1h8V&V}rq.<I8S/lzbu'!x(($saxrسgR2`I`1G,Tny/9A>mTM|fcr&g	Ǽ
{΍AwdnA5;BDMo
$!AiUك>Ȇn Q0lf>sE4w9I([-z}׸^o^kaRAL?WãjB{X5?VsU1}9aJqlT9Pl{^h nTuaSj6iht&cO'7\A#w5Vԗ-V]-:!:(>
r7ZZYYk2K-V8d촁?۝+ۥQ]{-ߨYˏqJ=;UYMnЎM(GIkdmN(.F70SsBr(-ޚEd7My4,I#rK]#2U`{L9a|J.f&hB{v@Zn׊+1+㱬5}Gn֟'ɽx>ƒ\>L0賄Yu|p2&wz4V)#ƺ%ڱ@($xhUG!+zsvrעG

>zz~ވM AyKlI*6t`B{vd{'um/(20 NRBciKBHnyMW,
vI*3W1+rr],9,_ɓA_]g %l9=BNU}(k2q0e!d*D҄\훾xҭHͯz^S!nvsoI)08J+-OyGŘ րU  L
[IPbgSH+x87IV 
M?E=Ӥ.9mwgjƺ6-u5@x%M7o`;=r!b'jQ=vЏd\>a,VB[4_0#D'9F"ж`cT)sAp_#>sMKt{Jb̵頤	7~D4"ޡ.gfio4=OM)EN QxjM^*żbnWB4mkb	Id5	3D-oY+ 7^47n-"KQ*R%=-k/"fA_x~\ˁ1
'.-%x.)%!~uUWqHÿ?Ea=)u7VI"ȰFQR,m4ag_Ί="V[0͋ښ܋@p6u3aꐞ)RG+c;x*ZW)1Q|$⒏tD^&RF~Z$RMV<Pj%x12`N3sC %R>R0UFo@5݄mѬ/8wLa߂v'nDb9SȮH@7q@IBˑ8
YǑk"Zִj#Q>jRXaj5$JE*d:FL`E˭	b=R,`K:rFaj1L:
;|ꐃ\uxo䗤'0dP|h1s lJzq :I*[M& l&܆|0S[#;VmQʹODB7b-TT5.)f2r.2*y4t%3Bɏ|QƶR4ʌoy|G\wT ,3ʝaBiۀCg
l=UzC)nj#"-7L<0Y|	Cb:r{<v?<'<|ujU5=MDG՗Ts}0>*5$y7j<$*oHୖkLϡ57>ʅtr:Ò"x0XeN'1c 18G=yFS?S:']f,b	k_6O=Fk('IW8WX`qٓxYtȴE/<xcI)E}\k>!G82*@tR)ѱ6vc{,u)\ ΐ,XZĮ-奬-K4i*d͞\XsDrpӑ; iS߇ncz:UR0Rc'!}q)쎘mw㍈t'?Oc)u&W<GxXI<b^ N0\><O`@O}c:&Pɻm}μz;BOtz'yrAKST8&޳w\8t{JF0F4(&$T~ڞ"񝓄t܌<e@_ԛ(hX4>ec7/IYLIX@~zZ;3'FbTbIMc jO(>Dy|٤"jJ~9IzY~j~,ϭmzٵW{xEܳW;<s~gX.d@\ 1z$Q<LDsn<C`_-q_S捝[>34宪6Q ^[˯4z ϸ-ΜVI +VZEB6"ïOBͦ|pA3sŬM/m"ޢI}H`R[gUjt瓭5 ,9	Yldtsf4f8af7À!9(̦dT@\L>!d2Fӣju`>_Ｉo '4(߂]r\wDQ=)=ղ'i$.(E[݄2,搊W(#[ǍM{ 2x.G	l^"`ҷ0.'r*7pC{Ś둡Ǟ(kBYI-_jBgEj/5XSKEk"7|(;
fl"r,%Nv@[~}% sGM }~zrQ{"o( cW FKwU6Thes]R˓fQ@%1~)'mu!35/[ZGZ~qۘPq.]Q/H:ʫ#灶6bdJ"~h>uĵ#KJlQ.b</S5^@>|#}	OmAa&tиH1(,E6(YZOjK/0`-iVwPy7bb|fh}pn>r5T9g"2V-!]͜;"A#j܈=l,`Aq"roi
SO\yYz36拪F""m;z	.Kw=~G9|9@! tZFf5D׾7f%?PnN*bԥNby+
-%.Zk\l̰̰33!-4;'+PC:lodC_\Dx> +Cg2ak- :{QD.Kv=OX<O-H}q:h^0duCQDRٛXl0d'栺li;=eM{ʲG&K	`I4LcrNENJ[]4d)/N\0/Gxf~:F'xM@z +(1WFH XSuc5ۨ'Ol-r=Q 1ٴL,k08/kgcv~qw?~q([1(YZur/Z1jxK_j4k.Um:W\vڝk4FXA_S\(ǡ;D qI9R_nkgmRN:nm7k+i[?ϫVqk\z}Rym;b!`N~NG9\:Eb?E}:T UaN.bV148;ByHbO/:`Q:SeJ~Í#-=|CFh|HbSt1<C^m2O܋8d~Wj5"vsrRZXMeXD"H)0SP(UV~ŌtRK_L6	]781,*<衬K*eT;SיX}m^Vqy25-Bõhe^m4$=KG!|:'LᜧPrg4
ݡ5ـ7CM`t7LʹŭIkC݀;/+܋ie1դ0i~VDr y7 Ky}Epc#c#*hH+MPf0"! ':t8H ^
 ?w"<Nwsdi +Sǌږd..0UTF=!g&9ȐoAlRwD4N{2(9T(t"Zw6/MN6NE1zġ晋mA}	M.;Ia0_tl0uF#zT&P}zl>	tgq_Y[@HV`g!?dwޑ$S7	UΝxpǓ	ثixIy92AI&Y?j{OjV+Jdڸ*Ir?Kwf4EAk)	b0WCw(|2 Fшr|lX:EfnTwlt3?d㿱$Onk8\_i(=\SM(n͛ͳy'*{Jsa?\u6ܟ@tH(T2li+>5ohm3r_Àf!:=s;)p=&bl983f'0lk]вy_q/F?PKov7~Y%8ϛqVc.nސ'b6O+0<`^yCv۝nf{-)|Tdg/!۽}yy|go493}{OP_ =NƎ7gޣ"dzv}ׇb[o_m,yf~ßxx^P7de>#H͟^~Ov|}}E0dRr{v}>-6Iz5|}ٰn~ڍlaܙyO}Ɨ?m'k˧k+ff3+7wri/&3؟goʟG2YD'2_W(_{`W2gԵr0Eݥ(W0"PaEa*O fv*n]\3~_d(w@Y @j*#pj:sB9fosw4@j]rE6E7E-do~,P,]˝:Zag$KI<Ϝ$^xcƩ>y} `.swhN 0A~9Pj@+;Bo6ŗܐ#Sa{blՏnHlyG<ʨѫ-FeNH
i!ݳ`%vx "D$Ų=⩢r`1ؗy8zx9pfνnwx~X5"ӜQS[$(mgׁUf6*gVr.k]3贳5'7غ~'VjT.ԎFD7Ԏ>$r?txYkmw]\e_vk^e\3dŊJCl!%Trq֚G4NF"}2SF|Q=hQ[$,j,mwŕֆ
[co2_V;
bϋqx>wLdl i$Lck]'oNúnߤaJxw
N_/-FK~y 7cJ=_YGoT*nם\O<{m@OUׯ>>dƎ7ϭ{}G{RoA3=GJ%Hp7OC%O3f㌬oVhz,W)+=^_
όʾ(y`0AlE/1#sGl,^GBagxCaֱ3F=6 8|GcGc~Di;i}G a=<>Nt`4z#C@|ʔ@eɉ?ƁpǑ{yˣ qʬn?il>9O`gf9>.L&pR%^ԣ?Gjo-[?/^}޶ނr
~XEL	Lih_nu`H
讱N&f޷JE;N=gƪHV	dXg-ޜ{쬧wif%*kv-*i}mV	锕lf
#-bd]6#{	rʐRo5y/4;("ُNin95k"EkP4	ѺB6!S, Ukq)LVLF;;o$y10\u1BeSYM4l|qzۣ0ǥN4HE{#ۃ)!SMCCwp)wg򵱰\odЙLrM%@8#7ӭc([;ֿ\jǑyF!'Piw|a%s A^VLT8ʚsѧ3
N8[9΍1FZY'A
<`_ Q
7iga>ųΙ L>d!B8t|BB),WLB?|:Lia~9zTZ!Cw5=W l?#8hteҘ5q;r0AQ4Rr.'u<AXCF4Yj*?q7_UvC%5UB(>XElῪ;rg>Wotovꞹ~0B4Jf~ec7m8tZXךfnSՌ<k57FcVC&?&* y>֕Z];S(Y/[[AE
\,RYZ_ >W	<m]%xM#¼ m茚] Zwl۫mnwkΠAU ڵڑO5A(Pf5V}kްv۲y +ZѶ]XZjcj7 ΖEUY)sՆA[X]|5xZ_OP55, ] hBt1AݶjVAM[@:6l4.oV̺
MHlMRCo(۰ۭZHV[׫Φ\ot@жA	# Κ-V^]:n۝Ϊڝ *vծ݆Z,@%݋k(	;I6Zw@YXOc[ko4`j!7YxoUnc_Lj_hYn<i܂Ac-l3|z]%7:hDv(O<:z^h"uۭA{{*ٰ]v?k	J] (ZDm
}@+~NG3[lPuGy8m*'(|iJBS)A8й_1[ rqС]UkTvEठb>1g{u@aORk_Դ\ըk(b-X('n|::JMDƋcoB]R%ͶɈTDH*iO\xAiIhOtյV+*FXV* `Iì05f0V1hEIj
O+Kr-d9CkBr7%)jp<:Jݙ`7ɩ~/)oWG>	fP}G]m=7o9e}qN+9y-r.k:<P~pZ@l		cgK
OIdgƊE;)7z9&$C^eKu4r	E^-\͛Ѥ[f?7?E[/sRVߥ!_4wco4D!Eb$wl9qyNB@RG~cqHɻ_UwNhɫjR7CȣKIGDo_~W*'LcSApI|O2>ʒnzlPŊG/<?_}m޿tU&JHM$D	(>Jߴ[ﲐc,,oSiGY%u5̪̔ۏ[eĻ)_j4ʊrR5gS~+
B5k'(Dbexy0m?O?a$*&7/iS".XS7~M+aVG+M=k$:ɉ>@ۂQn,p9MCjMQ./>&q$n+>b" yaƂ~]#o4VIa,kE!{V%;(j\F$D!<e7Yg՟R}qQD az~H77GTpGF|#Q`K`@\d9FbBָUD*6_jg_QK3NvofWj7h.S୸o}7:*KUkKxǀ7{/,whd$'zoO~#ZGwIbLlHKWDg	U!E2E 馄cIfN@FxœyMK+Z:JL	+R8CU K_}K iheOi?t3Xq+/U)oz>q鎽c+29:H>
5?TJX_@$X]!ڜ*E%\%bme%)kJ6>Vv4ENO) DWс,T5|4	3"j 5:+R|NAw=~9?ڒo$b$1
ǆdg_b铫A2I\*S-}J؝V$2ٓ\uy)/9dj_666Ǫ^JߙYNPfj^,{eS֨4*N #5ӓ;J|%v0:a\d`l(:f&+\R
F5>(U1ʾ	6U/S/CYCrjͮw[ c}2~"'}c;Ft ڋ^UrŪW. yJq`Ct?)]oFnHIF<o肝U~h:DlCpcʞSMEBr7r,
G3C@@	|D"LQ:o9@Dy|	)i#L@8Qۆcaֱ3pٹќ)JIs";IM2(%gB<}ḿ,)鋠mXM7w:mRvF΢øprf	:jDAHYX#dWretv‛Cmr}aefX(8f֮fkހe3޼YqVS$h̋3BЮv]`4m& ,0IG3=Go

7jZSԨ*h &#ogW(J%}$#V"7A~@hd}ۃQliP,0%\%,f%gCQD	$JzRQ
ժ&2B3^\Db;<'J$b0Kb/0.&:̜EN5b_1Ο٧d5#4#dW՚6s;"Ӡm;&k [0~I4J K?~0k3)w=Rì2J5yjQfG7A#^eTͮ'?Iɷ~>t?r=>[_1Vk eSV͇Lw:Ŏrl&:9_q(fO1+؀ֳ ,fMf&dyeWbxŧ#d$ݑՇí~q S8tΡhpO~_acV􆜎!OY2+V=IY}5lmQ	2b6F&[LN)U\㿀$iR24gLND˲Yi#?Q<Ǿ{X@d]ztF7juW:B0劔^"{[:Ȧ}ϓŵ"K Yhk}666Lph\"ͰgPMªNmM}
6MlY|(XdswX&oqgx0C't7^6j2;gxqM+9Pc,Ukod4*Ι,oߓ
xՓx,	vn+i@Di96v{Ē{)͊&x#&bT`U]ųd8,rC(R1dhI/	/t/cPG~̌IO/fxePA-~g%GB-d4!.\&$`-͚42Np/ʔM 1X䃇an zF/E&9GsWsAu UdcI2r򐟿Dn	C~_Ʋ^>dͧ`-XT`Eeϟ \H5#=\ZPiB:mΛ,F?ObVH?̱9zLȵFڐT-
%%Emr:7T6gVNVV8hmF=חk+lK5.X$h1B)Sur.9DMXŚ@\dՔT/AX9t	Ġ66{K(efmUZac KxC\gP[9ncTnLGb1o<>cU1QZZQҳm:):Q߁~~,3ys廎p:&a;8Ќ0,`o곃(9uG]C\8O 	TqJYid^h3P#Ftsl+ڃE$DpWuޯ0P~?(a 6oDRa!^l dGx$wcuMU&K~|օM$ު(+$D.8Z+N0j*AKeuY!l41_gDm:M6bϑ%^I-G44DaH4Sԋ,`fB'ڠ'(☄xC|pK) QsA0x փElN۠%N<Ô
V&j§ɔʧ`h"\//e!lc5ɴ3З`W
dwxm1kϸ_L\Ǭ)ϫQ]W%$ZdZ&@IsF['tf~Q'?;g%mFmZdG@`A,&"kZi?$g !CW?*ܬA4
zuBϣtr"Jٔ=úgt$2Fc>i74(,a!g4cܹSU"~N9BNmYS83ȽkH>(}W]|t?"[~L9v$+$3FOTфxD+:qݏdN\U OY	^fMwm3,%I0qhqRL"$Jife7(cR.i{Y2of"	K'Q46		MYcdf.H-jPzjH/o4
BG:1^]'\BxJm.kᦴDwZf1)rP+̏c?i.sWí5ڭowr_W9<YYLBXKe%<:t0i|86('C23gz_y	Smr
^$2K#w~eǿb7tkuծZz?z7p?p`Hmm&ߥ3*(%xWHAHe8 _z~h{%e|Rbߨu*V:ULgpHY8#V?Tad0db'~˿MM}^=8a1Xe k~sk
/^qP$gTAż:3AxޯмbC3z{q67*\\HlЂHM]1Ah)qMI_^D?uWtR2;OWZl155v_0|zwGzg}|˂vd@͔QB HƮEThes^GQ{VixRs)iߘIA#^k~Qx|Nw[ 'dȞ+O	4W;YrG&iN,)>&K2)
z蘾ph )]՛~2$ <4``+!{b,-ml {t/vFhm`!?&n%MO{3]x̸#%i_P7Ec/nhs 9=4 xM x2s`4ׄ^| ׸I+Tޫ~Y[GDH@&kLbpl+w7Dq;Rh@ns KDu449́Da񂰀`}wHJ1uFBJN1tzBPxe y0&$y(>ۗF_o.EϮroYZ&sѼ|7\R´cW.^q316GR΁
28r_}u_R P 