#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 b6] rH(8˯JLI@ޓREQU֭IgjDM	heY Ky:{v=f؇]u " 2nJL\n?|ޫ^u:~]7W\tڝNwZkNtюwrQ440gHj]\`?	; F?WSwrQ_}E?
g 6| ?<4ps/7~: v 7RzN|V/qއ%\cou]\|Gc'kN.ů=.z͚nk{.)J?fXuƃZFH!sħn{#1;qOG,r37qY|Ey~c#wWgׇB`	.T%?xKq{LGN2%k_X 8e2=wu_6f%c@fDgo3t6d>8uOFP?$Qx`vFTh#$
(Y\Mkxtuiv]k;QśaػiO*FKK4%gSK9z^CB ~OϘg*?Vn0!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAWDE.$Π8J
+_sWFp~㿹>zj4qwZWsDKK1fʖ?!OF3hb0h!;8!tػ7 hzb!nG0S,q4b~t>q~0
r?z1k,{KKCw@2	}/:td[tfUvRͦvGN{ukCFCEAv(F@";TdPY&ӤbTLiB1vёQܢƶA֢"[TdlQy!	5ۥ,`ܸ?	@#V'D"6!pjҫ,N·}-W:fe%eMѶ]L%z>Vj*	&2P5fOkCOG#|e.ouA43	./k+QߒBv
~DΙv, XJ$i?$/1 ٘5ZjS̵ȍ%;		[םv4V6M|kJ%<dx2d]'Ag~rۃLj/߼xpFK&BL{;7[?+͡{~I+dx7dTl$'2I٘`oko056eYmeZ(:krz=pr ~t	`-9z*pĽʧO̙ʍσ>_MG9Q}%૫JLBt[sQ{Y:9#o"o3 :H|7+,W+r,[˫4KT
WVuw/uk=<i/Oƕ]}kJ8C7>cN.D/9tEU}]we>S8;*;J߮$V>YUdw		,1A*vqZ/iڦ?qӲ)$K:쿯jS}$fv{ò'uOb#-ab)K92bfopw^lnlmYl\q Vlbc$ W`R4)Z =5n`'fDVrh1֬
zY
se_5$X|;W}/(G=Rnič]8~RY Z?rA5	#*XR<=i{	ѻ+>a k][&E,NP|e̸yWҌ0Q(M%hy,*&T8UGTP$ò0>+ZUGQe_r:VVLH yU[Ɋŉ>cc* 5%/)\>4.jA,J)FH3&0N^K6#\`*擄KN%˭@-:)&-Ea?*͏o
×Y_:<	{[ϾUȞ;"v*\sTPğ^8g͙"M?lw^7r退=Ʌ#/<r1Rs^LNMVh8h=X1g'vQ| 0oI!@dMhF1܂qt|X7Ҁ9On4Wj!?,=`1PYFƨZ@'p̈Jf6<Rbj|ʸ-VQ_-%oh</l1wz0DW*09}y&,,|٢yqT&F7Y:HgK9 wt*BU4Bɭie93Ӌ=M4ɦxO![տ<:~kGgx;C$C&f(\$(gy]*Y#9C_eQ.?){=/0RI5Ʈ_LhdM%DG&εQWbvX%W>C(}@'S`d@޼bm:7;v`el%=yjg{5OCJKfXifs+^Xt&o1<O,s"PK1dKYINEulqJ=E`OzTa\Y-XbknߴB.H+@
*\l;> ]3 F܎=+1o2ͯmHv%Svr(fDqu2E҂$&hאrfgj4S"8<WQ}ǯ_~_WE;;Kf?UL%$ӄ2E֔Y"ۡĒK;S@QT BLOM7crixR	{)]$5m^[	Od-{w?loE
P5`2,jL$',lj1WZ4Yv>nZʦ0ց|fqJ{W,"w#@0b` `/)eE8RE[މb޳wYLۢ%	/	~%ĕ_[YIl/%pI4%M`QHzXXW13s69Q[ۏ?"(V]l?y5r*[ЊmtQk\:8@۹0TLZeŇm$4iLys,(2O}NwFI
c	rٔ18_)LP䆰 qbt".B@MkH'IoIK6 ^ʐsD07I^c`@)P/B^	///~/S@r8p*ŴQ!CىE^?=72U:7_*ty҉bL$4-m \fJlPdl7Iut7nWHӚkfMsN]vE\O~T.`|ufWgH3U92xŖ$mƩ%a%oT3V
)j.[LSu?g;?Obj,@+<uMI;Iۮ؏NIf%d,08.Ve0XD%{ekx"0}e64(UCj>73Oؽ+trBlsLVb<y|$2VX@n$*j~0")Üqʾuc'ub6NZFshAs>5zy]Kzk`2]w2-zX,)}.Ò6nTfI|Jr>ddJ1v+WWfz{4\',S
x.WUɏFӹ=7XO|mq'yπj*VYD>ٻϮ޼#:%>)'*2Ւ~V7+e7komOdm]Eo}l@r"KjJTab'V*=%ъC_^laMö؀cohs5G,iܼmp\͒"	(DNۼ%01vd:OȶGpG#v촤EPgd.iZƥ#?é7h?nl*ܹ4Qn|yuO!< 2HFٹ7l0,ƣ&|Otb$C/"|_@%9(Y%~A.nEz\;44ޡ+t~{TQv+|+"nɝ>A+L&X"
TV$82SLRLJ3Tٷi6a2K03gEK2tAB+f[ɖrȉVN>rhlE}Xnҗ,4X2d2,FV+D)IRm4nSvraڙd7gahhE/4es&f&D@k6zbWΨUUu&+@pEA]zN	Bq0dUVKb'Ѭդ,;Z:uSԹ?ӿбVXع_3+y~ftA{w*NM}e	YKqF2b9(},eX?2ܡ74UrNrZm P:q8iy \C7IAfiނr˸ßMʌ&VLFGbVtt*'Aɡ(.'|a7`E"#I1y_Kzd"tДUTi=2^e(wr7qȯ@qf-I=אjP`QeVk~EP/(,75n=Ȓ SRi8Պ	 h60µxeʟ<-NEn6yDO;_"j~Z/FԓEBvFv>8rc/Gci$}oN]r:K>rm)siVƙX9ʑH2L~y"<*&z6XZ_N'\#|T:5fk[8RIsLgcy9DD),!mԘSnKPnU	b[B0aJ	$WT9{юI=΍r9byAZmtIֆAyDkɅK|
H?w	-$IKLI#TP$Jb$B$
4\'J	*:,l팶?@ t\DY*~,<`7+wr: ؽ/=te jgj]D0MIs6pk	o9$Q{8s^)UZ"EEy13~zڙRx<v%[ʷ'ML^U~ݟۖ!&4g5XLiE804h0!FY3ښa#q}&uLRxNx&B6'A=!ĠҥI(*8G~F߼BP,Lp{t[z 9oJxXl%El?0\e`ץ0/V8`R#%$oAraL檖ä QX1	eRBÂ1Hz{IMȎT$Ң.<yUڄV8u"Ņ+⒏X,;G "n,4iͧ7洓q,1)MhZR 1ޗ92'V!tCx)-΀0_Ibyâ"<cOO n$*;QqRnyE#Dl)ZP@hsSa`,`[J	A8F*(a?\$Lp&"rk !3bot;9G(Yen'@x̦A :>
L	$?*rQ"M'3LIvM|`g&SvLS^n^gcy)B"JAv\R
Prgÿِh8zY!rMTyϩw0f,H~ S:Z)\F(rEZØTW+uޥGu?M?\fb$z0:XڈYvKjPW-Ha<,%g Z2PZMc^^
ʛi˛iʛ1!>Zd%YAV/~M%u	|]_%u	|]_u["+u*d|@+c9]##H[H֓䮛ܵVr,,?IR B3)LL
hH4ԓ$usu
w.?O'NqdZ"ī,1n0YpW-'o2$eYky6ziJZb)%t8ʚ#-9f[l&)VNN(ъ(1Z9鑅"I[Qk(T[be2\&Rٯ,ĔIy3kjL/䅁RC#W:cU˲
АJe/L,S@2,铩*DӫY-$KKy+q%OoQ4'cJ-ba	VtDmzgp^EHWB" qL90È,7_h$T }uG,=ⲴUr/U@+wUdF;,p(a4X0L`a>HHz0;%߭g/z%be͍W
;dK%[Bk3;%]eīM.3"jlR)Ex09X$£%+]^-%X[ѕvPӵA[UZ@.G
~rBn6i:ܛkNkM=IP$!"{^4Ұ7!M=uyid^AJ#}Wa,oBe͵"'0(R3!xHCބ<˂"=P͑ēJ{I'qu';rO3Ti#c' kAiǨF{
+-\ypછ1,$ʐAݍHD'J;o\+Zߝ7V=rW4	/"]y1)v?P̃j02ڶaܕOciYQ5ESL^itVwE~7[#_׏rPZK$D~䎷3+5^T_XК-0,|/"Fm!v<s1t2⦛{-Pe2Zǘ-Hir	\U"N &dD8n\^TiCpn&:Vwiu_ :j;ܢ &A?:XPϣ6Wt$4LsƔWg&hyc&ڸr/=Gi5$4I7'e*μKe3#.Xff:9Lnp-̌h44eQy2É)?H&^dź9<HqDe|^ZFS@??m.4V(r5`1EYy|5MՌZerjڴ"03pU@sJ2N0hv)j{J+uKLe@Zw,eZ^sJffbm4)ۺ{gI*ЍQk0Bo̪Lxg@Sto%*XYBYlEh#Im~-	(fZU3Iz<R3K.J0^p=-Ґ{ິ&GHs蛯tbQMjxst^ƛ89S	^ԉMq'ՔoWY1n\1ފIS3'Q0BCy0NTmj&_lvuts</A]4#gn8⇵7ՆҵAl*cK*}
-DK _
&;1j*(7(ZU(	
\Pϰ̡,+rsg/'!˭Hioj}#$X:Ԩ\k>S$߉?DCݬTS$bׯiTlD)ǎ>bhf-rܶxղca$^2\2 }Y_^Мxm'̤9r:1ؑK="n7uH8}ߘ<祢$37DciY2BnX,ژ, ʋ|&I
ĭUg̫^"Ԙd$1bpfQ~u}
W5g2! j4$
ÑM{B""WãlWiO/϶߹*ʅ\;{9&N0?{fΉqt-3^řfݽ_}ܨdE/͹; lu wV},̳2?C`v"Ԝu'SV%ǋ[/
҃%۽W?35v_W5 =؅u_q6w>uaB>w:ѻ7`nݲ<+E䀘`>	| 
.Bnxwp4h>$D/BXN<ũ;s UǰPNRq|'3\eR"dB!MqqY
y__sarR3piء;	l%DO0t0r;
08.ۮLhՉoNF&VA:pcb0ς= C~ѝx]m9b;E<lCZ&uT;<+-Oa&k݋ob܀"WQ#塔՛-8ӅBw9n#=E ͽ=j[eU3Vn:aͰXo4X]sș[<'a&9=o(m
(y'|}f)z*Is˔1+̰(G/Q'?Lz*y-2~&SSgjY@_g(/1ފ%V!Uk!oIu0rm\;2kyx>cM].|JhOP]FdEu9FF;|zE9 [4r	ktʑxՏ]ereLCYnJwQoUDLOA;V1Q5鏌OT0.PTsט,85N v<lB%㎐)gcgƇqeu.{kT׬4YgU MƓZV\P3uccRlncҙ(Z0ii}ժq7Ŧ"4ǻzk$m Ąi̬kYaW-nT;lB3"(QR$:[.o2csu.0x&#jSҔ48;Z>ES5i4]BwCɪO.<"mUemB#UE5AC'//U~ٸIA_x:-fͶrT碌_FmF e.dH;<2[՜n̜њ (8#ߖlh7y>J^nNhű*A/iv6YG.sǓ잡>3Oo84jm6{!3Skfddp	?<5,cU4!Bģ^x"Z>8/;ѨO5I<k2#;yqMP<w~3ƌp&<g\	!%!1.I"(ndRL1m  ra\Edpb6rzIaPaD1qق/s QשcޥE୚MHU#?*ĵO3щңi2v)Ҕ=&jT=B4חɚz) jk918٫g'4WrвeܫafaT͍.<N:JFAPT$=Ops5lKj.xlEeD'-{-3ɉ"AK"qRWKu
\ ]֎H%ΞЭFE?s8sapr	\PN`\L;_B	C`;:0W13jsƇ"Yq>hp==L?.v7a1,D9ybxEII؍p,@f.@cRg>ecJOi:&;G5Ɯ*;iI,8Rj"bYT4 13}.R3 m/	SJ_(ՂĔ=<2PKҶ8E48[s$z˫䓪Qū j^Em$L_
CKTY*RmN
\_z	=\.IDRc)<x"mfk.]brlIyXbR3*%:X4YBW
5]i{Q)̡nZJ!&m \|KǫwLgi7&wp[<n:f=^82_NEAcZ㳰kLR~29?$.kl]!םN'Y~X^À<[SL'*MoM_5_8"9%Q%AiPi󳘖UwK\V+1~40ռÉmr s.[J~FVl[k䕧?J%o_n<Yf+i!=T`A\qZ9t9fE^gEz)Z)74O\Ð1`BcrcV#?pڭqSϤ=FEL3̔>ÄeΑrrͦzh*=|yF=#מbüukn07,*qR&byR
7be![t{" w-XB	65iQUNHe+F;"iI",&8rAR3|sE .<QJ clw ԏU->vqnZX^֍k[Lm2QwoX ŐUAN(co##wC3bFphفN̐jWY39ʕ&*[/NшH[NЙw)iT'2G
6")5'`rlxkH%g-ehzęg28FӱB߰o @{ǫ]L:+j;3$ҎF 6ZN&}Nf'ia3L
J_olZ'3ih8!*$ʯOdad"V9n$a<2Yc+1}d>bx
X]]>y]]0aY7Tji~Vk+zJU[C"q'o*0e	*ξV^+Q~Xk?YI2ϛ"'ΦX+@Ʉd3sZpNƎUAfAnp7!C*^npYc!iox%<NVo':l_x9DmRA'ܫ*.۝&k	b:g?48ky|my	淈xF7SlFQ6u{mH&v07dXTf1|d!?Xg.zQYT6
K: *tʩ
]HP(ЅiѠ-q&&%E	6|^3=Ҿm^6-KFNԩK5eυD._"תWy~Pk>S)'eєKI,gj֪KӖ׷4XNf,qՉU<}<xhx"8Mv}uo:~ZO[9=@u1uó|'NX
e'NT;nVoy/9j>m P>3|xO9<c^ԉ{΍AwdnafFƾ)0+Ƀ7pQA.vA+fz"^n^kaVAL?WãjB{i5Vs1Fs=â Rs خPUݨʍ'Tk9V>1bZ0L'7\E#w5 &~îVLN=uO}T1?r^^]]k0K-ZEuP2ҊΛ>@Kլ)8fbOYCqY*>i<sCŖaRF^<KO!ѹ!T9v}l~"`2¦<kw}T*-#joDMd0}&Z`>8g\)3<|]ǲbGh%&,Z<vi8bO~ȋD1~N~by5E&x+oOy湎<_F7JpeXD;IV9pe1_O_4Hq(_=@x(Pa뽟zySX,%Ё+YLGbn080ljI	͞-]!uxpMAW&.2@T=3<cVJeNE8+㽲8R@6D5GKB9,rtTeaӷoP׏VkUeN<Gb|iM+HaXI
 \!D+.0A_K܌KsdEpZ4c9MfqW殦-k3RWEϫ^Ϻ	Wٟ#z6p+M}իY|MߊVH &kFb䔈)g3Hbg.6OB=0|A1?bhIca^# S2Ġ#f%O#BE5]tyFN8sMH0	x*nOa/r=*aIuClJP`XO1!ܜ<ar_͵\x-Ӡ`TWi4̮RTIGsˁˁc*Cm?r`D{ƄKKGK~`Ȧ>2*nX9i#t`)t?ݡ=4ƃ*I]H"jUR*]&adYLjKyT[sEHzІns!QC3_helO%B*95
`V\1yd<^шnckEJIӊJ"}da6{XsN3©ߌ3*v47ThpQ+#S/<l\M~:Z ~'-h7`}rmFt*3:JxC$I8 q@!z?u-ՀnM6rq__b~I jUj(VCT=OGTÁ0@()Z&ϳZ-M:rFaj1҉xYhfW}rAQ_.
>b0TC	i +ű."[n5 粙pLm3wk[4I)܅NDB7b-TTݞ5.)f2r.2*y4u%3Bɏ|QƶR4ʌoy|pw ,3aiYtXYTWzzhG*s^j>>eO	Q,B~1}`}1<?<':	Պ_s	K*
#>:Vw˽|]sZTG`$V5cPQAYa:9	aImU<T2nhtZg#_.|kĽՏD0j.3wddăegB1mo4O-F8n!5 KȴE<xcI)E=\kn.BvhIqd"U"/#褠S ҁmZR0@5Y^8Z+-奬-K4i*d͞\XsDrpӑ; iS߇nc{:_RtS'1q)쎘mw֙㍈tp?Oßc)u&W<GxXIc^ N0\><O`@O}c?wy)`f1;"YV;PT^x[Q.MR9pLxqL1q+a[à󊛐SigXwNb=yN퍃:}IRoM8tQ:J[mЧ$e3q(qsbi5"$n^G#YOq1|ɤ1w'gcGl?sAD_Z  6>IQ+^WWϘ<jϭU(U~Ҟ7U~N>Ϝo5Qf<?$
_#2=b΍O5} sV']2olj)wU2`]~/xyTKXҚ0%d/ڵ_^~e}xbj6%.ƻ.f5\h E5xic\Ѽ~M
C"Z<f>f>la9HҰ_e&3fuL0Qq	0M*׽g7P{{Pۖ$ӑ$5xĉSz eO591I;\<Q7;	eX0!ɯ01QG=5[ d\4E To!:a\Oη/DTo
g5#Cg%b5P4z\|cCiiTg/\%dbKE)^mk~h];֗<eEn(/ LWm"r,%Nv@[~}%_s@N }~zrQ{őao( cW˗ FKwU6Thys]R˓FQҨ%ŵ1~)'muA35/^ZGZ~ܘPq.]Q/H_;꫽*#V恶6bdJ"~h>u#KJlQ.b<-iIk.'}pMFc<.>LqbPXl${Q+Z.*`<(nU{!-r+};j
?
sa5E8e,r[DC9wEnGr#va0ȉ$t+'1v+L=qpfgج/ʛ/9XuH$wn0%p;1'/^ 
`UE/,52!:)\e7,=rsR.u[1,HqR%1/Q]y;<ယ3^ܷ̄hKtgC;d:ngﯮrkvZ4&nOnЉgk^=K"~^;Ch'3ڀOd2Bu,ۇ[AtB@{/xO-H}q:h^0duCQDRԹ92`y
ȒΚ.P5),rmy%x2y8:UZ=hC;)m䗝Zd(?+Y=(>宭1.C
(,|'%LW\xV٘zYFK ʂXSuc5ۨ'Ol-r=Q 1ٴL,k08/b f㊡~PbPhj?_鋖Zdۯ^u:~]7W\tVz\k>(kkn 8th $;>.)G#\JKͭ1gZ{{wq2v:N߸ws 	/kbn?:ZV5JG>|:F#wBd:<!Ҁa ,uHP*]#:>eXxJ`:DxLJ#mˋ?P%_cpfxpNK/dZ1mԇ.g/}jб#5;uA{5jM>ܹjJV4GBLڮot1">
yE;-}0ݥ_nx1#%$_jIIQ-~z|kOGPVUJ8pF}-֩L,s4/qy25-Bh4gߥ(Q>O֓ZDHpS(3К l@2Fh0:s~ rҹŭIkC݀[/>3;˥/rN!}zo{[|fId)'
@Jsw.g/	"rL`daȃ
 q<"̺H٧m3D}'GT f#SN_ټ:fnK8wk]\kĤ6d,$?M::DO	Z`@K*IAL	`ဗ&&k6FE1ZWU={49yv&`:I$GEiag70~Gt>ʝ2u?6 	Nm &ԷLy7>?.)wޑ$SUΝxpǓ	ثixIy9_esMl֛..*-SYZ17QOǜBE)I>.ta00%[,vAqVG-´'
HQ4U(߮8rhA/G d$O4p3Ypw-wAn8{ϝ\_iC\SnۛP37;9>[iW?Ma7֮`<88%r>RF8qes<=ůi=}LqPps;I#uL)ܿ(f%F_g-(5[V~U:k}#вyAK0[;[{?nZ]{]SɕF>?N	w	ZN1U 0Tex<pvuFbFm\'ҒL%$xǞy|worcp=̧E/w'c3QDo3l%_zs}( yvooOϒ/wp`U{bOzAdOД|J4{ &m?zzz/`Ȥwv녡=&-6I2zE՛즒gowFNio~cӲmmZ6~zj/"P@U\3X?/h_[	07EvlvboN?AHZ&Aɒy)At #OA0qwe"u*SlV|Y޼LQw)LT~Q~ړ5߂j6wml 7;fXXQHi-M~FMgs`P(gv	'WN(M)$/F~cZg@nKuwҏLGaMGG$dۭ<Ϝ=$^syƹ>o~||,fQ0<ZD/
܏s.&_.DjIwrlKOc{~TgG;yqP9#M+Hח&q0CHZ-KD% wC	K/=%]]3?q&rɬz^b%7j4g{J͙JOK:L?j)~w'ל߸DVRAWd?d pl]]70TMv]sЅTRC
+lomnCȋǿ`
eV_VUe/GɥJBVh%6ղA;>DNJזZs8Lݐ2e^+OZ"a)W}N?t4ڝ;.PyuZK޹>+C/~Ǚ{ny"2ocC0u96 J:&k6}Ɗ!?px6Je>ZJ(zN?]ݻ۬|7Gw;_wr=탟0KO)Wq%x:ç4ؑcWy{ZOܧi'5FɈW9s*$Q׫{7tQ1#o6ȊḽF%_ЍGR3mp,O#hd|Bgc//폡̏m;/dc:

;
7d3pɧA$ѝ|?Gv.zѿQni4{q8>eJn)pǑ{yˣ qPˬ}}|8uG,z}|\L/hB3Eg'>Gnm-[?ꭠ2GeI	#0$VU07[;P$]vFf+DϏkw`Blm`6}]_+*`{8ךE]au	dXgn7f;iVkmVDIeNI%*:nsF]ivu7:l}]5puL9eHl7:jFVSNMڱHQ MZkhԏZh8d8dR͏K908v5qesH)csoCYp։30	ʊ=mhF&~.8U^/ee;M
Bs\z.>lhoCBa{0%dJih=ݚR;!Af>$פ!3r3:lc+ͥ`xgT,{"j // @zV2w
eH@8}A9$xꍳSHcY|/)8K8:
BŭzSzF ^<;	#@Ұ:.!C..r$#w#X~d'ޚG0d1~]Jz~၍gd2vLQ5&1;"4tG&4FJԄƗ7KOP.;cEcOWq@IApuM&cG >VP|4"Jܙ9r;B+á!CeVۆ9-{notƺѱ8)ϚlX3]O25ċAjׅΚu{>$`lwkk:~p ]i]),J݌-icB	}nt}a]@ vTnۣFnw,hk{3hn۝k3@Vufڈ@akovl\ԭƺ4-@VeoVn׬ݭ[:iQUV05d.ԭm$ݴ㐽ouO]m5B! H6,$HРjvj6S- gy6-XXtBRvz7mح
'&Q)
ٰ 6,$lu½xH fAC;k-K`Y_nwFno:P0u;v
k|tchP._>i4lT5w:0* .m[M4/ߐi,z3Q`&1Pz[^[Ǿ5C	eM.Mml4SނK$noЈ&M'=m4[栎݅J6NhUo|® Evޠk źXkR®B߶7:xJ"afs

~AvmpvP<6X|r>}B똧)ɠJeC)AOa+1 ɾms@ *27Hc1e:gn	N^򯳋藂bz yc|·IR?	~QӚ_plB)ZW7UčOG\'\VT̋coB-]RSvȶVDpiOj\C!_Z[hцsQnkgcm{;|EDKKY!'U@( (	O!a@?rzR=GΨRfn$\'ް#+_1{0u&979*ȧ4<9!W<]3/	p%x#"}|8/EUa"X2B^^2#.$.gBٲҗD$	cŨlc_Qh_Y/ùIou/Go_~¿KCiHt+}NHG	i;N	5ZO1wfIĜ̬ܸZW'!hy)0 d|M}*]:ut	I=}vCY-ÛsIoclA3|%O4O|@32eP8ِ9j'yW6cWl¯EՔIBU(cH"Vs]r?J
q(_ÜJjU)cFQ62-7~~rS{K.)'%U#pxI!crau#jD}ѹX)x	S&)ĠID\Qeڤu:pb%kd<b.8
3]/29!2' MFNQSU6*Utѿb0#R1ňl^`ʻj{Cɯ	қYKA,ymE!hW+;fJpQDn#ONͫ,C
Ovy<_dˉ	la+Undq&bܑwF41$nq	񼯡BZJ	"
$RHIZ46t&\ʿvڗ3gJfV1`
RG&艘ѩw}d]:؎0;{/a;h:KRDdKHK@^d'ޠLӶ)7t?Iebol^`$z¡EI@)IkLX+ `@0fUAh yfU_|ƩэL@yy]8yW@Ǳ벧4#Z:ɰTKE;O\ldiL?Ԙx2z
\l**CiُI6 eL|=aOdG|+QO=)Tc4vQU$*/qȬိۤ7߯O2gNirpR m`BWJ3&}HrA,Fk-JI$2ZeΩ(/YdDs_+666Ǌ^JMPƦոR2	'@bGLt
:=lYitA}'^1O虙pLIQ!a^CcOCS8Fet4c?kRm b!o^3<rޑ7^b+tX00<%9@VO>|X=$'͉rt]z|?Y4n,bb !f_]aOORB}07r
G3g@	|D"!Fu"Br/cCR"GcjG$##cgs'"L\_KD!G`i$7@	UQ6:nEݼ#x:Ѵ bǬn=fV['mŜ39A,XЛdH$2fxYóW|g<v{:A͕"
]GaIQmFYo7uX͋W̊Uٞw

6HrjdcP{fJe}$-TJ/ZC6jCd}fXfhfO@
gL b?1UeK/D%#\]`D/22ըj*$7+^*S.k yσp(BC PBl{) Jʧٜp1+ˆVz× nVoZWSEVZՆ򳑮HO D]9QҀY~A (t1Ip#J%2)
jcؚ?<kS3xp|տaWNTT5AL5	O^=1'OqWX\;Yߐ?)OFJ{;湟Htô$VRۡ\"+*u*ݛQ bvR8>[m1Vk`e4M膭9AX	k#N:7TJI|Yi/iwWp.dQ1}?r"Z̰СoeF`n	ٟc=, y献rj*iׇB؉뇑,Ǎ.T8\ѱzfof#KQBjN<m\!\"iԩ76|eEh\jn;Ϡ.Uj{yPAm
6ha^3Lv쇹;,s<v{ %"R?k^&XA<Qpf)r=vUel%ϕ<g8H tT(NЫ=Ćy^xG^^NjP^ܸC:oC"^b%0TgotofYq	P֢x]hL}1 y&{6,-gEpN'ae6zdz_L>x6_pVeawf$΢^wٹ/˛vAB>_&KaOM7tȺPp0:smP
7'5Wh]L\C\0î0 ,ę9+e̹̏.&#3ZGvl"j29e'|$3C*脯4F[l[HB/:ay]z6AîK!襨 B]6qCx5.&LbKVl^pNP) Qߨ6}$GL烸v_|c'O~EvJ|Y f:CFfvm䭺)ZG]OWk5Be$!,'fQYҢ=ngBXl"Mkr9XVrZhE:4Ar2G]Tn]][/dNL`9GS"F[ jn/@bQ^SyO7tf&hLB5ԠSJT;|WfV[(GfO<u$	v~йL٩:XVF:8V'c=Whs-Q$K'WФы.-ayIo!E'Z;'˿JY@b޳j\%ǒXFc$=B9_|<b?c"q
EN϶Tw$AWx?Ǟb=7)80";TfT' h:@C/y;a{S̇ҩ;8%+Eކ\FkbAVYHMA[MP#|tCP˷,C//wSWs&<8aŸO 67qpb IlRTýt/wcuUdRq)N*
MCp(uQ?S]<WeS
z^.;}T
4O4E$3\ 5}B^%Juy포^4ܰ7ӫ0 (/g8~	78sN#^&it%Ay+ܥs9<<	~|)^^]K!s^ҟ/'B6/It+KorD?i_a~ˬHd/,2έUR$5R3J?̕fיBbQ*%jb⦥{ZE_?0v;lzMҤ~ Hu%xzeLxe۱t|YɆs1+G8:F_ ݽ0/^[vwsFEJ.ug"(zv.?u5kN~UMprﻺfŀjdK|*[ o6x0A5M!6is	g{}6eD4RPE!ж#:@FPsea$zuP"X{̜,D:T$S{SlZw
Kr&ĹJͷzZ"^U%ݏȟ_<G)*!fj}Xћh}2b_h@]@QksVi>i$<L8̄u/C|+5*ZoÊO	iD=*lxqt Ia5$cn^FC譎oQ$TI2?
cٴf[>)׼T3f7`fYx(UAT}+p-^Igӷ"BkvޟLm_&h(ip*
L\զ6Qu{cYi2`BJH0wI&nA93ŕa|a`g7ߍV>\BK	<{Yo/7#)~ÒOq"XLѤci9א0n.m,-<|iίWNZ3i㿍Ѿn'ߥ3h
/`!m'/.O<Mʔc4_n }qXw(xص7jXa,O,Pp$G 1@4 -'Lh L V? v9ptjZNCxo{W6W=-,(x):1,%s`˥_;I?%1,κ;tl}zujY\"{ 6PkERg$cu]nYy4Y'@_W3Z\pYoBM>s)R -Z 3vPH|y{ڭL.>BdI%.gR蝪uu0:9
eW+.뭦*|L%qBtS:RSNc.Wbe \LLԼ-mBc{-JIe<H2P:$*R9Sŝ"y޲g.'_>ߠվz1ShL1FWK; =.OK6->٦|HhpFѨf̠2Z;b۰r+A6jhy.?Eկzt/b6K.]XY"{
 ] &Ƨ_mڀ
Hlyf,i3NhyE-!h8`v!Vb!{@}6^:D]"E[\{E3VF
@p܃O(q~MCa8e."hIBj$u\=̢u@ 7
6-qQ!w^E\8
ova G61Iۦ3Hga,OJ=dtz]B:u}8E/?Aiwר`7U׼Ċ;3-ω jc ݿ6)) qT) l 