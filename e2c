#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 Q] vH(_G_EZmwRT\ݾ$޵-oDB$@*K{30gΜa\`f֚/L H$U*${z0vlOX;|7k?g4@9ݡz qI=$8Q440Hjݏ]$a0kkm` 8fy?wh<70$kӽH4`|F	`oD<硁kk{N_h |tol4ZZ ?Hi;Ν >V8tc :k.؉~ڭ񿓤_EӬfƿlݯwcvL0Wbv1d 3d57B7
FgD,_ >uåىǞ¼8baĎ`S/<+\\^>T[`<vyo/ś\ۣ`:|>rBؕ/^æҟuQnƂ[!d =  k N]~tƓ&4	gAU0}Csa/
{5Vk4xn_|q0b?h_kuFq?"cg:w8xx>L{W9I1Ϩ~i靛xĘ\P΃l+ĐD{;5ꏲ-\c";57([k{wtef|IaTs{{8	3ʗ\ ot7@k֛Zn҃ȉNc-B蟌#gԇz`>BMSvp0ezM1>5>WV;w,K\,:!߸4W.
c>܏^Ko;sBߋN#V+YaݨTݑ rpPk.6m&mz>3HXePڡ*;U٤jTMiR5M&9:/j[A"ZTelQ-5/d:FSQ'a}$*D-H0NozZY ZYǬ䬩'ڶUvU[JR D0SfimhĚO8.ݸ.H&a&|,u<
aPW]A9sw/ +_$×A7&F򻖯ZA$$s9rcvNBwVu~C=Us]4;zR	$?jG<D ٳoyu?}A[_|z-	1f?ll޿2D6NxI'$|i3:ސYS1)Y~H,nc|$Re3{ȋ6gD-׃V+5oI+	O"&ћ±*>yf~d+7>|7ߑ"-._]Uf}48{ҩ yCy|?-7I⃼_\a{U1"粵JT
iTT귛-_{=8W?wWJ귇vŗ+U,xL9Q4"N:Tkv!kyz1}Y.rJbړ ]Ef}/KBrLM@rjm'>-j5DwIAUzqoXز@Il$"K9:rfo\qw^lnlmYl\q VlbcD R*Z =ok^F'5VO<ȬcbY#:98Pھ>II˭WW[/wXP*{	RaučC8~ƧRY Z?rA5V	3*XR<g8=>y{	ѻ+a ][&E,NP~},yW҂R(N%h!y,*iVT:U6HTWP0>+ZUGQe_r:VVLH yS[ɖŉ>cc* 6%/)H\@4jA,xK){GH3f0^K6#`*爐KNbes RY|V
&ǂ*^gU7ͬ/s}_؅ݭgϪdzQA{;vgUg:*[{vUɎ3
n埊z/TR9tB@BpkkpyS%e/~&R&|t+TAl3AȻ(p׷nZ3Hyw4b6<osLG#<3>s!iTCy~Zzt©cß"*%ЍQ %N;wCNڕlx**ժq[֩;,'wVã>>ZJ
6x8&l9D\"ԫoA㚾`ռKvus}KnQ]VⲸv*J[/Y:Hr|}I6UNK[rf;{ifk^=Cyup%wH7L>2?QNGA/iIM1fQ!wT5F/Xs*,"^#*wS){^a ,k]+	R;՛,/k୏L!'jX%W?C*}@'S`d@|bm7;֋%]岕lwy?<|XW
kX<M)-a-xaә<U瘆<̉B9lƐ-g'	F:6	ǥ*si>)Rufl`Jh`td# )誐Crhg6vπ<;PɼɈ6J!JԼO.1ʡXI aCUʙ-Ѥ.L׊^^E{s~~_툾b|,Y1R{V1Ր,AXSVd"lK/?LE
RZPF<2$Z7_CA>fuK%EtԴzA|o~p3'<l/G#7);B4ip00IRigIƻi-Zi+]5h9<9Tj}y'ynWm6r%LknSWOaf'/Cl/|!4TU!ab_$b́J'ڹ#D?V̋n\2?ȩlC+΅MqCL 2;S2)ohӨZT1̱`*<<
K'9'ȉkSs|1@?ĉ)0ׇoBn\|W}ouF>1MzKZ6n%U'd0*CR]I\L(&yCMfB˗Ǘ×)vSQouQ\`a8ZCb(D"Sj&.QFJGkf^;QWM>T+l@&-90-*iZ⯀Tk͌4=en1٩NOnJZi~?]/^43Y=?d͸$;Ӧ|c\SdY˅megri[,me8i~'pIu:̽Dտ`W씅f'Uت,&KCDV}l5{Vd,Fj(]GfSI.o;BL W+8/#هn O"ہk QНDE/Q5V$5e3.נ},1Vp^J{:蹊~qn:B0(qbH\|L&AKu%ee&JPR# l*\YI.llj#V)nJLO}qFāxJWңOU@oxtq_[@I3fU)(Eyf"e+sħO+_^]]U>)'*2͒~V;+Qd7ko9mOdm"7>D R%u{%kvXw^RU󎓛Pvd|ǞRhE//0XOƎm7_4򹺣Yn4`n7yxnIafg"c
_;2'd#VVftuZ"G(>3JOlZ4Ke_4ޟww[o^zgt\Dy(
ϼ?`f|@#Tgv}@QƧچf:STˡ>' <,? P=Ѓ:W=n(JrjJӠB&,HYH^*+t)~&dv4V%<FDUؕT~ŭHDg~+@'m^ly]P
Ȣ, [Xr,XYrQF
Yvz
+]YH莃ؕw"$oe);u0Qj^1cL2ι}h
+cdhD+DwgԦ*:A&+@pEA]zN	Bq0dU6b+Ѭդ;Z:uS4?ӿ0VX8_3+y~ftA{{*.M}e	YKqF2b9(},eX?2ܡ76<UrOJZt m P:q:tjy \C<7IAfiނr˸ßM.&VLFGbVtt)'Aɣ(.'|a7`EvHwHRLhC4sm;UZ`rSKnR&~ygޒ\{٢uq[i%ZrKgͲ~%cSl	0ݞ2jũVL 	@ß] eģ/UƌipJw-m,S#zܵ٨Uz14(b<r 50Ҽ{?U$6eM#|pBU]KhäLsM~X00ĂQDlfUaT13Br:%]m֭ mHy'3]8賄%scIyhΓ00ЪZZ_`0o)5/y~
Jq@~Lqn+ZO5dwK%2%&.5@($#$ZIVIiL#TP3$ʐb,B$
4\7J*:,l펶?@ \VDE*>,`7+wr: ؽ/te ύj7rkɋa
mB-l!rH6q<!=R,FU&ފ42c g䷵3'0xJoO򇦙<5?-eC24Ti.[2On:(^	6qaiH=aCލy_gt4N3HLR	꘤7v#,mNzCҧIKQT31pޑ)QՍ%y/:áBY%M-P@rޔxYl%En?0\uХ	o`|*oi0I@qs|HiNz' hG4z&UppUˊaRIx,
ir2)aE|IUʟ$}Mg(c<ٽj<g*emB+:ql,]F% EBQXSsZĴs8CĘ4-+RFOpy!	+π0Ib^aU9Pa''a r74U(RnyE#l)7P@hsSa`,a[J	A8G**(a?$Lp&"h 13bOt;9G(dn'@x̦A :>
L	$?*rS"-'+JYIqM}`gZ&SvLS^i^gcvy-B"jAv\RPzWÿՐh8IR9?צl}a<;XSg	@3@yBj`P-IҊ`SYQk:jBGaP*
-:F#:&hz01=XEP|k"M%"]DveKDϒd-CKFJhe,v@/V}/-䗦Ґ_oײوlC6![$OSu	|]_%u	|]_%u3u|ݖFd	قl _|"%=jmNo|#H[|[O%ߺɷv|k֟d) Lk&}h&4*h$YEYI9:/K
ɷ|F>՟83ƙiY2|%^eyKOh'ўqr$CR%ؾVFo&d%R҈Ai8qc6^abU6E?Y.t
&q2flO-]Fcz.=aR.1[@X:L,5@]c^?a&bMm酼0Wj{JgJrYVRIl2)Ӓ>*1(J^1sXK2Lm\/[U[z2vpTm=)-(D}zgp"˔H&Jan$>0"[5	n8H_˽,-CSKb|54GeQÉho&2a2,3gך~Z`OMi4^.Szދ["^!\܈psO(يZCa)*7$^mor}-vɖR E"<ZB奮RlH9~]=1PĀr' f˚=沖tܓ5Z@2a,H#{xS"0A)sd*,@2MH"=YAƟEj4CiқQ9}YZR'j`9w_xAiodN1.󏮷NGi-Z}d$0y5(9|Up՞HsO!z+n\u3Wr6#94<(ǢD)qA̵ݩ|n}c8/'qE'ҕ;3<=/o4~dTю,~k#ϊ].eJ/?pe~DZ"͔d+ &wYbTj:łmąa|{95:hØ1㙋Qeyݧw<j'!к$v? lId%EMK$UW:ً9'r`rzRݛGݥ͕5X5p4C?||cB<X^Ϋ24֓0qSRL0Lqr=Gi5_$4I7'e*μKu3(#.Xff>9Mnp-&̂2h44eUy2É)?Hfdź9<HqDe|^ZFS@?m.4MV*(r5d1EYy|5MՌZrjڴ"03pU@,sJ2N0蹲w){J+uKLu@Zw,0dZ^sJ/ffbm4)ۺ{gI*ЍQ{0BojLxg@Sto%*XO@pn7v,g[P&Hʹ.gl,f;y6.f7Y7l\
Y=anc~Z쥡uiO̯7O.Ţ9ՔD7a+qr$)Z9Oj)/(G)cݱMcǽ^fNCaڇ^?7za\Ʃۀ5sL}tsh</A]"gy/kok0TǖUBZȇ( LvFgԼ4=QoP(Q2Rٹ faKmYFW0P`ςs_.C;CՑ
ެ&#oGȊtQ|_|&B}wRrN`_	QqUr;vB׊quqW6Gx0s 4cfa|	k{JsB-b2u bG.l\9H<H]#Mr}cr󜗊hٞa,بjsV+/d),Z2wRTW=
V{Pc{̋XE]ׅν
v+Dh
6^՜ɄriGLD/G7ac#\V^)??:~k窨js8Qt\7[z$J@tqP1f,/{agwVw|IqKqVa4J /ʊe+Y2<:;PsёLZ/^oo( J.ov^md.{cW?}/_ B<b}yk&zCǏ45oyFϲw.bzu'0S(˻3,ypl2Pak8#h	ּBq:JŉF7p/#!pI9D.	6]#g#+}}͵RIC!o`$``KQk>4$c@ȑ( [``l2U';Q`꼎K<4GwcX'^_wnFZ&k391{S]Sb_?93l=t/qL7\	_KGTrVoFdWC<hN
U6縁H4lu_oW\X9úav5bw8b~y"g x2B<1K4)]oCZXm &-S<2âlR(D06V۩L]u}Eb z+]TQ[H|疺'A0dcȩ1Vs6ew}s8*a8czJbzJuK~1Օ~
i值7lu')GWv˕1qg)GUm0WQoUx[DE,1ɝ2S:ik!d\2NJ&1va|mPVWF}:HuViMYd顅nUeS7Vz=^-U6Q&vݷPܭ
_.l9}Xl*"op˫'GObz6
@Lƚ?0LU%4#jxb'mA}F3JDg%&ÝLq16I@B
C_n?>%]IPtU31*̓9%p7t]Oh/VU[!q1:]UQX#Y4Tx}"R嗍aqQ1)Ӭ<ll+G|-mYۖoR_^Et#,̙!Ui(
Y.3#malψvc䁱v\\kz*1.~gnu2w</nS]y{=(,@=N.kgGm21ELs6 %3Na`_ I"§ɠ,R%*yqqLF>u$^|ܷX6E@9PK9<3$#\Wۿfԫ{Ğq%Pfxb $}{	H1t4Tȅyqu"&A]^VĉWg~O}{]*('TvD`8N5XN.Ҧg$P5^Ix)B\;(:cqh`̜&pM	7Q[JdOL;X͏oBZ]+^>=V,^6w:g&hntqҁ)iOB*BR0k?Mް-AuŞ$7ZU"2.BIE-m*hsDqZ;j":{B_%4*,,8ĝCH(B5u"uebOPt1׵N	UW.5>$ɬFC,e|]L0}݄]8f`irzu&Q#$ac7:
=ɏI%ǎVL%:6~*qGP4sTwnIӒXpDĲ<i@cg8]]f kŷb_6ՂQE1(<9?"PeQxM5e|'mq^i&q,VWӧ#=+U j&QAi"K/%,sGCb'pHf~uqMO.G$"^
s1˔]JV<65I.yM1goqy9[L,lKVe+N,Zk,[g+5ts#u:kT)s[MSS;m!oS0Lg:CLMݼ1yy[04k0.0eݔ,ӃBĴgthdr~H\ػB;N	LӀ<[iS,'*Mo-_-_8";eQ%AiPiXUwK\W+1~50|Émr K.[J~F}Wl[kdWYd7Btd_Lt̕ռY*S߆S 8-m3`Vw̍"3D"}amSfaI!Q̱^r>J{\_OOiָg҅xӞ"VfJaASHHY9fbZvVxsօkMaݺ-z7Xqݸ~)m1zͼ~)V1ѳy}jQT_=D o-XC65iQUNHe+F;"iI",&x8rAR02pE .<QJ cw ԏU-vqnڎX^֍k[Nm2YNwoX ՐUAN(co##wC3bFpفN̐jWY39&*[/NшH{NЙw)mT72W
.6")5'`rlxkH%w-ehzęŗ϶e:pcW?aj'@(7sO\uV~wP%I'%K#^l,L&n&%UfDݙ(½Nf>;pB] H_[˟1DRUKI(@ydVb2}vu+buuuCjYژJTK[$7sl\ܻxVq8}Sن)[PqXjxX;Jr>x9`:v6Z&4$ׂs2vB2djMw+km_RRv+aN}C~(QLTG?q2z+>ufsk)j-t町]N"^5Uq)fP4NoO9`8#Y[hkD0E3LLmDy"qßbZИl`e&E3tfR\T]2o
j*@, C	ޗrcgp*z+t#5@M _.,eh[E64)/JImiY|7rN\){.$Jpl8ݸUQߍσڪxMyg8)|Y*mLb9ӚĴ\yw5dшfNrw/8KS]0bmzCOy:"L) %/HgtdvVW)[Eqjz;#xUsDׯ 9@T3?{}ß%N7cpn#s73:/'7M?y\)7M9}22Tpp5/Zؔ7[?f 킘vV巶
gz4[,N+h|	P70Z,瀠O5tv|䅪FM6nHXU_ӂe:*JQǬX6Yvbjgp{꣊DՔDZYj=*␑Vw\W_JfMW532{JTaUIs䙻E\-6⹸}Xrf.el=^oʕ룴{y6]룲Py]mwT3$j%Q%39J`]Kx&`<<B+Qfo-,u|,M{C^!sz;&54):7a+|_y3|6O:|YP:;_Ǖ6cX jj'#[|_:<#š| @g{;~MaTl.bC&lgYNw2Fxz(sb'e4{t|2f17g\ Shx]RhE+pcgX9-"-hH	 6<!/Umm2q0e*KDӌ\=>x2H~Z*kO9T/ %?csnZyD
k*HR] &
$J]tIZXf<|^r$+`&؟EТiL635Q^,jPc^͎z=8.0xE׳_A]hMve|^ukl~}VJ_ӥ0#DO9QG;#p`1zT G/CS]Ltw !=9'6smOD(+Åd*ji<Ex3rF M>wOS"y)Lo./8KbnWJ4wb	Id	D-wo咯k+t7"Ly?c5?!dvGTJF>:DDSh%b.w.3d=]ZK>]RkC6}5UWqHÿ?FA';]7KR7A=gd'h	s8pV0Ri^<\noQҼ^5)h
mPLZ۹SоJih}⨔+X$|N^32b6CyEZ;/(5X{N3¥ߌ3*v47UhpY+3S/<m\M~:Z >'-h7`rmFt*3:JTxC$I8 q@%8u-ՀnMvrq__b~I j]j(VCT#OGTÅ0@()Z&/Z-M:rFaZ1^xYhfW}rAQߒ.
>b0B	i ϕ;ű."[n5 ײpJm3wktI9܅nDB7b-TUݞbFKgz9\fqeZ˺ВFUtrs[i|eRC8R׻Rљ	F0Ca4.`_D:,+PA4[ysչ^W[j>>eO	^Q,B~1}`1<?<':	ՊZ^s	K
#>:Vw˽|]sZ4G`&^=cPQ;AUa:9	aImU0XeI^ > 1LG]F׈{?k`:'CfV,bT	fiПZ>- u+\8Bjv-@";n?%x*nn񋱉#$xpA	9%ő|TrdN.Hٶ#^^jiK
 qdyuJjUo4y/QТz^sGOsM26NG }O}fQ馦3IM۟ƍܳ;b	G[)[g7"-<~%әO;r_sH
q9y x4ؼ|ȸKIO7ٙp:ډNb}`5vώ8uijʁc{ga])˶Ho}N+nBN嫝)b9V97P&ɽ5ЁN(	nLS5vCo@ġ i@]GՈ	za=RM&/`f^9;eQ#"ZNv9tվpEoy;nZ%'Uʯ6;#
ڌG 1CkDkU̹qA:Ϊ=2ZdR捃-[3t定6Q ^4z 8?jI +VZ&曬EB"ӯoLͦ|pA^ڽ3txŬMhml"I}`Q[g5Ӭ瓭5 ,	Uldvsf2t.C3)aQAfs2* .&_2_XLs0jvj2 ud5SN(?eZ$O]SйzPr
3eFd{<xPe@ϕ(!0Q@c[]\B,\||{yBTYN npXs=2|V)Ve~XH7I=>KuvXUNְUB?Q]usj}j#QV䆚b
t%
a*&"'R$TXqWzW5}i_q7d8+,{@{_0\+Ȩy&womGӬϛe|Z4"F.	,OG8e-ϴX |xiiIrc^CɎ0wEd#}xǫvZۈyPM3H	'yl,ծw*iGI@d% ꟠g79#yj883]GAa)Y^4EjzҺ\zuWng󰢼jϻVS<3C#w)rP(,%LXԱmYe"ȍ$ہ("'Xiޯ<|\ؑ0ɕGN0c^*o$r	i r87-ABߨ0/7(dMZ ~wpwӬ$/IS삺I,oė#mKļDu"c j{93rߢmAӓ!}2<9&Fhvh =y@'~[`X*1^D3>dE}w&{p6g>2bjxE(4?~!cxo@N_Ak|7!kկcDtG&ٝ9~V@DuTu/-`砇HYd	l˳)Ɠi	ЭҚAIy֞&ĸr'SE_\`_auF)wmqNVBf!>(f^R»ܳ֏4
E`X2UĲ\ħ33hF=ybkkDԈ( ɡldb]'mxyX~5i7WKB[U+E\'7>ڵF^_t}vYoHtVz\k>(4-7rC4\P#|N2Rwsm9V{^ޏ]$u/_Fa=Ni5pnRn`l. vp?aך?AP҃lm`ܡ!]Sv<&;셤3`ԋK{XՑ; CU0wy(aE	N1#)//Biv|5^íbZ!;-?<<	h HeSt3@Jp\m_ǧnxE\:p6W,-"vsJR4j%O=lfi]pmc&Q
$|ˊR)`w([`KLbFNmԲZKꝎGYSKOe4v>Z38̥{h\Լ+~ggCo͜h[H0{|D|<o[j!rC9OhCk{BoB,O˙ƧK&m>^^o\^,NC//c[Tom%Q( )u>LR}$8(1	X%#*+Ms0"gN͐ËZNWzw41cot[R,^_"hCw`	d[O t7lm.&h eQsh/R$3rGd.^3:̮:UqPolj%NU5hTV͒6{H@olҥڙLo~$}cY>Pu>DOOy4T =۩M`8L_У$K^	3/G
^ǅGAm5IAG-6Gs't8dcDG+tΗjܬF,o6=$δ6Yew*KK2&*S<%B͗Pr3,+]PݿM01}4tGǨ nu~0O+ ,`F`+&E{o',8c׻ r[mνNRצ&TL&!p/F?$VZyj؍+O<a]:D}D2GW`9/v)V\;4}G<&8(i&_Dj/23z|`XN{?"/s2|#cв)bV^cz3~ѬSrVR,穄%<F|t\g,Zpj-Vot=dJ=aNF~7dg/!۽=g8{TKdYf^@/z20p;;ވ7iwg Zͼ|Of+y֋C{{;<<}/_+p/
 ~kU<iW_M=ћ{GC&Wݽ[/)]O5iiI{('f72{[Ͼ5v:L{;v{-LkӺ=}/S[|vKO@)i|A3JH.{ߝ:i9L!Ok%[l'cLɃBx<ݕ3MK0L׳EaaKzr3EåhW0"PaEakO~i&+lrZ YowfX/XQHi-M~FMWs`nP(gv	W.(M)$F~cZg@KmOҗLG_MG7$̜d;̜#d^xpy4Ƶ>o~||,XfQ0<ZlD/2
܏s-&_nDjI6wrlKO<c{TgG;e
qP9#+Hfq0#HZ-KD_K*I3d_zIJ3?q&rz^wqF?jncDO pNJߧ%}NG?_v!o$[l%ʐLd6mk3:NٮkpTjz{(]aEMm3y,kYHe_Qj^}]$dÊVBoZ-CN|m5ٰ=,i=_|/S-siw`4IJ_zC-1k/z^$|V7^3,#DdpGo"`[9y3 /rmtMׂmV&Cn!L2mFKx=a͝tb6(Nם'_={}ӛt	~ *_yO\g&֓;r*o[*4PƟ(*g{BW$Jzso.Jxț3"`8nQW4tAQb;})c*a߃P؋Ë$fc#{CGYLGBag2{M6 8|GGe~Di;i}G &{p|JMhmnS&[a+zx1)`,wP?<
8jj/h7S;9Mo/IL}ިǅbV+$8ӃZtvx6|eՏz+|>oAxRk+coLz}T1	F'{Qofq:
 cxX[XxF׊*X;N=gF׭UX]6YdY;zZZ[z縕o4QhwYiRMkjhNFۜQE&GZE`ݍ[_tfo6ܴ|g#!SOjF5@3Ǳ.SSv!RT5@֚4u6-B"YNV祜N;S̚829w$wRߔI,c`fybMքWe՞6X4vF#s?]MAs\z.>lho#BVa{$djeh=ݚZ+;!_Af>$ץ!3r3:lc-`xWT{" // @zVv*eH@}A=$xꍳSLsY5|/8K8:
BŭzSzF ^<;#@Ҵ:.!C..r$#w#~'ޚG0d1ȾCJ3F~ቍgd2vLQ5%1;#4tGftfJԄƷ7KOP.;csOWq@Ap}Mc@|i4_Eȝb3s
V[g2Tmo0{[sV?m[Zkuqc7	ps5vg`.3:ujLAjׅΚu{>$`gkk:~Gһ:K;.rY>3z">ǌt	Fn8>>6 ݮGYZgh[;5Zgv8ƚj#Z ͆fջ{c~n5fi@-{e:vf57n}jաWMm!K_ݺFM0; ]_gkk+AekD0&hA% ҵ溽6B(:6lm$hzjze5թSW+ ge6-_f݅.POa@RG(۰[T^O~t@G](gT۰A	G@ktֲ6uuvjltFkЮC?Xc&?:])zل ڵ:׀mY6]*o;XXm~h^!XvgZM{c`u5c{fBϚvP,t0є@]"q{݆N4iluX<1Fj8]hdtf[&~_84.zXkMJuWX6O0v7؉Hٜf¾ꆁq?dV\%(?NZ,>9
>}d 岡TCYOa]+ɹms@ *4Ic5e:gWn	N^򷳫藂j yc|}5?<SV13T7~>~rpZR1aL.a
rCvtKM=!ZW!q=q<Tni]o1ϑjh[V\Z.҃hti	6#2+qD
ev} X^ҹ%)B<>\]WV'yU<x>te^>$=cK%oRR}_\R~]+0cԟ!mC[KS𮼤,]3</.	p%=GIA+Ee9"L2#.d.gBٲҗD$	cŠlc_Qh_YV.ùIou/Go_¿KCyH|+NGi;N	5ZO1wVIĜ̪ܸZG'!hy0 d|M}*:ut	Y=}CZX-/xc@gJi)7yfLueB;'s?ˠ(Kq荳{/rw_$3^U<Ts& PAq#eoZwY=8()*(rs92+iQTfVcMG(bы{M)5Ty%)Սai>c2h9'̙#W'qEf%ժ>pb(,tuҿBi8|g9Đ9b0؍"Xz .phQjEvIi`?#]PGyV߫7|+Ip.eVbv?ShfۨTN1NyȨ?4޽2Tarb9U6wXJUY]C{rIwd$*S2gLA\0<k#R	TR	z#W-yC';}2u{A0#NuD;d]:܎0;{/a;h:KRDd8JHKڽ2NC)}Sn~t*dbo&E0{UNrPFТ& ꔤ5&f 	c0!3ê KJs:*/T	M&<&mݢ~.^ q){Nv1,UySΫg٫=F(85&̡hFª5WvjJjZG䄿|AҖ}@l3{eO9P+_G&e$$thq<U#]TU(yJ;K2k8`+6+LK.HЕ>IC\P0<*Z˟~&Va`Vs)Kܗꊍgϊ^K:MPƦոR2	'@GLt
:rG[YزҢN:,t3`cC3*ᮙ|B=1C7>0pti?x&x~H
u;>uAռ?C޼gxډ#ohb+؄00<%9L@VO^|X=d'͉rt]z|?Y4i,bb !n_]aOORB}07r
G3g@	ԉNE\C؍&;S!D0 =s_$ǆD8%~EHFFeND<Fӹ2BHO5d)>klT%meIMyqGu4iAYzZzN
N9g7r关3 R'
Id0YW|f2v8A˕"	AGaMPm}NYo7uؙ;s<UJðjk)	; #	8_HH,3z_bzn燰1?a{&+ͺ,* *ْjA-[<~Y uFF#P^d	cP<dQ*'MHnH
'|vUUʞP
xnOA:S<V哌9-W a0Q7By/ܬT3H5no*<G}g#IMy@"Y.i(a
1,g KT8Sޘ41^w5)Q<bo8߰+ܠ_UdLvEWZSw'ѹ+,nu¬moȟp#?RtuO$:aYg*PEqxU7|ʨc1
^;kݏI)gU?mˆyO502J&VC[ k,/~|K^uMdY$+p,n2O̾\9C=fUG7230y6 ۄO4D?<EsFWI54C%aFNSLV=|2:%(l@5{'~6.4*΁u5zeEh\6n;Ϡ.Uj{]PAm
6hi^3Lq,Sxs<vG %"қ#kQ&XA<Qpf0i;xCJ2JF\3Z$C%büGcj/	/jt/SkKn<EAIm*J3+;.v¹@Uj^Ӆ64g¹WXrF&s:S+#W4z}z1!D~5X[s|ؕљ77:{N,o:
{<:Hȯ4}:й"CktBm~@*6+_Q3vFs"5*siE: Ȧb#gE+6<d)XjT&"DJՐes*NjIgFS=T2	_34!iF$^juvZ}]BK 5F3lh\LnՖ&$3H+#f(`ɍ/>SVmyAd'QmHZ3'qxiNhs먕1@ED u:,ɯAk~u=!}ƠVR	]sC6L;12n;C@ł`땄IumړB/Й0+lw+Y<RLYGZG}${Tu:g(̡8z0qL&_1Qs{:-0>_{;/AC`Yјe XzWݷ6;J@9/{h\G` O:eeIcy;6s6EKPqem2hMAfG]qBrsɊ?1l$35|,ɉe\??C!Jcq S_дx,S?&7_P464TN,ȓ@wس%@lBr
j McᅴKp_1`oßT:uGß[ \dtP\M0JvN	ZdtO=0a
JG"e%T.w
R{"^',wF25Nn>4^l M*+sW \n>rPWj" ɒQAih.ajתlNAeuB9o0_A8橂&d0aY~ߛ+ْ7§/X4\TFh%OG<	29%K`t2OK.][>.eI8KrL82%*/r@-a4L.Lsjw:^@6eqn$SH"d8H%V07gʄ6E*eUKĶM3'==4C￰aV3'<!/.w3H{%ؼ6IC@UJ,5eL2M9>wVD~am̊QG'έNvDw.F1^wzzܹւݧ$?F1?4c<[х{m;Iedn 'w;:1F?>|'[4Y%Qs;f&\H(GׁQ3Gv+f&{oGNNB+d ꘅ?ME,ٰwBbĲ8I=K}*1璗Gd/ǎŊrkofbnI>&(?qCI34s}p/Il? )ډO	c_FBSW30}*{҈V{b/UŃm"DpkCnΟF!ΑMYdTI0u	sٴf[A>׼R3f7`IfYx(WS}*p-Iogӷ"BkvTM_&ht
֘ ;-6N0|ۨOnY8N*zIm*.t^$`|.ܐs1gW%ga|a`g7ߍV>w%Gȥ=֬ח@Ob~sGS:ac/%ϟLD}
Yƣe;sK!cz\~e[{;O\$6fNJZ}n'ߥ? k..&~.S^t<GK_B+5?KSeJ9pRKKyz/yv2O%+ ޴ i .N?|.XIG qiu'![ۻ׶a Bi'dI@aK4Y<Qg)#[.Ir,i׌Adt駓dck@D?|jY꬝dss"3/&!dK34\qF+ .prP
Vk[c)#:ORuC@GȽ,U0NB
`Sհ}; RBY5G
avմQז$NHnJ%Rjnic% #u[,\7MBv~^)́VJdY^@R*'3vsU$[EWo>3f*?:(1
``)p Ujbɦ!T(}p,]FkGlVn#W2yUѥ3ȹcE:\Yݦ|e !X|}\k@ Л?YT^8韍6Oӌ%mbCmv65g.8d|ªV5dϔϔK۠^Gh@kUrKPpB
H:{0	1{%nyur)z(̔^ޥ4r@x;]XH7CkఇYh$FY%.v8"$\+G. &&it1I)qwCu_VH=ן-2I2gp~^7{?<yqXqg9Q>@};S8Sob'o l 