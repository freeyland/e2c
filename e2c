#!/bin/bash

declare -r e2c_version="0.2.30"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 @] rH(د_b5T8zF԰LD+X"ه}س1ۇ>̗G$EUuUbw{yF2]]FŚngtMhڭ?gi;!rC7
ArD;ecGs0|pFZY[ﴚ'F{ywqQ_(,~wqQOA~yh`!ߠ}??_N[fthQ@J64חhǡ{>p]wqPwKk^jWZ\_cvL0cv1d 3du7C7
FgD,_ >uWىǞ¼8baĎ`S/4\\>>K`<vzLoWUV(e3veo_؀ 8e2}%6̸9JO)!h97vv3t6d~s23D3H8;؍(rG"
)YZMkxtu\V4=vxۏËaٻiOF;7Mlc*|)AU{*1$^=x}lNטw(r͕Fv<xa{{_>Gu#2|qU^NB;we? Q:aįubOnӺwq}vRal0W	d9CWM4d\V=hߴ78GЛlqv;i7dߐEt4d~;*1#ŬY9*;
v愾td_vVU;vZ˦vGN{ug^<]]ۡmۢMۨ1g^ ٥"TdvbEӢbZTLɵ;tx65M	6٦"TdlTN UۭBƇ0+>J}I$bi/|XV;HdhV0UuuGv*.1ٿ}1/U8Ld39͞ևYݟFMC]ތ낄if\^YW͑s&xd2wA^<:9擼@0 ٘5A(Do-]j/9rcvNBweue4V4m8[nׄJX-'y30d8	av^֛7?桬ҿ~Ý]??D`,Xn:r`lȵE}XN\x/Z_躏Nx1&P^E_Ƀy#_y~+H>G6M;\껺.hH'597mf;X s挼!y|Ř/55a_d|^Q`m+[^o{M{x^XkWWJڷv%j5#)n<}&iKSoў脡si6|0GDttǓ<yi;$7J2;OVoU(z{¡lr,0AO N\5MĉOMQ5	}M##s$Cw<[Ԉ"Q0/\n/}7;[ۛ{[?`%A>vN`JP̌/A0q_gk~'uVO<@bbU;8PpȵGbYW/'/7w^|}u娱WBU`8E/.}kFnE?bI,H,kL4]xq^|'wW|: ["E,NP6u;iF*	@ `jAK$OE&Eংr$WA\Ւ%=buY<VKdf*EȫHp1fUIeBWI0st|%Ĕ}#^/
ol@V}I_t}7:E7ߤW?Y[	=M|BܡlgV᪈"jgYl<(ol-_eKq#gHї\h0eYpUWJ>5Q"j¦LHbL	T1kʜ	C\Gi{+y~Nٜl ~-@fXk7GK	"ހ2<osLG#܃<s!iWTEB~vt©c %ЍQW	 %N;wCN̊hx
̭_Uk53)㶬SwXYNtGdlpHǸޝ%^^;Zd3doEL,YC͵$E)sYT&dGN|VėQUHъ"tx̹?*&z2c˳7oolZ]"F<'FﴷϬjP]UG
H!_Q0nFRSW 2(忈?){=/0RI5Ʈ_LhM%ǹ!9)F݄ec\BSL}YzЋW?7?n/&šlΫw>y/?<xXKf..Z2:X\Z:yybɷ![r$BOXL]92gK5=Q=r-p
#^dj(
td#e{)誐Cr6vπq;PcD%Ov&%Sv5fD)|2E҂$&rfgj4щKr"7<VP[}ǯ_~_WEKf?UM%$ӄ2E֔Y"[ĒK{S@QYU%TlBLO F@7cricx]蔮ZB
?ϜdJV?/}wX<Ck/XVoeY=	HHOXbViS0NZJO@Z>9m+V?练C 1g0 b+JoNTіwo{5ӖCkq^$`@I0qFxەdK. =ui,
I:&cf#?*bJ!foc(^!9Qфy}MU
(А5+[΋tIo\cQH_*E`䛲ܮ8L`<,ɮI
c	ٔ1,\)p: N7T:%Ug:_+Z2n$U<d+*TڤK$0 USYWF!˗Ǘ×)vSQeYaa8:Cb(D#PK^៾7\j522_3ty҉bL$4-m: \fJ.gVCnX3nܮ5+)
H5;+(I#LmF0ċ@L2K%``jIĻKCYͅuZP3q -xAoSwԑT$i:d43U0Y	j"j.Aei*Vըj՟f+<Q4`T!~r!Zdڀ__rVR/ξ0erSρk qyz'Dp~|~23&w-9sK4
)bF/~COuL&N&1BPLm6rVۨY)Cу)XlĪح^]
̩"Nr8K)0JZI_&?	NǠގYk;Ƀ}R(ȂL$l9v@~yvuHA/QS(Iȵ5ը0Qs%b2ٿhyWX$'FY^Rw?rW 5>89t\Np)jHb~2vlc\m,jfWy-ҀyY͹%;oEQvK(|actmhYXˏF*٩EPg@H9bIי}r316.J>gޢY,7$*(-J-9HŰ=O$;,e 'j[:`͠2>V@]`gUP
ңW	;sL~^P:OKҨ݋t vQ[-cym&N]nGjJvuav}&Kv:VIS9Otz4ecdu/F?Dg*@1Q슣T$2Uk	"Q<w` éU~ْDX5_`Б3ĮOY YvfU|/{
kBZq`a>`gDY IW!s%;g0XqrR-J[nrg5riL#ʡtiSUpvc<fA#Jܕ6-|whES@i|ĹлّpQ*/"p~&nr.Wf05ETtbgLTtt2'4#rt/ [b#5D4nW݀W9EjFbLŐ4F
)k2nJ3xe,$+ˮ5RC-~73oIn6aMr	嶠^SniCKo2#éC3D40?[|MFw,uDrx}r#,><<KRO9<H'F.m<5Sa`d)G2}Ipi(3
t?c2Wѵ#"I&S^0256.am)OEyK&L)
*١LK^f#<熃y\$k#jYi9yd
krpJK%	-åTk9QX%	)%H־je}`.Sjb@'/'_3 h"5ݛXPE%RV<4R{؏LT#̇O7\3Z3:i] Mڸg=h%"2c/ǣyN3+k~Uթ$#Vk??m	)i<}-zۓv=W_eem].Hs&^y\&UUFB3RF`|ߐu(ANO٩s~a%WRq7y{pL<XJ%LI<S2i9-"9áBYQ=MM;DXXCq\	*55?wBNYAcK/4pEV`9`7R#}?$$oqArpaL*<Bw'E[zC^r8z'=:8
FYWaKX47* |ciu\'I߄OEr/-猼_]%]Ҧbf(=:8)
,pc6UdVGh3d	EcoYp)ޘNj7Ƥ4jI21ʍ.e^UGf.%"7/_ayâ"<C+O }*;Q>>M4`Y⠽hBj^}MĆ5VP2_(T~!XSPA	A
(/*+Ĉw&t6R
17r2؉sLUx/$QNK86g0'vOp"Iכm>p?OmSvkS[lMނN|Sд~VOtOO4gi0Q5ᰆ!D5:F#EiF.31=G{4D|m,--OE艶>al).~ߎa-D2EX:+:nVMWtM[޴MSޘe-YB +H!oH!oHf-k:dYAREJJ+cw8]3#Hɘۍn=[KVNrNZ'I
@h%嵒ZIZIIfQFaN]A53rÉ:c%-q1K[zLG{D{G"}!)G3KϙjT"Su5GZ>BozʫLSZNhG\BqѨ_5qWW{Ub'\%RKd茝ϯ|dJyGU##N\uzWe!a^ L,Q@2,*Dӫ-xJKKy/"OqQ4nǥ'cJ-b%	~RtDmaB.D2l<rs$aioPgIuAzpG,=R
U.	M ke{(K2Ld0\]k,&aW~XP>o`$$O*LNwK޷{/nxXr{s#=EVPNIW޿!jk7ڹ'[TJ)Lw2	JO\KuSte#܄$t-rЖ@F
ʑ\xlMkN2ZFqOTiIO9 4jMCSO]fE=aP'Quw 
&$H^\,rz{ J/"5CxG&aTN_	*- =._l lLM:]M=ݑ{Jfz1?	L^kJ#6ކ>F\77S^icW݌a!UFlH6//nD"ʶ=W	ϻ_vZQTg޷zGɗIxōOAW]pieTy׶ý~K37guc@&s-	
(OaᆑyzsPN$JkCNs<az>mTXК-\i0,|/"2˞!:sYɼN,n-aiu̦qG[u7y0. 9'r`Rv\=utJtԚwE0||cB<ؘ_Ϋ240A05ơ4CE?sKoޒjXJ/pWdsO;D͢M֖3/hHfG\sE\ 20;uW<加V)Vlӛ#8*Z^2l/#Qs=~,\q/F;<k
Hf+5iЗdnh92i͚OQ4fUk¹[k~n,_:bhͣF[V[z,Bff7Yof*SdlmzA uIr˄tЖb1k9Cgv^g8sϩ<ffgz`gMܪI}з^ʫd昹f7lNS/q/-:5sgr@)͍<,AQW4	gn8Q/	"iwjLE|ޫEeyXXH0@Qf5FM@E`E%!U2`9etE~t,8d'Ke3Wik^LU) }}Zg"nie.Fȶ5*!	XpZ2ر1ϳZqWV㚻,y%_Ṋ	)אnz L##zsk~[:)%W6/%tLSfY[rXu$Ia֒Q8Gݬ*μZG5L{Qà@*5	[HoP=ǑxۓOMnG:5>՟7ra\{9&N0kws_=3D9ɨfucf~8L~ydG517jfevl.6 ,[bU<,,dX3g9R0BIvooO7v|7;/ wV螇^jnFz.8?:.{CHsȝ+.{~d B90aOw*8(4!>28ZI `1BqF0h镣@yW+(EHl0k`w
fV]54Нp	"Pp'z3d Қ;
0X8.L4ԉoNFE 
Lkwiv1g1PwΊ˚ޣWu}l<0nRG.ZbZ)hp*RXX{輸NɋL5	_yJYc^yAgpP1Ƿ3gWmzzYf['kVk}/stēѵ#n16дYVsNh9$6S@U 疩<f5hEc_~eBg5
)ZO0m0~&SSgjY@_g(/1C$6wywY'yN`ƮQncڑY`ͽ*܌6%w}Y8*Rs?#K"Bu5K_uy_چF@MO(5P`F;an9ϛፌNiCK-4ꯈ{-5[QCԒZDE50w)S^ɶNZ8b둌S3*⦜IFvyKGYc_.dj矔=`Z>tA3uWUOlncҙ)MWݷP\
_.lXnzXl!ϔЊK+91Oe05`50N-ߴҍZ͸/&mVA}F#JDgK^]x]PӅ {dCmJEhfSi3&'n<Y5޺^d%LL ' F2h( uFe/7)+./)Lh-+&u[3G#Cs6mS7/S4i%FٝfatjN{YhMUW^uoKfFBG%/7'X4jeĮKԑ$b([řǧ@a1]81s~yqÂX(3ox}k3&$U$G܅H:eO)΋	e4SgMq+";yyMxw{]<#bT-\Bbepk!N}CGWBH	efsKҦ0;H[3@5\W7"\'=nREiq@_rlfRBaGZq2/,gQyiS$cxj$
C.|")>Ukg▤/0td.,%vK1"{QکzڅRhؓ54SfqWϔq5S=8gԜp']4Wrвe4aV_T͍.<GJ!sFAP\)t5ĞOpv5lSj.xlEe]Ͱ'm{-3Q"AcqRWK
\ ]6H%̞ЭFE?{r8̕apr	\PzN`\L;$	C`;:0W݉1^eإRXɩ̬8\ihPI_˥Yk^LN2@k1h$Z$LbF8]ZGaAǏ2 13tzвDƏ8ڀ\ t-Yű=Ұp;;I 0"!h<IT
6?d$(+ǲv8mxzSI-iiA,_Hƽ9aCZǡ{4=_1h7y*T&NUSM"*PJ.2|M>2ex˰%R C{ZbY..GY.L)_<mzֶ5IC99H#)/CR39ZebPNr#!NR4kaj*qM5e1Zπ]!&䖵2pAoyKWFۭ0\>}C(m,myFǛ1d`z[M^:o<S~[fg|.W^-3ʾO,e=<F!YJ0Baa:1x<qL橐JBViJ|KmO71ǴJ)bSjw|)P~`߽31sYYTAYWy 9ɍluu8[JW(:"qmc:D7Xv3*T6k6N<z>UEǹq[xXK6[0tt/*2RqN瘯e~G=DܧV$g7wviυQ+s0!n_~5str^-J}C`|޹Qȵź0oZ&8ozIy}%f1Ѳy=Yj`挼HtF (f;M
WïLLq,Esi̲(8/>Taڤʷ2۔*^qʣƃ|,~ʚp䠁$SaBRp>HU+}cxRqBխԻi=&O{Nrv7亞zoHF];a@K3/-rD%0zo##wǳ<-,_mѸ-~&\	lE2[a WyD1MA~|)s>7{mYjRs0}b&(N0ݣjet,3&;\E.>}%
B,V9R_^ۚdm|"['{ÛW Ɨhw)jYn?jTOk$0|ͱq%R:[i	=J}OȕՈ8\U[xI@,Gua{<Ȼf99ʎ0<ooL_-&%+^;X_Y7T(ZS
ZoBbP
Bzwɻ{%>NV'rPl_xZ9DmRWNA5db펓YZ][*:(	yK}[xp3EfRFj\ty)pcښ"K`AYG;E飮<,**R
I 2`d:sonNPkZߍPʈ<~;fKmIEPPPmR)r1jT=*#ēYj`9b4/M}~澟` f|,쬉Uy#xR=,%qK9/zpo:~1J;
;t1a#|왾XҴXѫU{EAKNe#:U(|(Dy>Xc<?Y1/Bsc[mPh)Qf7	xH!cZU~7[4 Az~YO\M]Noֹh^5.ZX/?TP?UgGj0VA\hULuug70x29>U|AU]XhfWPb]j<fM?eվaW˦zN>
_I@AHJ|Kԛ_/5Sm2Rv[Ҩ=
oԬҊ8L`OYSYZ7hǦr#Qņ$Rϵd26'I[Aѹ!T9r}lo"`2¦<s}T$%*foDMaa0|&^ޜ0g>%34=;F GkŕXVLUGžYSɣY`7XZR^xAScxs.kjQ}[SY,WH{_y3\yɝ^(A房nv,J4	Zr
Eޜ弝ܵh7|ᡸv޼7b@P9[$Оe;tn݁yws3ʫ6Xҷ[sa&hS$vƕ04]h}Fso̊܆vs K,"1|?qWWdqlD	>jESoquU'oLYG}*?4!Wo5ޠt+Ck\7Ny-)淃GIyŻSQ19B<5`U$)H BpVTٹ$T|-R,
{?/9MU3BϢEh@4iKN]}p~K]M^(vI>f{='~uc\ȢC4uT*6%O4<&CU7M )If>e7<B0:C||>U
\#=$~.{ Ҧ<9'6smw:()~M*i<ȣw袿3kFM.wOSqz
C}Hl^Z쇊p1؆ەmaBҹ9YxL<7wdky+qA
=,[ˮRTIGsˁˁY*C?r`D{ƄGKKK~`Ȧ>2*nX9i#t`(#?ݡ=4ƃ*I]H"jUR*墔m&a YGjKyT[s{H׆ns!Qv<^3_helO%B*95
`V\1yd<^шOEJIӊJ"}da6{X0R"S9fTifnZ70VGJ_x(#Q1Q)[nڍT,g
t5t!	(:(Ih9q@RB~48r[DݚVCm☿V#ǰZAʷ/P|ADH%z7Sǈ	h \0^TJblXGШ?S-I'[qV\rtQDlJO-y.mXI/uB'I%p8̈́ېfjk䞹~gު-J9QHFCѥ;ҙ^F_'Y;[Y%/F.dƵQ(q/ʝpV*F<yT
et{A3PX(pp(VՕ̠^!灹\o(ŭ7V-{De1ԓCwf@2;asX_LGn.b焇NCW(@wՇ"F-GלW!3	ri9TFTgPpa|VNNBgX|}[t̩!$6f$'ag<uZ]5"eVB;au&}R $<
j,.{r/.^襁YoUy )ţw'hWG&Q%2ȑN
:0: fێ|wylO/+ +Yk5{:&M+zkbHΐq:r x0mRO'0J
F`L$/.<SͶ?ښNQ|<s7uitc1D="GIL O0RWp׿\c!$W*y-ٙApG(Nx`6zD>O8uijʁc{ga]ӶƈFE܄ĝOS"swԡKzsšQr?Ƨlsހ>5)C1;(Տ\Oy'~FHlj\_2iyi]-Ňȱ~6/AD:_  6>I?^幵WϘ<jϣU(U~Ҟ{V*?c'gx˅h3@?F?
G[b΍O5} sV|']2olZ)wU2Z~/xmqJXҚ0%d/ڵ_^~%}xj6%읡'..f5\h Euxic\M
C"Z<f>V>laHҰ_e&3Vw5	4!Da6='`	!1U ϴ#omM}K8AG쒬濟'M遬=I/8$9|66pD1t."&a0T$ D4<nlms9JLd3&
P	p?9odUSq!+-\-8@_JgnAuRr<k-5,P{nUWŢuZ_*Z4C Q80df)q[*,O++	 p8oRӓe+,y@ {ս0\+Ȩy&wmGӬ/eZ4Ֆ-GNG8ne[0}AX:ƴwaz,GW^=Hq<$Sf=Co&Y]o'TbӠvQ*ʟ71rGv1ppfBRd ދ"X՛vYB~ݒaEy՞w)n/g^Gvs!WSHPXs(±(ci"̹(t8B߫fȍ$[("Xiޯ<ؑ0GN0c^l*oKl`)*Ҷ7! r߹8^tK nwcOȧ_ӝ	HG%_?~_XjdVCt|;\|S;nY{ -6A]$bzHqR,!V;93rߢ-Aӝ!}2l 5;hLܾܠ F6E~,>9t&{pf>2E"d7?~!!2'nCn\0%a
M$Eٍ)	+ Kv:ksCQִ,{dd9XL4.Ti]euNC;"ʏrgVꧮ3Ojןq0)~@	JQ*SϚ?zidP.e9_g8fPz"W#9:/(oMĲ#Oaɱ~6i70WSBUE\'7P|ъQ[WXvobvuXm7`%Mq>d%v$K7:K
:꘷WNo5.\AojS-H?6ZX (}Wl/ܡ]Svs</-dL,ӡ"
<Gtr˰"Dtŉ |3TG֗~Љ:.Sni2G#Fb3xOenfu|^%RS	;ZX-fj*s$Ĥ*u&@(L9vBB/ f/fZbRI@ﺡ`Oa9WPqDeU5W_R	o`Ϩ/hX0n˓iW%'}ϠE{-CjA ]:
=EdJ<;Qp	G@D	j`3gO,gV/.nMR\k}||Y^,NC/+_/c\M: S뽭onnEd)'
@JkwgWg9&A02fkP1r>e6 .RҎrC'>Ïd
i s'p7Gox;u̘m)wAhY^I%a1`LaF߉nOh-Q/uG4A4(r@{I")ߞIw/"pg321nTđC	\ѫKzj($MXؤI3dIE&I]G}>Pm<JQnr՗HOv0Nq6hdEvCq^P+yMRP:u ^e܉i|<8=z
]/4h2SVѺwqnRa{DKN"$W!.tg0HS-cK+0-1}5tG(nQ	)w^S`FAE+&Y>I7sL1v:8xk?k^yzycDJ3a?\e&ܝ@tH(÷P2ja+.5ogM3r_Àe!H:=s3)<&R983f'3lk]вy|AKov7~Y&8ϛVc.v搓'b6O+`1<`0^yCv۝nf{-)|Tdg/!۽}yy|go493}{OP_!=NƎ7gޣ"d|v}ׇb[o_m,yf?~ßxx_P7de>#H͟^~Ow|}}E0dRr{v}>-6Iz5|}ٰn~ڍlaܙy}Ɨ?m'kk+ff3+7wri/&3؟g,o̟G2YD'2_W(_{`W2gԵr0EݥhW0"PaEakO~LV 3k{Na??/Gx2Vt; ,55QXB}|O;P}脂y"w^7?u~|PFPgz[#\f#gnR/S<g0Du<>z}n
X0axXg_$;@]-zDIֽ^r#Ef=&=T?*{#eu<3(^AP9i"M+Ȃח&etςu.sxIr r`)ؗ8zx9pf;߻.+,PkD9ۣ6H$P$ϮnlTϬ}Z2_׹fO?Wig?!=kNouNBd5\eo}H垛-_3yLkYu"׼5hȊYmCJTrRfwu5hEd:Ik{z4VHXXK+U\,neޟK.g:x{Is'|ԿN F4>{f@4:(6Z:M}g.U*bTꗞp?v^:O1yufkM[o~fO+O)_u
qSXOn1߯}ZOܧip'uFɈ_=s$Qׯ{?tQ1#o6Ȋf5_ЍGrR3̨쌒8FCɸJ^^$C0:2w_u/v1f;cotc3pɧA$=\|?Gv.zѿQWi4ZwcO=̖`:98P8r!OCyq0νQ?PS;9M_'IL}lt:ǅbV$8Ӌztvx22Ց9m;O-٘x!|/7Ȯ07P$]vF[VˀDϏtaBlo`6}^TX_kshlk@fubYz^[0zoP謲fۢfqNY	jkF08"V;Me뫼1k3nΑ)-ZBӀ- Z^SSv!R%@p>.+l+is2p]r`:qNha!̹#M2g	5['#TX>{dL\pNQw=s\z.>NT7шK=2%44tnM|wv)z podkҐ.nCrhuܱR0<3*h=t_OW +;M	`$QL>ݠQp<BΩvn$1j>RTPQkj!V)Lk=#/peE iXbš BgJabJ,?dOoѣG
Ynf顼_x`cA-tTͬ_̎D0ݑ	2#'u!?M	Bzgl0b,VS#=WRRP*|]SI*XU
Z,wV>9pJi!$Ad6W_;vfNm;[U{.lv:UxʳVsn?6_l5d"`_պRkzs
%"Ywkk:]pTREʿS :[S*m7OiU7 $mwQcwkYm{ns4
CV;f;e߰ƪoumVsnu[4dEն7Vk7kVk^m[ٲ*k05e.ڰ;~Ӳ+ouO	
Xr kֺ6B(>74hp{cvӶZM{6)xY@fA-j#YW)R^j(evB+jz{ٴ 6H:^<q$ DYݵ%jث_ǭuY]t@eڵPXCw>{>vB5c6 IFVkn(A?kՁ~bBLw#&k ́
խ7u[--kmG<B^T[а5h0`lc%6|@DFhQn_@kMv5h`oB%vK4ng}}M>at"Wޠk ź\km7^o;Hc]X\@A`o0hq5`taõ~*(MEwОOt>mT@a^h*EC1<(:#fDS4[:^a>}ÿj44\Ю>(<]4F{[s>LIjxE+E75čOG\'\axxq쏃`rSȖ?\6*I#I/(͠w/<>|BEl7N\_=?rJ,ib"VF` ʔ6(	SMᩁpeQZ򞌂#gtctPXn$A\NaGC;_j>MroߋsOi9yr~>Ç.^÷2w8'd?yڋ]W95lQ^Bc(]y}FR]8-I\ ΄%WD$
	cňlFI1y:"/ph_Y[f?7?E[/s+:~KC/	ߌW<wy~X߽c0M"dfƥ2:	EKK5-{vq2y>!&{Uվ9EB%}K/"n.	&a}]ګ|P'0FLe&s=a`(Kq荳QB+rOwhëU6"WՔIB} H1AM5^.9FY/.r6E|dURW(ϬL1(^JK?I(,'Q#p6Ḣ/Tc9}B$/#)'LC&7s%mJܥ+yj5}&sP	4%IvgM9D'9h[0t؍" .iY>
Eg$-o%'a<TlC$/X~OukWM6sݞ*)̔t(xJDCVPA($=AÑlU KS]^/.d6Lﰔ՚ڜJȈo$
WY`l	БCsTk|W,"HLQwZ@K+ja?sFЉԮ!LJME`
w/"Fq<]Twujmaof{%7dC􄽂TCTUV o\X7\wAx)L;*_F ݔp5c,̉O0x2=rviEKGi)aE
G|rqxi5pz	 ^)Mc{nv+n*W'.ݱW{tE&|"#8GibaW! jQ+BS%D@$E?zTS|ϧ!,rr<o~JAEȞ'We٧ʨIIdU+ GjgT舯H9!ohKƾyP*b  Ww}O$5s/xN!)awbZ,gOr9祼}_xF7Jz)igf9A៚=yNOYVӨC:LO(*YP脡s^1蘙puKI4(H\XU1D(F
'4zLWLf[P=C˩5mb̟Cubyj/z1VM^qX,d)JtoC%-N~v2TA̢7KRv 4*{.WL6Y:	9@d(4^h]&,Xs0U$+G!D0H -J$90%Dm9FYeND<Fs*$!ω`h&7l@	UDQ6:n/:c7#xIuڅ39˙&X]]5N"e=`aZ]}ىnlU)ra}ЎYޛzxbg+fYLM\3/bşBQ0vYѴ $U*(/v`ߨ!Xgh"NQ
L](q>[
"nF3sNLAJrdqԟF5&<S*oJF*Tbʈboxyp	.(,ÐJ0sb:ֈ9<Ĩ;~vxXg#G8h|kG\45m4wDA!w@MilAa:|I4J K?~0k+3)w=Rì2J5yjQfG7A#^eTͮ'?Iɷ~>t?r=>[_1Vk eSV͇Lw:Ŏrl&:9_q(fO1+؀ֳ ,fMf&dyeWbxŧ#d$ݑՇí~q S8tΡhpO~_acV􆜎!OY2+V=IY}5lmQ	2b6F&[LN)U\㿀$iR24gLND˲Yi#?Q<Ǿ{X@d]ztF7juW:B0劔^"{[:Ȧ}ϓŵ"K Yhk}666Lph\"ͰgPMʪNmM}
6MlY|(XdswX&oqgx0C't8^6j2;gxqM+9Pc,Ukod45*Ι,oߓ
xՓx,	vn+i@Di96v{Ē{)͊&x#&bT`U]ųd8,rC(R1dhI/	/r/cPG~̌IO/fxePA-~g%GB-d4!.\&$`-͚42Np/ʔM 1\䃇an zF/E&9GsWsAu UdcI2r򐟿Dn	C~_Ʋ^>dͧ`-XT`Eeϟ \H5#=\ZPiB:mΛ,F?ObVH?̱9zLȵFڐT-
%%Emr:7T6gVNVV8hmF=חk+lK5.X$h1B)Sur.9DMXŚ@\dՔT/AX9t	Ġ66{K(efmUZac KxC\gP[9ncTnLGb1o<>cU1QZZQҳm:):Q߁~~,3ys廎p:&a;8Ќ0,`o곃(9uG]C\8O 	TqJYid^h3P#Ftsl+ڃE$DpWuޯ0P~?(a 6oDRa!^l dGx$wcuMU&K~|օM$ު(+$D.8Z+N0j*AKeuY!l41_gDm:M6bϑ%^I-G44DaH4Sԋ,`fB'ڠ'(☄xC|pK) QsA0x փElN۠%N<Ô
V&j§ɔʧph"\//e!lc5ɴ3З`W
dwxm1kϸ_L\Ǭ)ϫQ]W%$ZhZ&@IsF['tf~Q'?;g%mFmZdG@`A,&"kZi?$g !CW?*ܬA4zuBtr"Nٔ=úgt$2Fc>i74(,a!g4cܹSU"~N9BNmYS83ȽkH>(}W]|t?"[~L9v$+$3FOTфxD+:qݏdN\U OY	^fMwm3,%I0qhqRL"$Jife7(cR.j{Y2of"	K'Q46	
MYdf.H-jPzjHo4
BG:1^]'\BxJm.kᦴDwZf1)rP+̏c?i.sWí5ڭowr_W9<YYLBXKe%<:t0i|86('C23gz_y	Smr
^$2K#w~eǿb7tkuծZz?z7p?p`Hmm&ߥ3*(%xWHAHe8 _z~h{%e|Rbߨu*V:ULgpHY8#V?Tad0db'~˿MM}^=8a1Xe k~sk
/^qP$gTAż:3AxޯмbC3z{q67*\\HlЂHM]1Ah)qMI_^D?uWtR2;OWZl155v_0|zwGzg}|˂vd@͔QB HƮEThes^GQ{VixRs)iߘIA#^k~Qx|Nw[ 'dȞ+O	4W;YrG&iN,)>&K2)
z蘾ph )]՛~2$ <4``+!{b,-ml {t/vFhm`!?&n%MO{3]x̸#%i_P7Ec/nhs 9=4 xM x2s`4ׄ^| ׸I+Tޫ~Y[GDH@&kLbpl+w7Dq;Rh@ns KDu449́Da񂰀`}wHJ1uFBJN1tzBPxe y0&$y(>ۗF_o.EϮroYZ&sѼ|7\R´cW.^q316GR΁
28r_}u_̑ P 