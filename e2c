#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 U)] rG(8`j(fݫ B,J Jg4JT%lVe2 B9ggck{}5ۯ/YẅȺ EPFJD%.aW{jvoCF՛NkmV7֚`]8q# $^>d''H'W?fVnufټa}6kkvgը7..c?7۵{'o5]\~F	`od?CZ?: VkR7]n~i/yO";?|.	v /_ak'IM6w;kNl]c]A$dYKzȋ9#,Lμh!;cv%2?YE^(̏)8Wcc (?^ $=WU.ǭA8?wo^Wǌ?Pu+Uia~P2tdvqI@I<q>3@Wg>@4*0N x12Z}CQYvZo&-_Vp8X`FZ;4W;qǃd'H7w$3KyYKL/8zo,	+h?z{}l>[YAĄ5F݉;={q%ļBj\yQ={_>Gu#2|WFҋH%E9GI{Kww2? 8k0i_vjݏ>ݟc7>[ZO`l0W	t#M4d{g!s<V:54^pvK`8ôaٯp< LX}V_:^&'bع~|v9mwԮ4JԪKe37pŞ<:Too6oohzHXdlSm*ڦ"٠bTLiP1(&=>/j&A$ȚTdlRM*9+dP:F;]Q/Hfej$QtK˫~DA"F9';/8/?Sk	KAۤ*
a	^YTسj;55pyYǛqS3B#Օ|-u<"ů2=D!{΂ +^|ݗA3 sF#]KW.!p{	b7b+:z
{fUئ	Vo}MYqǊkY"uQ%lw^:8:}AS^|zǃ7Z5b:8zycyyJ0w?H0mC8t>sbPI~Ȓ$F1?Լ(V3k.ȋc{Ѽ.44_N\=+NZ_\nt3%GP^Eݤ[ɇ9#0Wӱ|+(Bul'_!ǳq6-(=N0{Wew U*Q'Q]w^TV0ns_79OÓy_T{ܩ_+V_Z|RKQĘK]]Q~pF{i
=A|$tǓ|w8CҷkOVo%(~{Bl.ڄ96HeڀN=0T8䬨Ƣ%/kSZ$#o8JT`"4(G\.3΋ݭͽ7jkjM,}螂 \jfE'#+x|vza,AxZ`U<Cf s*Bk4*kP%H^N/7w_|s}(g	K*,kFG7مoJDTc0"Y:+3р%sF;O8/e^z'XwˌA)3IT6RZim0kdҩ@rׇaRҒe}ek#Gr9eTWxe|.YQ}LX	&e8HU-H_	1Ҭ	sB9؀;-zy1r_uo
ycA~}
x㛂eZn6aowsiy}?.(bog{wZ檣"jwi<(oNmj^e{ObHѕ\7S#Wmu.#/J1'|fTԄ[.n<%sG(x}i7N} mt6*1ds ֚!֌)rvmo0>EF,CiG Ͻ|Uǐ_hg(r,?#tC-H)#8f.c378}
sRl>c܎s +ɕU_-k</l1wz0DW*09}΢y&,|٢yR	,MlnL:HgK9 utKBUTBg;r:gGow4Lfs^m#[տlol~3\x8!A!3CG=
(%-	~),ʙG᠏.Ka
2(忈ݖmLT$#/Z*Y~aote4I#ļs`ԕXleX)W>C(}@ `dNO޾b-:7;vaxl%n<}?GJa!%4 [ui(ˌH^a7lɵ4<=I0b)ߴ	m8G"UXlTX-?PKG7P69$)J[nvmBc
hA1g+Q>d'(bFWG_$-HoZ!)gvY&pa>W[*_=|W//W 鯊vD1v>N12=+JH	e )D:"M$Z]J-T"7 /c! rixSBHj~  \q Gc):B8a˰p00ɪ\YgI4Y)Zi+]49|္CeI)-©*Nzfu(xMx!N֋t(	G"Rhd{iX4P	u3ʑjSeXCܸZ%g!ѫӤ;NB43VRdG_*+>l$IqLc+cqFyy;NSX϶s|%1@?ĉ0ׇM7`>f+:%&%-7Ēom 
!殈$`$oT	SN^v^B^)~2@zqhU,iCS25yazo"me˴unifV*hiEG_Hh\@+CAX؜nSSnݮ5+-
H՜kMsNu]vEL~2,*簾ZݕL^~Eif:qA".mujIw~.E}ǔչBb(%zTAp[Lue8~'M:c/p/X+etyUL*˅RW,$Jq+p^#ǫh+D5#sx;)$.;BLw W+83V.^O"۞D^Q! OP5V$5P>}R+v;od=cnf\Ac!ݠxu?KQ.`Gu'ӂH[K@Y2~ l䔭AI`IDHHbcV*nZLqFȅxF1oWڢOl7Jpp:뉯 4P3WĪ<sRX;=yӧ5ÛW }ׇ	D'$"qsTQ-q8:VaZdE*[*]UdFG*L^QWjQoV+Vj}Izr1jn4:/W2Y8Ԑ&&߰lKЭXpͶ|hm&O,iߺI6F!r@scGƠ=me9?iXf%-9BQccj]Ӵ.+/@*~WapDc/o,4>;{?|{h`s[reCU~ap=E0
 f`@> *?,594QE=E%Q1CBNNC|(	/	|mqld{>1㦊}_)^?^*ApKO1-Z!d2bA(BRYLv3IMw/0'+f.Hۙonef`ΊrR[m7Se<V!cWR1M-I : ys$}! nܤ/`ʱ`e2V90,G%W'D)IRme);0QM5 /k1:&M#r
x3dlhĉ'DggԪJ9Eic
"ԕhyA]zN	BjagUVKROդ,P-)ܟ_<X'	J焹_\m]+E=Sj_9MaLcq5?}dšp0*'Rƹ׷F1JIQnZ6`~t?6&gn+Z WM2PYZ\aoAO
eljse&!{+6ۘ#I1wK)Y6 ʈQƗ@oPdz;HwHRLOӥ=2Nxh*[;Uar/K2sr7)wS?gT3EEsn:\^Q,˷5n=5ϒ )S_rq
4Pv[IJ2POHut"7܆rK~<뀅/ZQ9?C#1@@\<(dj`digc)7GtH.:9fkdc|pB	)Ы,+LiraJ:6G9RIL5b'lxEM192mѻ0@۴SY#}x6>l6杷^`OĴҖL99Z՜P+=!v%# Ol8.)Ș(#F'dmʉJeJK\w_ t/|Ixʔ4B 
J5A.*FM"@`t0ߩ΂h ވ[Pk@Z~aAfjy({~OO19{iY:c'|FZn`]k"|&ϤyFG5ۀ^ʨW8r^)UuZ"ӌEEy3s~zQѳd8v,zW_ްlI"xM-V{#Eڛ UrFBRALpȻQ 댶fؙ{II*A87n͉qP|O41tiR32=YOP݈Q@+]bNpUd M^sHFfEXv]v	oS?	;)nN )P9ҩQZNF_m1}XFR'7Wx&SHk$I	SV
 kq7!;&cϊfWOChZ̉K>fC	$ﴂx,uGgILk>7֤4iI{z_Ȝ[K)vPz:|%q%"?
D?,8B24 T}|<4(4Ah5Bj_@LVPol)+$63({ gw\p2mhG>ʭ,GPIO";#Cde 1Ǣ{!x(0ESo6$3of&5Yś\=+?3f
vLfORExB)4CʹfCe6%S3q?jK@jX 	JQ:iipMӟZZQk:jRQ`-3K5(j~jHhb5&VA?|Ȳ~wv
*7*M)b5E`,K-UyCh@[2Ԗ%mɀ[i-Qհ=F7yӖ7-yӔ7yS7⟈ϲYCV!k_[5	|M_$5	|M_$5;5|"k:dYAZE{8i]=#H}ޭwk]'kwQX~ FZ^#-(*&%Ij$</$Y=]~#K;;đ82[sĸ7gtw\1Hqю襉#.FR&T"S9*g|=pKLSʗQZSc4scȅwKnԏnQ^VUJݜQgNpX'hN3F+}MMT@YC:,/
,λ׆D]SڇTpȼ F,S@2,?-*D[ӫN\--x/K+yӝKhܢXa2g^-bgbe+wEe}6=|ԵxR"+%#n$>0x58H\1ߡ*\axVXIIaԲyڝsxY+˻v?,"7C
SS~	vłW%W7"\)ܓ-]_lE_ΰt[62oDjlR)E0=$"+c0%[eF_I(+F-u*- #U9!8z4U5CqOTiIX90sF!6䡩'0xYsyy04W77"0sH5HC&đE3yXWoD*{JFA#=ǌ_{IŸʿԓha,:"1ઽ>BJWg"fs	2:"#ݼ(ۢDW^iC~S}}'?M˟HW-nl
l?rEsן7//⌶-lw4r(Ug~W(}k-7u9R4xI8{QUZ$cM/fRt{eN
LfCPX%Qw̔\R6lCҫO1l+^|`+ȗ$KAxE˵J6'n`_ŷXįk nуn b8
GE?:ZPϢWt太b<ߠN_/a'{P3.iGYSӋJ	[Gow!%/5_VJ'ywDn<iK`؟8d%lʖ,NC,3{|5Ɣڈ9erꖩZ"Sp@sʃI:۝rE-j)# 8?*Z7Z^?8c>S8kIH1;(҉]MjzBKP.k0jX'קU&o1U8#G;ۻ_T&Űխ<ݷSA/LgIލF]lh2~$|J
oBVѓajݰno5דS:n63	xTxVs.Ţr<wdn=xᝲXTg*_qC{(gxՁr멋9Y*AR2zRmӔs*tC>)(Ad~ <t
N;k*CLRD);VyNE]yFH0n8⧎+_8Kl*WJ
uڣDK _
:1j9*V{8	^`(QRwՙ @dhxd7?c~;6燦uFZ4lNcM#XOLm ANt#sM<W>ADQmgg&˅ݒvo:'%pf|fe&i04g:#`)y"e&K<dG#< Ur22
y4嵄,o6Uxa NfF*
pԜ
V3a&KmXuW9o3oZڃt-c=<r}4(N&Yy*^|+P?ax[)Z_|{{qUB;؍84gD}9,h8umZMj]4g>luSfOX~>̇Nt?%OS6~)Q,g6&H.9,tXfìj0R@|&
 ksȩI
NXv0f̫Fh"Dp6Cg0L+*/TA֯hDt༂ ӂRi`C[|E
EpU?8<~s(ڵr+1r"\o6޶='jsɛ}-Z3s/'~'F3.ݽ?!;ZXsǴFY_LfWizg2<˽^wN07^0˟Z/^om( .[ov^md 5v_W5 @ظċbmۆFn/p.M;]suI$|*4ՋnAL/o1iH4Ha6<a'WJ"c߇4G<ŠJLs|nkJXnZ9݁aOw-8Kxwp4&X< K?+g`,,%KKG;]-|?}PJQ$P
ɟo\$G g-ynnR
NaQ{2EGDLB!#:W{ İð?gI:rU)fڻd~;^ohOzZ?RLu|1=ӼR<W*|Q(\Dm0>mCWeXE±pàOͭHNq#>P薎0깽*Os,45tYl Nbްɬn['׮['߮mF-|F=3xxBqȥ ^`mZ^#*d	-ߠ2	f1
`Ұ(gVKGl/o^69@%J@Ưdk_-LF`K0YHmPisc`{vyd\kmɽ=xcߨ(=bwBEY}#}J!EĬ_k050y<oHT.%\V2HL]1nej|klKT8;GBav<׮6OύߩLSrׇaR%_]e>+FrvFҒx5$s`tnNoƢTf	hսRjUppJ@,> ,R-}	szN_5Ff[.[/fnA"u6ATu.0
>iSDG	}TPiyw]\	E'LTՖm2paTWe3.$+
/'qKWMujՔj̓E9*s¤gmHUiJ;/3b&V+iN{Y?lhM mcPcr|:]+mAfֆp~ ׄ_{%⎨2([RM֘E8dfcxpVm02M>1&U۱w!NY.RSDY&li\x<y~sRy \gcL-֏-wrY ms%Pe' mw	H19N5T=jSnce/-8pHuyar6y<HTQL)cCD-RiHM.+B!O0L(ުߤ SIB\x436}AƸFCISaբk37z&=Vrb&DIϨy*gOەڳ\m|Afxƌ}OTwG#`	\Y!'#M+j
1ݵlԁ	ܬ4/{ڬ=:)jT
 2z5ZlUf*<5*uXҐV)JhTXt7ip7.KĜCH(gB5wu
<eHݶI`Lu*C^T<J=lpe1'oU鐋~<d^ʮR;0X) Š:(j2tGYu^Ǥ7>sge5q % ?c	h8mWa4%ENK#t"T'@bZ|E5}53gō*i$Lm+cϗb[ֈO_~~xz[I, NѝHL- xOIըU /V@mW$L_	Cx
G.h&vaY_]}{ӫW\iL*~WOAͬse)Y:[\];-ljXW,87oYhB5գxi{^*$OzMM<ϧXuXk~J3L*cxt͚'ntox_|9EacZ㳰k,LT~'.km]!םŎGY~X^À,)Yj&jl}9WHNITITw,@ij7Aݻ'eͳ\,پڷjFnk;sRoŶj*<QzU.FV./D dbfRy6l/(LmE~QoGEz)Z)74O\`I!Q0_|KJ~.>[}vM{D)}	w"#>rzh*=|yV=#7b˼MzkuXxIgQp;_YLlV:|dK~*r@q7>O%ژM`3U5nXvB*[IKa76N+vÛVY+=tkSn񱋅m=6ՙzѷznz3F]6~J̛^UANP;Ή?H71O[Fp8[*!UM3ʕ,\24bd0wYI:b9\;ŕk9p$qT<Pp(~h{DgOņl0$C3)l;8lӐрp0z*VB 㼚룬ZIm~UDq(_!F1d6q2)C 6WPRNfc:xu<d9:EBU H_9˟> TVs,~a<2Yc+	}Tݾfx
__&>y]_0e	*լFQ".!򿥲D2NPaT}--" VjQ<Vf%=ʌv<oD0T;b %JV
nv4	jMoބiR׶e0gX(`$$ZݕO:plzѓC%SrDx½l	Ri/N9x?%ҼY_[h,gxobm˫l!R	 8-v6,Ƶ`@}N-S*KMAI%^_`h<R^TDGB(iFhQNp2ߦ&#y	~d>+y/M֋!hq$(.*!Z4PKEY<ͳpuz\V3UϾpRMZXXĲQĴV]vr}K$
׏Ɓ1pWaxw/<$CcY0`mvauiyl<mQ&xJLudWWEc8Q5[^7~zԼ/+@A|f.\rxg	Ǭj͔Ƌɭ}SOaW
$ݔ%:8R( Af,!~ЊĦnF7)ĴZX/?UP?UuZ:VP39.l5oa>CS,	[X0 $#X>}5[U]XjW U`uT}'FL&hE(q	.:`Y{`oޙq*RSpĕT{jyuurAIH+^ow\w4o:Q5MW130{ꊻR\beIs;E-69}Xz~f7G7PHQ:a{y6YPy=awL;$j%Qgyqj0\̌LL.^h6%n!eJM&Z<vM4Z'?"Y?gsA 1]]È<spBڍkOyÎ@FdߩM5I>Zd+i>lK4"=sj`<h$⇾|{P`ɣݽ{?uF[ZgKS$PӳdVh+)
()[0.ȣW,@Tvh4S|}cV7ۛ{űcy"ONG.2R9J0OT\Y"\9pU'roVJ"1ԿjY/.>оe (-ذ?}cctcM8=VBz? 0HlEdioDg&ɒD)<h4iKN]}򙻚6op~K]M2~$>/f{tL?zOfѩlqO1:j*6cw~_Y|@M|ߒVi@#1rJȓәnbQ1m|U.(:G~|>U
=c%A$./m%;y rĂ^
*u 	~D8&ߑ1ɽfixzy=ŚMEN"Qxњ<g?,sdmXh,ŞSj.fsSqx~	4(XSY| F  MYR*on9x9cKe.ZLU8qOuY)ui7/q돬RU5, t!`L)N?=4%*I]YH"jUR&ţ&a̒0%bӼx⹢YehCX7ԹVBS_helOUJE3.&G%_$	c*WxVpEwV1ٳxME;4(1IZ
- n4J~ceHTez$*0w:/8wH߂v'7ngb9S0Ѕ\Pj$[8$HKUI
Ѯ5oԶ01sFw%/P|ADH%zL73_^PSgCщ4Yq(s.b=(мË)8YZ~I:/x>Py.mYIϏuAgV	p.
%;֬UAcHLL|*y+BEq|A0rW{ѕii+_օc\[g)7ȍmqloYO|gnvX ЙF)6QrH0,ͫ+OB4[Cw3^S[cThH3
P}oGf?GI6_?>}:咚_՞s	ģK*
cyM56yj,4+oeHୖkL'Ϡ7@܅Ya<:"xXeN6e 59G7h?Y_:]f)0#c=1^*Fݮӟj Ak$;jw@"`E<xcI)]\kn,Bvhpd#U"D92IA F椃ݶ#]ܓ'f' jMe#}n)/em>A@Bvy=51wK$8y=Y2gOg0^J[4/.<Sx|h7Fax:XS ßϏ1ǘ#+cE,4t1/^{GQ8 OIH]	_ӇFĨo001SWf
^QQ.MMS9pLxqL1q+ap͊xcigXwnq3u(=IBuzߣOIGwR,Tn&GnՈSӑbTbb塩16we;Hc]3OۣAD*_Uϛ  '|ΠV_Wȓk;<jOLX*?iN:?c,xN(h@RWtLGT1	ƚ>Dk95}]u7c9fru)wU2]~/XƸ8V3<>Kɷዄvmׅy_yYkN<%΃iW@Qa^VR.hҦ I- 3VMZMւZ,HgiXωiA^.h1aaS^9 OFx|V<އ݃ꖌY$9@%濛#7OS˞irc>kOpDw/ch0T$ DFlm{7j6+=s9&fM.
&}	.~r^`.L nhpXs32t6쾭FoW<uwX/a!W֢XRQ
AV[uŚ_,ZΨ5_C%e(ӥ8n(q0K㲝Pcyʖ	1]sG7N }~vrQ,{1_' FKwU6T`lz)XOI(xBkc3Nm5Z@p'֑F#msWKf9ҋjYLY-%FiADjM>ѧ8WcdvPM>Jڥ_9b.-iͅPu^o`䲏|ɣ2Nc D.w!aZǰ2ip]:Ê=X2L-/疖[^U].>CC,P3QcQ*E+s(`E"ȭO$[aD &XY<0ر\x0GN0c^l*oKl`)*Ҷ?! r߹8^o.@µ(G?Ox=;(dUZK ~0VCt|;\|S;nyϗ -6A]ꤖbzYӑeԼDuwo;93rߢ-A!}ιz&Fhvhq/y]A'^53Jez,=>=rG{p6>,	Ucr?a7>~!2^}֬0%aM$E+S|,ىt/-`gYO9l˳,)'qЩҪ
=m׉qQ䣿8q3#._"?2!>@ +(5c:#9,<j<UHJDCtj:26{<DX`r,gd~?K)CAAͪ"V0EH-pjvoCF՛NkmVk`ŃƸPN"T
A	vKKXx3kZka:31kwVY.\ !&5vi
iNQk-	y^_ZzmM!԰p\~vG\:E=b?E{=҇TdWaN3bN,8?FHrO/:`RŠU\d7L2G$F{Oڕcv ̋.K qEZ+fa mp/!'=vZ`,͐jO:][Hb3"WrE /c/vZ/(i~E}?>9%RzczTUJ8?GsGǂ=w덗Kpr25-!Bc9zhejq>Oғ:DHpS(;^l@A'Fh88~q҅'ŭIkC݀/>xS;˥K?v^}zok[|fIdL:]`)/	"rp`aʃ
 q<Y f]<]DGnrD<ORnGlnL;Ze/q1uL띦 4ppqcIa7þ90IAyBqދ72E#4X2(9T(m[	`QFgT+:*q%PolT|j޺(*$XشI/;_~(cd9=W}>Q<JQn|՗7HOv({RzG,U ;kk8w/!)(hI-WpYV O'xOc`~A)Fat"b^gfηZZ4Yh:..ǲJJ$ob639G\GnDa"Po@ۼ/80@H9ln+>|mI,U(8{ީ&)8|o\G90C7v[13	-<=fL(Y>MGn-0:&Y[kuvU5XDdʁ[qCuAx7ߠNyéWk0K.&#hDI-L9ܤ )|O p@]j|ON	h^@mݰ7r
o4J^*;_|3>0M>vlZmv^k|@:#C2- v^lnlmt*8C]o4j3}L9L)LҾ<F,|t}+a/i?ZeJ]aF~@d헐ދmi}CӡxF;{TѪ?f;]/җ[ov^m}<}/_t?+'^MgS
4YS_я7WJb_tgn.W޻(Vi(yv7knR*6Yڼ݃5(FiW(:ң?4ozW_C{I|3
F!goF	K[,gGCw(oUڸGmA|̊/sV87/7<S]v߰MSoQN)n?;/VGd4TT; m8k;eG$y߃͝<`y+t'U(&/)1xܹ_/1ԙ>c<򘦏{<VJldJ5<ό$vx'	Y!nm~|.?~+?EӻW$];t#߅TZ$n8J+]/(x YF86(ܡx'Qٞ+癏2(|AYf, ^_Nƍ:sxsIj%"d{Ӓd6r{Q䗞缦8mizm\K,2WkDۣH$P$ jLmTϬ}Z2_7?W]kd_uwr*UWd75Mp۵@I5GN'?rd-ik5So7.I_vyk\.eʺ^o8
C7ȢTrqYk"a{>Юh-|(Lzn\[mh_J_zC5OnvяqxT >ẅLxW,Pg]'oՎVڀ\kMbo5/4WGRYԏTOs{taruLu<aNqN_ofa?[z? Hݒ-?t%ۃzI|Jd==7JF ҹ]U"$n'gݾCy3rNK^܋|
Aߗ[%oOIqw<B~]1C(2w\u/v	朸Cpa#}Oh6X3L( <H0`ONYp cÂ|2Jn	(ǁwyj0Ia˜}}}8ӳF8@<ZurRL/`D3_܂[A]AUdf%N٘x!~ V[E)Li'`]lvH
~^c6L'xߓ9q|kʌEjO:^-+Ȭdu:^}g͵9OYz%V6&PwSȊ;1)'^Α`3	ZBU XҚXDӞLMډHQē5(֘\@^;^WhIA0
R9?.t흑a!̹#f	#QK7X>M*;ؘTZm"[T88c orqfPP=SQMC}r9&򵵰\d+;lpѭC([7Կ\ }F>Pirs A^NT8&5O(gY9̍1Fi'	eN81:a}=X7a>'Θ >d>	"}I EمRXR`sFqc~9zTZ!CÚu;Wj sl?+8ړ1USk7
7p1()9R~Z*_,=EX}H[R&?u7_%vy'C%5%KB(>XB]o࿒;KrQsvVRWs/}Kʇ/xVvj5+kVIV_ە:xFIhX3UO2GċaĪ7zuIVK* tu55\(}z3Z[ϧD}	%J!JsmGjVZ֠ުk՛NW5\gV8S}l! gVF둚S_4PhV4fR9'Nmi֠Ur:-.sNBqZ
`- i#'kD'hA9 ҵVړBn'A7[NYN^ykcs ϓzA-)`@Rvz7=4O@(wPx-}4:HQκ\`!QY['܋'[k4t6JgYZ]i=iZ5`h+M(^]Au§'^A]CzA?kOSsOd0jpTYxT޶ֱ/`h_hYxS⦀[ƞ<iȧz	+kHՂF4o5X<yIljI&m&kH7@^5`)QB߶ a}mEhN4W/
iԘmpvP<X|z={Jg)ɠJe])AOelΕDet߶#_ %ĀҳUk2ӋBgiAA/@cKA1{U@aO¼/jZSh?QpgXjopSz`FIż8^8)d%{.5llk\ Ǒe:Puŋ M>W[Vˌ~sn|,i8"^	Jd~o,i_؉S.+\AxxؾU&<Ιڣ򀁸2e}8u697v~S`zNaG}?WfWmrNjy_J3<CNEhVh+E[e9"2eJR]@<
	c
K_AϦ.[bt $f{^~@IeZ>sǣ_nF_O_C*~¿+KiHt+}NHG	i;9c/00wfQ\cV\_P\.)[?0b>L}:[:ut	I}}uCY-ÛsQol1N 'g^gʧMc![YF4}n'MN"hFvQxQ>CW 3]̈́_)ӄ Q
0ƑE7p;r?8	'did9|u{>2̛PW(ϴl#/̨\bO-UTyVF%*լai9Dcfh)'L#izEj֥jM>pbP(̈tuܿBn4;ܳ\416&.)Zp%1Xʈl^`һ{Kɯ	&률tv#+`B3XG(QtqcKƛWZ,%eJJy4')(B'鰿ߗ*ڛcM&xk Qize4"2$ny_C'{CHe"26phlLM[ZwI./	޶?]-c1H{*+BgI2ݒw,c;#d4콼O<.Ia/!-{mx22ڭeX;wEx)-ZDĬ% acvXdY&xgVg8 1[ɋ@>N<=a6'bP/%)zf^1Fpǹ1tuE5͹Tu*`WWww9Hڴ /cux){*;j0Xݤt~E9MN1
ZceJbRDʻJ~z&G!&t-a(e8cP$(LLi򧔟DrLJ3NEyx61},doLl?7ʕH8I<8
erpc_efɲfR?8rȽd,1|^EOcVU3%FzGKbF^2V`tGo旱QS?FVϤ
u9:zAż?ҥC:߼gxMcC0keދRZXCZbSDWl0 Y-Mf`HNr]xAx<X2@};J=?E0ԙ>J	95?w0n^n̍D\KX+S!0 =}_$ǺD8%EHFF'ncnL<A9_K#0jtYJφ*y(UiFYZbQ7+ޚF4-z1kYYHan2Lp4sC
=&[A"8-^*<O%u}vK _2U6?Cqx7֛+$:4qU-ZͫSDYv9 vk%2>g˔rrmo%^ٿ!삦{n ^$]j)(P0	KR3Y=@ nUd+KE@q8X#&0+ [		í&IP'i5Ū11@ދ0Kq(HPd##*|kNb31\~ X	#uA/RFJppzSQn@mJ̭;O!hc24d)s) <@*Q|"TG
kcTyg>ʂY7jץ&)h:QHck.qW`~I4Z }1g'e)HiT|g2]>Jf4T&kC_%^٦Z 0{>3s<pY-pVj-x%MG[KJ/Jk	iN:7TJI|=ie'o3K/=ari
Dt^h1æ>B~g 3l?Q=EǁwX@&E\%LG^ S/b97pc#=V@=I!|?qcvWpQv\]{a+'>s	G}y!@]<>+U_w3݃+$+L!|2@\t3ws<a|ЍzZ/R, (83u\x{q+7O?	]V\)\Hs}BOClYeey	e{ŭ;cF?}i)%V}u:6iX*m-ץ6=ggɌZw9iS{Jw0n胏`Ua>z^`UzgJ\{n;mZ*s5h*A*!?_;m_C>Ks/^)q۬|rX?@w	/z쩗fҀYh6y M`=D&dͦE30?d.<X8Μj*/"TJՐesʀNlIgG3=T2	_8A#l[HB/:ar].	z6AnJ!襨 B_=6"x5.&LfVls^p㩟Q)v0Q߸/$9GLq;wZGc%q鯨׎Z0$XLwRYgðԮ5LުBG6VzYIQ#t͝i	lN_=12mn}@ł`kIum[B+1)lw#Y<R{gYGZ[}$[Tu:g
Π80pl&_%1܎Qs{	:-0#>wuwn_ m$ԽP1@0womϪՕrr_vœj$ΏaOᘝieIy;	m-iEđecyˠ60|˷Ҕ͜SVNV_)g, Yp5ncI,	1n
R`ǜ?>=c10Q犥Lw$A|~b=%81WfL' xA@/]qCNmpvB"V_\FjbAVYHM3[MP#|CP:ʯ(A//wSW& 8aŸ306 up ItRTƩ^tz{n2YC^KJBʦik8.̔3uB9o0]A8f)tްa9h}[[zPkd%4Χᆽ19	r+W~s~U7W(]:>Wdi4+jHwj]	
Whx5FQyE+\\@sWh*S5}y-";`^VYd[ɫPBQHkˬ3Z@Juf`5yhTEelL`IڶiifGxsojFi/?ۧ^ۂ4(}*R]I 5^	/I]_?h*0~:f]ow"rF17_ywkgh-FF;;躃28/unSVp:'פo^G#Owtb~|NYRvF5鍸P-*0 ۏf6)%lM.9YN+	ЮwY(cD2y2gj#|܋
Hj-L?s]O9~>";-N4R+Fff}i-(r$dd4ÄNFYi]fil?)MO	@FB3O30u*{R҈Wb-YŇe2Dp
F"ݰ8~C΅MQ&TI2s	cѨ6(|Znl׼R;fr
*Q,`VZP78j57@POCH6/#0#W:p
Oa&_G(0|ۨobǲHeP/MŁnފ/ue%7$uoZ_ۆ0cVpKG[
tMab<[;c4;IغAwt9 juE>sX}xo%,b~wôVvKV?aX)0*+}gڙ<UaŒ;I`"\g2,;['aSD,ςl|D1mMί5PE+?8'|JXxn9=Cj<r
w@,֭LnVKd>eY(2Е2sZaGfef$cy+LЛ靹]yy+Qy
	jZ(@t$A,eąr".=њ؂ lUce!8Tpp^+&ډ7J?G]0:2ur/P'vFv~PnhAbfs]{i,dtB)-]igYz{DIR^8af*c
$k<Mc.>3R$Y!MU{/q5#Vץ[%k &̢ߗ0i Ҽ9Ҷ<{s"SeDG)Y
"QN3Un,<@;>|zA\<_i6	5ˏuq=#pX&QR+YK~Y}FV%Q3~EIEJRyiKz+l#
YxҺUAE=3_H۾XKڈzzbd
D|s I?Lyֆ$UC%Suh$xVM)w^_+-hzWc(dV/8fAͺzV3ý&LPPqR';ɧfKi5.-m}I-slUPKJ Ԡ.TG	lQm В 746914E<lqbblQjsza-œlG^~X$UR_y+q_s8JxҪٲPW5-_^6+LQ ߹Ϳf..~ ' z 