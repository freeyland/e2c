#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vH(دïHӪh*,Wi/jIk[,$IU:Oga9k9kì<̬5_d""3L ,*d"/qsP}jۥz?NtW{\m5:.zad q|َ?'O?GvIՀouZ񿋇>8g#Yߏ]<4Ge[=+w؟QX|~?z5=Sw4|m >v7iAo6-X<߹$?_C?
l$k=pl~Wɣ|>njuʆsۋ ,p!9Ѡ8?:#`~lѩcw<a'N	sNp!;1Nݐ0#p%tvxxP	lA؁1o/Ftbd#/^J%?_'T[oJ	jn SwpJH" Z`c;֐:*>8uOFЀ7$ax`	*J;GjITثQZʻt㯭-1kw::nKѸwc{:(]&o+FѤgX~_*sK<Z)U@8=O^c1ޞ0@5&"ѰB 5 r݁̌/yAÚTAT9?8=(+/<)ymf[_m߅Zmګ.OK%~cK'#a^1PӔrXjk|jp;-vˮ?W!Oh<?7Gg0Ta}gэXtJCg@0<7<rd[)w2+r%aBZnutK;M[I^fb| $CUvUAPŪlR5MI4&Tw`W-l kd-EUUٚ2h|@X])DDIFl>Q$4S^yier>K$2`@uKJΚz]u2.1ؿ,װ,58cLS%k*{V:g5o:?6=sx7Ipy)8G=*b*[)A
6	 `~e\c_\zb̚`WZJS̵Љ%;		[Vŏe,WvMlmJ%`T=ِ%p}AĞ^Ϋ7ozz]ʹOZ5bjw?low7~bO]l*ò`Ajydv"[竢NUЃʋ-;pzb"h'!pvnM؎zO\X>k':|CaM.^]+f
2u8)%k8{ IE sf!H}M{K*z  lW^'䲶T.wlM{%Z+O+%Sj1s*`tiiƀ /R8S
c-<u#Ƴ<5s{\H nݕdОlD2SCdn1ihQIbT	]\MQbGE-j7P q_шX'qCcXT.>62e'l?iѸ h	,>х`"X8=Lok^&'5VN\IkcbY;8P皮>hqIͫ͝כXP
{)4[&awaD_/_G_ˋ@H=R*aFdgRa%sF^cۋa_!|w<lp:AơWN
'?QsQc[^ nz")oD\`}uFe-
[Yrc֨oXz*XZ$)ϩ`B,~|XlL6;:X9:sbҌkBdf2>v++/^>r7By oJ^Sw^Ӭ
v)of~e.l>aV%{s~?pIN{ӬJUS7gv׳~9xj$r$ܘp%=febdK)ҧN[̚2{קAލѕMN'elNv r Z7f-uEBλ!q[׃qx|X;ڀ9O94ׁM<?)<`0/PEAƨWb@'p̐;wix
˕q[֩3,}/w>ã>&74	6ׇS}D\"ԫoA㚾`ռw~9usEGnQ]Tv*J[/i:Hr|}I6bN[Rf{gαo#[<<as[gx;C$!OzsQKZ|Y3GhUK
˲e߈?{0~RM5vǎ]LhN5BC&Pbբr~TDBU.#ÁNȬ{[%ϻ˗%]|wy/?:|TskX<M)-a.xasLCyXDmcȖ\KóP#vBLلBȹsT4p\²dV[2Z940ԻiZ[:G
\(o#3 F<q]+To06$Z;F9:"iA~<϶
Y9f4S"}6<.Z=Ey~
 TO~S#`HXTCL(KaMY%≰8v$Y4RZ0u*HUjA ȐhN}OJEtԴjA|o1;8/KRe{SO쏆GoR`wiӖ`!`"&=a^4VKI;I-Ri+]5i9\كCTj}y'ynWm6r%|'˝x('|#Saf'Q#:$^1NC,iB
ľIĘNs/F3BܰXڒ2u9U#8M6=|4K;NʸUv|ؗKMJ^-TV02Cl{4-0 '/KMScpuHK@HN ['FJTeh	sm<_4镴lINMI0wI$q	3>ȟd5J2
1k@Ii)cRR`R2\`
?,5,Abh\,y2\kl(R!#,C5JIXF(F+DBZ&r6Hvٖw~4[MCfFMaj2e'^䧔5fO`$G-?S&Ǘo~|o/ܮIf\Zb]iS+/;WT,9moornbiyKcNRi;o9ߎ3v~tRNRs/pٕ;etiE,*˅P,$aU+p^#ë-o+FJW)u}X-b,ȏ<uREHC'g<ʏ YuL¼(*Rlk>}҅)fx8e=gifLE7c!]cx8KaQ"d' VaHE@]~IsIaAYH`6Έd,w2H<jCVnJIO=WqJĆwB!WܣOU@oxt]vX@q3fT	(yWhf"eˑ}ħO՝WW#:0>%R͒~V;+Qd7ko:gm=y268 %u{9UaaGaV-ʓ]~C_]lbÁ}ѬfSz=Ҁyڹ%-[oGQx(|aathUYF*֓թEZդ-kƥ!K߻5elm7lܾ4Rk弇yN 
HF(ٹ;M}0ԇΣNtRUGOQF/nHK˱J<<!>^h>hSCv+dX=n(J-rG͋JrJӠB&,HYHV*t)~&dv0dV%<{FXST~ŭ0X[~+@m^ly]P
Ȣ, [X:0XY2Q)Ft2\YHȑ!$oM&;u0Qhj^1`L1yV&DE@k:	#GxoͨMu?LF1$PWu
gNRh&K&^q%e)҉ٟkE]ɛO/st (g0UqiR-+ZZ̢4byL!ΡD?q8ty揦cED8swemxV+oS@itjGЕp$UUؠ&N|6Sg3qb2=3w$%K9YH~4&ox$=N9	 E,]>_oIqz.if0@SWݦ|2%f(IvI^ްM{ 2:uƙ8WFCAEr3uZ1A)tغ"[|nOJjW&S)lt@a;#(eޕ<-NE6|uDϟ_"JvYχFEBFw>8JCbsqV0T4$.ȁTF9"9d694E+
|J,%faP<~=Cb,m/.Z^/h*fH
%)qL?՘#y~>KH[27f &ZUKBW0%/WT)8яI=r9cyEZktIAyXgɅK|
Hw	-!IGiL#TP3b,B$
$\wI':~,lv7@ \VDEʌ>,Z7k{r: ؽ/{:˲t}5Niiu:wam@-lR 9$Qq<!%)VuxZ*EoEw23~oڙPph<n9]w'CTTvߟۺJ<[CCB%t &W MrFB4RF`=Xw,A>ͰSp8T:&)p5B8G3$}T4E}=(	dCMR"K!J|^C0?Xm)~5QTQ2!J~ĭ~`d)K[QO0U5Sxݑ
#) bG4z.UppUˊ`I*Hir2)aE|IUS &~v3n	1nR5ہ_=rs26NGqኸ6.KN#x"(⭯Y"\1b;SYiAӲ4zXfȜ[[)gNP_}lN}GE 
?
+D;	|14D}fP|gp˃01%PInHԼB%l c?R&W"H 9fP@A	Q('f&Ѐ=!_!GXL17/"J!P̶OMC1u8=bITD[NWYIqM}Ruo`gZ&Svw	4/1=Ҽu ;.V(S=jH4?R9?צl}a<;XSg	@S@yBjlF!?:?Z?NwM+IQm`B)R(U
A(T=N4T>?bZuUAтiV["SK~jORksU|vgG|ŧ+%jռZ1H+t䗶Ғ_KC~1W.^Vd#لlA6/>M%u	|]_%u	|]_lE6"ېMdq)V; F7$	[ߺvkg׌k}h4*hYyYq9/Kr|F֟؁=ƙiY2|%.fyK)t߂hi\HʲĂn赉-f4"sе)krnӍ觼r;F>hg#yG^an^lVhof[%glRgͲ=)}:Dw1@	YS[gz&(^EW.CS*,~ Ye2eZ#(S%F1T7Wz. qSdK	?Ex"\)|򽆩O*Wc4˫ᣞ!]>1B1NH|F9ꆋ{.X}ȥl`oAt+w)UeFgq2a4]k.iOvZXuob$O5SW@o^
2r#=EV'NIW9!j{knjsOԨ"hV_9!bҕn0u-IY	I(K׵A5C.C
~rBni:L5$A3d=/@I(ěLi^AT!Ta-oB)e&Zds5C)xq$aKoBFeNH%G}O0hf3dhIb\fdNGi[}d<$0y5(	C|UpRn\7BC~^^nD"ʱ=UX_ ZTg>zGIx3{OA7wpIcTю(~k#]95gJ?yeNF;Z"g
n2*S5zbAp°v>ݐSn^H3ɼUnG@ΐbh]9#

K$i2ZG#QˆYHV;+'r";Rr\G݅5X5p4CߟD||cB<X^Ϋ240AͰ4F4CE?s{ђjXJpWۛT;@͢V^]ֶ3:oVHfGsE\ 06;C?犠)vl3ʁZ=^`RWj=_#a)̷\~7F;<k
W+5kлdNh11i͚OQ4fU Qhf'|'Cﲛ=2':a&oٴno5C4kYv\/	dU nza+@/e	7/-Ģ94ɋ@\ac;j/oUw5y(س}Jfkv49ӲOz+XV,qSxWnjj3[lvO1SF5\`ޠ[S_<Q1	"Rwl]Hν@
-ˣDk O
93j0ՁgP$(Q2R͹ BޒRvҌ.U\bW q)mF2:ި&#\?#J6p= B&}ɷq\2N`_	Q:k)UO5oeB3k3n+5=K3=[[WRo!JZ4GM';r`wp'w|wh'۬TQ~z~d²`ZRp%(I2ϯ/Β[`n I `βZ${Q7O ~is+is]Ʉ ZE.^pv$voH_ƨG:[~=R~yU^))v{/s?fJn㛽(u)WÚ0&ua&o?Qg,YZ),*Bzgg2/< 	yC8 h,lMEGw2jUJ|2L~7Po~@䎝|O`?y
fk+svq(8
l/!swwY](B3N`gW9Pw}f8˻YG e Fq"4F(Nȟyݧr^c=	#w\p5H6Cޓr\P}`C=Fp>>kMWqC
!wP_,R.@D
CӀL  ]:#ႱDYd_l`DI:N6.0/,ؓg+׎a-}Ֆ	+/*iyiʷ}Q֙MȄw\yVj1Z쿜66S[@?yU&۰/:*C9+7[& 42*s,Azhs@|6{μ7ث~xwa0w¬a~;i%x<3HO<îAr^MQޘ%PX.heA'6SvM hfuHT~Q6)Tտ36V)gL]u}Eb zo]TQH<^'?dcH1V2H*6e(9^59<K]Q(Cm-+Ab.y$=oLXSDS~$7+cRSg{+"ZbͿWqoTH[DE511ɉ؊OIs.)'lT'fN%K0:)++leeY¾a:TTSBڷk,M^`/?UEgzT詤I]-*w[2ڴ~ǽx";p"<
ͩn &L#fXcՂ'NjɔfrSx@ω`FIlIhpM\@7j SWOqW`h1]H-bv$'f?pazTՖ+spb̂XW=HVpO),PUC

0쨘_iVqh6me&ȲM]8N âd'959eݪ95U]wqkjD+8n
';nΰhǹ).ˠTt8p#9ItqP]Z@aᵩ]8)1s~qYK((֪3w }g:TY҅	wSxPrhy<?3>FS?u$^xz<ܷt/UqdgK_xpZLwmG͉/=J)yvAvBuCb27,h*&+Tcȉ+0#,),S&z"?5URNBMR]ReAcߍ3i;mȧr*3)q*ZKrar9MR"֤9AmS(5 =]b?RnᠵVzAi{ک֟eZGZS),LV^:r ;5>q{"P(P!jKnuY~!Pm@n5kU]ML|5/EP%(刅=((	DTRbݦ6@>W&aKUB¢ߕ͂C\>KA08M8r.(TCP0.RW!qGs]f^eRX-Ԫ8\ItN>I_#YkV\Ao^@o1ܜ$zLb세\ZGAVǻ2W 1StxъXƯd%\^ s*)rZHH0$xp;4:BI 0&%E<&h=MTvG},< }y毎7Ք)zMo<#[[YZIRG{WFX-

cp]0})E.1p_w,
=V廾qC2%ˏChzr9<$RpKi^&R|0ˋ{9Q"(kMY,V)]q9`ZN:s}*L^RF9wY
wpCrHQǧcLpIs+&Op?osf)>c,|R_EatbZ3whL7q2|#.k].םN'YX>9Ӏ<[iS,'*Mo-_-f_8";eQ%AbiPkXU{JҾ
ƷcG^On;YsR6|J5n_#,Q~U.EV㎫~/DwK:D7\Yͻ陥,mx⚍<Yަ1f}ܸEsMd<;H2,Ava5,룴ǵٵ܀tnZos`VDr8L3,x):-l\lTүwluᛯ;7a]ڴ֭[̢wa^׍[,K	ܴчPCRwoŊ\ P|my'Tr.mG,IOXvB*[1IKa	77|Qӊtcأ лUͿvqnڎIX^)׍k{[Nm<YLww#ՐoAN0cw!#gC3b*ઢsf:52C]W3tڕrJ#FcGH# 9Bgv~UL WdH]Koȹh{D'On=S!2IQTJKn3/mJuMǎ
=Oa @ś'CL<j?;$FL/6ZN*Ff7*ma3T
J_on^'5Ipb8!.$oOa<V%na<2Yc}Ty~uksuua"݉duu,mLP9%-FZ[W"!劶D6NhPaT}-=$ ZQ{N<ȇf9ʌvlﲜD0T;| ek9bu"5ޭ }.vHEK]ۭ .[̅9iwPˣxj?}U՗8_C@N*BqN$S_beN=13:kB+f^!褪M!&nVbBJNcf΃\}期U͙uJ5s^uɩ)ëM'xSʉ\!H5: Ԡ]Y5x$(&KwF޷GڷMַCҋ3ЦeIQWTB4gԹyÍmZdtVF=':j"35ϾeRKVo{Tؘr5i$oq{yw5dfN|v/eS-0Jmruj{'=y<7ԁGxoz2y9Ug[2`I;b|5Qux[nP9W_yl 7ϟ>/yQ'187׆#Ԑ&Ǔ<NDf=kt4.0Py~ڄ[bEbS`m7gmb[mijzx[ont/-erYZν @m\}gؒ7]"Wj>}[4J5۸nj|J _$;ާFT?H-*߲eS;S;@S('ʦܥoVVVRTЬ#
ëު?KԴҊ`^bXCqYˬZ=i.<36aRF;oNW[ѹ!Tv}{"O2¦ew}T檭%#oDMd0}*z`28cV)73s|]7'aGh%4ZRi(Z\'"x='W31_CÈ6ޚ[fqBލѕ;Ûܡ!!:ykQxe!3YɣF)䫷?:xs/k*%s80I<e=v0fU4Wa{QsgG	W\q%Lͼ`2sEј"!k,a:yOltG( t
/5bD~uU'oL=2*?=$#W&oP7Wjeyx=G
|)Uc2dI Bb+;]a[)8ϤKsdYpZ4c1MfP桦k3iFĉw2敯vq'=v,:<b4B@mCOņ~S,_m_L7賬U6lN9%b0h G@躏J{H 24ǀ,хD}> B)XP>2
IeWxh#BE-!9tyFn53]H<ãɋ0)x&4}L8';Ϯǡ:6\́!v%`D`g0tfMVKP1ύZN
iP\gz'94mL\ȇsہہ^*S^?v`D܅{ƂKjƦ~cȦ?jMUܰs_cI06|ԜhMao%%2Y&	;j*9N'
O"v[4͊ڞ+@O6u3Ma"Oꔞ)@+s;y*W)1QXr9$dF^RFt[{$r$A_+X|eݞwƧ Ҍp7c;Ì5:L \k|sx\c<ހ?k	ۚiw_Zq";_v'nb;HsH@7q@MB8
TYǑ"Zhִj'a6jRصaj5$JE.1d85\Rm2R|DM#h59-N`vIq -4B- dZL9 ۰^"
V	p-	9sFMAg3HFLxj+y#BUxё)>ҙ`viO/C˴lWK3|IZR(畎Afn+OV*>zPFzWR:9)f(,f؅Eu77f+xn:JukuY)="0q33] zWo/f/#g7bk'RV+131AxT~EUa,<Cb]Nlwϣk^VkǴ<*Q#*yS\2*L''=,>ɱS,!]gSgZxC5*e]OS;a*tWFHz
j'J]%{#f	[blI)=ܽkn,}BvhIpd"U"/"褠S kAlۑ.4`rC2#h%>y/PТz^sGOsM26NG }M=f{L{0p&xxg?Og^eLQ|<7@ix,1D|ߡ?*]"Y+WIO G0R^!#)My2;Oؙp_9ډN|-g5vώtijʁc{ga])˶xz.F/V܄ęWS"qеk6P&ν9Nar);;W{bS$D7

#jIڍ%#qXTbxCRcL+W(#{2^'wG%45@@K:Z~zhY[~ɻk>Z9'Uʮ6; Uc`ڝm{! H!"uوܸTӇhRgEK`⋖9ǽyV*]x!;EHg0SSUb|g&+|Ю,iÛP)1u]7}px|Ep1@(Ab岈;/o\121X0Y4d暈dp(0/5Y6;ݴ#ЌJ0 rKTpzWVm<ڛږU$9@-8$i/'u'vЙ2i-{_qHrة	bh_lى)ÂiH~IR#iy<ڬ@ϔ( 0Q@c[\B,\|d|vBTYLَ npXs=2<VUe~VH7I޹9v?kevXU򮵨ְUB7Q]usj}jPZ䆚b
t9`&"#R8TXqWxW5}i_~T'7pV	2v=5b|`dtWQc@M
,<pi_6*<i2/]*\7`p>VK?&<bnm$Qȍyu';Y{֩:jyhsl#AI6 "6{ȞS&Y]$TbӠvQoXK% OP7'<y]g}F.#uĠ,׏wvfFs-n]V.P_AwYXQA B[熤廝\wR(撕2j&p,XZᶈ|s4 2qFag{-ߋsH4=7O.cȉGzZ#x'YW/_T7#r	iћ 28>-A³ǿQa6#_~yAM 6E:j-xYR#k?QN8(7'u[ފė#mKؼDu	sv2f&Eۂ&'}'uCdH8z&Fhvh8=y@'~[(!1^D3>dE}ҷ'{p6g>2bjx 4>~!cx yAk/I`51EICXj"\Iʜg	?+ Kv:kKsC^d,{dZeYO4aViM`Iy֞&ĸr'UE_\`_aԱG)wY	'xҐC@S,@\˗Sq]ecYFm"+bY.y\E=ylkiDԈ( ldb]+mxy0X~5i+Xˆ%CAA<Vk!oz0vlOFiZvNsֹ}P qCN>v|\PG;y:[ocoګUj~Q"utڝVǿq?Ɍ ⏫=n;M|I_w0z~k<F}Tzm3t#!lNm~Gc=tsiB0~_:rC#02:;a#?au":{'ՑR_*mΰAkL
<wxȧbD`6`+{f:t]	ΑÚzA7ѩ!$jKܾfe6S##fm׻4\[I EeE;
0}0үS'vۯ$/ku~ֻ~~5辢X:uű`.cFU)gSb;.42oeAݱunN fm=Ed<ۣ	@	]@`3{B=NK&m>^]o*}p.fW7.+}fok[z[E\ô,%YDŚ?<("7.R}:]CNԷ~|$7Jj_!^}os}e +gƌmI@n{~w7JL*t~xς%Lr!?=A!!?'D/`Jwϥk
x
xhrjoj/kQGN5pFV|UFe.iM]zsN$N7:6ɟQRŪбg!O(RC51R6 	Nm Jg~T@,~`gN_G6kR6m*cv48M*{u21C祻Y_*(87?b0'fyg_ܪvʥ
:d*"OIr?q;$)~
anT5y##HjL9Q@PFtEz< tظ(~͜D7gz"j5:-v~œ?韄==FY
yxй`鵕~ڰl'0>t"ã+~ԏY+.fU۞4yG>Ќ&8)y5 IuM*)(;fŶ_dg-&5[V~Skc#ЊeA˦0헛;[ۛ{[?mX'՛f}.~O(b9O$-1@`h=Y3vۘ[nnAkt;y\'?g$sl>ñ_PO/1ӻ羓z;TvGT{Tj?{_67[/{ĉ[o_o{<N<yo^ok3p~K
4~k4Uޛ7<IW_yӛf/D0rz|iveOzI˦&%IF'[62{;5d:zR0M֖$yov^g" uv94Vo~~I=3?/h_[	07EzhbRnN?U@HIj-`m<Bdl :P' rF}a	z(&mW|.Ey
/
W=?3-Xf`PovQ^g_<:tHB(ܠPmnSj]P{U@ݽ7<Oo0<V!=5J^xW0
6YГ<3u52sye?fh|{܂5t0gE-sh1ƿ(p?׆TmX%0_PLR-I[oP ?{աR9)#A%W7tII^A$;7,؀k6]w4Ϫ>Yv^G*=G 'xHX}e)k7gNjl8/KB쏚#A3 9S	>ip\G7_F5unuo'Ϝ,'fcB~>qR_)//_.hfmB()M~+{f>:r7Xfr*wZ{OCbBW7f	ٰV
 '.|m6ٰ=,i=_|/U*-pڝ;yPymjKix
q~>wL[n e(LckM76Xf@Iބ-fo24ƤDhq$ ?ɫ{ts?:O0ymHnn:yw?+=^Jg4ȖsW~{Z+WgI 5D+9
]e(Aat:(yZ	#o6
8F9[	KshO#臡f<|c7
.OΏmmY:.dg9
;*;`cÉ=pA$ѝ|_FGvzlI@$hƑs:>jne׍)pˑsezE82a@_7/N42A'?3{nfi0Z)L	7-WFcUZf6f^fH?{``¯ߴ?8%z4[͎AUZbֻTWZض6sVQwzR%Yk}uM֘Usl%[˯u[IF%v5:&մ:cjh4Utar$Ut]ﰵ.LwuF`Iw8R!XmQhPC	D>sk*:M!55"EPtiY\AQ?ZSha *oJv^ʉiG=8%ů(SsGr'mx:<kN!F`MxUTic{421sz![/~|ݠX0åƩF@1rtaUTϽ[ϙ]ccec; +,W{2tiȃ ጜ԰n~4XKk+䞈z:@틧+yY?P(&EnP?t%TG+3ig_)/(JӃ5 Dq+F8gx3B4D1@`sL51RŧA剷fQ#,Yk5lR_xbA)tTl_LψX0R!5!?M)Bgl0 b.-*9*9(N^)â]be;&+/wڠvN\*wePʡ>^U]9ۭj^VWkF\#ylWO$>L9%>7eV.uUSONOJ[]+"_DZ[{1'2(oU.AhT[k?ή  UmۣFZjghU-V4VYk]@ۖV1h֭j+7;U܏ԭZiZ:f޲Zjj5׫ժC5eu SCj	j7q(T tm¯5! HWUH4ת#n@nVZofnu
Y@FAWBVBRwvwW[u)*?M.Ra*mHTAVG@۫tڲ6jw۸]]ީ[v(j*koM^l]C0~x_됥QE]KZAkWVe0pV5X	xo.4ޖWp,`l_Yxį.C:
7F-kHnC'46:,Pyuj5u.4^tf[&~_84.ZX6Vց^alHc<A`'ƿ"afs

~IvZmpuP8m(j9~(x1SAˆR5T3e=Eaz"*( Z'ՠ4W+Ϯ
'9ogW3 9<oѫ?&q$̧EkN,]V0sT'Nb:Jb^\|n肽zM
&BH{Z2
yҺ#C#F;
 i#;<-`7--O+Zmӯ}K+S:8<Eu+Kr%Sd٣>BQŢqS۟䇛T>LeC3pMJ)%K?)P	|hkk W\s6*,Ydz=^B+'_fdՅ9LH;[RXzIk>3V6Y(O?H􀲆#Ǚ0ʪr)Nz+wW'Ke.>>T!40@͘w(#q	A")L~6	ZWːt *Ԟ1?2È﯒P'Ahw0$2?Ɍ{=0Vtj$ѩyhTW*t?^48FG	>oyal|3 
2pd)CD~jOCz~AVN>kˑa^A[23p:JG[RCQG7-5TjTyBДF04>c2&h9'#\ǁsEf>pb(,tuҿAi8|g9Đ?J	CXz .phQh{EzIj	0xc#2#yfރ~y&ߊw'KoY/%04]@ i
,a
L])>GrƻW^"ecR}1zfz_D!kh)GDBqFF#hNA}V Q	荹qOPEE%BxG:F[jeC;;>|:JzHmS=;<uL0/W晸3 &1`{շ?zgQbt1G	i~PWw(!Ӥz꜏΀uxH=Gz^	:!iCk2sq@LH̰*ȒKdH/'e1qB~
*(QsW&zH 7r;=c'僪)Kzs˄#U	wPO4#xYnڂ*M5\2~e%cVQ
ry ik.#+/au9){*j[ä̂x<!
{
%1)S'xfl~9;	]DobrR m`BWrA4$FabyU/#ĵ>L$X)u<RRr'u˟edSOqre Nπ	B$ uⷲe%Eݦ /X
fprejU-1eVJe1''0pFAut4<c<k$RWm:jz ^o3OmG;raXX9Wl5,ja)1 yKQ1M6zNr肝;p:V@Cݾpj=Kv6y04>K	p+tgFho]&S;<Aao;Du9v8#Y!aR*)7+S5d)>klTmeqMyqGu4@OX"5l>lwd/2sg3g@8`C)
Ih01]/uTciZ._*'5rk5sj3tjuv7//w_3+Ufy2aɕ'pݜ"P˚c,ZO1@)DOĢ|E̠r>݀)fEY񗢪#h pM
"2`h wQ|"VKC	LVA,Bu	Ӯ
1%tU*mm2	ȸab_RZ	.> dD
5p\I#u7`g(ҧX4e6aD7%ub(.4rwd-عK%DC.Qb^
E.,;~اx5hկM0SlCz@]˛쏩C;`	9xܕ 6l~?6aWdNSXMy!$yӃ<,/I$Fkg(d㳹9^ۼ`</I[DIфj|bk:"ߒ>8s5iYtV)o8-]ΝXzW킕Mɑ#%Њ3*nu}? b96!ѓA0z9O$O`EtUfRDMxP	;q e;aӅ o7US6^5-}Ƶ]%R`F9pN}CX&4;)pz)ԅӣrM/y9mF)J|,-Z| L'UaKOQ>@Hc=kICpWg
|he
4]-F2w$[s9we-!U
D:zJCl7|Y{EOyuqx)7|34(ۀzp&'ʎ˿]p.Bڴ	Ak]3ܫax,o1Vs:AF̑=|n0"D~5XS=ؒљEsw7\B^|=MPEQ:HȮ4}RGuibt5: 6; en{ha/\:\/	 *lęl9-uʹ,Y
-&#+Fzl,j29|$3{*脯)4BscKB)2a\\)z>AǮK!h B^x6qH[t		L6ʈY/s8X|čNGU[( 	oXV팣GIܷn/^V#;s먕1@ED eu:nf4ɯ꩜k^u=ɉut!ꄮK !{FGy	HNz!yP z9&D[s(Ћ('L
Q/,H-EtppJ:!!bpDAMԅ9b4u*J`,]-Ͷ]@ b?P F$(*Ǉk4G9Ֆ+9znvDS;?~`_<`?SvjVM%U	Tٞ#T↲5{hВAk
ʫ-a4ڽr	#\LcSrưV@b>L#CI!		`'?9zq	<UCqՉTɂؖ'	~+;]$x~~b|g,F:K
@ t09^xga{S§ҩ3B8%c#V@l
Y\d`EF,ztSPz*W^♟C5p'o `;L#qq[~p]֞3qrq#lR\*w"5'By_('%%JB;3J]O~/K霂O/r@<a*p"SM8sa?7W%k섩)C'Xg:D.葍ԋFq~ c8/g|ݺo4/Qֺ3t!(oB\h.G'ԋ.E1}qp)K5_z!Z(%).Qؿ.LsOa>eqf#\u
EY ɬ\t-4
an4DgMW,Wc.-Ϝ<.Z_FY/ e`k{%WyZ*	Ƴ'R'?MnԎ]L"O֣cbV::mu:N#@{w`_ae{/;[ͷ`sg>jT|T궸. _(oYƲwtG>{P D<:"MS1L6cTG^04e_?969xXQ`1C0l[<8+z3-==clȒ6@Bɐ`Ĳ쉫|"P'8=K(aG8.{ǶV:짃]J+Zoġ<zvf߅D(P{ |$#$D%jf:&]0T:l.*U0")~}t	d$'d/z˰$LL/JOl
^ ]@R:&U1=7Lj	vy'v9k'&n&a"5պE.뭡m5ӌuXʮY-s^E6ʕTSE¹qDHڿg5;@{BȦvw4[:4-imtZpRD%dUSni8N*E͌$7mS؁w_XjЙ?=scռ|'ϻ}Ipa5I<?~?on^d<OZϾ(d'FX^ JwBKo crl,mx)y~|iΟWoFhy7?aJmmp5%KKwA@qb0*mdWDs:}(e`Cڧj TRM$v}<k%~QHV!@P+HJx-4`;a}b;˦+5=v@B2֍\wpQx?]%?ޗKpg¥ڣ;o?s~'F[ZG\gGo=7JFRzK5/T-QGS$	;k侀,aȰ'?@
@w-ϕ&9QD>NE* ^]^=HiTwmmP=B--{fJM{
Z;6~Ŗ/v(XOu;ӧ#˖M5
Z	`({UH-ªQl8fh-myrlGdF)N;>oĝ"6t35߮j?Ҙ.hLE7",5 {+݈XuY/Ebj˸(1vXJGȫBQ58~b\mt)e"y"7X?Okj#"^h\7@+| -iw>YHj.b#y^]1JkIyoUZGxPAtU<
PRrRvNvgo@/?4" W@>yObE3ֱfSP)ODrԥ4 
lWhJt?Hqc00ցB..{zVVqksGL2Wc:2s:\{:Orr{gq}셴э]?hoN9Wp0;tb{q'6<z_טs_|CaoT| f 