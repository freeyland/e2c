#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Mage2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Mage2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Mage2click toolset. Reinstall?"
        else
            message="Mage2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Mage2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 `] rH(د_JLI@ޓ)UŢ*N&5Y`&H	dHR,c>cv^`vkK# y!)xxxxxxxۣF/{jvoCF՛v}Xm_.&Q q,HɎ#ڑN.?_VIYo?#Q]\GJ7۵{'o5]\à|A	`oxc//CטW[N.>OZAR^o"_m6j_; ^4q_JlߏFNWuo\Z_Ӛ5k;6]\1&l1;w	2`qB3"/Xa!;vƱ0/Xgn0ԋ((W"eG08<Ϯ$\%?x%5&C't\Y~v6>:f!NL]wͦ-7@?%$z -Aw.s5b׆.s?9P4* ݈̎r!׹{KnUUޤmvXǬnl7:z~5p0b7|]|FQCMS|(1>ۘ
_qe卵Zڀh/t~l>SQV	kŻcgJ#;FBjl0L/_":fnoø,R~t/r	ǡwQR^ݝ2:jK08N~9i`֯l3Bd9+&jӀY.+֚ zcbnG0,q4b~r>q~0x@F|DK^4p4[!CΜNHݕrnYe˕ljwD׏\'ky:ثCEAVfbϼ $,ME6AmSŊlP1*A4kwyMjl kdM*IE6&ٜ2|@X.Dƽqzl>S$$Snyie|>K$2`@uKJʪmYhZKXf_},W1/U8Ld29͞WY՟uC]ތ낄if\^YW 	~-% 
3W},Xx'~I~}I^j4c1kM;ߵt2"!& kxɑKvc/ۍzy&m`ׄJX-'y30d>0f/ni{jgA`wN&zzvǃ]-1z?[Υ?~.	6aYmyr"(kP[ydnW]ܿ8@$b.X΍ 9q'fq |lvv7zuU)H<αbvQ%̙3 u6]kÜϿ\a"x	]V/+nw_7YI{qh}|=ԯDoc\.U+A$ a)+_r$d='Lą) u>S8;1LK%oWB}@}+D>e%@gE	Ҥ2 `urxi{c'>]6D$އFǢn=w4[Ԉ"Q0/\.}ͽ7j+J,}_ALߊ
~!~0p5PgT9XU?|7#iC9FVkBU@+z[/'⋷7wl޾}A9*9Pm)eыKߚx&pt2O^0"j,F$K&PR.g8/i	ڇ+>a O|-"M(Rf8iF*	@ `*eK$O/E
r$Wa\֒%=f
Y<RIDx*Eȫ
H$r'؋O1+H7`6ǆq8GgWB̴o4cܫY(ʯ9鋮7 `\z4-OEa?*`݂eVN9//lg;
׌ͽ7;?*d[Ei|sfHE-R9t@@Bp.ˢdìLԼ𱛮)P6eD+xZLYA*3H8p ̐ZkXHys4ر 89.Z0NoP0d8-3 j @(盁G,>;
\"U Rs7tYO܁]άGj_\OeCwr38RA"Fzw(Cz>#,gbJlȗ-J៧8/Νʢ&Kv)dQYȺtjrkR^J̟n{OSꌳ)v7dooW"q0gDs,#^XcQ0 /}CE#kҁ9p²"e/f^|LTekc7Z*>~a'z㥧:dȤrb޹v0J,֞v1VΕF(J_e8W7o|Cw>iwnz7,-G/wlguy*\XiHi+lnp:4eN$a7lɵ4<8I0b)ʴM89w۟.n]rSlTKX-ڿ7PKG;THAW-mt䶱kxĈ{ޱtF цdg+Q>`(bFWC_$-HoZ!)gvF^0e+;k#{i
7/o~7@O~U#iʌ߳dP2K$a+tXxi8a
( UԂ@H5)t|!x^2sY?+Ma/:+tmG{s9ɄA^gM|>1H&[xIZ-Jkf,%ilcHg*w,|?`C@vI)©*^fu(xMx!N֫d(	Ʈ"c%$^0.4TE!ab]$b́rڸCDmo?n;vmIٚYӴsM3ˬ+N$UV|ؖKHOJQ)ƔW02)Gkg8,̝0f#'.KM3cbuHK@HnK'J-2RlZcy+3҉a-iɸT<nUI1wI$q	#~85Jr
2k@h)`RR`R2\`
?,Ջ3,Ab\LE2\c;|i+R!;+C5IIטG/(FK+:DBZ
e6HvYHwv4YMW@ٹfFIaj4Te'^䧌M`${P_Wo|UlyLܞKKfZiQ+/:WTLu_oVsab*8eScAԗh:V.v~tR3c/p/X'+etiEL*˅RW,$QU>(p^#ǫh+T5#ko3)$
~ľp]![XUydf!H7vkߵB Yt;pQQç(*2l'k>}҅)f;e<gnf\A87c!]xu?KQ"`u'RH[E@YAIsH?֑m䔭q,]0`$.c[$ۯ؈[uE:v`R`ەhe鳼M~4/N!J;Ƀ}UR*̂L$l9v@yquHa/QDZNNJrTTK	zj)o5W"nVr%ϞHۺ,velq@r!KjrTUfaGa'GV-<%~C__lbÆ؀cohVs5G)iܼm\͒"	(DNS(|actmhUYɏF*٩EP[d-i#?É7elm6ltܹ4Qk|yN!< 2HF(ٹ7a|l0Ƈƣ&|Odl(#j/"|_@%X%~AΎnE[y\/44鮡+C=n(J;r˗J
7J~ӠB&Y,HYH^*+t)~!dv0f%{FDUtET~ŭd3yȉVN>r{B~+ ܞ
Gad5r 7]Ȱ0L=ȦSBBwĮ<Y$yGelҸ5٩iODUs҆b҈1t&Gu#
/"S3jUef Ńɨ1
j;lQ`PS+Zkt:&Uc4k/)ΨNtuO]X+,J䄹_8s^m@9SjY95O,J#FD1j~`8LC9}7C?gp2RO3w`*qWJNHQn3^݁^;A| JS'k&) -;Bnw3Q\qފ6HR̝=BrnNd-2"ʤ[/,FBLvuvx}y^c$)&h]4smRarie;ݤM+#PGYzKReO4dX(/nYh3-2M+pM-$T/NlH8(3LX %^}ge$OKS:jn#rtF֋d@@} deRnX]xs6:K+t0	@wxN]2B$y94I+L,H$faP<~=Aj,m/'cH.jAϑj>*fH3%)v1{"}dj)7% L(7ԪZ	G-!3x+`dqяܘhGʤF 6:$kՠQNLV<W"S5[¥Fdx~廄MWa@LKCQPZ	u	%HT1jeS`$ԄΓ Ŀ?Gv:~ Fw
Zk=O.,eF?-S˛wr: }z~qtejii\0MFs6pho9$QyQ4s^)UiZ"EEw13~nRx4v9['ML^U~ݟۺJ[CL&p Ǌ7E804h0!FY܊3ښaFp}&uLRq7k;̉pP=w@41tiR3z0'I5Ix(mD({%njGg2ۦzDQF	Q[$N#EXv]zloYS?&1;	( /)P9ҝQRNF\'Gl1HF/
NnjIL
"i_Y!M័P&%4,Oj[#I]L*oBv'"vsޯ&©()^WYwÏ <d	E}oYhӚOoiǣYcRдMAb=/sdN­B楇s;R[`=ra8EkxEEx@柄PHTw>> LERR!5/Fj	+(X~7
ȃp=TP~;
.I6	4ED #A($v's!PܲOM" u4|ITDכNg73횴A%~߈/4'*NR^n^[cy)B"JAv<Lφ!prIB|_)S`N5% X 	=JvOO4OO~pWVZ*EKZhI-i0Q,lzi(?4Orj@&@k	AҰ"SSwj OQkwUvo[į%JռXItӑ7myӒ7MyӐ7uyc.~]|Jd
Y )_JIk&Ik&	kEV"UdI)V: nqzzrG71ZruVrL'I
@h$5IIIzQZfN]AU3r	L˒A{%-=NJM,KLZ$^8ђXʔJd
:6eM¡!m2Ge'|hGmBqѨ[5q[Wji?3ԛ|˂ٯldJy.5!9khL䅑RKW:c5Qe!D^ L,Q@2,阊*DӫZ-)KKyӝKthܑKYOB.{MmW&We4+*3ᣮz!]^	d1NH|D9ꂋ/X{ĥl`oAt+w)5-,J3Yd/4sixw`^a!}<cTaBwJ/^{uK+ĒܛvɖJ/>QgwJW[\fE=RRYarHLKHW^J +f&$,N/kԽ'0]TlZt7ל2{JHB5̑EV ioBz2|-(	*- 2GD![ބ$2ܛkENyOTia%QfHC:đ-	yӗE*{JF6#=5'FNf2zSOnwfҢGO@ך0ķQW͍1WZ(U7cXHpao<Kû-zO$xv<VWހV;o{I\$ţ OW]pieTѶnZx?F>>{QsjϹ;Fh'JP	xpʼu=(gD)IĹ&w\1dTj;łlޅa|{;:&hݘ81㙋f&y7k.к$v?lId*%F*/ 1wG4%s?:08wÕZjB7vooluOnW5ZAC7 1qlϧ7!h*Cc9i>Sc:4&SdಿHgnm[RMKeN,Ws{aGѷLQd'}seKer:"ל3p,"@s+i۝rEP+j)Vl#8*Z^2Gl/#Q)~,\q/F;<k
Hf+5iлdnh>2i͚OQ4L/jQ`9J֙EkeLLkeպ1h'1q"t:`f&xpQՃZr]d~~x.LzNT,SM8Nď8sϩ<ff5yxYRO<I}з^ʫd昹f7lNS/q?-OŒy77p:lTef3Jq]ln4_9eI8s+?oI_@gSQB?uRhY'_ PRQ.PڟDq0ADIHUh>6̆j?%ed]4}9$ Rnٌet$Q'GtOcJwO|'}ɷq\rN`_
Q:k)S;}k8Z-mf+q迂thӯB愔kER}e&͡14Ď\Xݹ	;?:)6/%eT" ,X{jcR.`$):e$(b7ʟ3E%(eH#̒BzW
tWUg<& J1$
UB	"'l:Wiϯz/66߾*ʅ1ro;Qt\|%:$#[X5f03+;{JvTspVfrn௦eˠW 3`geiu336C? *9^|U &U_(ɷmɜ!Fz߾)pgy..ɵ96?ָU caeOsvY](" 3N`PPwbf8ǻ1AG_B5ChPa0'Zw~м*&^ѽ
|;U$(9%Tw	.zP՞b4לK]&q<Sh*1)2i(LB2V D4
F&7pb 
Lkwix1gƶ (zsy}1Qr{HK6_a/VGYgr`r7#Z)tOİ,qzD/*2]P%|']QJY~^% A}PPicH_knHsff4o0X:aXowX]s[2'Tw 
o(m(y'|}jf	-*Is)[f5Hz4lR(F02V)LMe}I`z*4(ɷ?6X-O`F1!ocڑY`CTmJ΃/|JBOh)
d5mP4Z/KTh*Χ]Hz`;ft$*>?c#\Sj]qR+n~G2
k$
j,b;%2yƩ	َ:ik1V2ԨLr&1*a|mLVVʒz}H5V$멤TׂR*2#d
|dsJqPIL[(UV.lɸ>7|Xl
"O@K+<1e0gU0 O)4-JŸ#'mA}A%!jϖ9g$EA*}5ɾڔ4%;T̈́hz8Ed.dՀ'zB{}Ζ2mp6 S>誊`ʠ`ŗOU~ٸIA_x:-fͲqs~AyֶTC}C@#,^0gV5'gsӯ`ȷS6fF<BG%/7'X(kekEs4;sӫ#q|qP\ǧ@POoqk5Yc6=㐙)5|0edpVμ1~PeJ*D݅w!NY*rSxYd{-tfxq.̱ß?gH΃p҇?0bHԐ؎p\qS{RB쒴)1L& JP UMV'fC׉0^eyQZJQx^XMx"=UQJ(?PJ:}ZMa1ުwDZq\<\!}
]}}fN3gPkiJecVL=m]=SVrb&q2QϨbvy6e˸,jdN'	^y'B ƹT=kp}5lSj.xlEeܰgM{53!"AK♤qRWKu
\ ]֌H%͞ѭFE?r8FapCr	\PN`\L;_(C`;:0W1 3ʰQsF Yq>8oS47*&{ ~\dn®c30Xr49Cq:(j0tiGY\Ǥ}#D&?\v'suLv(j,ӵXX{RfbGI#g8$$5\~R|%ajS)KRz Bp8TRK*FVNM$lɢJv'jT*a`jK/%+ӓGTSN
\z	=\.IDRc)<x"mfk.CbrRIyXHR3*U X4SB5MWi{^.$eŝ)ܒӴI Ax}5Lgni*&wp[<n:fͽ^+2_NEacZ㳰kL\~29o#.kl]!םNY~X^À<[SL'*MoM_i5_8"9%Q%AiPi󳘖UH{H沲^ƯmG(nc KR6bJ5n_#<QzU.EV.~/DwK:D7\YM陥<m⚍"_yަ1fuܸ-*sMd<*;H2L9A~b5̗[뽴ǵ܀twnSosaTt8LL_)9+l\Wn/7wnú0ri.6[ֻIsb2.eҹ-FYחRi-7eL[O my?'T
m,LIXvB*[1IKa)77z;|SՊscl7 gD[|V{ݴT{r]w`i=	di.ޠ@%͋!/YK+QFoY0FB:Gf<-l8*!Ufs+MU_J9##dT3?,&S\9zO2de7m4KE=SjƷO֐K$'(*ehę28B߰o @ū]L8j;3$ҎF 6ZN&}Nf'*ia3L
J_olZ'3ih9!*$oeadV9n$a<2Yc1}lＸbx\]>y]]-3aY7Ti^Z}5ƕHgo!7eg_j/	j?rωy,'GM]jgSdBC9{-8#* 3A͎Anp7!CԵ
Bzwɯx%<NVwg:l_x}9Dm.RA'+*.۝&k	b:fo+tb	V<%-"E\CLO:6XA$RAkX,W
*3m<6r,`@}l,SKFLAI%m^]`h2ƓRnO$o.F(ivhPNq̯&%%EI6|^3=Ҿm^6-KCNԩ?5΅.\e"KתWy~TkP)K&eIS+X&1U^_iCs͸!Y4Vٟ+y,x=Eq
L9Rzpo:~NO	=(u1rS|gXv
_+gMT;nVny/9d>m P>3|'xO96c^ԉ{΍AwhnafFŪ5ƾ)0ϦQf#W2Tj5֏Xؔ7Xu<?Y vZ
'T[X-K+\|P70Wl`+U-y%Ս.x65%ʯzWPb]=au$*OղRGT/S7K++ufT*h6|voUy˥}jֈkiE0S笮8,GeVQ4Cqb0i#[%'ѭx^yF>Jl{"`<¦<ew}T#rKƪ]#2n`{LepάRh5.fx&BR/t֝n!OdJMY웵r<v.Q8\OȋD1{N|bm5A&x+o7#ϗ@CAB5H?,ю&M:Bg!\	כG?Qd
={uvn޸U AyKlI*6p`B{vd{Ǔ!ġ̪h+)2 NRBiKW'C@͝a&\mSxƕ04]h}F}o̊܆|zs K,"1|r?vНWeq|l	>j>EoquU'oLYG]0*?94!Wo5ޠt+CoT+\7py-)- GIySޗ19Bǫ<Ƅge$)H Bp6%\?tInZ8qx87I 
M?E=NI3]r,/մxm[jBy7Y8tc{e.O16ءbC?)ʯ:o[
6Є~M'H1l[I4O^6;FR/ G1 	w5}t!l*EAKt{Bb̵頤	7~D$"ߡ.1ȭfixx4y?ÚM9E΄~"QxjM^JcbnWB4vb	Id5	3M繉[<u{Odo2
VLoCx=6@>H,EH|t7N02qK-fK\*gLz|l8
lŝ#6B]ƒa$xCSnEa/Y%2Y.	;j*9ξDaO5׿<V4mf:7j<]CzKiкJh}+$|L^#2b4##nҴRýH_206{)h'fS9f4X#PFo`L)_*u~aL7 ODnBchr;oAkk7S)qdЅ\Pj$8$HJWI
Ѭ5ovkZcZ(kj5)߆VCڿVC@"y2L}z)BO6x)Fђpgc&֑4T񘜖NDB74qtQtFu &Z\> ۰^"Φ&\6nC>{y6(e܉QHF#S&ѥ;ҙ\F_ǗY;[Y%/F.dƵQ(q/ʝpV*D<yT
et{q3PX(8ˋJozSV\eՔjX)="Ҳ0I;3~[ 4^sX_LoO?C	{oNcWbc(Xx.7Gu;EލZ>9[-Sg0xsDϠr0`ImU<T2nhtyZg#_NykDՏ/j.3wddcg=1NlonO5FGn5 KȴEG<xcI)F]\kn,}FvhIqd"U"F92IA Flۑ.S
 qdiJJ&}n)/em>E@Bvy=51wK$g8}Y<}6ƱN\%+u~r)f۟lMPp'(>l9ސO{
p$:	_g,~s߿},uK8 'i+8_qyKIO'̋wjċO'Gx`Z0@=PдO(uijʁc=ga]ӶF/V܄ĝO"sTwԡKzsšQr?ħls^>5)Ca; V#Nn$u4×LZc~W|rq9v;J)D^\	rlt;hY[~ɳko<Z9Rgyê]gyOVc`ڙms! H!"qو*8yDӇhR;gE{-qŏ)TXrWU(/CW\]`gܙgN$+PMf"]uuWYڇ'fSb? OInbVU&PTX6Ve͏wQڤ`>$b0-`泪iZkO,KQ6a]P:k9`m;YWGؠ0`A(}?
9 O诬\}H܍}9nXE(߂]wr\wDQ)=ղ'ij$O:.(E2,搊W(#[ǍM2x.4E To!:a\Og/Dө8kGϦ~@߳JgnAuSK2{9,*yZkX*JhXE9Ti(+rC=aenf)qY\*,O7%kݾIOO.a8dj)]AF77+xmu<d}\,^|j)µ1~H)'mua35/>$
1l`]^2ˑ>t7{RG\-mm<(ɔD$fЄ}꼉k5Fj	4裤]h] RIk.Ǩ}xF<.>LqbPXl${Q+j.^(`;<(nU{!-r+};j
?
sa5E8e,p[DC9wEnGr#Va09$t+'1v+L=qpfgج/ʛ/9XMH$wn0.[tg l*Qk	/_?O?|sG:KrܜT&KVL/%>)n[hIKT*0a'a7gfB[%hw27ĳOWW9G5-c+7ĳnr?!K4\OV'=g<ac- :{QD{xO-H}+q:h^0`uCQDRԹ12Yq
ȒΚ겮P5),rmy%x<y :UZ=hC;)moZd~'.#<zX=ua|]Vce<PYHOJp +(1c:B,<FjQOZ*Q{$G%!- bi5XVI=q^",0932EaAeCա nՠfr?^`ԢtUVmF-+.VoۍfjYnڷJj@9L},HɎ#ڑN.똳[jkuڹX_yn:~͕> $}Zc V?~ԠWX r{RCy.	;u1mpUta&uIP}SvE#:eXJ`2DE#=?RFJWqfxpHK/&mIUlCN>5gh	Α ϽKV' qZ+b'm?w. '6Z`ՔHI[u&@ L9vBB/ Se3RBN뵖4%лnhq0cX͕"TyôT,eT9S[]֮7^djZ?.vkA3h7r\ː٩$=K'!|:'LᜧPrg8݁5ـ73M`x7LҹŭIkA݀;K݋iuQ/i_~֟DDHin,"8lJFT V`Dm '9q/?%/O_v4ʶ1cwRo,Z:hw`
dN t7mވhƷeQKhP$E$nl}^3:̮*qPolTSyj($EXؤIo3gqE&I\G}>Pk<JQqԗ>HOv0Lq6whdDvktkp/&)(hIf2vӴ >|N^G^=LSdy^3-o4GFQkv+7vTQ7PLBE0#I.t_a0f-%[,vAqZFaZbjQ$(|OoK9B(4O d$O4p3YpuMכf_k]\_i$=\SnLt[7oZ6t{1tQ=}o~yOVݮ^2x	dM A#q08Jnc<SZq`GBˌܗ0pvNGh놹SƤOkwJJZ}Uk4kb@:'C12- _mloomau5OLp2&'7\@8SCNr<^ǨÃw?ۭco6lW:{+u%|,d!W]
yyrgorCp̧mUw'#3oQDvXo4nm>zf˃vWNq{?GM1?إo'h|F@>%`?}{O6w{??ve_T\_vm24=դߦ9IFqj7<{;/kvM{/vm-:Ӳ=};Uk|F~>u͔a4m%L_zNi|s
BOV3	,o̟Gi<Nd)&QnX_e ͊/sV8כ|).Ei
/
oX{f[NFkmUwq39~>Z㑢n)RS踟Qө5+ك;@i}բ
:ǉlmȋ{[~,P,ˍ*a68fɞR$9zKr̾ռُJⅻB=j΋7/w~r{7nm@?"	=R- harNddy.?|E&7$ɒ$kA?Ge3vp#ge`#2'MiYް`vxx"D3cxTR[@l7ړ\3?q&rά\%8~X5"ӜQS[$(mGׁ7f6*Vr>-\3'_^k?0*νN9Yr;
U]נrvLkLDCPEooCȋG`
eZ[f5ˮ_PU!rͫPKXYmi?r|H:,Uj\\owVhXĞOfh/h)r	Kjsijn+5\,lftj{;
aϋqx>L)14~&&ޓ7r`Xbm@IրMbէi/4WKR[z駫i/۬c㩏zۭv3A?]o\gֳ;rw^Zke)|{4rxlgUFɈ[>s$Q-{;pQ	#o6Њz9_GrRp̨l|8CɸJ/F^^$@ػ082w_u.v1f;#oxFDc>ͧA$?'v.zѿani4Ƒ{ >gJneɇ?pǡ{yjˣ Qʬ}}|8u]rG,Zu|\L/&pL3Fg'?Oin-[?.*2GiI#/3$OeVU0koP8^voFiˀDϏ*kaBlc6}_-*`s8VEjaud\_cNgo;ki~<Xq3_o$zݠVgrִNcFiVulmY_w5L9ӐP믯y/[5( "ُ"tjjW5D"WhjczzhMV)HCʕӉcJ6)&aɝilnm<KY:vr5ӴbO,9áNժզi;O
r\z.>lhoO-`JȔ@{
5٥<66rB->½}:qIgfuerGWK-(2ϨX5 D>j_|=_A/d4$ˊ1
Ǵf\7"pNe4s#AFmVg	~J E<`_ Q
7iea>ųΙ ?d)"}q مRXR=uߏ0[sB,5k6P^a\/<LFjOtTͬ_̎D0ݡ	2#gU!?MBxg?b,S#*=*)(^)ä]bx@2zY.;3uP='|^.cg"uu=s`00|hlנ[~lٰ4gVi6[[Z_vc g<Ynk/j21Y栈x<_YXfZ lanu^+"_D鳛Z[{9%2KL(ovڏcjڭZkXo٭mmi5]_e5ju 1NK>Wf1h֭U{둚U_Yj4lڪX;5YV5, %:5b6`- Vi#UF  jˆDc^]_"V}	4ֲMjZnkas zɠk4h@
T/5uXA : Ea;rւҽFO	 >V-hh{i	l4jvgY[U_oۭfU
vNnBa|}l@b} jʅ>CFvF~VSs2Zk8 V[Eo˫kfh4/a7ԁ)`AV|ךvVѠנc#:Rwװ;Pɺn6kY[[O5mtZXXJ5W:XOw6X[$lNA_au8UO2UuӺώh|>%T@a+EC1<()<s#&QZ4ٷm@Y1i,<N]}vQ48)(5:h~)(^8|'05)t)/e`}e_8pSOd8uJ%Kż8~0xn肽zM
BH{V2
yںE?Gd_-x)?۝N[;>?rR	CX2+!D2̡v XZо%A)89>\YU+'x
̍<tyl8\teBn>:cs$&8]&S'C~=v1JM)sWs\IF#ȩHmwsYȸ2vk<PW*HS3!alIa%;-lX1,{g ){8?h 1?J]w`ĉWe8w4,-3_K-P)_Ґ47co48{8bNfV\_-ëPT8mq2y>p.:iGKL!,ϖM987";tX!&1ЌLT$}n'xei8Q6X#~oyal||MH2I; 
%pt)]D>m6FKe!`JfA嫛aޔEyfUfd/Ku-R%j$γ 2,V3RI/:0EO?a$449*U.~VNdTᜌG̅&@aFErs<']D0i#7`r¡zW/z^q/e#P{y-0t*Ip.ehVbppShf	(W ejN1NxȨ74޼d).+Tf{,C9;4)FMbB<`Uޑބ[J)uYD^^*(;Es,a-odYݥf%Ҿ9CoPz7R )5TFWNx	w<7vGcd8lｾz{.FȰ2FA)mRV~rĻ;"Gti-JNIZPƒ\\0Ҁ13
C7YN"+RIYnO3q&%jwD_	 Ʈ˞tglggbP/e)Woy>scj2ᎳPj/+,ZPeD֯e?~*JFN;/$mN{`%L. |=cdG-˲QL>='Tc5vQQ$"e/qȬA-ߠ7>,O2#o.HЕI_ *\P01="ZK~&far`Vs*ʋۗt䱬fbaկTDI9ءQ(;NO0*3[V5]mz~	Ce`flѺ(Wff%\S* $k?_c0tIZ
;z[O(LΑfslcTP
SaŻC?Y$}穝;tڋ^rYÂ+ o$/0jɇԣLr[(eE1n"&8 0he<]Pg(% s#Нy~;!?MvpϧNt*R3Yv
Q'!-o"9%%r	(1+pD2;v.;w"1eU 
9R3N=VI LG9Pqc%%.[шv[=aV԰m9s.͜ᐂuIV-#DQ1zwo6c'>ݹ.\~)U@WXkKgh0
ln`ٍ7v0+.Ty2n)'ڰ]"P͚c̑j0@ɰDOĢE̠޽݀!fžY񗡪)" %4Y=@ (*DT2ƭ"(,!AMBu]Mӟj*A8nVOFRn##F'Jpa'V%J5k7D>'ҥa,0MCq;#K-1'WtRBfTX(r/Ff^>'+ǬѸ]+8`L=t7SwcgѸ+,}X~u̬-Ȝ"=Rś
85DH$:a>yLYgq_Sx]{?Hȝ5{'c*[U?歶ņyO5pi4Mu'6~8=-{1^6ung_M׹K/=efi
dC#sF_f&FaI?>''0#z*7(qbF0v}(~9rܨ@e`ɬo5-L#Pމk"K4sr:!X4pErm-ZLAuJ6ha> g:swX&oqgxJDDB7YLx:DWE3S'!j1yn(rҟ˅+(sy``@P 2ӫ=ĆyU_yG^T^OP^ܸC:9C/џgJ3ͬ8[MTyMP.\֥<=NgEpNƨHsEW=ȯ
AwK0;3zgQx;|}w]M;נP_BATQ॰g'BYJ~(.u?ܰJ ;̭a -<+m^Ke;@6e85g`,9P]Q sd$uTΠ"MTYf:xϖDfT>7>A%U=Cy2hn,IB(Vf +eA/&hu)DYZC3nF)[Մz&ieȬW,9wŧ#vʢ-/Hp7sIz#S 9A	_Q`~=fH(|NGɬ]2y	VPדXgL7ej2D5wY@=dtY@wh *[+'HzkӚuZΘ)Mas>oKq0*aȫo1CSq4`#Mbt57<T^p eolagn* +h4"Aqfz6:|m1i\)ЃpîxUMW$1B)Sխ0,	tp"O`f{P~;ET/A@>/⛖jSPnwYQgh6-op݄kizbV
H{\cDu(1dR??X5'?аx"?!7PlNNդJd=Ŷ;MS P=ce2J) D~Zx!M|v3Jp|sᄌzr=91f!54n)AvYAVd$#j4:N<_AvϙG-8℅ۼ=o S]ņ٤2GUYU늺 '{*,*
L]Sp(u>5R]<-eS
z^.;}T
4O4E$3\ 5:B^%
pyE^4ܰ7W1a P^`popLƓeK>BV U%0KrptyNRBD]?](J^2K=rD?i_a~ ɬH᳗Q;*TPBJKJyyJ|1vpJt|5IO=-P/l}	Ok	LK^~
6OgRQj*T j<K2*%2TKBS?$"0}	?Љoݮ;mz{mða{]gx\Df/ug"(zfi֚0W;/wrM&+²suG>{QAxvEaW?gbl(	ahʀ1~t si$u"<e̴bLY]$#sm!ňe9cOy|";8]G*a͒'8/^sǎVǃ]zVHBiDV;@I0_ ؝vC/RksVi>i$CLE/#9- C~#^$idzVbUǃ"2A60:0YG:pNP<$Fî	l1Q*&^1͘]2gU$TiHx%pnq6YDh5!޳!БCq2sEfu2Oeni:˪onY8~F*oEŌz7uS؆W?03zjqNˇ#.kZk%G >3/<[Ў'N-~?<<{cy"d/F{s0u(mT<|mίWoi7BZozww`HmmpH˒%Z+R?e8,m;z?ť2q{xP-GERI1o:X!`u,}A!Y8#V?,X?	I v.N?tYN{ qmu!+`oz>|(;Ku%-v߆ap}79O67z@^͍|>Y RSsZhq8&x,I_	^kD1"Ú4o2;OWl15n_0|zw'zg}|˂v&NŔQB HFEh܋es^GQ{RxRsߘIA$7AW-AۃH}X=Z#~wmMtYBkj
J2b<t~g:r#se^{3tSZP_OyEXRHB4єD*@EHPa}ZyCBfcY7?k=jE.6ҋgmDJ؊?JtB<mtkM$O~B@ M0-2 )'½FADwUjP%Uwn-r&e	*!PD擢DAz*nu=Ǌ:T mU` Mٶ/})Q߽9;[=f	%̽E %D?Iu#1T5"l@`H=1ነz='Z[G8	H6!/%M^`C,7@v!qe%̦n/~z\v׽{hjEGcDW/ɖmɁjZnrkRԤ݅B d 