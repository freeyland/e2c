#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res res_count \
        error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8_JL',XUiݚzFd V& IDggck{}5ۯ/Yw 䅤nJL\n?|ޫVی~;5ZW\l:vݬZlkfF(ǡ;tCo $;>QhG;l(}NXfnH`o۝Vӄo;:Zs~wqQ_'(8QX[?Rn\|zif?F_RzN|V/qއ%\co]\|Gc'7Z_ڃeyg_1l1;w	2`qB3"/Xa!;FcvƱ0/Xgn0ԋ(("eG(8<Ϯ$]%?x%=
#'t]Y~6>:f!NFL]oæ-C@78%$z -A8p k N]~tƓh&T	gA0Z}CsaD*%I/~8ny^Fޡ_ߏ3;~^	<o+oT~_*sK6rXQ+CB ~OϘg*?Vj51!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAEE.$Π8J
_sWFp~3rZwr=|@?GNtZ*y06+[?GΨx4`ʇf]f}|s|4	n1vg#v)L8YtLGC1~q?i8?]<kc>܏^cT!`gN{is$Zm7ʬܲJ6;rD<{tuۡmۢM۠u[+C1^ ٦"Td䠶rE6ӠbTLɵ;tx&5I5	&٤"Tdl.
TA m["
s$dVaF`K69V%0Z:f%eUѶ]L%,=o>*	&2PUfOCOG#x:e.ouA43	./k+QߒBv
~DΙv, XJ$i?$/1 ٘5ZJS̵ȍ%;		[םvU4V6M|kJ%<d_d>N0fؾ7{qgf<\A"Ix˂5[o#1=lF+\[Ѓą7p{bšŁ'p"lU؉{O<l>2}sdfWW効߅$-B (Nm l`Μ7YϗJ]#/fj
K5֎յ]α~ݲfm'šSRU=+_tZ1rg5NmRW%f}'Lԅ u>"S8;kVyE"qC߮$Ǆd5 Vw߽'& JBId 9N,T4'N|lm
%JI*__ $6vnQ#旯u|DM\p᧷IN;/vwֺ+Z,}_%VmE` գ3
Nx4ȡjJ}wx+p5f*UP}SѬb[^\JLRǲŕo<ڍ]8~\^ Z?rQA5	#K
()|3tYA߉]0 y'Vz1M`1(3vr8qJ6 ʧImSIک nIa|kklmc_z}ڬT$7"Un_$r}ǘA$ћK_	k\j$Y3!͘8jx!D8mF(|cʀ擄KN%˭v^Y|
ǂ"^7˼/s}_؄ݭg+dzQA{;vg(([{vWȎ3
f埊Z/47r退=Ʌ#/<\EYy9c/]%R&lt)ݴ@̙0]u| 0oI!@Mhc)A0ts\` #4`Γhg?>͕AxLϷ.X8}Lw3DDß1*<Љ3 3bn㟸CYԾXaR12n:uGJgxW$`uE>T/Q4W}"Ѳ%S%{c,gbl%ɗ-Jg8/IEaMvgXxO|(rNG +ɜ^앙5ɾO!3ֿ<:~kGgӒA7dt<4|xfU:RPG
R5GhSĻ]*9>HLC_],\"
wS.{^` ,k]+	R;՛|/KsBNsR	g]s
O9w2Ff{K/^f/~zo^V곝绯vޱzݿ>zQ_-,Yhhln`q!k:~4eA$N7lɑ4<u?	fb1-t˸M89w;.VXts_BMVե#)HAW4m=}䶱kxĈ[8ޱt.#|(y3(yr]c1#J/$A7A#|3;[VN\3mᑽW~W@O~U>qƌg߳dP2K$a;tXxi<a
( 5DMH5)t|`ђ^2rY?m+`/:+t{s9ɔLS^gM}Cy^C4a˰p{00gI\iҦ$jݴ|frJ{W8#w#@0b` `"J-D1;ެjmQׄ?mM`/-$Kɖ4\A%{bI@%X uL"(G~ CqPUCs"	?";PR&	o!kT7k9/v%q9L 2X)2ɣ/U)ӨRT
1<8L`<bI
c	2ٔ1SX/
D@")zK.~Cy{ks҉+iɸmT}PbHFq0k5H0,eѤ+e݅(R/ΰ4͏r1aPvWjC&/OMJl,=%]ct-+	MhE|=( 7ـ3T#Mjc`n]"ݍU4Ҵf7_f9%ihr"V]x2FKui]e._lT}3;I"/^R2=?$8$;?ӺVd^Q1]Yͅu)g[Lus^8~'IpIu:ɌD`,;YVe0XmH9*{eY"0ye64W5dnf/e]A/ر+s
⼶}LVb<)|0#VX@ n$*ja^EN4Q_.1.\D1[|'y-sK4
ŹiqsY
=s0;=,D

JJDl3 l	eq$x$9p8&~F\Օ/0 ׉#ޮEk+U@oxt_Y@I3f
T)(E烖f"esħO+7@c|aqO*IDPO\jɟB_~G͕Ȳ&U\l'kﶮ"7&~ 9ڑ%5{5ڏ|?zX"ZQ#IWFd|Ǟhb//0yװg}}'c66@X,͞~hִ"M]YҦv[$Aix/s I+H]z:;4w};MRt}gxq8l(?nlܹ4Qj|yN!<!2HF(ٹ7 l0:ƣ&|Otb(#jC/"|_@%
Y%~AΙnEx\/4鎡+52C=n(J;rlJ
7~J~Rq\&Z2
XV$9BSLbKL	K#$T5䦙EӢxFDUTLd'yȉVN>r{B~+ ܛP
ҩbl6 [Ȱ0rLHSWBBwĮ<Z%yKeָ٩ˍiCDs҆`1tGSu#{1r!bW8x
$Vf	"Q<l` éϖ9N/UYg.]8NVvDWOQLkBZq`a>`gDY+L,p}VT-y2VQ94&܊PQ"ʩ<Fӱ""aCSodiѱxnh$)4>u\q`u*"y?1;s?#ΕLlr##4,'fdN6(&wO:] IW`$D4nWmWE;Fb~.iƍ@S>f<EXvIV]Mħ!rjuę$UC6AErZ	A0F,t3fE=^JL:_`*	MFw΃6p8/FX&CuI'NxrHn=5dx4L̜ܮi*#M9+Vk-O9S[OZJ{`sZwJyi?}p4>Δ?α'"Mg)VƜr_bׄrCjN;huh	)%<ZXS%; nsN;RqnP#6:#kEQ8H<W"H5_Fdr~UåT+JQX	U2%HVjeB`Ԅ Ŀ?vpן FC׊|gt=cFHY3П{~NNG3O9 wYYzCz|ƓR%7똼sJYh	^]x ؋hiJů*d$#z-Y='꾭9!y<ǣoWE~{+ˤUzOԗ54ik2Xh_Dfl!C7d(JkF
yva@XJ*A77xy{pL<wH:1taR:y0	I5	t(#=$
eah`C75ԢSbyִ*U$TpB(^yCk~ԐPHF{:"ӘZ')'y#N@~xgRK#തxP"Ȼ8'UEG!7rSQV[ؒ1!w
3D@R	$HKoBR"vsFޯ.iS13(g=
 ?fc\
Jol~6CPd77,֜9dF|cLJs)HL-`$	\\䶇#"z!X)X0;,*30T*,=0$`q 8Dx'0ǧԷoGш)=l*UDlXa˯LKR5;e.ĒExgB"(X`
17r؉sLU֦x/$QK86y a0e'vWMpJJכgPMt?τ3Lۛ	KdlJHBu~F?wCxHYH`BSuB$)\1oi(4Or91jC&B!k#6fiMߨ)"5E#C$DX.~;-~[WDOJcj^$țiɛiț1)>Zd%YAV/~M$5	|M_$5	|M_5["+u*d|P+c8]=#Hɘn#[O:]+k&w$ 4IyFQ$I(I-IR3'y ɺ~WO9XGe8pK\ ў'HdHʲĄv4!g%2d}k|Vh<œ/;9:F+>hGj8$F֢>VScQߧαp%K3Lγe)]FG hGs|JtO댅LOUT'{2ݳB9eʰ$BBH*
iϋ7W}Z. +zd7çh?EѸٗUly;RLxhUT'jG=G!*BɄ8c26͑ć<"j&hԥ]K"|7TK$x̓)VhVy5"g^iZc0B{|#!yVTaBwJ[^{qK+Ēܛvɖ/J/JWgwJW[\fE=RRbrEKHWzU^J4+&$,N/kԽ'0\TlZt7ל2{JHBF̑EViqoBz2|-(	*- =i몓QH7!F2ZdsUZ@Nxq1@oBFekJ`#F}F}ѤŸ̿ԓhy4mcTU{s#}=
<:Ap\eL dF$l	^yP7`7N}}wĞlW4	/"]y1)U/]>{rJmaøDw?ϮӜss2ac9802o{]yGi-xJqnCIjP.`5[aX:^Ds)Z7&=?vC1xbdQGM7Z~d6.ݏ1"%[u7JC(k\5"K'd8nR\VhCzv.*Vf~5X5p4tC?b|cBؘ_.240-@05ơ"ji25M.4~ߖ%^ᴰrwv}5ZLv77Y[i^Z !C:X!r9"r	4<7"^ݩk9-WbŦ9?B)-խ%,s^ϖ90b1g-bs˳fdRfIJIv8{1fLn*֬o0E|9n]8k,.?`+Zg~_,y11fUVs@l5)ₙM[3EUV[8,^k=p]2;3&N5-8.:W=򸚻+AdM;q&A{)Y`߰:M9`N}
fcCqxܠXS1YzKל(Mc25KP(泧*ϩ2 +3r`)	pτz>epe'Qay"%
 /j5aKic{4K*JTs!l5SOeYڳܗCr";h+_FOju2="ж~ՁkMx;Pc,dNs
xHCUX8
]rTX+r	_ƙg!~G\5[1k䥃@c=fzn.4',_C.2p,3\ǟN'vr^o^h3ݼdob'qbGI¬3n,Z*jjy_<D]?f^.>:׷?S#Q+]Y 7<*2ӋwraD\;{9&N0?{fΉ"UQ"̮*ұFq||woȎ*7cn3\ Ŭlw^},B?C6²Мu'SJ%ǋ[/
`%۽W?35v_W5 =؅1]tqq:~ԧ.zCHnGUz=[1gv0Ч;@?\ʬ,8	f1BqF0hcX(@>y 	Byh2P:7@0*̀;Axb3.uTLpvN[tF`x"fO0t0ɼ ;
0x8.iԨН.VAֺCdcr0σ}-#OFc'^_wՕn+~Sm#-|?[eyȁaXlݤ\b]SRɿ9Xab.G/*2]$|/ݽQJYdQ|AgpTXYcHhnH?g~,o\01:aR\oPX][<W'n Opnu'u_pB7($abD64,<w6d^45lRhD02V)Ưdj_-LFQ)IS5TQ]GM綁'A0dc1rȬuqfHcߨ(+59vAoFY{ɷDsߗvх?>VS.y$=^E#םz{6/AN+5ꭉh5[o$
ja2ny	lInŖ&hT&M90>V!kklmc_z}H5V$̩a-*'2d=
?zdsJ0m⎸꾅RjUpoH75FaS[F	ӘYV_$M#ST[f&gDP0Ht"#߀e8& )5]Ra諱MAԦ)ia4=jF?C-c#du'&7(`ڋ,jUՖi)psDWUHV(,M

ųK
ZIujǜjTH9O<k@ԃ%:MZI!G6Y3]z^-3ZS-9Wfz=#MVƆ,pnFekr4;pۨ#I|qP\[Йǧ@#Ko84jm6!Skkc`0WyC`c[ş!:6!"N.D)+T}Jq^^/U:klSo>j1+ßmp3$1R;ßyYأVH,8̩͠=J)̍vAvIAqC&brik*#TDM
(-')v/,W<O}y*(%vD`p8r~\iwi6I:xf$fO$1ħ
qSL"Ā3s̅y8QdO0Z;UOPj{n7flo~|gʸdjZN$5]Iۮ=ƷlNE<,) 5A@sv[ DxQ"8
'{i~Om@-[igz&9W2qP"N*j)1SA[ P$ШTq2Pp8cS!\
\/	˔iG⽄=A}HlB	;7ӫѴPYj`8 +9+c63>~bGxE&Z0(?CZp3a!	NQ|豦H~L*ݧ^=lb{,ѱP8 ?:7|Pd'ƻ2]Ÿ'Eh&xq41օ3DNHR3 H'śC/^6*Y1)++CA q]+*Gk[8TRKFeL$g^ɢʚ6`Z'UWA{3p]~),L.1N^K<f*WUेK`trxtI`MLd~.A\D'sxJ˄=ʖ1qYl5~Re:BPrNzrq')K45ܖMbe }h
3nmK+M=R1q[	4kҽYk ,t-rOsJ=c~7tM1Yc
"v:a&{*	Jb6YVixKm]lh71Gʸ)*A4HbzN(:詆u!0J+y0c>M. deïߊm2T]GUdY;-5<3g52gT6k>NzU5H E_[0t+2oRHt92_nyWjr]eZwDuiυQ+0!C~Ustr^-J}Cd|޹Qȵ0oZ&˵8ozI=gf^_JYLlQ;:9k0J<?n~|K(81Ǉ2rSe"D}2*߲(8/>ymRj̶Wn(14gI&܆9hpq`ʇ>U8K7V8_v=x	pfzJg?nM19KK81 usmaKMF6RZ	x1KkeM$l F19rG=eimaglJPիJ`Η-a8jY-'/:%
peW`*C'oR+~蔚s0GqFмuRi(fP+[ef1q\*Z]p(
csrE͑'k3LjLY>ٻϮ޼8.WW1D;0qOFGWWrXtߔjZ#a߯VacJ3mU\і{腻"+qX*wX=wjr	xߘNuZhūMJ&V̉k9;vVn2jMmt+ku_	y,V 5QPdhV?}>z1CF2)uDxbRdޜarZtY=,jy^KDZfآ)6&6ul^OhY+6a_AHYf=Y1[T>8)E%CĒf'
047v|л&y'F(ivN"~me~͠3/)I}\HsB$>_yEݔӒnnB˓5|jNMܙƍbtJߍσ&ߍ>?Es'80b3aiZx:Ak>ٍ<9EDuQGWۧFVFrI90Agy!_F%{Sm,fe0^U&UvG񒣴C戎 
3s(瞯}疔?K8Edcpa#s:9,}Sp^|"FA6$\@a1kp8J-зꅹTsU=<*-Z:DSP3l53S70]9,-`Uj|>/yǍ.x.ѸJJ='d@dk(qD1:뱊*߰US=S'DOSRPO.W+kkufT*o6|fTyӈIddeMQ-,GeVQ*4GC=rقEoKv,9btb:KѼ>:oљtƾ<&!l3AGe2t6"eȬ5"S͐),b8΄#1춄bbf ggvB0ˊ	(\7zJy4fJNq,/cjO#tu#slk
i_WG/CJ`k+onXK[L,upCBf7y&A(v/ <`lwogO WْTl ,+N#XC78hAfMn}p(LW,
@Tf3s<cV6乘XrLgYKN2^$ d]Qt,z".d|`B8)GTVI.վ[7(݊Pꫯתe.@VЀm؊iн$oXI
 \!͈UYa[)p{(9.Le3Bϣeh@iL63w5g],/Pl}^z֭1N00r?c:}qթY|Fϡ߲VHv&kBEb䔈q3H|.6AOB=wO{ppGRDG kO/FΉ\Jp GjO#rm暦x;TT4}_25KCIu߶6lJPn`FV.!ܜ<a<7wky4IzZS
^y7G`."KQ*R%=-k/"A_z~\ˁ1
'9+-%+)%!~UUWqHÿ?#`ya=)U7VI"ȰFQR,4a#2g_ V[0͋ښ@ZT6u3aY!=WVvn4C^j]TFbrTLЊK>&/yK1keH	7iZ@^Θ|e3|X0d2S9f4XPFo`)_*u~aL7 DnBch9r;oAkk7S)qdЅ\Pj$8$HJ\TI
Ѭ5ovkZcZ(Kj5)߆VCڿVC@"y2L=2N)ZsS)3:rFaj1҉8?hW}rAQ_.>yTDA`Vc]Dz;dm35rQhU\DLt(y#BEex"^ҝ`vL/#/ˬK#|EZ2(8NAnl+OV
^<wz9*zGR2:=f(,+meu7=+Wf+`27jJq5xiYez0$Н-MzWȽ?/#˃s0P)H97~ J<*0#al]nbw/kNLVjƴ|l*Q#*y3\0>+L''3|}[t̩!4$<uZ]5"eV9a5:R $<
j,|/E܋7 C0KT\ܞPuCGHJ(]	9%ő|T|	@'[lmG><'R+ +Y+ ޹5u M
i5W4-!ct0z<}6F`N\%Eet xr)f;mMPp(>l9ވO{r~4:1_g"~s߿}fus$& 'i+8_qybKIBκٙAp,Nx`6zY|ũq<;4Gmq=	;vE|$"ϩqP2/Ii4
_GIP`zt&gMC,`~zZ;3'FbTbIb *O(#Aޕ<~'':!4U5A@m|Vڷsk;1yvG+gaQ=wU~N>ϝo5	Qf<$	2=瘏b΍O5} sִk<%N^ʼsy+cUF<
xY"W`cBx	`Jk>3|Hhf|]x]fUVIo.Sұ3g\Et\k*$ 
J,9
.J߇D&x|^5Zkc1[i 1r(0.(5Y06ڝlМfr0 G~
K'LhzV<뷽݃권"9@-%Y/+u'NEY-{_qHrخm	b\DlN(ÂaH~A2=eyܨ޲ r 0@c[ܷXBL&\AyRT9^|zdhlGQ5!ެ$y_0_*BgEj/5X]PKEk"7PQP69a'ae;ot-}3"O/+Az
#S>P0@ƞY.dT"Pqs׶\ǣi֗u2~J-OEgX7kbpV^8Sca3HOB&6v܅+%C;^{]!u"F,LiADbM>ѧΛVcdvPM>Jڥ_G%(:܇2rGvM1ppfBRd ދ"XU덍vYB~}aEy՞w)n/g^Gvs!WSHPXsV˨(±(ce"U̹(t8B߫fȍ$ہ("Xiޯ<◜ؑ0GN0c^l*oKl`)*Ҷ7! r߹8^o.@µ(0Ox=;(dUZK ~Ȭwp7wݬ$( I[lI,oRӑe4xyZ%;33L}Mw6NxJe١E`xղ17."c<dfp}2ȊL&#T l̳}eD'Tq4ȫx}Ie ɳZ;}!8NBYa(JRH:+SFW@DuT.-`iOYd,)Ɠi}өҪAIigyh9Yd}'.W#<zX=uQ|]VU<PYHOJ	 +(1[F%I XSuc5ۨ'Ol-r=Q 1ٴL,k0ϸ(kQgcv~qw?~q([1(Y\urER-QmF-+.VoۍfjYno5%%rC4P(G#\JKĭױ`֛:kswqO?Cnu+iD[i
iNQk3G>|_*=|ȶzE0e?/ݢWgP1ĢW*rx`xD#+¸DXItLGXD`q}yJةR(攖^=81ԇ.g/}jж;#55A{LO@S&WN~\@Nka\cW)-jmL$rKs^+>p_ L/椄K-i|1)JZ'߸`OaXPrDw^R	x¨/hX0vg'Sb=$4KNA6aNF ]:n-=EdJ<;Qp	y@D	`3[,g/.nMR\cc|zY^,NC/K^1()HﷶMIdM]`)Ͼ/	"rL`ddAi	|.mpfCӮr#xqZ*܉.-yAMNsz)6;..ܔ얘TDF].g&9Ȑo&AvfluSG42(9T(t)#ZwO/MN.6JE1juP[499vv&`:I$?<iag70~G>ʍ25 	Nu &Է,U7>?ȍwޑ$SUΝxpǓ	ثixIy9/2&y?h4j{سrnK%ﺋj*"&Ir?q;LA"o@[U$WCw(|2 Fш|7nX	:f}<pt$+'ɂsSol6&Z~?*Oᚲ;ۜri=ܠ2bCzl_ꟻVݮ_2x	3g C#q0<Jn-j<Zqfz2Bܗ0vNGhkL)(f%6 _-5f~5s~9Fe]!La;/vwZ{CSSf?(b:O%+鿗1@`]y#v̈́7[(;NeJ=a.E~%K%bKHvE=?43}{O;P_ =NƎ7g٣"V3lgcLxbP@rΫzo%/v_W;=៩=5˟~)-iA>MԗzAO^I%_ywC/zJSMZmdɫ7?%ֳ{vγ^ۮeѴlmzO_m}?_Dѻ]sX?/h_[	0A~k?d4߂&ӷLK,'cg(t
+{]K0L׳Yea
ggKѮ`e֞ fc}Z_[o]\sҌq_dv@Z Ej
#0j:zsB9{|](MZvBA_̒Myo^6:+?ForcFX_"3&D[	+y#2oh'<xy?Sgblz^4`Gh>ǿH(p?vBρTZmu-\n݉,/($Yd޻nNc{~T6cG^;yPF	Oh9,DV/MNmc &Yr r`ؗ+7vfh/ĻRl"@i<1Q)>ip]G?_Z.Yr;
U]נrvjLDC퐐+_5ё0w=k]BZT[&
Y]i?v|H:,Uj\\owhXƞOfh/i)<r	KjKi{wq%/=¡N}ow'Y!y;t2ϓ@6i|lm̀1֪XPҮ5_X4
-XU@iTq=tb6=xCdۮ߯z탟0'+~i	޸)'c7v<6S#iIQ2"<2I 0>]<-zxț3"`8n^4tAQ@^;})?*'P2nR賱ILPG6xuY]t8hoiI;ҮwE4A0
.{x|MhuG1)elU/S 5#GA_-Yuu{}|8u~G,Zu|\L/hL3Fg'_܆[~[E*2GiI#2$ٵ~V[EL	Lih[l`
H
lV&&f޷١բ6:ǎ/`ca/XDqkiV@f4F}^3h7J*ic}^	-i*^4сiYg66:19M7HȔ3zBU l,iϦF}XC(bsJ&7fP׎6Zl59d8d\ɏK908vdb0ܑI}3M2g	5['`vY>*΢3TZm&[U8Ruwy{Px<ۃ)!SMCCwp)w򵱰\odЙLrM(@8#7ӭc([;ֿ\jǑyF!'Piw|a%s A^VLT8f5O7(gOqs*	b4j:O3)*Qkj!V)Lc##/peE iX!C..r$#w#X~d'ޚG0d1Y~]Ey	r=32Z=KQ5&1;"4tG&4FJTʗ7'(a~蝱3XNE'NCW~T8xvY#(>WrgXAyU{eА^^eeÂN[lm6;z}C@\oۍg]k4خDd#/[~^f^cj|mU6Bһu{D?Q҆oFk{cȴ1i^?ή:  ;ijQeԛv6v}57  :-T_-@ٴZG76GjV}ndaѴ7VmkVc6fZհ*2xj؀qƷ [|6׉OЂr -{}s}P[-|ln$hFj6Zi5ծQS́<&[,S`@Rvz7m&
%Q)
Y ,$l½xH nACMK`Q;_ǍΆjufnm6P0uv
k|hwchkP._>imT5:l0* !-648ߔi,F=QUg>:P:z[^5Ce	Mmn6SքC$noZЈM'=o֑Ơ݁J6vhYkƺ|®i#Evޠk7j ņ]_oR®B߶6ڰxJ"a4s

~AzmpvP<X|r>}B똧)ɠJe])YAOa+1ɾmc@ 27Hc1e(n	N^藂bzUyc|IR?	~QӚ_plBZWk7čOG\'\TT̋coB-]RSvȶVDpiO\C!_Z[hўs1{7hn0\P9i,iu"[PQ~oMi_؊HS*W\ޓQp<E'ƏJR7Em{< .2qU/r]9oS^Sޮя|Jϩ?,gjz%of甹9$#^ʹ*Ydt5^AS(+_$Յ0v2|6a3qc~4|*^y@Nj&տ/*I/~?g{.)_/#;? %y8%X$=?`1&s23Jj^
>L;8<CFw߽*k	"!ъ-S7CǥKIGDxnګ|)0eLe"'s=a`(Kq荳h+qO|ջd}}U*+#5ec;%pt(C~lWB,͂,}ܶ+W7#{uՋ̫̔1t(^VJHU?p?zqok*K
IiH6MA8.)X/'YHL/z0m?O?a$*9	/iS"宬XS7~FM+aVG+M=$:ɉ>@ۂQn,p9MCrEQ.i8пlc!wj0cR{w?U_7|u(chC+eB+XAm.Stp"c@W KzS]^/.d>Lﰔ齺ڜJȈo$
WY`X#樄J)5YDN)5ndʁɻVWJKy挼Cm>LZEA0I [K{"PttߕLW+W; 1``g%wktC4=CTUV15WK9v /+dRdѡBUH1~"|S؏$37V #<<[9&ܕ5-U5) 	,rn1%z	ⲧ4YYʗw^=c^1yqd4D5MTU"5 *֒d`~@N@GU^OiS'կCUv2fg4D@
@k:bkR.N.}Bɀ6R&o/ϕ<Iir5HΧQxYœO	d+Vf%?*/8EK3cXKI;3}	
TZ+qxjFfzrGWϲ2Eh^x2afe+%Ѡ )^sbx	/S/ÞYV=T}0+Sy'|2gxى#oA0X9)W,gY)b`I__F(9H7҅%/Md9.عPw1ŶJ0d7i1[gX$$ q#gPey~;?uDϧNt*b20Y
&A-("%q	(1*p12;>;w"1eT 	yNsG=VIfL'Pqc%%}5VI:69Yv\lp0
F_Ƃt#q)1yΤ [6Og'չV^.8fZ_*@;cft7jƛ;g+E3!pͼ9#.0mGeFIgt>s.PPہ~`%8E*2`2Btv١dXLB0Rn%$+`$Fvgo0؟ӟbZ 0c]!xI63!(bJd7bBU	]KMC1OeD1"<hOvyNHa^ЩpH%
]Nt;1RaDkSd;*,f@p7vĕL\fNsGd$<vxĸے;ïW>]	`qfmaГJW#u,P3*#eiNOsBUf>Hj~Eg;;0B/fD8^ZE9
Ű8Ƹ,~WH[X
Hvf`X)J%y0<چW`Z~ 5)nKr/F^9NpEZ^ "tG.tCT>ǁLwN/>0_aŁW`,!`ȄnneZmCsUe@PL5Ϝؕ>42b;ubH.,J$I]ELS p&wC>'v2l Rb\JshQ: = +x*7k&00rQ݁ +RDo[."nz?Oמ3P.d]ۄ`F0:sF;NwA]4=+W_R뷽݃+mٲ1{bA>ec?,aŝo cA8uСU~^/i0VÀ5Χ6 w˕7
L67Ij	ˌ͕;P7 EZNt`!$^q	^ȅ0CNcWub
VZh/-wHč!zOV}NxQ{18u`Sݿ28"ō cfMz*5K,#lD</9m!ˠy@q7!y pa hlԥt{IV̼e pQ>&<
`8p as9\/5q92`\z[ "㥌M%rEH}5zY4FG*`	S^u9C<@_D.VsrJ#\pjQB	qLϻ!^(m)S~T8 E3X`-r4`k4)[J0J`@/s:ճTdVNVV8hW!ﾭ7F>VW++K.X$h1B)Sur.9DMXŚ@\vƪ)(_03G;'hAm
mP<,BE4BDA&EP9g`( 1(eNϠLMKr'Ǩ cx|<bcj^gPuRtPSRO+jn䱇KܡIuy"14Bl؛g>zNd7S2@h1UoC?+$j*#CE:1h:Q'ZۊV!C)`7ыF~5+O`"hM07(/[33/6d<.FwwcuEU2y@^
'2.U^\ p S7WpThWSl88feϖgt>#no.N*9btD9(^`i3<&%8AY" g`6:Ѓ3ZOI~HZʥ!ĳP+bh Gt͡.w	>LT<3T>uOT>EQe})IaCUQHMxe2ZtY l.0\DcnY{mŵb~<fMy]<*/Ge3<4@ص?HNxB
`&Zg}y62f:ѦeNv4X[z|r;翉6p)UOk5<ŅQ,~x?nbؠ3:w.@:o?;VUSikV7Yٙ# W݅m?v3,e0<ì~6e0G(	A1~t sYу$u"<e̤bLjy]$#smZ<ňe9Oy|"c0(\%Qg3q$ؑYʥlԺJVV3J2q*HH[/JLl8>R8c(w9|T܋4sbD-X3)xIz]U*M|ͣ$JԧPma](LpR.u~xͻ3cvk`VWRQԷty=5[BH֙^5@PCH6/o4
BGzÙĂnY'3َ($qNiDkֹ-_@.A[`~}:këwqe_jju=k}ٸz'׻}I0GFiIO~|ᙛDYMicGJ?2Lqn9kH.6JۯE2~O_+;[cowt[;tR[$Ry!|mVo24i6yJB&^qi{L>ZJ9q=SQj1TRN:$}XJ4y'=jiR	TLL IV? v9pdScN;!5#ם؎X9J X<_@K!xs@Q	7l08'J^<w}sFo}/FR>뾭ZK9O,58qzGSi;k$$O`}7e͘tn'Fk6r݊TRdy}{>N;#3>eA{Q;b(! $cעRJoŲ9/ģ(=yX)liV^9Лo̤AqZHY(D<>WEmz[2fboҌV\wgcKJw@$h䟸oRg%o	=L_8UԀN.-?XFH0do`^>zS6{d:돇މ;#<`!?&nMO{;]莢#%i_{P7^M rzhNM x2s`kׄ^[I+4WIFf D0郖A _pt[j3U t`ͣ&3p)dG@'@|,J E0H]h".9,?$(ʯ	[pc d'hAWPe3St]`AgcHK*-5#*O..$hk)wIq
v13<gd`h::O@T䴎Q\hRAsc2gtQ0
F C9 \ 