#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 _] vH(iZmwRRIrv֒{׶Y	Ih  %,uy9u50|MDDf@$%ZVVY$DFFFFFFFTF~ljk6N>k՛NkmV7֚`/Ir8'psAzD?IKۭvl7?:#ǿjwp[z~"o`+ٮ;I4s?wh~߂d#/CZI\NU4@J_5(㗒 n7k.{v?wuu4m;5;I	'l{+	2`s".9Cv'ԉ";en	Ν d'?bљRzaÎQ~*-?9<,yś\C2x1yȑ/nB%?k_T[wBZ %#@fgnDA/2{0 XCp*Pa'{4nBހpvU"'lFo(us8*KnU5ޥŏJ䏆lcoh_kz~?"{2v(|L.{_:q	ϰai齓Ę]V\!cN?@Xg?L7j51#pxvbChX!oޚ_WN'n߆IAfƇ/yAUѯ$r~t.3ǁ{QVx_ÝI)6
cVֆپ_$=|@?vx`֯l3Btkj3Y+՚c\"XnǰX,q̟#||r^q~0|@F|F9܈՗Nܥӧ
vnp9GڕFZz0rc}Le:5ۡmۢM۠u[+#1ۧ& 	lSmMUrPTe{*TMiP5dn4Er:$ȚYlRMIU6g_'oKӀ]"
s8dZfEXM:KK$2`@uJJΪz]q.0tٿ,U,58cLR%
{^8Uo2?Ա=sx7n
Ipu%d]s4}{TUf|?rP$yz`c
W5;&qewЍG(Ƭ1v+	?\{k]ml_[aSyU,kf{GocV*ag%1φ,"f{{{v߼;vj55Wo~<<|Q3!ۭ{WZ.\/øSM5"$˩̒6f;}[͇CqYl=#xZڰ낼X*(:SBWKwb㤕
d!p^rMȎϟ]X3?k'|7aEȽ[\.+p:Nxq<S̹=t 9]yƊcqIekyTը.a
/|[*+_Yo7֯[ֿԬK{pd}(=ԯLo*Ǹ_.8pI11FDySS7(A`_P'eAxDgywCһkhO6w%)|B.:-*rL15zaI0,ż%>5)?t3sAcbKɺƑ6,]~d˙r}up}fm~XSa|DKmҪh}tO?p5u{V9XU;u='%jC9Fh!p-ǵ}=T	ד`qͫ׽[v{XP2{	-Rauĉ~C8ƧT ZGrB5V	3%2XR<g8=>y1ڇk=[&E',Q~},y䕒R(Nh!.-~F"*$D\`p}E%-*[]vcV/oX9r1+Z$))xb{)b%B. mw ipt%#3z/%N!s%w\Y'}129juOJ^S^
68V]~Z%s;V(?o;qZ%*ȩJSEWSA5Nh	9ny䮭bM)dKp+ҭPqІ|c"	`^gC6';_jb"!`7Sdy<.Qui%&~(r3B7B2:c	?SgP)v`cu,Vam}X*'۲Μ!`e;R\@1`q}8$^}9X̩[uZ
ŵPW}IӹD:VNYg$d]E%tVݚ5?;Ot[f٪fgp]J$&o|ԣp^Ғ|̢;jd ^ڰ8<UXED,FTRl{^a ,k+;1R;/?5BC&PbX)S?C*}@`dV_|rm𧷻˗%]尕b{QG=+5k,ͰLIw錟sLCyXfDP[1dKYINMMlqJ9N8xOTa]Y.XblnݶA-P9,@
\(m 3 F<qO\+T2o26$Z%;A9:"iA~c4lȶ
Y9f4S"}88,Z=EyA TNU#`Hd!^&%D;,^j:	t*ray
ldHnLX<fuKEtԴzA|／1;8\aOǌoR`wIӖ`Y#`"&=ab4Vϒ4iZ6+KV2bks0!} ʒR;SU彨{ϻA--P0!N{NPF>5G|d{q;i
I+*&cfT";νڧjx7J/q:KCW#8N6=|4K;NʸUv|ؗ+Mr^-TV02Ct{8-0#'/KMSc uHK@HN ['gJJ\f%hs4[)4.iٸ!T<M`U$"Da䏳R%LL)-L1~@r=p*Ų!CݱE`M&]rJ%]cv-k	MrhE|:7S؀34#mZs`j["߭7Ӵn_ך)5i{h|S]x7RsX_-JZi~ƿ]/|243^]/d͸;Ӧ|?c\Sd]˹me*q˴-ƜŲ/vr7gXt~tRSs/pٕ;etyU,*˅RW,$Ja?(p^#ë-o+FJW9t}K'v[x-b/ȕ
=2uRE+!''m߱(<euü+RP}R+fx8od=cifLEطc!`y8KaQ.d ӆaHK@]22~%(){]# l*_Y/l\yՆx/. ױCޯG˟벁K#'28f@_9PIaID"V"ϟ+{;#>!RN"r-;GUp)%7^;kQd7o:meR}[ao"_H􊺽V+zTw^RVsO⛋PvxtiFRhE.0XGv؁wh3uG,]l4`n7yxnIH03
1o3 m+H]z:-iyό;MRr<cp{WQ0qBsֻ݃7ín^ؗaFRʭ3C)Y7D)U4pCYFyTb9љ+)*	rrrEJCEtOE#@kf&9;taίc*
Үy{E#=y=4hɤ6RDA']f_Hj{i>Y)e悴(6&,Ufv	f(O`)v3V#hB(=ve tq+>R.9֙/͛-O,ڻ9`_ҕcb5r 7`H0rM^PȲS_BgG$yG,ӸMٙ͆dFVs𒎡dҔ1/*M'2!/BZM!ЍL9?@~wFmĬSĠa2m!|L<6/0K(UH-6F3Y*Uc4m5)NNuOvNt%s/|/s.Е|oTťI, kiӓ2҈Q1V8^PF]?)j|+kPpEΠ^A| J3;TN-mk&	,-w f2g6v:#mH푤{,YfeD(JyK ѷ	O؍(2fbuvI"=]<"a(<MyJ
LQaJxI^ްM؏"O:[+}!]ԠNn`Vk~EP/(:k.Y[gKiqT\2$xw&OVRT3%)ݵ<҆O3:`Kd6T.ЈvRT Rr.9x)( j`$ygc)3WtHl.8f*P9Ы,+CLqB9熆hEo\$L5gbgHldEK1?%m{C۴[ILǑ?;g;8/p$B:Og	iKƒМ'a`BU$J;x`1Sj_lL8.)Hԓ,3WF7dk4ʉeJL%L.\j{ PHF:Il%t$ҘGD%Bif%!VŨYH!LInPUtYmo<u;a/ j>1Pϭ}XxLoxE[Gl@Px#,8oߩw&/G	hNs	}[Mx!O,boUׯU2.HnXVY.Y9'=FoWU|{=4MMe)oXm)bJs!ޒypX
`I]CHFHn%:vfc@cJP$?䍷a!nsBC>ML*]ԌҞHx(n(z!.nbG7
8ˢf(y/w".IxSyOIN}	GJ+Ttj?E[?8VюTU-+^I@$ -=ʤ%U+b5qzgqNȎDdwr!	pDW%wYw× <	DocOEhӺOOyǣYcVZдINf=},3dN­B歇3'Rz>6|'qd{xUx@>HT{J<4(4A%o7Bj@L6솅l)+$M3x Ww\p3mhG^ʣGPI>17/"3f#Cdm 	b>Lp{(0ŬMSoܯ$+of%5Iœ\z}#3v
hN>#kZQZh2s-Dqe6eSqj>K@ "VL+u-$?5
F(tZ#.=8֠Qyh:e
#ѣ(XMʶFl"Qd>fUjoT"(VSjX[:Ch@[2Ԗ%mɀ[q-Q0#F_:K[~i/M!slE6"ېMdqT{M_$5	|M_$5	||M _Vd#لlA6/>jb*-N#H[:Vkg׈k}h4*YyYjq9:/KrGہ=iY2|%fyKO?iўq-t$ER%Vv5GM\qI5K,QY`,nD?l7Z!>F=[>9PL4漍eٮjV>qrǸ\b6>!e4c4׬I*䞐5yܠ`͂+~2*eY9}hJ	e*Q(S%2Ub%SQ@[zc~Չe$۸_DII.#Lҩ2;SS*X^2ZQJMyH)&T@9&#zI|a:-kUG݁qyo%˼-bCS3<Ha垦Lè;90+óv?-0e&FL4!P1)n}rA+Ē̓[vɖW%[1B3;%]īMRoD=RR죝a|IDRIWzaJ\vP6Wگս'j40*^TUnYtW'7\R{FsHB:̐EZM=i$oCz*FRx5C<~e,9BƼI4W'7"0sHMM#fz0*r߈TrC6C6zO:~)U͖=Py3]&o%щQWɭ17+8U7cKpA٭HD9'LY!`nN}s[wę|1+W?ߙy~qysO'/v,lwEQgKX9a3FQx?(WCk-7u9\R8xM8{QUZğcM"'gu%NrLCQX%QO̔\Z6MCTZ^E'Bl+f_|d+ɗ$˵J+7voo[u6W`|-F0@=uu,Z`cyEw8XOjM4ýMk;:se5)giOIӴu{v '5[W'x~wvX4oUX88۸[2$`&kE=he@Q)h!,eM0akodvd~m\9 ꦿh?SzȢy}/bSy>Cq~목9,~`Q
Y|18*|3}c4gC Y$u>p"gb6)o1]J
%sF{;{{o^T&][@/Lgoͺp٘AdHVf%M2:ai nn4׳MS*:l&9wכVTevvsnfJ6ecfwݝB,U!9KyՁ2:멛5YAR_xRamv:iД%|ܳ)A{d"<kI;k*RlMb@9nL΍fk<ZA'Byo50TjG( tJgԼs4='a*}ϠSQd&43AVf?Jc{1L Ŏ_vi!(z09{ͮ7qac1fytt rSv#ͳyr%jS4\.d^KS)!]/O`ջVi3.si|58ޖ~T_QdhzY~ĲIk_L&?x&GU%ӝe*@3EڊcfƗ*
pԜV皇3a&Kmz:o7#3Zu-hlRT{8үMiM7/7p^|/X7ݑx
{)<Rf_|}j{aUBb?+ƅdnËcM>r,3>Nm&}5זetܯ-kڒ0ſsv/ϲ b
Sє
3Q AJ@F>Β[`gd{Ug͚Vb0
2>an/`l6w2}4?S7s|_Wb8yg
}SNSyyLR)꧃?ln}u{W
mD2axL[f\5B>V'7T7ˋC*_PZbZa#dJ/+· 3`GX';n?`XO'@Jo^%Jw2 {j{v w l\nz>6vkI*p쉈r9]('NgȩS/4B6\#KÎsλhQz*BoU-PV#ak@JVy&9BS DYRFh˘MS>:1u0Ez= OǬVY//[6R6FCsBC'4@nOypӞhX<tP;v#gp,BJl?m>: !pܕr	bw`mAq1e=5J)6
`nQ8.@D
5@ap@9w>G9#6Tȹ&6A:k'x}$~'E`PbnOHz)iOu_E0ܦ4a6uhRhk>ĨoyUrz/}*C9˷[@<o
\4	OifUV,bٻޱbV7콓׌6>ٵqI?ߋg/&Mou2낖PVÉj30i83M#;՛Ma!i3}픲[2~%SWfgj]@d(1f0~g!U"B˓?`#	,bf`˛'CymxЙD@)Lye
St(ȋEĶ_k0-Ps3fv1&'TL&쮊Xt\Gg7(И<._QIr6`3=pN8y\FN??ȿOukT2.~>R&*[]vcV/oXie:=kJ{ke#`5"Ѐ*,bљW]X?Y
Pܭ
_,l!	g?yL[OA*)Y|h( 1a1k |HLqee	ތZ"(QR$:_n0_Ey@
OyoYwEp0].ʍ̓2pu^y7Оwe[Umx3ǰ FXuU&\2hj|Zeyʯ
W(]](8쨘_7iVMi6})C|-J:gYۖoR&ZKXf4GNiM@nP*应qFfF@7g[Ao/+;\]zTWy~
tyt'V5`9N٘"n3_ ;ȟcnܩ,@B܄"Z*e^%8/"xM]5IW}NFΣG?W(~ϐ~&:0Z0zjX.iy/G
WBH	ej^wKܧ8'qDG3@5c&UaGl!dvʠ.7LGWg~O<*)'TvL`XABMi`'UV(t	ůjq&-ШpLR.iz9ĖM9X`Q>3I%,%n*{!'֩y:RõjسJy,ǷzzhBْ^PhΞ+V,6Ҩ⭺=C@M]7Sܞk4vq^̞u*cptW>7lKj&xtygZjdb:yP̓*`@)/hM ⤢N "
ojB8{F_%4*,48ۘCdCH(gB5u<uwePw1Eڎ/ΛUƞ.y0{PHĲ/Dl]L}8ڝ]_f`yTu z]t&#$f#':=:ɏI%Vl/u#I,?L^ !ܔr/)rZɛX(5jjլ 23Tǯwx~0Q_)YLE}??<LRlҶ8E0цG3d˫!QŔHᨠ0,G	WP~|Y4˝㍘d+WWjp|E"0WӼJߕaai3\sGT{2WW3xʎKwNךTn5Nt߼&uzCTTRz)R~475xO12>5sC"cT~6'͟9`@SJ0(>? NLY|I0N&e庳ɘ ˞˔3 ?_Hb9Uiζ|a۷~eEQ*A>bY
Tv$߽;ds]i?}\K'[#Y͈mr'K)[J#.߶Re5?ʯ%odßOt̕ռY*R߆_Et慧bu^U36(O e_X[KfمkRlRHt23ײ\f]ONiVݡxӾ"R)fJ_`ASHHi9v|vVxsօMaZf[ʸn,_ʢ(FY/%p*&z6WB]>Jݽ5Kw+r@m}P}kȹ1%X&&-j<ub	lhG$-I%O 6:H28FօpjZ	fl|vV[{zv.
d':9R:Nڹ9ƓOutw92(1o^ZzW9Ô߲Na6a͈y^驥":gvU%3uqz%1JW].4bd0w4*tjg]r~w+p[/MUKFTd#:fxb(NɆC2//1dh)U,qG]g_2?z . b$ru/bEWRA$4ʗ,m`xѲvR327To!uWPrNofs:4|HJctzD@(??cbYX)@ydV"2s}k,|}}CzY6KۘRXMZ$zS96E=CXKemmOlÔ-ZR{xE@ʣ*zT=J|>x%9`:v6Z&4$7s<+Xd*ȺQԚzo!km߼RR׶e0'H\9(&a(Zݕϟ:pl%FїS%Sv9={vIťAYx;Y s`JDz-ЖY$0otRզyWl!b	 8	-9N6AHVfrusW>C)y&ĒNs04})'grL>4uhPugoIH2Gڋ&ŐiY|e\o({%Jrl8ݺUQω.ڪxMx8)l,6&jMbZk.[,s;rFG8+80<;^\J{	.r6>S<v{zʅ#w	Kx%oU:]2`I;bꔭ8Q5x[^7n|| +@ᡯf6O^ryg	Ǭk͔΋ɍcOaW
$ݔ%:8R( CfiCnMYڽs͍n.io5]~k+_qN;ont;-er\Zν&@mh}X`"#Xj>}	5[5۸j|V U`uT}gFLx(q|.מ:`Y{`zNSCC)z8J*>փVgZO(` ;k[t /NTӦ\˫⚙z=gu]f),j9"R.[I}y>,?_nOR7G>/7PJQZp=<oQ.F6L4C[2uzn~ܐW
+㝘]Kbm<cK\0Ȇ	[\7k喲hM;>=!9	FT0n>)>;v=-v	.)hƺ%!v|&S%iD"{f|9;yvHX}7?uF*[Z6sSӋ$1i{8fe4WG
()ɛΎ0.{Q	`r-oK*;W4)(ͽIy<ON6J̏s>Q/p1"[|B7 lîr)Te>a+~oP7Wee๸x=C
|Âiy+5aY	I
 $\#.0.߈牅9+9L%m0BcOyh@4iKNC}򅇚op~KCM2n μ1/fG=n`͢SYc F%4&;Tl7RU9f5y>KZ%iZo,S"F|#qDG0.R/	 2 w9}|)l+UߡkPzB&`hVS?+<6F<'i$M~[?_a~s*V㰤:8ϑ!a0Ty3{JI:& OXn=d,ש,>0e=>@&YR+on;x;bKe
)LܕpOYuI-uq7q'V[Vw@V:x`L)N9׆Еc$ud#雨YvIL	h01KN)-ufSmy /CºέFuJO|i<Hsf7\,JEzqU2#x%f#:>9KW],2nϺ^c*E4*\0"`E3S6 7%R<Sn1UFYoA蟈5݆hr9oAk73qй\Pj$[8&kUY*Ѭto01sFw5P|ED%FL7_^PSM^fCэ8왏q(ulz.b(м	̮){䜢n-%|]LA)`vc]BYj6eS6:ΰۚ)lr9܉	l4oZo1:44		fW*2J[&y4×u%5B)|^d$LoYo|gnvY ,3SߝbFi-aXWWzۛzhfsT^R#"-WP"8c29|bb2t6y#vpv{}%= DGWTs<t1(=*56y,8+heLབ{LϠ5w>ʹ+d|؃<aPʒ%imʙAlr|;o~8ʻu<TSYxcVvNzgT?]qvri _@?/:`੸/&]aݻgh׀G&Q%"ȐN
:07'T̶ِ➼1K_&W [$˫};RSa3[y)khu -
iw4-#ctAg`W0=}g7+)n迸{v[,	
Ňs`O~G??iŧ/a}_ơy|p<1 y2HFOW|b^>dD8'FU~'atϜjԍ&xe@;PQQ~GgGqj45M1c{υ3MǰѮe[wћ7!q&8Vշ6P&ν5	N0[yO35rOئI=oGnӴ#	za=RM*/M	+^è;xa%"Z/UNz9/jeAъzkFZ)gUή6;[!
ڌ7C #EDϹqAs:Ϊ=ƫ/Zxw捃.[..3t定6Q ^4%; O5OWWZ&۬yB<ӯBMlp@stqvŴMh
+(E4yy㊁{ OOkQk&[k@X|C-$4lD4~A 9̂ea7U!90HdC\L 
㿰RMwF?V߼Ve"jto!IkY?aE~q&5!S' }F;9"&=fJyf{<SD1moqGp!U[NXpnzsQe1g;bXX}[!ޮ&y_XX/a!W֢ZVQ
^VGu_ZΨ5_Cijm(ӥ0a(q0K㲟Pc}ʑ_q_AL}э:H\T0?⁂	2r=5r|`dtWQc@M
,,p'io67*<4/]2\㷏`p>VKO?'0xaIq4rc^CɎ0wEd#'ˤ^ۈYPM31'yj,nv*iGIѰ;G̥% ᛝ7\/<y]i}F.uĠ,׏wvfzc=n]V.P_AYXQA Bsãʱ廽\wR$j&p,X^嶈|es4 -G(r#ӀɶE?=$Vt+'1vD#L=qregج/ʛo0EBEv'$2{n0-}d7*1f/ 
`S2_D/,5R!n~ru>@9x]P:X^rm)pU2SN0nܷ̄h[dCdnwϯ3kvZNWЉV8Z:Jez,Gfp>YQxiAB@Ð\ƻާxO-H}+qh?`MCQ0DR92yy
ȒΚW4),rmY5h<x UZ#X~Rެ:1.IUQ|.XWBzT=satƝVcąPiHOJ ˩81c:	9,<iFZ<4HsjDCj:2Е6{Dcr,Wd~XK%CAA<VTmF}-)7۝ZiڬVo7ڋ%&PNgRsAzD?IR_ƌZkZkk8ERǟ6fNj78Eʌ*}%G;5F0
Q|XZzm3p#!Kl~'G[:EjoU;}sTeRyn)bV̟:_=FمHO/6`gQ`Uܒ$;<$C2GC#F"x0s@ڕav 	.ܐK& q+d}/$3Y`ffȈY[6f@K(vBB	.䄬+-kt9Z':`ONN`~~5UＢaWh,å:sű`.ezR4*Φv^Ah=#mEZ@9t!y[zVɔ:y
eCXc{?cdX$:[(7quuhr`Gr`qzptæe/o>~k."DHia,b<("7/S=:ANԳ^|c7Jj_!^o3~e +gic_4YvE%&&?&g&9Ȁz~l
y?L\30^QH
Edb}^=ٛRsTűA\Y8ԼpQYyHZ"q\e{<N!'䍎MTf;ply*"	_'zT0r	NuI?Jg~ԧ'Y*O9=~=8=
j#| oH
J=ڠn`U.T瓇	ث}yxXJs[-cCz^kwh4j{IlR.-- ᛨ0CJN"v$Ws7_OrW6Ю/RN޻4~_̖ߪ@ <8CTaT gF~\Z)BPz4f`=g?Mnkzuڵ:Z~"'QYlB%hvּ.n2rh{J
a?oZJ}auD؃NĜdp%
2]OMޑO)4ɼ9+HnRIeFi݉v+*?ukQon4Vnw
?mcZB1hrpo`wkMSYz;~ѨS2"VRD9x*R:<>}04jtR?ZI2p0[#KK2+ne\/!G,3ԫ]he/P2NG;=ݧ*VS/nӛh_zu< ~nOw;ýWnWɪv.z?GM0꧃?@ohJF@s^`_ys͓t՟~|sp}~D0rz?|PˮD}d;{:yA{ev*z>tmWjI¶7[[[wO]W?(}*'N4Uf ^Okhy|*'C?쟔QORP6~<Dyݕ3MK0TEanzj3yåhW0<PayakO~i*_\`w?_/HQiUB9`F
1G~v_
WWM\MPL^7K9Z`PyrWE_Bh3{L*c?nw,X@(Yr$sVef$%ܴ>I)t~]ntO#ƙyp<(vdm=Iܴpx'2WO/dǱIaS;ԗX9Ǽ|A!#*2#}$y0ش0oԉŻK:tU3.!#~-X@f#'xPA~}4ULo#NѪݟI8_bz#
5G"' Ucj|}a%Ӓ>$MCכ|YzHd[$*UWl75ME8Z Ф#~Tn4K4ߵZZo7.RC?v^uGfzٰV '(Uj\\owlǞOJiWiL|nl_ڭ6Cڍ{/wPC6fc-Sk7]$DStCwg!."SA
Itb͂1֪XPۼv	Z4	IC!UL%"mFK%1x>QI^]ӴlxGwڍ{Ow=y}]|~ vKWzO{&ֳrwK_X%*r<	ʟ(tKsBW$JລwuJxț=B`8N^V4p~R`dÝ^8}-y{|0Ԍ~T3r2Rvӱ?T:Gr|vy̓h6Y3O( HC?dONIc}|N@d+lEPC~_-Yu&:Fq渧g_=yxV$7_LjgzPO|܆zaw}oV9V.?86`fcD

&FMsSXN᰻Mh~zT^c6,,oCywNl;[Z2cFǩ%UX57Y`i'zR\z7PhuXnPMkjh9vzӘRE&GREUg6[_t֦o7|{#!UOj:z54@SǱ*iSSv!RT5@u6ZMB"YNV*g祜v3R9829w$wbO8y10]Ӽul0&kj,á_Nժ
zQ&źw.=7D7$jeh}=xZ+_ArqKg褆uurF[ZK-(4X5 T>j_<=_@tO.x4U$ˊ1
GQ7q-|z+8: H6m0_P7HQ~1Qu [=p'024@hz3'l7iuR B\ +e)Xǰ*>	B,O5C
YeabX~χffȌd$jv4jjKfzFĂim̐͔)?
Yoo\,{C
-b)ί;n顒r,%!Ɗ(>XB]o࿒;Krgj甯%}H]]re`tK
lYjV֚FV_ە:xF}Rk4?خLd#`byXk(MaF{j|mUvB~ҳ:~GһK:.rY>Sz"fz#بpV5*}mfdv}5  :-ViMfZ:{]HͪWYj4+MٮkkVcҩ[aQSV0e)S@Vm|
5ޑ5F  ZzemcmP[-KРlVjըW6v_9(Qo2y
;e)](efcrzQ)
Y l$* [k{# ߭5:^kZZuWZUhWZ~`v	5 M/Юՠ^:lRѡbf݆Y蠏uтqlcw2Zo8 V[Cok8gh4/Qi<W⡀[66WքC$^hz(OuQGn6v٨DZ?/6RdvPWkJTj@06l`o_09~}?	|V=M6:(KTV~?X|v<F)ɠe]凲0VbqdsF|diJ[jPȃ+z+O
9oW3 /9Uyc|}5?,>mV1_ʕS'z1r`\NS1/2lyX;d/m8ҞULB*dKQ|ߪZO-`?w>?ó%aKˬqJ Tjk΅0HOa8r|RΔ=Rhnߧdl+uW}۔ԟ痔_WCJ2L/C'|>zW&)~bxW\RC hVhUa"ː2\^D~U2S!a|YaK"{\٘b`weKBqz@bfȰ5:ΘWVKqp]]߭0K+\||U7#we1@ݘw(#q'	A4G"(\~6Z+4 -/K*6H\#}N4]B֣eWa&ÐwK<8836	XөA GgNg#c!S]qOxqS?Nptd`G5gx?dãu:7"Gj8# *1
yA-N"͜"=<+W7#üye5f*8du-ƭ;ܨОRK
IHH:gy~0ZR_XH&?#O.0V-cq1i0BvxW4i6],.H)Z.9X
g!)AW,+xwVK~.Ԡ0ũr
&륲6^7]GG )=^3Ɉul^`ðɷ	қiKA,mFW:+3fRpQcNzCW9N+-CO%vuL.&&SPN`a(Uյ'ǀDqA::	oʔ 
1z)!@(KD en!iЙ07rr3]nio;#m|ރ/ZN1:-TGWܓhoK&Jߕʳ)ÏyTG]""QBZAvJ4kpCg8&:&{d0)b"5Q'$11cMfF H	iVYrU,יU)$f7Nȧux[@Ǒ"Z0TMI޻wg.6Q&qhL<C]ьeUkk6p!դǏYY)	A-2fPÞgrV	9L,קqy(P\bw(`֠VoRV'S499r]60k	C)y4$FabyU/#ĵ?L$X)u4R,R';ϒ^K2MPUV2	'@GLd:r[YزɆzvؗ,t3d#E3*ᮙ<U!aEcM8zet4<cc<?'Ro9} j>y!^o0rmG;taX2ob+؄00<9(L@V_<MD9dC=G,41A` ЀA/RbϓOuRB}0')
녑=g7@	D\K؍;S!0 =s_$ǺD8%EHFF'vavH<AӹRBSO5d)>lTmeqMEݬ#xk:Ѵ d'j>afS#ms3N)ГxmH84Hd,|a%1UxJ B˥"	tAGnM$Pm}NCYo5ؙ㗗{3<U	Jðjk0r7oNueM1H	azOX'BBbSN_5v7=?]Д|OۻK3BS(|&
4 ̪`Ktx04*g|%Cy%PC	L
ViBpER(?"XM-PR #<t
$Ȉ-dx}Hl)E<6MXpTN#%7bM(X6%fD'y#%hc24d-K) <@.Q|"TG
{cTð4{s,xO9jO5n?׮KeM2SlCdO]+7쏩Cĉ@\ixܵ 6?:f67OSNdy'z,3h$MָJ<J$2jGWϛ=|RG3s<YhVf	ݭU%VD5B?%}t.g:&ROrZ{cb%\7'GTg3*#tg}?}rmBg'`s.H̤ĉHvxAh3vF	plƫ>y[xhdPDS/K7fwyHeiڵ`3p4/ah7PNJ7.]wﰺ
hi^}3Tq,U63<a|Ѝz(R, (83u\he
$:!c+xnكE3JX#6{>֬=Gf<U=F87/:ELb'0PWo#PViqZP.a<̼3j51rXiM`܈G&z,ȌΔ쿹љݲ8wby5hUŗPkdUt5A*Gvsڹ}Y*NPjRY~F-^5S/ͤ3j  .6zLɖBZۨ.Nb|2rmWPdc)UCΩ ^;%џPD'|UnO@&a\z5rI	:vS
QvGD볱p1eJW[POe3 27Olr
OY1`Ձ!iU9zd={4ze%鯨0ZO0$XLR[g#ԡMSD
PדҧZab%E5wiH=dt
(-i=@}! T,V	Tצ=9,+9-"
1Svy0".E.qՇKG5XVCp0IiU385 1Ca7񥼫[s4l&iPw%[oo}Vs#+~u$1v~|~'F,,+CMퟨة}Ghs-PekWVЖ-W;,si0+.CHSN4sY9Y&|fոFT%9g'x([I=|"pdOy꓋'DF~WMU'S%пbz;t	[h-B%,) ~zx)O<v3Jgp|slㄌX
3:WrBjy<jS'Q~ERp;u۹`|/^;#oW<'772Lx~N'̕+by'RCj(KUtIɨҠP5mR0kU::7Ks/
HTA\En,/l}SSq,dPjd#4醣Q_ń@
_܁x&
`W|B ĭ0+jp|uLJ7xt5
y
+o<#?PŨ" DI0ܩZe-"NFYdɔR(	$5Rn3X@0FLf`5;hTU%lL`I۶iyfG摖xs／jf~i/^ӆ4n(ȼS]I 5	S
Iݽ_?ǗN܊OXdDЉsݮ;mQ~x?madíî=/yvj2[Skk½V_4oN7G^#-gfQc.$EtC
cè#E}3vɶ#'b'!N2kuLßȦ"OWwB`Ĳ챫8Z"\Qb/O_'rkoZfln
I>&(>aBIӇ4s}t.q)ڎO	cOFB3G30}*{bWb/Ņm2Dp
F"4=,?s΍C΅ΑMYgTI0q	sѨ6(|\ol׬R3f7`Ifix(WS}*p-IouӋDHj57@POCȦv/cw8[:p
Oa&_ŌNT{E>m'{8?
܇+%ͣ]
.Mi>f%v_d[~\)'όHF}ǲHcP3ӷЭZs`W(&KeHe9 zPmW7/휖EuvM(slߙ/v*qwXzѩ6iloC냴'͉._O[9f/߸H2^A}AsR㑓_ bdnerw`Վy<Mϑъ~2/<%,cCfR`#Ȭld0o,0fzg`Wũ_paJT2zFW i	 PHGXBa9ThulnyyhhEӨu7Ucq@}8nE=oDkC.]1:&
Ur-@|'vFv+]TSOz:N5AtuUs$@4tݷG"J56|fv*3v KtOϏ̨ |V"E@So>I\sokud"%VGM		p͏e.LZ$kD:G-4@)=1i`('Vr7@dy[뚸t~T$,?W@K%bD	K!wd,MY9ʖDZM%(QHm%).QD^4(dCJW/>&K9'^[I}!nb)wE/]*F<"C U &Z+mNڜaʳ6$D"/_F[qʣjzHICmv^nNUԻ@C!ӷ|!hͩk&m׋ϴ" $wd"ĖL>q`M>o6XN3q1~	dlijkLjqdFj]T8kR=Zvآ@l%A>m%hsbh"!Ey^╋~
c(FCgCЂOq;hDxHWQF_yuW{Lbe{~^ZO	;
^-5uUe>.~ Fn}kCІ_6 z 