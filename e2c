#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vƲ xɒԽH*4E<GMR[)U *H"{S<LOOkì<̬5_sd""3L "K7aK^"#######qsP{NoKf5ZnvVo47Z`](vB $tn>d''%v$礁9tڝVi..a0Fo7_NEqq;w(8QX?ѾwrꍆG.fvh_| ywZ_K^4qOKlߏN|X=}ɥ_EYwy?흰`ʆǏ ,t!Q0:'`A<`'}N8S#vcyaXzGXcz{,^
|wƮ,6>f1NGL]oӦmC@ř78#$z -'A8p k \~tƓh&T	ggA0Z}Ca{5JVk47x/~8XǬl4.F~5tO(M0x{],'G~wn
c곍=VڬW!Bwg3e+h[D;qFk4Q+c8092/!n˨6 +"2pzP%/ݹ+8_Go¨o.;$ߏ=vle;' (8vF}M4dg\V9Z߶CAMpvas8ôLaoȢ`:2?Lc+*>#Ŭr⭬MVs'謏9moұViۍJ59Q"	Z	ymmWؑ3/ 	P*CErP;Tdg"TLiR1M*	:^<Umr"ZYlQ-*EE*$6ov*]!
s$
d^eF`K>V++$2`@_1UV5uGv
.ӟ0¾WRüT0H0j06{Z5:?5=/wy3n
~AIpu%_d]s4gT$UFS($r]}`a
W5'Iy%yuЌƬ	6H~U+8d}%Gn̮iNڿ6w;쯱*~4J󭣯	+ZNhg`T}Ó!K8	={O{{/w_=uu5o^:<|Q!ݝß{WY	/<?i䃤2U{C2k*E6ɏiS$lLv|{o056eYmeZ(:krz=pr ~tӈ	`-9z*pĽʧO̙ʍ/_MG9Q{%JLBt[sQ{Y:;#o"o3 Ն:H|7k,+r,[DuFu)[UxJUα~۶mzGnZITȮ~kZ8C7>cN.D/9teU}]we>3$;W)Uv"]K@}@}Dѻew	YhQcT	ԓ^\MQgE5զ.)QOA7s7!9!l6xaEh>a[$g{;;?mշX9&eA|)͊V4&nO4l۫3X;UZA5kD'GKC1U! }J^{r娲
	+*~gFGwم*I,_Tc0"Y:2рsF;O8/U^zĢ'Xwˌ[G~%3IT6RZꧯ`HSeDqH2z﯏⣸%]_g5kA\gj	 w"Y8ч~~Y&e0H[U-H_	1eiƹ^!rfl@VyI_t}#HT:EַߦW?YMAv2+K'g?6ao
w^TPY
f򌂢49Yy碖m?F '`%G\!Fj^bNKԩ	2]"
-xPK<LP$n}_{8 lRadP7kB5C?^S$9f1܂qt|X7Ҁ9O4%!?-=d1/PY~Aƨ[@'p̈]gJf6<Vbj|ʸ-VV+q_$oh</l1wz0DW*09}y&,|٢yqT&F7Y:HgK9 wt+BUTBgɭie53>ۃ}M4ɦx}po^?Cy}p%HwL>2?QNGA/iIK1fQ!w{T4F/sG*,,\"
Mسx7J7vr&@K%˯7o,&>2iw.*Q
E髌: #
ۯ~ه?/^M(ekQW=_xxRZ2J3$=\¢3y1ybB9,Ɛ-g'	F:7	ǥ*i>)RuVj`Jh`
td#e )躐Crhg6vπq?;Pɼň6J!J|@.	ʡI aCVHʙ-Ѥ.L^]G?}냪 ا)}X2c|b*!&)@	]',^j-:t*R`z
dHnNX>fu+%EtԴzA|o~p3'</b/Gc):B4a˰p00I\igE{i)[Zi+]49<9TJmy'yfW3:|&'i^RW~oad'/%$^0.4TE!ab]$b́rڸ#Tmo?̋Kn\vҳȩlA+EqAL 2+S)2ɣ/h
ӨZT
1̱8L`<<
s')'ȉgSs|%1@?ĉ0ׇM7a>T+>#&-7Ēo x*CR]I\H(&yC2Z
y%X8J;WӠU1T."Nt.JAQֹYḳN}m"ihU2Pb`sj$cMMb̬KuF֬+ \3$0}m[Lvj/fSƢr%]ɞA+T_f&ǒ쒶}bZPyX+t*_򯷫n1ML<uCq]4'&	]=TK$,VJYa$p"]]ra4JTa\jEF+a0lhQ|dof0]ץ;-{Wy纙x1ЍIdq;p ʱ6?#@ITa^cERS9}8|Lsalt獬-Ѭ+W},>g)=47ddZ=Tik	(+XQ\&d9em2")ƣ"	,6bbVu~giNXv%-Z_$ﯫz{HoN`5TJA):ϳ -0/[c'>}]_3yGt}}KTRN"r-'GUp%e%7~-o5"oJ5۞Ȱe]Eo}l@r"+jZTQ'b$'V*=%ъC_^nc-ö́؀ohs5G,]n4`n6yxfIH01
6o	/s m+H]z:;hi{MҸr}gxWq8uBs݃^]8QF2ʭ3 )Q'D)U4F#YFxTd9񙶠NlDjE99"% :'2QǵCAzBʱMQi^R~R-aᖞYcBd2) KeE.3%$5ݽ1sAN}[f,33sV;h(C
!rol)̗tRe@eR@`I_/`ʱ`e2F90dX9&/(d٩}+ܯtUg!;bW,R2iܦfô3GnϪ9xiЎъ^0i:)L|)L:׏mt$Ů"Q01(L	$VPg^Q_g`4ĮOYIYvFt릨s[BZq`a~ΉyNϛ%YRߝs85%d-mz2Q14&z܎PWT?q8tycED8wp#3T9)-\k;KoS@i|ĹЩpq$UE6{~bV-~a79P+3[1FTI3hXIҩlQF$t7H"i-WgE;FbLO4FE
)n3ީ3{xe$/.Q&nG_9:[*{!ՠFy9ndVk~EP/(KkY[ZdITگNbH8(3L %^}'f$OKSkncruF֋d@@\>2PHJnVX]xs66-	KRWY<WNgG.<raҊ86G9I&i/T=OS_OKcsڢwʷYxHG$i|l;,h??E%-sMs~	3 9VzByK&L)q
*q\#o3ڑ2GQ.G,/HN<p5h!ϕȔx͖0p B!(_b.$ip))ijA"jD]B	UDDB&D	5aS%@'ϝ'?^3 h֚S(Kя_~NFߜM=´,qK>#L-7똼3inͶ"2jc/ǣyN+_kTdܰH#!<{OO~W;wB
3zG߭e^4iISӫʯ3ް;R6$CCL&p"h!#&8(KuF[39ǀ$$I
o~zO7DD8G;$}T4Ee=ϐP݈P@3*]	bNpUd M^sHF&LcvP_8=RjrS8>Hb:I\ՒaD:*B\?"LJhXRն7F I_\op3	1^Z4ۃ'yJB
NpE\Kp%y<CPdoZ9MbZ9d!|cLJ)HLeIUݼn^
pG3`!Wg}@^b-ﰨOØ@0 *I
Nz<CA[Dш)![VC*hX-a/XƖ2RAyt3
J؏rvG8	F0	yrD9~$c1r;JV[	i$zy&S:ɏ\H1fLr?nf]6_=T7ӔW@٘i^кRB3oa6$N.^VkS2վ0es̩d <_i5Tn`0(ii
$iA0lP
A60(fwEO4O=MN"(V6b},;qw0RznX-%cna,1%mP[2ؖ%n%!D2VX:/VtMG޴MK4MCޘ,>Zd%YAV/~M%u	|]_%u	|]_u["+u*d|D@+c9i]##H[}m&w]7k'wYX~ fR^3),*$i%'I$</$=]~#KOȴ,pnYbOڳ`:;NdHʲю襉#.jT"S9*k|=pWh</;9F+>h)Fݢ>VSJݜQߧNpKX'd~e&fWD/B@XSg:,/
,λR]UڇTp({_egrTʔaILmTP!/ޘ^ujh {^m\ɛ^o.~Rq.e=Uly;SL`hyWT'jӃ=g(*Bc2ćo°&Qu#?dEw
WIFX$0j<Df9̕ݍƂax凅FB!P	)n?{	vŒW%W7"\)ܓ-]_lE_ΰt[6<߈p3{J9@;+nEW6mHBY^iO7"m{OTi1`T)ѻݴ$ron8e4$Au#zH#$ކ<4UFQxUZ@<~e,BƼId4W77"0KH͐M#fz0*
߈T
C6G6zO6~&.Uͦ=PE3&o4щQWͭ1WZ(8U7cXHpɗAݭHD'J;Bo(ߝַV=rW4	/&]y1)v?f̃j3ڶaܕEciQ5/GL\_itzE.rHQZK$nD~cN¡+5TbXК-0,|/"G'o!ƀ<w1 t2⦛{-uPe2ZǘbŒ-fHe\u"O&b|I8nZ^UiCpn:Vwiu_ :j;ܢ &A?:XPϣ6Wt$4Ls۔W'hyc&0r/ГGi544i֍'e*νKe3#.Xff:9Ln-̌h44eQy2É)?H&^dź9<HqDe|^ZFS@_~&⻊I]j?hکwzc
D8a&k׵N4_x$j3i#Daf"ѫ,PDe۝jreR)#]"(*ZX2*뵼 7r)(I?ŌhS̷uC#Βz`+֢a4cޘU4΀|JTn9A>;{2q)jzyDj6H|fݪo5KhHjG%"%2aj݀rƺx COb6̜GZ`e&s̒V$iT ?.-ܺ
;e9XT}qC(q-Nt38Es0L5|/us̻6W)'RD,CP]:ByOc(wPk*2|I^3^7Sϵ蛣VD""s+?]ohn
_BgSQajUM'_ PRQ.P6Fq0A3DIHUh^t̆j?C˰Ӊ1Ď]]O!(mzL197Ifd<aeEut<D82!q;;LgKJvwgh\ث`.j'lG䤄lntb0Y2YIp:,Yّtg( J'1M!O4w|8_*gU\5C~kfn8Y1Y|<̄N֭j/lziV%f(5h`fr sfm!2fwꚭWhsoZڃ3	[RdH$tˑd3c&Y}TVy6A'G^y`䧷Rxbտ&.\񣚄	tpVڍKƿEFۃi{r1N,pBRl̉~$YK$̋TrecμZn!Boj~ļ>,Qa6},7~kdBq*\Fߙ&Vp"̖$lS᱅ζzEEP_d{_mn}{]{s8Qt\73sN\5x)[X3fO03ڸ{$;nisNڬ.F-_eˠW3`geX'C$eo Yt
ԪxzgEjp$yjgsor߾~UPЋݨBw.f>uaB>w>ѻX%,t'0pS(ǻ+Ff8ǻYGspe zpo!4F((z]Q<+D>A{ɕwIJQ$rŅE.l#IcG|kNW)+dLS@S[#.AD
nCӐ,ZCprZӉoˮr 
Lk7pwɠp1gFD8^vs}1;ƢrGHK6&CF6ud/	\krRǯ@83T[ncЗ)ގnxx-ʲlq+T-inU ,caްrV7		5ӊA8_v=N3ezy-4GyelK@a;_s0L5TL
GSX告eH tQ'?LYj=|8%2~&SSgjY@d(/1%V!U%BN(A0dcH{vdXcmJ}q,U%~2Ǹĸ
|;s&BWQ /̷(5P`F;aN9Oxi3M?ꭋQ?~G27uWM#Nv|5&qtJ}`J v<QRؒ3sl(gcIGqnq}z֨YiΪQ9-){ 3j̕ïܲQ fUYƤ3=y01~$M2P\
_.l!	#x[bB@_]?5:Ko1amL^fjRfAxXpl#AB3"(QR$:_!:n28ru.0ISDGCT,<"F2MƈMyj{3sGUm6rP ƬJtUEӍdePK_6nRW(^{ŤIrcFYS(<gmۺHUliRh$ia/'v2ZS54EwRgzD1(6hlψv{䅱6\ݤr*9S%ܜex_.pק6)PXzJ[RM֘8dcxqF*Ą6*PT!ޅH:e*O)+H3&Zcu]&fG6~)"/H~!:ZxvjzeC˽%X$bϸBJ(3C]6EP=Cښ|5'f#׉0ʥeyQZW0\9<EzZ$0P1!q!|a]3yiS0Іj7I"-tp~DR.zxEKc@_`\6>3\YJnxS;'vi7z`L}Q˞t\m|A˖!YRP47dx+ODEkE8zdOlց<[khYOILrEP%+,(w=w)DTRjݦ6@>mW9YLÒaOVB¢Y͂C@0*H9r.(TC|W'0.RV<!ICsuh^eѹR%X̬8\itО_ɺȠYkWHAk1ܰ$Z$LbF8]ZaA;5 13t:ӲeN)m ?:=|4Wd'\5]qXW9-JPMD,=F3WsC]]j1Q|V)KԦRW<o +&1e偘An.j;q<4 N+M$ɢzv'jT*͇a4DG	WP
7;ṣAi$^8tW+ҘU$+6H$F<ڞhR^&`fԌbe7^q-5ٙ-_z#uڞkT;)D$dCFԇfaI>C*w<oZi˔\eۂN0Y󁊗Wa>
4p}zC(V,uL~[Wua	3A#W0 >O|)udZ:n_c#SUD,6?i)/Pmee=SNL_ێd5#ٌl)u,bJ5ph(*"q[y12WV.Bzf<Ou/A\qZ?e4`V]w̍"Oe7D"}anS'faI!Q1_|KF~.7>[M.Xg)}	w"#>gMjT[{έzXFn<7-ņykin17,*㼱v)β=gf^Mhټ>5t(s`/y~ l!>6PphcFeMMZTxfBERيюHZK	 ueq2\'TX,C()}(p],Ym1Lul5 7u1sc?M6dPb޼rDex	m0EtjdTΚ9Q6aV"~uF0E@rRl@ׯAqN"?ɐ9=Pp(~h{DLOpiH%gdhzKMCUo  v\. TIiI|f-K`'>'IIEUQvz}
%o6pO4G4AWHH
kkG~Uj"G&kl-&cOgo^a_ݝ? #5f9,kc*Q-0j2|ͱq-R[jkH=.D -e,A׊+b-ksQ'5kQfyS|W k(АleNرs
=Lu25R y;2襮m)aN}C*
(QTq2zk>ufsk!j-tǔ\"<^5&Pq)FP4YN'|0ଅwK-e.EE37b3ڈ%Änf+ՂL;f[ߘAHfrY^T>Bg)E%㦠ĒN/04y)7vgrB{ǣL4
B~;taZ4(CKܺ,2kɠI~Q_&KwF#erHzqrڴ,I>9QJr@F.v7=%o|QO,n]^AAULզ</ESe/J+X&1U-oeDs8#G+0<;\H{),r6=Ցsiyl<m&axZg:]2`I۫+bf8Q5[]7^r|(+@a|f\rx	Ǽj͌Ƌɍ}SOaW
$TVUtpv%QA.vA+fz"^n_kaVAL?Wj/鴂qg }9aQNyʌ`TC9Pl{^nUua^T5P\|`k1-\Z?HUeUekzgN>HMQA$fJO_o4S:(imvupUyĉj֔ku]3SˬDVUm4GSDʡb0o#/ۇ%秊m^yI9JK6gg0aS9*ܑzЈL5C[2u^>9o3Z	E-3-㑬Z5}Vn%fݬci-ؓ|LӃ߹0aDuoMѹ	8^!77ç<aǞ/c6&$eiv,Ї%b{9p50_qN]4H&_=Dx(a{y#W孬%Ёa+KYRH}2鉣pʫvU-Pt{	}(08&7$+_ߘcqd"|'zeR9J \׵y\9pS#+'LroVJ"14ZU톸/.>ѾU ()ذ_44耕ǚ$~ `RJEdjoD&ɊD	g"hr4%>]M7f8&[/{iWuLr0qމGfѩlrO1:j*6c<FiM7t)#Of>DeC\ Q1t.| GK/CH]N_
Jtw 䞒96sm:xxpI?"TTxEט^34<=	S`M"y(hM^VT926,WB4OvÿbO	Id5	3D-߽ool+t7"H cvETJz>:[Dg7^DR˿%b.wN3&d=h]ZJ>F]RKC6#k] 6B]Ɣ$zCSjn<Ea/Y%2Y.	Z<j,9ɾDaO56x(i^un5:<^CzKD^h]T4AbrTLЊ+>&y+1!lH	7iZ@^L2f;_UviFQ8cFe
- n4J~c||a2=ނ?kߏeѬ/8wL߃v'7nDgb9SȮH@q@IBˑ8
YǑk"ZmiZcZ(Kj5)/C!V_X!ZRJ<nNG}8d[<iIس 2Q=xPNK'"ay]S\9Yǽz~I(x>P%<6Ǻn߳dfm35rQ=oU&,r;9
iފPQbth4r ]9ӫȹ*ki+_Յ̸60
%?EnJ(3=QJa4tO1~w
"aeQ]mO~
ͺRfBGDZ֯n=	E<t'xdx[/
<tn0GC04>T+j~%V{A&+/(zcXyXkKlnytIVjQ>[-טC%jD%o|g4t%'ٷEJW`Pʜ%i}ƞAbr|;n~V?ʳuNU3-YxV鿭vӠ?3Z@ԃ8Wqz84/E܋7 z0KT\⍱c$xpA	95%ő|TrdN-Hٶ#]ܓ'fK
 qdu}Jj&}n)/em^IS!;mኞƚ%sdlH,>vLg0p'x:xj?Ofwnݏ&(SoD=R8esL39r_{~LBq9y d48<}Ȉ+I$O3عAp9کM|`6zO8uijʁc{ga]ӶFoV܄ĝOS"sۑ8CЗ$4C$lA0}kR?::!PV#N$u4×LZc~_|rFq9v>=J)D^\rltՁpM\}kDZ%R'y˪_gyOVc`کmƓ! H""Ӂو*8yTӇhR;g]{/Z⤋;'Ze=fh]Umģ@E_i(r6pA:1qk9 V3<>CɷዄvmׅE_uUkM<%{.YW@Qa^X)E4EiOϪYoo'[g@XrB-$4,D,vA ̂ifaf7À!9(̦dT@\L>!d2F㿲Juo`>^vd"to.j{y?^9;qNjٓ4uMbCN1.(e62,搊W(#;Ǎm{ 2x.G	l"`ҷ0.'r*7pC{Ś(B]I-_BEj/5XSKEk"7P+QP69a'e;ot-9w'e>?=^☯
%]AF77+xmu2f,QӼ4wIpm>bx=Iv[-{-!\xKHO6v܅+%E;YS%u<F̃LiADbM>ѧ8WcdvPM>Jڥ_Gb.hͅPu_?{eGeGA	4>RC
Kz/`eVk47e̻!t(T{j/Zr_-7.=?C#0UP3QcQ:E4sgQ$:h8
E7Hv?QD!0x`>9c7p]aꉃ+ou7KW<`f]|QU|1R$TmGB"sq].0kQa>!~zNwP& "@|,}aYqmo(YI<_uXފeOGۖ-yZ%>33L}Mw6Nx:fw١E`xճQR.#<dfp}2ȊL&#T lβ}X2jEd7?~!cx@N_Ak|7!kobDtG&έٍ)SW@DuTu/-`砇iOYd	l˳,)ƓiЩҚAIi֞&ĸr'SD_`_QuFwZ/N@f!>(fZR³Գ揭4
EW2UĲį33F=ybkDȷ ɦldbY'mxyX~6iw0WSBU+E\'7xZV$:FۥzNt;7:͍?A_S\(';Ds II9R_j4^ǜh7}ťe3;cqwq 	/kbn?:FV_%y^_Yyme;b!Z`~ tbiA0~::vuB'12a%Y0aq"wՃő
_(u:kJ3<odfQ>6Kg3teNfu|^%S;U	_8/[X-׳jVHI]L$rKs^+>p_ Lwש^H	IZrRA@qC~Bs%Bm1=U辤Q_F+cu:c:˕x\LM'Ф.9|-.Z:wFOӶ)54JF;&R2 !}&tʂ]i|rxqqk⚛P7˕4rҋ1y9i}?}" ɻiXʳVg9&A02fkbAi	|fmpfS^r#)xqZ*܉/͑yAh.ےd&nen0Vu0t?0A|BwKSV(ifs|WT&>
ERп=hDX+k8e8ə욍/YQn%pVVjTFy%&Mz}A$0N/:6{OZlo:y
-_greL}r@zSp:/-G{$V3Ϗ]ǅ{AwIA)Gml؅xq8{z{2O1	":+w5Llnl}`O?7z%vzXew*++2iKS$Bŗfq+ԥ$x.(0-1}5tG(n!]`FO+&Y>I7sN1F"w_*OrrFi=bDJ3q?oYq'H872j1$;)>o	Fr_Nby!H:[fRNEM6+"?sk1ofVսwqZ/s2|#cВ)bO[V'c/z;~Y;
-S	AJx*2<rW8_nt{'+y\Y)o_3Rβ1ӷgվtx#^qރ}*h5yl4[w_\
H^}snOxur/?GM1??l$h|F@>%`?~}O6z}p_y}E0dRr?|PT%}wUɫ7?mM%z>tRa~;|Z˟b6)X_zT5SF H.{ߝ\e|s
BO2	JX#ON(pu
+{[`י2g6gKѮ`E;֞	V 3ߍNfsb|N&cEۖa45XQXB=}O=(Mx^tBA_a⤓Mayo_ß
:?FrcFX_#3k~fd\>^\<R=&yff'knyY%~>6Pwn{?+h`7Zb} ʟP~섞u6ڲpu'RK`fd[ߢumC=;<VvgG1ϳePňIiZA"49-,Xsk6)W7ЪnY"BG<X@n HX}))CgNfl]\+,IPkD9ۣ6H$P$OmlTϬcZ2_7fO?Wm?N=kNo\"[()נkC3~b8oQn&9Bh*QPj;|[f9>񯷘fn7չwq*#Dyjr+Z	elǎ)RFќG4NF"|2SF7|AL7J4VK$,@7Oi+GKco572_ν'Y!y;tMϓݟ@i|bm̀|1֮YPҩ7_Y4
HXM@iTqc>-ۗtbrunyN'_={s]t	 *_yo\g֓;r*o[)4(*{BW$Jzo.J=<bY0ר (RV
{]о>#?y`0Ale#sGl,^Ragx@a։3F[lA4q4d5Үw
E4A0
-$@:vO08ŧL	-`:P8rO O]yq0νQ[?Pogwz0虅QoON
4WHpѣ[;p֏zk{ѾhAxZkkcot׭](b.OaJ;FVt5@Pkw`Bl=lw)hsQ?K M6fcVΉo6̿9iM]tTƬڮ.+6gхm7Xqmnvyc34g#!SNjF%@3]ZD)fcDC( Mhhԏ7Zxnq2p]r`:qH3k0ܑI}[&ކγg3X>{`LBpv^w[\|:R(I.-`JȔ@{
5٥|c,l [|{"t&\<
tʖG4ZqdQ@kHԾz \Zi*H f\匂7"pNer#Af}Vg	lr ,=X78ABgMgY?xs&/,nHD/:P
P<ߵa!}Fxk>QŰV#w+uL6H۝2iLG̚H9 ()9R~R_ެ<AXCFYJ*?q7_v'%5+B(>XAh⿊;+rg
[<m_*/[m~nV{ko46č$Oyl<O;uHԙ,7sFxk;+vSٴ73OF_zao?	ЕYp/hln>9&зFK7vkc'jz{hΆmmotmM`Mjw1n[>56V1h[F+#ui7;MPlُ[Vc7VݭoZ:iQUV05d.ԭm$ݴ㐽oMO]= j>ABnmXH47#nc@nmVˮ[Va?:uj
r69qŠkn]h@
T/5vrzדn訋lXz6H&^<q$ Dް%ѬofwnVqn?nu`hvgM&t/nԡ\|lcHҰQuR6 tMlC?vEjycLm;#UjmMX34Zִ[ xB^a`MԨ3|zۏmhDQϿ77[栎݅J۝lğ]AAnMф]zm?F	+1~њ)h+onifAjpPr|cq	cΧ$
(5Lh(fe>EQvt$*& TZ#Š4F~]%8N
zɿ.f_yƿW-9&I$gEMk~5y

1kX_cgTS7~>~vpZR1/iL.e
rCv|ɞKM=%ZW!q=q<Tni]cGUGng?zoKZf<ڝWWS$~:MyԇZ5t;>N1GrpQ۟x[L:|jg|}d男#s|>Ç.^÷2w8'd?yڋ]W9ׄ1.|ǫs
Ezyˌ^@<		c
K_ɓ܂&Cݲw.R(zӏ&3S=~EINj&_5C?_?~j{)'L_G?lLҷt渓 Zc{`VD̊5xuVW>?	B1ӥP'AxWi72I:'FDșN ka?`0|;1	xM/,ǡ7ƱuPxQ>zEf[?\g~-?xLD	(GJ߶ﳐ{IPUwE|dWRW(ϬLC7eoEdV[vE?)I,?+
CU+)W$ԿUK0eB眄UMZ'VVpN#Qq0#J"s9prp.s`鴱E09 \NPeR+Gl/8^@d#P{y߫7t*Ip.e@VbrShfTjN1NyȨ?4޼*d\aWWe湜pLA:͆RUFnR!{JkԫL#Cv z a(Ĉ>땔 -@/EcCgj zKjgo}9wFЉ}nnoc? uk社dy'w+&*WO [?󸁦3$EDDTAvJ4mkrC;`$7^&&Fw	Z.ZDČ% acfXdY&xg֥g8 DYK݅}$|.{J3ŞAUTFj6ʄ;C'c'hmΕͦ1[7d䄿AҦ}@lkeOQk_GG&e$$tir<U7P\bw8dpmQ['3498
]60k	C%}U$FabzEO#ĵV?%L$Xy2T,2/?~F7<VRLl?5ƵʕH8I<8
erpS%_efJR;a\,1|ZE̬fJ
	#ďWx65̯S/YY#*n`YO|k'?c\'"<	ޮG4` za&9qNKv2A̢wcv 4ҍ
{.~`h0}s3V<?ш8zM3':qa5LD}9U{8"8]8aM2Z 
9R3N#VI Lo9Pqk%%-uhDӂmvZnso5G3g@8`Co$"A eac^=؉w5Wn^&%B5fwlmae7/w_1+.!y
n)'ڠn^"P͚c̑j0@ɰJ2<\[[kȦWmz|춷l/b߬͌)(P0%۲Y=@ nUd+KE@Q0vY C&0Umr҄VP(weZeM E@[x$I(l3ųa[>xQ2.	uA/J5_
2=Jڰ[w6R䍌$ωr8 D3Q*ICP~eY_ce7-W[vOJUi.PHcj.qbW`~I4Z }0k;OSNey'0-=h"MָJʪJ7eȱG3*xxiV[ep%F_Km{Ƃ5gB?%}p/ځR_OrZkmbK&7@TLFߏ3l*#t} rmB'Gpw/	H9ܠāJva0qf)pl%xgPFS?O7fwEHii:pa3p4t.ad7gPM*׽.moﰶ
IXV0/ÙN&;[9^>Df}=I)rOg:.hf4<w]!%t[Ksp!e.-!
Dja^#fq脗r/gSK(kK/nݡE׷KN/ѳgL3ͬ8[MTyMkQ.]a<=3j"8尲HsEWQ/&<ȯA8pk0;3zgQxo;|}w܉m;נUCuAT॰R'BY:Qd]~(8ar@wHf+4jqƮhnPġFe.afs t@cdL֜ղhAuGu̅ԙS#;ʋH6R5d2>[QԀiLtWyx-$	Z]0V@a7euRTkь.!Kl%		L6ʈY/
8XrԋϦǨE[^(	oT>V휣GAwn/>ڱڧ\;j%>v,`Q3QIf!j36KeV݈z'ݤJk@{Ȇi3D}!T,^ITצ59,J+9-"	Svy09#ޮtppnltԗ+EuX^Cp&0HiU#-85 1Ca/󩼧[s4l&iPw-}hosVU#'DU:;?A\~~A,L+#Mرپ+ߕ(Z%#+hE|Am
m0<wҔ͜VNV_%g, 1Yp5ncE,	n
R`G?:#0QgPuRt;U O+fީO` ux
*3TΓ@4N.~Űώ~CM~IlpvB"VoCs5 g+,&ڙǭ&h:!(ۊ@dPF{ߩHxGbY^~?z8yxa$s6`̩^trn2YC^+JBʦik8.)=~	倾ytE@p"y`e~o. GKߚg}!
GVBC/|nUL 3^xC4B슏Ѕ\
&w%#\Né_WcWWJȜW'	0BP+0]
J3ϝeW2,s(s+ yT(*IfTbeP):S^h3_N\4R6]%$_Ml۴4sCsOK<4h}[F5sSrGSiAT>$R	4}z;}t+"?0~:fVt;"rF1_v{~{¹ւ_ɥL[Tߺf.덍n~UMprﻺc`'pLUU?Cj6k`nhQ~r5sdon5xd;Y$d@bIfYTɜ{Cq')F,˙xĹ6Hi-L>s=W9|t?";pLh>q,Vܕ^n;uSTH'8hE	J:tο6g1{f~H?`HN̄JX2R4SIݓFkʆ@(,F	> [tt,869:F7FIP''fӮ	l1Q.yf>)^KgU$TiNx%n7pL/!Y?E B>"N((1vZm:3:Q`-8Q,YKJ#A6y+/0ԕNܐs1gW%g^+ya`g7ߍV>\B++=K{Yoo:#)m~ÊOq"ϾX,Ѳce9א0n켂ɴ-<~i]O0h*ThS%UH>LUYbt@t~g;d	~q>gl<VsiMpHrbT7͟*"H%""O5s#7=F>ye0p4S>#1 SYY:GoWSʳ4.L
WbPm4(g I;LJ8ąR]N?U9#u)zx0Z;PD	"r];\P>~at"p2:fN ?vG~^	@$˹iyhAlfs[kq$?S: oAY|A	y]c-t#S}d$xa&ͤ Y&N4a΃֘VY\N.Rrmը˘Q &;#Ka@$Ys:K3rmnh3
j3l0.dK0F=zQdvg!{sڏdTd,?h/1E-/!,JX
ܒZ0ӳrDՄZu%M(QHm&).^"/p!uW'AEN{R/SOH۞CHzb~#rPlu_z@@ostS/kCJ#%h8NyTGjѤDn!P7qj!&>vmCv/iE6=ޫALY.U@-%0}M>o<XL3~1~|w25t]1ZޙQlQ$VA%J%CjЯ$k28bQ\yʉ#	Iy܄f}-m
o@Ӳӽ	a]$AЍ珋Hr_֊tx_#ob/*IBO{O	+YkzE]-i%e:@Ϳ7aam4 r 