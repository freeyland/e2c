#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8˯JLI@ޓREQU֭IgjDM	heY Ky:{v=f؇]u " 2nJL\n?|ޫ^u:~]7W\tڝNwZkNtюwrQ440gHj]\`?	; F?WSwrQ_}E?
g 6| ?<4ps/7~: v 7RzN|V/qއ%\cou]\|Gc'kN.ů=.z͚nk{.)J?fXuƃZFH!sħn{#1;qOG,r37qY|Ey~c#wWgׇB`	.T%?xKq{LGN2%k_X 8e2=wu_6f%c@fDgo3t6d>8uOFP?$Qx`vFTh#$
(Y\Mkxtuiv]k;QśaػiO*FKK4%gSK9z^CB ~OϘg*?Vn0!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAWDE.$Π8J
+_sWFp~㿹^ltws=vti;_' (8rF}WM4d\V9ZߴAMpvas8LaoȢ`:2?Lc+*>#Ŭt--MV3'贏9moұViۍJ59Q"	ZymmWء3/ 	P*CErP;Tdg"TLiR1M*	:GG^<Emr"ZYlQ-*EE*_'ov*]"
s$dZeF`K:9V+K$2`@_1U5uGv
.0¾+Xa^p$@5frl=ݳ?XX廼	? $8G3**[~K)A9g>Y0N`+:hdcw$kDBLA2>#7f$t'l_w?WLZ?4J󭣯	+ZNhg`T=ɐ%Rw}a̞^Ϋ˝ozz]M;hiD7{qgf|{EU 9tsO iLow̚AMCD&4m<c&¸,1X@^y:E rmѼ4XN\y'NZ_Nx1%'P^EWɃ9#_y~H>G6o|uUW<tNbx!
c/K3gAsPpcuEekyTӨ.e;
/|S*_Yo79֯[ֿԭ8W?wWJ귇vŗ+U(xL9Q4"N:TsvA58NxG0/S0D(}Xd5>Vw߽'& Т"SةijĉOj,M!!Q]Ra}U#A7s7!9!l6xaEh>a[$gܝ[;[{?n7WX9&eA|!&͊V4&nO4l۫3X;UZA5kD'^cB \G 	8z9)~jU_QeO9AC8T*Y܍0o/^T*@X2"aDtuVeK
>]w"m/9zWŧ0`q_`HE	O7Jf ũm 0֕O_%J
*ʑdX_ƇqEKV=5kA\gj	 w"Y8ч~~Y&E0HU-H_	1eiƹ^!rfl@VyI_t}HT:E7ߤW?YMAv2+K'g6aow
s^TPγY
ޫg򌂢49Yym}?F '`%G\!Fj^bNKԩ	2]"
-xPK<LP$n>< mr:0ds ֚!֌)rvmn8:AF,Bi'\|끃Uǐ]pg(r,?#tc-H	g8feS?qv%}
sJj>eܖu +ɕ𨏯74	6׻SD\"ԫ_A㜾`<KVes}KlQ
\V8w*r[,Kڥ__v;G!**ִ̙?EΞxdS{ϐ_ml}3\t<!A!zQKZRY3Gh.K
2(忈ݔ=|H${c׊/&nTN~&˒i"x#Fȉy+Xb+Pq02k@oz6{}ӛ~D\՞<}?kJa!%34A/,:P'9|[(%,t$UP|Ӣ:x6T%r"w0]'E٬Ֆ,VɵV7oZVlwl ]rH.STƮ#x*7W6$;[);F93:a"iA~4l
I9e5)\z˫V`~n/ޯ }g%3F}*iB"k,ub⥡)@WARj !AD&x|1g9Ln蔮_/}'S2=yßm7hx"VGF0lv5&&6i+U,ICx7-eSX@Z>8m+f?练C 1g0 b"J-D1;ެjmQׄ?mMV`/-$eD$KŒJ($=,@D9P@P|䜨-ǂyzծ]Rz69-hžp5.hi\fe_q*E&yö\BxUJ49g	L>;Qa$19qq^lʘYs6GZBrCXb81:EVRp!T\&|Vgä%XRuMv BeHK"KI$10 US`YWFK!˗Ǘ×)vSQouQaa8ZCb(D"`M^H[*mگJ<zD1ZZW&Њ6PuP n.%6gF2$̺Dhi
nR53JSЦd.;"'?e,*+3h*v?x֋bdX]6Ԓ\L7*sNŔQPKf5-Ýn15} }$mWOG'$3	gUyRo	HWd\,BUX 5rZъF̾2mt5ÛLE'uFwKbEr^Gƹn&}1<`L>tcxY\+tr PFCw5DEXԔa8e_:1:\X1[h'y-+9sK4
ŹisY=rs0;=,EZ
>(f@Nj*H
Hr@d%9 MBX+]3=_YA)F]IV?G#'<g@_5RP,HaiD"VbOgWWo^]]U~\iQ\jjɍC_}G͕Ȳ5R'2lﶮ"7>D 9R%5{%k|vXw^RU󎓓IWvd|ǞhE//0a[OƎml7[4򹚣Yn4`n6yxfImafc"m
_;2'd#VVFtvZ"G(3JwlZ4Ke_4ޟww[o^zgt\Dy(
ϼ?`F|@#Tg6}@QƧڂf:STˡ>/ <,? P=tЃ:?W=n(J;rjJ~ӠB&Y,HYH^*+t)~&dv4f%܁FDUؕT~ŭdKDg~+@'u^l]P
Ȣ,7 [Xr,XrQF
Yvz
+]YH莃ؕg"$oe);u0Qj^0cL2ι}h
3cdthD+DggԪ*:Aic v8٢.=WT!82*+%khjRQ-)ܟ_]X+,ܯѕ<	sy3 [=GWsC&վMO8J#FD[1jqr>n2ςtHgTYnDx*9'Ek-ڀu6{| m
(O8W:<r !
foAO
el&jse{+&ۈ#I1w+	Y: ʈQF@o	Qd0vx/%=2xhیw4^/˲vIQWNG8ʞkf5(Q^ݲN+5?"f[kY[ZdI)S_jq
4Pf|[IJ2POHvt"7rK~<뀅/ZQ5?C#ɀ"SHIy@@!;P#M;K?[Ebuq^1L4η'.I^e\9%d6L94I+L,H$fyP<O=Aj,-/H.j^ϑj>*fH3-})v1{"}dj)7% L(7ԪZ	-!0x+`dqяhGʤF 6:$kՠQNLV<W"S5[¥Fd|~廄NåTQPZ	u	%HT1jeS`%ԄN Ŀ?wvF۟ FCw
ZkzO.,F?0S˛~~;9?ޗb|s:Ӳt5N@3c"|&ϤgFK5ۄnʨh`9}Ho~QIFrâ"?=m	)i<}-zۓi&MM*xmKE3Å[&WUrFB4RF`}w,AmͰS>T:&)p'o<!wyibPҤfdpw$?CJTCyt#BopPv	&8tS=:-T=7%k<,j6zω"qYF.2O`|+Oi0I@qs|HʑNr7 9hG0z&UprsUKaRIx,
ir2)aA|JU$}Mr=ΤR&dx*{il<g*ymB+:ql,UF# YBX[sĴs8CƘ&4-)SzOpy!X\gB$N1ZaQ1Pa''a r7T(OŃ<SBTH( ѰZ

0_-ep fe쎂q`8HG5刘
17rIDyǜ#v2 <fH aMu(b~&$r&mxc{PɅ?0b3?Jo)i7/1Ӽu ;.)f(S9lH4\R9צd}a<;S{	@3@yBj`P??-I҂`SYQk:jBGaP*
:F#:凟&iz.31=XEP|m,M%"]DveKDϒd-CKFJhe,t@//VttMG޴MK4MCޘe-YB +H.K.Kf-k:dYAREJzۜ讑$-Qn$wZrM]+k$) Lk&mh&4
h$IEII9:KwIDFrȧ't82-KF[U,87,<y4qn%S-Jd
:eMÑЭm
e'yhG-Bp-ШW5q[Wj{h2s	|YfbʤۼItz5vH_!+y*ueYzhH%Q@U{)GELT@LE"^UϬ
\%ƥ8'ͷ(R֓^͖W0D+tEe}6=x3{R"+!L8&tI|aD/j*G]Vq:_qYZrp*k h*K2Ld80\]k,&aW~Xȸwo`$$OpUPֳ@o^
2F+{닒5C&knfsOT"h<,ҕ./uʆT	I(KZ-u*- u#U? !x74e5$sd=/@iÛ<_42
{ J̑ Q@7!F2ZdsUZ@Nxq!JoBFekJ`F}ѤŸ̿ԓh4mcTU{s#}=
<xAp\e dF$l	^y7`N}}wĞ|9+?Wܘ~~yEןF^AXm[0B'4(U~ΩQ&X4:@;Q"Q歑GD9y(%LI"M`rЙ/FeFsX,hN\S`6|Ϗ;Uf:}Jqͽz(2KbcL`ɖDMFQ[$J4I*?_'{]2[D"Ys7\]WV!]^a{}`үk nуn bؠןOo,C+yUrU|9cʫ3i4<1m\^#z@YִrI$G2`gХE,cC33&?7dfY	4J}VH<JDwtdj/b8t2>/)tbd`Rsv]d{,<BXɚjFu2 	9LmjH*AT%Qnhvf\Yll
%vjEa
V;貌z-/@\9y%
stҏf3w16mPȽ$nn(|X7fU&3 `)[,,e!ܬo6]~4ˑW6?Rh3˪u{$y=qeM֍%BCVO[X/ki=p]Z#ew:K&N5 <9Q:/MX
[ɩfD8y~jJJ}^ʫ,f7lNSqoEׅφ(P!eO~^q6`M\F5/i6k:zPsT`ޠ.3rZjCڠt6eFPaay"%
 /5aKkic{*JTiv.lgXP[99سܗAxt7k۾o,j5q)DȟY!ynVTB)Wa4*VJZΔcNhZ1N49n[<jي0}\h/Pp.>z,/am/\hNHY\6^f?OȅCp7kaBoLnRQcsM=ԳR"7,UmJc~>$YKFn^*[as}/jL2uy1| R (?оWnqQƫ3_n5mhihH=lR~ds^QQ6\+^g[[o\BMx.'΃pfk^=3D	8:֌c/L3/Ɏ>cnT2좗\ EYz:;>yYXZ!0;ccaj:r)P`]|Ϋboj/w wV螇^º/_cDqQ!M?]s7n@ۅ"r@L0@[ xpp!aC|;8ep4oMj!,'Bc9aЪcX(N'T8шx>Wx2)EE2ަAԸ`wdzt]094Нܒp	"Pp':d 9`kmW&7t'b 
LkQwb1gF!Nvs}1۝rٍHK6_`|uTt!aw:raojܕR'`e71n@Q+}騑PjB7Б	"^2+gusX7nfX]NG,ޮ9w-|O0CaG򀞷BzWf6ZA>wH{BaeʘYcGfXM
(_j=^^)B3	@oB|+`*j7R$l:96j ּy<BU٦䮏qnQ%Pr4l'sL^ILY |w#2梺ҏ#_y>=@C-5:HT<Ǯ2~r2!,7;⨷* TzԨG'*(ekLt\}w'lf;NI[![lqGHer3Ɉ38oV=5kA*ELK&I-tr.(әBjJ61Lj-4ɴ꾅RjUpraKFWWbSyT]^=5zQ b4fր5,x0Uɫ|LtU㎝ o()-K7`sxd9H:BMTjv)iJ-QyдEd.d'zB{ζ2mp6 Sё誊ʠYŗ*lܤ P[Iujǌjf[9*sQƯn#ڶt}#j2B2FfatjN{Y7fhMP BuaoK6f{F<CG%/7'XX Ws4;pӬ#I|qvP\ǧ@a7OoqK5Yc6=j㐙)5mR22o*PT!Q/tr-UrRhԧΚ$k5[v8٦(?Crj;g?c@\Z8vj׌Vzu3OldM7ta2)&w֘fj 0"nBE81NQܤ0(ˋ08rluRBaGT1"m
~viV&I炟HCOڧ ߙDaCg4;KДqiʞ`|vvԀ?Kdn=ԃFϔqյI3jؓ]o9h20c3Zy0YSxjF|'x%XH BEq^*tƞt	89@5<x"вNؓD^TJVXP%{BR8諥ԺMm.|ڮBkGYLÒYgOVB¢^͂C9@0qN9r.(TC|W'0.RV/!!ICs[䘀^epRCXy̬8\i4Pf_ɞYk<MX@k1$Z$LbF8]ZGaAw3 13tѲD_'4\ ctƝ[R$)B5,*Oyu>y@ `EexY탶󗄩M`/yjAVLbOTYpxzSIIi%i[AWH-9ExOIըU/VAi"K/%,sGCb'pHf~uqMO.G$"^
s1˔]JV<m65I.yL1goqy9[L,lKVeN,Zj,[f+.G=רwRPz-LM%ӶI [x}U;q3Ĵ;-`@/E^|'ei" P1Y5&])xC?5bf,G,a@}
f)yj&/|sԯ Je4(YLKy*ndd.+J?jv69?-no~+TS5WYd7Btd_Lt̕մY*S߆S 8-m3`V]w̍"3D"}anS'faI!Q1_|K{\Owiָg҅xӞ"VfJaB]HHY9fbZ4vVxsօkMua޺Mz7kq޸v)m1zͼ~)f1Ѳy}jQT_=D ٖC|Bm,̎
n'$Ir9h )ld" OjҨj%jYYnKS*QU_7,A/~ƀ\]XZϵ}-p6|ڨK7,Aybȋ IQ[ֱ7FΑ;1Ok#8[4@FfHJ`f-Zh`Y-'U;	pW^*zoR}蔚s0GqF65$C3	2Rw4[MCUo  \.&WTIiI|f-K`'>'IIEUQvz}
%슯7pO4G4qh02T?x0P>}w]]1yQc|vw~V尬	DFH_}5ƕHgko!7eg_+j/	f?qωx׬$GM]jgSdBC9{-8'c* 3A͎ʠ{V!A/um7w@|S'CPg6W/pF[́6BWpL U^bN513<n	̼K[D<Ëx)6(O6B$RAq[T*3m>2,`@},S*KMAI%^]`h:RnNTo.yF(iv´hPuYdoAd>/yi6YI/N@%Gx#'TIȥB/iӍk+<?Wڔ|hzۋ$3ILkեi[g,p'Q\3Hl*xzG>i<4<EQS֦G:OD?--䜞r:ϺYBB^}LK,i{uXU'7<56Gt
Px(Du>c<ק?Y1/v=Ơ;2ڰq3bzrcSǕzg( AzYCnMyZs͍nRP/i7^~jQAώn鴂qg }9aQNyʌ`TC9Pl{^nTua^T5P`+1-\\?HUeUaW+zN>HMQATMJO_/5S:(imvupUyĉj֔kyU3SˬDVUm4GSDʡb0o#/ۇ%秊m^yI>JK6gg0aS>*ܖ~׈L57C[2u^>-0o3Z	Eݮgb[cY1#EkfRY4Z'?"Z?sa1]CÈ<ޚsfqBG7ç<a\G/#rJa%ko[DMMVtpBKgy'/8/ <lwogO) VْTl`,N#XC7UOOS^e65@줄fOՖOx:<L8榠+`MoI*W1+r% }2Ed\Ot^Y) p#%\_]	Fp! SQO9:Ot0M[7(݊G2'q\|}JyQR^_{>4G覕G$~ `RJ{Od꠯E%ns%ǹIuQhYt-豜&ti?sWoɢxlg݃ӫO܁wOZt=?؅d\YƇU,>&oE+$k A5]
#1rJnu$3m QCGxϧJ~D 14ۀ$1хD~/ B)bЋsb3׆?|G'\Hӈ\.:<#'i$^s~kj<7ͧ0D{FFkA\!v%`(Dwg0,tnNVs0S9M{Z.JiPB{x*+gABfWd)JEӿ@tz@1! ϟk90["rW=cBCۥ#%^q0dG]Su7,: o0:sRsol.k$}5*)raO.R0q`&bӼxߢyjhCX7V(陂/u2s{uRQW0IB+.LGe2/hD"%ܤi{V20J=|W	,9Eovkt;* (rR6xBHTa&t~?Fokf~i-i c>v#:˙Gv]F
JZyuT8:\j@mP8毯ՈA1VCmh5Īk5_P!Q*R'#@b l dtn-	`&
b9@GiD,4qC> W/IOa4b؆X-VL@sL`F;
ۤEBr'gSG!**[nOFKgz9\fqeX˺ВFY(wrc[|eƷRC8R	;Rљ	F0Ca4,`_D:,+PB4[ys^W[cRhHzԃ'oea!?>M~F_jEͯDtϹQa%\t+uͻލZ>9[-g0xsDϠr0ΰd$H**VSW4:H3Hӑ/p5Gy"Ij2E23v6tGHz
j7N]{df	[1Vq䁤57?!G82*@tR)6v}\-u)\ Κ,XZR% 4fki["98Ch1=tw/)gkvGL6hk;EaFx:XSßϏ1ǔ:+#E|,$1/^{'a0 >IH]1_Ӈo0|ySx
f
*K/-(NPf8qLgp8ڕ0maiyMHܩ3E,;'ފ<Aʀ$Q:(|%-i|ʶn_љ88Rwu7Aج'ոd j3ȱ^69RzXM Jjg-c˨g+|ΫgLq{*YX*?iϛV*?c'gxΎ(h3@X}FT1	>Dk9h.~K7vN6ozДڈGx.Pltc<<s%Xigx|o2	ڌ><15yJziG]
4	R.h^&!I-n3UM^Oր[$HgiX/YA^sϙhͺDho&CrDQMɨ|BdGa3|~=mF߂]r\wDQ])=ղ'i$.(E֛2,搊W(#[Ǎ-{ 2x.G	l"`ҷ0.'r*7pC{Ś둡O({BYIl._BgEj/5XSKEk"7P+QP69a'qe;ot-ȯ9wc 'e>?=^ȰK #˥**nnrW`x4.XOI(yiy\{Z/#-?YnLk(8q殨rxNW+@[`1J2iC~?4aF:o₍vB%6(i~1̴5^@>8x&#~1Om\a&tиH1(,E6(Y\OjKo0`lVwPy7bb|fh}pn>r5T
9g"2W-!]՜;"Ap\{Y^sd;0ED:;rs8Vwt3	flՋUx,EBEv:$];7[tg l*Qk	Ϣ_?.~掲uDB9xMP:存^tm)qђUdp@͙a/gfB[%hw27ĳOWW95-'7ĳ5nr?!K4\m@V'}g2as- :{QDKv=OX<'$>h8	wC/V:(iKMDwTh")ܜXl0<{dNTgAuYvz(ʚeqL`9y˶<i<< *6oiN-w2EŉfϬN]gr!dyaRh&+E

.<lL=kجMP%sZeA,)O:1mԓ'JyA(~|lZF&5yfgLL1gcv~qw?~q([1(YRurEv-Q:F.֛m+.hu:VnwXi5un5%7rC4\P#ڑN.똳kZ{mֽ~}?ww;vo܏r? c{5vminYo%y^_Zzm;b!D`N~VdtzqiB0~:rvC.2;a%i0aq":w2%Ճő^(ukTL3<oyt0lC>5g]	Α˚ ϽKGN@e&WN~\@NFma\WY#!&m7]ۘH	"f"W|

 /S7v/Ť(i~}?=>%Rz#z(}I%	Gu&ǂ9wu͗K<yl`rZ]3dmuu	Fq(mI-"$Sjh8)swhMpMh B6 M`#4?c9t$5סnˋK܋i҃9czK
>?}$ λiXʳg9&A02fkdAi	|vnpf]Ӯr#cxqZ*܉H3͑yAN3F%M..ܴ\bRQmM`n2`Laf%L }%{&]VppFSg5_PZ"JZĩʭY҆~	M_;Ia0_tl0uUw#z
UFP}zl6	tgqe[@H`gntG֏Z	kR֩[m*cN<8Mu?4<$V/2AY&Y?l6{dݩ,-ȧcN"$Ws_C0HS`-cɓaZbjQ$(*|cVK9AD'Y4AWM}n',8c׻ r[mνN4!)7M(nΛM]^HTO4v_հkWxtЈd[`9|v)V;4F<&8(ںin&_Dj/3ǿz|`XN{?*_hYd<FƠ%S΋7)NIf`Y;
-S	AJx*2<rW8:fZVnz[]\dwsiIz{scϼ@18~DLߞnTcxřzw7[zh/^oo>~jg˃ݗ;NOr?GM1? o'h|F@>%`?~}O6|_y}E0dRr;xPT$"z͏ozkvSɳ^nݴlwױi´6-[{[{O=Ɨ?a(n* _z?4⯭T__UO~1?7 m-de<Bd씉 :y	 Gi	)z6+,QXaI]o^ny
]*L(Lao
`o5\i6w֛\3~_dv@۴얦q?9
k0W({[;w߅҄E'&t`f?l#?@kf 7jhe%:Fl &#&#ՓwgfvVgΞU/ܹ<gcuw_zC[pL~e~-	N9PjAM`w"$lv;AJ%YKM
'=T?*۳#ewv<QY8(˜$KZ|ӂŸmsxsI%"d{Ӓr%ٗ8y9pdvq/wFd=jjcDM pFJߧ%uk&y5݆X@QkNo\"{+)נ+C2~b8o]Qn&9Bh*Qwv66st_n0̲]eNs*TF\#R%!+Vbj R"'WkōNw9hEdnHk{2ϕh'Gn>vNǝ\IKy߼:fVs-[wr	͡L=p/<	q}7 H!ֺxOȋczu %z_վICŐAj
L_2-FKx=c}?mQ>x#;|Oovӥ'ҫ~qSXOn1߫=xnWħ؋G4@ݓdDҫy9
](AUνa|(yZ7gdEp^/hFУJY)wRxT'P2nR賱IPG6xuY]lqӠ?MN>c#J	H=(7ك4PjGms=02%P{7
[ƃHcqC=<uQ8WǧeVC@ݾn?il~QO`gF>>.L&pZ!^ԢGǣ_Vf}޲քW
p+*׭(b.N`J;FVt@PFg;0!60.=v|kM{"[O2kmnw4`q+h$FӤfvvY	F9.nli:GB2$6kvJh5gcs}]ZD)fcXC(bcJ&5h4G
-l[LA 2pWǥN;S̚829w$wRߔI,c`fybMքOeŞ6X4vF#s?]&Šw9.=w6OT7K=2%44tnM|wv)z podkҐnCrhݱR0<3*h=t_O +;M	`$QL>ݠQp<BΩVn$1Ҭ>RTPQkj!V)Ls=#/peE iXbš BgJabJ,?dOoѣG
YjdDy	r=32zS&騚Y`#dE#%GOjB`R˛'(a~蝱WXIE'NCWyT8xvE#+(>vMWrgXAyU{А^^emҜO햽jo7Zc]@ugƆ]o~خDd#S[y^a^gκn|mU6Bһ5{D?Q҆nF{{}ȴ1e7:]Ѱ[k?ή  ;eQm;k4ZvNc  κmX[m@ٰzW7;6GVcnvdaٲ7ZVc7kVs׭VZմ*2x6nڀq :[|6ֈOЂr kmu{mcmPtm|lm$hzjze5թSS́<[,Bnw)RX;PP6Vsrzדn訋lXz6H:^<q$ D^%ѬίfwnVcc7Zv(5Y>t@S	݋ku(I6]_;YXO6c[ϭ&o4`jjVX]n-c_لвxS⦀[66Qog
%7mhDQϿ6HݭVsPB%vC4۪7g}}M>at"Doеubn5a)aׁ^oHcX<AA`%o0Z9~}?R;68;(STQNZo,>9
>udP鲡̧0ΕDe|d߶9 _ ĀUk2`ﳋBIAA/}@cKA1Wj1>$li/6O`@a-U́}ϧOVY*ű?7L![~Ȏ.sg;d[j"8'5.ӡ/k-^shC(o7mց6hVWGNt,i~"]2Q~o,Ni_؊H!S.׫W+\ޓQp<L*EoJRWEm{<@.2qU/]9oS^Sޮҏ|JΩ?̓gZz%os5 W9rj/ǇB[t]\,2e/#)/3BxI|&$-+,}IaO>0Vޙ8*I(O?x>H9%F;aEk2;VWw+W'K.>>Pʪ!4OnLҷt Zc!{`VD̊ˍxu>?B1HwҥP'AhWi72I:';X:WM|`Hw4c*+9I	/^GYCo|񐣆?|}n06߿xU&ZPM$]8Q:."hi5e!$K K50FQY2n4e(rC=G/-7TRR5Y~2,V7RIUK0eB\UMZ˫'VVpN#QA0#J"s
9prp.s`鴱E09 \NPeR+Gl/8^@/e#]P{y߫7t*Ip.eVbvShfTjN1NyȨ?4޼2dTaE湜pLA:͆RUFnR!{JkԫL#Cf z a(Ĉ>߫ -@/EcCgj z˭Kjgo}9sFЉ}nnoc? uk社zwK&*UO ?3$EDDTAvJ4mkrC;`$V9^&&Fw	Z.ZDČ% acfXdY&xgVg8 ēK݅}$|.{J3ŞAUTFj6ʄ;C'c'hmΕͦ1[*9>qiC__wDvѡ"I4	3" O0HcUJbRNʻMJ~$z&G!&t%a8cP$(LLi򧄟Dr+?=U朊EF4bcc1y襤jlZ++px
-6qN Hӓ;J̖fMwй`XcY	W͔F5=?毈14Y=mk_^HGM<6F*U	;L-,>#Ny#YE/*Ib-NjAWEx CO	#]i d7Lrۜ(GeE	"&9 2h4]`(% s#gPy~;?pvpϧNt*j4Y
Q'!-"96$%r	(1+pD22<v.;w"1eArfFR|A K	P%O_es*(KJ]͋;M"^cjջuRvZ9s3(/͜ᐂuIV-N"D1.{N o6c'n߹\~)@OtK
gh(
;~^9޼?yŬP9*PPkP$׮NufM1 	gavMdXLBbRN_T5d۫67=>]Ќ|Ovgo6XoօfFQq UɒTm,s`h 7UKT2"K(,!\6V9iBpIR(?ừ2XL<R -<t{
$و-d|~IlE߿yl{	fFJqpxSQn@mJ̭;OFF ehRtI{D	Sf9yTD(Ƥ!kjv߯Ok|U]SR$ 3f.$<zĸK?]	`qzfmC<)푊T~"ёӒSI*d{ītSF-QY~OJ9lrF6o\6~ZQl4޲a,Xcy& 3[2b8m P*%$%-f ^dri
Ddnh1æ>B~їɻ@,g&d.z<G}1L3JL\
a'F7jvP rf2᛹{Ǚ,zFae!|;qmvWpQv\S߀`:s˼f'#<?hzVvAo{W(HǲBŇy9@t2ٱLHo׳zb)tFfLC\c|URB?W
R"R@d-A5kV{NxQ{18u@_@Yc^zq-XO_txP=Meif%&X8hCmZu3 pٰ?Q9.E̞+=}z1!D~5[s|Xޙ7;{fN,oڹ
}{</u
?y"7й"RCkBmC*6+_Q3vFs"5*siE4< Ȧb#gE360?d.<XΜjT^D!LْόʧO{d*gh Co!Iu".(\kft\2e-YMHgVFzQ'^|:=B,G!N0~08jg=2E3v}ю>Q+cfN7tWٵY*Fk~u=&}Ơ^VR]sC6LtGeH6!bAJB6Q`QZiqLϻɑ^Yv)SŬuwm\-s:3QdP_M=8FJQlaǁ F
{QO=ۗ!`[0	u/hL2L+Q]}|FsZmZ=$*ב$1B+S0e`aZ9DnXE\DђT/AYA[F/⛷jSPnYQghG\-܇h朰rOL*9dyςqs6Kr`%O@qS {Xl=|4,珉͇):=ۆSݩyr_1N| {634ܖPHPRv ` s-v	+M}v3Jhrsb㔌zr9[f!5<n5A^F!A(V$#j4:N_Avϙ_ă@8℥Ȃ@ͻƋ$ISeN
cߍUuAJM8YR4(T6M[áE8Lmw\M)yN(S+(<EЀ3;,{s8ZF_֔>ceyM'(?zIp(Ob %̅:x%
`|.@KK`r2$Pz9;xu9/y
K2 #?P
Eؼ$% .Ei8ܩZ}y-"=8WH"d8H%V*0W]gmV㋉F5XTʦ䫉mfNzzhi~aèfNxB^`]gSy5-HRܧ"ՕPY3oRWoޗ/nE'&QǬuttnGt_(F?x֋ޟww[o1TA;Zг+v5cۭ6[k0׺{Owrsu9\-DYC1`r`pJțf-L/CPMSȪM#AjM3o6TFQ94q?9\Y:C9|]<,62^13';QƬޔ9֝BϒbĲ<q{a󝭞s xG#cG

meHkk_l&E&Z9%i6))a;ڜU`E9! ;13a_ht|JE76ܰp&SBjO,*^ xn]$@R<CXXgzc$:k$	qLi6Oʭm52Ռ㮁YFu^E2JFU
\W=Ym"$КkChgC$S7#=,;vZm:1W䪾MgXV%5تx+ݬxҹ~:wqe_=jؙ_=wcռ}'׻`#kK '1<A}<gn4B{J۸<:,z,iܟȳo=V!xXZzg~5$LKۯE2K~O_+;VǌvZo#_kwr880IwB%Z2إAHpR2%/M}#1h@\֝}*J-^.-)Zb$}X4.KH,?@P+H-- <i$A@%($A]-6A7V ^]k0_!%PR(u7cYJ*K~w.K5c=Y:uw$A$z5C{K? 8Y?r&9NV?;CugFɍ߄|RAZmuAu>&23 	U8[\^@W]3)HwNuú:FTDLJuejk5ӂ'][>8!E)HL kvb \LMԼlBg*IU<Ht2UP9$jJ9Wǝ"Eo.'W?ݢվx1ShL		F׈%K; R+6+>٦bHhpEѨf̠2Z;b۰
+A6jhy珯?E.{t/b66+._XY'"B ] &Ƨ߰6CoGXfm@Rz	t6<M3t'~}A޻&4O1YNZ3Ԑ=Sr>Sv/mz^EU".A"i+#8`Life)ҥ0S^2zSyVv	`!5:yf:YpHOmK\VpDH(bW5o['g08G65Iۦ3Hga,OJ=dtf]vBlys:L/?Cgo8x~t#5*8-we<Lsb1-w|w
p
߆_O l 