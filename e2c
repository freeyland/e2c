#!/bin/bash

declare -r e2c_version="0.3.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_res="$(pwd)"
    e2c_global up
    cd "$e2c_res"

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ũ] v8(د_U-dSrJ%U[Kr]VQv&E2%,u<Üs:s֚YsyYkfD  Af$Uݢ  {yF2_qfunjkNU9ݡz q	юwrQ44x}E?mv{Fi..#-U*F???-N.Q0p>xw}E<硁?ޏ;?FWKnk|*ywֿt/yC=>|.	z?;/4~YSfn/U=d;"a/c&Ȁ]gn<nΈ4X2ǿ`A|ꆕىǞ¼8baĎ`S/4DˎQp^{]$](?x5
#'t]	MČ?(顸Oѱ;qs82;?$B8.8>yÜ1@kCSd$	CiŀfnDFouz_dfk7_ů-1kwr5{4=vxۏË7w8T3+wn}1TR>n5ƐD{;3fG:6&1Qx=p;21|$Fe2=H%;we?P/tz]LV6`w۝'sDwcYO@'hb0h!;8A~Bo[;`
%~CѐA_܏`'F`cGыYrU*Cw@2ؙ^tz9mڵ[UVj-9Q"	Zyz*.6m&mTف3/.H^..E`ZE`Z`r#/6MmST6l6l5ר
GY$
dRcD`K29֪0Z:f%%e]Ѷ]
GL%}euKZufOCOG#z&ka.ouif\^YWͣ**[~K)A 3W},Xx'~I~}I^j4c1kM;ߵt*"! k8ȍ%;		[LZ?4J󭣯	+uQM5O,$c{le5~wsΟw Ix˂5[o#1}lF+\[ЇҪą7pbšŁ'Eы±>y0|d+7>{|Fk&5sI8 ҙQM@9sFdCT/55a_2>_W(-ʷM{x^Xk{+%Q5.Hj5#)n<}&qKSoў脡si6|0qGDttǓ|w8H#nەP,Dߪ2QCBIEmId*}s3WIpt8qEKS(AzMB88|_ӈ ޡ;-jl\G4~K4bsogko{swǍFW`%AB;'0(lA0q_gk~'u^xCy:C/1[
r!hX|ΫW/5J(JRǲťo<ڍ]8~Z]P`EAF$K5&PQ.g鲂8/iIwW|: $[ڋTY4lAqs($hyJ.}z\< u+H2,y⃸%]Ya+K5k+e>Z-	 /wk"a~YDTX3!|lZ0st|%Ĕ}#^/
ol@ /^^rak!1N7)W0>xΫ͏o
×Y_:<	;ϾdzQg;{ 3
@esޏl< 7g6/\Բ0n)F^y,*1RJ	s~&J@MؔiSi1Z'fM3a+ <MN'UlN6 f`fXk9oVwDC'<ePQ	2-`ysLG#<s!igB~wt©cY~ڍQ	UJ*:qcF]68uwhW3++0>jʧ۲N`e;JA"Fzw ͅ!BUa;Z2	 h%k\K-e Y:(71LɎ ٝ/;|ãE@u)s÷{ۻUfMlgȌ/67ٴ$DЍC1&-{y8O~g=Uc<AuW)#~)χGhSĻfRd`͔=LAM	ek7N~&K՗i~{܃59)F݄`j>Pxʱud@yo[tOoprrT|;QG<˅̰NުGCyXDm|cȖIóP`&BWNلRMϹ{T4tqte^_2pz5KXԿiZY:ݑtU!@Sr|Gng@{@W`D%Ov&(;F3>a"iA~4"ȗ
I9e1%9\K+-a_ǯ^~W
ɯG1?)= $ӄ2E֔Y"[ĒKS]J$؄T#B-/So! n`.J	{)]$5mo\[	Odzw?lwe3Ej[ۓ9KZ,JK65iTP6e3KVڻbQs;y0s ~T`޳wYL[%/	/	z,%ĕ_[YIlW-iD$KŒJ:&cf#?*bJ!foc b/}|䜨hϼʾ*ThH[Օ-Ŏs7.i=[f_+ <[Yb[.!I<jEP0)eS橏NVNROaϦ<zw>T`%R9NUX]bPu[0$H'FS%QRqMvBUPK"Kp$0 U)dQ/&E^	///~/SUM+KӠ1.f"`'z!y6d0Dȩ6~S5ѡhiEG_HhZ@+CAAus(19C1ݤ$1f%ݸ]E#MkVpSjvI#LmGA\O9.`ץYtaE~AS$زf?xbKdX\2㴒<L7ZxFtQPKf%-l1-/y}$mOG'$3
g{dA"&Z`i*!ըj5:ǸHٲ8"Ae64h)e-/	|UqyL6b<y>t-sDbfH{fkt滵f6NzZsh֫Sܝu^9,ȿF1Z9L~םLCK&LD6rV۸P'E:ό$'E"[$/lĪح^]"Nq	r8^N)0JZI_&?	oHoN`5ÿZ*	U):س -0/[#>}w]]1yEtuuKT=%"r-'Go5g%G7q\,;hkZz"vo*#y73Y^R7?r5<89tjPNp)֐&&0l6_c Ldjf?Ws43mVMϝYv[$01
m	/s AkH]z:;U4x;MQҼt}gxq8_(Jݿlmn}߯:s"HFUVt%#T0
 9fhDx:,G5>4ӉEh\!~!Ǘc1DyU|q|IO,7.D<J9oj
wFH~Q*rq\&Z2
XV$9BSLbKL	K$TAaLM303EcJ&sIUb-o%[eUNܷRW[VUZ(oʢWXnUXhobQ 'lnpaa{&r58]yHKJqSS[N%=KVI9O`MajBԹ~~
(&]aC
BZZY'D`2ZL*cXq;l\֔HڐFt:Aeu4k)agK'z`ῆ.tvvF%ϟ/ǌ.tw`I5,!li1gQ1Qf(>RQNY0		 pc#3_ɹ.-SѮ;KHpS@i|9pȁzqG$7l^&nr 83?1YFT	3GhWMɜQL$t8 GBiݮϯËwd}.iV@S>f\<fʘdIV]M!rjuę$UB6AErZ	A0o:=l܋3DQR	I瞟-D|+TREeuC7^C$y'72Hz_3s$ty0S:]L8UF+hr$Wf>X[,; 5ᔆ	$%0yH.lxmIG<8i|)杷wcODSL9f)	R՜P*=!v\|^)I	T=ɜюTybsH/ίp`Eϕx+DB28ĪM֖R
S҈ "֪jdL	DWHeOMX$\jk'nވ`Ztg̼BU?L=+wr:Ax_z$#I733q$%]~ <`m@-zk޺!2HQ{8s^)UY'IFr"13~R|x<v9zۓ^Y&M]/*xl:ݺJZCHs&^y\B&WRE800h0!FQV3RȳS#9PR	7̃ܵKczCҡA-L{̓5&1$$*ҡ4Pt3*11	P=[vLn/YjPg{7
?zQCAr#u38tzoiCe1;	(>/('G!KL?<RG3[pZR<\}]7tң몳(-l»F3D@R	$HKI߄OEr/vsFޯ.iS13(=ZC./Ʋ=*m,⯯Y9:s8CƘ\-)Sz[&OH#Hm˕GD&CZ˝St.//`w*0TV]0$`q 8D eS@qţhĔEK6UDlXa˯LKR5;e.ĒExgBN"(G0U9|ULčw9B&E֦
^IXplr`ʴOU7'TRʾtx?τj~&	gLX)ۃGn)!UVC4&F聟ii5"-f!UJ1~V1zjsYwyxկALAԠO(_A5KnDm-a"U]"쑀.C$ɛțiɛ1_e)Y,B H_|CV!+ߐo7dYQ-K2dY@_"%=Ԡb7k&wT|v2&v=[KV^rI]~
^+JJ  4$͢$$IÜd祻$]3ˏg`'t82-K[b,8D&CR%&-&Є)XJI!24i*f2Ny';9:FQYr#5E]~ĿjQ^!WZQߧ^p%K3Lβe)}wE@ЎXKg./Z?ޚRMU˅T_'{AdgrTʔaIL@H*
U瞆KKy/q$Ov7R֓^͖W(ĵ*[E>Q>\W啐H&6An$>0V	m-
3	".x}-nCQK<Ț]%Qk&2ef.5+?,d70`hN&T%PDB,̽Jald+Btu}ܐxeZYܓ-*Z,&GXDఄt;D]籠1+nBR{9hK{bBHAO.@<lͦ5M'q{si-'	*$dhYduF&䡩.3"0ؕ:Y
xh$/soE9==aPD!G&aTN_	
- =jl lM:]M=ݑ{BfU7?	L^kJކ>F\77S^hjW݌a!UH6//nD"ʶ=WВ_xZTg޷zGɗIxōOA]pieTѶ,̈> ?ϮӜss2^	n7꽮
弣H %87}ա$5TFXК-܅0`֍?vϏcud:QGqͽ(2KbcL1DɖDMFR#l_$Wui=.s-"g,F,5jW5ڐ.n`_E7.-@Gy[Ilϧ7yp^NjO45NTFdj0]i-{K)Rc)ᴰr5wv}KEM֖3/hHfG\sE\ 20;um>加V)Vlc#8`Z^2l/#QS~,\q/F;<k
Hf+5i_dnh90i͚h(/̮V5WFS8k.?`+Zg~_,y1Q3yˢu{b^[ObEu~L&pQՃZr\d~~-LzNm)ĩ&PŘE^S8sϩ<ffgzGNI}з^ʫd昹f7lNS/q0{Đy6E7p2lTeyH^LR\GW7WxNsYyhq EO@<IeyTO$3] li}0`l|"IEwU3`Ĕ9etE^t,8d'oNe3W1F>;hw?BR&<E򝈟1K1
'_j "k~NBuUkR;}k8Z-mgF`n_@^:gpɠjBG@sB%!2ulbG.\ԛ>,nqZsa򝛗2a`2˂gErxuw$Ia֒axެ.μZy$PݏÇ蛄-(HݐTMGz5>"֟{WE0A.۽'΃pfso_>3DAfucf~8LyOK͘w2a6s*,[bU<,,hx3g9R拂jͭ|bo*UA	;+tC/vay5z~Lq?#8?:.{CHs}7.{~d "r`66ׁ>IfPA-ǻ%zwWVY=Z_!&XSw4
欃V_9
78^pB>AbRM\Ά;CzpO94ofUߥ^8)NCI`h }iH6QappLeN|Cw2
.6y{l󬺯$x$~s;]})b/dfWu~lp⟭<0,nRF.jXr֥:v7</kp(}QJY~d^yAgpP13Jso*f&`{w9fN	,֮['oל_>)ˉ'oGt':b kiDaʟsB7(!ab5(4,<L1A+*w+(:>Q'?Lrѝn%2?WaV:@9` [IYJ9b-B
x?7;	!kGf-%oPfl)98*Rs?KH%W/Ѿ'C Χ]Hz(_E#םfMF'W4ũwWDԘѭLu#Ԓ8ZDqlc,VEǩhRlIm#fIF7wyS䱯Yƾb]Ւ){ ƵXLg6Y9*Ƥ3=SxK#o\
_.lɀvzXl!K+9Oe05`U0N-ߴҝZ͸1&7ۮP
FΖ9G\M:BMTja)iJM%OyħExdfwSɪM."3-UefmA=N~*ti$+lg__qBbbR~]X1جu1u=g36u}#j2`NVyX#l3]z^̈́3ZS89W=fzے=qپ&Qc	m8zCp*1,.fgnu2w</nYy|
CztT5`n1/"^s%#[\uof|8؄$ȂI,R5)yqdsIN]3?Ec?/5~)nOO烟y Y£KH,8H˩s=J)vAvI{	H1#5Tȅqql:q` ˋRpyLq8Mx"=wUQJ vDT+f`1R6E>:ƈxf$baO$§
qQpL"3s̅oxFdO0LZ:OPjD̓{jflo~|gYvI3j^ؓx+o9h2^0c+Zy/YSljF|x%剘9H BEqbOzӤ:	;Wj`ųU-k=i۫IκjT*lP8FTRjcVm
Qi

%HK⮙=[Y.uܬz\ZzBrZzNL;$	C`;:0Wى5^eܥ`ޠZɱ̬8_dp=K?.v7a¿2D9әeb2I$LbF8]ZGaAHH~L*ݧ:lb{,ѱ3N6 ?:6|<Wd'2]'Eh&,xqp413BER3 H'E<	S`/y ZAVLbʊP侢`v]+C7AnICHb1D5ȗcP8҂W?ݣ	QU,2ujhjJV)JuV^ɧZVA["^N.ip)b.1V_[|*U):zrxtIu)RŕM/66~y1gWry9i$2đYJhYˁE01L`Iېjq')05xK&2VQ-[g@^>f:SZbrZ7j᥻+֪0	\>=!ky|v<20\&\qGs/K\iQ)?-b>+/_ya_'<F!YJ0Baa:1x<qL)JBTiJ|KmO7.1ǴJ)bSjw|׫`߽713c䤬<GGC\6zu8[JW(:"qmcznֱ5"g^Uo-ml>c60s	5H'l0Va3_TdMLӝ1_|9K\O8HnxӮ"V感aBݾj^HY9fbZ4vV=|yF=#מbüukn07,*qR&bB/d4ʊPC3gGj O6"n	a[dPpj#~egDd4(K[guFy2&U٦TʍUe4c)Sք#$wT҅A*Z8`,|~)(ZݪScr$pmw\_Zε-p>ڨKy7,hi&`CҊ IQèF19rG}<;BlWm9&/a8JY-';%
peWn*KCM0nR+~蔚s0GqFмuRi(fP+[ef1q	*Z]p tFYZSs5&E1Oγ+70A/R2~FSըH9<׿acJ3uZӖ{E"WV#sUm%Ub9ۏsAG5QvyS|cf:Emm6)XyodNp_c*3*ZSJŵ߄Rs+%9-w/D1P=/D
U}Vk US);жfRqޜ<\KkKEX7:coOndfY.n?OaE7
2l|m.>+(ȵ`ǵ>JIdd T5Atet0@״; ʈ<~;fKmIEPPPmR)r1jTͮSOINT0BQMU^R5nX$o@01cdxfgMrq.<I8S/lzbu'!x(($saxrسgR2`I`1G,Tny/9A>mTp?P>3|x\O9Ǽ
{΍AwdnA5;BDMo
$!AČiUك>n Q0lf>sE4w9I([-z}׸\o^jaRAD?WãbB{X%?VrU1}9ʞaJ55(S@@$yQхϏ&Ohљ>Lp%(ߥcքX/[Z638uBt=Q|( 1)-Qo~d
V8d촁?۝+ۥQ]{-ߨYˏqJ=;UYMnЎM(GIkdmN(Aѹ!T9r}lo"`2¦<s}T$%*foDMaa0|&^ޜ0g>%34=;F GkŕV,#TEkfUO%fݬ?ciI)N{|L%͹|aD	oMg	8^!7Ux X!lkhDU!ܞ+PY]F)x˷X+xlgw{kO.%ЁA+YLGxw>}qnFyنqK[B2tv=̄m
θ fT2sEќ"!%,%t>yҟ8+l8xQRlD	>jESoquU'8W1e!d*D҄\훾xҭHͯz^S!nvsoI%w?bLs^Uy 	kHR\LZ+$r%kbWyqnjA`.Bz,I3]r,մum[j2BKy7Yo8{w{B=.wO*0Ԡ6؁bC?^q2Oc2[ՀdiB`$FNNr6-$E8m/sAp_#>so?QA=Myz1rNltPRI?b4"ޡ.gfio4=OM)EN Qxњ`?TTy'6ܮ@4mkb	Id5	3D-oYVVAn%xdioZvETJz>:[D^DRǿ%b.wN3&d=]
%x.{}`Ȧ_dv]U9V_xDH0vД~c$udX#鋨yVILRq0H/g-uSmocEUp6u3aꐞ)RG+c;x*ZW)1\LJIZqe:"/x)F#z??)&M+(5܋w^QykJꂑ1f
- 5J~c|\a2=ހ?k	ߏY_ZqºO݈Nr@Ǒ]CrA 7q $H Ϋ〤B@~48r[DݚVCm☿V#ǰZAʷ/ZRJ<n"XrA)ϳR,`K:rFaJ1L:
;|W /I>h-TBID<mXI/uB'I%V\6ކ|0S[#;mQʹODB7b-*[FKgz9\fle,%]hɌkP,_;>2[<yzGҊet{A3PX(pp(VՕ̠^ 灹`5pkxUiYaz$Н-D+NӑcsW'aVU+s@xT}I0Н?aQy'ȻQ5'UyEqtHFo\cZ>~T.
IKOob9u;Dƌ=]#L~NQtf #Yo ְFmҟz,  'IW8WZq,~z{df	[1q䁤>޵n,}BvhIqd"U"/#褠S cҁmqyYjr8C2pb%k->x/QФ6{^sEOcM26NG }O}FA3<WIH	Ņ\;b
G[)g7"<~~9י_9#/x N{'a0JO}c:&Po0ڲywRxf( 'yrAKST8&޳w\8tJF0F4(&$T~ڞ"񝓄t܌<Aʀ$7Q:(|%(i|6n_XLIT?r=F^G#YOq1|ɤ1w'g"ǎ<~tHlCh
W|%W?k$=,?{g?Zֶ_=cګ]<VE)a53vy΀'x1\,6HG!hK3U̹qBvΊ}_IO7vN6oД*ڈGxn-P꽽ltc<8sZ%XҚ0o2	ڌڒ><	5yJWГ]
4IEuxic\M !I-n3ULYOր|Z$HgiX/Y ̂ie8af7À!rDQMɨD5MʪmgZ7P_ߒN$hQ$5xĉ>zjSz eO4491Iu\<Q	eX0!ɯ01QG6=5[ d\4ɽE To!:a\O/DTo
g5#Cg%=	if[|cC)_jBgXRQ
F[uŚ_~hPVȇbApa&"'R$lTO++	 }n_qӓe+,y2|5{IrjFS+nnrWS42~J-OEjKՖͣb#dղ-ΔX ni)$1q.]Q/H:ʫݧ#mm<(@"~h>uĵ#KJlQ.b</S5^ 	p~z>'ˠ0:h}"I^ʬl%K̻!tK+;ʪbb|fh}pnr5T9g"K+ѐfΝE[^5܈=l^sd+0Eoi
SO\yYz36拪FB"m;z	.r	-\r	s3Tl(Qk	Ϣ_?.~掲u@9xMP:存^*|:Rܶh9KcUr3N0~ܷ̄hKtgC;d:ngd2@-/7ĳ5n}q?!K4;$3OdY\	u"r^P!rɳZ;}zZ㻡YqP4&;*4ennLy6md'栺li;=eM{ʲG&K	 `O1w9OJmh'-Юsɀ(?Y=(>._2(lMOJUDW .<lL=kبOPt$szuA,)O:1mԓ'ByD?DlZF&<i3K&Zpl\5tO_ĭX-YZurE
-h4V]F6Z+.lwvtYm6_5<T8th $;>.#ڑN.Z˘;jguڻ⟡yv&~͕4u:4sjtVQW*c4q^,SvL٩Ï@Ͱ̒~Q.McGlԑ; նC <Gt0aXB`:Bp"w*Hb/2`1Y:SUh~}A-=ܧ3h[HjfSt1<Cm2O܋xuT	\gICϝIq-,+Xc19bNcGݵD.X<PWOC3#TWe3RB^祖4%mR߸ūjJʊj^}w<aԗQe|N]gbq,sYzYԴX+~gBo9!khP`.txڎ"B2sBɝ(8wJD	Y`3G,gV/.nMe>^^m|p/fv/r67}zwk[z" ƻiXʳ+ ~yPADZ9nG\d*&R҆rC'>Ïd)Ts'p7G-|;e̘ puVp?x¤8`,$}?:D	e@}%ERп=|DX+u80`vT	đبKj(%EHؤIɧ3dIE&@JY>ETU	(Ա '`;I8BSzG2V ;sztvkp/&)(pNݤf2vă O>'xO#`A)&A}BrW?Ĥ7fT#j]\blUvZ(G@ҜBE*IC\|*7 M`LbJvCa
1}5tG(nI7BNC2ZŌU/7;R$+'fɂ3ln6Fy?*O#%rܒrni=`DJ3a?mXMz',̹Qr,[1eԊ\6W<ȍZCCt?B[7ͤ±RHmVb~E(_̜_m]\1-!d
~ճ4>1ɘތs}p@y*!h_I QC1___g[,n'Ak..WK5rY^B/pwv)?ُȘ۳|چb_
ya~w2v/8S. Z||wV;W[?=K^ׯ5V{~p/M^ghϻ_ӤM}7?޼;:dRI|a 4=դߦ9IFzRl>li7n?wF
[X=};/WK|F~>u͔a4m%LlfNi9L!o%K,'cLɃLxB=+{`W׳YeaKzr3EݥhW0"7=_3-Xfj
ifXXQHa)t܏ԏ
? 4j	b6Ů-?u~|PFPfzMadO)oQ='9dfjNyG%]~5PγíׯS,ژG?"	=R- harNddy.?|A&7$ɒ$kA?Ge3vxŎ#geTЋ#2'MiYް`vx)D3cxTQ[@l7ғ\3?q&rͬ[\8X5"ӜQS[$(m	f6*gVr>-\3贳5'7Kغ~'VjT.ԎFD7Ys=7[f9:/7f6Vݽwq*Dyjr+:Ϳamǎ)QJזjk8Lm20ϣi'GnNݹqWj<oYZ5wr	L=p<	q}c7܇ dH!֚xOAcFu%FoV&BC᪋Zf*i1B\*;;tunK)&oSW"n~'ד^ofa?<~O+uOi`=#|vVb/OwO9Hz(tUI	_=iicFlqjЍGXi3pl|8Fd܎B賱I8 #{CGX:`ֱ3FlA4q74d5{ҮwE4A0
8ѪqcO̖ux0b4`wǐ<
8^jзj7WS;9M_IL}lt:ǅbV$8ӋztvW-epGet/QGh <`dceD}` `7_$]vFZVˀDϏzwu0!1X;Nj˞Ds)GUf5ZsV3_Jkv-:Bu:e^kDd.[[Vgo4w#!-jB ~lwJA{rjj5W5D
 *l6ZXy2$ 2pWǥN;SI1qesH)csoCYp։3 6Y4vF#s?h2vۻ;A*+KAL	4A[ߝk#\odЙLrM4@8#7ӭc-V_i. <"@kHԾz _Xi$ˊ	Zf\pFIgvn$1j>)*(Qkj!V)Lk-[G ^<;	#@Ұ:.!C..r`J,?dOoѣGVYnf@y	r=32F[&騚Y`#dE#%GOB`R˛0?`D1XG~Ue{ܯ>TRP*|]SI*XU_rgX̔AyU{UА^~ecÂ5N;lu{jsMԸٵ[kTqSvb!05ċa׭{kZs
ºF_zj?+k"_l=9&onjlյgzն;Ψٱ;UYmfkvkb g|jbYVFOܷ6GVsnu[daնVk7Vk5֬vZղ(ׁ:5e.k$Ӳ㐽okklz	5B!䀚vlXH֢c{} nuvntVi[5o9kȳl3hE`bP4Y Z
k*xCٺnPN x#y赀zHQΦ\kt`!atoG;4ڶ6ZuٝNjwz{i C;XkXC4E[нXvpO됤iգleۅQ蠟5@?vEnLc:&k ́ՃVZ--kmxA^a`zK>5m_^{DzhQ4б@y1zn=(dvfۍ'.RdvX-XJW:XOw6X[$lNA_au8O2UwӦO§Oht>%@al*<|>\ITMm[PA>_F5z#n	N@/`>1 3U: oq0I'a>/jZS0PfXjc?sfh+Z98A0)d{.5llk\M Ǒe:Puŋ<>WFivW}>?rJ#X2+!E(*̡v XZҾ%A)<>\YjԮk'|+?*Iy2opѕ	h=yv~S`vNaG}?ŵW<]7/	J2<GNEh]W91[/wKs
Ezyˌ^@<YΖ^ݓ&w&bsM<$fʢhk`	^˛Ѥ/Go_"CVKC/	ߌW<wE{,bbwl9qyNB@R޿y1p4y)-y2E|3z\I$z;z[X:ӵWTM|Hw/c	/,ơ7 vPx>CW 닍]U	>RS&	9 QRqߴ[5$K !nk=^IY͢<
3eh:e܏^_jqrȊrR5gS~+
B1kIVC!ӿ
TK0eB͕)rVNћ?̅	'+묎Wqd{֔It}L7(Y4E65G?8H,đd#vMW{*ɁBWTF~d9X%E0<]ih(X5hs<T|81ްd~UKE̮;ZS] ASiDWUlI]#樄*)5YDN)5ndʁɻWRGy挼Ԯ!LJMA0 ފ;S8b*]6ϰۻ/,whd$'zoO~#ZGwI\rLlHKWDg	!E2 tSX+5#<<S&ۥN	+R8CU K_}!z	ⲧ4Yʗ_=ct^2 q  ૐYCCT2FBS%U"\ VV_]S|ϧ!,rr<o~J=aOd.˲OQG=(V*ľV;֎Sll~9?ڒo$b$1
ǆdg_b+A2I\a)і>%NL+YI:缔2B/OcUwfa5T	)kjN #5ӓ;J|%vj:a\d /QtLV$Z-H\XU1B7>kUFo㗩ҙ,^pMp:u0+S??^1<ޑ7^b^q
X,d-aJ8}to#%-N~v2TA̢7JKPvU2hU4]mt,sq#gxy~;?vDϧNt*BT W(o"5%qZb8VԶcdw\vDcf੒AfR|& J	P%_es*)(K }Qu:q?bkǝNT]9s0.`EP$RF  U:l<_FPZu(_XShwPQ3덷fcfyYqVS$h̋3B}]`0u&*Xagz*
(/v`ߨ!3DQUP](q>[
;"ٛV91-`9,5/f1/)?Cb"JMx HO~#V*4UZդ`TFXShcω>̒:<D
$Z#Cea}J_3 8AX;JqUi3#2FjNf{LbܻIKDDeqfmaГqW#U,0*#TvUiusDUf>Hj~rEgC#]a㳹 3oyl"[X)Bm>,1:_:Ŏrl&:9_
D3Fǐ
l@P-fMf&dyeWbyŧ#$HDȅnV?8)y:as(>0_aŁW`,!`nfeZmCuutձi@PGy&gNl܋tlm2:1,J$I]E	_)8!D;6)Z|\Vg4(DxcQ +x*7k&`I9rܨAq`)Doo."nz?Oמ3P.d9X`F0:sV7NwA]4=+_S;+mYX|(XdswX&oqgxyq&4thxFmZf/U}0pE3je772
LtJIjǍivn+i@>_IGBbIʃfE1a0Ʈ(-'a~(-wH qc
9"_xG^^NX. G~̌IfxePa-~g%Gj[2h/C\hMHB![2#+6k`:$+3/n! \c0FSI0uGO0ɿ5q92`{✳z[jPE6K$#'K?D~e,ejAѧL74:yKh9;$rkTUr+V*MCgvObD	o+q0*fnyW GXM=X&Z#mHbvX"PЋ9Ys3@X'[+v@Q Ĉw6[#˵Nby,xsL٩:S&YXŚ@v]dՔ 
:bPk%2zA^P*-а1Qcnb<T!\gP[9ncTnLcx|<bcj^gPt:Q))P`;O+c	Ixr>U3@sP!*]iyawhsRhVB` xXC S٩;l:{JXpLې/XIhG6ɍQ%2:o=0apJ'ٶ|TLdQwt
+	 (,FBmR"N;ċ&Qmrt|օMgMԙ8ђD#xS85.T˪Se!l4ْ!cavψ䮛l:$KZXhh$DhN6J)/XQ4]	NPű?@tėS~AL>5ēP+"r`ZM]2E|;Lh*g&|L	>:Q})RaCQN-e
*p|6xLkϸ_L\ܶǬ)QYG%f(ZdZ]@uF[' f~	)?+g#nFmZeG@`Ae,_e.|EQ,tJzF?@{wqa^~_v7bب3:w.{7{?F1k4;Kנk,7<~ l-3-e0<í~6eİ0QQI1~t sRQaxpVU,d̬bL;Ƭ.9AB{bĲ<q>{a1Z|*~D38yHyL Ӻ56 N{KJ2q*HH[/JLl8FRc(w9UT܋4sbHd1n^RԙwTEIBRO?Vn~1Q.uxͻ!4cvk`V&WRQԷtyqִϷ3"BkuaLm_'h҈3uv}:$qNiDkֹ-_@A[`~}2«wqe_9jșM=osݺ{'׻}E0#/X$Ɠ >3u=2%V.~9xdNgU+̙W^Ct?Uz/[x_Z3m㿃 ߏtR[IwB
|q	epeF{2Up)jW~he|@`ep7jcE,a)-+ΟjVU*hǵ`D(dTaa.N?YM{ qmu' c<^$ x/҇r^9pΨ[My~~-J+G;Ծ9gs)up-GEc8)?4Cם+xR_@'L>Jf'[J8&C&T YiƞSH̽oY2^fR2 k
Yxl( ' km +5I4(Nr)gtE2}b@B@SQɒ6>2}LpbI-M*l-"Q>0Q %Z'Kul 7oۮ |K&
^]w2zCċrǐtxS7D^ &ɽ.rs3Ru}7fc/nhojZ_
}%
O`dCAPYPvW3>`礭k3ogή+IBhrn\Qt1yB-2s$/ju7iڵ]{ǊhzܪېUL0	Yg
brs?׵+-F߫Xq:,-f=$%,Ai )$k|iaaHNg,$%Ћ3+0a1 ?r]v L~NӐN{ 2x`\,cǧKG;;T~%O2_$<[ip_VoHg*)28O3z(15` Þ~-Z\  S b 