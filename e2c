#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 <] rH(8˯JLI@ޓREQU֭IgjDM	heY Ky:{v=f؇]u " 2nJL\n?|ޫ^u:~]7W\tڝNwZkNtюwrQ440gHj]\`?	; F?WSwrQ_}E?
g 6| ?<4ps/7~: v 7RzN|V/qއ%\cou]\|Gc'kN.ů=.z͚nk{.)J?fXuƃZFH!sħn{#1;qOG,r37qY|Ey~c#wWgׇB`	.T%?xKq{LGN2%k_X 8e2=wu_6f%c@fDgo3t6d>8uOFP?$Qx`vFTh#$
(Y\Mkxtuiv]k;QśaػiO*FKK4%gSK9z^CB ~OϘg*?Vn0!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAWDE.$Π8J
+_sWFp~㿹>zmpi\ݟ#':]Zal0W	2
QF@5i,Uֻ7 hzb!nG0S,q4b~t>q~0
r?z1k,{KKCw@2	}/:td[tfUvRͦvGN{ukCFCEAv(F@";TdPY&ӤbTLiB1vёQܢƶA֢"[TdlQy!	5ۥ,`ܸ?	@#V'D"6!pjҫ,N·}-W:fe%eMѶ]L%z>Vj*	&2P5fOkCOG#|e.ouA43	./k+QߒBv
~DΙv, XJ$i?$/1 ٘5ZjS̵ȍ%;		[םv4V6M|kJ%<dx2d]'Ag~rۃLj/߼xpFK&BL{;7[?+͡{~I+dx7dTl$'2I٘`oko056eYmeZ(:krz=pr ~t	`-9z*pĽʧO̙ʍσ>_MG9Q}%૫JLBt[sQ{Y:9#o"o3 :H|7+,W+r,[˫DuFu)[QxJU꿮~α~ݲnm'š۸RU=p-\]GqgbɅ!nQwйȠ
O]AttǓ<y};Re!Bە
'ѷL=!^6q 9&HeN=N0U4'N|ZTcQm
	JT	ް	edwǓHLE.BQ?st'9?qٸ &	0.6iVA0q{gk^B'5VO<ȬbbY#:98Pھ>II˭WW[/wz_P*{	Rnyč]8~RY Z?rA5	#*XR<g
8=i{	ѻ+>a ][&E,NP~u̸yWҌ0S(N%h!y,*fT:UHTWP$ò0>+ZUGQe_r:VVLH yU[ɒŉ>cc* 6%/)H\@4jA,J)FH3&0^K6#\`*擄KN%˭@-:)&-Ea?*͏o
×Y_:<	{[ϾUȞ;"v*\uTPğ^8g͙"U?lw^7r退=Ʌ#/<r1Rs^LNMV8h
>X1g'vQ| 0oI!@fMhhs	2m`yJ<Fg|C\:|肅St?CAKd9n@J 81#v.:;+HU[TU3)㶬SwXYNG}|dlpHǸޝ%^jX,([eRŹPYd\".l5<YWQ	&diO/ow4$?{lUl`J$o|eԣp^Ғb̢?
FCvhd ^:0}UXYD,E\@J%YV|1qv7YF_L[4BN;F]ec\UFL}Yz~׋W?샟ۭ/&U岕lwy?<|XW
KX<)-axaљUǘ<̉B9,Ɛ-g'	F:	ǥ*si>)Rufl`Jh`
td#e )誐Crhg6vπq?;PɼɈ6J!JO.1ʡI aCVHʙ-Ѥ.L^^E{s~~_>c|,1R{V1LAXSfd lK/?LE
RZPF0=2$Z7_CA>fuK%EtԴzA|o~p3'<l/G#):B4a˰p00I\igIƻi)Zi+]49<9TJmy'yfW3m:|&'inRW~oad'/%$^0.4TE!ab]$b́rڸ#Dmo?̋n\vҳȩlA+EqAL 2+S)2ɣ/hӨZT
1̱8L`<<
s')'ȉgSs|%1@?ĉ)0ׇM7a>T+:#&%-7Ēo x*CR]I\H(&yC2Z
y%X8L;ŏzˍiЪ*Fe':yk DʨVi~ͬT5K'Ҋ2дVps(19C5ݤ&1f%ݸ]E#MkVpSjvQFھ6-&;5tىq=)cQ-]ɞA+T^f&ǒ쒶}bZPyX+t*_7n1ML<uq]4'$	nzb?:N'HX8ʓPHD*&[`i(ªfՊV4`hT`*>	7v[bx-b/ȕ
=2u3Yc;vZ;@cm~ G2%*¼Ɗs)Ա~! B;kYiϙ[Y=W/MXf=wR,{i5wɴ {a.PVL@6rV۸ePDRGE"+mXl*ح\]"r8 O)0JZI_U&?	N`=ĝ>jXRtgA
K[`&_;G O|d>bx
0ƗDZNNJTTKnZ8jD]4߬jf=a{u&ɑ,N/+Q~X[~󊕪Zw\LZLN'g8LF+5$y7~2vlcٖۢͲv[ss5Kڷn$39mP7ؑ1<!ж4UӒ9BQcպ|i]T/2nޠYh|wz{wЫ8s"HFU~#=0
 fhD> *?,G5>4Ӊ_!~!Ǘd1D|mq|Ф{1rqSEATׯ}?T X'wV2bA(BRYLv3IMw/0-&+e\Seߦل%7/̜,6n&EBǮb-n%[e ':[:`2V@]`I_
ҕcd5r 7`Ȱ0rM^PȲSV_BBwĮ<Y$yKe,ӸM٩͆igDUs҆`Ҕ1tGSu#FH&]D B?;VUa	bP<LH éu9%
NVYi.]8FVjDMQLkBZq`a~ΈyNϛY9Rߝ385%d-mz2Q14&z܊PWT?q8tycED8sp#3T9)-\k;KoS@i|ĹЩpq$UE6{~bV-f79P+3[1FTI3GhXIҩlQF$t7 H"iݮϯËtw$}.iƋ@S>WfSf(xI^]Mď"r:uę$U\C6AEruZ	A0^,tغ"KnOJT+&So.2J
P՗*bF;6[+=}X,|lԊiQOџ
DJBv^
فiXʍ*2pf2Ԧt~8!wI
*,%SaTιa?LZqgb(G"dt630|	R`i!|9@rQpzT[.Q6@mHy'ϵ3y賄%ScNi/a`BV5'JO<`0o	)%<n?_S%; ~uF;R&87iщ'Yrb:&.5@($#K,%t$-.2%P-BBMK(AQ5(C(s(&,v$ 3dk 7"V Z3;|jp_Xe0Z4˖{؏`	G<>6nqgֶ7t4y&=ۄ6Z­&uCTFmEx4CzXxWkL2i=d@vokgNHaFOەl+ߞ7M3ijzUuVo[ʆdh(Ҝd.bu0QR4Ҡ22{e	hk:g1I͏o8yFۜsOJ&5g c#R"ʣJ|uC0K0Z	n)^aQTk~N2r]^x[yOiNGJ-TtjA[L?<R3ZR<HZGcAVHk$I	SV kq&7!;SKf9#WWChZԉK>fc	$4x,ƺ%ޚ$5ޘN7Ƥ4iI{z_Ȝ[K)vPz:|%q%"?
D??	24 D}|J=4(4Ah5Bj^@MVPol)+$M73({ gw\p0mhG>ʭ,GPI1O";!Cde 1Fh(0%ES7$3of&5iۃJ.iLU}3MyOyYٞ(qI)4CʹfCe6%SSq?jK@ "VL5.6ipMӟZZQk:jRQ`l1ziP)?4OsM.bk#fi-%b]D+C$-eoX"z%#hZ2VGK.ci5zy++o:-oZ)o\,k:dYAR5^%u	|]_%u	|]_7_mYD!5
/Rt@Fw 'nv#[O֒nrNZ]$IͤfR^3iC3)YT@#I(JROIy^+H&z5xF>՟83ƑiY2ĸ7tgIw\ɐe	襉s+jT"S(k|瘅nmWh<X/;9ͣF+>hhGꆋ8$mFsܢ>VSmE}QߧpMKm3fβ0S&HkLԋG DͶ3FJt\VS.*CC*" 2ݳL9*eʰ$OBb*
yoLzf5\ V/6.Mh?iEѸ\*m=W&ZXe4+*Þݓz!]^	d1H#&|UP9겊ա]";T˽$WYA#}TYY5f"^iZc0Bƽ|#!y|}█W%77"\)ܓ-]_lE_ΰtm6<_p3{J9@`tyk`mEW6MHBY^jO"m{OTi1`)ǻٴ$.so9e4$A`#yHބ<4eZQxUZ@<(e,]B	Id47"0sH͐u#Qz0*/_T
CX6G6zkO6(&.e=PE&5!oC
ڛc)DPpnư*Cy$w7"e[H+x\/sh}w3[X#I\$ţ O˫.ڍ_4B}2hqWJF?ɏgEϮzX\sN2zZ݉8܈2o|]?"Ci-fJqn ;ކάx1*S5bAkp°t>𽈜SaL\{~Ũ2ɼSn@Alh]c
 K$n2ڎ"Qʦ%HrUW:ك9'r`rzRݛ[ݥՕ~5X5p4tC?||cB<ؘ_Ϋ240qS^Laӏhʽ@t9ʲ|0N$'Y8t8. (|`1[0$33JѼ77TvBjEQB\'#%P{` -ơyiE8MV÷#~4X"܃50dqM4U3khHȩfjGTEWY 20*tC;0ڥecS(14SG(z-EP3U jݱ@e|Pky2oR+Q~,6ſo2F%9t,wC7FWEh
12iOѽ2`f.f}!n6Y'=̷	H'2Di]V#X&3IvH-,\on,Y*zzXKCҚ!-o\E5q)1̉yo:WHN%x5S'R4sTS_PKR^e946asurǜ{+'.Lx6Gч/#<~O,8Sk*2|I^31eϵf Evь70TJ/(-5 *	/Q ()ƨi[ZL8ߠhUQ$*4OsAfC>2ڲa羜w,ƣ#tYMGtݏcP6p3 O|'B}wRrN`_
QUr;vB׊qtqWVGx0<s 4cfa|	k{BsB5b2u bG.,\9H<H]#r}cr󜗊hٞE*C˂u6d%qb7I¬%|7j/%uٝ9jy4&D̼>\ %}Iu]h۫_BqmU͙L-7H6:44Ip$zS6)?зH(l/Ӌwr"<^aEA8zOs DeskFq|a|wodGe17gevIs. ,[bU<,,x5g9U֋0BIvooO7v|ݗ;UA;+tC/vaٗۯMƽ mC8tO]X󆐦Ͻj.~l B9 %aOw-80!>28&V1BqF0h!,P(D@:y;	BHpgS *\0pրB|\s.TLpvN[tn`e(LCD5+YuQpU'ػdj̳`O[q&^;|p|W[ξM|Q9Fl%`}:*:ðԻI(~75J)F@X/êC6tHy(eftKf5ăt]ecHnHs|fN`{շ9fN3,֮['m#oלr>)'c!tI#y<ki=+De
x	-ߠrf=
`Ұ|2]̬3,&K	/SnJ^x_ԔٿZV!יFbAI0yHZ~n{C6vzco5׎Z k<lSr0cߨ(69G$,TW kQ]G~p<vQk |\wr$*qSW7\yq[CneGUiTM#hoհ5&o:di.>Nm6'Z褭E-qx#2~ʙdЙa7AY]e{U5 MYH%eMU9LV!X8T%ۘtG5
LdZuBr*8%x)b<*.=	}( 1a3kk<`UKi;:ժqN7ރP
FΖG9G2Ź$EA*}5\ڔ4%͎CT¨<f"E2MfPyjߓw=|g[Um6rP )HtUEbdeP鉬K_6nRW(^Fŭ{ŤNrcFY(Vgm[H5tzKC@#c0gV52gj$ 
fz0ȷ%{=#MƆ,pqeKe֑$g(OeS81sqôYD)uNKطB(MHޅH:e*O)΋ÎeSgMu^nlS ß!9}c1c.-Ib;epk+OGWBH	ef'{KҦ0;jL[3@5\W7Y"\' ^nREiqP|L1xary:HTaD)#CGrvuwi6>;x4xf$"ՈcO$
qS|Lp03s̅hx4eO0Z;UOPj%{fflo~|gGZN$5yIǮ?ƷljE<j,): 5A@sv>D\,Q"8/cOlҁ<[khYQI^Lr EP%+,(㑈=p@)DTRjݦ6@>mW,&aIܬ't+Qa\f!ep8BB9`)+ӎĕ{!؎N-UwrJL2\e!HfV4bi$3}/\dӏMصcQ&G,]QgE-B&1v#.0 ûTO]hXcgw@~toxN EQ1g
-)rZ
X'c<gG C2<ASKԦR<a +&1eq'Aĩ,js8q<4Ғ N+M$wɢjv'jT*Za4xG%	ӗPTʣu[W$^8t'ãK/Ԙe.%+6H$z<+[R^&XԌbe1ɲ-5f-Гzr#uڞkT;)s[oa$VC҇fa->C*w8bZi\eۂN0Y!Wa4p}zC(V,uL[Wua	3A#W0 >O|V<J[j|cq9WHNITIDw,@jj@ݻR2uJ`L~5o;h|pܟ˖R_QVtyҫr,wW{![2O/&YjEH,o'mlBc6=0;mәk"aAʾ0V`)30dؤd是eX=ܧôvk1BiυQ+30!.B~Ystr^-J}C`|޹Qȵź0oZ&8ozI=gf^Mhټ{5t(s`/x~ l!>6Pphcc~eMMZTxfBERيюHZK	 ueq2\'iT4X,C7v%)uc(p]ܪ߯cuc@-,.8S>mԥȠļy1DkyU$(-Hh#Ќ-gvS#3Uqr%	Sd4bd0w,Җ*tfr~w+pZ/IQCfȾGtJ9ܣ8#y~!EKl;-qfq٦L΂t7l[mEt jiΊN$Qdic3%Iɤ~Z(;Srv[ɌyC#8NH
kkGUj<	E(LJLp>ٻϮ޼ VWW1D;qOF^WW+rXUZZ#a߯վacJ35R֐{\	_2LYJTָakVhAI)
P2!̜c`z fGePk[\MHʠ[\XsZr;^@bz>)[3d8^#@Qm+8rv	{K1vvz{ZjB[f^%b-"EFM^l!	 8-Vv6AHfrY^T>Bg)E%㦠ĒN/
04y)7vrBR#a4
B~;taZ4(CKܺ,2kɠI~QM2ooo'gM˒#u$hhgMs!QeƵn|ZūTm>IY4kRie˙$Ҵ-3(`g$\6{ub<#}e(΂)kӣ]_ۧarNO9PAg,!_D>{%,fv*U󎛿AKe#:~(<:y1S,ubsc[mظx@=o
)JAi3\az=]!~ЊĦnF7)ĴZX/?UP?UgGjtZA\xL꾁uϰ('n`<eFT}(k=/TU7r	d@r?OL.WQb]?f$ɪ߰S=S'DOSU \'zWWR˩VQ6|e{мRD5kʵ*SPeV
O#)"PneԷÒS6tH/c|}tCU]%߳3L)]rDnˀvkD!Q-:}/qF	W
D"_n3-㱬Z5}Vn)fݬci-ؓ|LӃ߹0aDuoMѹ	8^!ʛSy#ϗEᰒ5\m7-ю&aR+:BUh!\Yץ?Rʗo
T}z^V Ay+lI*6t`0ʂ|vd{'ء*k')2 vRBjKW'C@a&sSyƕ	07$+zy >fqe"2@':x, QaGc.jm#As)樧UY':u&nEbh|ZU{.>Ѿe}()?=c#t#RXVAz? 0)WHl%QꊽK2Lu"7$Y:(4,:\XNfYǟidQbg<o׳qU';'-\
bBSGmC_ņ~,_uc跢5	.9%b|:ံlv(#<tSP?"_~Ȁm@BX`C !19k#BIn.$PQMiD.Ch\4/i9Lu{55S\Jbz5y~XR .p03SLH:7' O&n׽}s-|%^4(Xy<3FZ !+"Ur :r D[ϵ-sp1!Rb_8飏̮w@ua7yJcw9pM7JRA5gd'h	s8rV0Ri^<\noQҼ^5!huPL:Z۹SкJh}+$|L^#2b4CnҴRýH_+|e͞wƫӌp7c;ǌʀ5Z \kJHTez$*0w:5Fi41ŉwX\[L#.R#P%	-GR:H*tPޏfGyh5[j\jD_R!H6b/Ր(Dϓgp L1Vlb 2:G0zAQأZt"^فU\uxԫ痤0P|h1s lJzqzG+[M& l&܆|0S[#VmR"w!3ѩX-FxMKw
٥3˿L.J^,e]hɌkP,_;T>2[)xs!)HLC|gdq/"VՕ|^!Ѽ\+ŭZ)DeAٓCwk@T2˰rsX_LG&O?#	NCW"h(y:rF-GלDk3	ri9TFTgPpa|VNNBgX|}[t̩+g$qg<Z]5"`ePj;aulw:SчA={sGHͮHRĽx2O-8@RGQW˟]ZRGH G:)xt`m;>yL gMWNdVJsKy)khu M
i5W4-!ct@gaNj:;I`\x5#p|5Aux#o<)ǘcϑ"{>E/׽ϓ0 SaC]^J}b7}μz{֩NtzkxrAKST8&޳w\8t{JF04&$T~ڙ"XOoES{e@_[(h4>e[c7/IYL
rX@~zZ;ɺHlj\_2iy k`]5}Q/Ǐ)=pQ{WrȱOeʳWym3&ϸsk,,JM~3mw<[igGϏ  c׈LO>f#sSM5HU{dI?;'Ze=fh]Umģ@X_i(r6pA:1q~9Ւ V3<>C7ዄvmׅE_uYkM<%{gˣ.YW@Qa^X)E4EiOϪYo'[k@Xr-$4,D,vA ̂if]"af7À!9(̦dT@\L>!d2FӣJuo`>^Զed#to.j{y?^9;qjٓ4uMbCN}O@C"bNBsHE+zL-sF= <D6moqwqU0[NpnQe9bYX=`!ެ$y6_PZ/a!W3٢XRQ
F[uŚ_,ZΩ5DYJe(ӕ(np0K8䲝7PcyƖ_v_I}12H\T/^aqd
%]AF77+xmu<f}\,Q4wI`qm<x=Iv[-{BPL֑,75msWKf9׎wjiJꈫy-%4!0||O7qRz;}KzDfZҚ/	p~zc?'h0:h}"I^ʬh'¥
wC0v6+;`^H1u}1>3>r||B*zXADE˫ѐjΝE[Q8.܈=l,`Aq"r"i
SO\yYz36拪F""m;z	.r	-\{r	s3B6X騵gKj}o
?|sG:KrOܜT&KVL/K|:RܶhIKT*2pO8̰33!-4;'Chb݁fۓtCWR׎%6 +꓾3P݃9aP=("G%',ē~ gvBpZ㻡Y~P4&;*4unnLy6md'栺i;=eM{ʲG&Ke[`I4LcNNDNJ4e'ƅ;"ʏJgVk3Okkːq0)~@	4ĕtU65l֦Q(Ò9@ '~A6[\%j輠D?D@L6f#<i3K&rF1H;ٸbr8ĭڬZ):aoeYkn~6k:fi;4:J@9!Z}(HɎKH~'RysuV{^]\j_D>Nj`7\ B=ۅď4s֬oQ/-=xz"E0e?,σbHzFŸ4`b?ER@;T ubV48;BHbO/:`WX5\+7ܽ:`d[6Kgz3teNfu|^' bsͲZ+b'm?w. 'ZRb,͑]mL$rO!s^+>fp_ Lw闩^H	IZbRA@qCÚz)B=U辤Q_FKcu:c:˥x\LM⇶z09n}-.:w<JOӶ)54JF;&(4 !}&t̂\ i|txqqkP7˥4r1FSHiy߾YYʉ\ݴ,K 5X2r>;7 .Ri9Q߉q18-@~DxӠAW6ooےd&n.16|0t7?0A|BwSfj|X&>
ERп=>wDX+r8e8ɩ욍/DQGn%pfVUUsFy,Cǂ&Mz}N$0N/:6QQZlo:Y;_]riLݏ@zSp:2-G{$S^3OK
]ǅ{Aw5IA)G-6{s'p:dbDG+tΗjܮF,o6=KljmJTdM1PzJ/ݣf)0LI]PܿQ0-1}5tG(ny3ʷ+!,`F`+&Y>I7sL1F]ۭ6z^s'W׆ה&LM&.p/F?$Vyj؍+XO<a}:D}hD2G-'Q+N\OOk~#gOhrAm47r
/Jn"Y_|=>0soVսwqZ/s2|#cВ)bV^'crz3~ѬSrSL穄}%<F|t}+ankznXѭw[..W	{2r$Sl={		9ñg??f?"co7i}䱇FL;{Tj㛭zl4[^\
H^nyS˝yj'X^x^P4e>#0͟^>ȧIOo??޼˾"2d?za(vEOizI˿MsC=y75z}Qnyla[M뽭=xZ˟0Powo/=~LOVFktQ*[]SdRIP2~2vDy<ȄSL]٣ݴʔA|=_(7/<S]v._߰`0M][4;M`Na??/VGx2VT; mZkvKSQ5+كBiբ
El0ɋ~wXY53C54²A]c6{ pX;33;Yv+3g*\3qnvۯ_=-8_A&Y2w?Qlc'Kצ;Zs6 %ے%&Eoᑲ;;x(,FeNH
i-ib\9LRVu=iIr9wFKOWLO8khv2f޸_bZ#25E"&@ msfR|}f%Ӓ5<ynCq
 ߨ5'7.k!d?df17r׮gtz׍(7U]t!4Pj;|[f9:/7fײչwq*#Dyjr+Z	Ϳilǎ)RF֜G4NF"|2SF7|ALJ4VHXUO݀?vyN<orҭw;
Ћq~>Lm X$Lck]'oFv:N	Zjߤb \5^hR#ĥ <OWntb6(<Nם\Ozz7;{A?U\t	޸)'c7vU<+S#iIQ2"U<
I *0>]<-zxț3"`8nQ4tAQb{})c*a(7߃P)؋Ë$hc(#{CGX:¬cg.68hoi&kt']i`q)5ƣycOlet8ܡqC(`{2nD_7_N]46}AǨ'a03o{n&i8ZL/jɣ[p֏z+|>oAxRk+cotz}1	F'0{Qofq:
 c(x[xF׊
X;N=gF׭EX]6YdY;zZ[0z縕o4QhwYiRIkJhNFۜQDGZD`ݍ[_tfo64g#!SNjF%@3.-SSv!R%@֚4u6-B Y TRL')ifMF;;o$y10\u1L&k§bO,;NծKzYvл;A*ŐХEL	h{OA&;GNrgYCg25iȣ Ll94XJsG䞈Z:@틯̝yYq0P(k&EnP(8	zl!TF+7iguK)*((҃5~Dq+tzN8g2"4KD1A\1	z]2٧aQ#k,Yk5ylR_x`cA)tTͬ_̎D0ݑ	2#'5!?0?`DXG~Ua{ܫ<PRP*|]SI"X;&R,wfzN\ΪнE{phCvaնaiv^k]{. nt:xʳfcî7[?_le"Sg_͡)yP<uafg^oO>	6*!ښ(@WZWgiE?g7|FKdPB߲.AhحgFղѶ۝5^-bvZb gݶ|j٭6blXkZ+#un7;MPl-ձ5awVjZTmLK<uv	j7m8d[ t}zW>AakD'hA9 ҵ溽6B(:6>64hpkmZvݲ{ԩ)xY@FA-l!]dj)^j(evB9C	tEv6,@z	{kmp/8 "|nYZhzqn]ѱA`ݎ݂,:])؄ ڵ:׀m|ڀ$Uw.e/
@m˧f-V7d0pT5X	xo.Tޖֱ/`l_hYn<yqSAcMԨ3|z64I}ӨC_@kV9cow!m՛&k:H]7:@n7֚@з,mHٜF¾ꆁq?df)(E-7O:|J2RtPbyPSyeJGL2ko/b@5XjyNsAoE[ठb>1g{5@aO|_Դ\a0hʰ*F}M>q'	W,-w?dGԳUp5GړPCֵ/9|\u6wJk__+#':]Z
y`?Bݨd?7W/lEIx
Wիj.(8rF}'o7s?%),ࢶ?=]|I؃7ɩ~/)oWG>	f@}߇]m-7o9e}qN+9y-rc]^2oJIu!$qx>Ζ$'M+FeL$M<$f{^F#ם0Xʢ|Mz+_+C?_
(e]R'L_G?7_Fw@:JHsqJz~߽c0M"df
:	EUVOنi!c(hWqKHzx+̴l$Lr}c,+	p|q>`0|;1휤M/,ǡ7ΆuPxQ>zIf?\e~-?xLD	(GJߴﲐ{qPUwE|dWRW(ϬLC7aeo[vI?)I,?K
CU)W$_|ƪ%LSO2I!N"*s&KՁ+YU}8's((	P%xIvg9D9hb0t؍"z .pQjEIi//FdG`ͼUTM~$N8̲^
Jfak+
1DX )4uT
5M'r<dTyvo^eTXU~K"\NL8f_t#kho 7㎌D5U!q3K }=0bDRJQ @MҢ35aPojV%־9#oPz7SZ͎1S:5TFONx%*yv'p?{yßY@]""^BZ ;dWON/{dR#ѻW-e-JNIZcbƒ̌^0Ҁ13
D<Y3R3NEnd[ɋ@>]=bONŠ*_*Ry}b#{Heē1^VX6fS	W_]M~Uw8Hڴ /cu	{";j_ݤd~MN
{
%1U)vxCfl&տ~%?~=sJi0Tw1k\Ej&^d4B\kSL"9̞*sNEy"#R]n<VRLl?56ƕʕH8I<8
erpS%_efJR;a\,1|ZE̬fJ
	#ďWx65/S/YY#*n`YO|zk'?c\'"<	.G4` za&9qmNv2A̢wcv 4
{.~`h0}s3V<?ш8zMS':qa5LD}9U{8";;aM2Z 
9R3N#VI L9Pqc%%.[ш[?fv1k:)l;-9șkf΀pH$s+HD'A"B'{7ij\M':
K%Uj34jzl\o^bV\CMWR(Oa(kW:T&sd30&P2,|&!h)'/VU.h@'7K7B3
T ̪dIuls904*{|%*Cy%P]@	LFUd4!a$)ʟUVYSf&{C)=I`[LlDXO2^pT>$"_<6ED]pR|#%׸bLO(D6l%֝T'y##hc24d)s) <@*Qb"LG
kcx5yاDY5îp~Ujb3Ajif{Lb%N
G˟Dw`	ٿ!RHw*s?ȇiIFCi=DpUUVU)@(xw?r'q|6W9G#Kb.?(i6Z]rloك0<-{16ungz_˖o3K]24b2~p}7EaSQC?ˌ 3l?Q=Ǿ{X@&E]%T&#Y5;]pLc3=F@=2yڸ6+BD
LӨL;.שom0ʊNйe^wA]4=^R뷽݃+$mcY!ü g:swX&oqgxJD7CG@YLJx:DqE3S!1{)Jҟ+)syph@P 2ܖW{5B'ѽ: O/1v/qu,^/:EJ`FϞ24oa,4Q6Epцb L8lX[ΨՋNp"mf^>F|l"9>\HEvs'7\V>|սMPEW:H<~gkGu`t56!nOkШ^F4`"a d1XF3YsVVˢs	2,\LFRgN*/"DJՐesʀNlIgFS=T2	_34!iF$^juv	Zm]BKQ5F3lj\L.Ŗ&$3H+#f(`ɉ/>SmyAd'QmHZ3qhNhs1@EDq'u:Ϋ,[u#Rt>cJ/S+)jZF!WpOEP z%!DR]s(Њ8t&Li
݃HV/,xbֺѻQ_.9`y(2s/S#WE(@^ o̆ϧnK-j4Aޕv>>|m9iR-Pp˞xUHs)Su0"7	tp"O`f{~[hI*ʗ -[)([,3#.CHSN4sNX9Y'&ļgոJT%9'Ǹ)KI=z,6sx~DFmCIѩTI<{'>~=znKpa($wPF;O
@ t09^Hw>;Sw499qJFWLXdhgFF[/to+Y^_@5rޯ uL/A qҋqgdAxmo S]ņ٤2zɱ^몺 g{&R,)	U*P~jxʦ]v^'i"hHg -y/|kJ12KY	iaoW1a P^pxopCLK>BV ĥ%0KrxtyNRD(BD?_N("l^W "4~T-Ӿ<Yg^FYd[ɫPBQH2k+[gxB+ͮ36E,*eUKĶMK3'==4CoaT3'<!/0.w3H{)<IE@SJ,O7cKM"cV::qnu:N#@{/wqa^~Egϻ;*`kΝo-\D~QO1V]t5kν;⿹:N}Wwt",Yl9y0Y%sCf&!)d& AlϦ왈7`CJ*(x`]j,!֜Do.YsKa(cVdjoʜ[NgI1bYS8WɽVOkaQJg#C2^L/6"zO\SRҜ4ȔL0ʝm*mu0"͜d띘	\e/4:>u]EnX8)!h'Q/P<X7. )!,acMz15J8I^Ga4vL`B'6wjqp:"J#o+uc6uZDh5!!Бeq ;-6ΘXEtrU&Nqoq,+TlUH		nV<I?GsUv}׻/o5j]~I0b`5%Ɠ >3}_zd=m\=X4Oٷe<Zv,-3gz{ͥW"%^݃/A[ct;t5;tR[$Ry!|bYq e8Z	Zw\4s .>/FS1^>,e%~$JΟ 取 	 i Q.N?XI{ qսwbO!KQ/Pgq0Fblw'粤]3ѓYwNA$z5C{K? 8Y?r&9NV?;CugFɍ߄|RAZmuAu>&23 	U8[\^@W]3)HwNuú:FTDLJuejk5ӂ'][>8!E)HL kvb \LMԼlBg*IU<Ht2UP9$jJ9Wǝ"Eo.'W?ݢվx1ShL		F׈%K; R+6+>٦bHhpEѨf̠2Z;b۰
+A6jhy珯?E.{t/b66+._XY'"B ] &Ƨ߰6CoGXfm@Rz	t6<M3t'~}A޻&4O1YNZ3Ԑ=Sr>Sv/mz^EU".A"i+#8`Life)ҥ0S^2zSyVv	`!5:yf:YpHOmK\VpDH(bW5o['g08G65Iۦ3Hga,OJ=dtf]vBlys:L/?Cgo8x~t#5*8-we<Lsb1-w|w
p
߆_&K l 