#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ['] vH(دïȢU-6x'u)U*In_Ԓ{׶Y	Ih  %,u<Üs:s֚YsyYkfDDf@$%Y,⒗Ȉ9^z}aobVtp_o4W[?gir8C'prArD;U礁9Eh5[VNH`nƿNEqqw؟QX?zSw4|u >vQ7Ao6-X\߹$?\ՋΉsI 7[_{ՇK[^QSfN7fa=a}o9b1A,YCVsA-pBtN%3'(=b'yN(rSF!	Bvc!aFXJ8Xcj-^e	>ncG_⿽FK_3TG⮷Vj3n 3wpFH" ZN`=f k N29h'#L0<jTh.cG$
(Y\M[5;UW[fѥh<Ή=E;^\ޕϢhR~7,/9I%*rXyc^7U@8=}O>c6^0]A5&݉=
sa5Bj\8A䞸{_@u#2|֜:H$9GI{KwwJ λp7ڧ[ohWslg{cYO@ӑl0Zi|f9|To5i5Ƈ8Ǉlqv;iןdߐgt4d3FWT`}GэXtJCg@0<7<td[)w2+r%aBZnutK;M[I^fGbϼ $,CEvAPŊlR1M*I4&iw`-jl kd-*EEٚ2|@X])DDIzl>Q$4S^yier1K$2`@_1넕5uGxe]?bj-a}cZ\üTЏ1j0LUym׼hĚ8,͸)Ha*Օ|-u<aPW[^N>w΂{ +^lA3 &#]KW)#"
:b3ao̞Ҫۦ	Vm}Yղj
F5Y"uǉDl֟v[/ww^w_y{j7<<ҨS{oag밿ycL͝p`PޖG6,z Uy*Jo~TE=XN\2'.Z_l vp2,&P^WɅi#v?p|(mr!\1SyH)c.ܣ?M*s{Al
(hxR Ov`,uY.kGAʿ|ζ~ݴn'ő۸VU=V:w\1FG
ʗi^2>u`>;h{O̥p=oגC}@}+De@E%	RY& Nz9Ls6FըaPBQ}E#AsՒt6Fxisw}XG4t/zK$rpw`gsǍFcKۧ0(IGlDb::=Ok㝺4ȡZF]~t'p5d}ԢL`qͫכvz_P
{/T[&RҷnD._~{S./n O"dIɒMw!D^s*A<_`KH	;T7r&şm T0O_ŵdtʚ
jgXr_EGQYKV\5*kaJ%^P)@^TE,~|X%ڙh6A8:sbҌ	SBdfKl@V~I_t}o:A7$1?Y\{&nn?}g9El*/\ےS_6_8g͙"ƫ?lw_'ɀ=Ʌ#7<\$FYy9c/Y¤&t*@A̞pvIt 0oI!@u~Mhc)~0\M`"#4`Γh۬7>U~pV7/Y0<Lw3DD1cЉ= 3dN:j9}srb>aܖu +K𸏯Jqǋ}ݩ^h.կ
qN_hƜ~$[(.*q~^;yM%YR/;]㲐uYarkZ^̟`g_SM)66U;:ÕHNǓ"20K/E9쏆KRAaqy,rY(㿙ry7J;vr@K}/Ww,&2iw]3Wt: Ff[D/7_b/ᷛ/_M(aam{wy/?>z\sKX<)-axaUǘ,̉B9,Ɛ-gk'	F:7	ǅ*:iv8GAFd`rh`w
td;#Et!LQ޲=ܚGn9g@➸@W;`D_ڐl%J>\P̈dIM [+$̮*Ѥ.Ln𸺴jկ*P=Uю3ǂ#߳xP2Ka+pHxi۴8a
( UԂ@H5)=! ^2u2Y?+:@RӶ>xtJG?/}wsO=>3H![{UJR-Jj1%i&lHgw,|w0ra#f@ՒR[S)U(={Ǜ^ʹ%PB𧭗JPOE5DRhd{qX4P	u13ʑj^SeXBYڒҳߘȩhA+qEqAkO#R+S)2Σ/h
DӰW
11?L`<Тrs)'ȉgSs|%	@?ĉpl M7a>+2#&.I7m r!	殈$`$oT	SF^f^)-b,_	_	_	^%؝L'F~4hUi#Cc/yazm"meT*dehf)hiEG_HhC+CA؜nS3nݮ5˿-rH5=(I#LmCċ2B\ZdϠags2/"IvqیSK̾s1-JT3V
)#Wjέ[LS9uo󐟧n15}(b}8]WOG'$5b	gUyRo	HVd\,BY彲 52ZF̾2mt5YLY'qP%
"Ƃ8#3Z'z9$`L>t"+pl!ECg5@9Ub8Y߀.0.\L1Ry#{9sK4g
žmsY
=?;=,E*KJDQt3 lu7(GPG|c9>ʱEq%r>v׺Nz깿[\'6,
y,}ɏF)77XI|mqyπJ"P%䝼YD-G1>Uw޼#>%*%RՒσ~V7ke7kog]]y{268 >5{9UfQGaV-ʓ]%~C_]nbǼ'mѬjfSz-Ҁ}Qܹ%-[EQ6x(|aatnhUYɎF*֓٩C[դ-iƕ!?+߻5en7n¾4Rk|yN< 2HF(م;l0ƣ&%|δtRU{OQFԯnH+rJ<(>^h>h]CV+dX=n(J;dr͋Js7JvӠB&Z,HYHV*t)~&dv0df%{FXtoT~ŭx3X[~'@ul]P	Ȣ, ;X=X2Q)F^et2w\YHȑ!$oM&;s0Qhj^0`L1E&f&DE@k	#G8OͨUu&Gc]QԳ_gc٩4Z8FjTMQO?"]ɓ01K;(0TqjR-+ZZ̢4biL!ΡLG~(q[MǊqM%p#S	)-P֫3Wߦ̎2šcI0H-A!;M(mgbodnR}$)fNI`9F7KrDoIHz~r#Qt:;>/1EzG-BW My\urd+e%yYzr7)wcgT5p;iŸ'ZrG̲|
\cvS,	;e*]) <Na ' )@W_YӒZXniïG%Q+d|hD=)PD*))y)(dj`$i烣{C?=$VdeMeMC&VBO)CFh8OsC~7ĂQXIlfU3a\1$V6j:&my$^[һ?ig2;8/'BOg	iKƜrӜ_rCjN;x`	SJ'y~Jv@5v$LifjN6\xus2%^%L.\j{ PHFzXKhIR<\JeJZ VPX&j QP0%	:KBMX<	IsdA`k Zo?t~ f+B-? Rfc2i-_ӳ}Ž	G;>6nqgUw&G	h4smCx!Տ<bۍ_U?5*2HXZyY.Y9&<ƣoE/{4MUe)?X54ik2K`H{0.Z.i!A#eȃ	y7䪜;1z1I%cޏ{\#LaNz:CҧAKQT'W>LrIJTCyh#DoޣpPA'8t=:-T=6<&j6zO"qYJ.2ϖ`|+Ϛ?ةOAf<Hʑr7 >b0ږ*8%c0	uT|4JBа >mo &p3	1nR4ۅ':JB
'pE\)Kp%y<C@d,֜&1Ɯv2N1&	MK$2C$*n^zH?/z#+3t//wXTga TX z`iA
=SA-pĔ&y!R
mnj4e,|cK\ <hA%9ki#@|QQn`9"BL򍁜n``|Q1%,O4<aXC)fAE.Jza&yI~33ܮI/T]Tݽi+~K{kL4/Eh]D)ȎJTl0ǗT/+D)j_09T^2ДiУQm`$ii:]J*`bT+XLi"0bl'O:Fc:凟&iz&3=(WrEllm4!YՖ!Z"h! ",]]m+QeHt@5/VttMG޴MK4MCޘ_e-YB +.K.KfzU"+u*d|H+SmszF|Gd1Z|uv|׊Ir@h5qqͼqF^znN]NUe3r1L˒%-=NJM,KLZ$^8ђXJA%2HY6]yv#Wٲs>JkC

z~zl8Ch;Kc=Պ4ߟ}WqleAYgb2۬SItĜ5yxgh]+~*teY9>|hHő@U{(GYLTtLE"eUorܔ%ƕ8'(w֓K_͖W0J˻vye}6=z3R<+&T7&pI|a/Di>G]pq:xKr)[Cp!*m:h*J2Ld80\h,&aWvXwo`$OUS+޷/xXrys+EV'^IW%jk7y [TJ4+i1J7K	wì݆$t#rЖ@ː\xMkN*ZJ@TiIȠH $mCSO]oD)aP9UfBUX(dpېDJ#yys#9*!Ċi<ބ8!r*H%G@0Tif3djIb\e_l<U7x	H`FsP.1ઽ>BJsWP f	2]Gyyexw+QEҎ
07w>;bOM«HWo|
d?O֧/Z,-lwEe3X\EͩQf{?(W=(}'+v70Iצ8_0oJ!2Ug9,f.Kщ?EyEN43X%^K|t̆%1dK&U)y4lWyi>ɮ}-"ב,G,+ڐ..ܰ۽o]X]W5ZAC7 1Idϧ7!h*Cc9i>ScaQKh:t_3l-H'zE빽Ie[
,j1IdmY>{koa`q5\ċ ꊸh!x?3Zjym/bŦyߙ=Bщ-խ,u^Ζ9"|1gbsʳfxRIJIvD8{>Ln*֬)o1EC~!hp̎f92fWy e!LjjLh4֓fQ=e_J3Sɔ,<B^ԛ3,]Ntˠ+ϚV-n!D??52,|Ja>+E,*N6򃎐t2}Veְ.]ŲrgfzXT'Jiq
c(#W[h߮g,y}eՔ8o!Dn\1.H
!&KMtd0~hcY,
TGՀ5s)-Hٓ^39sq9*(s0oɃ[9(vpޅ:_ %t6eptIqny"%
 /Et5aKki34U(	
\Uf]ciFO`''+9hpF}Zoj1zGHjQ8|Pqwf	ކ(fYP	o^Өk)UN5eD3k#5ґ+0<X[R!@MuG4GM'(;v@tx< k vp[4rV*3 YUGe,|X=\	J!ˋf-y|T$5g^-xQ${QFOK 0æm<VH8<7Tٓ	FSMIސnď-B:<ˆ%%۫yu^.\fr=1\{fۜ":'Cܘ[X3f'N R ;jQ=+39w ER	@Xga$!oh}N@Jo6_ɷJ;~2gܱ7sj YsO}mfΎ5gmG};4}tTwiw%y}6j}E߆hѼ{8Hb^`3g4A^/x}PeXOB?8\My"ԄC8 QAep5_qE[!wP_AUR.@D
nCӀm  ]:#c_aDYd_n`DI6.;,,ؓ,=}N`.}1Ֆ/f{^T#Í*R/`}::ðM>74J)F@]O~XFbG?dHy(evtK-ălZEc[HgNHscf`{89,nfNX,֮['voל'c t~I~yͻki=+De
d	-۠rf7
`Ұ|p"ͬa&,&Jb]i=嬶^)\o2	@GBa*5Tl.J ּq2B٦䎇!hQ%Pl'sytߣP4Z/Hjr+ϧ]Hz(^#ǙFZSʅ-W4yVD [IoUH[DEv2wɟzOt:ik]R LXr1Qte,VVʒ˞F}:HuVII9xBIunvH,J]L:%M2TZXؒ=01߀DrV(}lw( 1a1k<`UKi&=qO7PM#JDK[-^CdjP JdDmMG{hfxTl#&w(n<Y5DОgճL\M(gĺ@F2h0pZeyʯ*nRW(^Fd{ŤIrcFic(ضemH5p~CI!K&iS]z^SZSK?P}zۂ-|ٞ&Qc	m0)r*0dgnu0g<.SYY+>(,<t'T5`n٥5"^sۋ#N`}k:TY҄
*z]Srh<?$8^FS?u$^z<\0U
Nr3$QwydEmG@[ms%PfF_b' m
s	H1þ5Tȅqr*ȱCąAYn_)gHݞD
;&0D~/,gByYd'+o{q"-8LR.}NJB_`>3I]YJOQS|OgT=m==SC!Vrb&qVϨc:Lm|A˖oiR"P47dx+OĬB*Ds)K{֭=ϦְMAӵ恖ĞOAdy |g'ZJT*ń:,sn%4*,Iu,89CH(B5vu"e;aP71aU=,5t#"I͊*,2셫vq;1i`!i#L"EXH$Nӥudz5sJ>E-ulHVr
ȏN1	 o8LWnH"aH
z'cboO ã2<8AKԦRW< a%'+&1e1!AĐkA8q<$֑ N+L$Jv'jT	a0|G	WP
cH;ʢyZS$^8tW+ҘU$6H8~</Z\^*WԔbeQ'N,-5	'.3׽z3!uڞk;)h@8VCF҇fn ,>C*v^8aRig\eۜN0YφWa4p}zA(V.uL[ua	3A#W0 >O|N<J;j|JuWHNITIXw,@hj1޿cyۑGN@\:-߶RM+K^Kf߸ݑy>2WV.Bzf<Kuf4qwπYu17n|RSnFi!e&DM'3|-ez/sFv.7>[c~jw20S""dE:G|NA.ռ۷:[.xnZ֝nfһܰXƝKtsnnDCGS}bE. (f[g	շC3\+lbҢS;**VvDҒ$AXMppd,g <]MgeG/NwXN݁ݶDS[rS'bI=7$xi.0G%͋!ZK+&aJoY'(BBΨf<mUUEtjdTN9Q6fV"~+F0F@rRl@ׯNqeN%"?ɐ:>ߐs(,Nٟ=1d;C2/1d>ʖg7mJ5Mǎ
=FFPD 1溟t19,ϠJH:NK6F0}<hY;ML+觅S+P()gW|kxw<$9=D@(>=}XSd-GdSuwk#u}}Kdu},mLP9%5FZ96E]<CXmepѾ,Ô%8ZV[xE@,xT;wr|>xe9`8v6ZJ&4$7s2X/ fGEPk;\M퐊;\֘sRy#ϡD1P]G-DYd/q[́U.RA'+*.ڝk	b:gub	V<%-"E\ICM` bW	 5Y,+96AH8frW>6g)y#&Ē6s04I)'gr<T#ax>4~;t`B4A,2kpI}QRK2'gM˒x#$hhaCs!!eٴȒֵzNtZūTm>IY.ekeRae˩$꒴=0הE9!ۑ'Ȳ#OQX#ɡ3;cis0>|?SnxлCL_u%],YU۾AƍeC:x(<y)S,ubsc[mزx@or<)DADih4\ar3W	~ĊĦn9F7 ɩĴך[/?S?U8;hont.-frYj= @u\}gؒ]"W>}[4J[U[ljK _Tz'FL&d+(q.՟`E{doGRGeScK++fT*hUvguvoUY˥}jڈkiE0S笡8,eVQ4Cq|0i#['ѭx^yF9Jg?aS9*sňܒ~׈LtC[2szn>=0k1Z		9ݭuglSY1#ykf\)fݴci-ד|L잓#ߙ aDuoMѭ	8^!ƓڝMdQPCiRϼ5Kcq<ԲnAW,E#YCBww
 (oyɜ-Nņ6OYhβld:8tY8UjIJh=mx樹=̄>yJyS4Ie>17fEnC>X%t>9۟+2?Q@:D>j>Eoq}]'oLY=0*?9$!W&o5ޠt+C믟*\7py-)f- GqyS֗19Fǫ<Ƅ5`e$)H @pVw.$D|#R,py?/9Me3BcϢEh@4iKN]}򙻚op~K]M62n v>f{='^`̢3YS F#4u;Tl'R^U?9Xg4y~Z!io$S"F|p#h۫qy`1t|: K/!CsH]M_
Jtwm 䞒٧UT頤	7~D4$߁.1ɭfixx4y=ÚM9y΄~"QxiM^JcbVB4v|1Igd5	3Xondu7!H iczET{><[g7^Rǿ%b.wN3&d=X]RJ66]\KC6}Uk] U:%%H3tmԜh[% I_DͳJJdL wԄ9Ur~9+<Xm4+jk3xi^?tn5:<]CzK@^h]T4AbrTLЊ+>&y+1lH	7IZ@^L2f;_U vriFQ8aFEf
- n4J~cx|a2=ނ?k?ѻiw_Zq";Onr&GǑ^CrAo〒#.q^$:(DG#ӼEP۝i5F.k5l/|ZjZjHTp3qj8l?y60GÝX6Ш7Q-crZ:;A:<ճKEiՅj( >I| a%8Et&\6nC>szy6)e̉VHVJ#S3ʞ^_'Wi;[Y%/F.ƵQ(qsV*<yT͎
$tsqSPX(8ˋJo{SV\eՕX)="0q33] zWO/f/#g7bgkקRV+131Ax\~EEa,<Cb]nlwϣkVT9jƴ<l*Q#*yS\0>+L'=,X>ɾSU.O3bs)oxHQEse殚tx`̲'Ʃzhw:S+A=zs%GC.HǽxRёO-8vARFaWK]ZGȋH C:)߂tP5vdCc{,u!\ ΐ,HZI,奬-4i*d͞7\XsDӑ3 iESσ^8t	x6ُSm1WǪ&(8S6mwD=P8ysL=9_{򾿌Cqy d48<}Hʥ8'FSÀSv;WNvFgc<0_˙((85]r~1chW2´-aы7!q8fڵ=u(ޜQ`Cu<;;O{bS$D7
#7jiڍGbTbJCRcL*O(#{<^'wG!45@@$@-o>>^v^o3yv>G+aQ=oX9o3	jL;x. ]]=>Ddz:1Q'4כjAjh/<%I/a9鼕
1CSj#eJC^;i|5aJ'k3..2*KZ$lJ6)w=GM_w\j* 
k𲊕rYD㝗6.Ljtj|BA28KRABls,Fn6hF{S9BCJ?tzNF9%B*c8=++v@iFCamK*NG쒴濗;{O遴=NS/8$9|qD1/CĔa0T$ D4<nlmV grfM.
&}	.~2>\o!,lC 7W8[Z+2g+ە$܂뜸
K2{9,*yZkX*Jj._E9Ti(-rC}aenf)qY\*,O++嚁>w/?q\󓓋e+̏z@ 1 0\/Ȩy&mNFӴ/eX4b.G
OG8Io;17}N@:(ƴwaz,GqOV^?THq<9$Uf=dCco6Yl'TbӠvQoXK%ʟ7'<y]g}
F.#5Ġ,׏wVfFs-].PAwYXQA B;Wcw/)rH(,9+GeLXm*ic<ȍ$[($XY{< ر]80GN0c^l*oKl`)*Ҷ7! 2߹8^{tI nwcMȧ_^Н	HG%_?~_XjVCt|;\|;nyǗ{ -6A]Ėbz)HqR%6/Q]dܧ`	oіΆvt>__g=4;pOܠ:z::ev,OfpYQdYw!9/؍w_>a'[<4	\Z!,5ascvceh%;Q5ե]K9!/kS=2Yd-۲,Kd0t&z
YkOub\h*/N\0/xfvأ茻xxҐM@S,@\KSpYecYFm"+bYNy\E=ylkD甈ȷ ldbY+mxy0Xa6i70SBUy\'3p6}z}aobVl:vjsd).ly؇t䤠юwr)/5$w^ǜ^mW۫Cǥe3;aϕ W^Qc v;?~֡WX (}<AKgFBTcD:e+rJa)uHkSɅ&Tc:eX!FGJ3:DlI%7#˃?TuUChpAdxpLK/ͬ	lAW5gTc5;*o3'pC.蟂շjM¾jކeVS#!&m׻][H9M"Wt
>n闩\H	IWZrA@9`OON`Z
QsLEU5Cg<aԗail{bq,sX|UԴXk~2
M3Bwe!k[H0z<}t<m[Oj!RC9Oh_8Ck+/wBǷ,o)˞Fgۍ[\[.w6_>83;ЫңcKG}rҾxͭ?+,DHin}Ipc#c%#iH+Ǎm0k"eRvnL;en17-)w@hm>qFIuhY0I2[8B?s>7K4㻬2(WT(m[:	`{a&g֪qDPoljK5dWn{,H@ohlܤ7^ڞL_~$c%Y[}>QA<?NQn՗HOvjNQ:
hd/vqrkp/!)(hIe2vaG ><N^^]LSLhEV
͍o5GfYo>+r$oh9M\-}\|n7?Icx^JX &3Iɫ3rN>FtpG'8- 3^7;]6Ίqhv_6ZoZFn<ǿ6(619oZ	7ts9!Q=}̯}OVXeqB؇F`xx|JXS;)CoQ	P2_N"Wtz?B[7ͤǊRKmVlE"
ߌ̜_iu}\1-!d
yypuխi|b1+?Xo)B)DBо{
jzܕ0ﶎY]nYѭwZ>.W	-nY*ۯ ={8vGdmwRvڗBw;W`g ZM}<87cي|rxP@r뭟zo㗇v띞U{\`O~IaZ<є|40&i?|sp_O"Rd|i(eOizI˾MrC=~^oTnnkԫI7l:zR0`M֦sOOD
[PiA҃^3X?/iX	0D__}UO~1?7 m-`e<Bdl :	k' Ga	*z:+͑[aA]{6<]v._߰w`0u@E/{f?_XQHa)t 
΋?w4)z	}SU
ȋ;[Q,cȍaUB]c:{'
63S;Yv+3g*\3qn;7_9,jǋ(6EB6ԥDkؽH-9]~NfmI~wRᱲ;;ryQSiC7\ (˜4dK{Âa3᱙xIee{SIm9r 9GzKOLO8khvRf/>.j4g{J)}͙JOK&L?rj4x]%kNoufVƅGϸׯH%AO즶_FC5M=L|}|F_n1̲]_U:>"/~Ań5nBM.bEC!7VAJ(TrqĎ<q<瓙R!ʼ9ۤCR C|q/W/7︎Y\MyKg:xIswԿ 04:{f@k۬(ԛڬMg&ʹU"bT ?o/':O}?׳lðןRix%x4ȖcW~{Z+OIg5FɈW>w$Q+_7tP)#o6
8F9[	Ka6wiJT'P2nR؍82S(#{C[KX:¬{.7pboikt']iI4	yq`Ol-et
W/q@؏"yţ2n@_7_,2}A?3o{n&i0Z)L/j铏ӯ[[p{i{̱zѪi	#/3$eVU0[;P]vF寛fˀD׋*kw`Blc6}]_+`{bV9׻N=)Ȭƺ&[k9ג:'$@NJZ[UB۱E%4"08"wZ7:#k$;k	rTo6x/4u("ُ͵vanU(,.Ѩ)nqRp]r`QdHk0ܑI}S&)ކγ{87X>{`LBpv^֋ʷ&f\|8(].,*3tk9Kyb,ll [|E`O&&y 1-f_i. <b֐QK}4=T /+'@*EĹ-sw.DheF#|A E Gizֱ(nНB40p	L _&YݐI!F_ptv)&TcC*41?=*|d5!aF;W l?#8;EҘ5q31AQ4R2&g5)=CXCFZr"?7_ev8'#%5eB(>XFh⿲;rge2[.;<m_ʯZ*,YnUW[zX7:xfcZo~تDd?[yQf^gZu>$`[lw5GҺ:K.RE>3Z"ӾVF#Xo Zv=jΪmmvVbkNc  κmXڈ@nVW]qTq=Rkfi@zju\vkVjZTmLK<u6nV㐽oе5
Ok]5B! HWUXH4ת#nck} AVU[VQ]:uj
rְ9gbpy5[@ת]h@
T/5jB9C	tEv6,@Z*H^<q$ D^Ֆ%ѬWk_ZZN@T[PXC4EнX@ZrO됤QE]KZA?kن~`DuL;#Ujխ5X34Z֬ ԅ)`AV|j[vī64I}ӨC_@ϫV9cowjC4۪7gmmU>at"DoеkubXmRZzm#u`}mEh4W'Y45LQ5[y8k(j98x1SAˆR43σ20=WbQT}|enWbPCbړgn	Ӝ^񯳋zbWj1>$ti/6KC@!a-mMzD/OT*i*ű?7L![~Ȏ/g;d[j"8g5.ӡ/k-^szh(oˎ鮮K|8/ףT
x<UshYNo,Li_
xS,+˕Lӑl<
HJREm{<.RU/G]9oSSޮЏ|JΩ?̓j>甹k98#s^$6ʹ,Ydw0=^B++_f$Յ9LH;_RXzI:}>3V86J1O?H%G3aEkR;VMO\||U/?#weH?a?1J7QBNhEHԋ37Ym2;5+.5i (ZZ`Hx6L\톓w߽NC4]Bң%W_a&ݐdg&#-:ZihTV*r>3^48F1G?_al|NH豚2N; 
pd)]D~jKCz'~AVN>ka^A]<*3ep:J*n[jjoڒR5YK
CU)W$ԿUK0eBUf[K+;RV*p#Qvc0#J"s
9prp.D괱09 \NPe\Ft/(^@!FFdG`ͼTM~$N8H^
Jfa`i+0X )4u+25M;t<dTvo^y	Y*+r\QBC	QA:Y!. zw$7e>RB]7
hKXYVo}I-/1TDlM=Q3$d]20;a;hIDdKHK@^#ޠL	s>:։}e]l^#z媠EI@	IkX+ `@0fUArh IdE
W|:)эTHvIڝ;3W@4Y;.TKY;'.TM&qh:C=QeEkl6p'OXE	A	x	g#oYv2
g84@*`.**<WL%
5wTt=K킴	]K;ΘR"5
/2!)gb&J)fk9ؐ=X__ߦ?ŏeSOqre NρB$ uzrFWٲjvؗ,43dcC25+ᒘ|Be1''0pdi?=&9H
u:sż?uA<߼9`xڎcwB0kuыr\X cXbSb mWţb0 Y=Mb=88'%p*=?bt[%;}D2{l`h0}39=HV\/ш&zM3;<Aa/;D7u9v8"Y]!aR*)W+sR}&Tɣ7F5uhD՟vEj^dxf΀pHs+HD'A"¨tL{*S}s=|R-DϩШQ0k=Xòo^fV LWeݒ+Oaݸ:Eԡ5aǘ#$Ԟb5a~f3	EMӋ0A/dۀ!fEY񗢪# pM
,2`h wQ|"*
VKC	LVAL[Bu	]O5bKB?J7'UPd!B)q&#\
!Huu+r%_r5HJcҰiY5Y&ߔԉȝޑb.ω▘BK:[DC3g{Q*,i\~#eg߯O	k|UѸ_+8`Tv􀚄7oSwc'Ѹk,}mX~u¬-Ȝ"=Rś8uDH$:`>yLYgq_Sx^{l?/
x];oG![U>6yO5p"J&tVC[A	X	kI:7TJI|qi/u8kl2Mx(yVaSqqC?K 3l?Q=sT@fD]g%D'SBY6;]pOr#=ƃF@="~zYڸ1CD
LӨY .שí?
lо5OwB]8=++ڛk"Ňy1@ltRٱTCH.on׳z4D	quFfL\b$Q}CB?sWP"R@dW5t;ɹ O.1v/uu,^
62`F'+4oa,4Qe6-BtZb L0l[̨ՋNPo6zxz;L>6_`ldAwf$΢޸wٹvAB>[&KaώM:Qd]~(;A66@vH[!e+ǎhRlFy.՗afs t
cdL֜ղhBuGu̅GԙS#=ʋH6R5d2>[Q܀LtWdyx%	Z]0.@a7euJTk/8Kt		L6ʈY/s8X|ԍΦǨE[( 	oXV휣GAܷn/>V#;s	@ED~'eu6Nf4[uWN|d:eI/!jK !sFpOE;P z9&D[s(Њ('Li
Q/,x[L1,$uCV}C ciT-  CY[X7Yms
4 
~HP܁Yv9}hosV-Wr 'DU;?~`_~~Fu+ #(Kퟨة}G(n-ЩeK0І%W[,s3s7HFݍ6Ǧnaļ75JT[CF!SU#>?O9z2bS"q	EyNUCqщTIؖ	~*;$x~b|gLF:K
@ t09^xg;3g499ǉpJF̀X}r=91f!54n)AvYF!A^)zG~ht˝x\0[p	'=lY{z@ͻƍ$IS
㳪߉u?ANrMDY8-)	UڙPR}b;ZJ]z
'i"h -Yc'|kJ2t2+ಊY	iaoW1a P^px
دF
e+>BN U0+ojx|uLJݼWBB]7_M(BH^2
+=jD?j_n~ ɬHӗQg;UPJAJKJyyJt9qpJt|5IO=-/lz<Nk	LK^v
6Og\Qb* j<KR*%RTKBU?$"Ta>>&fVt;"{qF7_vs|7{¾r^OEUG1ۭnb.C9L.,}Gwt!0EBă/"ٔ=d>FI@eCSca3DŃB132fuH٨j$	F,˞UZz,|D3r[=dDưGa?F8Is'j[h]H%G2BB4~Qbje HY
\&؁1Ez%\RXaKVRH
[1KT1feZpAC:qBu/70jL`".i:Le79"JEo+s㼁;w<BkvnLm_'hti+ZjᤐBb/,KUGS13LZܼs1gO%c^=+NÀΌYoC{/KS]{Yo@O"xx"4tnyJ;<:(:Pr4O䉰+8AJ̙ޗ@d۴Yz/[x=_Y3i%㿍~n`'`Ð%3%K%xWA@`Tunw\}JSeZiRbߨu*%BX(Bp$ 1@4 )T*<$@%0 A]-6F7V ^ۺNn71V/mz-yx_"w,kΟ}
jJ[	Nڞ+mnoh=r(5H|.6ChA. <PcG{W6W=-,-c
3^
f桌=x%v;I^k zt;t:Y$3T* [\~;ȒK܋s Ͼ3:5	[s)鼏Y
"h6">QZ
03uMDA_A(!H7|HXp.Q]#_,zג%țPMC,A`HMܹ1FȜ]/ZMUAm0tA(T<↮d*ae*3.Q7eEbFP[DKK$e2'7<u40"rS,d׎,0ZFiݎJp?%ؠYgI$<5s &ڦM9cI%ZlE<c3Y~%h40`Y1Kl8Jȟ9Pɻv{_"$"[ cH>ny ܇_xLcVhǨOcaFV<m.T`2	!U*uZhԢd@KO;]M\pBH_XML~!2O']Vt/' +( .{!m2np=	3W7;&jYq0g9k~aj@A-k99A( h 