#!/bin/bash

declare -r e2c_version="0.3.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_res="$(pwd)"
    e2c_global up
    cd "$e2c_res"

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(د_JL',XUiݚzFd V& IDggck{}5ۯ/Yw 䅤nBUL\n>UmF-+.Vo[vnYXo6ڟ.Q q|(HɎg#ڑN.?Ffټ~6XvU4[}Eþ\_]\翅W~E?
g | ?<4!'h |tZYߐzMzk@Jom|i/yC=>|.	~?;/oj.{͛;N;(zvE0e_ٹLΐUxP(i dKٱ7r7=yq"7<sÈŧ^DiG1.;rGy1|v}( xB.ū,Q0>9|gKW_XuC2ކM-C@78%$z -A8p k N]~tƓh&T	gA0Z}CsaD*%I/~8ny2X5:z~5t(M0x{]4'ǌ~R靛x_bL}1ݍZڀh/t{~l>SQV	kLĻcgJ#;EBjl0L/#:fnc`¸,R~p/r	'wQR^ݝ29V.69rR;_' (8rF}WM4d\V>54AMpvas8LaoȢ`:2?LcX~bV/{o;sBߋN8#mQf]/Wݑ rpcmmZ>6٦"T$ME+A4ӠbPLݡst_&7MI5&٤"TdsQȠavo<Q'aW}$
D5H0N_z啵R.wȀ>`1+()ꎶge]?bj-a=\żT0H0j06{ZgU:?ֱ=/wy3~AIpy)_d]q4gT$UFS($r\}`a
W5'Iy%yuЌƬ	6H~Uʈ8d}%Gn.IN4诲*~ni[G_V*a&'CHq1{;7[?,m<S1M"e[bx[9遠et6\AڢV^.'.t+-/tG'<aG"N+dٯ<?eh$#e7[\t*W.$hHgFw0mf;X s挼!Ȋ}̀_Vy0S/WX2>	_(v쭮ڷw5k=<i/Oǝ]+ՊC7>qjҸ.7h;a\dߧ.L\~z1$_+v%9&'ѷL=P6PtZf M' qZ'g?qekS(ATzMB8쿯hDPZtm q's1|]#j?Oryc֭_q `c eBp.j+'|QpR`U]݌ A- VU[C1U! }꣞f]^}r窯娰WBe8E/|kFnE?r$H,]2Th@IỜ
N%0GjtH̻>BЋTY4lA{ӌU <TW>=Hj.LNu+H2xø%][ck+++fJ%	 w+"C?v?Ƭ"\L]R&q΂YiƹW!i3BP|'_r]//9F_n൐`\更W0>W47?)_e~鄞&n=~^!{Ћ
y?p}FA{BvTQP76/\Բ=xŸ3HI.4y	,Jv8H+%	{(5aSKMj5e!肴ݯ+y~Nٜl *~-@fXk7GK	"ހ26<osLG#<s!igB~wt©cß %ЍQ	 %N;wCN̊hx̭˕q[֩;|'W:ã>*%k</l1wz0DW*᎖--d<K֐es-IlQ
<GyqVN*Mn#Hv'>{E,hEs:<P^Iܟvg̬I|[;:u~h7&äe/ﬧ;m>3TpՑ:Rb?
FC"RAjv`*u@fQؿ3bϾ& R*ɲص⋉ -9_7:d8 4'X{X9W>P(}c'S`d@޼bm:7;v`qhl5>yjg{ˣU̰NުGCyXDm|cȖIóP`&BWNل㙚si>:l%KZ]1pj9%KXԿiZ]:ݑtU!@Sv|Gng@{@W2';);F3>a"iA~4"
I9e5%9\+k-a_ǯ^~_WE;g)=+JH	e )D2C׉%FQ]J$؄T#B-/So! n`.SBHj޸ ?8L4>gh>M#;'		sZ̕*mjJҨ9MK
Hg*wŊ3|w0`#@vI)-©*Nzfu(xMx!Nd(	&"OblI%$^0.4TE!abQ$b́rBIQ?~K_5=9'*803//J% j Fub9]4О-zͯ"<[Yb[.!I<*E`S^C3S-ƝAɝ0f .KM3x>1(9| J)r7`H>+6'MFI7M
UA).$.aoVÀT	SNɢ^f-^M,_
_
_
^]L{k+Ki*Ke'z!y6d0DȩT6~S5K'Ҋ2дVڃps(19C5ݤ&1%ݸ]E#MkVpSjvSFڮ6-'buq=1+c丄]fхY1R&?O7$b˚I[/-%IcIrIˌJº0[KhE,EA/כ\X
~&Z~ŴXP8y.w]=TK+bZhʚhUv؆2Wd"n"f˒W4anРe.Wm}IB{ df٤Cn;p -"!GMaѡ:twT;kk/[Y=W/B},kg)E=4ddzXjw4
JJDIl3 leqR$xf$9)&~F\Օo/ ׉#ޮEk+U@oxtV _Y@I3fWI%=KRX391'{ÛW PDWW1DŮ']""rr|TjZrW0Qs%좭i-W2{ٻh0-OddqzI^*;V?V_ժ5@yr:_8ñd2p!ˋ-L5l6_ر&2E3_9Hmsj4ƽI6F!rڼAKcGƠl{7@CJ~4hWN%--r-t%(NS/]9^eN3fg/;[{3:w.<dQaEg^A0BuQ iRcvFt񨡃rt_SmA3j)ZЋr||I>>C|AtWGW,ME ~lqBATׯ毟?/W T'7BێR#2ՂQŲ"I}g^bZNXX q
2%7,.̝)6d&
e$Bӫb/o%[@NܷtRճ
[Yw},VV  VfaAer$B]3Wt v	"-[-cpMN]nL;i&C6sn7=Ԅsh8t݋PLÆU Ʌ/2Nd cN}$<!׬5%6:8CNPe$vU|8͚Cʲ3ڥ]=ES0_C֊;#ʒOacFd:P~w`N li1gQ1QV(>RQNY0		J|#KÍ|%(OEf/ MCϐG5Tao- 7y;M p8`bdMQ}$,_9A7K's2D1rHz~0!
Atj;>/R1TuILcJ 6)0GW$KEo&S#,%Y:,jvJp9ve^Ƚ1Ύg(=U*fҹg}!	.AxEdN#}	A)'~#,I5ʹSa`d)G2}es{l	RNiy9@rQzTK.Q2<̀׶tģڙ`y9DD),1ԘSnKlPnU	b-!0xg+`ddiG*<J1`FWdm0
ɢJ	\w_ t1/jҹxʔ4bE)
kU5AJ
\M"VWH,dOMX$\ dk 7"V;k;3/Dʪ+wr:Ax?Hڛ	pG6>4ngg<HrKXa
<`upՅnʨh`9JFS\z߬RIFr"13~R|x<v5['L^U~۾JZCCL&h%LaoVqaaH=a~C֍fgFr%+Hy͏o8yQ5ksCJ&5[3טPH>Bo}pP&8tSC-:+%k<zqPXF,2`|+Y0I@G|Gʑwr7, 95G0z&.rOMKGOqNz]tr5<0eX\a-cBW ިI@KDo5~rN&Dx*{il<g*yB63]Gix9װpTHG1Nlc#"a,8Foi'5cRDMAbm?F2/x#+ћ\_N[
aQ
Pak'a >T(`SE#(Zm@a`,L(ʺ+_pD#kH=TP~BKJ
1	y5Bc9"ƁBL򍁜nLA&v;!EdŦ 1r?˃ A4	|M8́U<Hb~j[+OmSv?VK&cAj'|u??-?S?5٤±DZBjgc|hn沎3HF|LATL5e(_A5KnAM<)Ba!num"0(]'jKTbE'MG޴MK4MC卹MY"+u*d|k*&Ik&Ikf&ٲYCV!k$_ZAOLn&wzrIZ]3k$) Hk$mh$4
'IEIjI9KwIEzr't82-K[b,8D&CR%&-vB/McTK,eF%2HKY4[yvs6Jk#
Y~zdθCh+x@-Jc=r}w
fIh	:cm<k#1mK ?D}yv<<׃va>AtdYVhH%p@ =+,PKrc*h,
xczRxIq)oz3%F\q)De͖W'D*UEe}6=|38Q"+!L0&>I|a4[,XeE]*q}-"cCUK<af%Qho.2܁ef.5+?,d70`hgN&T%P۽DB,̽Jald+Btu}lߐxeZYܓ-U*&LDhtB]+nBR{9hK{bJôHAO.A<ͦ5M'q{si-'	$dYduKF&䡩.3"0ؓ֨:Y
Kxh$/soE9==aPD!G^&aTN_	*- =(jl l@M:]M=ݑ{Jf6?	L^kJކ>F\77S^i_W݌a)U˾H6//nD"ʶ=W_xZ!Tg޷zG&qE'ҕ<ϟ]unճyP-D6Y@X9ړ=͍Mn{?&U=(}#F)H$xܱ7mPZCE8uc1c7}g.NuQts
LfCSO%QwѪ|؈R&U^YC'dhK`] Qpk+j6gnluϬnW5ZAC7 1Il/7!h*Cc9i1Sc:,&St貿Hgnm[RMKe,WaGѷPd'}seK%er:"לsp,"@s+Y۝:rEP+j)Vl#ݶ8*Z^2l/#Q$~,\q/F;<k
Hf+5iУdnh>2i͚OQ4/[օXuBњGa&oYno5G4kIv\..	d5C0+\Te ÒV%{-n^A;jT(٢W"/q-Ns*kYU~|cc'nդ>|/U2\P)鸗}[l~\<j~^8sSk*2K|I^n>7Z E]$FƷ$TH1<e-. Qay"%
 /D5aKic{I*JT`s!lWRNI9سܗAr -h_Fױju2="Ͷ~ՁkMx;bcpMl
cpCUX8
qTX+r	_Ɖfj!mG\5[1k8s@c=fR.4',_C.T,3i\ǟN'vnonhwۼTdhY=1)xU/Lf1wRWU/W"rd1bp]Y
Es]LyxdS3{Xi/϶߹*ʅqr8Qt\7[z9'tHf0;3cG^řfݽ?#;ьQ{7/.`s9w e+V[y32H:K=s֑L*/^oo( m.ov^md{cW?}ϯ_ B<bVWs\w3EwqQ!M;WU]L50M7n@ۅ"r`26@T xppQnC|;8h>$D/TCXM<ũ; U;Wgw !xV'3\Q>B paX,(9ͬkR3iء;	l k>4$@Hk(-`dYN|Cw2
.XQ`ZnK;<Wa.x}1UW/;+6.k_xdeluu!aEu:rOw5J)F@g ',ŉ΋蔼tYtFy(eA|EvR`f9/=E -<j{ث7l6[l`~넙rZu`v-en x2vD{­#F֝2KTP*	-ߠ;fqР
`Ұ|Y*yZl˲I~˔[\~6^)B3	.1C$6#8<RE ]c[˵##TmJw/|JOd%//mC .]Hz`F;al$*7?\SVi[1 S[j~G2׽5RI#kd5&+d*>NMDَ&:ikA	G2NͨLr&1 a|-=ڊǾf
&kRISIh/TNd:S7	zUT6&QOq}ժ-W-Ko<22qe1'I1nI^5FqRx*ψ`DIlE<pKARjW# |MISph_0MyfdZƌG	:OVhr'Yl-6Sn+8E(*
Q|YL嗍g:-9fs9yֶTCKtC@#N0gV5[	gqs:Bȷ3f{FBG%/7'X4 /iv6PG.sǓ>3Oǐp<]i/d9lˋCf1"La:ط+>C slBREqd]SV
h81^F9u$^|""ßW?aG'<+F%$\Wf(7tĞq%P[a $m{	H15Tȅqq*u"&AY^+gH}7DF
;"08Պ|a9?3u̻H"cUIi0'rhS)zp&nIz \@9MRbd#'%A](5@=YO3`7?3eܬAm5T$5'\Iۮ=Ʒl'ME<ė,) 5A@svQDQ"8
]'{i~Nm@-igz&9V2qlP4"N*j)1SA[ ЦP$ޚШgOq2Pp8`S!\
\/	˔iG⑄=A}HlB;17ӫPYj7 +9+M63T>~brE&Z0(G:ZZ3a!	NQ|H~L*ݧ:lb{,ѱ#N6 ?:6|Pd'ư2]E'Eh&nwql41~3BER3 H'CZ</^6*Y1)++C ]ľ+*G`[8TRuKEeL$\^0E!-x=/AI<R*\F)'t*PJ.2|M>U2ex˰%23^%-.A%+
ﵙ]f8
^>]Rg]:2ED~1EZ:&/=J./ qdKX,WJhقS˖~ʖYA:ˍLچ;I,din.C°Ex}D5\rJkXLnY+x ߚW-tZxeBigahs:ތ!j5w4y;ĕ3mp2;]gre7/gniI#А,%e԰0q]<
8	&TȍrnN!-R4%.&~QDטc
%D])Y	;M|(IwT0ޙc䠬<FC\6:]ZM+O^q߸ö1bw@MWyw5EXM{̪¸-tMd<*%̭ers:CS8t2_NW"rS+;s޴¨p9gq/9RsVt\Mݾ!^o>ܨuasr]lnwsZe7n]ʤs[^腌Mh٢5tH0sFpF:d# wOۊ&c	W&XnzLMLufYh*0mRZmJ8PQFAi>b?eM?rIٰ|GU`!]8[<LqBխԻi=&O{Nr	v7亞zoHF];a@K3/ԭ	rD%0zo##wó<-,_mѸ-Tz&^\	lET2[a WED1MA~|)s>7{mYjRs0}b&(N0ݣjet,3&;\E.V>=]Q+W/mp6dd铽+tuuKdwu,eT95Fj96D]<CZm9G^*gj/	ըj?rϙy׬&GM_ڤdb͜c` 
FV"̂^pnpYc!ioȻ{%>NVo'rPl_x9Dm/RWNAdb펓YZ][*:(	yK}[zp3EfRFj\ty)pcڊ"Kks)_\v\
GRdJ)@$jʀϽ38Cai7v@)#&Lښ-qj .BwBCI7qZPIk|O:du3!T_%<? x	hX$oA01cdpfgM|rq.<I8S/lzb}'!x(($saxjسR2`I`1G/,TUny/9A>mT P>3|x\O9cQ	=Ơ;2ڠx!R&7n B4AndCiA(6v"r$sk\P/L7^~HQAώnagЪ꾁u1@%n` lT9Pl{^h nTuaSj6iht&cO'7\C#w?V|îVMNpO}J@AHJ|Kԛ_יSm2Rv[ڥQ]{-ߨYˏ5qJ=;YEnЎM(GIkdoN(.F70SsBr(5<ohQYmwT1{3$j
ٖ%>39)_f	}Y0i=]+pǲbG:&,ͪRYҒR('"KǛs10]]ÈޚfqB7Up X!lhDe!ܞ+Py]F)x˷?>xS/o&s$:0H|e=?wݺ6fWm')ٱo!$C`<LѦH+	`hMoI*3W91+rr],9,_ɓA_]g %l9=BNUu(k2q0e!d*D҄\훾xҭHzZQ!nvoE)08J+-1zU$+#IAr +$A劝K2Lu"^s%ǅIuQhyt-q6MfqW殦mk3RW]Ҵ+^z	Wޟ#)6p{~PMexI,>"oY+$M5= #1rJpna$.m{ GCGx藏ϧJ{D 1ܰ$܏х0C{/ B)mӋsb3׆?|'4Hӈ<z.<#i$^"~k?70Dy
;FFkPR.p0m3Xs?LH:7' Oi6M;Zf8Ҡ`qXWKFڭeWd)JEӿ@tz@,!{Kϟk90_"rW=gB#ѥ%^q0dӯ?2*nX9i#t`(#?ݡ=4ƃ*I]H"jUR*墔m&a yGjKyT[s{H׆ns!1x:
-fHK(\LJIZqe:"/x)F#z?>)&M+(5܋cfFjZf7c;ǌfkt* (#S/<l\M~Z ~-h7`}rmFt*3:JxC$I8 q@!z?u-ՀnM6ry__cX~I jUj(VCT=OcĄִzp
.y/N*%DQK#hϤиg+䂬ã^-$]|<ф![<6Ǻpnp8ͅېfjk䞹^kѪJQHFCѥ;ҙ^F_'Y;[Y%/F.dƵQ(q/ʝpV*FyT
et{A3PX(q	JozfPVBenԔ6jX)="Ҳ~I|;3[",;asX_LGn.bW'aRV+s@xT~IEa;G
ٺ"F-_DלW!3	riTFTgPta|VNNBg8c$H**VSC4I3HΑ/pO5GyIj2E1vj6:}R $<
j,.{r/.^襁YoUy )ţw'hWG&Q%Y$#t
`toI:Ͷ8؞</K?L gHVNddbR34i*d͞\XsDrpӑ; iS߇ncz:UR0Rc'!}q)쎘mw֙㍈t'?Oßc)u&W<GxXI<b^ N0\><O`@O}c:&Po0ڲywRxWf
^Q.MS9pLxqL1q+a[袈SigXwNq+u(ޚFq@uĢ)7OMgPL4?fGՈ?#xh$6I5./<4>r쨗G}eBS8\+Y'g٫}Ѫ<g^yrOsת]gyOVc`Yms! HG!hKsU̹qBvΚ}_IK7vN6ozДڈGxn-Pltc<8sZ%Xigx|o2	ڌʊ><	5yJWГ]
4	*R.hz&!I-n3WMXLր|Z$HgiX/yA^sϙh:qio&CrDQMɨ|BdGe3|~=n '(ߒ]r\wDQ=)=ղ'ij$&.(E62,搊W(#[Ǎ-{ 2x.4ŽE To!:a\O/E8kGf8@Y_JgnAu3K29,*yZkX*JhXETi(+rC} Q80df)q[*,O7# dݾIOO.a8@djT]AF-77+xmu<f}\,^vf1~)'mu!35/;$1l`]^2ˑ>tW{ORG\.mm"(ɔD$fЄ}꼉k5Fj	4裤]x["JIk.'}x.#}	OmAa&tиH1(,E6(YHjK/0`-iVwPy7bb|fh}pn>r5T
9g尌"2Vָ-!]Ŝ;"A#j܈=l<`Aq"roi
SO\yyz36拪F""m;z	.r	-\{r	s3B6X騵gKj}o
?|sG:KrܜT&KVL/%>)n[fh9KcUr3N0^ܷ̄hKtgC;d:ngdY6Z4&nOnЉgk^-"~^=Ch'3ꀬOd2Bu<ۇ[AtB@\؍_>a'[<$t`Ț!,5Q;2`={dNTg-@u٠vz(ʚeqL i<<*vvӐNGqY53Sŧe5Ͽ8YE^od?Zkq(]Ag4
EHG2Ĳį33F=ybkDȷɦ|dbY'mxEX}?ˆ)CAAͪ"V\7`_GV[ov:[kXn7[uVXA_S\,(ǡ;D rD;ɥ:zzRBV:Nj7}ŕ4dZ4sިjQߗJcp^,vL٩Oy8 K7ѕT'8#w@S`+4K|?ѹG,Ê0V'yG(Q=Xi_^RUC'vI3<odRK26Kgz3evfu|^%JT	;ZX-ׅjJ$Ĥfk\ RWOC! )2uË9)!iRK_L	7nhq0cX"ԘìꝗT;0˨4v>Z38̹{]o,ԴX+~ޒsgBo좵!kSH0z|RDt<mKOj!RC9OhCkoBG,o˙Ƨsǋ[؀//v^>s;9cIg
>?}SYf iXʳK 5~(yPADZ9nB\d)߃8H^
 ?w"<wd}i +SǜiJ@Nk~%&UQo'CˀY0I2ۄ'~]8DԙMΥL }%{&ňV}ppFS쪍-RGn%pFZTEy"ǂ&Mz}N.$0N/:6NZlo:YJ'_}\rdLf@zSp:--G{$T3Ϗh/]ǥ{Aw5IA)G-6{s'p:dbDG+tKw5Lcn}`O?7Z%vcܴRI
=9XH\-}\|a0-%[,vAqZg´'
HQ4-g8r`hA7I;]6ɊIhf_ԛ8fYo7qZW׆הن7M[A#g+WԵv}
O0sgQQr,o>$eԊB6w$SrKvE۶Ctz?B[fRNDM6+"?wkQzV:;0f~5kk]в.y|AK[;[{?v)f`Q[fsZN1KD0UeE<!pvuV;߁9e`K=aE#K%bKHvE=?493}{O;P_!=NƎ7g٣"d7[zY'$ɋ[/vz$/vY`?~OXS<i/( [	2܂O	{_Ӥ}7_Wo^e_T\_vn04=էߦ9IRz޺Pn=Wi7<ZZ0MfsOOD+i|A#J^{ߝ\|JBOV3	f,o_DY<Nd)&Qv-2eGfŗ9
+Qכ[|).Ei
/oX{[FG;֛{4_㫬
l@]jOƊrq?S%
o0({[;w߅҄egt%#f?l#?@kt/whe5: 0/h'<x?SZlz `.whN 0A~9Pj@+;Bo6ŗܐ#Sa{"ŉlՏnHlyG<(-GeAH
i!ݵ`%vx"D$Ų=⩤r`1ؗE8x9phgֽnKF,i-	6ɓs3+9~ukUYOpZkll]P5u*jǬFD7Ԏ>$r?txyn]\%5"ע5gȊZMCJTqRzXD4NF2}2SF|Y=hQ[$,-nŕ
[co63_:v%|V}^3<$?dpeM#`[=y3 gj-k	X4	XU@iTqԫ=gv?m1{כ0z]_?aOKO)WvqSXOn1+=xnmŧ؋G4ړ*dD+y9
]e(AϽa|(yZ7gdEp^/hFУPJY)wRuTEO#hd܍Bgc//h㏡̏m;/dc:

;
7qӠ?.w&]i`]8񙆑@vc )SV٪^6L EG1/8ƹ׿Z<*.Jpz'z<	YxV0X_LZgzQN8=nޫUdyjF6&^eH{5kfUsҎѨUh;`1^g6LMoCElt'_z^Zm"̚icg#l/}L(	:n7y%\5zӘSDGZDUg6to64{#!S,$6uVJh6ccc5f=cu(ޘ]@^;Pha d
r%?.tɊ(CsGr',676t%x,o8Coe4:hdbSjl}VKaK/iF@1"lL	4A[ߝ_NrgyCg25iÞ Ll94ZXJsG䞈Z:@틯+̝yYq0PL>ݠQp<BΩfn$1Ҩ>(`6Gqqu [33,@Gx~Gl7au<C/:P
P<ߵ`!}Fxk>^Űf=wM&d$j,iLGܚH9 ()9R~R*_ޔ\,w#
,b982;^R2Le!Ɗ@|,خ7;rge2[.g<M_/-vj5fkٱznl<k7Zc/vM&?5&S/ޚ2^k7Vm#ޭ tu56\(}~3ZD}	%M\pv}|lQMUk-^޴;Ma묹 Y piɧl! ͦn:Ѷq=Rvݰ u [ٴm^[va5kЪEUYTSf@VC6@76:<mtN} ]oٰhl#jcss A77ZViZMQ7vl٬74\bab s,B-Keln66A(wPx-y4:HQκܨ`!atooG@ϭu^oZh:nt6Vc7vk9hՀӶPXC4EнX@^rOnѡle݆Q蠟hA?El=Lc6Z:k6 Ձ-kMG<u /n
Xаuh0`ls!&|@"q{ՂF4o5X<y}l65TiDZ66vM)C]Q(6zv4ֆVb	9SW7_00'Փl2EUᴮⓣZ<]LIPj.JP"|>\ITF&MmPA(?=_FA-#3i.>(tKp_4F{
[>LIk`:2Zд'n|::Zb^ \|n=zC
&BH{R2
yҺE?GdZ
fZUy7GNtZ*oKZf<"V9Ԯ+kS$96yԇk+j%d9>Fq񣒔GrpQ۟x-LD9|Sgb}Λd男k#s|>G.^÷9e}qN+9E-r
c=½<PW*I3s!alEa%><	-lX1-xg)8?h 1?&U^G#ם0X'ռMzkwW'KU.B>Tʪ!iH?a?1J7QBUFO1wfIĜ̸RZW'!heCN?B1 ww;HHsxkPq&`g*@'Lc|SAXI|O2>ʒnzlYŊG/<?_}.Y_t߿tU&JHM$D	(>J4ﲐ{q0#K KoF]<*3eh:ʆ,܏^[iaXʒrR5gS~K
B5IVC!ӿ
TK0eBn՗)rWNTћ?̅&`F0#Drs&pDm(Mc7`z"(GςI[RO1`tH^`򻟪{Cȯl>]UR1/[QF2N!\6Q:I81Sx+z=V./E2wXrEw^]{smNwd7,vБCsTk|W,"HLQ72Z@z++jao?sFЉԶmnno|A0 ފ;៣S8^d]Ȱ;{/,w^e$'zoO^-ZGwIkLlHKWDg	U!EYd+ M	Wc=ƒ̜X#.'L!#lWִtV֤p'ǹ6P' %Њ˞4flggV(_R(y}{HWd'2(stP0BfAբ!	VW6JtQ	WpX[[K늒=>dyS
*2@=Ut>UFM2MB&Z}vFESll]j_͏d7I±!+Yy9}ٗXjLR#:1Wh+v'Ɂ̂$W^p^Kڗgt䱬wf޵W*^[*
9)H@䎒"eu}'м1YEd[JAA
/14Y-_^HgBx6Ԛ]Ozej1DOF;w<f+'U8R],2°%Yb7ꑒx6';w ft^);zv=M+z, n2X/Ϗbg4gHԉNEA*u"$rV,^]Gñ#cgs'"5[OD0wԓjd6QJτ*y ([ UI7FYRA[ӱۨ=n:mϙ㍜eq,t..'01H/`:w5ڃG{BKŰhGQp̬7Fxbw`H&d1gߡ(,`L Xagz2j;o,3DQU LFήP+8IFʭDodd}MFssALAf,5/f1ԟQ>E0@LɑFThT?ừBI(橌(Њǖ.ω>̒:<Dˉs'FQ*hX~eY_epP֎]+iLv=򀚄Sn|t'Ѹ+,.X}u¬m8zR4J{3jYej,!H]On(sw?r=>[,Z_1ǋVk (gZw/WKbGKa Il/ED3Fǐ
l@ &M3`IC2+<NRHDȅnV=8)?xiG}+\8?
3}7tY,[|裮:J|	2b6F&[LqN)e\㿀$i+2ci
΄n$ND^˲Yi#?Q<Ǿ{X@d]ztF7j;P`!rEJ7=ͅQ[dM\OCwsf%RB,4g>kp&Sp4t.`hg	3Ge^j'T}{P~³Mb9[;fO,gLv쇅;,sv{0C'6ŋ^6j2;gxqMk9Pm,+od4*Ι.oߓ
xՃ,	vn+n@_IGBbIʃfE1a0Ʈ(&a~(_3ZD!
č!+DOV}NxQ{18u`Sݿ28"ō cfMzx5K,#ltnD</9m!ˠy@qᢝ7!y pa hlԥt{IV̼enpB&<
`8p as9\/5q92`{\z[ "㥌M%rEH}6zc45F'/`	S^u9C<g_D.VsrJ#\pjQB	qLOY^(m)S̭T8 E3X`-r4`k!)[5J0J`CA/s:ճT6gVNVV8hW!ﾭ7F>VW++lK5.X$h1B)Sur.9DMXŚ@\vƪ)(_FGs(hAm
mP<zBE CDAP9g( 1(eNϠLMKr'Ǩ cx|<bcj^gPuRtPSRO+c	Ixr>3 o:BsT|0(P*< D :p!7@M}v3dhrs)o 4ᘪ!_бHK-l<jdtdz`4NmE!'J]1XW< QX0(/ 38/6d.FDs| wcuEEB^
'Κ3q%\Gp S85.WTW˪Sl8fe1ϖLkϰ|F$wd)f 9\5TrBC#&Ds:QJx
&4ԌJp"-E7t<'7bKC'_
`9WD@ZM]2d|;Lh*g&|L|
-ufR6~QL;si}5Z(5DAv\`hδkm{̚
%yTbLk(i}𑸝L !g%ld2ͨ8M,hlQKCEbÜ9HZ?@{wqa^~Eg/;6`kΝ;^D~Q?3[VSikV'7Y#@su?ΌB-e(<쇈ҭ~6eİÇ(	QI1~t sYѣ$u"<XɘYvJEH$SGZ	Ir&D=PwOkaQJX9gH#]2La٨u V{gҕheT.2_p"@PksV>i%;`6Fc^Τ%3uV47N*&/S~@]3wr0IU4M1	50+\ëHFҨ|[kJ<-!$LkChC$S׉7#4ebAfݬNlG|L4m5\ǯHe ԠbnH}r_>GL}ǻ/o5l]$wȋ#cZk4	$'?Hm]KCL	ˣC_%ϟLDqX,aΜ}5$LW"^݃/1g;f:[{\N:~n] >sD+_x\|\ўG%\J|U/Ǹ4_nMځ(xY*)ZbX>,eA{'=jiR	LhL IV? v9ptXǚvCxokF;r&x7}ǿ^KޗȁGxe:n7ap79O(7yP^͍|>}[! RSsYjq8hӤ/]wj/MH}I"H29 oK1;Ol1y5v_0|zwGzg}|˂v4%XŔQB HƮEes^GQ{RxRsߘIA$^k~Qx|Nw 'd͞+O	4;,#4'HNR?qߤK2)
zhp)][~2$ <4``;p$}b,-( {t/vFx
CMN-x8'bwoHGJҾ,o囍(	N={|:{60d;-t	9|&1hkvVhvf9@#Z:􏉂>L~}SSl%5Ko$>r:+`iW)!@o@qɁ`,&AQ~E%8@ fH"] 3=A|4.l@2<@Z:ViP4Py~rq$AX4Lsp t+M?	`#=cFtD
HNZ)Vz(49Z!ʹpv@(`Y  R ` 