#!/bin/bash

declare -r e2c_version="0.2.17"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.e2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80 and 443 availability check....................................  "
    e2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
        fi
    fi
    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.e2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 :8] v7(__&Vf݋desnMJM'd2˙Yh{30gΜa\`f֚/%Ld]H	[L  ~>mkn>65ZviwZVo4ך`OIz1r?KA)pD;$I2<x:}ED~X`o7(#֥_w#{wQ5?w'a?04<o5:k}E$>]@n=yւ_t(e[k94 1k._K~-Z"/>~Nkits]kw`"AS&؀}oj~گ~ψ5X3/`QzK_`?d'~	҄%~|	;KO LR>;y!C Kh4z.ë\h2x:bȗg:?D0W惶Ƃ[d4<@(+k_CL N$:071Z}Cs.	e5kI/>4oY}jޏ;L؛ӝ0/^EAVNt\y3[Zzg9-1v1>*
<dtAw>{x}6IvAjųcoJ7&Bxk8̌:If>Lj0t~VDE!8 e݅ۯcovvni.hKNc-F8<FGF@5iU75I?80ݎ`ڍ&0Y7`i4X')`x G|D5ߧ߉"vatl[tfUnR^QCFCEAv F(!vdg1M$0M$0M Shw-jl0kf-"-"y1	5ۥ,dpGG6[T#D?cWY^%zZ9fe-gMvmd=o^VjX*D9\ɚǵV'!k>CksXϛq]5\KX늓9|Eg IΠ'.)S)b=coz?&T/8O%;1[םW\^ѴaniB
[Go:pԳ}ͳ4O8S{w_zcJ!뽭<}gD˭V?z#<RU+kb(]O&1⑗*?0O|`?=|	vjk}WW߅ ٤&=m`|dμa0 5s(^!LB߫b9
z+[u~wՏƕ[גՕc?!sn!7 <ػ5O|sGDrgpJGл+)>YUdw	(ylaTON\5MKOMQ5]`עnhjhZ;*Q/\o-γ׻;[{?n7WUE>N`JPL/$Q$h~4{u?o8Z5?<	B?C9fV0kcU!f]NF'/o8||*Qej+p*^\ލ 7مo*FT9R#H,L4`I\f+L)wW|:ݐ[&E,Q7u,yV #TU@`ZA+@g*p r =H+FUYʾdVLP$Я%^0?*\L(UL✜%o0ѬsA"ol@譀Us]/Ϸ~yИ`\g\J@a?W%ͬϽ8|_ڄݭ'ΓY M% bwY@vtQʐ3EK*k~)`gr%y.
	RJ	K^&RZl|JKfZL9A6*Ȼuz oq@[M#(x9.Z0JNPo x2@Nsb_)ݷO(r3b7B[%{ 1v>z?p+HU[Tv38\ђ* xÐH1Ǹٝz2Dj⃃B23!#1,ͭ$E
=WeqVN*+MGN3;|Т5C@eY͹?
s篶'[1Ŵd$ЍC)9!-{y0g=(io1[ՠ4ґAߔSãh8).FZS  ˊobO ; 9(Nz1Ҟ;5/c/!&Ĺ19F݄`iJ>Px*I82aoz6{W;ֳg%š㳕dW=_zW51sp1YҠB>~eN"^7Fl):s?)fb1-ld˸m4j9jߟ>nVB٬Ֆ-V)V7	oZQIlm/ ]JHTQڦ0#nڳ7eD>`Ǩ^cAC_d-ȂoZ!+vP&g+|#wy%/_/.}cÔ#Og5MhSQM%@؎}/"^gZ\0}U]#A&{!(x2	E?m쒬["^LN YM|oat2/>Щ҃;e{P,P,Ъ7I`2,ܞJ('QjTV<$ôFMqy+]Lѐy>0~xjPE[
0[ެwzmQVׄ	im?U` I4FhKjKh{aX4p	BC bQ$aJXR~p9 -Ko=z':8 /Qe4K[M[΋lIo]cI꥓\j 0z=+/(3
OB<WZiZ|,-JsGA
k(*:|SG*>0iO}e>l 4|߮Tj(043Iq`!ĩ`ѓݞ)gIQRRPR2\h
[]nXOR(d,82edER,K㔒	8+:B^1K-rf5510.*iFүUHc3Ƅ20!z
d0$RhXŠ5y4WKCBYͥuZRq-xIݯOSwԡQnz*&Nƹp*Ye*UsyULxuMC;uPI*N[g 
rE'Fj;b?FP:ڀ\1PNL&8b4t1G=}]E4H5qO~WuߵYZD op>5zy]Tvzkh<]w2=,
%e&jCPRErE\=p^BPWVՃm2λl*ԭ\]I"nv{80R-Z](_U-&_ZkPoǬ̭`7LP)) e-3/[I#>~tw\]14 Ňh)u-.j0|Is%[6eٻTJ-IV4f$5:]TcuLu\G`hkboZv/x3s8Y=Wss"M՜YtH01n_X;
S&#,G#vdEPg@i9RbۋI7Kń|n5̞iߢ-E,7$
#9CQ[!J1[
a;{P;,PVf[AZy}f4=VP]ag5aaG2;B*~^NPO'LQ"$GQ˫Le7T[?3qcqdl71gaxNI1yT'ݓ =M`لh-t7`$]sAȻ^cNĉk7lQdgZ$kzmt5S4*HέOE5uO>tFvvF|%at0d{*NM)l-s3<6~JPa-*v'#d@# NuJ+dgHzi6; q3Tűeo?;6O~ƾWFLX}mo2vs|(rl*31x5Xzy>8ۨ1QtL4E|A$9S!9圔dfX%0;HY_ivJ)wZ<7ko*WneM

ܶ^Qni;K·"NIiA1xyRX-B!w*$] {$r|\T|
#,W6I:@rx}ڎ2S'kVIƑU
ަjlqeEq8E>Ĩ*J9 }qGLn27+<"[cbІ"T<8/h4K^JD+}gZ60*Ym2K)	$.iy%-LC*򈕜 "ֈz:jgnCs<&,v$]%+_xk m6"V;f;s"TQ)D*jᴅcpr:0z'#̇K7\o<copun0=뾃5y?ۄ6:&<c6
a4.=|[[@tWݬE0'`g.Ʒ3/^hJʷ'Ez.Oͬʹ9۾:H{!^}\ǚ5E4(1f0FU\22SKr	襾Wܷ̃@czGTg'<> 3M/FE43o08Gc&P<\Q['A9Sv]x+:]ǧyFD>!Z'2\_]#}=bY$J_fW`ːrca|MEؒ!Tk≎L@Z]
wNDd2l~0م/k*H>d#.쵢/y("ƺ#ڋm
=rlOYi64'%df0LH7}"B&Hq2V|!r.eKxcBxk'qj;T
N4~_}Q>/<$CY/[L_hsseP*SDphLT<H~*>DRB_]oLcz)G8֘I>5g;BiH*FCcdp)KLf 8zr#MTs-QSgO *V}	e<Y$P?m=]=pCA:
M968F<4jLη)`;$?$4mh Y60$|tGG4Gc+Y0QP5
갆"(Et>?$\8uQ*Ti-}%OXb[`
j7~5".[4Ёҕ_:K[~i/M!oײYCV!k(.KD.KDnG.YCV!k(9:ms>o0)fnQ _7ԷumM}om5K,%(4Tmh* 2 QYyYVeM Pߊe؋HǑ!+-GWzb-$C$R# qfۄ&>%Q2;xhMtD;"lu"\k>x83O4IFMz%oC+B}y?e*Y`!;>bE_UCPl4fޙ~\KdL_!qTw!SIÐO\,S 6,N"mp8Kb%R0Iq)' {rIʧ͖wrOʒdSԦ/YQ詌2)Űa2͉ć` |/X}jZ¥N Vˊ+wl1-,Z6I{3Ye<XL`SqXh>n`(`xΛ*T\9pgļB-,<Jem)}V}!,Soȼ2Z[ܳ-U*>,Tw<Dźiݔ|P84~]=3P%̀
[$`^fӚa,<洖tܳUZ2T-6X#u0Sb1ؓGRM0w`

&,H^\-
v{ƠJKʐc|H#v/K_UJC06fk0O>ߍ&.e=PeX%5eAo+Ɠc9ĬTqW-y|a!UmPg7bm[I0v݀V`;ol{Y\$<lg W]pY|q7ɽy%ޙq{]erq<'+tЮ%Mĥp.VsX0-i0~h LcH,x^OMڶ8[u,fqǳ$n|e,[yGhrzR-ݛ[Sr$}[qjgηyp^25gaajLc/T83?m[L2a[."Ws)PGL1`򓾽Ʋ|F%7
ހLkP ܀xBxvgg\S>mlfEi8N:6X%X[tY6|V-;sd%糗g4W^CQ
P5rSj?^(Q4w12y5fhb_Vf}!<5Vr03-.<ژ;{˪V3@ym3,F+fvޚ.lÂV}'_+,n^A;(zr+M${q5sW6=1cOoyV[Mڃ-R$35asuv}j-=fLӅ帎n4岄C]$*oIh׸Kc`ceq0;Rx"jw$I-$$ZFo9f.T0)wi'/ʜIt@]'Ke3Zm<9nڡJ{g˫s>_LY4ׯiTJYqS/kgP#;.e%؇_̝텁k(7݀&͡=Ŏ|X5ҭnWses.[ԊTa6Rq0>&/r*Ki)xWyHNݼ)βFnG5L{RP,*[nPǑz)|tc5rO?ᓭ[o\8 RowJK$9Aԫz^~$#ؽD֬ N\3k*?8Ѭz7~`%w gӊ+V[@YYϢ2h9AXK={ѡL+^no=+Am/ov^ld/#(}//_ sb<RVW3<w,>CZ0<FwAhw.zu'8,˻;ќG /zl 6V,N0z?vu]=a?|_pB1CZrM\ῆCBs8h.zkf՟e>YUE8rEg`4b	A{Eד !@[FLEMSMatUfڻcγp_Ut$豸vsy$8]m9`bfW5}v\ )<nRG!`b+MIŊtGZ8qЃ&z&/-k\yYc^yA}P,icoKg~Js)4jnF.860ub횿us§Q'[9d>rG#^mN^#*X*	ؠ⢛f
Ұ|i&YZ5tIasDeʭS)~t߬֔ſL#wsGHϝ|)I0mB;rkyx7km.N|kO)a$Pߕ^ޗgCɓ:5tQ	k a-5:Ӊ4/o<orcLC\
XnJIoURoUqS?r?`\G6]csʱLVEهQfmGrN&wM%UAvœlu9`_F}:ȓuVҞ`ōX|\gG~To<]IgrT.IG\uTZ%嚻ebyLW\^Hx- ԄIʜ>k9#G-mT}1cD'P0Jt,@a
u/0 S>&Ք,./yeZ̓ۋx7L)ພ^vJf[7mٶ
[A):WHVX(uS_.nR8]^RjWlƯT+8fT?e](-Lä:M:w9ץj9-epj;'#\|;eK\Pg%*tz`m=âG^\+.g}~ gh^b wHSp5WNoqVs56␙O(b80edC0Wc[)>KqlBEZpBur	/U
2d=:Ϛ15Û}HD7vrgb*x>{ň<Fuz׌DNn̠1ltզcL@)X .!^ʆ`x_XAF+قߓP羛A	qcf ]t!.^dIū5ڧ¹x'Dlg4|9Fd0J^;UOPzÁ{6b~|eʹYnYH4Nأ[\o9rN`3OZyO-)d-Asv>UL>jyT-KأXc^a[&Rs჈k-C-j=jkQWʰZT2rM#&aY\-egtBЧ*<S($&.[3{D_%6:.ݓu,<e3LBH,B?Wj"rPI#`;0W0_e` -u+#7+·W_mjp$sbrG+q-kؑA ڕNuZL!Q"Opt`FL9<u+Nٽ6`?6x8W'G˓!4<GL!E"1 HA+CxA_iՒV=<tx~,`<[A759[sd>Ԇٕhr_BAƃWAks8+\ Tb)jzoիjVIL![0MƗ_s-ܹOצ:*|U:zrptIu)ˌ_Ъ_],5s,[g<qPNy.4ӷWadnbRI )>\u!#C>!0M7ɝgmްpt)g6P-`}(vzEzv_<\6ZqGs/]KRiQ8>-|)7[~+<2q!4-yZuPjDb2Olͭ)ԡyj'o_P5I";e^R/_~gB/ƱʻڰR]o<86o:looߕesd*gYl7wttĿf.zUe6sͦi"Uou87m\)]_
L]qb拊yQi83Lsײ\c7"rg7viχQjS`BMjޔHy=fbZ6vxs6kMue޺-Lz7ku޸vim	zaoDuHE~1җO@P|}ѥxgV4Y!ܑN_`dNTnP'?=yp+#X&Mp}"Y#{qUpGUk/=tctٔӭzi=6wqr7F>zo+j.D%kUN$gu`"#S<+Μq=]wv+U*ZY|ZNЙw)<Lr7c׉J|P6!7Ggh|Onx=Q͑VA5KG`(_:Tmp6 [IǏ+_^`G}]]0ccTIjYDZ95D]Y+Uc9G^84rm5"nW^+I}Vj].^67/Ʈyf<XD<[0ks+u_	4V5pA~S5z+?k rk!)
)}DxjqOR_ޜX|:kKlğ8B6Iq^&³<_۲Pd./~jȶ)L ՒM2`樛
O@q`RBH2Dɕ"18SʇBl0(C2ܩyv&movbNN-.C;o3o+oΑq#hN#BwqUN?(ƟB)jJyGjӣXo 01c@v7IȋTx8;ip'	UMԃpOHQPߴqxy/Jb^sgz1PɰƗP1gGw"tnToxD@6't	H:^3|xQN~c^	=禠?bxR%7%
M 4+A=^䃦iA<XG5ͫ@47&I)C]us^o^ki^QIL/?UՃjB{KS%5'OVsA`R{ƙQg`17>3|
\=/,7rOeFɨ؏WQHR\?dU?aUaW+z^'!*_H@I0H|S/WWT}ƌ.bN5'WaUqI?TXU?`t*n1f~%W`	uCy*N7^{AK''YCԔiORtBn@lkBfٛ0XXmrW<X8>%3c<yvA[On:kWCY1#LekvSR̂yOND2;ߘH.D|"7vgB
y7NNڏP~*
 ms$XwD;vVL\p"_orNR@ayPD'{;ۯ_+bHPʲP[h.lx2{~߾UQnIhw[j{	q#Ͳ4I=1u6EiC3V t>{%+<lB km#N[|ߌB7* -vKP}lк_֪\7Nz-k @#|?]c#gC78}VAf? 2WlS¹lٖŊSqˎsdPEY|/Zq:OfyW⮦mkRW YWL?q@[GksT:j:5!9gBH~&kEf䜈gPA&>m{5.6#O5{B 0ܰ,܃х80^G'ڔCeNeWiF|i>z<#o,^8朗~kj<_a+[th\/ v5` bxZ*w<X0'륀NXhUn7}s-gpSeXRoTtle8+"on9^{9`ImZֈU:qϘpb7GрMܚn!sDE"!DtFcCSj~Eed.Y%e:Y!>39r8+XmôkL/Ci6huLѮ陊/u6)B*95Q+W2IB+.Fb4W"'|)cj睯1Mc$-2۩]FӐ,Z \krVg6xF@\nP&|~?FokJ~n+i#
>u#9˙G~]*E CAYhqUj5)}FR9oê!V٪!VIRK<|*&X5J)&/覒"a#yGX.,;~ꐣ\Rtpԫ70X
0,bږTk4o= 粙x[L3k[4I9zkHl:,4I.	(f2.2̟Ur4M%7-B+|Yi%
c[|Ʒxߙ	
dlsPP6P,j+AB<悹^gRzfF/W}/̄`N|	CQb27y >^|$W+zy-y_U(1OaPjyWȻQ5բ:{#Z1[?IJJ)g$SOoˌ*K3ԁsfr Q:E2{W F$^sފ_ǬNAj)z_sU%pq~{Lz[b( M)&=\n.Dvdhdc]#60Y F~A]^ۓe jK\R^}9&M+zkbDPq>t0]O70~J
a4^Lr)e;\CQ'>ly{r~$9!Oo,>σ}"s8}p`}
t<#wE|+u>O2@
A_ac!;V;	^P _QEM29pJxr̰1qkaM`tftQďjgTg
^핇6>Q&I{(|($=e[#?/
?zcg/wjU#	NIج_bx#=c調W0=De|d4	"jJv9užՊ	w^}JʏM~U6;!
Q٬B +Bf\rb4HU/U˄7vNlzҔJGAx!gvc<8w[E!Vn3<>eJ1"ïloBbA3akŬ
BPTX.Vu_oY^Lj1tj|i`a fL3fw\	8Q	s	4+L*ga_{-cH	P|vI+Z1Kzjz oeWyd.)EZN]sd{SA	/aɶ[*'̸k7(#r:z	Ϟ*;lB&$y4_8x?/aXe(ڋr/6s}	j(sCIt(Rf[6ggM}v_y]E=Y6˃:>R0@FAGb]+̨yM
-^<x'yg6E*;z(0;5씘y$zDZ>B\KBN#d[Z`[;nҹD'8^}S%{<ؖ$9hƉu!>>1ΛVctTz[<~1d4 1qxMF.1>	L5bŜ RIKZj
w[0藴+;hd^(u}1:=~tBZ^zPADU~ђj/'[:_cn6x!َ4	yD@q[rcG~z'ⱻYzo0nLb'H܎DVxOczE
ĉ[H{3SfA`Ud62/jVCt;\|S;v֙
])6A_ꨣbzYӑe,w[:70Ιc	mml;q-Gc'wo^="y^;[xthA؜uqPM$!SgOy<$[F\qτIq|?kկs25qTɝunnyn:N\uPV4).{I:<]+twvSѝwqY%KSg5:/>8YEAǔ_Z1ku,_	ܳ$ELG:P,He9Oo0bPruآP#>/( jj61VC{LXr}?+)cAaa̪2SV[Nf5"~z}ag"Fv:NNֹ}TiN@8xn}I>v|<h$F;?Žu\}E* zt)0-pѹz[)ts/H`Iko'O_۹:fFZ}?$fdoIhs]8D3rXpF)Mgd321|CfpC9EV0='Dpo%sp|m2ZjO_ljS|
΁ܘ [H`oijs7?d1In:2`s\O`j?QSYNK=Xq4|&G
1~96I{x!7q^+yMVEf2v O!'xNA^9Q|pb|qUh2%32XlH¢*-SYZp7ьE['CE@ɮӟfe9"IY+]jqA1*$C~Xop[}st@̊4y\!(~Wf⁛邳F+zu?"cgѼV*|ɠ鵓~tnce" H}7Z6ju{i^w7oB1h:fRI@=CY/k_NӪߏHƿX*l|yzw{gkoMbbs18h渙"
QR時`Dl|t>k*g[,jwA_޽$YRO sKK2֓޳=Jct=ܫY/PDw'#/s5?{ 	fKeyr{NzfooO7O׻w勝pR{5(~{薼R_|'k?:˽#!K5ywgzZ3{ZiV4*ѫ_ܦVfowFͺio~3xYۘ{[zz"Olikf]Z z{/"M_Lͩ
?{Ze2~<:P/Qf(亶GQ|A=_(pJ]o4
]+̿(Na?͔p
`o[5?wf/H2hXt `&
뽭<hբ
7\A{;(_X& R64/3'ӛDdNP/^@KY8w?6EFAԥSЦ;Q$5_\*HJ=S7)dx@ap%1Y^,;-7XB@Ǆ7ll%~zCqsL.LO\~8khv2fkyE_bBl"Ak=b9Q>y>]'͔ |_z[99])퇭kwr*TvcZ#npD7u>${s/L{GGA:Sg.Ns/"MRB"+!biryLך7:ݵ<蓅r(勞3a^_FWWnT_h_Bc-1Kkwt$ k5BRCws,aκxNFɇczu$z_վ%ӌ(;cKRglC٫߸ϥR2F۬co4פ[tm;I<yW;{# E*<Ux	1G#?U޼~Wī4H,>ӣD	ҫ9*](AU΃Azy:! {JOq@:5X	w5\TɡuECh7IOXd
Y`~`ohIz!(\h1 sQ0d()I_Ant̗>~4Mq'0Eay9MVLx1܈'z`Pn><4i/ۡS?89Mmo+IM#ިǥbW+8ӃZrvᗭmkVf{rքW2чJڅQ|hxqSq0Vl 05b 6TV`{yE kMwNFׯg .ZmƬco=+j-X~s7	4	,mkOht3@tapd ntz76|g;98ӈo5x/4u3ў
Lfc  I8Ohԏ5^h8
9@ Vǥ^zS:b0ұ!&96>8Bpֱ7 y	=md6~.$U^*֧f_7)?(H伷yeQ:@G{
5	Py1Af=Ф 3s:rhR(<J3*t䞈ZGKh(N ^Nt<5碏73N(DМ`
#Af}Vg	~
lТy~pFѯQ* @48 oX݀B4BPbR- Fqjw`>W|'Xdk59V*PİV#w&+uP6UH۝iژI5y0
*kFH)PfBg?b,V2'?UrP.|]SI"X#P+>vMWzg\<~t§
M;dg~O%Av-wnotݵƺqT59ϚlX3]GIV"_;O+5:kvv KX^~ҳ5w.Të2E?SxiNi4FD2v=lvg|k~v[l4XkA]@m_5F,[ Ys]qQ_;ui:<fh9ۨ9[_wZuPUN85d)[wH~t*POuֻ XJ km溻6D,:6lm%jziz4өSS+ge6-_XfBQ[SP6VsVzG	}^v6 zگN8 #^s#ѬίfwmNc7Zv[tKel /k4\4m5Tެw:@XXm~x{CqR9ZM{t:nwmtfB˚nP4lh_z^[.nC#7v[y#絍rwױPɆ϶MX__k:ȑ]7:`6֚juWXw6Xl4Ӹ_8Z; 5Y\wŏx>kT@a^hh<?%I6(}^a<~AsfJ
ߟF'%B cK	'{5 XOZk_h>43vXHb'|'~t2{j
L?7Lc[|.Sif;tTXh*hj\yAmxS٘:mmۨwx@%KKaIÜG5~*054G0W'1$*P.yzjZ(+(A~Ӳ*jFDV\X"|+Fe}ɛ4ߗ_WC2.iO+-Ƕ%nzIYfy^^R=GIAy-KW%Wi[7二2Lټ>#N\ĄeM/*JbLC%E9xq&"z=N?fS9靌{+_+C?_
W` ]Zr'_G?_Fw@>Hܱ"^)Ƃ|6NW+$-/WyA;`A]UDwΑh90gėOTx$zDEika*͒Qǰ!6@*a'j9jY7Q>NjW.G|o7i}ݻ*W__|T9 cq;ߴc)EZ%Eqߦ\^dMQVfVea{	{-^aPrSU.i"'Q+p1FhI_au{$lEBdYAT9P@*_>&Yjja)tPLzPn9Bd_4*UnI^s4t9OCJUQ//>i"B.&!ɁYBUTYFd4D%HN$ƈZDC12VPB+(%?Ob9	oXeTX*?UࢌAfT~D5'GLVz#SȾ#~d
4G)	@R#Zʸ!vxq'u	$<[DPoD--g0x)@X[j!ُ&SD48Nd]:ϰ @x~w6fC\C?櫼.ۓ#$5WϤﳎ&3 L":"N
Oc[X7c\CX!%	F\NBG4.(6%JO11PK'zkB mxgis?t3Xy+7x>r펽cd+@]	+S%R.j
_Wb|>i'[2TQ GՕ/pE6j|43j!U;R}ΨA볕T滕hScļIb(1@T]+3.ҧPӉ*SH-TNL+R9I2TrJu(Oϊ	%,'8cci\"{u3cVV.N&<9(8bC_@Eh^|F誇cn-e1 escW
i#[u2	bnA1-: |}ʓ`JW}c48
Ǣ+VNtX6G0ȤS#2dIzo!l$9/عF)K&c@Ķ/J0`?u+zs[E"r?9*
W&7K@ KNE9*Q:	o9By|!yL`	=Bk9Fν(xǙrtZ	eNsGCU+T)A>klR:nL2鳐ЭTMlnwCo1\:lZ`qsBה{@smW+׶{@Qe)9ۯ6,N_y4on)өH a5BI4Yb&,&2Atdn-}t1a}gW,IGH^$ 3g]^ 1`s3	ńLQ$fJZy_wG͠o@[Gݱ~U7>5	/]=1P !El{mu̜mo(A5flZ{)u0>a2iȃ^-!taS/Oi(vju\ ^y<ڹl:sMJWg{xUX|n`X. R.,Qp/Āѳ-˛fgd`C6GɤΏ7		"EIm8jg2!Co4K{+B8?
s"}`6t(`^γv<{[ގr0cz!g7F6b)}bȐJ%,I]&%MND6ўOK4c?(0yjD
dh ĉO.TT&|麩4|2wOFapt3HEYFrIXuN}F?	#zN`l.Uj/{ь7׵w4+V1}fA=>cGc]ͯD$-TQϛw$guՀ۬YX2D| '0#f{G_ᤉG*2@;#.X_2Fra	}dc7ZH/Ʉpܼn0CT_8Rzd@ ĜiYyjς؋/j/,dj c#xP?oc9&*!cJ3s;"&rLǣD>U"1-ج`NfQ߲ڪZo q#Ʃ,(Q\쟏֋"vMZs>샤M ՔcL$%Y(_D!l%wf[9OtMv`SYmQxJ.sZUzdu(ք4Lk{Ȕt)&SdҒļ(sI Bk}ExPøQQߖ
CF+zU,uku<0JR; 56;JdNjKV<,?FQ]<`?EvQgCIbTdqٞ/{NY6`<
Ԧeo,^0[S1,cHu^R8%0l!s^}WnI| Cq!7p<<}Ca2x~~~@UoR,j$w`D߄SyI3|8@dFbgC'~zq!7 &!;S8>YmyB{ވM<](gF"lN#[B[(hL]ħAN0gYW38Bj_l˽<+Cqq@]v]wDŷsT.:$H-|\$Uꏫ5Y{}&6Vgdf]x f:n1_0?.7f!Ŧb8HAT,d|n	srXF'|z&jihaDՋ	R03>p0Bw*p>	鯠Js0jx_ {Dn6QK&z7^7̩91\c>G'Vaph\qX@.$B^~*\f)e^]4ȝB:u(&@\M/>bLU.)*?M W1
T1g4@/|.OTϠ%td;٘3pB3.X`c[羽{D'ϭVUozcۺz'i_ R;<{&F0QONyGYDx_ۊ|oZGkFY 0@?ޏD+Ńs\bjdܻ[5"~N%BϚ88~qaPx3^(=_]^Px"]{R<c.Xoj<ʡJa#Yhs1whISc{QY8\]ClNeY0qfqVTff1ʨz9l6ݺ#Spy<[$^ώ|0O8ؙE<reAT*0={6_6[w	T2NYfVE6ua{ҡ&6imvZ`<UJ ;Q6Onvy?H7%ڸ3IH:j	?)tkY[qV̌Ro׀};IocwKBizYo/cX+ ~7K5L*ͣM_/p<I@IUT@--z2fx$7k&<ǿv1;N+?eÿ:Tf? WkJ-Ѣ~.SBZǴW%Tq\>KC4	_&!Í2~Ht0piI;LujG0JVY2Op?)_}Z2å%<}gadĄ0(d #}O*r]z ii*uǠ"b<.Nq~/^xxD7\>G..f2~GgA_*YawMh\(q!5@=us1^b<Kםۗ&:侀,	dO`ݕ'eLLn_~6OS88zVP;b8ϼ[E1EK+ |,ўI<?D!RݵK^oɆB4ixVO3TMۦ2{@v韞@͞ SVPγd2+%;`StOWS&UbFmu~:Kz+TKҟ@#,a O,|C-(^=<D$H!u'S?=^&Bѿ>Jsf#k'o{ +lE I&~lC%<{c=6dΑۨ#[_sx{MyMZ!g&X5npHoqtĕ
yrH(?jE[oH^ x%a6 YP%DtC .oZ!'h(g:\<@z5n)٣~2}iei+q_z-1\m&ͥ,q9׉8#ok(5<X"#W}w}O>ݧt}O>ݧto:Ll X 