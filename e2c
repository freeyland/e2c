#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 :] rH(8˯JLI@ޓREQU֭IgjDM	heY Ky:{v=f؇]u " 2nJL\n?|ޫ^u:~]7W\tڝNwZkNtюwrQ440gHj]\`?	; F?WSwrQ_}E?
g 6| ?<4ps/7~: v 7RzN|V/qއ%\cou]\|Gc'kN.ů=.z͚nk{.)J?fXuƃZFH!sħn{#1;qOG,r37qY|Ey~c#wWgׇB`	.T%?xKq{LGN2%k_X 8e2=wu_6f%c@fDgo3t6d>8uOFP?$Qx`vFTh#$
(Y\Mkxtuiv]k;QśaػiO*FKK4%gSK9z^CB ~OϘg*?Vn0!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAWDE.$Π8J
+_sWFp~㿹^^ou6Nٽwq=vti;_' (8rF}WM4d\V9ZߴAMpvas8LaoȢ`:2?Lc+*>#Ŭt--MV3'贏9moұViۍJ59Q"	ZymmWء3/ 	P*CErP;Tdg"TLiR1M*	:GG^<Emr"ZYlQ-*EE*_'ov*]"
s$dZeF`K:9V+K$2`@_1U5uGv
.0¾+Xa^p$@5frl=ݳ?XX廼	? $8G3**[~K)A9g>Y0N`+:hdcw$kDBLA2>#7f$t'l_w?WLZ?4J󭣯	+ZNhg`T=ɐ%Rw}a̞^Ϋ˝oz0_|z-1f?lloh޾2D6NxI#$|3:ސYS1(I~H$fcԼ$Re3kȋ6OgD-׃Vˉ5oI	O"&ѫ±*>y0g~d+7>|5Fr*U3
>	^l=DaeT s挼!}z΀_ A`|^|ȱl-չzեlqGo*U+;unJITЮ>µrujšOC1'"ʗYDy~	C"*>uaή;ѩwOpJoW+PG*2Qx]tZT }j;84Wmpԟ8iQE)$$*K
:쿯jS}$f{2$'ĖuOb#1!l6XG43{˟䌻bk`w{gkof`K;' ,/ڤYъ	&A0t{uug8X5?|7#jC9fVkBU@k$G/'/v__mܹ}A9)'hBJ%ߚ7Mv"eJe1th`WX$HΪL4`Iѧ+8N%0G,Nv}lh:A	2_I3Lq8ֺ髤65RTY QA\E@90hIWWF}:ȑZMX1"Un_$K'Џݏ1ؤ7` riӸI+!!͘8kx!D.qڌp */9鋮/~ `\更W0>W<7?)_fe~鄞&n=~V!{Ћ
y??sQA{BvTQP7g6T5/TԲ=xbR$U[>H͋R	{3:5VK[*`ǜ	
^DG<MN'lN6 u Z3Ě15EBΛn-G'ȷyC(d:Os=p^ңN}Q.gne )t> ǌعlp'ЮdV`#/Van}PV۲N`e;RA"Fzw(Cz>c,gbʲloɗ-J
xXN@eQnbktst|VyG"d]E%tZܚV9?Ol7[zU˳wt+8'3D"ȿ9daQu:
zIK_1rf(ۥ5x?UaYfQ_㿛rgo )dYcoZMJ_ɯd|Y2Mo}d91\;u%k]Ur>W9t2Ff]/^f/~zo^VQVڳ绯vޱ{ݿ>|a_),Yc4df67HzEgVc2'oCZ$oZ_&DݣZ{H5ڲ%*/M+ґ펔Beʶ㣝r5P<bB%&#*цdg+Q>`(bFW'#_$-HoZ!)gvF^0e+[#{y
U@O~U#dHYTB2M(SaM%N,Y4Z0u*HUjA :>Ȑh/z9q,6-:@R?ϜdJ沇?/wX__-½FDBz&sJ;%i殮l
kHgw,|w0`#@R[S)U(={Ǜ^ʹ-PBJPL\E5Rhd{IX4P	u13ʑj㞏eX3/B/qڵKJ&C|W#N34ˬ+N$UV|ؖKHOjQ)ƔW02)Gtg4*̝0f '.KM3c uHK@HnK'FJ*\34݄6PtbdKNnUI1wI$q	#~85Jr
2k@h)`RR`R2\`
?.73,Ab\LE2\;Ӄ|i+ZsC5RIטG/(FK+:DBZ
e6HvYHwv4YMW@ٹfFIaj4e'^䧌EW`w%{4?S.zQlLܞKKfZiQF~_@1cuЩ2
~ɿެº4UP3q-ƂSwtT$:d^"a_*OVB#lUXHT
WFW+2ZWfCR5#sx3$.n;BL W+8d/#ɇn O"ہk QvN旨+2kP>}R+f;e=gnf\A87c!]xu?KQ.`&u'ӂH[K@Y2~ %)[mAEIa6I$DIH_`cruk8K#u<+i'yU5Лh$8^8CzwbU
Jy),mH~J<铽+>_
Xrk99?+Q-S-qko~㨹Yv|VDUdF$G*8fD5aok+Vj}qrr1jn29/S28Ԑ&4lK_ر8of[>Ws4m&O,iz- lB[BcGƠl{7@j~4hWNKZ[{FMVui\>rP38yf~AΝ(O#VwXAP("h*{,h<`]T[L'{J~9"_P_6QǵCAzBʱMQi^R~R-aᖞYcBd2) KeE.3%$5ݽ1sAN}f,33sV;h(C
!rol)o-wˀ[Yw}&}BC+ KWE +AN0܀!q4yA!N][~:	qLd-ՖL6e.79Jv]~V!KvVIS9O`MafBԹ~nC- (vZUY'A`2mL >[ԥ*:8C[e$vM|ZMʲ3]7ES0kŁ;#9a>oFdaJQ~w`ԤWGi(Әq+FC_>RPN]Y0)J|#KP%(pEf/ MCG5}Ta-Y!;M@m8`bodtQ}$)a`%A7KrD<yHz~~v#!Qt:;>/1ezG1/BW M\uNf+c%yYvr7)w?gޒTs٬5q[i%ZrK{Ͳ|!\cS,	=e*S <Na /|+)@W_ZXniïGc%Q+bhD=PD*))oy(dj`ic)7GtH.<9fPF%)Ы,+#LцIR9皆0ia`$4'b'HmtEM19RmѻG۬Si#}p4>t6杷cODҖL99	Z՜P+=!v% O|L8.H(#F'dm4ʉJdJfK\w_ t/|Ixʔ4B 
J5A.*FM"@`Juة΂h ވ`[Pk@Z~aAfjy/[b?z'#SoN'aZظ	h~XuL^S4lh	fCR<b_Uׯ5*2HnXZYY='9!=ǣoWE|{4ͤUoXm)bHs&^ypDJ`\J]CHFn%:va@gJP$7?䍧a"ns"#>M*]ԌgHx(nD({ .njG'2zEQF9Q^$#EXv]z	oS?1;	(n/)P9ҩQRNF_$m1HFϤ
NnjI0L
"iY!MP&%4,Oj[#I7ǙTJ߄OEr/-猼_]%MhS'R\".%`ʒ~!K(xkB|zcN;g҄%o
S}#snB7/=ہB=X)FX;,*0f *,D0$@@Ҡ)РxQ4bJȖՐ
y675VKXAT@c4̠졂Qp5N´LgB)"(3C!&@N7_0>(sU}l^0IN"%RLtr?$Dnפol*Fg2Ui4P?e}6f{".d%e*~6[K"ڔL/Lzsy/h4OWZ2հ
~5IZLj1k:jBGQ5JEY]zxAQ?Se&FGS4ؾiDuѮ0bY2~%ch(ZI-Q4ŊțiɛisⳬEV"UdITz]_%u	|]_%u	||] _e-YB +HHI1v5;$E0ۍn=[K];k%w$ 4IyͤͤfQ$I(I=IR7'Yy ɚ~HTGe(BpK ў'qr&CR%ؾG;o&έd%RRLAi8qcV^a`U4EY.␴
&qjXmO-]F}z.5a/1[@X:LLtw 1Q/06B^+5D=r%3v[N,_$Pt2)Ò>
1(B^1rXK2$۸7[E[z2vp٫*^haEќOԦ{wOUty%$d#3B|VMB*Wktr#.K@P.:_erQeIfa԰#ڛrxKûkv?,7.
Szދ["^!\܈psOt}Q}!:þSUoH2|-ͬvɖ*R E"<ZB奮R]ِj7!	eqz=]=1PĀr' fӚ̽洖tܓUZ@2a,H#{xSkFFuOTia9w 
&$H^\,rz{ Jω"5C!4DMè,x-R)PUZ@0z`A<٠7t2Wכzr#4C>2vp~}*jonB7B9~l^^݈Dm{"+qA̵ݩϼo}cؓ/'qE'ҕ3</h7~<#m]Y($?F>aQs]95Fhu'J_wp#ʼ5u('D)IĹW< Lx:RŨLu"rjtLц1qb`3L'O)nRO ]&uI~) ,ْh;J~D)& UY^E'dbK`+A$QpJ67voluVW`ּ-z@`eu<Z`c~Ew8XNjO4aLyzf2O?f+yP(˚VYN`:Id}HpQT6<plqhfb8+F0PI
]G	!s1.򃎔lBEVNT`4tYZVLjRA`Վ,WsPT%Y7YThuZZ !VM[!R3^e4<7$*-4 Ì+kMNRA9TVԪu]A1_ȼK1'Da.Nlf.fFӟbwЭ\_+Ƭʤw<EVrˀ>,͆pٜ_ˏf92J0'"2@muYn8cd<Ϡ'19#,p1SɺdRt	sb-Kkb~4zNGp)ĩ\0'Je	@\as 9LH'O!xRMA/6Kyis:h05p2E
#>Dxɯ?4Nu˨f%f7x\\O=jsE3rV#~X~Pm(]~Φ>ԨB>,,O$D`3]"lim0`l|UE<~0j2":{r2Hb߱TНf6aw?BRC&<E3K18 JJ18E!~*,FJTZ˙r	_+Ɖf!mG\-[1kM*%_%	)אݦzL#csy(  qSw4Ss^*J2cl.zC$=ٞE*/Ų`Yrg0k(MKQ]~v+lμZ%BIF3/@J`g]*pحq n>*xUs&M3M>IޔQʏ,t.+ru:<*ʆKy%˟l`\	zWcDyslg(AG13?0xQi&_Y=?%Qg̍JY]Ҝ˹(˖AXzgg2< C8fgl,,BYG2jUrx L+=Poy9C__-`ο~UP
Ћ]Xksp~q7@;?Sּ!szC v-ȳrPD	fӝwq.6pwGA@B-ChPQ0'Zz*'Gޠ
|;U&(9H&Tw95P/5לK&'q<S 7[2.AD
CӐ}  G lႱʄVd\lbDi:
7.Z,,0W݉׎a.x}1Ֆ/f_T#i<l<0nRG.LuM̓Rr̰lн&(*2]p%|/5RJYݒ]38](tW٘:#[[߳٫}X^=san٭kI5玜σp@Z|f=lHZhZ,Q٦:wB7(iawO4,<L3AzlI|~˔[+"k25e~Uu&XhPoREm![]#[͵#7G36۔1X7Jd+!/nD\TWcd+#ϧ]Hz(_E#םFg\UO.W4qtGVE[QoUx[DE,1wɝ2Sl:ik!d\2Lr&1va|mPVWF}:HuViIYd<顅nUe:S7Vz=^-U6&Q&VݷP\
_.l>}Xl*"Op˫'FObz6
@Lƚ*yՒoNjܱ6 >#%Eel/ÙLq06IQGB
C_n?6%MIP4U31*L%p7t]Oh/VU[&q1:]UQX#Y4Tx|"R嗍aq^1)SQml+G|.mYۖoR_^A#,̙.Uia/
Y.3=mflψvc䅱6\kr*1.fgnu2w</nSYy{=(,=@-N&kfGm21EmAJF7SÒ1PeJ*D<w!NY.JSxYd{-fxq.c1ß?gHC-q?`Kg؎p\S{ƕRB쒴)1L& P UMV'f#׉0eyQZFS'^X-x"=UQJ(qjp:]ZMώ1 ު$P5\Ix(B\;(=:}qh̜&sag)2.MoN.Gs}ɞ٭z0ۛ23zF}{ұOs--[ƽflfQ+&Ku
:@M肝>iD5KNؓ4G?([ötZZI{Ҳ2=+jT
 ʸ$bO(P
'}ZOUh(tX?	JhTXS1Yp3g(87)Pj(Eʴ#%Ğ>$iccs՝0ӫ6WYj|H +9/+XLW1"kwv-㘁Bh-WԙDQIK(>n$?&|S;Z6=>c@pTc̙¸sKĂ#E&"EI#8á'(5O>+}{0l%rX-ȊILYyA*_Oo*);)$m+SJ޸e1GI>U
e*(^vI0@~h(Vɬ.?ݣDKa.5yrKÊ f62	%)-./p˖%-5cXjPlÀEKMe,t^3HNVbr6	ՐY~}'tVycrW㶠h᥻+@,\dyJ;<>+Eo'CryXtLU0S!쿕:t2OD:Eo\c#SUD,6?i)/P-~eeSG_ێ<8&2粥moŶj*ݾF^y\2U^̓unv3Kyp
v5EXMc̪뎹q[uxXw/̭rsJ56)$j:9k/>{ik5s07LosaTt8L3L_)9+l\Wn/7wnú0ri.6[ֻIsb2.eҹ-FY/p,&Z6B>ʜ5K'(r@q7>O%ژ_`SU5ٱPQTb#$)Rn;#m$em=7WICUD0V>?+Ѝ}w	pJX%
c܁:oK빶ϰ&Oup2(1o^yZ^42J:F19rG=4#imagƙv5s\	l¬ET+a 
yg1_1KE8~!sT/{PmY*Rs0}b&(Ȇd_b|&9AR&[ꎦwKY|i(Ӏ`4*VB İw~䪳S?*I"8i/Y`e	dd6q2)6C T/@]u2i&΀AZ@F&bOB#51ܧO+70a/N
1ACHkoظwaT5$qSkEm%59vX(3})+rpRlLhH63'xd9Xd&ȺQԚzV ~;2襮V 5P~dhV>}*Yz9CF[
)uDx½jp߫Riޞ spFC-Ж``~gxot3fiS[aBj73CvjAeGfR~ЙeJesQqɸ)( M'x^ʍ%H~ %].m2hR_o%;##&!hӲ$oD*!4_S\HEY<-pqzV3UϾpRMZo{TZr6i4my}K$
kɢ^X Os_xp#q(2`hWESTAY7<K_+~Ϟtɀ%m ]zDռovGC戎_
3sg??K8EntGV6nf4^=POn
RQo<xs>e$^aW?kȭ")o@.@
1OmTsU=<*-Z:VP39.l5o`>G3,	X0A,Uj>yUՍ.xB5+*l#t2qU8~Y	l7jT	SG)*)WյrUT!#9n4o8Q͚r-cfa 5wª3wH9[l&msqTq1>>_{<B#iGi,&!lʳvGe2fHtKNKgsƕBp1331ȗz۵L,qx,+&xVhrb߬[ʣY`7XF#䇼xASw.L khQ[Stn,WH(f?ledQ~Ci8$WvuKcIԊnCWu,oE#l7@Pʲ9[L e;t+vsʫ̦/P{	tqe)4Ieޣ1#8fEDYaY洈_41kο2+!% dCTQ.z<a.d`ʂ9)GGUN	z8}[_hVU!soY)0o_ 8J+6?OyǘݴրU  L
[IbSHx87IV 
M?E=Ӥ.9mwgjڢ6-u5YxO{p`z;=Ig'QW+W`8hd hBKa$FNr6$vF812
`cT)sA_#f;> %:@=%Cz1rNlPRI?"TTxEg34A|S`M"y(hM^T7;6ܮhj.f*繉[<u|\%_2
VzoOEx@>HC,EH|t7N0<2`s-fK\*gLzh|$8l#kŝ#6B]FA'zCSjn<Ea/Y%2Y.	EjF69ξDaO5׿[4Wm<7je~1!=SVvnT"}/R*c`_p19*
&Ih%鈼L6P4xp/J&yFi睯*E;4(12`nGsC %R>R0UFo@5݄mѬs/8wLq߂v'nDb9SȮH@7q@IBˑ8
YǑk"Zִj#Q>(jRXaj5$JE*dzD5S ⟢m<έ%DaP#hq:-F nhv`q d%)6C5 &Z\> ۰^"bJV	p.	!=sGUAc]HLt(y#BEex)^ҝ`vL/#/ˬ=K#|YZ2(8NAnl+OV
wzG*zG
R2:=(f(,fHEu7=Wf+x4o2JquxV
#iYzP$`Н-2,ӑɃ!s0P97 J<0r룃aay7ܻQ5'ZyEutzFo\cZ>~T.\,d)]ŃA*sF{a:7FY(O92sW@FH<XfYx&NXݦ6۝Nbh~P^\RkRq/ހL{_t,Sqq7*<Qջ'hWG&Q%2ȑN
:0: fێ|`xyO/+ YՁ+YUR^D@Bvy=51wK$g8Y<}6F`N%E7ul#r)f;mMPp(>l9ވO{
p4:1_g"~s߿}8us$& 'i+8_qyqx{ov3/uj/>Zl @Ae酷ũq,;4Gmq=:>	;vE|$[8CЗ$4C$~0O}KR?:=w!PV#N&u4×LZ#~W|rFq9v>9GJ)D^\rltվpEoy3nZ%R'yӪ_gyOVc`m# H5"ӱو*8yTӇhR;gU{-qŏz)VYrWU(/W\\`ggN$+PMf"]uuW]ڇ'fSb? OI/xhbVU&PTX6VewQڤ`>$b0-`泪ic,KQ6a]P:k9`mvYHؠ0`A( 
9 O/R{y9yo{mHr:[K^^WN(?Z$M]SйzPR
ezd{Qe@(!0@c[]\BL&\|{yBTYN nhpXs=2|V)Ve~XH7+I=>KurXUL(ְTB?V]usj}h#QV䆒b
t%
*&"'R$lTXWW5}n_q'˰WX2|5|	`dtWQe@M
,^<pY7)<iE>/]X\7+bpV^T<Scau'1ˍie;Y{ک:jehl#AI4 "1{&SM\1TNĦA%/ƣ(:d؏<ɣ2c ̄wy!fyARE25Ip]Ê=XRLr_-7.>CC0VP3QcQ*E4sgQ$:q 7b<knl~HbAa{}rcGn|Wny;ͺzb /HHێ^D}x\ap|B>M VE:j-YR#kQvΒS(7'o	R'-%.Zյ93L}Mw6Nx*fw١E`xճT."c<dfp}2ȊL&#T lβ}eD'p4Q~nB	>2'nC֪_0%a
M$E+SF'|,ى9._ZAEYӞ,,'oٖg9XR0'ӘS5у6=M~ىqN8qکS2_"/B7}P̈́ q(]AggidP,e9_g8fPz"W#9:/(oMĲ#Oaɱ)flo`6:/q/6VNnX[hծV:ZۥzNju7:͵?탒PCwk
ArD;ɥzs{^ka׺/0n7W`l.v>va7#ܭC5`[;wKKcq^,HvL٩΀Q/.WbQG9bh~0<ӣXa|'$:#,NDPz8RvX0xi7&#іM}rާ+9rYSd~qp	H\ICϝIѨ-kXa5Ks$ĤFk\ SĬWOC" ]e3RBn4%mo`ǰ^PtDeU5/w<aԗhX0Nr)'Sb=-4LN[A6snN ]:m=EdJ<;Qp		@D	,`3,g.;^\ܚ:xyr{18\z0"gAoRAwǷoDr 4y7Ky,"$Fl<"7.2}5CNw~~$s/NK;i92>4h۩c趤Yv?ŅKL*jM)Mς)Lr!l=A 	DaBoϤ 
xhrl2fPkTđC	\Y8UռQ^5K I^kg2~!MSf1|N}WyDOh/Sc&a0l"L}ɒWy葂q^P+yMRP:u ^e܉i|<8=z
y_&(87+d0fy{ZҲ;%}y)TDj!Kw(i Salo5y"LKL_ݑ{1ʀE#~\oʁc)'$2y !
IVOD7gz"Dv޹U<ំ=5f	-yzɠ܋鳕f~޴vc
OsQQr,o.eԊW6wSܚ6Ctz?B[7ͤRHmVb#Eb"_̜k_iu]\1-!d
yյ5>1ɘ<ތl4s}p@y*!h_I QC5___g[,Zpj-Vot=zn.-[^B{/zpw(?ُȘ۳|ځj_ya~w2v8SAfk^=V;=ׇov^m{,yyr_^	UWy')^@MhLׯiҦӛz7L*Yϻ{o^SjoӜ$PDO^Mon*yv}kv:v=-[֦ek{zow^'"]K5SF 3]k;i/&3ԟe,o̟G2QD'21wW(_7-2e_fŗ9
+,->u]@7=_3-Xf:z=k_<:t֚:G`t4Ga
r`okP}脂^ę.Lǝm?u|PDPg~($}$yzNNּٳJ;L}lWwqWoã@?"	=Rm"hiNd.?|Ay'7Hɶ$k	I?Ge{vxΎ#g1ʠ`9e>ҴDx}irZoZ׸mS<o.iUݲDlxZR@r7$S5S?o"Z7ٮ7忻.X}cֈLsGMmlHI nۜ٨_Yds#ϟ~^F7wrK}o%|eHC&2YͶܵu#Cd5]Me8*5p=&涙?txYkiu]\e_vk^}\$dŊVBloZ-CJ|m5Ѱ=̔i-_|/S-r@7Oi+1\,jet{N.B9"w'!!"S;z<	?Zɛyc]oSo¿k7ir3WM@iTq46 ս׹/:O}dӼ?u'ד>^@Ozׯ<]73|J؍9{ϭ{}{RoAz3=GB%Hpʹ7O{C%O3f㌬kThzX)+=v_
A0vJ T
}6"ކБB6`x30{M6 8|GGc~Di;i}G &{p|JMhmnSj&[a+zx0)`,wǐ<
8^jj7S;9M_/IL}ިǅbV+$8ӋZtvx62
 ߬!s[vԚ01
C">[n]~^_EL	Lih[jv`H
謱v&f޷ѥֻǎ/`}iYDuiV@fu6zcVαo̿9nM]tTڬڮ.+6gхm7Xw׻1ݵ[7YHȔSĦZc{ѮC	&~loKhu;lkElA	ФfyFh]v)HC*ӉcgpJYQ0N2676t%x,o8CɚhdbSR^V8ݤ0ǥiF@1"tiSB SЭ.呱\odЙLrM1@8#7ӭc([Ͷ;ֿ\jǑyF!'Piw|a%s A^VLT8ʚsѧ3
N8[9ʍ1FY'A
<`_ Q
7iga>ųΙ L>d!B8t|BB),WLB?|:Lia~9zTZ!CZw5(1AF&#qPowʤ1U3k#"LCw`LhHIMOj|yb!36Qj1+hđp|Ui*
/_T`Ү1V<xcN*B˝:>/W*to➹~0P>]6~kثlmXiݲZF^kN3ذ֏?uHԙ,WsdJxk;+v]YSOF_zf?
ЕYpϢho?9&зFK7vkmG `Gv=jvg͂:Fغi:dY-kvh4֚VfHjNԁ,l5[FjuF}jnժCUeu SCOݺFM0; ]_gkޕOPQ#	ZBtmBnmNZo[]ofް:uj
rֱ9gbpy5[@.4Y Z
kxCنjnPNzmuP^oBZ['܋'k4ֲ6uuvjltFkЮC;Xc&>ˇNh>6{>vB5c6 IF]KzA?kن~`DL;#UjխuX34Zִ[ xB^ak`FS>5-_^DFhR4б@y1Fj]dtf[&'RdvPۍ&,%:+m{i';h-Fk6ѯo翺a`Oj'ge9iCQ'G'y:*0]6y}Fٹ6"sPyzj4ZF\}vQ48)(%:h~)(^8|$05)t(2e`}~9pSOt4uj5Kż8A0)d{.5llk\M Ǒe:Puŋ<m>WFM:?wq=zȉN`7%-BOĻPf7*)[Q)"ü~zj{2
Q[OI9OaEW&.C3`>MroߋsUOi9yr>PClC[K[yNfx_J2<GNEp^h+Ee9"ReFR]/I\ τe/ I rgƊA};GE1	G!Ǟu'ֿh-_sG_nJ_oJY53=/	ߍWwDk,b wj9YqqNB@rSaA<	8Ut!-{
34<[7I\xc@g:Ji)6fLeeB;'s?ˠ(Kq荳{/rO|m*Wل_) Q8JǑE7x,did]Q9(32SЍlex[nhgŽ]ROJF<BPF04?sj	S4LRA\IwyuJjUx\8
1pf_	:^d_!7sYC.eN26v&)lTZ`Glcjؼ`3{w?n_7Υ7YڊBЮ4V w
,c*BM)Ɖ>GƛWY,c*Ry<)(B'ٰW*ڛ#M*ĸ#c Qizi?cHy_C$'{EH"26phlLMZoI-/g:11Vc|M=!S8nCeJu	`2v^^}w7tFȰ2NA)mSn~t*;"HU9A˅CAS֘$3W $4`,9+A̪S7xxip򢯀ceOiF?ta1ʗw^=c^1Fpǹ1dD5͹TU"`WWӲ=bU%#'=6m+ b˘@]#.{ȎZ::Wd7) &{FSi좪BIsU)^Y[yIo_ɏd@Ϝ(vA$gL*WY<Z31HceʜSQ^ȈTWlll<?&3OMqre NO&B) uzrGWٲҬN:,43`cC33+᪙|B1C7>0pti?&H
u9>uAż?C2߼gxډ#oA0X%)WI-j`)ayKrQ5|&5zINr肝~h:X2@C;pc"L`n25Ϗbg4ή^nԉNE\CX&+S!D0 =}_$ǆD8%~EHFFeND<Fӹ2BHo9d)>klT%ueIIyqGu4iAYzZzN
N9g7r兣3 R7
Id01eЉy;wqڃ+/Ex	~IUE1xo62Ǜ;s<UrCjm)լ	; #̮	8IH,3Z˵_lz{fǇ1>n{&+ͺ(* *YjA-~^ _uJF"P^d	c=dQ*'MHn4I
'|wUUP
nOA2S<V哌ϯ9-W a0QBy/ܬT3H5.o*<[ug#IMy@"Y.i(a
1,g J8Sژ41^w5)Q<bo8߰+\_UdLvEGZSw'Ѹ+,.Xu¬moȟp#=RtuO$:aZ{*PEqxU7|nʨc1
^;kݏI)gU?歶ˆyO502J&VC[ k,~|Kf^̵dY$ײ+8qLn2M\9C-fTG72#0y7 ۄOE?<IsFWA54C!aFN*SLf=|3w8%P(l@5{'~6.4*΁upaSp4t.`d7gPM*׽.mo
IXV0/ÙN&;[9p|еzV/R, (83u\xi+xCJ2JB\3Z$C*%büF}j/	/jt/S(kK/nܡE7KN/ѳgL3ͬ8[MTyMkQ.\a<=3j"8尲HsEWQ/&<ȯA8pk0;3zgQx;|}w܉M;נUCuAT॰R'BY:Qd]~(8ar@wHf+4jqƮhQġFe.afs t@cdL֜ղhFuGu̅ԙS#;ʋH6R5d2>[QԀiLtWyx-$	Z]0V@aץeuRTkь.!Kl%		L6ʈY/
8XrċOGE[^(	oT>V팣GAwn/>ڱ'\;j%>z,`Q3QIf!j36KeV݈z'ݤJk@{Ȇ,i3D}!T,^ITצ59,J+9-"	Svy 9#.tp.quԗKEuX^Cp&0ꋣHiU#-85 1Ca/󩼧[s4l&iPw%}hosZT#'DU:;?A\|~
A,L+#Mرٞ+ߖ(Z%#+hE|Am
m0<˷Ҕ͜VNV_%g, 1Yp5ncI,	1n
R`ǜ?>c10QgPuRt;U O+fމO` u{
*3TΓ@4.~ŰCMNlpvB"VoC?s5 g+,&ڙǭ&h:!(ۊ@dPFߩ+H9xGbY^|?z8yxa$s6`̩^trn2YC^'KJBʦik8.)=/	倾ytE@p"y`e~o. GKߚg}!GVBC/|nUL 3^xC/4D쒏Ѕqs	LRF]S?J/t.ᥐ9/Q}OƗ`Ja4w9g;U˴0?eYQV@*PTBJLyj|1qѨJt|5mIO=-/l|	OL^~
6OiRQj?T j<K2z&2M9>Eӭd$9N[N/]\z~-J;;9s"[zv%:3nSfvU?;fkZsNon7G~0<~(lV= [N^nVIty٬Ń`i
YI{<H>C){&ͦ1ؐ(
1&!G22+Cg5'ћrFF+fdg!ʘա"ڛ2gֺSYRX3'Ur/lZ|z/~D48b}HPi7SpDהq4gD#2%% :r_J[LH3g?$ z'fa&,}O]FWΤJH#ZaTe ֍Hg"1}+ut,86Bou$~Cg$:NQ3ͦ]7bI5M]1s50+ܨ«HF[kJg<kMdZst-,tdj2F tGYeg0NM3&VQ`6\7S[J#A[RoEO:7qCQǜ_xu.l[;3knz_Lcz{}	$'?HmߗYhOiGE%<2y*dKK̙/^psiHfoiK#w~eǿr1;N+mkNw'V?	7.}T^DkVx\|4i7=ypyVjW㥩2ux$OE˥%żQTB`&e'=ji%< '`D#d0Hˁ&C=]k0_!#PR(u7cYJ*K~w.K5c=Y:uw$(k mɐ:D61"[ r2rovVX]Dg^2KG.B$*cgh<hA\6P\ʡ4H>R&{ t2Gv+;,U0L@
`Sݰ};$RBY@,avIuז$NHnJ%Rj*b,$ #񚝩Xj5 :S5od+Y~4JR3L3T- RNgqHꛋOh/bnT2?ouQb5bɢR@ĊʱC3<wQ4*DY(3軌֎6JG 8d1x+gO,p݋MFM hC։%@7,@ Л?YT^»8럍6Oӌ%]b_mnS.8d|ª5dϔϔK۠^ǃhQ@kUrKPpB
H:{0)1{%nyu
t)z(̔Tޥ4r@x;]XH7CkఇYh$S`U;J.|XU [ MMҶl=/c}Rn/0 Y.2{?3[_eߜe~]NcFc^l'ܙiyNT ?05PnNNU l 