#!/bin/bash

declare -r e2c_version="0.2.29"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 Y] rH(د_b5T8zF԰LD+X"ه}س1ۇ>̗G$EUuUbw{yF2]]FŚngtMhڭ?gi;!rC7
ArD;ecGs0|pFZY[ﴚ'F{ywqQ_(,~wqQOA~yh`!ߠ}??_N[fh  _k5>Hw/%/qއ%\cow]\|Gc'7F_ڃ/k׬5}vE0e_ٹLΐxP(i d+_co>f'n{	Enx;1O0Ϗb,p%r]v䎂cP,A؅1]WY[`:|>rBؕWoickbdcw0p(; 2;?$B8.8>epFڐͩ܏x2̈́
!4bc7Fouq8(_dfk7_ů-1kwkrZmo6]\Cؙm?/vχg盛q<>fUW*4
c곍}V7ƐD{;3fʏt:mL\c";5W(Wg{wteb|I7eTw[{U{K8	3(ܕ _G?<[0N~9rJ;_' ÓQpa^14QӐrYnk~nBo[;`
%~CѐA_܏`'FƘ(fثT&+dؙ^tz9mڵ[UVj-9Q"	ZU{kwvoo6ohyHXdR]*ڥ"٢bZTLiQ1-(&9:/j6A&TdlSm*=/dP:FWo:
QNHf+5j$aK+aZ Z}cV]RRmϪ@Z*{gZZǼT0H0j06{Zgu:?6=/wy3~AIpy)_d]q4GΙP3	~azKL@O` dc;t*Sȍ%;		[LZѴQoi[G_.(a&{ē!7_$c{[ow7KfosΟwv8l)ղ`ȁGd$Q\
"5b9qܾX,hq>:I\~@=zA8v~'扏~Aa #(6nrZ3by ĶܴD`̙3 cˇIyE^*G`oy_Vs_7nXI{q`}j<^m^)jصG\-׌4YS/MIF{E}Sw&ѩwO楥pJGз+>Y Uew		ȅТ"i? o:9<s4G'>]6D$5jD$6vnQ#fd|DM\pIN/6loomkW-X9)1@13Gڊ~!A0t?g9Xu?|7#iC9VVkBU!f]^yujաƞr^	VIXGo/^T@;&3"aDTگ1рw9MWyHO`5_ vw|lh:Aq2cs($hy.}z\<
KNʑdX_qUKV<5kke>Z-	 wk"	É>ǘUA$ћK_	g\%$YSfL`{5"+6#UwRX%'}cۯ޼Y|
ǂ"^fnAv2+K'g6aog
s^TPY"
ޫg򌂢49Y碖m~Λ.)ƍA:  E_rK8eQaV%Fj^)aNOD	2]"m%3-&PaĬ)s& q=< mr:2ds ֚!c)rv,%xNxˠd[!y2p^1/P	~(r3B7F]% :qcF]68uwhW3++0~U۲N`e;JA"Fzw(Cz>xhђ)̒1J3dYP6גe<,΋2tRQnbtA;Y%_v;nGU!E+0R2o̚dngȌ/6l~iIPw6R2LZp:zAc<AuW)#~)χGhSĻ*9>HL_],\"
o\@J%YV|1q>v7YF_L[\;uk]Us
O9w2FfB/6_b/o7_˖;ޱݿ<|a_.,Yhhln`q!k:~4eN$N7lɑ4<u?	fb1-t˸M8.GLCIg+PzC֫/XM+ґ펔Bv<r5P<b-B}vm>H<ٙHO.1טI VHʙ-D'.ə6^ZAm	{s~~_>cl,1R{V5LAXSfd lK/?LEfUHP	F0=,_CA>]uSBHj	(>s)Y6ۛbه`чZiÖag$`"!=aVZ9LEô;i)=aiR紕XqFF`Ĝ (eE8RE[މb޳wYL[%	/	z,%ĕ_[YIlW-iD$KŒJ($=,@,D9P@5*5 7!ҏ{髆#DE GEP7UV)@C B֨l9/v%q9^FO#}ioSp2)Gl'Wr')'ZgSRp%3=
$TX3|0:EPfp"T] |Wft߯hɸT|ݮPib;/ahoT	SN^f}
^,_
_
_
^؝LGfq4hyCRC-ya*Dr ~͜R5K'Ҋ2дVps(!YaMb̬KqF֬+ 0$0mBZLj/zQ2x~,Qad	$g,
VPKf5-XjAS`u>OESGRvණtY:& TKd&"&=XT*WVD(DBfCCRY0ʅ@hi}aFf.YL
[I8b<t-cM=]E4H5qOltߵ-Ѭ+D[8WsY
;=ֵs0;̿JMB2~!)[mf*0!$G[_`czu+08#u.+i'yU3Лh$8^8Bz;fկ- $P3WK"RX39'{ÛW iDWW1DM'"rr
bVzZ:xXG͕ȲƋuZl&fm]aZgqzI^::],Xrur:_8ñd2n6s!ˋML3^^ر6sE9]Hmg5jIf6F!r,o#cyB=ea-?iXOg9Ba'#HފmO'E_gY/3۸(y67<g3ܐFr
з,2CB( v<찔n-7ʀ[Yw}UB	x+ K^E '1I#yFC0<Y.J*w/ZYH莃ؕGVwo8uY))Mԅ /mX&MuB>M:׏֏C׽9 D+<P\T2'D`I>[TifK	b!CG~\.>qfdٙU񉾬)]kŁeɃX^$]1.Ȇwѧ`I *!lɝQ1Qf(>ҥmNU?oY0\"3wh*qW?$(Bnܡ^:\MCfG5DMn
0l6rSnq3I\qdVQ}Ӊ1wGhRMɜbД\AHzn!싍 ]u^_Ɋ2C#s+|uʸ)I3Kx,@wK%[ި#,%٬75q[^'ۂzaN-YɌ8:Vy̬#^Ll! 4RײhmCq^ɍL4nH.I> !?LNn״WN
ڦ%5eբ0:x"\w"+f\Eip8h'Lr{_b\eLB#H<--!0x+`d3-yYюTxbqDLem(~D繒):5@(].K$dRFD!b&H֧ YIĺ[!VilO	ٟĿcv˟ FC׊|g[to.c1BHY|/[Hb?z'#3S0J?A|hphepu7t4i҃nʨh`9@yUu W"tZ]E:2c g4Ʒ3'^xroOL^U~qru0"͙xMrKK6(bV	VPa1H=a~C֍9=e
gŗ\Kyc]NxZA] 1=`#C*]vϳ8P0	&Lˤhd
eG`C75abaEr'Ԡ	9yge",.ݮ[y܋OiNrWJ-TL?<R3mqyɝgX8(v.h;eG\U-cBV ިI@KDourT'}g<ɽhO3~u<vK4_<@(E:bΏXWUe[͐%YuK5g	_0zcN;g$%o
So)7HVƗy#W%F|r%V@ #U
?	2o D4UӀeQ4b5
y97hXA$RG4TcMC%)T+d#ޙڈ>J/#<d+$db'nc2YJV[l
#<DG9-th=Us$)6_o~v?OmSۭMmi6{R;M5CnbY?]?m?MӠ.NLU,VF1(F.v.s4	~Z
1*T<'"! ,]+~;W-cj^$Y7]yӑ7myӒ7Myc.~C|Jd
Y )_JoH!oH!ooEV"UdI)+t@Fw 'n'cn7n-[M:];k$) Jk%mh%
h&IEII9:KwIDfr'NqdZo ,1n0Yp1M,KLZ`[/M>g%RRLA4ioe+2Ni/;1WZQpAr#uEvF~	_Q^!VWmPߧOpiK-}3v>β)U.ԗ@ЎXKg:q-BZBR_!UFT!{2ݳD9eʰ$_Bf:*
koLz3\ V)/6.Mh?iEѸ5R*mW&Ie4j**髇}
*Ba2͑ć:ͿB%ԥ]K"*TK$4Vբ,,G3Y/4sixw`^a!C|<Co0;%g/z%be͍W
;dK%[B3;%]e{īM.3"jlR)EЦ09!$+=qz/%MѕHsPӵA[UZ@)(G
~rB౅n6i:ܛkNkM=IP$!?"{^4ҨQ7!M=uyid^AƞFBUX(dDF#y{s-9	*- $id/@iQ9}YZR'`|9ß^x1n4dv1.7vGi*-}d$0y9(xUpHsO!z+j\u3W6#ټ4(ۢDW^i'<~kES}y'_N&O+7f>y_^un~yP-^62z,-rdՏ~εL&(4:@{<Q"FzA9(%9I"M𐇹coUH/S5:bAkpt>\SnL|,{~@eO':(n׶[e2mI¸˫rhK`˟QQp+Kr67vK+jQk=h `eu<Z`c~Ew8XNjO45NTFdj0]i-{K)Rc)ly^jn=9(5ZLv77Y[h^Z !C:X!r9"r4<7".[/]+ZQƦXiNofPtoc* ju+{.ğe~GxFa|F@LsY* ԤYC_R1NBʤ5k<EP_V5Tk
n]|%Co󋅢52&a&oYno5C4kIv\/	dU".LÂV%{-n^A[lk	ly:W=򸚹+՞遍[5q&A{)cݰ:M9`NǽZ\Tefʙn67 E]$F7$TH11e-zaay"%
 /FQ5aKic{I*JTr.lWRNI9سܗAr -h_Ez}2="Wɶ~ھkMx以Dm#۪֨S$bׯiTjZʔcNƸW?j!mG\=[1ks@c=f:1.4',^C.,3i\ǟN'vonh_ټTdfIb2Nea8ouL!c$YKFNY*v9jy0IF.3_ |@$tVo!}BQGmO:<51YԠ?<*k2Vgo6߾*ʅ ro8Qt\|̜:~$"D֍c/L3_hܨE lwV},̳?C`)RϜu'SJ%ǋ[/
{[%۽W[?35ׯ
j Y{zNc须8t萺!!w8ӻj`nݒ<Edl>	|/ 
.dxwph>$D/CXM<ũ;s UWgw !x?\OzgE?|"AxPQPQ*sNYw;֤"g
ǃӐ7Cwآ30@%(C5p`4$@Hk(`)``2P';=(0u^7ޥ`JGZΊ0NC1՗/f;+6.kz
^iFZ2
#::ðIh^{h#>ɫ8,Kaqb:%/*2]$|Ay(eAdyvBaX"S^=2oF+gusn0X]NZ,ޮ9-|ҕOF׎{OulBӺWfz
X9_ts0L1TL[ՠ}}_M
(_j=GLMe}I` zergA
x?;	!FkGf-5Gp36۔1fX7J.Hd/ p/}A}i]7u>m@C-5HT<o72~82),Ө"略neGRK#kd5&Kd*>NMDzَ&:ik G2NͨLr&1A|-=VVʒf}ͺHVўRRڋkaM^Uo<UIgzTȏ6qG\uBr*8%ce<rbA<S&B+.P<Q b4fր5,x 8ɫ|J7Nj5㾘 oY()-I7`sxNvu9H:BMTj])iJh!OyHExd^dՌ&{zB{̖2m3嶂 St誊@ʠ ŗ*lܤ P<0|_שVnq̨6ke̳M]L=XӤtydw9ӥ9-eJ85U]{jG-n
06ܜ`цsӨ]*A/iv6PG.sǓC*+ogǐv94jm6!3Skb~ddp#Sμ!1BTDYp"锥Z>8/'tN5Iǩk⯈Ho6EXq)	w|3Qup	8g\	!%V1.I"(ndRL"m  ra\Eppb6rCIaP}c˕	S_羛A
#J	jLG:]ZM1ުwDZ(q\<ZT!}[@8}fN-ǈ	FIPkiJ(9cOL=m]=SְOL|QsŞt\m|A˖q҄[YC|R?P47`+OA*Bs{j?MְMAu5ÞL$G݊ZU"2M&BIE_-6f*hsDvb"[3{B:n0W
l!$sA:q2H<'Ip\u'fza*K`%22|pJC%7*&{,~\dn®{30Xr39 Še:(j0tiY?\Ǥ}C&?┞k3osuLv(j+ӵXdyRfvHzW8á $X$5?\~R<%ajS)KVbp<rn~E컢xM%e\^Q~i"q:H(in|BƐOR:U5N5SB)Ҋ5T˔U/ÖHiKZ4\
KW(k]f8
^>]Rg]:2ED~1EZ&&/=J./ qdKX,VJhقS~ʖYAf:ˍLچlV;I,dy\rv7	WԔ
ha">"*w97ӇҚ;[ .aU/ݳ^m|pi#UE\㳰koƐm5ᚏ;{XJO6oWY\y+2<pLf)8(yDĈTI0Bns+u
qhZ)-u>"*߸V(I$$WOɪMȗiCELAee}tS%e_< 8&72yo6j*N^y3^ݬcjEHϼS߆W 8-|m3`Vmk"aO.`n'fJř;cr1?pZqݜߙ-=FEL3	?Ä}ռΑrrͦzh*=|yF=#מbüukn07,*qR&bB/dnDdEC3#5	' }B&V4K(8\52r3e"mdͥ3:FPni*lSxƁ*2J)kmNL͆n;I U0V>?_v	pJ]%
VS<:<zK빶;'#Yu)-rP"ie0Q6rQ𴶰|EFP'Uvxr%	S0n%w,Җ^ufrw+pD7졦OfGtJ9ܣ8#h:)4xvwf{32IΘ8hs.@Z(
XH}yokM&l9&cOgWWo^a,_ݥ'#ef9,Q=0rxX5ƕHgHo-'(=E"WV#sUm%u9~P#(;)13~ѶWL{ׂs2vb}=dPjMmt+ku_	-BRs+aN%(78ZOA~5jcJ]9evNU\;N3ۛCgiumK&Wy,miYxKgqxÍikL;,GSeRdJ)@$jʀϽ38Cai7v@)#&Lښ-qj1'CwBCI7ŨqZPIk|O:dul`n|4nA,g ~1h8V&V}rq.<I8S/lzbu'!x(($saxrسgR2`I`1G,Tny/9A>mTM|fcr&g	Ǽ
{΍AwdnA5;BDMo
$!AiUك>Ȇn Q0lf>sE4w9I([-z}׸^o^kaRAD?WãjB{X5?VsU1}9aJqlT9Pl{^h nTuaSj6iht&cO'7\A#w5Vԗ-V]-:!:(~% !)-Qo~dZN۷qHiη;oWK[($QK+0zv=eMf5jݠ:PDH5
?ג0ۜ$9nQ\nKa2G7PQZ5<ohQY,GFd5lP{ys/3\LЄ>B,ݮWbWcY1#TEkfUO%fݬ?ciI)N{|L%͹|aD	oMg	8^!mQ|p2&wz4V)#ƺ%ڱ@($xhUG!+zsvrעG

>zz~ވM AyKlI*6t`B{vd{'um/(20 NRBciKBHnyMW,
vI*3W1+rr],9,_ɓA_]g %l9=BNU}(k2q0e!d*D҄\훾xҭHͯ~R)s7;9ڷ%OyGŘ րU  L
[IPbgSH+x87IV 
M?E=Ӥ.9mwgjƺ6-u5@x%M7o`;=r!b'jQ=vЏd\>a,VB[4_0#D'9F"ж`cT)sAp_#>sMKt{Jb̵頤	7~D4"ޡ.gfio4=OM)EN QxjM^*żbnWB4mkb	Id5	3D-oY+ 7^47n-"KQ*R%=-k/"fA_x~\ˁ1
'.-%x.)%!>캪aq_xDH0vД~c$udX#鋨yVILRq0H/g-uSmocE {^º΍ZGxuH|[<H(\LJIZqe:"/x)F#z??)&M+(5܋w^QykJ`HMLflQFBkX))_*u~aL7 DnBchGr;oAkk7S)qdЅ\Pj$8$HJWI
Ѭ5ovkZcZ(Kj5)߆VCڿVC@"y2L#&DփSpxatR)e`%Zb9@O&onh>[quA.:<7KEMj(>M| a%8Es$&\6nC>{yƶ('bSG!**[FKgz9\fleXKВFY(wrc[|eƷR	#.R	;*љ	0Ca4mLX]TWz3zh*sހZPO	A,B!}`}1=~F:	_	K*
ݹ>SVw|]s\ZTGt`$V5cPQAYa:9	aImU<T2nhؘg#_<kՏ)j.3wddc[15lv5H+],Zq,~z{df	[1Vq䁤>5{K]ZRGH G:)߂t`m;q=y^L gHVNdebR% 4fki["98Ch1H=tw*)1kvGL6hk;EaFx:XߓϏ1ǔ:+#U|,$1/^{'a0 >IH]1_sӇ\Isb]>fg^'^|:=c ꁂҋ<9S ԥY*w;.i:=v%#Lz{#]qw*?mOIB:nFSuP2/Ii4
_GI,`ͱzפp&$NoC,T?r=F^G#YOq1|ɤ1w'g"ǎ<~tHlCh
W|%W?k$=,?{o?\ֶ_=cګ=<V¢TI{Y|9o3	j,2Kx. I=(dzmi&97Nh?!ZY^GxEKt~ʼsyk5gUF<
pk"W`3ř*	`Jk>3|Hhf|]x]dՖIٔo.Sҿw|><x"pUI ᥍rYD[6)Lj!tjZ|%"A28KRABl{,F[լ'lЌfr0 G~
K'LhzWVo<7-Dr[K~^WN(꣧6Z$MCйzPR
ezdkQi@(!0@c[+XBL&\休yBTYN nhpXs=2|VSe~MH7+I=>KmrXU(ְTB?V]usj}hPV䆒2pG lMDNIo<]?c˯t$ dݾIOO.a8@djTr 恊Xy:MlSjy,
V[$>6o;$n!$vauKHO"n6v܅+%C;^y[#u<F̃LiADbM>ѧΛVcdvPM>Jڥ_GbT(:ܯ޼~ayGePA	4>RC
Kz/`eVo֓e̻!tKT{j/Znxe9\yu\M!BaaY;fǢnhHW3΢Ht-}!7b<knl~CbAa{[rcGn|Wny;ͺzb /HHێބD}x].0kQa>!~zNwP& "@|,}aYpMo(YgIOuXފ§#mK4xZ%;33L}Mw6NxJF-ТA0qrN<[`1D3C2ȊЙLFAؚep0Nhxē~ gvBpZ㻡YqP4&;*4uf7V<z'|,ى9.t@ZAEYӞ,ɒA`9XR0'ӘSuу6Җyh9Yd(?Y=(>._2(,|'%Ъ^#+E

.<lL=kէQ(B:9@ '~A6[\%j輠D?D@L6f#<i3K&Zpl\5tO_
_
mVqܰCE+F-oIk^FceJV5ZY[cfuo5rC4P#ڑN.FwV..)gc_v;vּr: Na#ڀ_k5:`[;wW_cp^,vL٩iH KGTg0#w@O`*4,|?E,Ê0fV'yG(P=X)Z_^R6C'vLI3<oqo(UlC>5gګ#A{O@JM&WN~\@N
\ka\W̑v][H钢0"W|


 /S7v^jIIQ&}?=>\%B=U\}I%>*cu:cϺJ<.Oz^Bh=zcY۫w(DOv)54JF;&1 !}&tɂ\=i|Z9w5Iqubge{18|5"gq5 LA( )uM;R}_EȘCȃ
 q<"̺HyH;6ȉ0?)ϝw4ʾ1coYjg~7{&QoCǀY0I2}'~=8DޣL }%{&ݽVppFS캍/SGn%pF^/qy梼r[4qcAzCc&>'dCL'#'-b7t,BƯ^*G1T_ =۩O`8DWУ=ؙ{Y7]ǅ{Aw5IA)GM6{s'p:dbDG+t+w5Lbn|`O?ZF%SzڶJE6.9hF\-χҝ M`ZJX .ô'
HQ4G%)8rzNQhA/ d$O4p3Ypo6oot.4){MYA#g+ꇝWԳvs
O sw!4"ãX>CEʨ}l
L!4}9m ͤRHmV?E^̜ow۫.ub|@:'?1-_lg\LN<o6Z؁>nJCNr<^$򀩒/À/z?ۭcowU]\LR)6o^)}7GYf>mC/<0p;;ވWw{I3w7޳>N8lI6_l]I^n~S囝v_xPrƚO~A!LO|J 5{M>Mڗ=j^I%_egb_4'I}ԓW?얒gogfNio~k7ҲqgZ6˧6~?_Dѿ؊?4⯭ͬXU&]SdbIP2~2vdy<ȄGSL|]٣Y_e ͊/sVXRM>u]@7=_3-Xf+i;fXX0׳@~4:G`t,Da
r?@iբ
zl
nȋ{[XY5zҗCu4²AmSpIٖx9IIpO񼟩Ì-}lp;?9+h`L6b} ʟP~섞uY$Yf_Pxɍ82ɚ(қxP֑w̠
zbAY椉4 ^_=aM$=[,/#*jˑȁ톾3`_zNfMYfBl"@i<̺5Q)>ip]G?_F.9Y;
U]נrv5&v$!{n|st_n0̲]ken{*e\3R!+Vbgmǎ)QɥJזյ<q21蓙2$e^GOZ"a)Wca/ns.6Trz.B"w'!ϝ!S;l	?Zɛy0c.h67i/WKR_z駫Rgz?mQ>5UJۺ?'ד^oiwa?<~O+uOi`=#|sk*>^<rў%#r~sQ誒D	\zEӢǌ8#+|AC7UJ!`ϸח33J~ A;%v|*>{qxe~do`Q|!Q0P^Pu쌽E?&&XsuQQN@ZF>FAc_A:@0hޑ{! >eJ2[ƃ@C=<Q8WFeVS@C_7_N]46}A'a03o{&i8ZL/ɣ[p֏WGh <`dceD}` h4noC`tqSڱ7n[];,=?7kӅ	ـmRzQǎ/`}eYD6"U7j7g;iv{mvBIʚnJZ_UBu:e%4EHX4FƬli:GB2$kMNJhgck}SZD{[NMڱHQ MfqFA$!wZ~\ʁı38%Q0N2676t%x,o8CPc-TViEcg421s:F)[/+y(;q;R(F#.-`JȔ@{
5٥<26vB->½}:IICgfueqWK-82ϨX5$Dj_|=_A/d4$ˊ	
GY3q.trFIg82ڹ H13_R6HQA9Gqqu [33,@Gxv9Gl7au\"B\](I(GZG>#O5G
Y+dabXλJz~၍gd2NLQ5&1;"4tG&4FJԅΗ7'(a~蝱&XME'NC_JIApuM&cG >VQ|6[*jY}OU*[gٰ_}v5N;lu6V溨ٵ[T5)ZjՐO2
@jtWJ),Zdޭ vRKA)"JOl?Oaoë<ͦ^[WahitF͎Y Og;h6[5^gР* Zȧ m(ZյQ^oXumY<Vh[lY{n gˢԔj N@.@<'(lcul[v:HРnۍNj5۠- gy6mXXf^&PKAz7m
o$-UulgT7: h Zk{đ sg͂vږFawVNgjntF{i A;jnCa-|U؂ ڵׄ|ڀ$MU[U_ֻ]\@m˧V-v-7d0鎐7*Tވֱ/@n/e
yQinA֠|j64E}j'=m4֠
l.l5]E\%z]o vs zl uaq}m
Ehƭ׀	6⺣<6A{r>}BAPyL/N
-dM8n{U5XxDDsAipRPKuv1CRP3U: oq0I'5/jZj_5vXH`g7~>~rp"ű?7L![|Ȏ.sfdDj"$'u.4Z?|'\:Znl47;ƽ.P9i4
yL1k
Sڨf0V1hEIj
O+Kr-d9CkBr7%)jp<:Jݙ`W]9oS^SޮЏ|JΩ?̓+~>v1J甹9$#s^煶ʹ,dd4C3iIu&$-)<""@'QM+FeL50x>H{E/=u'yIp5o{G/2I/~V_)e ]ROfLҷtc(DSm1'33.5I(ZZhôӏy1i4y)-yU[|f(yttI0J^z 8w0b*(N6I	^GYҍCoX?|_{G^U	zLrcAqoڭwY1zIvACܷ)4#EyfUfʈGȭT]/HXeEa9)Ɇ)?~5q"1exy0m?O?a$*&7/iS".XS7~M+aVG+M=k$:ɉ>@ۂQn,p9MCjMQ./>&q$n+>b" yaƂ~]#o4VIa,kE!{V%;(j\F$D!<e7Yg՟R}qQD az~H77GTpGF|#Q`K`@\d9FbBָUD*6_jg_QK3NvofWj7h.S୸o}7:*KUkKxǀ7{/,whd$'zoO~#ZGwIbLlHKWDg	U!E2E 馄cIfN@FxœyMK+Z:JL	+R8CU K_}K iheOi?v3Xq+/U)oz>q鎽c+29:H>
5?TJX_@$X]!ڜ*E%\%bme%)ѣ}>dyS
*2@=ut/>UFM2MB&Z=R;BG|uE)6yG/G[2D̛$RXՕK,}r5H&+xYs
qO	ӊ@Vf?{9/%PK3SXKI;3	
Y+epxFd$fzrGWϲC'м1UEd[JAA寊1&B7R8fet(0܂bZNun`OOddzp{Gȃn`V{ыjRX35b >O)PrȐ'-H^~Í`*Ɉmq]sbM'm_╲# aȠnlWtbұHHF E(vF#~4aOTĚ"Y9
Y'A-(oQ"5%q	(1'jp12:v.;w"13eT 	yNsG3VIfL'9Pqc%%}	NM.9Yt\lp0BG_"q)Cb*]lNpsg}XNq/ܿ;vllƛ;o_1+`mB6ysF(\` Վ&H}\PA|;F>CKqU Ped
EɰD`J&HV؏Hܷv{0؟џsbZ PԐK$ŌS}5a6ၘ7VIO~#V*4UZդ`TFxCh˃HtYlDDLfITD(IF!F:,1 8AX;JqUi3#2FjOf{LbܽEᣥOqWX\9Y[_q)LѸ+*ThfWS4;⧼*3pjv5?IH;/0\/fD8Z)Bm>,f¾s5ԑN/vkff6̱RKD1`xr\ `1kR43!0$^(3k/>$% AD\膨>}n3ǡ3vG}+\8?
3}7t)|^Β^NakħL5Ϝؕ>42d'4ubH,J$I]E	_)8`v2l R|\J3hQ: = +x*7k&00rQ
)W <Z8չE64{'~,=g\"%	B3_cЍ`;uGCn<?hzWVvBo;o[PxiRfsGĂ88|&d~2y;;nwEX7\	?(gQ9ËkUh:8\́c	pZ|#QpDdyTk˘fIs[M Hˉvt,$<K9nV40Ǯ(-'a~(_3ZD!
č!+DOVNxQ{18u`S߿28"ō cfMzz1K,#lnD<+9m!ˠy@qᢝ7!y pn hlԥt{IV̼enp"&<`8p a39\/
5q92`bz[ "㥌M%rEH"?O2m2 h)'k>6N^=mo./sx \dFբJЙ0lv$g1y8N3JEB xD`ԃeB5҆*laP(a\(u(oy>9ubo1D@8xm5i\+X$f[w'AˏA:O:;u!j*Zl
޷%|	͡@M )[B)4o5Y&C՜Ġ:=25"qcϟrd <z,ۏ~4珉ҊzmCIщBhc{,u<0;T13t08f\Lwa{SGɩ;yJM8mt#TRM#[By0ŷ?M0c[d("&l~yb-q@	ŷy#b
b'n>*&'0k2Y{{.hJ$	VEY&!rAMeJ$_avQS	].BpeAϖمgr>#nӁo{.Nj9!D9(^`)38%8A$ '`:3XOIy~ʅ!3P+b+ Gt͟.w	>LT:3T>UOT>CQE})aC܅MMM|esZtU l.0DcnY{mĕb;fMy^꒼*'ҔC2J3 L^|$n'<0#-}w3:<+m3zhӲ&;?T=dY7_3M=Os~UM$9s)o9Wfmq(Eԛzq:Ϧ=p%Q4uGXL9xDY`	C|]<8&sF	gHvٴ^vlr&ęA=Pw_kFQDJgͱ#Y!7zJN&\#Z8ԉ~$ %pR6"}ʝm*wN0"͜d@ 0k
kcȥe).HYCblh1&	UrL^N4[-aŐDryT[D^ϒ}0O8X<RAtԷIPhz%7Κ%6[u	UD2nQcVE2uxQ:ҡ&&mt8);U:ͨonwY?X7%ʸӢ0It^10e~|sIt}/n5?n]"xGZze:0'?HM]*C,	с/ϟLÉE9U9kHj[W"_7_+;[cvך׻Cjk0	7.}T^(UE<.[BBR'/Qpܨ;W=D8+!.TZTFSz!d=[@ ҀQ~h$n@%($A u8	[mnj7!#ם8* X<Cǿ^KWnx%9
*ny~~%Ŧ#jߜ[ߋQBbs8DjqBKх'ChO<Mugm4>^$	?IGbb#7ЭI%@ڇԫs>;so[L&+j@~0v-*B^,B<ݓl J6k啚OIL
yZROstۢ>E C^!~zvO)(Pɒ6>2}LpbIw7}6YI(PCSE(PtOa%Om؀iC[u0`oicًNCxx3Bkk+|I79uC/l"x܋!| "7cY(Iڇa/z{Q4uC顙fn-`> [K.н&?ЯMZ!g^#?
?&
/@2kX`;d[[v$ZL]̈។E op^ xEa6 ZP$xC %PZ!(0U2tڏ;@z5n.ɃA4)'Cپ4LzkWp,v;xu2[}绹
pzD9w,Pܿ軿^?? P 