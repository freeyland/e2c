#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vH(iZmwRRIrv֒{׶Y	Ih  %,uy9u50|MDDf@$%ZVVY$DFFFFFFFTF~ljk6N>k՛NkmV7֚`/Ir8'psAzD?IKۭvl7?:#ǿjwp[z~"o`+ٮ;I4s?wh~߂d#/CZI\NU4@J_5(㗒 n7k.{v?wuu4m;5;I	'l{+	2`s".9Cv'ԉ";en	Ν d'?bљRzaÎQ~*-?9<,yś\C2x1yȑ/nB%?k_T[wBZ %#@fgnDA/2{0 XCp*Pa'{4nBހpvU"'lFo(us8*KnU5ޥŏJ䏆lcoh_kz~?"{2v(|L.{_:q	ϰai齓Ę]V\!cN?@Xg?L7j51#pxvbChX!oޚ_WN'n߆IAfƇ/yAUѯ$r~t.3ǁ{QVx_ÝI)6
c]kM&Oϱ--'07+[;|lgJGf}i>:5>WV;g1,K\,<'8$W/PQ'7bwiiiہg=\ΑlvQbV^*s;C;~A_+өCNevoo6oJH	@*TelS6UٞUӠjTMi@5~~Qܤ6	&A֤*TelRY!	5ۡ4`7#gjD"֟pj|--/-fҲhW̭e,]oE/KU,K)TjWy՛ulCލi2\]YC 1~-|!*	sG},q͎I>|qYtc1k]o$k%DBO@2^C'bW4pl_w۽?VT^?`ۘJX-;YIf{̳!K4~oޫ7ZMʹ7jyLoqwvlE=?9׋;0TvpfMĤHg!r*v_sa`Pa\[6ź /Vx
~TD|%q8i?i\C;z~0ngOډ.MwXArKe3
>^<EaT sn={Nv$@/b*\sZ^%su5Kߖ
WVu/5kYʟkO:k%SۣJ1ŗ+e,hxL9QM#zvؗ)Tkv!y'}Yú.rZbړ ]If
/NCrLM@ࠞ$rfjm{c;:k15DwIAGezʏqwP@9qd$<MK:rfw\qw_nmnoY۬_s Vclb#DѥR*Za;]onFUVN]IɬcbQ%:9Zzirqm_U$$Xyjku֫>T̞sfK$p.Tyaq._)C7ǑPUdD>}#NDns/?Ad#	z	'c`-ny '>S1@Ha.jK˟ĭH***Xv?\EGQI˺V]F\cr̊	 os ޲^|X	&?H]-H9o	1EiƵ^!rf@	WVzI_Lr$7By Ӥ0>T<?)o~e}nvVɾ3pÜ*wwUg:ʩ[~Vɮ3rn՟z{TPdB@BsksyS%e7~R&|t+TAl=FȻ8vq׷ٸĐnZ3Hyw4b6<w sOC<3>wiKTCy~Zz|ɂa"*%ЍP ŀG!plTJXUX[e3	㶬3gXYN=|lpL$s\N50DW*:05}Ϊy!,slݢGeqT&F_t.!l58.	YWQ	f&xO/{v58?A:~`Wgh;C$C&f)(\$&(g y=Y#69·#OeQ/˾?WH&#Ǌ.NTNuOueʹI#ļ3`4Xm(1VԏPJed8W7wzCw>.%|	ae9l%{}x?чGGJn)e34ӥA/l:P%(oْkix{`ĮS(i<p\pӟ"UXlVX-e?xmPkKG3Ts9$)J۶vm#@c
̛hAIV*uNPł(8HZBV*MzyH=+˫V`yQo^}sP _툾b~*X1=+j	e )D<ǎ$ZN]J-\CX/1 rp鰙xR{)]$5^;_xN'd.{wG?W1k´e8XxIO$bUi$}MayR崕ؚ4.L~Tj}y/n}Pm6r%Lk^ScGOafQe)>_$:$^1NC,iB
ľIĘNs/3xKn\2?ȩhC+΅MqCkO"R;S2.oh
DW11`*<<sK9ȉkSs|1@?ĉ0ׇoBn\,V}wuJ>1MKZ6n%U'O r!	殈$`&gT	SF&SJK!S+++߫3)P\/07qlaPws)1X	l(\sC5RIXF(F+DBZ&r6Hvږw~4[mCfJMaj27Te'^䧔EW#V_/a7o7͌n׋$}3.-1ήŴ)y+ϡ;WT,9moornbi{G\2m1Cq˴<T'܋%,\svNYa&p"]^raRXb\jEF˛abhQ|dof0%]	8+trBsTh1lIdqw#ʱ5χC@}80*¬Ɗs%q~! B;YiXZY=S/mXf7}^w=R,{io4w=ȴ!{a.P̤_@IwJ^WȠ$.$0DV"$$W^b!+ct}k'K#ul<+gl7Hpro, P3WNĪ<sRX3>y5/A"|*`\hQ\
fɍCW>eZC*[*NcgVW*8nʣ*?;UWܓb<Ԫ@i|6]ڃ2Zp!-̾i89]1vĝ/mL,K#M.[Ҿu= LBt[@scGƠt7@rv6lWNKZr3&uNӺԯ9\ULAyo{Mpk[er+=l#{
`Q@
4B.|`gtU~X/mtmh&:zJv5pC\P_j;ڡ٠I]ءk|㦊}o^+޼xQ*A(HOd1Z!d2͂Qd<Ib^`OVJ m'ʾM	Kf]*Xm݌ZJ]H7]܊@u:n`"}! n</XhtddR,G%W#D)IQk)4nSvpa:lchh/4e),|	L:ǋVct$F"ߝQ*11(~LcH,3JxER˾ퟍCLJUM[MʺSS]7E?okE]7Kt(0UqiR+Z4byL!ΡD?q8ty'#ED8w#;T=)*-\k3WG&̎2աScI0K+Y!;BmgldtR{$)fa`)F7KrD<}Hz~v#YX/D;FbHO$BE
)nSީS{R^7(wr7SFG8JkH5(Sn-Xk+ʂΚeK֭`Z2j.L 	@ß] eģUƌipJw-m$S#z̵٨z>4(b<B^

9IX̽*N2p٦
T't~8tA*.!SA\Pιa?,ZQWbD,ɤt6S0|`i!|5CvpzD[P6@R Ӷq<Og|YBڒ<4IPnhU-	/^0̔n?[8 ~uJ?&$3iэ'rb;bt	 yw	-$I4QPZbu	eU1juSa%ԅn D?wvG~ NwZzO.s+"%F^0S^~5==?>b|{6˲t-5Nwju8ɋQoB-l:rH:r~h8CzXx[ki=`@vov@aFϢەt+ߞfMSyzS}V`[ʆe`\d.b?VmR4Ҡ2R{e	h1Io9yFXۜ'uOJ&5g c#)R"ʫ!J|^0?ƩXn)No(1'Jދ~`d)K0/T8SSx
#O~|i#UppUˊaIx,Hir2)aE|IUʟ$}Mg(c4ݤj\{(emB+8q'l$]F% EQXSsZĴs(EĘ4-+FOpy!	+π0Ia^aU!9Pa'yr74U*xnyCl7P@h3Sa`,a[J	A8G*((a?L"h 13bOt;䋈(df'@x&:
L1$?*rS"ԛ-'+JYIqM}B#^߈/'*$ڧӼHZEԂ츠ZLܯ!pzY!r~MTyܯw,H~(SJAGG4GC&I*OfBGQ5
A(VK5(jT>?jHhb5&VAAHFYa"0!ΪlZ"Ж%mp[2VrK.n5HjŨїҖ_ZKS~i/u\x-[6d@\4^$5	|M_$5	|M_3_*وlC6![O$Z퀘J&}l&(nokNkYr@h5qq
qz^Zfβҷ,kbz-;v`pfZ8_YbOotg\?IeB+]kW\RK)hD{T$j{2=/1Oy+[w|GV}Hx֟O-T#2S<-9oc?yx=l9O1.ͱOH:M5kh
7'dma<7(Xb;L
wYVkRqtgJʔiILmTP%ޘ_uj ,{&6no.R.a=)t*LԔ
,wyu}>=|5xRSeI$PɈ^GfgGQw`Gox2C.v0<ҶFX,0j8<NEf9LeFsOLi!C}<{`LwJ[;z\
*V+{UVP0NIW9%j{njsOԨ"hgAbҕ1uE-/݆$Fmu!!U9!8z[4U$3dVSAIېJi^A_! b1/oC)Uɍ"'j40+RS!xHކ<髜7"=P9Ǡ͐ē_{E'uq}t's:rO3h#g AItEcTU{r+}=
<θAp\etEG|xyexv+QESViC~S}q&_L&O+wf6yr_ti'<8]Q?FN9Qr9?JFh'jos{ˬM](D)Ĺ+&s^eTjt;łma|!?:'h{w	0乃h&Y=w<jӀ!к$r>E+lId43%GM8WP<;g%"_8r|RݛG݅5X5p4CGl|cB<X^Ϊ24f0poSB'N0tɧT`r2ГKI9[4'$iڍ'e*݁Cu3(#.Xfj>9Mn-&Ԃ2h44{K,JDwt3jb(">/	 m.4MVֻ(r=d0EYyl5MՔZ92jڴ"0SpU@,sJ"Nb5L鹲w{JC.uKLu@Zw1d)wZVsRd$/f|m4ۺ{I=0P{0BOkLx@Sto*XAy}{PVwn9"5iľDSn6¥hcvY4~$\5AoACE0ONٴn@9e_gg1f"fͱ2OW9fN+WKVlf4s* J6zlf{B,վ܏!\KyJցW2:J5YzAR߉Rmv:iДH|)A{d!.	"<己l;k*RlM)gx("{*]ohnr_`SUajUM'2^ P~R)Qڟ?=fXEмY-ŎMư;v@w{~9>;p['W18ą1a9zѱ ȅ.vdBBvڱw4ȕ(Ns[ҏ7t,N9H	`e2M}qK;lްl,lK;(dAF
#4=>.	^$ #lA(pq׍C	K龲J "lōW `1G86^0[eA	dW'l!]řcIㆡ;S{8L`Ӟ)/c^XXϜbVy#}mx}я԰#	&.SI_{tϓf$q.7HhfMl(hs^|ϺY|}UvE;jRkE,pm*Owg-Z؋!I=KFXV+íDdJNl07,ph6|2ձQ;9xL]＂S]EMIئDcu|ROz:~`:EdJ;-1Ro$ȍ=s'nFnrC*_P~yZa{dJ/+iOr̝}0ʧV7[/s6K%? t~=ýWuN;.7rn=I1k&Xz4Uw yzoJҾxݲ<K"Nh^	ܦ/
.ĺhX<QMR3g8gAk^FdJ|4~sOU#O2??nJYr=FILkLsRj"2+]D1t8	1pΝYG`ΠEzk/7	Y#G,oyI@
Hqh'OݞX+qi	`}6J:ptu6DxJ-F@=QĨXfNU|'=|SYݒ5?+kќҕ̆٫fx	X^uJcŬn[kIS5/O&ē1>%f'<zhڏ,ئ:uAv(`[xh4lܙAeCz&ǰ 蕿36e픲qsL]u}Eb ]T`Xym;&Gj/-o18ۦgOT	"T[NV+ _qS!]G50`1Ƽ@C-:ΘHTB*S2..w/7d*T'wb7*s=b4r<)˟bܠv19W\_fz[q~~orNMuOT2.A׏ɾV]F2OjJT{e#-`ꖠpǹ*,bљW]X?&vUV/D<˭'bJz
{t/ &L"fY}͂4~ԔOUW"9V7̈PC3JD2-&&%I@
OyonwE=]췋c-=u'ә7󌣷UՖ+spapXWe$%+
/Ӧ_W!qSΎIufǔf6*kQ*B=ڶt}#8k%V+,рrAQ֯j)
Hbyoрٮ80PcL2(Up.MRÜ8\-8Gue/C@a;O7qRkuYc>)b☈+W03ݢ1J?(c.o,@B܄
"Z*e^%8/"xcB]5I"{wG27;y~sByNgmG&7ăKQ%1~BÕRB흀)	,& d<P Ig@U:v`2ꀾEeقO1x@
B	""7z|BS\I{ZmIq(<.b+ąח2a-G20iR	K	rpϞa;ujNH#tl|j^(.Zi%Ԝ)gJy5~K9ł4jxnP47dl'"""jr]Ʋg+ҁ	<jhiY?CTJ6PA%{F!8軥ĺMm&|:OP%ÞW	
~f7 #ʙPC8O]~Ğ%3ԇ~t't;fzQygK,`ŗqSlp%ac7p%Cv'fMDC_`b\nI+	q@l@cRɧ>K7w@~`dI/ yQNlJ9-"LPMD,јg4!cAdb *׊G9{MTv.,<b yg7Քޔ)<![]]^MįT*G,9ڮH"W<i|]8B%
էs<9_x%8̕4w%yX>tD:\\NzReӵ,U[Q8q5oIlt4qx^5MMαcW&q8ֺŪOh@1{Ҟ;i4q	2wm Ь9Ƥ;ƔRj 憄&.3rCc`ҥ76qYcr,,v2f&Ȳg2Lb4ҦXNfiU(.-_-f_8";eQ%AbiPiXUwY\W1W|HV3br2_ʖR?{R˷Ts/fr4^{!'4se5<gʳT"v5y1X]Zf}̸swCd<;H,Ava5,룴ϵٵ܀tn7;0+"e9bD<Entyn\7yKowluۯ;a]4֭nfѻ0_,:byR7bg:$[|z" ߦ[g/	շKS4)lbҢS'**VvDҒ$AXMph,ad <n]RggecTNXb^Uoێj÷/֤;dNm<YLww#ՠWiyU8L)-FHhCvь#فN̐i3*]/v҈HzNЩu)lmD7RWr./R}脚ߣ8%.ɼĐNrTMwAY|bPp2rT6v" Ay3׽d)KI~UD2p(_FIlfRPY-l@ԝj^`_B9-Ӭ!)U+AZPƩdZb'[5/1QN|? #f,mcJa5i0UO>ظa-=$q"ͦSkIV+sQ>4+Ufe|$k(АlnȮd`z fGEPk꽅 }.vHEK]B -PA`xjuW>U8_CF_N
BpN$eCbeN=dq)ZnB[fBvG<DIUF]^-&$v'dX*4f:1|l!?Xg)z^ZT6UϛrK:=?dɥ
'2PׁˢAZe_3'MB"|V3^i/C3ЦeIȉ:UB4ri9(y틲ygtVF='jj6_|l.zTؘr5i$oq{K$
kc|$o{_xq+푏'(2`j׃#oNy:")ߏ%.PWtɀ%.SzDռoy1#ܸUsHׯ @TS?{}%N7cpf:Cs7S:/'7M?Y\)tSZn؃.:JqK9\0V$6ehvy67HN ݾv^~9/qk9 }ڞbQNy`DC%oG^ntnYTQe_|d+1-X\&F\{?HeaS;3;@OU('dܥzoWWR)Q~gupUY؉jڔkyU\3S/笮,%VVm4G[Dʥ|0o#/ۇm^e\I9J?aS޵9*sňܖA׈L4C[2uzn>0<k1Z1މ	E-3lZ5}Vn)fݴci-ؓLߙ0aDuoMй	8^!ڝScד1wj`rm[bg8͇m2aXF$Bg!\wg?QW
A>|S7k*es80M<e=HB I`VF#<]qNy: 2}P[=93rG &gbsEQ"!{,Ν4ۙGctl[_8G1 x#B,.d}`V8쪱f&7yeX|xZVV3oY0k9 87,YƘXV > L5[A|Hq$Y(44:XLf䴙?'_x4d+;ovӎqN=q,:ɟ<bTB@m#Oņ~c,_m_P7賤U6m΂9%b1A*7H{?*!a| pǗ¶]F[ 'dbAi9:xxpx8"ThAט^35s<=	SaKK9LyN"Sj]sT92>,VJ4Ovÿ|O1Igd	X߽͟7rWL:՛11#KP*r#m³oB|LA<{}Rہ1r).%.5<*UUSq.
Bo)%I#gRuoln{$}5.)2MQ0fI0%bNӬx"YehSX7ԹV(xN驂/23{}Q)HB/JfU<lDG"'|IՂwVQYkLh7TKfTѡhfF70Wg7J_y(-Q]MZ3>G-h7`rcFx&39::JTxK$q8 q@%8uͣՀP;9?o.VC"bՐ(ȓfpK9Clbh1=1.8mQoХV|"w85uStpܭe0P |i>3 lNz~X=+[& l*܆rR[Cv[6mP<G ;1᙭XU-F&3ʞ\_WiK[$f.流Q(q+sVT<덂T.$tsSP(M1KJo{SoVLuהk\ʵ|D
PgWf;G"_r_L&s>CzOcWbgd(x7Gź&V=Eaѽs	riyTFTΧP9we|UO{P}ct?*VYRD4>M93MΑ/p"OGy񐙇j
2U1۞vjonO5BG5N\5; KHE<7ıR4{ \ВD>D^D2IA F椃ٶ#]^ܓ7fi
 qdyoGJr*}f+/em^ES!;m᎞X%sdl>H,x
Ƴ;vf%-~7rn%v?U4AunCo<)ϓ'Xb?CE<w=8t1^{_ ǁ? O&IH]	OˇGĨo10󄝻!SWsVh**/((N@8sL|`p9ڕls14z&$Dڝ G
]FJĹ&a)|a+ItƶFN_8	չBʹ{v$Aá8_q1I塩16w+{ct/ۣAD*Uϛ  G%A><Z7v_0y{>H+aQ޴j;~=u~g<v+DAf z$tc:97.h7!ZYxEn¼qpeeeUF<
Ptٝ"Wd}3)*1`Jk3|>OhV|]xg]锘S{Λ>:<<qUVa岈;/o\121X0i4jdoodp(0/5Y6ڝ#ДJ0 rKTprV<wݽ권Y$9@.9$i7ǔc;O=S8$9|j6pD1/Chǔa4\$¤L2<loU gJ(f-.
}	.~>2^\o.,lG 7tV8]Z+2o+$o݂뜸k<};,*yZTk*J._UTk(-rC=a0%nf)sa\*OO9+<+隁>/?q\󓛋j2|]<P0AFF/ ,
2jl][$`_%'BksNj鴀ps/l#?Fnk8殨rdv+@c1JRiC<4fD_:o\NB%6(i~9v爹u@c><|f>'8O0h~qnάZoǭʥ
XwK0P6+;`QH0znxT9|B*\|TBDE˫ѐl.F(Anvx7< (!Ċs2Ǝq'N4]=uEUy &qHHێDy1o>F%ٌ|@! ltZFj7D׾?QNx(7'OV'_-.ZbյJ&}j	f͘mlhLu31z@C:[KGIWO%'+Ӟ=Q݃1a0Ahx=Ie ɳZ;}%8NYa(JRH67wV<7OYYY3P]9&#eY#%XNֲ-r&'@Jb+Oʛ4y\'ƅ;*JwVg=θj}p )?I@	4ĕ|9U6架~lV'a B9@4''>AԓǶFyN(~rsZMG&fsLLWcv~q0w~u([5(Uu2o&]6jZӡZ?EbfSk;ZZX{d IJcN>vrRPG;IKEۘq[kZkmǿֹH_y;vݬ)3}@?Η V+w?`? (HF}aiCu/.	;xZ6>/*
UW铲٦*-\tUBӄgdՉ 1
VGWzۻ*F0)I-b$ǲC^7^]Hph*
Μ9tOiEV[|%6G,1kѡL73@h9t~8唜ze.yY['8	쟗BT2ӏWTá33pid{lq,KwYxyZ
WϡA9CfV#`x=	xޖ"B2冎sBпp7 dnY0Cß>=Ζ.l7M\]c}|;zѹ:X^-=]=صt('7ۻO㻷KH1Q R||$8(1X%#+q0"gȐZv_v4Abژ;M)AhiݯwvsIlOɀYI2'8BMt7Oc䇽2LWT)nG`GAag&T+
*UqDPolVT5WhTVÒ{H@olܥ7o~8yc%Y[}N}WnA՟Ti>L\AzS`ҏҙs2)GIf`gNjG6sR6["G;%t8zec'+/jg܆V4o4=$6YYidMI1P@J/{f'9|LY+Vs;kARchSQ$0)MmK.DV4AW8O4p;YpuMܭf}?D/=fm	YxZ`ˡ鵕~޴5lǮt"+~^Y+nWU4yG&$)Dy% I#uM*)\(;f_e-F!Նl7;.R|@+:#CȖ12- v_nmnoiu*bLnSo6>q
CFJ<ǨÃKY3|mLF'eѩu$W
1r$sl_vR_R/1ӻIڅf_ve*tdCp݃}h5?/f]ǃ
w_o}w?<{/o^vkp~:KAk4U7<IW_m7]7GC*Ww[/*]O4i٧Lݝý7$wQvmwPm|߭*CMv4*lu?y{U[|Q҇޻=+۽מw]Ҍ`oAvTO~>?)7* i5`m,Bxd :P' rF}i	z(>-`A[o_mu&o
*?/La?Mu{'i
<:HnZ)tO
?6z]\&ɫ~wY.CU4ª%6Ft/C&#kvgNfV^fƑU2=cmvv{o^-8_Csi28Qt#;pmhKm֦;Zs|$%ے%&EO}2P_*ǳctv2QEƙ8Ȍ$KӖ{ӂ=m3xwI%"dį%$w
K$]y9phV~/E8_bz#
5G"', mcj|}a%Ӓ>$MCכ|YzS\k{iFo"G(	נ׆l? pl]]w0TvSsйTBšwv6~M}|F_nL]v}"9s*#DYjv+Z	qi5+ lr"'Wvg1hφydnH{:oΕhWHXJj0Ont17k)/Z^$|Vn3],CdOW>cC0Nu8ZkJڵk¿>MOAHU&4GGRI  1TW.fN:O06o}ݸu'ك7ۇ?e8ϗRixKıib=9-|^"7:ϓhtϪR9Ht:(tH	[pYwiя'C+tlE'.E'VJ `;ܳ+
SCxJ;#7
. OO]lY:.eg1Ka:ʬ{/7pl<d;OҮ{
zA4?M$D@<vN0TMVb:EM@9tNLMxG?<hU_аoog{zޠx虅^kNNr$Hp7mvWfcYjf6f^aH+``oj+4w?<%+4W A5jÂb6:TWzĶ5*3VQmtZR!Yscu:^V}b'͵9˯OIz%Vմ6cj;)Ut`r$UtZuhLgmJfIʷ9R!__QjPCD>u*v155k'"EkPtiQ\A^;^Wha *orv^ʉiG?#ͬ(SsGr'͍Sg	5[ Cn*=TZo?InRyg3y{OD{#KBZNSЭL山\od+=g4bpNjXGP\?-gBZrOD=HҊNSE	puעϷgQs	b4j/uxZ~ w#XO|эg1b!vV'"}Q`{ 0عRXR]ozuߏ [3\,5|h6Q^a=qLFjIc:/gD,NLɐ؟UfB?(b.-*9*9(N^)]b1%+	/wڠvN\*w%PʡA٪֜Zfenmt*kuq]i<o7*Fڟ$>jL9%&ޛk+'FXe''=[[+"Eӻ^_1'2(oVA_Wk?n:  YiZzjYZ_oV:M^iXsZ@Ӓkf1h6Z#7܏ԬznX:FѴJf56*ںլA5euZ S]:J	j5*q(Ƨ :[_*X#j1AB(*hW6ֆE͍:\oYfjZzejר+݁2&˯XYtҁ.POa@RG(ۨ4 34:HQϺ\`#QZ['܋_	 nYZh*FgjuFh[5`+Mvh^6`x=vem@zUw76
@}m_c{4/ߐy,z=YUg޷:z[^[Ǳ=CgJ:P,t0ѐ&@"Fhk0@y#絍:Rwp;F&m&д";Do05bR_kVRzmm ac}ќ)h+N'ijAY㬮3<MIPnX.JP,?}6$KPz~j4VZF\[~zU?ͩ;hɩfG
ț305f)t)r2e`|wlR:ыpcryu}|)d%{!5llk\ Ǒe:PuD?Ǯ6T_VJiQzFϖ`7--O+`Pү}˫:8,<u˵J9StJqS.ƇT>|ƟglmJOKʯ!%R>=+V?1+.)KWK\qA!~PR{|4+y0fehyNH/S"Lɪs0v%q=:.lX1/(f8?pz 1?dg`+ʥ8w8VoMOD.>>T_2Ϙnһ|ָ #`UNxt 1?2ðw@'Axw0$2?Ό{=0sj%љyhTW*s?^4(FG>oy&al~t3 
2pd)CD>m6Fߥ!wH3H0z^i
N8C&r]4'7.7R5Y2,V3RIU˘0gCLSGMf{˫};Rt#Yc ~J"K
9Cf05h#'aq¡z/{QQ=_J1P1"C=Wl=X}0lx'q¹fRP2[[aؕ
0LelT\k:ء!UxJPĺS]])/S	TtcJenduu1&bqtNNu2%nq0|abB3^J"
$HxH77t&\>~v[ڛs{jo鮖slK93$ے	w,s;rFcd0~{tFp{mx2Mڭ%Y;L3#L`$FơEM@	IkLX+ `B0fUA\h ufU_|)ٍi*x<&mݢ~.^ q89{vz1UyS>#m	wPW4#xYnښ+M5\b~u5cVV
r{q iˆ =go#oE2i88@*`.*<W؝%
5賕懕'%MN\jLZPJqƤ2I.QXxq1?+0VJ0}]+͸e%hIu}cגjaiկUDI98Q(; NaVh!u%K.çuQLJk,OU@H ~tX$`DcNwa~]5MOTn'gN#2G^uכ7\ۑ{]>̛+=C-6>L=%L vE>ʦi OG!9Q/مP'c<EL,s1 4`K'dC鳔P	~
Bzadk->3vT:!Lo9@Dɱ.)#N@_Q3w؅&Ot.#fxYJτ*y(UqFY\bQ7+ޚF4-z	kOXYHan2vL<w6sS
=$^[A"8&c\ݘ*L%v]vk #_U>C¬˽̊rueaXr	57:Բ&KS0'P
,l!!L)'ϯWjU.h@'M%VuY?>y fU%x[yM qGt(Gx&Wrd4!a")ʟuVYS({)=I`[LlDXO2^pXf$"@&an^Y*ޑa1ܦT[y,P3z"1@D]%QbY~I t>p#j1iaX?zU9V<f_7kץ&)6ա]tݧ.!]D }YtZ }~3k'e)HT|'2]ͼ=XJb4T&kC_%Cr,Fa͞{>)䌣9G^۬s`4+I\DIфתc{"ߒ>:3iYtV)'9-l1.̓#*ƳsPDv:;>b96!3ѓ~0|9O$O`QtufRDM$xP	;u e;a݁ k86U<-ld	42
[("P<K2ʴr|^YM8ؗkSR'anbT}wX~dXZ4/͙N8*?Q>Dfc=mI)pWg:.L2NG㹒2g	΀*"c	z0XK8T҃[hbz߾41@]=CeZie.X8hBmڋbtІƢL0j?s[̨DpNxa6uFS|Q/]ȯ
Aw 3:SFg^xo<:|w܉mנU_BuAT`RXBi:Qd]~;Ar@Hfe#Gxѫ7(P4p\D9l 2q&[Nj]rn ˣ:AHʩ^Ae"TYf:x턯DfT>7>{C%U=EY2Dh-?sIBV L%A/'M)D^Ch4KN F)]mnBB=̀2dx<u1*<eՖ8
@vVU=9z|Ѡꉗ*:j%>z,`Q3?HnjS6Mez)ZC]OrH2huBܥ-#+NE P Z)&DR]s(Ћ(L
JV7,xbֺѻV.8`Y(
3/'.LS'WI(6@^ os̆ݰǗnK-zj4Aޕz6:zm1YRQpˮ%*֑ɟ3um"7	"O`@7A\YA[F7䇷ZSP^a̥Ю|{!M99fd26WfQm>2JΟl%8z/hZ<O.../S(u]14WN,ȓ{@{%@l'.Br
h N}ᥴKpV?|*9ϱ- 2Bh`Y+P\M0JvN	ZdtO]?`
JGE KK<sF=n炉E3NXz1.^=dj|h0A9T0WV :֋H}\V䪡/UE@%%JBeS״5J]O~U霂Kr@,a*p"RM8saò7W%kOMS_Ʊi2B.ԋFq~ e+W~s>U7W(]:>Wd䛫i0+jD(2*j@-a4LW&Tsjw:^@:eQf$SH$d8H%V`xM3eBrQV2%jlۦ噑GZE_>z0Xv;l^zMҸ~ *Ou%xRz&L)i&uv~m_:r+"?U`mLQC'vEw.F1^v{z¾ւݧ8?V1?4e<[hЅ{i;IEߜxn 'w˽;:1F?>G|'[$Y)Vs;F\HȋGǆQ3Gv+f&{mGNNBd ꘆ?ME,Y!Z#ecW'qA$u/EĜ_:7Ol)zm31޴ZN39}	2GM:2Q㆒NFEi\&/فR1vǞ6g+gfa2TRĤv^,,%۴e$=MizX8i#i$ΨΓaLQ	l>Q*.Yfnr
*Q$`TZ<P78<BkoTM_pt
V M:0|ۨOeʤ^Rcݼ17_+%%7$mUنG_"_=/4l>p~$rq<?~?on4pB{BǸ<:,z,;ֶaW%ͣBi0B1b1aˏI)Nt;ީY,UAȼ5!c/C@Ӗ=Suk㿇4b{.)k rbJ&π;joz%RS8qp,du0$ëҫ$!{'MћȝrBDH\@ ց H; 	ɒ3K\0XNͥCZQx(C@hu#L
 
Z\~N9_Ԏ/=Z%G_N<`/`Z?RQ܍|zIc1nW"Ohxu$KoBdIRp0HʂdpKh\|ҳ*-"ipBz8F
/[G)j5TR՝eta->hP[C%<&j]"HIYP"{O{6b*
Jz!(";P[RXk%Q=ԇ^EhE(hm]ף0XJ<h`gEX\&rأy	'tKقn.6hB֓c[#h gim!fmФuu1 ~6,I27AIjWYݜVcԛ@-0,'Q!}&@}&&^u~I/[,r.(05#T8`Mno:2U̻{/KSG7U3n}ku+v0	 !17(]HZOqRy..-<o"ǁ-~|e>, %*:]St7x[@Kh|]6l[K&v+q_}֪`c]X/%s&G(P+o.lx| ŷKKa?+A v 