#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vH(iZmwRRIrv֒{׶Y	Ih  %,uy9u50|MDDf@$%ZVVY$DFFFFFFFTF~ljk6N>k՛NkmV7֚`/Ir8'psAzD?IKۭvl7?:#ǿjwp[z~"o`+ٮ;I4s?wh~߂d#/CZI\NU4@J_5(㗒 n7k.{v?wuu4m;5;I	'l{+	2`s".9Cv'ԉ";en	Ν d'?bљRzaÎQ~*-?9<,yś\C2x1yȑ/nB%?k_T[wBZ %#@fgnDA/2{0 XCp*Pa'{4nBހpvU"'lFo(us8*KnU5ޥŏJ䏆lcoh_kz~?"{2v(|L.{_:q	ϰai齓Ę]V\!cN?@Xg?L7j51#pxvbChX!oޚ_WN'n߆IAfƇ/yAUѯ$r~t.3ǁ{QVx_ÝI)6
ckV	l߯w>ӟc;<[ZrO`n0Ww:af5@5M,jf}tk|1nv WcXv	,XxOq>9I8?^>
k#>OnK'o;z#vWKJJJTNvvбVSY26m&m:ؑSU6U٦*9m=_A4UӀj2c7vImdMIU6&U٤*BkCۥi.9QoG2[-"D?	[Z^_ʥ%z0Z:ae%gU=Ѯ8y	h[Xbߊ^X1&RPJ=7Y97	_$Le9=*b*[9(BT<=X1pO`+|;#cH~Kȟd5NĮiʿ6{/~議穼*~5J1+ZvQgCHiy˽ׇýWov;iͫov{?Soa=+-C{~is`waˇ&q̚ICTfIuoco-ơ¸,<-m؋uA^|ЩuJ~;]qJb~Ӑ	`/9v&`dG.X]ﰂ"-.__f}8'8yKө y{|?.I⁼_\c{U1$粵JTjT]-귛m-_j=8>?מtJGc܋/WY8$sr#˩F /S2CV <sO"Ƴ<u};\R!Bݵ
'ѻ!^vq9&H嘚A=I0$vtb^k
	Fz1dsFHLy.BY?	2tg:8>qY G)0>nK6iU¾?vV8=O㝺Y5ȡjJtr8PھIIW=},D=͖H\Rd[0:D!]{S*͇n #JɒY,)|3dG}5_~ɞG|-"N(?[<JIAX)N|b\Z??[U#NUUT".~>uu.17S-@ޔAeÏMzw	KR!6Z48:sbҌkB9؁;􊓾z}HoT:AӧI%ar}ʩ{yZo|SL+\{.m|?}g9UL\uSş_8]gTͩ"Uͫ?l_'Ʉ]ɅC7<rV1RKnNMbV8hÃ
>1{gwqt0oq!@g~]hhsF)2m`y j<xf|x\:|G?CETJ9n@1Cvީ3R;:>,fmYgY{h). x]H>jUsaPUu`kUB,Y-ٺE-uQ	+Ml\"Cu'٬kp\:+nMJ^kq:ۭzlUup%wH7L>R?QNGA/iIM>fQ{T5F/mXsG*,"^}#*wS)=0~RM5rG]hdꎗ˚i!x!Fȉygh(JQbPpӉ02@o>z6{	}]uK.rJX}zw=Uܚ5OSJfiK;^tO9<K,3"yQ(%,t$]P|Ӧ&x6P%rWC?	<'E٬V,Z67n֖۠lg ]rH.SmF#Ǹ'.*7X^DT꒝Q\q| r16d[Ud3)Z>zWWQ͏߼\**}Tb$|{V2/AXSVx"lI/?LE
RZP<2$Z7_&ncA,a3SBHjy wGϿN\~'Gc7);B$ip00IRIgI4G{I-Zi+]5i9]>CeI©*^Tm(xK'˽x(ǎ|#R|ItHcX4P	V}13*j^SgXBܸZ%ed!~ЫSцV'Z֞D>ϥvRe\F*;>d&a9c*+c~ATxy=斎s痥צ1JIac% $'-3d%%ab34݀X|btlKN0*C]I\L0YCMfBWWWW	vgSqwu_`n8ZCbÐX"Sb&.QFLGkf^;QW&9M>T䀛)l@6-90-ʛiZ/Tk͔4=en>٩NO)9`w%G4P_.ozo/ܮIf\Zb]iSVC1ewЩX2r~ޮܶ2eKcNۇbٗi;o9ߍ3,yb?:NƩKX㝲PLD*[d+fՊ7`hP`J>	ӥ;-qzWY:cXGck净2:pa^TYIM)K >C@̅v<7ҞDz_ێn0zX0(h2ziC0R]%.IsIAI\I`6^/DIHjCVnZLO<qF؆xB!Wܣu@oxtqX@q3fU	(yy椰f"e+}ϕk_^^_EU)'*VS͒^Z}G͵(UTN2lwQ)>୰7TqzE^	GU~wT=;X)'xUl<#W)d"PCW[}p,}s#b;{_4򙺣Y.G0]<S}b{$A阷ƎA	nlٮb=Y<gFɉMZu_9rP1(8Yf9Aoad/0K#)V{GޡQ,h*]!,<`^LLuDj	99"%":'"wǵCACMQi޼VyT΃Q<YɞcBdR) Jey.3/$5ݽ42sAN}f*33uU'h+Cr!2o)tE@eB@`yH_/`1`e1F90X9&/(d٩}KܯtYg!3#GމSRiܦft2GnO9xIЎ
_2iSX&Xu!&FH&D B;6Ub)bP06ƐX>B]	&ԥg*}?[e,x1uTKn'֊|;'9a>oda9JQaҤWIGi(q+BCL/~(fq.NFqL5Gw{RTZ֢XgPa M љeC65sTaV;cBnw3;Lي6HR=FRn,d32"y%['FLh:;L_^otw$y.IƋ0@SWݦS%(0$/KoQ&nG@qf-Εא.jP`Q[N+5"V5M,p[Oͳ%8e*]. <N?aû '|+)@G_ӒZHiç\Gk%Q*g|hD;)Px*)9r 50{٫?U$6deMNB|pBU]ChLsC~X7ĂQXIlU3a\13$Bj2%mڭ mHyĝ3Y8!'賄%scIyhΓ00ЪZZ_`0k)5/y~
&Jq@~$LIf+ZO5xwK2%&.5=@($#$ZITIiL#TP3b,B$
$L7J*:~,l펶7@ \VDEJ>,`7	k{z6 }(le ύ[j7r;pl4y'9߄>Z­&<uTGuʧpۇHƷ*U$7,z+{,,ۓVE+W=T71Po<]jH{0ۤ.i!A#eȃy7};1 1I%crۍr9!NH&&.MjFQi@YGSDE<W7Bfj
eahS7أBySeQTc~ORrցC$a_q$b>#G:5뉟-hG᪖/$ QX		eRBÊ?1H83θQz'dh"Il~QڄV8q"Ņ+OH,;K n"iݧ'Q,1+-hZV$'3>2'V!tCx)W`=ra82<êBs
ONnh$=U % L	ْR!5ofFn	Xvɕȃp&T<PP~;
.ǉ6	4`#EH/ #bf($v!P̶OMB1}u8=bI~TD7[NW7㚤IŅF._hOT};IxOyiqA-B_VC8IB\	_S`M5% MY 	JQ:hhpMT˟ZZQk:jRQ`tzkPԨ<|4G2jM&be[#߃r(~wws*7*M)b5E`,C-U!D-jKےd8䖨]jkՊQ/-䗦Ґ_Z"m&d~i&Ik&Ikf&Ud+نlB Ht1'MV$MQ|݈o[+֌5r돳Јk5>4
y,,8K͜eo9Yo[v#K̴,p[ļ'߂hϸ:~")+VF&%RЈAI0qdzM7^bV?[FexZvs~t2f{lW5+wsFc89c\.1Gc2Fu1X]k$zDzorO<aynPfAw?Nxﲬ>4C?H2(	)ӒC*1ڒ(J-^1sX2Lm\/\$U]zR&sTm򝉩)X,/-L}zk<H*n$>0x58H7eއ\1ߡ)axm	rOSEYapxڝsٍ̕aBr#&y|v^ bUɭW
;dK髒`rK&W7"nlQ)E0$"Ť+c0%[^JG_I(+׍A5C/C
*sBqni:̓.k)M=IP9$!cf"4!M=u}#H)	!2CD!c^ކ$Rɫ̓EFyOha9VHC&đD3yW9oD*9{FsFA!='VN*fKOtfѼG.@7ZċǨV{
\yqછ1% V$	Ҏ07
w>;LM«HWl
<O٧yRqF;6̻30sv(s+@O!5AY固Q.)Jk؍Ss<VL&RC˨L*vwCtO1z`sLƳzZy9C&uI|(V,ْhfJ.D-&!q*-"xw6/>KEпpZzLŕN77-+|kQk>#h ?z::x-;Ueh'V5ͦaަLNLazO2e';|eYriOIӴ	N2ˀUfPFT]<-|r6[Lehd;*i~no'eUY2É)?HIgź<HQ`E|^Z@~'ےI]b?hڭwQzɚa
@8a.k)׵Nst_+x$djSi#Da"֫́YPDEjse)3]"(ʁZcR*f 5r0I^LhϷuC#Nz`+a4e^֘4N|
Tn)ԟ3;{2qn-rzyEj:ӈ}ݬmօKhHjGf%<%2:ai݀rʾxCb6̜E̚ce&ŝV$hT ?;m̾
;e9XT3'}qC(q=/dtS8yk0L-%(eu3;6Ӡ)'RD,CQ]2Dyocg(wPT̥tIٚLS7^7Sϴ雡QD<"U#~>P)6便Ԉ	ϫP>ʭOdF@S:杣!i?	#T{Ͱ%#5yѝ	
41Zۛa%+vpr|wNAIc9pvcD'4sc@]ȄŅܵc0i/+QTݝra$=;nXrҥщVlaei02vHPSmwGL9JaGI<A,dm2	.nqxT0ks	_uY">YVWS8Naf| @yduy8fކMW+zAQ{1>ߠ?NO؂&E'\mo  5k$+z2q1zr'?}lwاV%$ma\@6>d;!`#BPԆoW~a_XfKr/,پ*jYt5%vrQG!-A]姭f,v"r&ǂOXe0LquyvuqW=S ;`TD/8e|S)Bׇݼ@bxz{^v:ؽ+7RvsK0Aۭzc.:LU"sGɉQl!/(h01d2%wER'9iOr̝}0ʧV7[/s䆰K%? t~=ýWuN;.7rn=VLdkI&Xz4Uw yz<8ðJxݲ<K"Nh^	p4
.jhX<Q-\3g8gAk^F?w]|9~sɏ,ω(G!d:~H)|raL1oES't#w:eW2{d(Bpcp@9w>9#o7mM&8d=`OSR#vT=zW]N?h^9L+HKn˵Qҙ۴ ئIj1ZMxG,`/=FPL\ ;y lm;jֵ7EU7;Vf0;a@=_fǞ_3ԙ{dC<rmEC~7f6ɬZC>c@aάp4uH\\7n^69@%g)mμ@Ưd_+,#0Рr,V)Z4~~9l!0E̽L?R{lyd`6ew<x̏|J<N戃݂R]nJ?
ۂQID值7lqƬ.FC1uA`!U=xͿWqwCH9^LE5f7Ƀ2ne$Ic6'w뤍eD|tqeQt2WWz}H5VIMxu$qEL8E8W%E,:'$Ӯ{ݪpZD7hWiWOaF	Y}V_э5Fb:X.xm;DP0Ht,&݂a2x2/ 0qW@	 U@qHy<)bw]ɪ~&ẍ́<mUe:BgA0UUsʠiŗ**xHA_xvuŢ`┳bR~ݤYy1ŋ(ʣem[HUdh i('SZS5PSFDaрٮ`+0PcIO2(Up2MRc9qtP]޸1OB%o9n}6)3S4D`flcaP0Ǿ5RY҅	a4)D<(9TʼJp^*DZjlW／exvr
g<@<_'&Xێp\m%%(Q@R!J)L@N@vBub2h{ݤ3*;ĘN\Iu@_B2l'@O Q!ʎ	qK=)23
f>pU-6ΤIE?D;rة"	g4ďMEQ`0:5OPj8R>{Vi>OV/մXH8jٳv<?rЊ<:cFҽIUc`	^Yba{FZ5K~ٳNeyzDm@n5_ZYYKL$yP%(=	DTRbݦ6@>W:YMvb諄FE~psap	LP١aT?bC`?fx<SE_33եFߩUq6X텁MI;,YkV8oICo1$zLb䄸\ZǁQVG6W 1StԊnp	 ?1x2F6ܨKG&E&"Mb]ڃM441kŝ(&m;csbSр.ϟ}x~SM)wItWi[A[I#xOJըb	pTP0튄+a(qk,
EK2Oxrz58"Jp+i^%J|0u#KG#{<AkMYW9]qlZ :sig\?H)?Rj
<r☿uW!1}c*v>zhY\eۜA0YHIJ)@M\dyfJ',>sKyo'urYXdLeψeʙgi/MҪ4Q\P_g[0[P2qDvʢJ(ҠXg,eDS}_1cؑf6-|o[2_Wid7"Bt2O'ijyH,go"k:N¯dH/̪q7xw/%Xr3J5)6)$j:kY.?GIȮ'ôw6\i߁Y)3/ )Bv[strQ[JcC<~ݹȍצذn-lt3-ֆze\7/eY,i=C%.L{M׋ 6>{O5\ژLY`U5:PQTb#$	n'Cm$em#Wq15*36>;+KЭ
p
=
ku{vL}toM&wjɧͺd7-J˫aJoY'0BBΰf<oEUDtdTN9P6fV*~˥F0F@sRN@ׯNqen%"ɐߐs)~h{D'O)paH%wc-%h[R8Bϟo @͛%CLJj?;$FL/6ZN*Ff7ma3T
Jln^'5fIpZh7r0*+<1E(LJDp?Wv~ys"|vwy]_0fi7T
I^Z}1ƵȽwo!6mw_KjZyTG?Y2/$'L'&_+@لd3uFpGv%ЃLY7;*ZS-pw!C*^l1ݷ9(Du=4S3]Pgh5rVsJ.'p/Ĩ3(kwa'tLnpw%2 *"~<&Nڔ68j-D0!?!R91Ӊc3	L?sN*g:9xԔXu&c/DvL.Vp/xɇ~X.m<iI泒H{d6-KFNԩKeϹD[n_<[79х|T[P	'eӔmuћ$SILk%y[e.p'Q\SH}h{%x{G^i|4<AQS.&Wygwߖa|OOP~w.w);TK,igu9XL'ˋAƍdC~(<z	S.,u3c{m8y@=qlr)JrtAgW{\ed(T?mȭ_")k@[γ@r1om4K5=8ivxmnLX˹[r3@PdK'/|f>BUus7P

/#[̈i2`%0VA,k]zxb~(5EYG\I%zoWWR)Q~gupUY؉jڔkyU\3S/笮,%VVm4G[Dʥ|0o#/ۇm^e\I9J?aS޵9*sňܖ׈L4C[2uzn>>k1Z1މ	E-3lZ5}Vn)fݴci-ؓLߙ0aDuoMй	8^!ڝScד1wj`rm[bg8͇m2aXF$Bg!\wg?QW
A>|S7k*es80M<e=HB I`VF#<]qNy: 2}P[=93rG &gbsEQ"!{,Ν4ۙGctl[_8G1 x#B,.d}`V8쪑f&7yeX|xZVV3oY0k9 87,YƘXV > L5[A|Hq$Y(44:XLf䴙?'_x4d+;ovӎqN=q,:ɟ<bTB@m#Oņ~c,_m_P7賤U6m΂9%b1A*7H{?*!a| pǗ¶]F[ 'dbAi9:xxpx8"ThAט^35s<=	SaKK9LyN"Sj]sT92>,VJ4Ovÿ|O1Igd	X߽͟7rWL:՛11#KP*r#m³oB|LA<{}Rہ1r).%.5<*UUSq.
Bo)%I#gRuoln{$}5.)2MQ0fI0%bNӬx"YehSX7ԹV(xN驂/23{}Q)HB/JfU<lDG"'|IՂwVQYkLh7TKfTѡhfF70Wg7J_y(-Q]MZ3>G-h7`rcFx&39::JTxK$q8 q@%8uͣՀP;9?o.VC"bՐ(ȓfpK9Clbh1=1.8mQoХV|"w85uStpܭe0P |i>3 lNz~X=+[& l*܆rR[Cv[6mP<G ;1᙭XU-F&3ʞ\_WiK[$f.流Q(q+sVT<덂T.$tsSP(M1KJo{SoVLuהk\ʵ|D
PgWf;G"_r_L&s>CzOcWbgd(x7Gź&V=Eaѽs	riyTFTΧP9we|UO{P}ct?*VYRD4>M93MΑ/p"OGy񐙇j
2U1۞vjonO5BG5N\5; KHE<7ıR4{ \ВD>D^D2IA F椃ٶ#]^ܓ7fi
 qdyoGJr*}f+/em^ES!;m᎞X%sdl>H,x
Ƴ;vf%-~7rn%v?U4AunCo<)ϓ'Xb?CE<w=8t1^{_ ǁ? O&IH]	OˇGĨo10󄝻!SWsVh**/((N@8sL|`p9ڕls14z&$Dڝ G
]FJĹ&a)|a+ItƶFN_8	չBʹ{v$Aá8_q1I塩16w+{ct/ۣAD*Uϛ  G%A><Z7v_0y{>H+aQ޴j;~=u~g<v+DAf z$tc:97.h7!ZYxEn¼qpeeeUF<
Ptٝ"Wd}3)*1`Jk3|>OhV|]xg]锘S{Λ>:<<qUVa岈;/o\121X0i4jdoodp(0/5Y6ڝ#ДJ0 rKTprV<wݽ권Y$9@.9$i7ǔc;O=S8$9|j6pD1/Chǔa4\$¤L2<loU gJ(f-.
}	.~>2^\o.,lG 7tV8]Z+2o+$o݂뜸k<};,*yZTk*J._UTk(-rC=a0%nf)sa\*OO9+<+隁>/?q\󓛋j2|]<P0AFF/ ,
2jl][$`_%'BksNj鴀ps/l#?Fnk8殨rdv+@c1JRiC<4fD_:o\NB%6(i~9v爹u@c><|f>'8O0h~qnάZoǭʥ
XwK0P6+;`QH0znxT9|B*\|TBDE˫ѐl.F(Anvx7< (!Ċs2Ǝq'N4]=uEUy &qHHێDy1o>F%ٌ|@! ltZFj7D׾?QNx(7'OV'_-.ZbյJ&}j	f͘mlhLu31z@C:[KGIWO%'+Ӟ=Q݃1a0Ahx=Ie ɳZ;}%8NYa(JRH67wV<7OYYY3P]9&#eY#%XNֲ-r&'@Jb+Oʛ4y\'ƅ;*JwVg=θj}p )?I@	4ĕ|9U6架~lV'a B9@4''>AԓǶFyN(~rsZMG&fsLLWcv~q0w~u([5(Uu2,vZŷQmF}-)7۝ZiڬVo7ڋ%&PNgdsAzD?IR_PƌZkZkk8ER2ei[fǿVHBQuvZ4u֨AA;4KKEqn$9vOؙ'NyQ?-HbUN6Uǰ]hdz?8[Xb%l$<'CNğtQv:R:<KyU1vlIGѴ.!#M<r9JGsFVaPMtn%StWm	S߃_ؗP=[,lb3K3dĬFk3R iSL*\V `" YeSrBN땖5eo`''']
QsL?w^Qhh,å:sű`.ezR4*Φv^Shz>#mEZ@9t-$y[zVɔ:y
eCXcܛ?ceX$:[(7quuhr`Gr`qzpte/o>~k."DHia,b<("7/S=:BNԳ^|"7Jj_!^-o3~e +gic_4YvE%&&?&g&9Ȁzz~l
y?L\3P0^QH
Fd}^=ٛRs2TűA\Y87ռQYyDJZ"q\j{<N!'䍎MTf;ply*4	_'zT0	NuI?Jg~ԧ'Y*O9=~=C8=
j#| oH
J=ڠn`U.T瓇	ث}yxXns[-h.8[df]ZZA7QNBEl'Intǎ1/eX!*o<Iɣ3tN>FtpȯJ~jط-&( 3^7;]6.|S?d)֩7q; r-NRצXfT.gA&!p.7 VR{yӪWkװV{ЉxrQ:^RfTnq{\B3̛ $Ms7¢R*|:7SFVH61![l
}up}թk|b1y4?hf)B+)DBޒ{
fO_/e?̀Ŷ1Gֹw\+̺Ғ̱
2ٵ#K=pH?KDLv|'j}|ӑyévv
˷[f7o^v*n}SNpy~OQO/)[1RМW1of$]}vGo\^m4T{pt=Ѥev3vw޼N^E=~ǷݵJC)}^$5tەZҨ}MSWmOD1J{l~_{V]*itI3JiY'zڽNR?d܌T--]$ʃB!Ν`E%u0Dnm}יR+w00'4/
`
o6\nԁw)n?;WKd<RT; mZkq>+2
k07([/ۃڄ/yN&VU(#F~cZg7U@U̞%/Cߘ,ToI:ɚuXyGV<_hk3myb.|YQ08oD/2
܏-&YDj7Ww2lKҖ(O<@}١{Gf>"3GWo/N[M`Gr%-[T, 7	<{(,ɾwmiz7Zw^0(4cJ=~ඍJOKt4]oeN]q	 _5]q$\~_f-wfFw݉bP5MABS
\VT6~0w=TϩfG٥JB6h%iլ?=ȉ\o,۝,q<瓅R!s9W_Z a)6vÀ?VqNR<s74ltj{NY!!;tϳ	? $:sf@kZ(i	Z4	B UL%2mFK%>y0;QI^]{9?"(uvםgvlv?_z Hyݒ㕞/<lDһzIh<O='JA ҹ\U"$nDg݁E?0fcӭ8X+pJeO~"B?5((c?:?w?e0t.v*N;d#ñwf?MV?/#J)H}=6Ó$`iGms9pS5P7
[Ƌ cb8925E(WǉeV]Aþn_9YdzIOgz:9&`Z"TǟF'4+^]A_ܛUdfN٘y! 	Q|܅*w8|h6v_$^oXbsPj^V֨XEqjIV@f͍u4z}Zo6,>i&ZVoTڴZ*^4TсɑTiYg;3)')^HHSĆ~}GުAqlo
hvԨhUlAХFqzx]VHVSy)'Ev4&Laɝ"67N6t%xL4oֹڳ:GphbSjB^T$IAK3?퍀bd**.,	h8}{OA&3Fv rWi\xҀq:aArhR0<
+*Vh=O ݓK+^;M	"$QM\>ߢ?wGJΩff&9ҨMR_qkjV`	Lc=#G7qf hZbE `JajbJu91l?OoУGrY֬Dy2#?32Z]$騚`8C3:E3%CϪB`Vۛg(a~HXJDg|[z\8yvI >P|l$Rܙj9r	D-RWsC*7ҫf[sV;kfkѩvN3Qߨkk21Yxo/JzSk^Zg lalm|QƒOFk{}Ŕȼ/0Y;}^i89>6 fUkJfA_[k~Y4z]_cuju 1NKU-@ٰ*khWp?RFa@Fj+ښبtjVjXԔiLuYJ*-$ը ơxl~w/lc-@֪F^YX"V674pse5Zi5]W@:vlԛ:.be&2J,B=KelllPNϠZ : Ea?rւD{kmp/~q$ DfAGkMK`QtۿJձJkoՀӮ4?)zـ ڵW-YT5:Tެ0+ .5Z0mn6м|C SgU5z@skmym5*MG@Y<ckaFCךv+tAcS߿6Hf_@#vhYkCFЮ J}[Jƶ4ֆvb+Fs:ٯo:oϪWeʏώh|6%4@a+UC5PSyJ[,2j|n/,b@!uXjyLsEoU[34Wj1%V* o~cO|z\Լ\Ёߧư*ݱKrD/&Oi*ձ?S-w?`ǗԳ]Up5Gڳ*PCֵP}6[V+uoyGc;<[Z
x|=wAVJo,N\
S.+Lӡl{<\*EQJVMmo<PnRQ7)?I/)҇d^R1KɇO|C[MR𮸤,]5</	p=CIAѬ楿+Ey![e9"L2%.dϧBҗD08 1cຬ±a(k8t1Z+ḻ[a?7?EWPoGʐ?c?1J7QFZNhDԋ3H=Um2;*.ׯWi (Z^.cx*6H\#}N4]B֣eWa&ÐwK<8836"=bNXt!e1ЌT8f')i8
Q:r#3|<|M2u:#5g d<R}lKCz'~AfN啫ˑa^A[23p2LG3On]nhO%$j$γ<?-)dMY/f\HSˑ'1A?a84A:L+4.~Wv-G,@aAEJs<;%?BajFNp9CRY/^.ӣ菣P{ 㿔/baD:z6{nOUa[Ns4률d #+`B3F(QtCCFEHuYR~_~)B'鰿?*ړcM"8C Qiz7eJaXg{EH%"274onLMZw}H.76>]-	Hٖs+BggI4%JYvƀ`?uG<.I(!-j ;%d[Kv3gGHu1AˍCA֘&3W $4`,*A̪S'T\wLںE]- qsZ-b$E;3}F(84&ϡhFܪ5WvjjRǬ䄿AҖ}@l3{a39P+߄Gފ&e8piq
<Uc]U(yJ;K0kg+7+OK.Hе<ICe\P0<*Z˟c~&Va`Vq)J)ܓꊍgI%&(s}Ӫ_\s hqP&w2A
H~9,lYIdCz=;K\OZpLY0BA"|I&j	i=2qj1BNxϜ>Fej5x7o^#0},Z71V{hqSZl}zJ@}M & /&VRىCns^#NxX c hۗNT)':g)>nzׄ[}fg"!F㝩uBBr/c]R"Gcjg$##;$L\
_K)D!G
aũ'@	UQ66nŢnV5hZj5f֩¶dfyl{ID$hq$2L>Ƹ%1UxJ8B˥"	tAGnM$Pm}NCYo5ؙ㗗{3<U	Jðjk0r7oNueM1H	azOX'BBbSN_5v7=?]Д|OۻK3BS(|&
4 ̪`Ktx04*g|%Cy%PC	L
ViBpER(?"XM-PR #<t{
$و-dx}Hl)E<6MXpTN#%7bM(X6%fD'y#%hc24d-K) <@.Q|"TG
{cTð4{s,xO9jO5n?׮KeM2SlC"O]+7쏩Cĉ@\ixܵ 6?:f67OSNdy'z,3h$MָJ<J$2jXWϛ=|RG3s<YhVf	U%VD5B?%}t.g:&ROrZ{cb%\7'GTg3*#tg}?}rmBg'`s.H̤ĉHvxAh3vF	plƫ>y[xhdPDS/K7fwyHeiڵ`3p4/ah7PNJ7.]wﰺ
hi^}3Tq,U63<a|Ѝz(R, (83u\he
$<w!%[s%w#e,U
Dha#f՗q`?:3%5мT}i)b;z={&ʴLˎ˿]p.Bڴt3E`0<憷QJ#mlF^?6_փTmveAftd͍μxtŹAB/^&R?(M5tȺ4P?<w*Pf=4jGWoQġzi&ḈVsX tA#dLպhFuGu,瓑ԕSm#D$KtN	_-̨|n}J&:r{<d4[~撄KNA\K^OбR;z%h^ -Sڂ݄z*ieȬ9,xFgcTxʪ-׏q7Iz#s$٣A/+TNEuJ|Y f":FզmW R|>eJ+)ꄮK[F!WGiHbARL6Q`Q^iQ`{nYt)'3Ŭuwm>\=q:3QgP_O\8NJQlnǁf
a/]ۗ!`[0	,hL2,+a}mtzcju]K4U#?ag6`aYDnhDEN;Bm%n([nofK]q6BrsɊ?6+el$34|,ɉe\??C!Jq ''_дx"S\\\<!7_P4bh::ѝ*Y'3|#/K:ECm	N\*hgI 0>'Ki0`ⱣT:s㣟c[ \'dtWԟѹ8`RQ^8+@xPF{ߩ+Hxgb\~z8иas:`ԭ^t|;2UCy_KJFʦik8_9=/^	倾Y|9UD
p*u`ey)~o gKc!d|R]V#>M7*& dW8߯|5īo4	P 3t.(!n}]7W`EW"BՈQp%d+T@_y!Z(ipp%]MNR-nuɽt2"H\
EI ɬqJt07gʄ6A*aeKضM3#==2C7￰}`V3;8%/.w3H{%ؼ6qC@UJ,5LRM9tVD~"%ژNvi/]$b7oyo{Cnv}=OqR*ۭb~io5xNѮZ}Ӹw9>N{=Gwtb~|NIRvțF5ꏹ-*0 ۏfVM&,b'h;ɬA1"<Y^YSC	F˲ǮÕ
?Hj=_s]G9t>!;|#n4Rfbfi)f*r$d䏆td|L%NJgJѹL
_h;b?%=Qm|WFdI#\튽XXfK iH
{+tp979:Gb7fIQ''̙FR3|qU4]$^J݀͘%^KUd\INx$nqN/!i?yh B>"l(>u23:Qa-8Q,iJ'I6y/bo0VJKnH%ژ1EJ{^hة_ku=w}ٸ}'}aIpޱri5j%CG~y~~4}iwmӯ0epKG;PwIab<[M\;c4;oMH)D|wzNd$A	maƒ{N`_&LϾ=G͉	3. [_8Hje<Gn{h{?[	sλcC2FV< ,筌 ~\Q3'zK襖C_'#1@VeU?,8z32`UƩpaHTRzׅ
{ <i$:A@!I0ed.;Ltxhuyv]CVJ-0+ e+hftN9rm870#|WA}v=f'U=uQ16kFcǡ'G44ݟ.h;K⛯{Qa-bGF`	i~hcbT lZ"	2~ \skMU"EkVS4#o +P b0b
oLTCjY"hH)[e3H,C(lĔ'T"?UAM%bD*Kw$/e>iVKDJzMm0'0vZc:o 0&rF;h^	_& Xw Ds:s v5ǫ|Y4DB^F]DQ&6HCuj2+j:1Ȱ%tCgrgmЮKj@a+tA"NP}9	kt3Ռ|{tR4UtS5#+rh,ZI 	NdGz갆XdP,8%I$E9lQ%/̿	5lopalPYr3	`.4Un+'Z>oնlT4iL/Ց7W$^t:fz\U|zN,3F^:fҀB;[|6a§ x 