#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vH(iZmwRRIrv֒{׶Y	Ih  %,uy9u50|MDDf@$%ZVJ$DFFFFFFFTF~ljk6N>k՛NkmV7֚`/Ir8'psAzD?IKۭvl7?:#ǿjwp[z~"o`+ٮ;I4s?wh~߂d#/CZI\NU4@J_5(㗒 n7k.{v?wuu4m;5;I	'l{+	2`s".9Cv'ԉ";en	Ν d'?bљRzaÎQ~*-?9<,yś\C2x1yȑ/nB5Wǂ?0U]?A[dd=?;[f k N
9dCMh0<JTh.cGeITحRjƻYpmLkvS]sbOѮo}׃eKgQ4.=a>,-wSW0>J<1d G}LZ&f1Na+0[J	"0>2/h!ð4~DΏe&8pϡ:
K_{3)8Fo%5n.tslgKK	fʖ?!N=lf0h)?Q|_ڬq;-vˮ?Wp<?7'?TamgɍX}]Z8}Z!`vYs$j]iXU#:vt*PSYۦ-ۤ[;}j6U٦*T%MU竲A4UӠjPM߁}|F_.7MI5&U٤*TesVȠuavo4%0'/0HfeZ$'A tK˫ADA"FY'䬪';/?skKA[RR?D
 UZՁs^&!k<C[<w kWW@5Gз=@E_evwsz _JBQ6) `~e\c_\z}bcWZr	̵Љ;1[vo<Wb&Xiw6fVˎVR0li> b;o~wjͻnVS3myn÷Z5b>:1_ѽe}9mN>{0Ļ:Y1)Y~H,nc{|8Te3{.ȋ:ѽ.t4_Iܯ}+6NZ_lOvp2%Ўބ[م5v?xwӡVP{%RLBgdG3OQ{i:Cw "oS :I<7k
>\WAu]·]vmeK GևړNZTR~{J8'sNnD7u9uӈre
U~]`|gIDxǰ/K0D(Xd3>zW} . bТ"S8'IZ؎ZkM!!]RQCYcA73w!9&t1{h)aEh>'A],Wݗ[{[?n6X>mAt)&VNW4[cQiUuSsR29XmTNb\ z\C 	8z=	w޼{{j(眠	K*,kFXG79oo|Jq$_)Tc0#Y;+3с%sF3}O9/e^z'w˂G^))+ŉT6RZqkj$ҩAJGQTҲe=f2#XbEț2>,v9"VI.~O@*ҦqWGg[BL;B1qB\>;P|Ǖ^qC/~ `^'z45LO9Ua?OosÛi_فk|ۅU0ݝir뽃U򌜪49[ym}?Tv?+PƜG\!FjޔbIxMԩ	2_,
mxP[<fQ,n>] m|6.1ds ֺ!+rvm(<EF,@mǓόo |UP_`ygJ"G?#t#-H1c8f.a3;uRj68Vbևr|¸-V;q-k<	6ׇSMj.շ
pMj^;˜%[.Q~Y\;yї4KouH9$uvKBUTBg٭Ii9^3:޻}M4NxupOowov:D`2 ɧYJG=
(%-	,ʙc8@^~FkSeYD˲oDen*v RɲFȱ˱-,_S|Y3-<d91L?%V[)J2>wt: Ff]/^f/az˿n|	_BEY[	;/^gu}ѣ*[iJi;tip:4geF$/
CZ$o&D.j'gH5겁%VKϡ&mґ\eҶr1P<bB%&#|kCҫJ]C !/dA7FÆl3lF^0e^+G*o^TW+ BWE;
V|JeBY"k*O#⥡)@WARj !@D&x0ų:l&^T^tJW IM;	?hp&vG0m5&b&6IX*iU,ICh/eSX@^T9m%+f!?S2b,)uC8ZE_ދj>[Bۢo	~%ؑoSYqTYϗ!IwK*b1f@%A܋}+qCWCl|>z5r*ЊsdSkړG0TZeǇ},$,ՂyLes/(3
O<4Oqc1rT09_))lP qbx$[lPr0KU]OLbI1 \eH+"+IF810 UQ`ɬRcJJ`J*L`
?.Abh\,y2\dJd0E:(ͬT5k'򊁾6$Vɇp3(19C3ݦ%1%ݺ_y3M[jzRFڹ';uىWq3)eQ9ȠjKe[/M3"IvqߌKK̾k1mJs<:KFNۯ۵۶Xr;LbiiP\,2m-qqE7OG'85b	W]ySo	HWb\,uBX52Zfmt5ÛLI'atB`%N
1"\9#\'Ur9<`>p"xY+prlPF_8~0")Ŝqɾu`'ubЎFV3hAT}1Fy]KFMf<]2mFX/)c.3P݀<2("	ƫ"6	ɕXmJ-]_"r۰O(0{Y~.M4.!~;.cʉXwgN
Kz`&_ O|\۹f5HQQ,rk?Ka5,qէq\"{hYKi{,v
|JEW핰ZyTG~Gգ󊕲ڞ{\Z(ƣK{0rBF+5du77~<+E-;eb{s3uKڷ.GQy(|nath[YF*֓iI˳@fؤ.iZ!+߻5h?mnvK¾4Rn弇yuO 
HFم;0,Σ%δd\QGOQIԮnH+P2J<+|B-yz\;44١;t~{TQvk~ߛ/J<ɓ9A+L&Y"
T'82SBRLJ)3Dٷi6aɬ2K0SWEyK2tA+B+X[rȱ|!@mly]P/dE B  VaChB޷Ju8#?r<%;j-emn6L's6Ct%}Q9or<	Qx2jrndA"3jS%f"ic#ԕ`yA]zF	Bjٷ?`U6RWiIYwJthp'-p``ȷpps+y~fxIs{*.M}eYKqF2"9r2>n2dHT[Yx*'Ek-:uPQ:tjyl\<7I@fiaa?6+qG?_LnCj$c4,fRN6(#GQ^IOxn$@4vHwHRDhC4qm;UR`rSKnR~yg\{upb\{-zaEYYtغ<[LSRm	 h60y·xuޘ<-NE6|uDϟ_"rvYχFEs@KA!P#;K[EbsIV0T$η'.ȁ^e^9%:d6974E+
|J,%fyP<=Cb,-&c.ZA/h*ߦH
`ږ>IL?՘#y~>KH[27<	3 %URg`qяNG¤df"5$[ݠQNwT,Sb.arR#B2Q>Ob.$IƔ<B *J5C.*F"@`J2t0߭΂h{ 	{Pk@ZnETfj}+f?gCߞ=²,qKFZn`]qm"|&9GK5ۄNꨎܰ_4r)VuZ*EoEy2s~{Pѳh4v%]ʷCTTvߟ;ߖ!f4-Xi y804hy!FY3:ag9$q<&uLRx[NxB6'I=tĤҥI(*8H~F߬B@,q&{t[z 9o,j6z"qYJ.:p蒄7L0>7NԟDԧ9pzBHFq=q}_cuH<\ղeD:*B?!LJhX_Rվ'F I_x7JMDv7/:JB
'NpE\	Ip%y<|	C@6-\1Ĝw<J>1fMʟd2C$*nzH?s/z
G3`#wg}@&gXU7a TX!`iA
=CA[)![vC*h-a9nX2Ay0
JruG81F01y<zD9~"<c1r;J6	I(FôǾS:ɏܔH1fJrfVy\t_<ȥ7b?Jo'	4/1=Ҽu ;.V(S=jH4'^VkS6վ0akd) <_i5TR`PmMI`SYQk:jBGaP*
.:B҃cZ01=XDPlk{P.EnnVF)b5EXe*<%Cm`[2ܖ˰[c0Z1j#嗖Ҕ_K]~1W!^Vd#لlA6/>M$5	|M_$5	|M_lE6"ېMdqV; I7$I0ZkߚFnqq}F܇F\A#zg-'˚N}di#%Wbk[0BOR$eYbhWsTR
95	Z9BKLS_QzURc4޳cȹOKn؏n^lfnh'g}%hsRhN3F+}D/BA	YC[:,
,λ)B]ڇTp( Y%2eZ(S%F[2T7Wz. ^I+[Kj<KXOd.
-S315%]^]OuԔtbIc2ħo°Qu^";4;8σ-Vi(4OS{a2<\0,`SvZy_nb$O5S+w/DB,<Jal)}Uc!:þSUNoI*Fܓ-5*>wD$twL]uKk!	esz9h[{bFseHAUeA<5M'qyre-'	j4$dYsF!6䡩RoD)=aP9WfB?(dېDJ#yyr#9	!?Ǌi<ބ8h!r*H%G}O0h1h3djIb\elɜ50H`FkPxUp՞JsO!z+3n\u3W|^^݊Dc{"U_ FTg>zGIxʻMA7w?wI0t2O"hyWuF􏵑Fyή:cԼe3Rq}?>2k|S#%Ei-q3qnǊ܄CWjh]`u[{aX;nHN	;]/ry` xVO+]7Z4 gd1.OŊ%[4Lőe=$NU"O&bG|IN\+_@ri&&Qwaso :j'b ǑA?:XPϢ6WtĪ|<_oNA*8&?e2%{Ц5)giOIӴ{v '5[W',-8Q`EC,-ι%㌐ m0j5jQzf^
TtZivYS}L鸮ƘZ[ !!r_?F}42u(R6+p^ߋk.Pn+j\`!K?mԲIj"_)A&K2CEsmI"ԬiCr0p"f6̚)o1eN'sF{;{{o^T&.԰][@/LgsͺQ٘CeH^4fE]2:ai"oFhѯg1[MTtv<]M}{;-es(nJvef#y坲B,]-1AKՁ7!2JZ5Y^GARg|RcmvJiД.|ܵi6Ad@"<{Q;k*RʉlMb@9n͝΍fk<A'Byį+*Τ0T!ꂟ;zG( yuJgԼs4='a*}ϠjTQd&43AVf?;Jc{1NŎ߶/k!(0yͮ7qadfyut r=cvn$ͳyr%jST\.d`վKS)!]oO`ջVi3.si5xߖ\cQdhzYĲI_m&Cx&G̀GʖU%ӝe*3EڊgfƗ*
pԼV皇3a&Kmt79o3Zt-h`R${8ҫN)iM7/7p^|/X7ݑx{)af_|}j{aUBb?+ƅdnËcM>r,24>Nm&}5n:%enz3ɗBluFC+_%~I\XȒ(pfՌR<ZBSKCF?Β[`ǟ~"m6cY:159|^Blif:c?S7ڛs_W8yC$z)Mz$sOثuu^)4/ɔzw[bl2nӛsIԾ){X5:N R:/|Aq40Fi),*B8Nkπe^xo`gaU> *%^z&	_*ٷ\ 87sZ ܁ppv[ZL\:71NJգ!q
UzE_YZ,=tB3N`69PwWpwG }_EhP9á?#Z4|Sx{K~ؚxE9D!U[xڋ!n,1eδϔMaq)2.Cn&.@D
nCL	wB]t ]&6A:kD蒥|0O=	H0O]u9`zܟy<ڮ -UL/FIgrbNvoFZ2'hq`-?ÃEk mb*#ɘ/Gu*C9˷[j'Էgs-s<^w@Nx:{o6ثn`w`
>w{~;iI>f4ɂx2EW(i?Dc
d-ۡvGfn	`Ұ}pgV8:-6/BW^۔S)^ [2uev֕MVDhPw9RE{b-yx?'w6r"j y2`(n;}<t>Q%Pb'snA=Y |-RtE0 "lLr@Ip8cVo#Q	a;=HʘLܐqCAGx\/qᛇr.zO1道Wu2A3p٢qArELUǬ^f߰6d){RSJ!޳.kInS7N'>Uf4ɴ^@r*8$sn=ԥ/USأǂQ b$bV,dGM=Ftt+<B()/A`sQ[$y@*<aG1P@tUPx2OZ]yz fB{݁mUe:BgL/Umsʠiŗ**xHA_xvuŢ`┳bR~ݤYy1(բem[HUhъ/1aiҜ掲~35UcvQ95HjD)n;?0vܜaގ#o^
I>r0g4.pIQ]ٻB)PX-{Z]֘x68efcfW)~֪sw  }kۤ q*hSxPshyT4"u$^Įy=ܷˠ
Ux3d1QyhN0bw02ھw/G	xT
WBH	ej,VwKܧ8'CG3@5c&UaGl!uʠ.7LGmWg~O<<*)'TvL`@ܣX MAi`'UV(J	Fįjq&-LR.y˄MX`H>3I%,%j* {֩y:R#sjٳJy,Ƿz{rhB¯^Ps^͞+V,6ҨY⭺=C@M]"Sܞ`4֊q^u˞u*cpt)7lKj&xty]gZjdb%yP̓*`@)EL ⤢6 "
jB8{F_%4*,48CCH(gB5u<u{dPw1ӕڎ(UFA.5;UO-/9l]L}8ڝ]f`MO|zqu&#$f#':=ɏI%åVl/uy;~H} '& MG5)^R8h3)B5(&ftǚY df_+55anS-+S "G$:TSsiTVfްblawuy5y:R5rbb2h"aJ\aD|/Y4zNwxd+WWjp|E"0WӼJߕaai3\sϕ.R2WW38EKEMךTn5$pĻڼ&uST'Rz)R4758#=o2>5sbT|+2'͟9`@SJ0>? NLY|I0N&e庳ɘ ˞˔3 ?_Hb9Uiζ|a۷~eEQ*A>bY
Tv$߽Ys]ih\[#Y͈mrZ&K)[JK.߶Re?ʯ%oܹdßOt̕ռY*R߆EtE"buU36(O e_X[KfمkRlRHt23ײ\fp]ONiVuxӾ"R)fJ_`ASHHi9v|vVxsօMaZf[ʸn,_ʢ(FY/%p*&z6oMB]>Jݽ5KǠ+r@m}P}kȹ1%.&&-j<ub	lhG$-I%O 6:H28FօwfjZel|vV[Ѝ.t\':9\*Nڹ9ƓOutw92(1o^ZzW9Ô߲Na6a͈yފ0ΙTz6s^	l̬UbK)a 
YW1_6KD8~!uU/}!R,N/=SK$(ZJKtęŗ/:p'#G?aj'@(t7sK~wP%I$'%K!>^l,T&n&fDݩ(½Nj>:]"!.$oa\PV*%?yb0P>\_3c^_E2^a6&oV	#^ck{VRYC"q'Am*0e*^+a='UC_eF^6wIN"NMV	fJV
nvT[Z7BlTԵ-pb.Io)Q%z#)Vwg*\%[y5j-t	町]NO"^6Qq)fP4N'?|ଅ{K-e_D(y3LT)mDq[aBb7+BvrNcf~朢UЩuJes^uɩ)Mx_ʉ\*58,n]Y5x$D?//g%;#őz1$=?9mZ$፜S%9 D#F;ʞsܾ(y6NnUos?*}f7Nʦ)7KI,Z֚K4\N<080ƏJ"=xix"\Mv=8lT-#r:]BR>^	}NXr:e+7NT;<_5>t
Px+Du1ק\?Y1+q=gƠ34pp3bzrSŕI7F=袃ή$0Pé~ڐ[hEbSlvogsb[mijzp,Ni|s	P۷0Z)-,gO4t_v|䅪VM6nHXU_Gӂe2;*Ja˵'X6X)^1?=PPjJ,ՙS.:(
i+Κ>@Kմ)f^bY]qY
K>i<3KaRF^<OW%ѹ!Tvs~O#O<¦kwsT*-choDMd0!k1Z1މ	E-3lZ5}Vn)fݴci-ؓLߙ0aDuoMй	8^!ڝScד1wj`rm[bg8͇m2aXF$Bg!\wg?QW
A>|S7k*es80M<e=HB I`VF#<]qNy: 2}P[=93rG &gbsEQ"!{,Ν4ۙGctl[_8G1 x#B,.d}`V81f&7yeX|xZVV3oY0k9 87,YƘXV > L5[A|Hq$Y(44:XLf䴙?'_x4d+;ovӎqN=q,:ɟ<bTB@m#Oņ~c,_m_P7賤U6m΂9%b1A*7H{?*!a| pǗ¶]F[ 'dbAi9:xxpx8"ThAט^35s<=	SaKK9LyN"Sj]sT92>,VJ4Ovÿ|O1Igd	X߽͟7rWL:՛11#KP*r#m³oB|LA<{}Rہ1r).%.5<*UUSq.
Bo)%I#gRuoln{$}5.)2MQ0fI0%bNӬx"YehSX7ԹV(xN驂/23{}Q)HB/JfU<lDG"'|IՂwVQYkLh7TKfTѡhfF70Wg7J_y(-Q]MZ3>G-h7`rcFx&39::JTxK$q8 q@%8uͣՀP;9?o.VC"bՐ(ȓfpK9Clbh1=1.8mQoХV|"w85uStpܭe0P |i>3 lNz~X=+[& l*܆rR[Cv[6mP<G ;1᙭XU-F&3ʞ\_WiK[$f.流Q(q+sVT<덂T.$tsSP(M1KJo{SoVLuהk\ʵ|D
PgWf;G"_r_L&s>CzOcWbgd(x7Gź&V=Eaѽs	riyTFTΧP9we|UO{P}ct?*VYRD4>M93MΑ/p"OGy񐙇j
2U1۞vjjwFHzj'J.%{Cf	[blI)]ܽkn.FvhIpd"U"/"褠S sAlۑ./4`rEڷ#h9>y/PТzpGOsM926NGN}M<f{Lwxxk?Og^a*LP|:!7HIx,1X|ߡ?"eW/ 'a.'CFT^#ybTyF̩VOlrW9~xvF~KST9&>\8tJAXEzNYqg"_N̎?n]}kOo[0
l>㰕$:c[#'p/q]hm
_XA~fZ=M;P/ոޤr=zȱnQrM RM
ΠVv^TțkwzoҰ(M~~oZn3	jLx3 ]^=^Dd~1Q4כhCjceq7a8822CWi#e(NC^[}|5_aj
'k+.3Z.tJv)=GMgw\L* 𰂍rYD睗7,jtfl7BA2JVNMCs,XFNvhJS%BCt~NF9%B`89+UtwAincͻau[,F濛cpݱ]t꧌@ZirWc>kyؗ![ocʰ`C._acԈloGj*}3%
L3wP?p]7USq#:+.܌-@ݷjnAuN܏Rrm-5lP{ouTŪuZ_Z5؆0]
90.y?֧kt@{ڗ8E5
c.( #S# FKw56TpfsS˓z^Lx!õ9~	'ctZ@TsG#75mx
sWKf9ҋ{zyLYͱ%4!{3||/qRf'}Ks\ZҺ1pyeWe'A	l4r?QG
KQry7agV7e%t(T{($ZX=7<\{qu\M!GBaa.Y>*f"ǢUnhW6NHЂq 7b;<l^ÐCbEgﹿ|rcNt8'Wny{ͺzqf 8Z$TmGB"|˼ҷLapilFbzAM 6E:j-xER#ki(Yq<_u[ފe/Gۖ-yZ%>53fL}MN6Nx:fw١}tmӭ\ϫ'xzdWiIؘf` T4~i}J	2N֬0%asM$E;+s,ى._Z@yE,,'kٖe9X?Ɠ
[U1'Z{<B˝TWqU%;G3Fgi5F\>8]En_
hJ^s*sO[?60!_Zr`Ġ
c[L#d<F?D9@#]iJ9&rEh1H;ոd_r:ĭڪZ:iZ7KZmfg"zݩ۝vjvcxPi= $ph51'd;9)G#$e`m8fkZ܏]$u)*hcۭv__ߏ]!:;_|tZoKS_kZj {	`87'yoĥ'ZTJ	KXձ'MU1VZ"a6	Ach4.RiU0]}JRÓ#-?<<$x>b$WC^7^]Hph*
Μ9d~
j-Bv{JRcM]lfiUpmc&Q
K
ˊR`w *`:KLrJNiҲF㼬uXsK!*=GQS+2\ٟ3[]֮7^-Elj^l50kUs;r`P٩$=Cw!l>gL㜧Pv{8/5ف;[MPx'eOۍ{WX_.^-}t.WKGnh0*݀ﷶ(RL:=`);/	"J}h,aȃr: y{<Y2̺٣#D=;E'pV }Z6C]rp6NSmwZk]$<1\bRKnal2`,aIߩΦP[ }Uۑ^D+fu*
7JU;jGO5炤+:wy]2N$'9IeV7RU~J<W}Tǁ?t&,K}
~ؙ㷬ܣ6򆤠ԣQegI|>y89=G
싥Y_*4ib07hש=$T6YYidM"%PH/ݛf'9|[KY+Vsxn{hT)vގrC~HeAf@oUy H NsI*3#*?'q}Rn-F-EhE6.|_{-xSSo󟵵NF֮H_cI4E)lۺP	<5ހ8¯{ϛVR_@t:'1/_axL|W*>Uwh
ms2oNIcJ nG릹TRQZwb݊4OZi}8ۍfja7T(ic?#ЊeA˦0ݗ[{[?nZʺ'&(АFm&~OʴB$J,-cTA,p6V:N+u-9\Z9v^Aw/`z/?gȘݎ^B/2|w:!o8>UAzvF3~ݮAw;؉7wyVs	8jW?%E~ FS5*z͛l㛃î#!K֫?ửj^v'n&ޛ޻(ǏVi(evkdnRKIں<W-(FW(?Qygݥ?F4ozrW_C{S?d܌T--]$շ&QenZ_ .sK6XW[|.Ey
oX{OS@XlԀ?4g
xiGj$Mk:_ ];R8?B{b= V'wBoZgm\"-#5ȳ*UBكexœeBɒ٩ps/$!#еno{?tk_=g|C,>"ڑ6Z&q]\v?]\ZeT&6O}2P_*c|~2Q8Ȍ$K`jüQ'zS<.U͸DbNCa9TO=8m_oSFv'Ů?(4cJWJOKt4]oeZ#j4s4#kTac_[0:VԤv.4Hݷߣ)MArwM}|F_nL]v}"9snEYwjv+zqi5+ lr"Rvg1hφydvE{:o΄hWHXJj0Gݸr')5nco6R:vE>KE7~Ǚ^{! x#2\įPD'ֺxN,ȅcZ%kךU&qj!iDģq$0?*ɫbwII:O06o}ݸt'ك7ۇ?e8ϗRixKıib=9-|^"7:ϓxϪR9Ht:(tH	[pYwiя'C+tlE'.EKVJ `;+SגCx:J;#7
.OO]lY:.eg1Ka:ʬ{/7pl<f;OҮ{
zAD?M$ҚD@<vN0TMV1Eq@ @9tNLMxG?<qU_аoog{zޠSx虇^kNNr$Hp7mvWfcYjf6f^aH+``oj+4w?<%+4W A5jÂb6:TWzĶ5*3VQmtZR!Yscu:^V}b'͵9˯OIz%Vմ6cj;)Ut`r$UtZuhLgmJfIʷ9R!__QjPCD>u*v155k'"EkPtiQ\A^;^Wha *orv^ʉiG?#(SsGr'͍S	5[ Cn*=TZo?In!Osy'PG]XEŅ%!U-Cs9sX@
23]5@8C'5#[3ZjGyE
Qy{rik"A^V䏁T8k[3O(]91GiA<`_c? Q
;ia>F3Θތ?dMB̾(=\),SML7t=:TIbyzTZ.CÚ{>4(0Cf8~F&#qPk1US[73"LghcThdHYUϪ|{b!sRl1Kh̖p~YtK'/ה`.	1V@z/	/wڠvN\*w%PʡqA٪֜Zfenmt*kuq]i<o7*Fڟ$>jL9,&&ޛk+'FXe''=[[+"Eӻ^_1'2(oVA_Wk?n:  YiZzjYZ_oV:M^iXsZ@Ӓkf1h6Z#7܏ԬznX:FѴJf56*ںլA5euZ S]:J	j5*q(Ƨ :[_*X#j1AB(*hW6ֆE͍:\oYfjZzejר+݁2&˯X0]Hށڥ2QQi66@(gPy-i uuP^kFҽN8 "Z%ѨU:_GzXvj@iWPYlb{ Zڀ,
*omXX-6~7h!XV{Κ{ou5c{FB&#~u,
Xб50`lc!kMxo^;D╍V:Ѡ``_G@kufѯhwJM4۬5c}}M¡i#Ev`hk zրD
c@k	;1	9SW7_7NgjDUmY]Qggy>ܰ\֕Y~()k-Q\6>m@I1:i<R-S+vz5S^7?g1'a>=.j^RS$gj\9u'V4)SȖKBj.*#Yt(rk]MTz~sc;<[Z
xPAlAVJo,N\
0S.+Lӡl{<F*}JVMmo<: nRAQwŰ>-ݗMII}~Iu>$YJ>TGw%j'w%ey~I+.?Jjf6/]\,2-#eJ)Yu! sx>Η$"Q+Ff}\\,]$f{^~@YáeZՕ/
I/ǇJ]U|=9_3#;? e5$!HD8(3X!Srzr}@ɘsapqKzt;dn~g=X:5IL|`Xټ{4d+W:ΟY	/n
iwl|񈣆7߼~06?|xt]NgFHgCb8Fa2!"h6Ґމ_PSwyrdWV=̴L'!aw|uSjvI?	I,FK
CS)W$_rƪeLsO3!&͎&3ƽվ)Ee}:K,1PX?%|qqrr!ÏE8u\NdT((/8+6[zS`6V8\z3z)(0Jg2Q*.J5baQo*i{e(Rb]VĮߗĄs
	l:J7p18:HTZ^:M `x>01C!F^/%hx<$͛:SF]nfR?-͹=tv{etW9lK93$ے	w,s;rFcd0~{tFp{mx2Mڭ%Y;3#L`$FơEM@	IkLX+ `B0fUA\h ufU_|)ٍi*=&mݢ~.^ q89{vz1UyS>#m	wPW4#xYnښ+M5\b~u5cVV
r{q iˆ =go#oE2i88@*`.*<W؝%
5賕懕'%MN\jLZPJqƤ2I.QXxq1?+0VJ0}]+͸e%hIu}cגjaiկUDI98Q(; NaVh!u%K.uQLJk,OU@H ~tX$`DcNwa~]5MOTn'gN#3G^uכ7\ۑ{]>̛+=C-6>L=%L$wE>ʦi OG!9Q/مP'c<EL,s1 4`K'dC鳔P	~
Bzadk->3vT:!Lo9@Dɱ.)#N@Q3w؅&Ot.#fxYJτ*y(UqFY\bQ7+ޚF4-z	kOXYHan2vL<w6sS
=$^[A"8&_vXnwo^}>Hro]aБ[/*T[S?a[pzvkfE:2qU0,͛SDjYv%R@B)F(IX+?oMa4e~ ߓn&+̺, *ؒjA-]<^Y uF#P^d	#P<`aUF0j
H)VS$	u-82"r'/:,^_3[J `0V7By/,SHnco*<G}g=IH	My@"Y.i(a
1,g$KT:8Uޘ40,ޟwwz*+SSvϵRY.:SJc.q"W`>^,:w-O2nG*f^D,KL%1*I5!ɡZ0f=rLm#mfl0Y.hBwkUtɱU`Ņρob˙NഉsCu:^Xz	M9g(f_jFaI?>''(:3)q&?v<:^̲@c5Of^g6-ƍ]%R`FepvmX&K5)pz)ԅ㿰RM7y;nFAB|,-Z| yL'UaKOX(DDz3tt㱞6ʤK83
Lt&ZB?	p?pN'aJ<+)s}``@R 2<G5t;ѹ OU./=,KN	39TfZv\-삅s,Ԧ(Kmi, 317ŌZMdViSG.o0g0:7bE}j{+23%ontƣw,ΝXvpZz%T4Y@]&u
?]/DivsE֥ᇊT,쀔mV6;Q=rzcbK3iE: Ȧb!gE+6<d)X8jT&"XJՐes*NjIgFs=T2	_S4!IF3$^juz\}ݔB+ 5F3lh\Ln&$SH+Cf`S7:SVm~ d'au_xHZs'q:xYr+̭Vӯ'	506uhT&B{=$)VzXIQ't]2h0ݾ,`8J@ZtmP_ bB$յiO:JN{̔;duȂK?)fKkkmQ1?x1uR|Čbs;D%H0P6l{|)ܾA ۂIgFc`]	GkChU+7_bI}?/	;Q&r@'*v*lo-qCĕetC~xˠ50\˷Ҕ͜cVNV_)c, 1Yp5ncIN,	
V`'?9x}q	2QCqՉTɂ<ủ~=])znKpb($gPF;K
@ ߇9^Jga̧ҙ38!+El\ddEFG/ t_Q3?j4:N_Av.8_ċ@8ㄥ@͇ƍ$Isn
kXމeARU8]R24(T6uM[áE8LwZ)yN(˩',UЄ3W;,K{s8[F_Ԕ?ee&+MxihW1a P&{0~?w!^IxsAqsLJ_/1>F]+!s^B1*Ht;+hjLE?w_n~wˬHQev@2T(JIfTb(>S&X.`U	.XƶmZy%\y;)9xewA.״!J2TW@g)goRwo'-"S/ƴ5tlN[|_"a^~e`w{ۻwpkk/w>'u"*槚Vp:'(nstG'g/d˙9+Ū~nhT	yТ0jnEQdom"vIȀvD'ȓ%55ĝPk$,{*$<>usK;F-e\m&fڛV۩"G=AFhI@7JtPat4\ˤpE\!;A#&Sؓ̑ze,LaJꞘ4ծ؋e6Bqa6ܺH7MϜs#ss$v9my?L}i4*53͇? [EE5ԌXRnYt^E6ʕT
\Gy"Gh!!\S`	U'q1ƞaтs"QAtRKjlSq"kd䆤_*?>]煆Vךw/W vYZ_1t4G{6?O)[Ҥ(,d-k#j*ک_ߝW}q:Nu<]x=Sկҍ%7:A`&yvmZcxbҜBn	5::o~K	^{NdW$L\.M'X*Y[/~Vnz|A%Rp}6inR9#1V)gUH!JeYO*}$*\C=T"_: D'0@
Ikt\~Dcsq}S h`[VwiY-11a 	h|N89r_FQG\&	_ޱ34*4*YNM?$-zآqcc$ԯ@8t"M."QℼCѩ*ؾ,-_&	_rLd<U@Co2FtrzSa^E7Jhr3rfjKr
(hLTCjְBR*'3W@msi|?!όFz@e
H;(y3yZ}zV)Q=ч&֊(6ucu/;V&#xsGAVn?=6{Lwɼgrzn{jǧh#A@@rq -ɚ?BMPzVqʨM)w~vsZQl@ 1܇Ao,t-򉜃Dmzm=tw1%9'c$6k0Qǁ9kh`3ҳŸdbicՌ'R^\XеKIttѡĢ@b)A.X
4%_Eyaƾ~*oA]cN2\hB'n<[%^G۲Qyvq^_zMfZK˦ubŜ7K>_VaVa>lxCK x 