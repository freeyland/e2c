#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 m] rH(8ɔ=y)XUiݚzFd V& IDsalk__@@fUMTK\<<<<<<<qsP{NoKf5ZnvVo4Z`](vB 8tn>d%v$礁9tڝVi..a0Z]o7_NE~~w(8QX?־wrꍆG.fv_k_| ywZ_K^4qKߏN|X=}ɥ_EYwy?`ʆsǏ ,t!Q0:#`A.=`}N8#vczaXjXcz{,^|wƮ,6>f!NFL]oݦmC@78%$z -A8p k N]~tƓh&T	gA0Z}Csa/{5JVk4xn_q0bFZ64=vxǏË7w8T3*޹iK6rXes^76 A1T~naBEȎG?7co{/ȼNbY/؃0܋\IAqWtw箌:Jslw}Ns?z9ҒwcYO@Qp0ZiNfrXo5i58GЛlqv;i7dߐEt4d~;WT`}GыYc[Z!`gN{is$jc7+Ҷj6;rD<]{t5ۥۦ-ۤ[C1g^ ١";TdvbE6&ӤbTLɵ;tx5E٢"[TdlTN .TfDIzl>Q$4S^eyur>V;HdhVb1,+)kꎶg]?`j-a}cVRüT0H0j06{Zg5:?4=/wy3~AIpy)_d]q4gT$UFS($r\}`a
W5'Iy%yuЌƬ	6H~U+8d}%Gn.INʿ4诰*~ni[G_V*a&{ē!K8	={ǝݝWݗ;h7w?ҨSo^A=,CAis瞟4A*>á5"4ɉLi6&;yLͻM"qY,=cx[9끼ht6Aڢy=hje^nO,ܿ8@$b.XKN ;qsGfr Wӑ|l!wlq	R5y8C^N0geo
U*Q+Q]w^RU0ns_[I{qh~?6Do#\/WWQ4sr!|iȡE0t.2S*.kqz1$`^_TaPv%j }"E{OM@%@gEE	R٧& Sz9Ls6GXTBBһF=Gnn7,CrBll Y$6Sf|Op9Iθ;/vwܬo68 	6s"L˂BpMhLܞiCWgPwFIUsw329XkֈNo,T *AprR,>{rkU˝ʞrj+$p.Taqd/_FTC7&\ePEdD>}#ND^sO?ad'	z1`-3n4#S	@Haj+˟JjY#NU#ɰ콿:㊖tu.{kT׬ΪՄS)@^VEdq
Mzs	`
R!6Z48:bʾҌ	sB9؀
;)򒓾zy1r_uoIycA~}ϳ
x㛂eVN9Ͼ/lֳgg
3W筽W?*dGEi|sfHUOE-݃*)ƍA:  EOrK8\5CԼ(Ŝ.?SneD*Zx̙I|_y8 tRadP7kB5C_S$9f1܂qt|X7Ҁ9O4!?-=`1PYFƨ[@'p̈Jf6<Rbj|ʸ-V+Q_-%oh</l1wz0DW*09}y&,|٢yqT&F7Y:HgK9 wt*BUTBɭie93Ӌ=M4ɦxO![տ<:~kGgx;C$C&f(\$(gy]*Y#9C_eQ.?){=/0RI5Ʈ_LhdM%DG&εQWbvX%W>C(}@'S`d@޼bm:7;v`el%=yjg{5OCJKfXifs+^Xt&o1<O,s"PK1dKYINEulqJ=E`OTa]Y-XbknߴB.H,@
*\l;> ]3 F܏=+T2o2ͯmHv%Svr(fDqu2E҂$&hؐrfgj4S"8<WQ}ǯ_~_WE;;Kf?UL%$ӄ2E֔Y"ۡĒKCS@QT BLOM7crixR	{)]$5m^[	Od.{w?loE
P5`2,kL$'Llj1WZY>nZʦց|fqJ{W,"w#@0b` `/)eE8RE[މb޳wYLۢ%	/	~%ĕ_[YIl/%pI4%M`QHzXXW13s69Q[ۏ?"(W]l?7z5r*[Њ}tQk\:8@0TLZeŇm$4iLys,(2O}4OwFI
c	rٔ18_)lP䆰 qbt".1C@MkH'IoIK6 ^ʐsD07I^c`@)P/B^	///~/S@r8p*ŴQ!CىE^?=72U:7_3+ty҉bL$4-m \fJlPdl7Iut7nWHӚkfMsN]vE\O~XT.`}uvWgJ3U92xŦ$mƩ%a%oT3V
)j.[LSu?;?Obj,@,<uMI;Iۮ؏NIf%d,08.Ve0XD%{ekx"0}e64(UCj>273Oؽ+trBsLVb<y|$VX@n$*j~0")Üqʾuc'ubNZVshAs>5zy]Kzk`2]w2-zX,)}.P̀6nTfQJr@ddJ1v+WWfz{4\',S
x.WUɏF=7XO|mq'yπj*VYD>ٻϮ޼#:%>)'*2Ւ~V7+e7komOdm]Eo}l@r"KjJTab''V*=%ъC_^laMö؀cohs5G,iܼmt\͒"	(DNۼ%01vd:OȶGpG#v촤EPgd.iZƥ#?é7h?nl*ܹ4Qn|yuO!< 2HFٹ7l0,ƣ&|Otb$C/"|_@%y(Y%~A>nEz\;44ޡ+t~{TQv+|+"nɝ>A+L&X"
TV$82SLRLJ3Tٷi6a2K03gEK2tAB+f[ɖrȉVN>rhlE}Xnҗ,4tX2d2,GW+D)IRm4nSvraڙd7gahhE/4es&f&D@k6bWΨUUu&+@pEA]zN	Bq0dUVKb'Ѭդ,;Z:uSԹ?ӿбVXع_3+y~ftA{w*NM}e	YKqF2b9(},eX?2ܡ74UrNrZm P:q8tjy \C7IAfiނr˸ßMʌ&VLFGbVtt*'Aɣ(.'|a7`E"#I1y_Kzd"tДUTi=2^e(wr7ȯ@qf-I=אjP`QeVk~EP/(,75n=Ȓ SRi8Պ	 h60·xeʟ<-NEn6yDO;_"j~Z/FԓEBvFv>8rc/Gci$oN]r:K>rm)siVƙX9ʑH2L~y"<*&z6XZ_N'\#|T:5fk[8RIsLgcy9DD),!mԘSnKPnU	b[B0aJ	$WTy{юI=΍r9byAZmtIֆAyDkɅK|
HGw	-$IKLI#TP$Jb$B$
4\'J	*:,l팶?@ \DY*~,<`7+wr: ؽ/=te jgj]E0MIs6pk	o9$Q{8s^)UuZ"EEy13~zڙRx<v%[ʷ'ML^U~ݟۖ!&4g5XLiE804h0!FY3ښa$q}&uLRxNx&B6'A=!ĠҥI(*8H~F߼BP,Lp{t[z 9oJxXl%El?0\e`ץ0/V8`R#%$oAraL檖ä QX1	eRBÂ1Hz{IMȎT$Ң.<yUڄV8u"Ņ+⒏X,;G "n,4iͧ7洓q,1)MhZR 1ޗ92'V!tCx)-΀0_Ibyâ"<cOO n$*;QqRnyE#l)ZP@hsSa`,`[J	A8F*(a?\$Lp&"rk 13bot;9G(Yen'@x̦A :>
L	$?*rQ"M'3LIvM|`g&SvLS^n^gcy)B"JAv\R
Prgÿِh8zY!rMTyϩw0f,H~(S:Z)\F(tZàTX+uޥGu?M?\fb$z4:EXڈ!_,lǝ¤JM%bDXeBKڒd-nKJBneحt	^5ʛi˛iʛ1!>Zd%YAV/~M%u	|]_%u	|]_u["+u*d|D@+c9i]##H[H֓䮛ܵVr,,?IR B3)LL
hH4ԓ$usu
w.?'NqdZ8,1n'Y0B'o2$eYbhGsLRJ*)5GZ>B+LSʗQZQc4s#ȅwK^ďnQ^mfnΨS'g|Lh2h2F+}MMTG DM3Kmt]댉W.*pCC*	8 2ݳL9*eʰ$PBd*
yJoL:q5\ V/6.M7h?)EѸE\*mW&Xe+*Þ3z!]^	d1H~|aX:
ա]";T+$WY[B#TYY5lf"^iZc0B|#!y|}█W%77"\)ܓ-]_lE_ΰt6<_p3{J9@;+nEW6MHBY^jO"m{OTi1`T)ѻٴ$.so9e4$Au#zH#$ބ<4eZQxUZ@<~e,BƼ	Id47"0sH͐u#fz0*/_T
C6G6zkO6~&.e=PE3&5щoC
ڛc)DPpqnư*y$w7"e[H+x/s~w3[X#I\$ţ O˫.ڍ_4}2"hqWuF?􏥑FϮ:cԼs2q}82o|]#!Ei-qJqn;	~2*S5bAk°t>S4wL{~ 4ɼVni@Alh]cK$n2#Qʦ{HrUWP<39'%`rzRݛ[ݥՕ~5X5p4tC?||cB<ؘ_Ϋ240qnS^NLaӏʽ@Ovʲ|0N$'Y7:t8. (|`1[0m$33JѼ77TvBjEQB\'#%P{` -ơyiE8Mo+F&5wijEka(*,囬if4\:-|-SԦ-D d`@UowaF˕KQƦPbhfPtt[f* jպc.˸dȥW0w'Xl633nO1e;KrY.nX·ьzcVe;{+QeRl`'8wv9L#%w.Eˢy#	R}ʈ.kypʪu:=0s1ky1KVZZb3	XP {ິcs+ bQM~t^S89a^T{2ՔN
oױ1n\G2㞘I{'{W1BuIɯ?WdAu%f7x\x]O>עos[7hދḒGt09|Sm(~MEW6}XXH0@Krg4FM@E`Ͱ%!Uyѝ2P-ÎFO'ư;rAw{~8>;pS'U18?$1a9z@]ȄEs0Y+/+QTٙra"=^Z⛲щf|fe&Y,fYd[zґex:t +4-(jZd<5Ӽn}G8tzlUqqP)ήbdbg 77\di02\8Y׫$^L]W[4 fk)Ʌ5?X\IEƪk^msVtjh{:&Cǡ^ mjImImwej,@6	9'X{Nf-v rٝ9jyj2Ty1|s~T~6$,jSW5g2 wrIh)bxd^SQQ6*^g[[o\\;{9&N0?{fΉ:w,g skFq\|wodcnܣE; l
wV},̳+h  v `w'SV%ǋ[/
F-%۽W?3j/w wvC/v^#"DJk&CǏԅ5oiFT@vY]("gFfӝ@
lfۇֳ 8uG`NuDY*dz4W?|(E!D;p~̅O7.p[/Up9]}zjP8y;1\2\	!
";
08.ELѡb 
Lk7$wTk1gƚvs}1;prHK6߀C&ud/		RG#STY{`#*З.a)ތn,x.$lq>-in˙U ,cɍްrV7q	c5msA8=5}Z:ZhZ,Q٦:wB7(箯aa4,U9Qc,&'0 _O~~rTo52?W*:@y.4(ɷ?r	]c4[͵#7GlSrǈڋcߨ(479zP$z,TW {ks]G.ø>ޢ@C-5:HT|p632!N.7*⚦Tz>GQ'*(akL޸養8=@8yVK'm-Xu\ƛ)P$#F=E*[]#֨YiΪ6-){iAcMՅS\UIgzTIU-*W[HgpK&WO`[F	ӘYX%ZM35V<2o()-7`sxts9H:BMTm)QhfWqs?&c$n<Y5⼞^dML\M(%F2hUVe/7)+/pWbR~]Z1ڬe
\qȳ-]*{Tyl%ia/g!2ZS5Q=gz2ٞ&Qc	m8G2UrzK$cP\[Ϛǧ@a7OoqK5Yc6㐙)5Iddpc	?{9,c}U4![c.tr-UrRWJf4UgMPu^nlSß!9c;þc?-pRb;ep~=!nZ)
g\	!%1.I"(ndRLUm  r\tTD?M
(-+S8^X-x"= UQJ(KZ,RǼK)1[5$Kx")}
<UsqR
i2v.=HjT=B4Ϲɚz)_jk91pgԼo'4Wrвe3bfrT@͍.<>~J!FAPTc=OpcĲ5lKj.xlEe}̱'-{-3Ɂ"AG3qRWKu
\ ]H%	ЭFE?v8ar	\PN`\L;Wd	C`;:D4Wɡ30sF[Yq>ҸApu>@?.v7a¯,D9xb WII؍p,@$i.@cRg>uѥeW ?:;|<Wd'F4].9-:IPMD,2rC3XޣXjўQ|V\KԦR<j +&1e!nA-j:q<4R N+M$Cɢjv'jT*za4G%	ӗPCˣcy$^8t'ãK/Ԙe.%+6H$<4ëcR^&aԌbe1F-5-z#uڞkT;)Bo$~_CӇfa>>C*w:ӗjZi%\eۂN0Y.aWas4p}zC(V,uLS[Wua	3A#W0 >O|V<J[j|E~q9WHNITIDw,@jj@ݻb3bL'7}5o;Ռ&72粥ϟߊm+Tӓy\2^̓unv3Ky)x5EXM̪뎹q[xXw/̭rsJ56)$j:9k/>{I8(ܧôvkԱBiυQ+30!.B~Ystr^-J}C`|޹Qȵź0oZ&8ozI=gf^Mhټަ5t(s`/]ey~ l!>6PphcF`eMMZTxfBERيюHZK	 ueq2\'TtX,C7')*(p]ܪcrΗpwc@/8S>mԥȠļy1hUY^42J:F19rG=4#imagƙv5s\	l¬ET+a 
yg1_1KE8~!sT/{PmY*Rs0}b&(Ȇd_b|&9AR&[ꎦwKY|i(Ӏ`4*VB Ĩ~S?*I"8i/Y`e	dd6q2)6C T/@]u2i&	V Q~m-z JUq'['{ÛW0Ɨhw'jYژJTKk$7_sl\ԻxVq8aSY)KPqXjxX;wJr>x9`8v6ZJ&4$ׂs2vB2djMw+ku_	RRv+aN}CQ 
(QTǨq2z+>ufsk!j-tǔ\"<^5|Wq)FP4YNoO9`8#zY_[h,Xgxot3fiWKl!	 8-Vv6AHfrY^T>Bg)E%㦠ĒN/
04y)7vrBGǣL4
B~;taZ4(CKܺ,2kɠI~QM2ooo'gM˒#u$hhgMs!QeƵn|ZūTm>IY4kRie˙$Ҵ-3(`g$l7{ub<#}e(΂)kӣ]_ۧarNO9PAg,!_D>{%,fv*U󎛿AKe#:~(<:y1S,ubsc[mظx@=o
)Jr~qA$0HPî~֐[?hEbSlVo7\dsbk-*zxTP[hoat:fr\j.<&@uh}gX7`2#X>}5U]XjW U`T}9'FL&d↫(qD1.`U{doՊ*RSTV=˫kfTCFZqsysݲ=\h~)q5Z^@)k(2+QUU'͑gr(2Lȋabt}:}>:x޿!*GҮҒYL&CؔgBu9"e5"S͐F8D+Vbfgb"t/BkXXVLDžY+Gn4Gy>\@L0:܄YvQ|)ؑ؍l;IF5IG7-26DpO#!3+Y~ɳF)˷ ?>xS/o*es$:0L|e=;KJ I`VF#<=qNyٮ }P[=|3rO gdsEј"!{,,YD/bt[_8G	 6||!6O@6Y8zjeY~iBMjAV$_?ZUn[V
[ sާ19B<ք5`$)H BpV/$T|-R\$87IV 
M?E=Ӥ.9mwgj|6-u5xNo`z;=6Ne{'QWxW`7hdMhB`$FNyr6M$*F8/"t#<tSP="_~Ad@rBV !L,9kÃ'6Hӈ.<#i$^M~kj<7ͧ0D9FFk:8\̑!v%`(Ddg0+tnNVs0S9MZJiPBz +AA8fWd)JEӿ@tz@/!ϟk90["rW=cBփ֥c%^q0dG]S57,: o0'sRsol.k$}5*)rMQ0fq0%bӼx๢yehCX7ԹV(x陂/u2s{uRQW0IB+.LGe2/hD"%ܤi{V20J=|W	,	Eovkt(* (rR6xBHTa&t~?Fokf~i-i c >v#:˙Gv]F
JZyuT8:\j@mP8毯Ո.VCmh5Īk5_P!Q*R'שᨗ/lbt"-	{`\&
pb9@GiD$,4pCk> W/Iϧat4b؆X-{VL@sL`F;
ۤE@rgbSG!**[MFKgz9\f-meX˺ВFY(wrc[|eƷR'
Ӄ3R	;,љ	0Ca4__0,+OB4[Cws^W[cRhHí'oxe6_!?>M~F_jEͯj9Qa%1\]o+uͻMލZ>9[-sg0xsDϠr0ΰd$H**VSD4>3HLΑ/p5"GyIj2E1Ӟv6twFHz
j7N{dCf	[1Vq䁤57?!G82*@tR)6vC˃{,u)\ N,XZ̈́-奬-K4i*d͞\XsDrpӑ; iS߇nc<{:OVRRO'q)쎘mw֙㍈t@
?Oßc)u&W<GxXIb^ N0\><O`@O}c';Qy)Q``f1;"3V;PT^QQ.MR9pLxqL1q+a[p͊SigXwNq+u(ޚFq@u)7OIGgP4T?J#jDI֑FbTbICScl滋O(#ǎz<~'G14+5@@m|ΠVڷȓk;1yzHdaQ=oZ|9o3	jL;x2 I\^=^Ddz:1QŜ'4ϟjAjj/#<%NQ/e9ټ*1CSj#e(JC_[yb5aJ_$k3..2Z,lJ7);CM\gw\j*$ 
kJ,.J߇D&x|V5z{}>[j a f!LJy=gLN74!Da6='`	!1Uj{; 4#omo-cIP|vIVkq݉E=t@V˞krc>vx:[ovʰ`C*_acLlo{7j%&hl{;@IBt?t._*˩8kGJ|j
if%S އ~^JR7ڪ+bѺwN/ʊPr_,CAD!tCDYJD53JJb/+nAz
c>P0@ƞF/,
2l]k4`?'KBkcSNjgj,L_$1l`]^2ˑ^tW{O;URG\mm<(ɔD$fЄ}꼉s5Fj	4裤]x[ Ғ\xOPכ\/<y]i}A.#5Ġ,/HVfFs=].PAyXQA B[W\wR(
j&p,X^嶈tUs,D2qFag{`{H,4|WONcȍ]Wz[#x'YW/6_T7_%6r	iџH w`7tK nwcOȧ_ӝ	HG%_?~_XjdVCt|;\|S;nYϗ -6A]$bzYӑⶥEKb^VɅ;{93rߢ-Aӝ!}2ʹz&Fhvh =A'A0t{lyY\j>;=8ln	5"r_|O< yAk/I5z1EICXj"BIQʔg	+ Kv:k:sCQִ,{d[YL4TiMykOub\h)/N\0Dxfv:;ƈ'+xM@3-@\)JWPpYecYfm"+*bYNyl<UHJDC[ dj62ȓ6{<DX`r,gd~?+)CAAͪ"Vp}VZۯ^u:~]7W\tNSz\k>(ke 8tht $;>.)G#\JK˭1gZ{{wq2v:NXk]\ B=ۅď4s֬oQ/-=x~z E0e?#:F:E=b?ÊE;T C}aN~bVQ48;ByHQbO/:`V 5\7x:T[R6Kgz3teNfu|^%RX	;bD[X-jHI.u6&@:8V9vB)E/ /fK-i|1)J ߸`Oa9ʪjt_R	x¨/:uű`cFR<.Oz^Vh>zcY[z@t$ʧizRɔy
%wFZ\>x:fFg.X4>]:w5Iqubwbfgqz`|EC_m<~ko,,DHin%YDIٚ?,yPADZ9n\dY)ㅜ8H^
 ?w"<wsd}i +SǌmI@n{~7\7TF|C=؟S CQz)>gh3u4A>w+r@{I")ߞIw9"pg82dv֨#7~cV+qy6r[4cAzCc&>'dCL'c(-b7t,BƯ^>GI4T_ =۩M`8DטУ=ؙћ½V;򚤠uvعNxq8{z{2O1	":Kw5Lnn~`O?7z%6Yew*KK2&*iS%Bŗr3$x.(jD#DcI7F	;RN)0#ep󰬿C`x9n&njw?wrmqMYn*B9ps޴n>n2bCzl_7Xe&CԇF$`xx(KⰔ]7ӄ-/a@$ޏMs3)ܢ&R7|9H3fvޏJcZ9B>1hbk`w{gkoMkk|b1yA?h)9B)TBо{
jܕ0nYf?=z|f.-[^B{/zpw(?ُȘ۳|ځj_ya~w2v8SAfk^=V;=ׇov^m{,yyr_^	SWy')^MhLׯiҦӛz7L*Yϻ{o^Sjo{d;vv_J?C=y75z}Qۃ{V*eӲy?}/Sk|Q҆]+Kʻf~_Ј`o5EvlvboN?AHZ&Aɒy)At OA0qwe"u*SlV|Y޼LQw)LT~Q~ړ5߂j6wml 7;fXXQi-M~FMj`P(gv	WN(Lǲ)8$/F~cZg@nKuwҏKGLG$dۭ<Ϝ=$^syƹ>o~||,fQ0<ZD/
܏s.&YDjIwrlK\Oc{~TgG;y
tqP9#M+Hח&%kn0ţ?Z-KD% wC	K/=%]]3?qt&rɬz^b%3j4g{J͙JOK:L?j)޺wqK}%|eHC&2YͶܵu#Cd5]Me8*5p=&涙?txYkiu]\e_vk^}\$dŊVBoZ-CJ|m5Ѱ=̔i-_|/S-riwp4ɕv[co52_ν'Y!\z;tϓNÝ@i|l̀<1֮YPҩ7_Y4&ʹU*bTן?vcܗSLf㿁>2iޟW^ofa?]z? H'W.>dƎۃzE|x>M=7JF ʙ瞣U!$^ƧEyqFV5*n4=
6BqG/gKeO~ A;%{*>{qx[e~do`Q|!Q0P^Pu쌽&~MM>#d1v?띀>p#}p=8>Nt467c)Swl<NA0;?cS_qsxlYf5ké띜Ʀ/$>zfmodb}1GE-:;yq<zuknQowo֐9-;OjM٘x!| Q|ځ"&co4|l5;Ng0X$z~otXbkRZQcִ,^K :vl1+YOZk_&J.kt:M*i}mV	miht3Ha]ޘڌs$d)CbShסV|f?67ڥErjj6֎5D"6֠hZF~FA$!wj~\ʁı38%ͬ(CsGr'Mdx:<kN!FdMTViEcg421sz)[/+ynRxwsyg4HE{#͹ۃ)!SMCCwp)wgX	A2yL&&y 1-f_i. <b֐QK}4;T /+&@*eĹ'So-DhF#|I E YzQ(nЛB4׳0}	L _&Yݐq!F_:>p!tv+&TykC&40?=*|d!aF;MW l?#8;eҘ5q;r0AQ4Rr&'5Yzr(To8*4t{J
Jk*0iW+P|<c!wVLT	+YH]]q\?y(.5U^6,Ynkv{k5č\'OyllfL$~L9$^5V.u)'FXe#/[[AJ,mHgQfןhLJ[v%#h Zv5vfA[kAew[l4Xk]@ۖO5F k^w}czn5fi@-{e:vf57n}jաUMm!snn#X|5xZ'(lc-!@ֶa!\6FE@nVˮ[VaoX:5o9ȳh1h-dv,B-Keln57@(wPx=y6HQΆ\a!atoG@5YkYͺ]:nvvk56:v{5hׁ۱[PXC4EнX@VrOa٥leӁQ蠟ulC?vEjyLc۝k5Յ:M-k-G<u!/n
Xа5h0`lc)|@]"q{݆F4ouX<ymj5u.Taw:DzvM)K]^(Zv4ցVb	5SW7_00'l2EᴡⓣZ<OIPj.JP<|>\ITfMmPA<=_FA-#i.>(tKp]4F{[s>LIk`:2Z'n|::jb^ \|n=zC
&BH{R2
yҺE?G6Tvi+#':]Z
yL>]d?7W/lEIwWիj.(8rF}n"/s?%)	ࢶ?=\]z'؃7ɩ~/)oWG>	f@}߇]m-7o9e}qN+9y-rc^!oJIu!$qx>Ζ$'AM+eL$M<$f{^F#ם0Xʢ|Mz+_C?_?~j?{.)_3#;? %98%XZ=? 1&s2rj^*lôϏy1o4yt8IC%$=<Zfifyo	&ot8>u80R>m͘ʄeN&~AQg:(_<w_$3^U	<TS&	y`WAq#oZwY=8(*|s>2+QgVeMGы{M-UTy%*Սai9Ech)'LN'lEj%ժ>pb (̈tuܿBn$;ܳ\˜41e:mFLN= S8T٨T
E"ۋ$K#2#yfރ*~&o'KofY/%0\]]i@ Y:*UES}2*<e;7Y**?U|y.'&SPN`aſTU57GTqGA*Ɛ% CH
1Oj)%@(KE el&iЙ07rr+[nk_Μ7tb(c|߇[f)H{*'mGq<ݒ	w<c;vd8콼O,n.Ia/!-{exR2MګX'3wEx)ݫr2%Q$11cIfF HiVYrV	,U)"F7o2-jwE_	 Ǯ˞Ҍhd'bP/)zz>qc2sPcj/+,ZseD֯e?zĪJFN{$mW 1F]=utnRFA2?MB&S=EUS!n|?ɀ9QH킴	]I*;Θ5T"5
/x!)gb&fk9d}xF7L+z)ig&6AVJ@$$AM29)R@䎒2eY0t.Xhfx>gfVU3%FzG+bn<}VOatGo早Q,~pMpJr}0,Sy'Kdyȵ{Gȃ`V{ыJRXCZbSoj0 Y=Mj`086';w fte;}v=M?E04>J	9dp+kh]&MVBԉ`}"zHIqJ= Ν0ys|-e)T+$sR}&TFJ1ʒnuhDӂvZnso5G3g@8`Co$"A eac^=؉w5W_&%B5cflae7/vv^1+.!y
n)'ڠ_"P͚c̑j0@ɰL2<\[[kȦWmoz|춷l/b߬͌)(P0%۲Y=@ nUd+E@Q0vY C&0Umr҄FP(wWeZeM y@[x$I(mo1ųa[>xQ2.	uA/J5_
2=Jڰ[w6R䍌$.ωr8 D3Q*ICP~yY_ce#UI@f4h]dIx15q81+0l-r߁_'fIx
7R#ߩLW7D#%UWWYuW馌Z 90൳V=r\/mjl8Z.hBk5tɱeXL@gd\;p@ֹ:UJINK|-[@,w&ݐ3bME}|/3wXΰMD]xcc=gt8PSI#>N\?f9nt2A0d7sx3YTCwi)0M2\++:uGCyNFp#y~u/R{KjvjۯPe@r88dc?aŝ	(]g2)R錂3]ǅL;:.c+I.9áE;Bp[^!6k׬;
Gbp<UۿؽZԱx}4+:{={4JӿMp,DڴEf3ܳaq,o9V/s:]+=W{x%{;bCj0*s3#owڽw7ΝX޴sZ9T4y@]^
 ~/DnsE֥љh/|TmV>9Bg
/zEjTҀh6y M`=F&dY!X-fmT`~T'\xp1I9:3d)UC);%џOϟPD'|Un@1aBz%jE	v]
QVG/E«1p1d[Pd3 %'Otz
OY	B`Fap#i8zd>}g<;}+̵V	5ŝo82:6kT&oՍH
>zMA+L.k	lN_=12mn;C@ł`땄IumZB+Й0)lw#Y<RLYGZG}$[Tu:g̡8z0pL&_1Qs{:-0>{;/AC`^јe zWݷ6;J@9/{ITU#IcW`N´2r$<Bm%(_8^7oԦfo	̣Ў|[!M99adşUr6W*Qm>2J,%z?hX<S(uzU'ES%	>пb;l[gh-ܡ2C<) D Zx!W؛g>N g)]!40-b63:WrBjyjm[CQdzIF~htz3p	K/ƝŷLwH2>g
ʜ@'z1&5Hq$TiPlCq*RwyP蛧:LWPyg."7vXp䍾)}N.Qkd%4ΧᆽQ^ń@y9%K`?t2OK.][>.eI8KrLwr^
Зd|9FyIK\\@sp&SL
[fEz. {eqn$B
EE ɬqJl-T
a4ΔjMW	,W6-͜.Z_VQ͜ `kZ&OE+	Ƴ+g+?Mߤގ/s_4݊O6LY?Ĺ4:ݎŅQ~x?nb3:w.gWr?F1?ko7yn٩zcۼwrsu9\-4	l98gD7Z<p!(ZT`@]z٭,!lM.9YN+	ЮwY(cD2y2g^SC	Fr&q7zZ"\Ub%ݏ_<')wz}35׾ۭN39h}	2ƣM2~Qf㆒Ng FYi^~ R3VǾ6+gfa2TR$Z,˴E$56&4,?C[#Y$IeLi(|Rnloyfnr
*Q4`VZP78o!Y?E\B>"L((1vZm:3:Q`-8Q&>hoq,+TTH0RW:YrCQǜ_xu.l[;3knz_\\cz{}	$'?HmߗYhOiGE%<2y*dKK̙/^psiHoiK#w~eǿr1;N+mkNw'V?	7.}T^ܺDhx;ֶa+n9tq0F	briwwl9];ѓutO;52^z	,L/+Y)n02RSn3 d	oz32ªܖinpazKm\,>j1 ;` 3"\\0XӔeC\Z6yn՝g:BVKS0i(0jUY;\甮(;!#NY(38Ok0HkGf=~[Aul9&T* TmgP$Wuk@>2;;9w+EļZ U&Aq+$NuXxO
꥙gwU |Za eghE>nQrkyF#j֨;uP۞m콓/Qj_GSUш`oY]1|YUR(F|WB=5}kh-"UeŲ'6Pyz hb/p%;c&rBѼ1 	&2}(z,#1p616/Nc@hoMa-F_y62#C}r<[F!fd|	A9OOK`\{pagGUXCP0R8Gg4TgHǊuՌx3-$h)m@B_WHj갂X4(t	~ARy)#WDy*S$?x-0dC*_]_{:|o<s+X(Fqx_VGlyy8L/?;;^%sd嗬Ě93o^??_o6i6M j p 