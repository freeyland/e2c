#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8Pd=y)XUiݚzFd V& IDsalk__@@fUMTK\<<<<<<<qsP{NoKf5ZnvVo4Z`](vB 8tn>d%v$礁9tڝVi..a0Z]o7_NE~~w(8QX?־wrꍆG.fv_k_| ywZ_K^4qKߏN|X=}ɥ_EYwy?`ʆsǏ ,t!Q0:#`A.=d}N8#vczaXjXcz{,^|wƮ,6>f!NFL]oݦmC@78%$z -A8p k N]~tƓh&T	gA0Z}Csa/{5JVk4xn_q0bFZ64=vxǏË7w8T3*޹iK6rXes^76 A1T~naBEȎG?7co{/ȼNbY/؃0܋\IAqWtw箌:JsXKnսzvti;_' (8rF}WM4d\V9ZߴAMpvas8LaoȢ`:2?LcX~bX:&+dؙ^tɶZ
FM펜(-O^<]{voo6o+PEv١"9*XM*I4&ӄbr#/6Emd-EE٢"[BkK;Y.qG2[OT#Dl0CWY^%0Z:fe%eMѶ]L%=oe+5KLΚm{Vk>Ck|7 g@G(p}@E_eto{z!;?B"Ug;	~ `z_}w_Zl̚`Sw-]H)H^r쒝Ns
{Iv&Xiu5aVIjy2d]'Ag~rۃ^^Wm~Nǃ7Z5b>:1^Ѽ}eh}?8mF>LZ0Sg8t!bPd&9I2d{[;w}y7I0.˂go+#b=mF1\[4M,k퉅(DLk	ԣWc'U>}`Wn|j:ϑ"-._]Uf}4{ҩ yCy|-7A⃼?\a*]cZ^%s4KT
WVuw/uk=<i/Oƕ]Օqn<}&Ɯ\(_rf}'ԅ9|DqLw<0/S0D(}Xd5>Vw߽'& Т"SةijĉOj,M!!Q]Ra}Uׂnn7,CrBll Y$6Sf|Op9Iθ;/vwܬo68 	6s"L˂BpMhLܞiCWgPwFIUsw329XkֈNo,T *AprR,>{rkU˝ʞrj+$p.Taqd/_FTC7&\ePEdD>}#ND^sO?ad'	z1`-3n4#S	@Haj+˟$J
*ʑdX_ƇqEKV=5kTWΪՄS)@^VEdq
Mzs	`
R!6Z48:bʾҌ	sB9؀
;)򒓾zy1r_uoIycA~}ϳ
x㛂eVN9Ͼ/lֳgg
3W筽W?*dGEi|sfHUOE-݃*)ƍA:  EOrK8\5CԼ(Ŝ.?SneD*Zx̙I:p nZkX3Hys4b6<osLG#3>s!iTC~[zt©cß %ЍQ %N;wCNڕ
lx*̭+ժq[֩;,'WVã>ZJ26x8^$c\NEsaP~U5`sEL,YY-E)sY	,Mlnt.jr|}A6UNK[r2g;{iMfk^=Cyup%wH7L>2?QNGA/iIK1fQ!wT4F/s*,,\"
wS.{^` ,k]+	R;՛,/K୏L!'kbJ|ԇBQ*#ǁN>Ȭy֫ztOov֋p*rJT{|;QG>+%k,̰IWLުcLCyXDmcȖ\Kóݓ#VBMلRȹ{T4tqoºfV[6Z%40XԿiZ]:ݑYtU!LQv|3@ng@{@WddDmHv%Svr(fDqu2E҂$&hؐrfgj4S"8<WQՏ_jjɯvD1v>)=JH	e )D2C׉%Z]J-T#B/So! n`f3SBHj~ ?8L\XkeYHHOؤbVi$}ZݴMaiR㴕XEF`Ĝ ^R~p*żgxޫEJ>^^b7Y)J+ȷ0Ɠ^Jl/iSK* b1f@9Ams~EP7VvIdojTָuqsa~ũʊr	IiT-*Ә
XQ&0ehFy)cfq9Si	aYIE]bPq0*[NޒbI7m 
!).$.a$oT	SN^f^-,_
_
_
^؝L{ˍiЪ*Fe':yk0DʨVi~ͬT5K'Ҋ2дVps(19C5ݤ&1f%ݸ]E#MkVpSjvQFھ6-&;5tىq=)cQ-]ɞA+T^f&ǒ쒶}bZPyX+t*_7n1ML<uq]4'$	nzb?:N'HX8ʓPHD*&[`i(ªfՊV4`hT`*>	7v[bx-b/ȕ
=2u3Yc;vZ;@cm~ G2%*¼Ɗs)Ա~! B;kYiϙ[Y=W/MXf=wR,{i5wɴ {a.PVL@6rV۸ePDRGE"+mXl*ح\]"r8 O)0JZI_U&?	N`=ĝ>jXRtgA
K[`&_;G O|d>bx
0ƗDZNNJTTKnZ8jD]4߬jf=a{u&ɑ,N/+Q~T[~󊕪Zw\LZLN'g8LF+5$y7~2vlcٖۢͲv[ss5Kڷn$39mP7ؑ1<!ж4UӒ9BQcպ|i]T/2nޠYh|wz{wЫ8s"HFU~#=0
 fhD> *?,G5>4Ӊ_!~!Ǘd1D|mq|Ф{1rqSEATׯ}?T T'wV2bA(BRYLv3IMw/0-&+e\Seߦل%7/̜,6n&EBǮb-n%[e ':[:`2V@]`I_
ҕcd5r 7`Ȱ0rM^PȲSV_BBwĮ<Y$yKe,ӸM٩͆igDUs҆`Ҕ1tGSu#FH&]D B?;VUa	bP<LH éu9%
NVYi.]8FVjDMQL[BZq`a>`gDW<',l}])UT6=(e=nňs(},eX?2ܡ74UrNrZm P:q8tjy \C7IAfiނr˸ßMʌ&VLFGbVtt*'Aɣ(.'|a7`E"#I1y_Kzd"tДUTi=2^e(wr7ȯ@qf-I=אjP`QeVk~EP/(,75n=Ȓ SRi8Պ	 h60·xeʟ<-NEn6yDO;_"j~Z/FԓEBvFv>8rc/Gci$oN]r:K>rm)siVƙX9ʑH2L~y"<*&z6XZ_N'\#|T:5fk[8RIsLgcy9DD),!mԘSnKPnU	b[B0aJ	$WTy{юI=΍r9byAZmtIֆAyDkɅK|
HGw	-$IKLI#TP$Jb$B$
4\'J	*:,l팶?@ \DY*~,<`7+wr: ؽ/=te jgj]E0MIs6pk	o9$Q{8s^)UuZ"EEy13~zڙRx<v%[ʷ'ML^U~ݟۖ!&4g5XLiE804h0!FY3ښa$q}&uLRxNx&B6'A=!ĠҥI(*8H~F߼BP,Lp{t[z 9oJxXl%El?0\e`ץ0/V8`R#%$oAraL檖ä QX1	eRBÂ1Hz{IMȎT$Ң.<yUڄV8u"Ņ+⒏X,;G "n,4iͧ7洓q,1)MhZR 1ޗ92'V!tCx)-΀0_Ibyâ"<cOO n$*;QqRnyE#l)ZP@hsSa`,`[J	A8F*(a?\$Lp&"rk 13bot;9G(Yen'@x̦A :>
L	$?*rQ"M'3LIvM|`g&SvLS^n^gcy)B"JAv\R
Prgÿِh8zY!rMTyϩw0f,H~(S:Z)\F(tZàTX+uޥGu?M?\fb$z4:EXڈ!_,lǝ¤JM%bDXeBKڒd-nKJBneحt	^5ʛi˛iʛ1!>Zd%YAV/~M%u	|]_%u	|]_u["+u*d|DP+c9i]##H[H֓䮛ܵVr,,?IR B3)LL
hH4ԓ$usu
w.?'NqdZ8,1n'Y0B'o2$eYbhGsLRJ*)5GZ>B+LSʗQZQc4s#ȅwK^ďnQ^mfnΨS'g|Lh2h2F+}MMTG DM3Kmt]댉W.*pCC*	8 Y2eX(S!F[2T<7WZ. +^dWKhܢKYOd.{6[^+X2ZQJ.D2嘌us$a[h?p0ITuAzpG,=bU0	 kKh{*K2Ld0\]k,&aW~Xyo`$$OUPֳ@o^
2F+{닒`C&knfsOT"hgAҕ1uE׭F_	I(KZ-u*- #U !8z74e5$sdUS/@iě<_42
{ Jǯ̑ QȘ7!F2ZdsUZ@NxqLoBFekJ`cF}ƯѤŸ̿ԓha4:mcTU{s#}=
<θAp\et dF$l	^y!7`N}}wĞ|9+?Wܘ~~yEן^AXm[0ʢ4r(Ug~Q&4:@=Q"[rD9(%7NI"MX1pJ-2U9,f/Kߋq0Esěn1 \@3i^Kt̆%1XdK&)8l$Weyœ=.s|"_,F.׫W+Uڐ./ܰ۽ɾn]Z]W5ZAC7 1Ilϧ7!h*Cc9i>6U4F?	L.d=,kZg9	$Mru#IG3oRñšNfA23{|C%o>+vYT%p"@:R	Ynb:QVgy@bd`Rsv]d{,<BXɚjFu2 	9LmjH*AT%Qnhvf\Yll
%jEGa
V;貌z-/@\9y%
sqwҏf3w16mPȽ$n(|X7fU&3 `)[,qN;vv_9Lb;xsg^4_x7R9,g?h ѷyHFZ73Г3XidU%*6s bKx~<6NYN)ĩj_.Je<%@\a+9L%Nќ,!)SMD6Kyiy$s:i KwwE#TDiyE6Tm.)_lv̅s-<QyHqO'9ۆT1yjG( (wFcԴT-Qo(QRݹ 2h:tb+?#~;7uGJ[SL΁M#:OfxG 9%L_\<'ټ~.*2Գ:IE%)9!]LaλgVi

3NrWJr耒
\oK;DB5s'e<2M%^/	ql:6Ֆ%ⳍevqM+ˑr·}xQ䍃χޗqt2UoouN?IH,0n9Ae
+6FtY:KjZ0ƮxSs[o3+N[˕A}?wP+?h=mT*ȩe.4yL%H$Ia	n7	5#ULl93💥̋1ҔÝJ̦qEQLU͙L(Ve<$
NYڔm2<W(̕l/Ӌwrs.'΃pfk^=3ĕ;Зs5cf~28L|@K㶚17b\ EYz;>yYX?CXJv LZ/^oo( .ov^md 5v_W5 @8؍z|0-|O~q|e#aSּ!s˺~l B9#72@n.U xppLxwp4h>^ yM<ũ;s UK#w'U]h'ӣ7p/> P;J)D!qռ Ʌ-)h\77w$]PT!o`':KQk>4$Z@=sG͖uQpUػdԸ̳`OQQ;|p|W[ξcQ94m%o`|uTt!aW&ud/	EUQJ1ZCNQ)maȏMSTdNB_:O<z3%VAgpP8Ͳ1-a`mfWͦzizYf['kVkNKsv'c?zMyki=+De
x	-ߠr;f
`Ұ|J5U,(D?aeʭSɇ$EƯdj_-L#0Р$
<{Z*~~$$l:6j ּy<¸f>ƞ_F@qz%qd%EϜЕ~ }/y$=/آNXSD[~9㻞+crSz"pzܐѭLuoVȸ]DE54wo2y6'O5꤭u/&2yDʙdxևa\%_]e5+A*EuNK#Z8u n3u#l$>Zlncҙ<?&VݷP\
_.l!	m4xbGvay:oy,e05`50td%4Sj5kCsfpjA"ٲr6@#t!H,ވN":JjL1i2tΓU\	Ev۪j˴ۄ8N1nV*n6kbVe/7)+/CWbR~]Z1ڬq
\q`ȳ-]*6z`y=lM%ia/맆2ZS5<ERcdzD1j6hlψvS䅱6\r*9gT%ܤex_#(OeS81s͡+pLU22	?<,cU4!BX-tr-UrRWJf4FWgMu^nlSTß!9ȣLu1cφPi9Jl4|JĞq%Pf]d $m{	H195T=rjRNFaM7)8`Lyary<	HTaD)#CĬKRfGJ.-Ҧ$ooDZ8㉤\T!.<耾p}fN	SkiJ§fOL=͏oLOP[]ˉ=槖=-36:L&hntWRV4֊q^*ɞt	8{5<x"вٓ{TJVXP{BR8諥ԺMm.|ڮ³$H%	hЭFE?y8ܝar	\PN`\L;}	C`;:n7W63ʀslsYq>ťEpuA?.v7a,DqbcII؍p,@j.@cRg>ufeXCIq ?:E>|<Wd'}5]`9-JPMD,F3xsC݇^^jqQ|VIKԦR<p +&1eA.j><q<4 N+M$<ɢjv'jT*a4L G%	ӗPG;̣Ij$^8t'ãK/Ԙe.%+6H$N<^iR^&hgԌbe?y-5-gz'#uڞkT;)=EÉ$eCFԇfaK>C*wR<pZiO\eۂN0YÊWa>4p}zC(V,uL^[Wua	3A#W0 >O|V<J[j|y9WHNITIDw,@jj@;-4cL:^0}5o;Ռ&72粥ߊm+Táy\2C^̓unv3Kyy5EAXMߞ̪뎹q[-xTw/̭rsJ56)$j:9k/>{ik5s07uosaTt8L3L_)9+l\Wn/7wnú0ri.6[ֻIsb2.eҹ-FY/p,&Z6_6B>ʜ5Kr(r@q7>O%ژG`SU5ٱPQTb#$)Rn;#m$em=7WI³'U1V>?+Ѝ}N
pJ/&
cX:F뺹L빶&Oup2(1o^ZzUW9M߲Q6rQ͈yZ[٢qf:52C]e(W0l8JF#FcG" m9Bg6~YL WrRd˞o(8h{DLn=3!2INPɖg7m4,MǮ
=FFPD 1,檟v1ɨϠJH;NK6F0<hY;9MLJ*꧅3+P()gW|kxw<93D@(?=}! YPdd铽+yuuKduu,emLP%5FZ96D]<CX+Ume",Ô%8ZQ[xI@D5Q{N<f%9ʌv<oD0T;b %	k9;vV	nvT޻߄zke0x(c|8ZO:J~5jcJ].gp##(owa'|0gଅwK-eDE37b3ڈ˫%Änf+ՂL;f_AHfrY^T>Bg)E%㦠ĒN/
04y)7vrB{PǣL4
B~;taZ4(CKܺ,2kɠI~QM2ooo'gM˒#u$hhgMs!QeƵn|ZūTm>IY4kRie˙$Ҵ-3(`g$~4<#}e(΂)kӣ]S?Oci09 ƳnxпW"d=K^]3lĉy p%G͇g Q<)p̋:p1̭6lhX{7q@MeYaz蠃+=.2Tp5Zؔ7[?f vZ姶
gT[X-N+|	P70Z,瀠O5tvͼ煪FUVn<HXU_ӂe:*JQǬX^6Yvbgp{꣊DDZYj9*␑Vow\lW_JfMW130{JTaUIs;E-6⹸}Xr~fel=oʑ룴d{y6Y룲Py]m/wT3$j%Q%39J`]Kx&`<<B+Q4fo-,u|,M{C^ sz;&54):7a+:f?eF$X#hXa}X"VnCW,?E#aBl7r@Pʲ9[&Ԟ%% n0+8
lW@I	>-]՞Ewp'R\M h2xMRٹhYߐoo=N,"|r?qЭW/eql	>jEoquU' oLY
G=5*,?y4!Wo5ޠt+C㫯^Un[V
[ sާ19B<ք5`$)H BpV/$T|-R\$87IV 
M?E=Ӥ.9mwgj|6-u5xNo`z;=6Ne{'QWxW`7hdMhB`$FNyr6M$*F8/"t#<tSP="_~Ad@rBV !L,9kÃ'6Hӈ.<#i$^M~kj<7ͧ0D9FFk:8\̑!v%`(Ddg0+tnNVs0S9MZJiPBz +AA8fWd)JEӿ@tz@/!ϟk90["rW=cBփ֥c%^q0dӯ?2j*nX9i#t`L)N?ݡ=4ƃ*I]H"jUR*ţ&a̒YaJjKyT[ssEHІns!QB3_helO%B*95
`V\1yd<^шakDJIӊJ"}da6{XL3©ߌ3*P47ThpQ+#S/<l\M~ͺZ ~-h7`}rmFt*3:JxC$I8 q@!z?u-ՀnM6rq__]~I jUj(VCT=OSQ/e{_()&ϳDZ,L:rFaj1҉HXhfW}rAQ_.
>O.TC	i +ű.b[n5 粙pLm3wk[4I)DB7b-TT5.)f2r.2Z*y4u%3Bɏ|QƶR4ʌoyO|gwX ,3ߝaFi)aXYTWzӓzh*s^j+[OB	lB~~1}`}1<?<':	Պ_՞s	ģK*
c>Vw|]sZTG`$V5cPQAYa:9	aImU<T2nht}Zg#_ykDՏ/j.3wdd#c=1^mo4O-Fn5; KȴE<xcI)E=\kn.BvhIqd"U"/#褠S ҁmȇ|YR0@"Y^8	s[KYC[hTN=&n#w >xt	OS1l磭	
Ň3`}OF??SLįx/ż@>xa}x<$#u|+Nv>6O2R*cvE;gNvŧ#<2_+(,85B]r~1chW2´-ћ7!q$V97P%I5ЁF(	[LS5vCo@ġi]GՈ#	zf=>%؄U3QGyOnch
Wj|%W;k$A<{o?Z'v^=cګ=<V¢TI{޴W;<s~gv*DAd z$tc697Nh?!ZY^苖8{)VYrWU(/CW\\`gܚgΫ$+PMf"]uuW]ڇgfSb? OI:o8bVU&PTX6Ve͟wQڤ`>$b0-`泪iP,KQ6a]P:k9`mvYgGؠ0`A( 
9 O/R{y9yo{mHr:[K^^WN(S?Z$M]SйzPR
ezd{Qe@(!0@c[\BL&\vyBTYN nhpXs=2|VVe~VH7+I=>KurXU(ְTB?V]usj}hPV䆒b
t%
*&"'R$¸lTXWW5}n_qt'˰WX2|5r|	`dtWQe@M
,^<pYo6)<i4/]2\7bpV^.<Scau'ȍie;Y{ک:jehl#AI4 "1{&SM1TNĦA%/ƣ1(:܇d䲏|ɣ2Nc ̄wy!fyARE25Ip]:Ê=XRLr_-7.>CC0VP3QcQ*E4sgQ$:q 7b<knl~CbAa{|rcGn|Wny;ͺzb /HHێD}x\ap|B>M VE:j-YR#kQvΒx(7'o	R'-%.ZյJ.}f	f˙m	lhLU31z@C:l۫g\DkxdWIߙLFA؜ep0Nhx}Ie ɳZ;}!8NBUa(JRH:7g7V<6O^YYsP]9=eY#%XN޲-r`O1@Jkmh'[{<B˝LGqY%3Sŧi5F\ȿ8YE^od?	hJQ*SϚ?6k(!_VYrp̠f䉭EGrt^P"" &VeF%c9#S4l\1tO_
_
mVqܰE/ZGjA.bU:F.֛m+.huN۩wXi5un5E rC4P#ڑN.6똳kZ{mֽPy;cqwq 	/kbn?:ZV5JG>|!:FwBa:6ҹtOZiQA0~2:ruBs#g2c	a%i0aq"wRՃő^(uakxI3<od*&I-6Kgz3teNfu|^%cS	;"[X-qjHI.u6&@L9vBB/ /fK-i|1)J ߸`Oa&ʪjt_R	gԗhX0Nr)'Sb=)"4gKAV\nN ]: m=EdJ<;Qp	R@D	u`3'R,g.;^\ܚ:xyr{18\z8"gVXLAwǷoDr 4y7Ky,"$Fl<"7C.2}ANw~~$/NK;92>4h۩c趤Yv?ŅۈKLMMMς)Lr!;A:)ߑ	DaBoϤ 
xhrl2fjjTđC	\YuQ^YH I^+fg2~!Mf1|2I}WyDߕ/SX&a0l"AK}ɶTy#q^P+yMRP:u ^e܉i|<8=z
y_& 57td0fy,Ҳ;%N|U˴)TD9j!Kwqi Ralo5i%=Qe@ҍ?@3-tBz<t$+'fɂ3htAn8{ϝ\_i=\Sn@Pě7[j9>[iW?Ma7֮`<a2w28%r25RF8ds1=fFqPm;I#uL)էf%_g-F!݁괺._uNcdZ2A?qdL=o6>pJCNr<^Ǩ/Ã/w?ۭco7n{2p0p"OKK2ֳދ3PN1ӷgվdx#^q=*h5?{?6[/vz$/vY`ο~jOQSiO/([	2ЂO	{_ӤM}7_Wo^e_T\wn04=դrv~~ ὇{͏ozkvSɻ^n%:v=TXek~zow^'
V?ww͔a4m%,j4R_}^w'W?d4ߜ&ӷL%S&ʃA&<؜`E%U٬0Ga%uy癢R+v00'k&+lrZ Yowr39~>ZǓmZ[B(\Pm<cJ^PO8edSC^<ѿ#<<TςIɚ[y9{VIp򼟩s3}~=n
X0͢axXg_$;@]M-6-\g݉Ԓ,/()ٖd-7)dxPlّw,Fe1,sGV/MNKMa4%-[OK*A3d_zJf@MYFY7ƽwKA,i-	6m33+9~ukhwbS Fu⚓J5ʐLd2mk3:FɮkpTjz{(]aEMm3yLkY"׼5TIȊߴZ6cǇUrq]k#'a{>)Z^s%Q[$,@7Oi+\,jet{N.B8"w'!]!S<	?Zɛ5c]oSo¿k7i/4WGRz֍駫kA{tb6(<Nם\O<{}ӛt	 *_yo\g֓;r*o[)4(*g{BW$Jzso.J=<fY0ר (RV
{ݿ?y`0AlEE1#sGl,^GBagxCaֱ3FlA4q74d5ҮwE4A0
M8ݙ@<r10ħL	MV`:P8r!O]yq0νS?PowrΓ0虅Qo4VHpZp֏z+z>oAxRk+cotz}1	F'0{Qofq:
 c(x[xF׊
X;N=gF׭EX]6YdY;zZ[0z縕o4QhwYiRIkJhNFۜQDGZD`ݍ[_tfo64g#!SNjF%@3.-SSv!R%@֚4u6-B Y TRL')ifMF;;o$y10\u1n&k§bO,;NծKzYv;A*ťEL	h{OA&;z podkҐ3nCrhݱR0<3*h=t_O +;M	`$QL>ݠQp<BΩVn$1Ҭ>RTPQkj!V)Ls=#/peE iXbš BgJabJ,?dOoѣG
YjdDy	r=32zS&騚Y`#dE#%GOjB`R˛'(a~蝱B)XIE'NCWyT8xvE#+(>vMWrgXAyU{А^^emҜO햽jo7Zc]@ugƆ]o~خDdc%[y^a^gκn|mU6Bһ5{D?Q҆nF{{}ȴ1e7:]Ѱ[k?ή  ;eQm;k4ZvNc  κmX[m@ٰzW7;6GVcnvdaٲ7ZVc7kVs׭VZմ*2x6nڀq :[|6ֈOЂr kmu{mcmPtm|lm$hzjze5թSS́<[,Bnw)RX;PP6Vsrzדn訋lXz6H:^<q$ D^%ѬίfwnVcc7Zv(5Y>t@S	݋ku(I6]_;YXO6c[ϭ&o4`jjVX]n-c_لвxS⦀[66Qog
%7mhDQϿ6HݭVsPB%vC4۪7g}}M>at"Doеubn5a)aׁ^oHcX<AA`%o0Z9~}?R;68;(STQNZo,>9
>udP鲡̧0ΕDed߶9 _ ĀUk2ﳋBIAA/}@cKA1Wj1>$li/6O`@}a-U9́}ϧOVY*ű?7L![~Ȏ.sg;d[j"8'5.ӡ/k-^shC(o7l]P9,FeV#͉lz%9 :}a+JbSr7O}\^TsyOF3mO)Iy+7qDW|twINM{qNyJ?)M0;0O·#>zğbhk镼1|+)ss\IF#ȩHmwsEp2v{<PW*H%0v%<	-lX1,xg(8?h 1?J\w`We8w4魮VoMOD.>>Tʪ_!4ϘnLҷt Zc>C{`VD̊ˍxu>>?B1شwҥP'AhWi72I:'FDxǨęN k!?`0|;1	6M/,ǡ7ƐuPxQ>CW$3]U	>RS&	y`WAq#oZwY=8(*|s>2+QgVeMGٸТы{M-UTy%*Սai9Ech)'Lc)'!ZEj%ժ>pbX(̈tuܿBn$;ܳ\˜41e:mFLN= S8T٨T
E"ۋ$K"2#yfރ*~&o'KofY/%03\i@ Y:*UES}2*<e;7Y**?U|y.'&SPN`aſTU57GTqGA*Ɛ% CH
1Oj)%@(KE el&iЙ07rr+[nk_Μ7tb(c|߇[f)H{*'HGq<ݒ	w<c;vd8콼O,n.Ia/!-{exR2MګX'wEx)ݫr2%Q$11cIfF HiVYrV	,U)"F7o2-jwE_	 Ǯ˞Ҍhd'bP/)zz>qc2sPcj/+,ZseD֯e5*9>qiC__wDvWѡ"I4	3" O0.*<W؝%5wTI)MBjLJPIqƤrI.QxqO	?30VF0{^9%hKu3cXKI?3	شW*W"$Zl(NAR'w|-+͚.H=s2@36i==3)7* $k?z_c0tiz
;zH0Lf;xlgTPSwdZC?Y:$}G;Ft ڋ^UrZԂ &Gx$GU0ɇoRG!9Q.عP1܍EL,s 4d7+i)QJF [^(vF#~5OT5h2NC[#ErlHJPbWTddx\vDc4k)(H8Z&@3J6@URǍQtwo]G#DlۭǬժw뤰sx#gQ^89!z̭ 	ZD/c\
lNܾs=rR70(,TШQ3wfs+syYq17s\U 7tK<=wQjքcP{fJe}$$-J/ZC6jCd}fxf]hfO@
Y,I ޖb?qSe/D%#\]`(/2ըjl&$7$B**k yσp(BC IBl{)IלĖQpcCX$LPK 7+7R+,ě"p+-OjVbnH726(CHKڻ<'JB0/ .&pD6&A_}Kg~}J_7_o.?կ*UM2SlA;"{@M#lAĉA\a'Ѹ+,.Xu¬moȟp#=RtuO$:aZ{*PEqxU7<H7eȱG3*hxiV[ep%F_K-{Ƃ5gB?%}p/ځR_OrZkmbK&7@TLF3l*#t} rmB'ǃpwHä9ܠāJva0qf)pl&xgPF?OfwEHii:0_YѩC8:kv23Ga^jT{{P~M|,+Z| L'a-O^>@f}=I)rOg:.hf4<w]!%t[Isp!e.-!
Dja^#fQ?S57ТAX	3TfVr-lc&<Ԧ(^.0S_@	caxz	rXY칢+ۇMW 5ǇUYs(avkЪЇϡנjRX|!r}(.u?ܰF{9 ;ma Z+5kqQKf.@6e85g`,9Q]Q sd$uTΠ"MTYf:xϖDfT>5>C%U=Cy2h-IBVg LA/&hu)DYZCh4&n)[ljBB=̀2b֋x<*<eі$8
AvՆU;)|vɯ0׎Z3$XLwRY`̮RU7"^+I732F蚻e$a:},;*@ZQ__ WB$յiM:JNCg=HdȂKq0*fKkklQ	"c0h15R|UĈb;DH0Pl؋|*ܾA ۂI{Fc`]jw6#j+7'QU$ΏA:O:ieIcy;6s6EKRQqdmo2MAfGqpBrsɊ?1l$=U|,Ɂe\??M!XJc!S?аx,S?&7P4lNNuJ};w s[cC!CeJ5yR 1B%؛g>N g)]!40-b63:WrBjyjm[CQdzIF~htz3p	K/ƝŷLwH2>g
ʜ@'z1&5Hq$TiPlCq*RwyP蛧:LWPyg."7vXp䍾)}N.Qkd%4ΧᆽQ^ń@y9%K`?t2OK.][>.eI8KrLwr^
Зd|9FyIK\\@sp&SL
[fEz. {eqn$B
EE ɬqJl-T
a4ΔjMW	,W6-͜.Z_VQ͜ `kZ&OE+	Ƴ+g+?Mߤގ/s_4݊O6LY?Ĺ4:ݎŅQ~x?nb3:w.gWr?F1?ko7yn٩zcۼwrsu9\-4	l98gD7Z<p!(ZT`@]z٭,!lM.9YN+	ЮwY(cD2y2g^SC	Fr&q7zZ"\Ub%ݏ_<')wz}35׾ۭN39h}	2ƣM2~Qf㆒Ng FYi^~ R3VǾ6+gfa2TR$Z,˴E$56&4,?C[#Y$IeLi(|Rnloyfnr
*Q4`VZP78o!Y?E\B>"L((1vZm:3:Q`-8Q&>hoq,+TTH0RW:YrCQǜ_xu.l[;3knz_\\cz{}	$'?HmߗYhOiGE%<2y*dKK̙/^psiHoiK#w~eǿr1;N+mkNw'V?	7.}T^ܺDhx\{G6|~n9dI0F	briwwlc]Үɺ|:'IYKfa~aX.ŏqK9r cNxO'ЛVLs[l:gPT;ǌ i$A@'y'd.àBܴy?:,G e`v[2Zbli\AF?Q+3׌IW>'t]n3G8My@0<<x&ƏTzw(24kpFsLT*B)-CwruJH0w 6|dv
vsey1Wsx-j ̦ĝ8VaGkP/I=7c:m- irwF BYv&kZ!a9 g$[+9bpf*1N?SջelŮ;e41ȏzY+ȲVR@In1JM.}^K,hF6Us/ʟx@E,Aul~?203cEN2IݏB vCS-O1@w|u6GkG0}6hR{m6"rBMWY 41 &N!"}">^>;=>2*W]1'F>qO>t:̞fyr}X1xtEX;MHH
Iz]ZOł.A<H
86%qU6Mr0Wlh@ūkOw/'bn+œ0[>/lUi[x4͖a?};>~?*i-`c]oY/׉sf޼~l=,h 6m6m~qy r 