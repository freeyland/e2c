#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 L] r 4/(:dJ{"X$U>:բ:+$(3"+"Kd<<Ύ^`vkKD )qp8ޫݗZݦjjVVmWZիZ_/Q섀I},HNN&H~'E/3j5[hܷ]\zքoݪWkp;:FuwqQ_\\6\|Apo藯^G_k{N.!Od@vYZCk87 _)yv?tw޼{}j;\Ebvg<=s?(፽۹=nd;tE~d%ny3CY޹9σx}'vD3GyEa&gl]m?m7jC7W_N0Iʶ0\|7D{=QM;$ŪU~p;֯[?Wm׶>0't3nIE+"vq#O"a#Qtq\S?>e?kƽ__{}?uhwq?:/_[5_o;6(D:5moڙo;vY?Wbv0cl3+ТƽJFX*, u6\zN@}Nݘ^|CPzA/4F..(ΠcA](K~`" _P&]_⿝M*atPumhM̸I0- =wFD" Y`2yl-s}5b@׆8u?9@T
D ̎(sWCa/	
%kJomv,cZoh_kZvV]?/ޗxTz7*}XZz)>,1>ۘ
_~aj	8a1/?l60!Hxw"\hdǃ_͟މs}^P&	BtQŭ^Dʏe.(%說ܹ+c<___[6ٮ'sDgKK	fʖ?#tO3Bofh.;Qx_{ڨqz7-vn0G>΂Ofc"8O\.(҉w{4[!CΝ.ȶRˮXiJljwD׋\'iy:ikM[INkZbGO %"-"lN`N``rc/VAmf¬A A 1+fP:FUqw=l>S8ARNiyut/;>`	+-+)+G%]?`j-a=TT`?H(6{^<?԰=廼7E	?S'$9)*[~K(A sW}m,xvͷIR|I^Tc1kU;ߵt!Ơk8ȍ;[gҪYlՄ(׎&Tj9ɣQM'CHi1y˽ׇýWovժhͫov?ҨRoa=+-CAyTaRˇ"`NMCT&Tocw-F",1-u@_y:U rmQT4_N'-/p''<#(G/"N)}ٯMG9Q{5R̾Bft.`3wQ{Y>В]>{Π_vkj'A0>
9_d_W\uR·BYvSY҃'ő]V=ˏq.\^){qgɉ&nPuй̐
]AttǓ<q};Re!A۵
'ѷL^Vi 9&LeF=I8T8tGN|VTbQi
B^ffͺG6-]~뙝r}up}fuvXMЇ|@>RjFE+##]ĳn`
G2Y5̡JB|r<X"־.ITTrz[P2{-¹rfqčMH)#7FeH GtvV>;K>w"m'9z_p͇?锤2a/R=ax̻e#f$@u*!xh.-~F*$M#ɰ}>⒖tu.{17D /w"8n~Y	&e0ͦqVt3~%LFD3&0]K7#`J@Xg}}ZXO@^CT {i?-_e~~|;Vaoki@1 4 榣w4 ( ͩ"Sͫ?l_i7rzi)z/<rV	RsN:LNMV8h>1ggvq|a0oQ@V1gUhhs)
my^preu>inK4$_pg DD!ږё3bnޙ㟺}նXa\6#
n:s@̪WKI!kǋͩ^4WWE|P8	gb̲ 6a($ 	,Mbn|.jrz}N6k&&ƥdO/v5({bUu.p%wFHD7GL2?QMG!/YIK1eQ>{E#zØ~8UeYfpY o?r9`J,k]+	;-?їi x磐FIx)=bP 2rt)؛׻^n^Bcvn|	7̢,D{w߳:<Q[)xRZ2L34=¤3y1yfȋ"9Lʈ-FgaWw{7MoBg'D.JơkdH5ʲA$VJam҉B	u6vπq=;ȼɈ7$֐h% PKvz(fDuu4Eւ$(Fؐ/ragb4+S"?WѬo^}sPW:&LaB"j(tdOx5a
*j'Mւ@H5)t|!ѻ	^2zsb"۟I-M/:+|{9e~^g}1?3>It[k@MZ,JK~>Kѧ1Kl
oHG
筴u,r7z@uy/|`y>EJ>^^Hr/)I+ȷг^J֗b/SK.APz@̫$Y8P|GP+b5G;^@/sڴKJ&C|WcIZ.NjZg<g
$>Uf|X+HrLc+cqFy{3NRPϦ1JNc%ڨ
SP'g(JJ]7<]X|guJ:M:KZ2%M'O xCR]K\AO(FyC2V
y%T4J;ď;˵si
FR5ya~"-e˴tnV*ЉcM,4. \fIbPl)IetWQOӪܖ~k@S[Іt;q7ӟ2sx_-Jzi~¿_/|53=?l8$;?Ӥ>c\S1d]Ʌea˔-ƂƲ/Svp$Xt$~tV2}/Ѱp/'3eaNB,VYjD)*ekd0}e6tژh|o0%ݞץ8-zWy9纙paVLnL"۞kcY~ @2LyiMC >C`̕vҜ7Ҟ1$z/mX(f7h}wR-[hiԋoԙw4![hai. +XR\&7d9em\2(")ƭ"d6)KR1uK׺ez{4]GLSx.eɏFi'<f𯜪U)*Ey䰴f&e+1۹fx(ƗhdDZNRTKaJ)o4"oVR9ڞ谝E]Eol@"K+JTUQb$;VJ=%ыc_]naMò͑Xoh3UG,]l4dn_7xjIH02
2[;
]&d#VzJttZ,P"+6Ywեv(AO*p`w{ۻݭwo[3p.<d[agA0@S w>Rhv +1hrp)ª*V[O1IT^D@+P2I+bB-Ez:46ڡ3to2`*m{ߛ7/^E?*\ғ++uLULf U!yHquĺWӕ2n.۩oef`rR}7c<V!2bWS1MW%I('6 ys$}!(n\/aʱae0F=;0dD((٩}K<tY!;bW,22iܧnô2GncϚ9ziЏъ^2:)|1LH:׏QVe,Ů"Q*1)(L	&VXg"^1T_{gà0~,4ĮOYI	;cZ:mSԸ?-ta8qs+~fpI{w*M>=(e?nHs( }-eHqMJhdhԷ14>s8jy ^}\7IQniށrϸM6`Ɓor<s{x1C9HEi?ot	,=V?US/Z/oËlw4$;]"h?h
)n3ѩS{xe,NQ&nG_9[*!`Jy9i`VBkEp/Df	ߴغ<SgL%h8	!!l%@ʌ8FEJU2-mNE.6qDO_br~X/FAErH`!PC#M;K{EbqI^	L80'䞐rK>p䙨б8#s#d26L8x>W\o (	$=Gj-zh|k ̀׶qNꙎƼ΂lSYBے1\4p0PJ'n0B0b
xg0VG^#ROr\XH+v<p6h!ϕxM0r@Ba(_b.$)x4´  1P&f C3(*̷$ =h W"軿Z Z5赤*B@Oup
oُ ]oF aXx߸	i;X^uLQR4|hfQBЋz`݇JƯj
L2Rg@vo+NHǌ+Y+ߞM3i*zQy&V`[ꆘo iK2w)-R4ڠ32{ u	hi9x 3%hc
rݍ09vɞ&:MjNQ@@SDE=[7"f
g.nG;oJ7YlEbo?^0w/V8`ӀE##%p7bz/hj7ڑ&8%0)duT"d49BJRպ7F^\oq3)	1^
_]%MX R\")%b8˒ӈ~!K(xkBV}zcN;fMMAbj=-slNʭ橇s+Rda>8%"AE` 1NO n(4*xOi%<Sl)'Ph3saP,?a[JJ	AG*$a?$BpF"ri 33fot	;䃈9()Ydn'PxƑh^ :>*L8*rR"ԛ'#HIrMZ}KgFcwߎSYj^6fc9auPPOB#	h0'4/+L׵)_
1TZ
ЌY0zTͮaP?-?SIR@0`5::jZC`l!FkXT)?OTsI觉U48+_.Em[T^P8!2Gg-qЖ<jK%ےn%Gn	ح:+Zn%o!o&o7gY,D!%*JD*JDjF*ڲY,C!K$/2C:nr֤ZrG7Gqܭ'wk];k&w^?IRB=WOՓ: " $I(I5IR5'Yy ɚh~WK]EZw{eĚ%-=VM,KZmkMlqK"eB!2@ÓY7[xz=Xy6>F=G?>Ќ\(Lq4|M%v؎VZ>r$_6<!4g41m>$FDzw zO<5`y`ς+yq˲
BPJ^L,S -)>	їL%48xcz5exIq%o:bs\%Td\j˫8ze+wE>S>"CW啰H@9&O=x7[h=pcXSuG\w(
g1<F\yIIQ԰xڙĴsx+û v-wyDޗ	Sk0܇@&\컵
1PKronŸRٹg[*ۊF]`)*+d^mnryff;lKJ-~$qZº2:nSu+݆%t#vЦ@0cՔ9#sn7i6ܛkK=KP,!:̱EL=k'$ކ=4UF1x3Z[s0<6,H^܈-rv{ƠBω!57a4۰8}UFR`g*a3hsl}ɞ_{A'qu':r3Th#@7ӉaQWͭ1Zs0*O'_{$WwbeYI_yFݩϼn}kX%Od+Wf6y?O^N5߉3ڲM:uF(\gW1jQrGs}:	Bow\ieH8%4}ϊøW2P5cA:^DN1;&=?vC<hƣY#WjiЀ&л$v?tV,fJ!MS*-Gdl+\|d+)$ApᆫJ'7voo[,uO,nW7NZ
hAC3 3tQlf7YpVNbj4þMyv@Q<`k\0$7jnw@J5+Ms0ǡM+7]g}ܿ-RZbR0]"r&X,_e0akoAdud~iZ$9 ܂\z\E>oIqhz?&XXs4Y&lWNj@)
s稤 H^ѕXɀ&ͲFԕzߍQs(*M+L:fPESl)L(Qy}{TVwqWn92]h$!3nV7k"Dd} y#SM2|&JT	sEqStCh7R5gsw5MМgYCUnf7NL wuiRƷ;qݩșHE5qjH2ou$FMzꤼhLgД44}olqwzfj4e9s@E%p3/~N_(4Oڼa*6PM\64]5Y(PSK
ϙ(o[ُn!|3ĸB܆_@AyNa{TO$@PS* i7`h|O%Т΄~,oG#1;vAwy@r9G~۠mDV5?$㎱/
ܧcP]EshYW;łNIuzkoy9%ds1zJ77aa.dRAmGE&L(J8>koXc3>x8$V+[%~eIle]!̰9CѥJ`LIڒd^R筆 Vd&PߠJ(QO؂&õ'^/ԑx ӢVe_3/t>VFŋ"o,ZԲ_ޅ:~TX&6B1}/)Ӏlu]@|c2u?܏-cؒ0%:G[R
gY@1e)`8@t& y4	L;1$Y'̌#^d}f̫XtN0/0`l2<,2'b_WшΔqs
}SvIcuᚤOz:~`(r;/1r"\oݛsNRDkX1f,N03+./)`̍2xH.. rRywZy*Ө}$|se U4dRInO __j߼.(hEnԩnXͯ(Kӭ`:mt
.;iOCc ?=H0CL,9w|4SMKOtsyF[y>Yb陔hQM%c}x*NT$l*஛xNS.%*^t
.w]Usb972@p[xx堚O£x<h'Z=o!6F, Yƍ-ǅD؍^r|;ǅYJQ
(q.yniHFEܨy=;gI=H0G#'!m Bswà?V#u.~ VLK(cd}O:6
O;B,g_L?-jީK66}2Jp2O8mSPN>uzGmpE 9?Jz"2?塔- szgs<M2[ū~8I~z&v0Lر0_f 1ftb5E	@g1dY09y֌ZBy?oF1 E7mT!+&G0 4K~~rJ^*V!7&F
a4¸|+*hx  賡D VsL
͓ō6%w}xO|jtG6v&(6W܁O1kp wұ.H@^ignuG֚LD=TFnuyLYɧ;T;xfm9iLt'(sӘB.`I!7`3pry<FQ??(Ȓ	!O0l3ɸ}>R.*[]cV+oXyeZ^J e9V4C1u6$UYĠ3>x00~u/ 
?YBλCnwW>˫x˫0Gg Ԅq̬Y'M=-)z3wGI|Y8u1!fTd5.0ŮGIUDC
}QUmW3ٓ#d|5]&{brLi/򲭚LkuZ`LlU&B2Xp|e_6ߑW8]]8|_7)VM)6>eBEۖnoV>}K=Xg[,oXXMՓBؙL(=(1tZ4TXqsy+9%rM\%z|7ӱ(\f %X-n)H81[N8	sͧ aM(5v`qㄞwXuAo[TT!)B8ͽ
4r/rR&͸N5IOFyHΣkG?tϐ:YNLܫ6pc2ӓ"ÍRCz/;%S	&CpIO \'CW03z9-x"=?)40 ǟ8X|b"j:ښ}
ҦOQUMi'XN$b 
si'h<f,i26r o
ϤTKiJ=U;=[3`?3eCiU-'fјZseWJKZLHlXϒVJh-AsKv1K`EĹȣY^a[:R3჈gK-B-ؗ=kkIa5dEeȲgtkg}:̈́OUUt\3ب$npqe2Xp<GBb9/m灕G=C{HRL;g*;YoWyvL($BfT'U7,&!~\n"E0S32D.%BB]H$BbF8\ZaQЏ6LOj2x؏0;Gcŗ=-98$UiNc͇qM  1CcxYǊgMPWrAVLbs(7AĻMǕ$): nd1CI>U
N˰T0YN+R<y2L] \1W >UT+!a4yJ+)Ê fָ29rYF[\]J;9952l ,4(P0%9VZ2knn>	P\&]d@~j 447+J-` /=7^㯆l0GPZ1-Y4!]*jxC;֓5֮P"b#f,F,n@}bB,Juݾ+G$$&ZY;m|R^J-[%aeS1L_ˎ5#:)֞|)ubJ5yT(LcԿ[{1MsWVzf<u\iZt~M+n:EZoHGEvZ!7g4q`JfarcXn}:Ls ]2NqS""ED}A.kբ۶:sǝ[xlZ77blVqcRE	z.Ͳ~)śF1QYCihQfU_ƳĐM|mPicij ̊J
'$I	J\8 9dh"OJAũh7c᳋l:ܵ@gbĀ[bo[)vj#biٞcOm^vw_`ӫ*ieubds:F-9Tܐ*Y7JdaS.e,b07D,Қ)tjgq}wJ+ǰ[/UNVM&4d:`xfF$#2/)dޓh)-GYd7_lT<=JRD r^u7mb
VWRA,6tʗ"mhѲu2s:ؙTw13+X()|sL?9FEFFY hX˟6dYX|I8yVbr۹fxO>%݉r^aò>&oU"nkNkzVRYC"q'/TaT}-5"$VU*MleF7wIv"NMU	ff;LEYw;f[Z7B4	{ik[BrQ](:^qҵ:+?ufskU.j/t	:]v"^6ˤRi2/N%x?zC>-!ЗYX$`G=ËdFLN:"	ߐb\PilT 0S,܂U"z
S% RaɦDp;39[L@!0,º3kII~^_$wދcEbXz~v޴,>JrF)~7=R%o9}Q&OLn]^AQ-UBŦ2OISEO&&)MRZ+.M;Y51֏&$bw}_q-qǨ2`tk׃#OXyZ"L) q%/HgOdVW@*[IqZqmdy_9W@@`ϟ>eYI')83݁ֆ)sۦ ,H)-KAtpq%UA.VF+Rn4{E"\Pn_ja|VADTbwPbiwZA\MʾeO('n<`B%P[^nUtaZ4\|d+	-\ƣ\}jheeS93'HcM(ZY*rAq*n|;;iW_Jf]W63u3{jJRTbeIEl-69XO27'>WDPeKI:a{{_5^x=h?2ߎm{I0rC?8\)tD"_څxDLD*'n6t[)y>IQDo1	8]!ڛScϗǣ*W%eXD=pZ۴#HpA8y.KCX_;D|t:y'W--%X߁n+SYRCkfc4[W
P()9ړ[`η0!Q	soJ8W,)1+ͣbɊy"OAGĥ,>(A {XE(r2ᅢoCL
GeS*,?~4!7o5٠4+2CoVhuqy-+ @^cii1 +?k$I1Ffp]q\tɆuF8),Y844>8'|yOpSoWŚwlg )ܞwQY*<?ES	MɎ|Lt~5^YAM|ߒ$@#3rNē'\HN{eC !la?>*@=T(|I>bIxK[B1XЋsj3׆?|'\6H㈂.<𚹪i,^M~K=7E?ǋJV8/!a0 "#%&,\@'4Y&nq=Q	4,XaPYbᕏ F  ]3"U_t :t /.s_j:0]#zW=e@KϨK0O̮[@$m~?<SJ'nsRqolNs$}5,)rǣ%'ٗӎ)-Sm+P5^օuG[uaI/.=UVvn4Ak^4CǾp18*
IWiJH4xp/W&
՞uk.)p7S;'&!k(*4Q/=S̯m\m.f~m+Y C:-X7`~rcFt&36P
J  	+GqV$6 Ƒ<V(maVSV(״jV^UCڿUC`"hyrLcz)Om<xHK=\&::vG~J1n҉н͡)催N5?%}ܟP	O͇y.mIOuqq&&X6oC>{:Y)eQ ܞQXV@ed1)^bv匯"/,+-~mJ~r' ׷Q+gQ~8#Af4tO0>JSvuymn+n&Uz˥BG$Z6~zrqq$_K_&?}v_rIͯ՞	ģ+g>M5%>y,V^kQ>k-瘖$j$%|sxt:	'ٶEFW`0ʜ'1iuʚArrnpv{}4#YjGjӿfU?3ZՍ8Vq94/EҋW Sz0KT⍱c4xupa%5%}T|@gmloGwqO柈&7 ]$˫='V3R&4h*l7S_c$rpmc߇nysKܵO9gwnO(cTo@򍧃=p8:	_g$~s߿L. qp<
 y2IF
NW|b>KIx[<}νZ̩TNl|[+&qxrTAkSL9%>\9lJF8if]Hܱ;F*;'9q+[m(=Gq@u[y35tCGGgQ{~L̪y@:z|RK&-?&.J쨓G]
{nCS$(T3y'jehE\}#E)iU#vy@'x	0mWB6@$	yHDiCtBKn<C
`q닖8iǝTxcdˬUtGg^}p\Πgg$ 6#|Ү:O+/kýP91_\Чdu7}t9bZU&APX6u-wQ01BiԫtoKvEep$F0Y/{,Fv6VhJ}39B#JߋlzF%B&c4>+UtvA^cͻae[Y$%@6$Y'o+'uGNu0Y+{_MpHvԪn	\FlJ8ÂnHN2-eny\޲{rL`0c[<\J\vy\\9ZtflhlBXc[!u{}Ыnk0UJ߻R]AZ5UrWLCA.E!4CDYJ0.y?-S&.M85}j_	;˰VX|⑂2|	]aF͂w7+xiu2g-Vt'۟Rh]V^8.<Sba'ON#756vv\+%E;Y}U&s,FB4!"q{ȯ&Cm1TJ%/g.-iՅ 6܇ovl2
GvyN̄:wy"fyARE03IC㮾	qE}͞w
)sCcw{/퐛)qH,9G%LXX^很tes,D-Fs#Ӑva0(<$:'1v+\=sQfl/ɛO9EbEv'$];w-[tg@|(Qk	/bm_?O'?|qGY:O1@;xUP:^pm%q/QC䎻t;!;97
ߢMAӕmi!}2΅z&Ah~hQ/@'^w;))	nD7.UzE}uF{֧>,\"
?a5?}%cdoAN_	Ao|7>kToDrG.镕){SV@u\/=`giKYd	lˋ8ЮҊhAIiޞ$s'b_`_pQuZ'._"/b}PhJQ{q#_RrNȠd䉯EEr|^ oEDX'}xYXtho`4.ܯI믆6N[7pO_pjl2]kZtkVVmW:յ߱0^c*'G $wrXZzmRۇ9py[.0ʘh^ˠT!=<u}<Ǵ		aX Dgxi1&*^*ePb+q7k!#	>49{Pexݖު28z
'Ԓ^;|s	9R:X	1iѦD"tJ`+rg@ݾi/2v))!iJK_nhq4̖"äjWvFm-OF9wjWKpr25-Jij]t0dm".y5Gt<mSOj#RCŹL`\0D@zh08wFn9l$P6֫<jҋ!Hi_}߽]Y&3ΛiDKB X2ʠ
>?wAf]%Q׉qV8
(p"w3d|a>aǐ-[KVUmߪZ<*o|W_.-ۿh5ְkKm|2fmvl5j}ŕk/0q\*Zڼu?T.`)c_k7] k~m.1mr߾n2aR֩X:Eid3nd2:+ۑD+Z0dv\c7ܾYLͮYËUG@{Ce*3(0/:5)a
bw<@__L@{SA܋xS-G{AgnV֎sZoGk-Bl؅R ?؝=@zG
yv!iZ[ժvUz}/1԰[%[I9TM)Bɗz3H"	"@{a㶍w{;=_IL_+r?h"T{FZ}zsZD~ =eQM}k5U\`knUk(ڽXk?=m
)z͚C?MM^Or>[i?Mf֮-P&=GPD[r'(Pطo%:~Bu	Ct;?B]7դ"RhVjUjwNu4[Fl7Z{N	-!(d}up}ն591FuNlԫ3L9L)TҾ2FU|t}+//iYog :bWo_Z)v^Aw/;N/)?gُ(Nf>B/;<v?p;:ހ)`w@f>:8wowZ|f{n@r:v{vݎZy^tROz:~ !S3"Z)Ay͛|㛃Î+!J_yoK؃%5Kwuɫ?u%ZNo tZv5-TlJak~z_'ܤ<kʻ0^R`oj_;&ӦOOͨg2?}[$04~4t&FI+kT$׳Yea'gK`y^ S?HZbmԫ A5E-ghi4Mknh/R~q6+\a=} +Nwؽ"MǠso6?X|gnɕ
^1=HIHDŰ`5>əY癑qsd!#Pnw{?tk_=gn|M,Oo^P4	=R=zhi,Ntd.?|Em-'3*cNo:?y8N9(ˌ,K`jAQ;zRU^]qIYRn;9"r=pVoef~NxQ檍4c}Jd*WJOO&T?NN]{
__ӱsi~ȿ!2ɷ`7U0w[ֽkM?t^uF&zY2VE5X/kYT7'3e+Ztl[ c)Wu/f?};B2F}-]m5]\"fE m0'>B)+q(.S4
FXd- 	NZd鉃/tWGRS,fc|?"˘k##ۭ};=y}]|"vJ_zo\:ֳ;wJ_X%)<=YQ2=iuJ^?>]<-zx(3"8nVQ/F(>X)lJYW) WǃP3}>ػ0;2w_u/q	 N7ds`<MVk>cj)h=#{ 7Ó}z{}@ntTA_-1̪7173;=M_0i}^6''bVK8ӋJt~p62
%YAh_4 <ԡgcL}

:FMc@)i'`YިVD oXbchSJATmڄ2klvkN46gI#_&lZU'Hk 4]9	B֮OцΑh7kbm^ڔކos"dL"b]-VPkVBL>͉ dnN4B
k VV+lp2$ 2pW*N;329$҅tpbO'QFa4!cfea&=h&~!$UZ('wH]3yg,HU{#?@P<zPz ho_hRA3p3:r7ݡR(<#*jC닯(ɥ&@8xL&EogϽa9hz#ؠE<`_ U
7gq>Θ >t>u	*}q؅ZXL©?|:Lqa~9~TZCw4T1A~F!#iPm&ic:of{DJQOɱP؟UfB{7p&/R#a*=*)(v^>)]jx@Z/	TwfʠrN\*ѽE{AoCй~ѴajΪgf^k4m{.0:!xzmî?V_lWe"SeyXm(Mqzk^o6 ?6*+!ښ(PWjWeiE?ӫ^_1&2L(oصV@cjjsPk֚umznuU[cuj0@vS>F) l65{U[뭺]ت7썆hٵU߰uQZ-*j7%Ub56P- i- q#	zBtiDnmVD*XoZ]m6zްZU
qֱ:g`Pqy=m 
T.UQ jЮ5H^mDZ['ڋ'NkTְ5UuXof۪mF׬C=Xe7 XC<EмX`V~5ħHRtWoS6jA rƺ|7[X#xnA{CR {U5@ZjCqkm{m:#ڐ,T(QOj>W6lB%6*4,pxuQCn4*v
ٰ[-F?k	&~]vmS	

m@k	31~ј.)+n;ifA*pVSr|aqcf$(554AO1e+1З{$sPz~ȿj4A+#?>%8N _@0;z aO|]Դ~#\W{v)ۧnb<:jb.2m }v|^HK=%ZV#q=p<4nm[o?~)?7]fTf3{_{NtwA]ft:`bhWK˫c"vŜl(`xNM\-_syO3a@w+I5#YZe鰄Hx"UY1LvMNM{qNyJ?)M0=0K·#>zğbl+镼1|SG<ϐS{>>ۢo*pfDdtTm4מ6e9&y)Iu#̄晩*%IuXZRl"X8f=\l$t_7y>hA95]|:+w+7'
7<T`U˿/20@1J7q')C4&:{(bNfT\]H\.([?m d|9uj:!/{1m4[7I\x'Xg˟3|-tÇMAs&X+}!wRLs?ː8q3/q|7oÇGץloDԔIB T(cHi"i>\.4
t(_͜'U+30SЍ`rixY#]ŝ]ROʪF2%(UQyr%LSO2I!:pPSޝ+6].T\Z.9鏘{!R0#J"s
9pjs&sP`iE08u ]PdT+l+8^@/e8$R[ͲwJ&o&\JofE/J
d𴲂 Sxf(%1Nvqw)zeRbVĮdf> t{TVFio6LUu.q;' Z ($>륔-@B/UN2E}Cj4djF%ճԾ; e|߅Y-gc:%;g[2PZTop@WOtN1=P݉W(eӴj*OnpH^ěx'kֽr0$`ꔥ5!fd
D1qU%G%9rYqJwc|1q]8xW Ǳ4"ZZUKI޻wg6Q&qjB<CQe1WV \'j~u51++98paC_w3L67ё"I4
s"`O1XeKRNM*J$z&;G!!t-q(`P8Ld0BRks"H"%LJ3Ey"\C7LK:3ϵMvJe`ρ")`uzrWٲҬN:,T3dC\>pLI2BA 1IЍǡϪ)m-2B
5zpORBN T0dꐌ7opbx=j{1VJ9ةM-&t=ezEʦn UOSG$!9S.مЎ1#AJ,s1 gPK7Ky:)¡^J!FN/C[a^(v5ϜLkl4
U'.-G ;$'r	,w4ad~\vDDtk)C(H8X&@3JF1f URƭI@Z,f[Ɉe[>af	k4*l[;f.K$c+hDGA#˲NP(bJf<vrA݁K7"tC_!_RS6>CQp¬*kfŅ60iU,Z͋ST*YSv92HBA(I>XԔ׫+?mM:ܓn&+ͶL/*n0%d[6
$M >pFtG9'h]@	JFet6!q )ʟ$fX"R!%<tM`-#rW/M_s[a0R'x/,3ΰN?EVj(Ԇܼodm<~$]9QjY~Ig  :
8UPanLʿtx,ޟww
SNSvRYӀ.2У*aHT!CŠ@}YTZ }~1k+')H4|:]<|J4T.k<B_(^eE ő$7y~⑯&JLpCb)gE?- 'qt2a
d޲{a,DL dL+pZG֥ڝUNIK|.;yDz		LS*&`؊3*#tg}~rm"gj'pw/L9\Ďj;u0rQՆ[86QMga	2XĠS?7wEDai Z0^YљC4;0ͫ23aʛNTywX~Mr,ZOHÅN&;[9V>Dfm=(JO\6.hd8|&c+I{N~"P`2\WH5C'ѽ9OU.^ܺA{M/1諣1sL#ʹ8[XTyMsQ.]a><NExGae6ZdmZ}mb
aϭ8>\LIkyq- Ʒm\U>|	ӽMQV":Ȅ<~kGuֶBk9}a Z+ktf[4̰\$%!i0L(ę,9hFsGs̅ӑԑS-#;ʋX6R5b2>ZI@nMtWeHf+l!Kt\uݔC+Q 5Ews6x5)&LYfb^Hd)A[^(	oT>V圓GNuv+>ڱڧ\:Z%>z,`2QHj>AY.Bk~m="}ơ^^RT	rC1L4GiX>bRd6`QZ)iq茘RO{ɖNXv)ƽ3ŭuwm\5r63Qdf0_=8JJQlhz*{QÝ#P[	u-L:+Q}uxZ} 뭳Je\`$l#IcS0fg`aX8nD%]av%)(AlYA_F/⋷JSHnwDYQch[\-\月rO\J9dy͂qs>Kc5OpQXz[<O...7S(uzE'S۩er_qN}<I6S,ܗãܾ2B<+ D^jx) >;w3w0:9qLNWX5dheDFK/{q<(V$=k4>_Av/X_č@ㄧX	65vn4^l I**W ln.rP*@%%ʃdSӬ5K]OzUٔˎDr ,aؑfA"7~Xf [N_֔>elyGW?zISw֘^Ay9+?*+Tx˅`S+rW򠳫i8+qՐ0:j :,LW8^éA53+nm龀eE
m@*%A$Ae(\hv)/X/G.: TL	-)W6-͌Ғ5Z߼Wч^͜|Ϡ`k&OE+&+cg+C?ޤNK_4܊ldD6[<We}\^~eovWAԀllv\A+1#v,`pHÙgә5ͤjheލ܇}<n
mu|8*HxPy\,Zt"(({.@T.\y`R'ۄ|zN0n=Wq)S}C<%ХjD(ԓ9cɩ(rtdGӸha9RRhO(ߗś[[ƞʓ@)0ngk׹F$zNÅ?`AsQ4Up}Vҥ\FhٙB8ID/у:J~%JbܛP^ǿyBs2lVп~C_7IWe=z5eq
*Tʙ izٶIH콁:rdz<c[kM>dnZsݨ]$e[Z'IMt5ENޡ6Z*"6xos@{߻zuw3mv똽o:7DH~닗&0["J!9~BcbɃUE/Ԋ۷q4QL7d	]I i9ήޛ?x(!X3{^G.v׎cÔ,"ʋƄ!3@y81MρOLZj˧O)!>A5&ebE M'NMћsgr'QpZ:	@HTJ$fm4,+dұs!
NF i`jnsYN1 ,;X¨av!sn$G/phwvn}/-OT|#ׅ$zjRӱW1vޗ@4
P3tv'z	IἝ|"аթH1,i4M1I%@Xx.E`5CƆQE2 fRRٝs%һ@51@zgfȠ~&=,ݘEd]xTg2
2n]O1jxpfQ|LrZjT{C%&Эph͜4KzKҟ,&dFL>gDأx	4\Qzw^j
4pƨ+Dty6Ei!>s+`PecKut ޫWi3=6x2A,ok9`:qrZ=AYP aG=ؓO7HAXAI͘wY+hMir DvKC/cɂ[8|Z2*:XPY<nCǾ-~#@ ;|t|3a/t'ֹHH:I%屬eix2]'[ccVIxѮռ^W%)_^<'ęy#_ h߼7aa~?>D  