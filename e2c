#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 %] vƲ x^"]7Y)Z%(Ijq:e
$U)Zd~yzzy5kΗLDd&	$PU$E{X%2222222WXvzhuXv:7vX3E,@9ݑz qI9䲱h9i`MvݾG~6X~wZ}E۸wrQ_}E?g |g0?<4ps>_^S-[fz@J	E?$k=hD~W}ɥ_eyoվzvE0c_ٹLΈxX(i d+ر7v7=yq"7<sÈŧ^DiG1.;ry|v}( dBޮūq0=;|g+ߴ51Ap2dz 6̸5J&O)!h9¡7v0g4X#pm|p23E3D8;؍(rG"
)YZMkd|u:no6]\#ؙ?/UOxZ}7T޹igSK9ѨCB0~OϘg*?V1!pxw#\idW_͟ޱ7t`нsd^P'1B,×QmaWEE.4Π8J
߫_sWFp~[okZ;;|E?GNtZx06[08Gx x4`˪v]vsrs|4)n1vg#vL8Xt#1~q?Y8?_|E6&|D5+^2r4[!CΜNHjnUYc7ljwD7\'jyzGCEQebϽ $,KEv.ARlQ1-*EŴkwyWmjl kdm*ME6^2|@X=ۭBƃizl>Q$,S~uemz>U+$2`@_1UWuuGv*.ӟ0ʾWZǼT(H0j86{Zgu6?5=/wy3~AIpy)_d]q4g4 T$UFS($r\}`a
W5'Iy%yuЌƬ)6H~ժ8d}%Gn.IN촶*~ni[G_V*a&'CHq1{zv/vw^v_~{5j/߼tpFK&BL{;7[?[ͥ?yO788&4Rxe/ձˡ>l6OgD-jCmr}vr |t	`97z*pOL[ʍσ>_F9Q}ŅЫjLAB!t ,`Μ7sJ tY賆J> <VkU9k;m{x^Zkz+%QCsWj5`t|iaŀ0t.283hz1$=NW'7J2bOVoU(z{¡l2,$1A*;qZ/ifx0uӲ5jV(C pM8iDQFF$с;F]_.uQ:sE'9I?iټ %'	J*4X0}5Fn`m댃:'f<rh1ުS
zY
p h$X|;W/(G=VQd;s7weN._ǿVC76\dPEd邦D*
;]w"m?9zxg0@/^zĢXʌ~5qO6*ʧ`2H:eMAU5H2xø%][ck+5kke>Z-YP)@^E";чA~Yڙh6A8:bʾҌ	SBdfKl@V}I_t}#˯:EַߦW?yMAv2/K'g?6aow
sG^TPγyk[
ޫ򌂢49Yx碖m?F0/p%( 0#50'|+DdV.ZV(c֌9Sn~_y8 tZedPkB5C?^S$9XJWSE-D'ȷy#(t66돀Osi^ƣ|Q.nX )t? ǌعlx'ȮfV#/`n}P۲N1`e{`U% xSx`q;Kͅ!BUaԀ	K3dXP6׏e<,΋s'(75ҹD:>]e٢ktT9-Mnͪ+ɜ_ii6śzU˳wt+8M0D"ȿ;daQ=U5
zI_1r(ۥ5x?UaYfQؿdŞLTeMkS7ZK~e'yӕoue4I#ļs`ԕX]v1V͕K(J_e85T7ozc>zn"XEY.[v{?wÇudӐҒV [ui(˂H-oْkixv`ĪS(i<p\9w;.n~Tl+Xڿ7PKG;VHAWmǭy䶱kxĈ'ޱtMFUV}uQŌ(NؿHZmBRlY&pa<WdwFG7_?_l >Mю3ǒ#~`US	4L5eHv:dҶiyPA U5jS CAu?ڟ%^W)a/:+tmq{s9Ɍ,LY|>1Hf[{UJZ-Jk1iӞ즥l
Hg:w,|w8`c@vE)-©*Nzfu(xMx!Nd(	"ȚLc%$^0.4TE!ab]$b́rڸcDmo?̋nvmEdojTָufqfa~ũʊr	IYT+*Ә
XQ&0ehǅSy)cfq9Si	aYIUX]b6Pu[0ֆ_N~EKm6 ^ʐsD07i^c`@)P/B^	///~/S.@7fq4hUiCR/yazo"mejdehf)hiEG_HhV@+CA؜nRsnܮ5+)
H5;)I#LmC斓ċ1B\ZdϠags2[/cIvIیSK¾s1-JK<:SFA/כ\X
~&C~XP8y.w]=TgK$,VJYa$p"]Yra4jTe\jEF+a0lhQ|dAnf0U]A/ط+t*hLVb2I|p#VX@1 nG4*jxr0"y)Öq]c?&]bNZhAs>"5zyCHz%k`:Cw2-zX*UT>"f@Nj7(G
PGrc59ʱMXի+]'=_Ł-AS)F]IV>G#$<g@_-RPN,IaiD"VcOgWWo^]]~Ԓ\Q	\j`PG͕ȲuZ'k"ˀ728 9%5{5|~XZSc~IWtr&h?//0aCO'mlx[4򅚣ٔn4`n6ywfImanc"
_;2'd#ZUFtvhin#{5Y}yA2/pMgg/;[{3>w.<dZag^A0FS <RJhvtr|_SmA3j)ʈȋr||I<C|AtGV-Mk
}˱ǍQi_R~Z+afS`Ad2) KeE.3%z$5ݽ1pAN|f,3wV{hA
!rol&ho-ˀj[Yw}|B7+ KE +AN0t!2!N][Nk:	I4d-ՖId.7=9Jv-~V!KVI#9O``fBԹ~n@) (v3ԌZUY'A`2jL g>[ԥ*:<#Ne$v]|Kʲ3]7Es0_C:֊;+vFt%Or/Č/ȶwPũI,!ki͓1҈Q1V82}ġoɳ`<('Rƙ;2FJNHQnᇊ^ݑ^:@|JS' k&) -[BnwQ\qފ6HR̝=BjnNd-2"ߤ;/,FBLvuvx}~^c$)&tIb4[ 6)0GWƴKnR&N#,%'Y
,jvJpOveYu{T*WV5$xw&_xART2)҆_9s:`KdVTOЈz2T RR>2PH.G%7~t{H.<9fPEM:%)+(ScFIR9&0ia`$5'´bܯ'Hml
EM19RmѻGۼiw#}p4>t6杷cODҖL99	Z՜P+=!vh%S Ob̔8.k9Hԣ(#Fgdm4ʉJdJK\w_ */|xʔ4B 
J5A.*FM"@`J,tyȂNg ވ`[Pk@WZ~aA£ejy/[b?y'coNaZظ	h~VuL.wSi4lh	fCR폓"bۍ_U?u*2HXZyYY=&9!<'VE~w4ͤU?X52ik2/pH{%0.[.i!A#edЇ	y7䪜;u0z3I%cǛps0r9H&.MjFQY@_2ɡ&)Q塍%E:BY%M-P@r۔\(5?!J~ĩ~`dK/<[R<k,f'#*G3JIވ-TU-)IA$ +5#ʤ)Um+c58J雐HE]x!	p>W%WYwÏ <d	E%ޚ$5ޘN'7Ƥ4iI{z_Ȝ[K)vPz:|%q%"?
D?	24 D}|J}3(3Aߤh5Bj^@-LVPol)+$M73({(gw\p0mh/>ʭ,GPI1O";!Cde Eh(0%<ES7$3f&5iۃJ.iT}3KyOyYoٞ(qI)4CʹfCe6%SSq?jK@ "zVC25&FNii<]IZLji"0SuDY'qztנ?Me&jPP-&5KnQm2-FRaX)nu]"(]jKTbE'MOtMG޴MK4卹ⳬEV"UdITzCߐ7$	|Cߐ7$	||C ߰e-YB +HHI1v5;$	}m$w]/$wUX~ VR^+)**$i%i$I$</$Y=]~<#LЙȴ,nYb`:ڳ$;tNdHʲĄN襉-jT"Sб)k|nWh<r/;9磴F+>hgGj8$mFܢVWHQߧpKϖXdl~g{&&S;Dw1ẢXKz&/֕(^RG]UÇTY({_egrTʔaILMTP!P/ޘ^jh M^m\ʛ~.~҉qG.e=Uly{SL`hhWT'jӃ}(*BDzc2
͑ćFiB&sC?`E<t
IFXK$0j+Ef9̥ݵƂax凅qFBP	)n={	v-K.sonDRع'[(يDa)*7$^mmryfV;dKJ)rfɑ#2-!]S{)܊l8ԞERbw9RPKwiMI\\sZh:I*- 	0GYB	yhH#'0xY
Knyh$/soE9==aPD!G&aTN_	*- =ll lM:]M=ݑ{JfO8?	L^kJ߆>F\77S^iW݌a)U!H6//nD"ʶ=WX_xZTg޷zGɗIx3ōYLAW]tieT˅Ѷ,~K#r]95meJ/?tyeNF3Z"ڔ$+&w\1dTjłlޅa|{;:fhݘ81㙋ffE7k.к$v?lId*%FM䪮!1wG4%s?O:88wõFjFv7K+jQk=h A0z2:x-1;\Teh,'Q5-aZajC'*#ji25F.4~U%^Dr7v}KE-&;雛-4\_b/|-!U,會dd`@]-ow~NAecS4;G(:ӷq1U De/k2_<GV0S$Xl# ⬅_vyylVj,ɡwY)Ɏ'{!x/ьms^eҚ5h(/dRM0Vsn66`kq߃,G_Тʡh2Di]V_͑	zQ<Kif7rGcgte5gj5i\"?ZulXިql>+D,*0M65i/޳uuXBڒ-Go.ɡjT,c /d@\a9\B$ϰ/R~R]$[Ӕc2t>GAd^
Ƹ~<~&8_E	XS1QqK?5A\O'sZ򜆼 pq=g.TI/(+o?6*y	/Q ()\ƨi[Z΢8CߠTQ$*4_AfC^2ò%羜+#UtXYOgGtݏc鲢>t3 O|'̓!ȇvZrN_
QEUkJ;vB䷪q*qWVkxy<%ߎ	)אLcgSc ?w$hCD)]H9/%e쒢_N@O,+
%IƐc%I
ĝ\}hZ0*_JG̋[Iҥv
e+iK;)FO&Vp߉$voJG:eCݑ~1xuUQ.\r+1u<G\og(ѱ<º13?wQi&_??%Ql̍Zy]˹(˖AP< zg2< 	#8hl۽ǎ2jUrx L;Poy9CM_-`ο};fXw6ѓv:~4.{#H3nGuz5 L_1gv0Ч;@?\mVۇ$zƩ8u`AKUVN$ { wkOJQ$rpAM(>'0jHFPBs.uTTLpvN[tFL`e(B2Dtl5	FKƔ+euqpU.ػdɰ`O#?ot]?|x|W_ɾ{Y92l%/`}::ðI75J)F@}XFbCޛ诿ttHy(eftKV+ătYecHOnHZgm`{Ս4􆕳iN,׮['qoׂ[>!'cxlINy ki=+De
x	-ߠr;f^5
`Ұ|2ͼ1#",&Jk	/Snj^x_ԔٿZV!יF`AI0EHuZȳ~n{#6qXzco-׎Z k<lSrcߨ(959"K]Q(C4^.y$=/آNY[D#~)㟖+cJKk"_zƀѭLM	Ւ[DE5e2wY
rRlɣ:ik[2L5r&1fa|獞ڊǾau&FӒo2U9uL݄!mXT%ۘtfGuKdZuBr*8%{b<k)஬QlQ b,f֐5-xPɫ|J7zj5> o()HW7`sxN<c9H:BMTjtU)iJ!FQye̎dޡd'zB{U϶2mp6 S誊ʠYŗ*lܤ PG[Iujǜj\9*sQkm3ڶt}#j:BC@#챳0gV5[g~":w%[}#M~Ɔ,paAJ2Ubo_%Ά`ed_܂=7V|)PXz<[RM֘f8dcx-`L/rn;vʣ1PeJ*Dw!NY)jSxxMYd{-fxq.c _VyHCq燿  K#؎p\QS{ƕRBZ쒴)F1L& NP UMV'fc׉0eyQZFP$^X-x"=iUQJ(qie:]ZMAǎ1ު$1IxB\X;(=}_̜&sag)2CN.hGs,ɞz0ۛ23szF9{ҵOs--[yfleQ+&Ku
:DM/>
iD5ΕB\Ix<a[:Pgk--낉=i뙞IAdE e'm'ZJT*D:,sn%4*,1u<8!CH(B5wu2eeڑxaOP4۱aNU5[,5.#"̊F!,!quq	ng`!QLEXH$&nӥudz\5sJ>C-KtlHVzȏ-1	h8LWa"%1Hh_&wcF㜼Ý c2<xAKԦR<` +&1eA,j0xq<g4 N/M$<
ɢZv'jT*	a46G%	ӗPD{ʣ3ZR$^8rf'K/Ԙe.%+6H$8<\YR^&RWԌre!*-5-wzu"#uڞkV;)E@g$US҇fat+>C*L8`ZiD\eۂN0YsWa4p}zC(,uL[Wua)3A#W0 ƾH|V"J[jbAq9WHNITID,@jj1ycyۑN@\:ضRM+O^K߸?
ݒy13WV.Czf<Ou^np΀Yuݱ0n|\R
SnNi!c&DM'|-z/qF~.7>[sqi\21S""E:G}A7.բ۷:K.\{nZ֭nnһܰ\ƭKtnsnnDCGS}E. ([	շCs+ljҢ3;**VvDҒ$EXMpp젭,g <]MgeG/NwD[|V݁ݴTSr]'bi=$ędi.ި@%͋!Z+kQFoY8FB;Gf<-l8:!կf+MU_Z5##dTs,&P\9zO2de7m4KE=SjO֐K$'(dhęg28ƳB߰ @*ǫ]L<j;3$ҎFM 6ZN&}Nf'jia3L
J_olZ'3ih9!*$ʯOdaV9n$a<2Yc1}d>bx
cD]]>y]]2aY7Ti^k+zjM[C"q'\o*0e	*ξV^Q~X?YM2ϛ*'ΦX+@Ʉd3sZpN'5bZnvT޻߄zke0!o(8ZO:J~5jcJ].gp#(owag'|8\Y%8Z1`qE7SlFQ6umH\%07dXTf+By0ς9Lf.*.1% yAtUOJ3<	qۑAZe_3MKJ˒m$~g}{}d};$<9mZ$yM%9 D#FkJK	7\(˦eL7Uw *^}jSٗLr)_m/J+X&1U-Xfܐ,ωU܎<G}<x\x¢8Mu}uo:~NO	=(u1rS|gXv
_gMT;nny/9d>m P>3|GxO96cQԉ{.AwlnafNŪ5ƾ)𤰈pQA\-&+n"k ^n^kaVAL?WգjB{si5˂Vs=ǖ Rns آPRݨʍgS]j9V?1bZ0̦S7\C#w5 k}ˮVMO}t|T.?:(rh^Y[[o2K-VC8d?۝7-۽U-Y#5qL=Ğ(UYMz\x)qm¤w.o*.F֧ysBr(-Gt7My,T[#r[FC#2n`{LepάRh5.fx&BR/t֝n!dJMY웵r<v.Q8\OȋD1{N|bm5C&xWoG/#rJ`k?ްD;Cv9p%1}-E#YBl7n@P9[$Оe{l+q*#pʫf{-Ps{	W$ŕ047$+ߘ^cYF/bl;?F	 ٠6||!ꪾH 6$aPU~siBMjAV$_V)sڷ %y_Ƙ֐U  L
[IܹbSHqx0IV 
M?E=Ӥ.9mwgjz6=u5xNo`;=2d{'OQWxW`7jdhB`$FNqr>-$F8m/`]T)sAp_#>6 %:@=#z1vNltPRI?"TTdEgV34<<S`Mͧ"gy?(hM^*cbnWB4vb	Id5	3D-od+t!H icvETJz>:[D^DRǿ%b.wNs&d=X]ZJ>6]RK#6#몮ŝ#6B]ƒa$yCSn<Ea/Y%2Y.	;j*9ξDaO52x(iQ?tn4:<]CzKD^j]TFbrTLЊK>&/yK1lH	7iZ@^L2f/:_UvriNQ8cFe
- 5J~c|\a2=ހ?k	ߏYw_Zq"O݈Nr@Ǒ]CrAo〒#)qQ$:(DG#׼ePۭi5F.k5|/|ZjZjHTp3qj8l?y61GKXGШ?S-crZ:;jA.::7KeiՅj(>M| a%<Et&\6nC>{Eƶ(e܉QHF#Sfѥ;ҙ]F_Y;[Y%/F.dƵQ(q/ʝpV*EyT
et{q3PX(97JozSVBen46X="Ҳ0I;3["zWO//fcw7b焃W'aVU+1s1AxX}IEa,<Gr]nbw/kNVTjƴ|l*Q#*y3\0>+̦'3*Y>ɾ-RU.Oss)otHQEse殚lx`̲'ƩMmv&Rs¹ڍӣf~)^ȃYoUy )㨏w͕OѮ -)LJe$#t
`toI:ͶP؞</K_
&W 3$+kC'V2sKy)khu M
i5W4-!ctAgaǞN`:á;s3I_\x5#p|5Auxco<)/Gcϑ*{>E/׽03aŹGCFR$<1>bg^}'^|:; ꁂ/
<9S ԥy*w;.i:=v%#Lz{FXqw&?I>nESeH_[(hp,>e[7IYL
[GX@~zZ;ɺXlj\_2iyHjI}-Q?Ǐ(=pQ{Wr6ȱO	WUynm3&Ϯh,,JMqsmw<[igBυ  LO9#s3M5H5h.2olZ)wU2]~/xƝyJXҚ0%d/ڵ_^~}xj>%..5\h Euxic\xM
C"Z<f>VlaHҰ_e&3VuuL0Qq	0͎ʪgZñ7P{Pߖ$hQ%$5xԉ>:Sz eO4491IǸx9huʰ`C*_acLlo{7j!%&hl{@IBt?t._*˩8kGJ|j,
if%3 އ~_JR7ڪ+bѺwA/yʊP@,CAF!tCDYJD5sJJb/+jAz
c>P0@&F/,
2l]k[,`?'͢XqKBkcSNjgj,L_$
1l`]^2ˑ>tW{O5RG\.mm"(ɔD$fЄ}꼉k5Fj	4裤]d_"REk.}pMF<.>LqbPXl${Q+z.^(`;<(nU{!-r+};j
?
sa5E8eq[DC9wEnGr#va09$t'1v+L=qpgج/ʛ/9XMH$wn0%p;1'/^ 
`UE/,52!:=-\e7,=rsR.u[1Ttm)qђUra3N0~ܷ̄hKtgC;d:ngﯮrkvZ4n_nЉgk~#"~^?Ch7 3Ot:Fu<ۇ[AtB@{/xO=H}q:h^0buCQDRԹ92py
ȒZ겮P5),rmy%x:y :UZ=hC;)moZd(?Y=8>.1B*(,|'%L8W\xV٘zYEJ XSuF5ۨ'Ol-r=Q 1ٴL,k8ϸ( f㪡~PbPhj?_]|b~FceobvjN5zXA_3\(ǡ;B qI9R_*Qnwױ;KgtM+C@H0~Yc N[?~5[?ƭAPr;Ju(ȋ4.;uu%+/*!	T,"ء"<FGt˰"Dlŉ
wTGZ~K:Fٮ-.^	b$c]^:k$8G.ku6̯S7<".🀨5jM>ܹjj>VSY !&416
yE;&}0ʯ37:/Ŵ(i~0;>m%B=U콤ɔQ_F:uű`gfe%'Sb=)K=Ak^A ]:=EdJ<;qp).@D)`3q,gV/.nMR\kc|zY^,NC/+&^L0,*HΣ훊RN]`)~"rL`lbAi	|mxfCr#ExqZ*܉l1-yAlNsf-.-{..=ݬ016x0r7?0AF|BwSpΆfiz|#V&>
ERп=oDX+6o8e8驳캍/̬SGn%pf^TsSFy)%&Mz}N40M/:6aPZlo:Y:4_]vrgL݀AzSh60-G{$Z3wOk]ǥ{Aw5IA)G-6{s'p:dbDG+t+w5Lmn}`O?ZF%66Ymwu*B;Ir?p{v4E|)	b0wuy!LKL_ܱ{1ʀEc~nPmác)GyH2y? 
IVOD7F&n7mN~U<5fEzɠ܋㏈鳕f~޴vs
SOcs
 Qr,	+eԊO6WکCt?A[7ͤRHmVbEׂ_̝_m]\1-!d
yӦճ74>1ɘ\ތ<n5)9B)TBо{	
jܕ0nyivXkt..W.rY[^B{/hw(?ُȘ۳|ځj_
yQ~2q18SAfk߼{?6[[/v$/vY`ο}j/I_烟x_P$4e>#0͟^>ȧIo??޼˾"2dza(vE_izI˿MsG=y7uzCٰnyڍla㚖M뽭~=xZ˟0PowAGK/x͕a4m%<n6S_c^w'W?d4߂&ӷL%ӉS&ʃA&<ϝ`E%U٬0Ga%uy癢R+v00'k.+9jp, 5/
hO'jDMHM~FMgd`P(gv`JδP=8\eSG^<O1#<<TIZ[y{VIt򼟩s3=}3~}n
X0ͣat\_$8@]M6-\݉Ԓ,/()ٖd-7)RxHlώٱw̡
\yrAY4 ^_ߛ,5ěHgU,/#*jˑȁ톾3c_zMyfY:;.+,qTkDۣ6H$P$mmTϬcZ2_׹>Wj$:\׳
5.D>zeLqeHc&z%8d׵\
ee5ij~k.#/z)`:ݽwqK*&DEujr+
Ϳim')qPkM;ZhXƞOf膴/i)lr	K@nǝ\IKu߼:vk=.B"w'!="S{\	?ɛsc.h6iW]@iT(qI?fս/:O}d{7ד>^Zy? H'WV댞z2qcG~sk*>^<v%#r~sQ誒D	\zEӢG8c+|A#7EVJ!`ϸۗM] o?qq=BM8H?2?a0rd((](c(:v&bM?6lfoQQN@ZF>AKӨ8hG1)ڻV٪^6L1i/8&׿Y<P,MuNNctPz3=7qa2*	|q2~u{nQqo֑9m;O-٘x!|XEL	Lix_nup
H
~]g.Lǘx;v|-{"=ad~zh=v674@ǚnJXWBu:e%4֜"z08"z&=oLo}Nnp$d)CbK4v|n?6wJhjkE<^IцB;mB Y RL'))~MF;;o4y10\u0\&kbO,8㱉Ni4JzYΣv^;A*̥EL	hÀ{OA&;oMz potk҈Gqn@rhu܉R0<3*h=t_OW +;M	`
$QL>ݠqp<&BΩvn$1j>RTPQkf!V茼Lk##/peE ۍhXbš BgJabJ,?doѣGYnfDy	r=32F[&騚[`cdE#%GOB`R˛0?pLXG~Ue{ܯ>PRP*|]SI*XU
Z,wfzN\ΪҽE{hdCvQݱaiN^ow;{zsC@ڭgcjݐO23ċAׅZ{9$`lw~p ]i])"Jߌ9-icB	}nv{}i7~] 쨶it͎[zwl۽6۰u`N8uSsnwm汵n7zյq=Ұv۲ u [mvn۽Ɔn@ZUe: SSOA:-0ٻ `ѓOPuF  zǆDk^>F(>%hFjFmc۠- gy7.oV݃&PKa@RCo({l[A(wPx#y赀zHQΦht`!atooG@ϝu]o[6i6Ng5w 
v^nCa-|}lAb} zʅk>=$MUwe/.
@?ސOc[?i,F;Qd9zP:z[^5Ce-M=~ܒOF>WӁFoX<yqn=Ͷ-XO5]tFذ-XJWc.,mHF¾憁q?df)(ME-7O:bJ2RtTbyPSyeJGL2jo/b@5XjyLsAoE[ठbF>1g{u@_aO|_Դ\Q0ưF}M>qg	j,؟[-w?bGԳUp5Gړ:PCֵ/9|4\uweWlݟWGNtZoKZf<<W9nU+k3$d;jyԇk+j-d9WFaErpQ;z>L<|ǆgb}Λd男k#s|>Ç.^÷2w8'd?yڋ]W9W1.cw&+s
Ezy˜^@<	cg+
KhIDpgƊu;F1	DS)ǞWuֿh-_sG/*I/~g{.)GL_G?dLҷt 5#{`VF̊+ͫUxuVVj5>?B1ǐҥH'AhWi72I:'F`̙N k?`0|;1M/,ǡ7ɆuPxQ>zIf?^e~-?xLD	(GJ߶[ﳐ{qP]ewE|dWRW(ϼLC7eWZ[TyBPF04>Ech)'LCH'iEj%Љ>pb4(̈tuܿAn$;ܳ\˜41g:mFLN} S8T٬ִ
"ۋ4lcAjؼ`3w?n_7Υ7Y{ڊB4V w
ͬ`JM)ƉƞƛW],Ug՟RyC={eT77GTBqF#h@VK ^	MqOREEBZD:F_i_R;+˙3FNwp3sk a0"_OeE`;`|_-2pcw2L˫o&b=PW7(%ӴF܏uxxx'["޽*'h*(#hQuJ2d
1aU%9rYNbt6/mRvL o)Mw{nv+URrΫg	٫=F&8k5F¢	U6JJdlZZ7߰>It9Xu eOQ_G&e$4th所<U7P\2u8dhVmRW'e&G!&t%a8cH$(LLiʧDr+?UbCF.柒Ǫ^JMPռR2	'@bFLlR:=lYit'^	F\pILIU!a^GcB5R8f@ut4ܞcSkRVmCbɺ o^3<Oޑ7^b+tXa0<|%y񨙆@H>|ZO=$'͉r|]Jz?Y4V+bb f_]eOӕMMRB}07r
ݙG3d@	|D"h!,5eu"Bq.cSR"GG$#cgs'"L]\_#E04jdYJτ*y([ UI7FYRnQh7#Iۅ3;)XЛdnH42HdxYW8|f<vӝ/C"\FaIzNm~FYo7Xv͋W̊i
[
	6kW:T&sd30&P2|&!(kzF0s찷lb߬PUqT cduls904(o
qpq%
&. {&m4rSF3P~wWeSMᒐ<GR:*t	bdPm|ddܨ|ɉ/fdT]
5pZ|#u׸`fM(ҧD4laT7#ub(.4rwd)عs%DC*Qr^
EZ.e0,y6٧dk~Ѹk\Uk8`Lv7SwcOqWX\:۔Y!sRHo*4!؇H1Ui}!pOMUvU@>(u=p?rlqrP9GcK[bN?}(i>ZOlo0<-{^6ung_ؕ܉Wq.d)}?Ph1æ\~їɻ@,g&d.z4Ǐ|̈3JL]
a'F7ju{P f2ᛅ{w,zFae!|;qmvWpQt\x++:uG#<nFj#y~u诬ZO-`wۯPe%@r8:dc?,aŝ	(	]\2iR錂3]L;H汫.cI9E;BPGOkVNxQ'bx<U߿&ؽZԱx}34(ˀ:{l;4KӿMp,DڴEk]!3³aq,o9V/s6EEܞ+=n0!D~u¡[w|Xޙw;{foڹ
}zl</u>;y"7SGu`|u 6!UnOkÙ_\NuՅT_a dQ(XFO3YsVVˢs	2[NFRgN*/"DJՐesʀ,lIgFST2	_34!Y$Rjm~	¸Vm]BKQ5:3lj\L.Ŗ&$sH+cf(`پ/>SmyAd'Q}HZ3bzhNhs1@EDq'u:	FNf,[uWNt:cI/S!j !sFpOE;P F5!D[s(Њ8tLi
݃Q?,x[T1T$C^}C %ciT-  CY[X/Yms
4 
~HP܁Yv5kL}lo{Z
 /DU;?A\|~fAu+ c(Kرٞ+ߕT%shE|ӒAm
m0<w҄mwM鉩[5gX+ 1Mpm֡"ǐQHt7`G#!@G|t~~H|B@Qӳm:):U*Ir'6Oegs:GЏ=㎔(U^I ?bXgtꎧ${8!_cKlRmLhzp<mEK2F]l}D<݂#NX81a+/25n5^l O**sTU Un	rPW"IEIҠ45RS(R6S8зHuHA\D2o,?h;[S/5^ WJh%O{<	rFK~3~le7E(k]!r.]x3˓pǗ"$%/r
@)BI(_ip.L
IfDj$ؑWG*dV.H}U*0W]R⋩3XTʦk䫉MfAzzhi&~aèfNxB^K`]Sy5=RSܧ"-PYQ)ZRjǞf&ǆsN|n]\z1`-:;;s"7{?F1k{m1z0{_*&KVs0\хpGbҠ"a6þgSLMc%Q4M0OaVX=L",_+
^L+fdO ʘE"?2g:H(RX3''r/lZ|,~D38W{HɈa%,~:8xC6Ih4;iw)
$ 	EIj!"ο6g*{f~H?`N̄_DX2Z2=eXJF&h/KQ.z<XI/ )l,,acMA:Ձ7tI^n&a ZvL`"'6icʮY-s^E2JT
\WYwLo!YE^B="N88'<WXmgi)s$^HYV}sh;4R5x+l/f+ycJ.yW5?7ۭwr_Wy Y٨88Exev<ytPtj Y<a}V%{q4Tޙ3i
^$S{_1:nNzsIЁ!5HK g.KVh1+l+Ð6Ḃݒ%WfA ./+QT̟+b<ձL?QdI~ bZi@ZRc1x&HJfQH 	k:	[mn:Rg^7!#םnc25^8ZBXW?.Wp}	3Axo%usG7gln b@RsսwbO8!KBy(cbb{4N-,K5c`=Y:}ܝ:,Y-@:^@U{Y"Ü4)HNuź2(v<鼏̬Pd[O(muMDAWA(!H7|HXp.r-FYс5u@7xMYPqHo)F;oPǝKmOQkbTT*لLkĪK; #nJV}V23*<\vQ$*`DE0v)XZ$#YDneCl&rAh^9 ۱X<\O!6hCY#ᚹl Geo&mOʀ
T.6"
b3Y~%h40`Y2Kl8Jȟ9Pɻv{_"$"[ c6!) } >s ӗ̭7/ЎVKx[.T`ri@Cӟ$YQ:GEʀjA`>I85qeጐ Λd~!2O%]t/'+( .;!3np~9k	3g~	Gy'ceVal'̙yZ{C_ssoZ}}C߆_ h 