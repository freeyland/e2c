#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 G] vƲ x^"]7Y)Z%(Ijq:e
$U)Zd~yzzy5kΗLDd&	$PU$E{X%2222222WXvzhuXv:7vX3E,@9ݑz qI9䲱h9i`MvݾG~6X~wZ}E۸wrQ_}E?g |g0?<4ps>_^S-[fz@J	E?$k=hD~W}ɥ_eyoվzvE0c_ٹLΈxX(i d+ر7v7=yq"7<sÈŧ^DiG1.;ry|v}( dBޮūq0=;|g+ߴ51Ap2dz 6̸5J&O)!h9¡7v0g4X#pm|p23E3D8;؍(rG"
)YZMkd|u:no6]\#ؙ?/UOxZ}7T޹igSK9ѨCB0~OϘg*?V1!pxw#\idW_͟ޱ7t`нsd^P'1B,×QmaWEE.4Π8J
߫_sWFp~[I^F~+9rJ;' 88rWM4d\V=l߶aMqvasG8`oĢ`61?b+*1#ŬY9*;
v愾p:GUvʪYeSc'a:Pӳ7 O^=ۥۦ-ۤ*;} a]*KEvHj.WdiQ1-*EŴ\Cȋ'MnScY kSm*MEA:nu07LHfk5j$ga+kQZ ZYǬ;ڶUvٟUU:
GATQ&gݶ=񘵞5pyY˛q]3LKZ 늣y8"2=D!sﳝ? V0ү>Iϻ/KfL>@6fM)pG򻖮VE$$s/9rcvNBwVe=~`=ͤUsM4:R	$vF57<Dꮏ ٳ7~`prۃ~Pm~ৃ7Z5b>:)j.1;,V1XAdy: rmQCj.L틵WDL˹)ԣW'W?}`Wn|6ϑR-.^]Ukf
2u)s؅]x gIE s挽H̀_WB5TA ɮ|^e(\]69o[ֿmXÓz_xk^)jڵopR[G+|KS,<s|0E;'̕q=oWC}@}Dѻe%@gE%	RY& z9L6ǃըaPBk}M#7n7Z%l 46.2tY^.W>IjO`-&>qN`P/W٤Ċ$a0rk[g9Xu?|7#iC9VVkBU+E#@/'/v_^mܹ}A9j)PmdJ%+ߙ.pr:OA0%j,F$K45&PQ7颇8i	ѻ+>a O|"#ͦ(RUf<iF P<TVW>}A*)k
*)Ga{uU-[[7Yc_.jɲJ |/)߉>bc̪ %/`΄@i\,YSfL`5"+6#\`擄KN%˭AX~-0)6-Eq?+Oo
×y_:<	{[~WȞ;"v+/\RP_^4g͹"?lv^7r退}Ʌc/<\$FYy9c?]%¤&t*@Af̙pv`ߦ*C6'?^jb"!`R7`縚*j$:AF,AiY\|No0]p(r, tTH	Sg8feS?qGv5}sjf>eܖu++h*Iƛǋ}ݩ^h.կ
LpN_h%Ƃ~$_(.+aq^;EM%YR/;]uiirkV]I̟bvgOSM)l{ϐ_ml3\l2!A!QKRY3Gx.K
2(忈?'S.^` ,kM\+	R_+;͛|/K୏L!'kbj|_BQ*#ǁNf>Ȭy֫tov֋p*rjT|;a>%k,̰IWLުcLCyXDmcȖ\Kóе#VBQMلRȹ{T,tq; e^_1z5%40X̿iZ]:ݱG
*\n;>n#]3 F?=+o2ͯmHv%Svr(fDqu:E҂$hrfgj4S"[7:WPO_zfovD1v>)JH	e )D2C׉%M]J-TcB3o! n`,J	{)]$5m[[	OfdazloE
P5`2,L$'Rj1WZ4Hۘd7-eS@Z>9m+f?ñC 3g8b+JoNTіwo{5ӶCkq_&+E@I0uFdەd?. =ui,
I*&cf#?=;'jxg^^p{dk+J&C|cV#M37ˬ+N$UV|ؖKHϢZQ)ƔW02)Gng<.̝0f"'.KM3c& uHK@HnK'ƧJ4݂6P]ڜtb+Z2n$U'f*T$DQLR%L9z5 xeJ|)p|)0|){bw!0鯭43,Ab\LE2\x;Ӄ|i+V#-C5KLIטG/(FK+:DBZ
e6Hv[Hwv4YMW@ٹfNIaj4e'^䧌R`'%{?SÔzQl͘LܞKKfZiQF~_B1guЩ2
~ɿެº4UP3q-ƂYSwtT$:f^"a_*OVB#ʚlUXHT*WFW+2ZWfCR5#r3$
~ľp]![XUydFf1H#7vmеBw Yt;rQQKy]K5b1B@-uҝײ^0Dz_ɮ{<@(_k0i)RQ"L6rV۸YPG9R:QmXlĪح^]:*l	r:N)0JZI_&?	Nܐ`%ĝ>jj@RtfI
K[`&_;G O|d>bx
0ƗDZNNJjTTK>z[8jD]4ܬZf=^uYɹ,N/٫Q~X}՚ZwKZNOg4LF5$y7~:qlcۢY/ͦv[sɣ5KZn$s9mP7ؑ1<!Ъ4USEKsx(ݫ[-KG*~F37o,t=;{l=x=?;Wsi$*K??1jBxAdPBso<`<GeLjV{OQF4.G^DKrJ(>^h1h]CVkdX=n(J;drZ7J~ӠB&Y,HYH^*+t)~&dv4f%{FDUtoT~ŭd3D[~+@'u^l]P
Ȣ, [X=,XrQF^et*w\YHNؕ!$oM&;u0Qhj^0`L1ι}h3cdt}ND+iDfԪ:AQc v8ٲ.=~WT!$1tv*+%h^RQ-)ܟٿбVXع_3+y~ f|A{~w*NMee	YKkYF2b98} }KD?2ܑ74TrBr?Tl P:q8 y \#7IAiނr_Mʌ&VLGbVtt*'kA&.'''|a1`E"#I1y_Kzd"tДUWNi9=2]e(wr7q:ȯ@qf-I=ѐjP`QeVk~EP/(,75n7̒ SRi:	 h60xeʟ<-NEnM6yDO;_"Z~Z/FԓEBvFv18*?Cbuq^1L,ni%.I.XD9"d6J94I+L,H$faP<O~=Aj,m/gSH.j^ϑj>*H3-)v1{"}dj)7% L(7ԪZ	G-!2x+`dqя\iGʤF 6:$kՠQNLV<W"S5_¥FdWy~廄ΐåTQPZ	u	%HT1jeS`$ԄΓ <Gv:۟Nx F#
ZkRO.,UF?-S˛~~;9?ޗ_|s:Ӳt}5N@ӴܴFcr{&OgFK84ۄnʨOhh9wHnISIFr"ͻG?7]	)&i<-zi&M]*m_Hs&^y\x}ɆSE+q*u9N#!)#C>LpȻQ W匶fةs;\I*A87k;̉pP=wD41tiR3'I5Ix(mD(-z8(njGg2ۦzDQF	Q[$N#EXv]zoYS?f1;	(Ȍ/)P9ҝQRNF\&Gl1HFϤ
NnjIL
"i_Y!MP&%4,Oj[#I7ǙTJ߄Dr/-猽\%MhSQ\".M$`ʒ~!K(7,֜&1Ɯv:ɐ1&	MK$2G$*n^zH?/z#+St//wXTga TX z`IAx'
=SA-h̔&E!R
maj4,|cK\ <hAC%G9ki#@Δ|QDQn`9"BL򍁜n``|Q1%-,<`XGG)aAE.Jz~&I~73ܮI/TrLtY+~zk4/Eh]D)ȎKJTl0'T/+D)j_29T^2ЌiУi71rOtOO41J*`bT+XLi"0cl'O:Aӣ#凟iF.3=(Wr5Dl|m4!YZv[jQm4
JwCߞߎD2$UX:+:nz+o:-oZ)o?e-YB +H!oH!oHf-k:dYAREJz;讙$dLn#[Oz]'k'w$ ZIyVQ$I(I#I0'y ɺ~L9`Ge?pK\ ў'qs&CR%&-vG/MhTK,MYp~,tuD;呫|95ZF[=G?;Pk\!is4|M%ھjEZό>f$_j}Ĳ c{<31mީ$D`bNZ<<3yaDAҕXt:견>4B*=+*PKre*h:
2xVC`nlRKpN\;r)Xef˫kze]FC>Q<\@W啐H&Qn$>0Jm-4	.8H_}-CUL|54]J%Q^i.2ef.5+?,d70`x*LNwK޷{/nxXr{s#=EV'NIW!jk7ڹ'[TJC4+Li	J7K	Vteì݄$t-rЖ@ˑ\xMkN2ZFqOTiIȠ9ꞗ 4MCSO]fE=aPUBUX(dp˛DF#y{s-9	*- $i<^8Ұ7!rH@}O0Tifsddhb\_]oUZ4x	H`ZsP61ઽ>BJWP fK	2mGyyixw#QEҎ
0׊w>;bOM˟IW/nb
t?Og/Z.-lwee3X\EͩQn{?(W=(}'+v0Iצ$_0oJ!2Ug,f.Kߋq0Cyn\43.X^K}t̆%1dK&U)y4l$Wue=.s~"ב,4jW5ڐ./ܰ۽ɾn]Z]W5ZAC7 1il/7!h*Cc9i14U4ƞ?@.t\瑫=,kVg9	4Mr#IG3oRñšNbA27{|C%o>+vYT%p"@ʏ:R	Ynb:QVyjd`Rsv]dZx,<CXɚjNu2 	9\mj9H*KAT%Qnhv\Yll
%jEa
V;貌wz-/@\9y5
savҏf3w16mPȽ$n(bX7U&3 `)[,,e!ll6C]~4ˑW.?Rh3˪u{9$y=qeM֍%BCVO[X/ki=t]Zåew:K&N5h<@Q:/gX
[ɩD8y~jJ=J}w^ʫ,7lNSq?FׅO(zW!uO~Y^q6`M\F5/i>k:zPT`ޠ.3rZ(jCt6e^Raay"%
 /5aKY{*JTv!lٛXP[9سܗA*<xt7 ؾo,]mԇ5u)D0y!nUkTB)Wa4*VjZɔcNhV5N49n[<ي0}\8/Pp.>v,<am/]hNHY\T7G^f?COȅ˃po:raB^qLRQYF*h%~dŲ`ZQp%(I2/./IRd&n IvlZ&BI1/@``n'`+p𭐦qxn~SLP=f$Z}>ؽ)}Y茤_utTJ?[;WEP?vg0ԉ r7s\D	esFq||wodG17evѫs. ,[buW<<,$䏬X45g;U֋0^BIvoo7q|ݗ; wV螇^j0_cDqр ̀K]G0y7~@ۅ"r@x0@[ xppѷiC|;8ZepnX!,BcaЪc^((TY9ѓ>W=)E5ީB`!w|ot]`94Нp	"Pp':d kW&7rb 
Lk]Աwc9F!?~~s}1rYHK6_`|uTu!ax:raojߕR@Ŕ71@Q2,ؑP薬mR7ۑ"^2+gu<oqX]NL,߮-|COưD葓M BzWf6ZA>w`Bae*ycGrXM
(_j=ռ^)B3	@B|+`*G8~$Fl:i6Z ּy<F٦䮏qqQ%PrLl'sEt%ߣJ?r~7Ŵr@^IhS#Qʘ8ҒNwt+S}_ H?2V>Q@QM]crB";`3qNZbӗB*{IFyy˔5oXƾf]Qɴ2B*20d$_dsNхIL[(UV/d4v}w{@,6 gDEޕX'1o &bfYs݂kj7tV3	曁jA"يta~6ᤦ8.#t!Hw7Y%Qb$Y[H
:OV~r'Yl-Wn
8Ř(*<TU|Y~M

0|_שVnq̩6k̕>e6mK73/txCyhlLު洰uT@/Tƙd_`oD2tTpse.PrEI!7:r;`y|
+|tT5`n6Ř"^X<p"%#NQ`u 	I"~һIR5)yqr~IR]3?n/+_lr$硙_xfܥ?IlG橯=J)	vAvIAq#&br'ik*&+TDM
(-#O(/,W<|b*(%vD`x:5_XN.-Ҧ`iooDZhqZ\<*T!}
f(5}fNNG	F=QkiJ9dOL=OoLP[Cˉy_=T=ڍ-t3':s&hn|q݁WR4
"TJ0go<MOְ-AuŞL$ZU"2BIE_-m*hDv@b":{B:n$Z
s!$A
:q2H<'IX0Bu'*-TOJNdfJ'>oULL1݄]w9f`<jrZu&Q",$a7:
 = ɏI%Ml%:6~$+=GgFP4՘t0N]EӒqDĲX=ic<g4f gZh/^6QkY1)+T8"eQ{x`ŋM%e<*mq~i"q,HVҷc='UWA,#[18.I"زU݊]8"Ǒ{4;]x)8̥4/Sw)yX1D&\&AŜڒ2Ʋf,U+[U-8u#lilk\ZI458IL&a2$>4rڏWGŹ.JSoL*cxt͚8tqxe,ӃBiǴgatdrH\غBM	
1E*RNU(R[(~kQ2pDrJJ(%Ҡg1-TSÒcyۑN@\:ضRM+O^K߸?
ݒy13WV.Czf<OunCr̀Yuݱ0n|\R
SnNi!c&DM'|-z/qF~.7>[JM{.X)}	w"#>g堛MjT[%{΍zXF=7-ņyz77`nXUyۥL:97J
7bez![t" w-XB9	65iQUNHe+F;"iI",&8vAR3|sE .QJ,c勳lأ ԻU->vqnZIX^)׍k{[Lm2QwoT Őo5AN(co##wG3bFphفN̐WY3ʕ&*[įNшH[Nй_t?(iT'2G
6")5'`zlxkH%gU2Rw4[MCUo  \.&UTIiI|&f-K`'>'IIE5Qvz}
%7pO4G4uhʧ0^?x0P՘>}w]]1yc|vw~V尬	FF`P5ƕHgo!.7eg_j/	ըn?sωx׬&GM]jgSdBC9{-8z1-Y7;*ZS
ZoBbTԵ
Bzߐ7J{yOt@\%kAorh]1.ON}U\;Mְt>	Xy^K[F0Ë)6(O6XA$RAkX
*3m~c!<XgyQ؜[T3
Kڼ *l'I
]PP8ȅ	Ѡ-q̯&%%eI6|Q3=Ҿm^6-K⍼?5Υ.\e2KתWy~Pk>S)K&eII,gj֪KӖWYd,pP\3nHlĪxnG#>f<.<CaQSԦ:OD?'䄞r:O)BB^3}\wK,itXUճ&}k<26Gt
Px(Du>#<ѧ?E±(F=Ơ;6ڰe3bՁrcxRXĉh( AzYnMyZsn RP/i7^~^QAώnҹeg }scKNvy_T79Pl{^(nTuaƳ.T~5Q`1-\fөxĚ?H5eվeWzN>g>*HQAMJO4_7SYG2҇ު?KԬʚ8`bOYSqYZ=i.<s燔6aRF;KNN[ѹ!T9v}l{#`:¦<ew}T-#oDMd0}&z`28gV)3S<s|]GbGh%&,ZJY(Z'"=Gs1]SÈ6ޚ[fqBo+o7y<_F7Jpeav,E5ZAsb.<h"P|{Pݽ{?F[]1gKRW|/;a`VY#<}qTNy }T[B>|3ᒛ3L!\4e&L_{4Ǭȕ7.#,˜&r?uWoeqlp
>jEpquU_$`rLY0G}ШR?y4!Wo5ޠt+C믿Yה9q[Q
[ ?ǼcLsZy,
kȪHR\ &
$>]tIZX`<~Qr\$Zg&؟GТiL63w5mQ^liP쌧}^z18N0zyE=GAZhMvOetldVB4_ә0#DL9VG5#p`	t.| G/CH]R]Ktw 䞑!;'6smwD()~ͅ*i29x3rkF MކwOSqz
C}?Il^o&/r+C!;a`'ńssyn"/߷rWL:[G^yc52"KQ*R%=-k/"AXz~\ˁ1
'9.-%.)%N}uUWqHÿ?
cNpa<)u7VI"ȰFQR,"5acg_c"V[0͋ښ?<[?m<7je1!=WVvnT"}/R*Z``_p19*
&Ih%鈼L0P4xp/K&EFi*E;4(12`GsC %R>R0UFo@5݄mѬ[/8wB߃v'nDb9SȮH@7q@IBˑ
YǑk2Zִj#Q>jRXaj5$JE*dB5S m<zέ%aDP#hq:-F nhv]q5 d%)6B5 &Z\> ۰^"V~JV	p.!=s΢UAc[QHLt(y#BEex)^ҝ`v.#ˬ=K#|EZ2(8NAnl+ϢV
^zF*zG
R2:=f(,eu7=Wf+x4o27JqxU#iYz8$Tȝ-2, s0PX9 J<0fkQay7ܻQ5'qZyEutzFo\cZ>~T.]fӓ,d)]ŃA*sFר9{a:7Fy(O92sWAFH<XfYx&NYæ6;nch~P^\RkRq/ހL{_t,Sqq7*<qջ'hWG&Q%2ȑN
:0:$fێ|HxyO/+ Y+Yk5R^D@Bvy=51wK$g8CY<}6ƻpN%5ulr)f;mMPpg(>l9ޘO{
p,:_g*~s߿p6us4 'i+8_qy+IO7ؙAp:Ύ`}`6zO$uijʁc{ga]ӶFoW܄ĝO;3"ssoԡKzkšQr?ŧlkސ>5)CP(Տ\Oy'Yw:z|RK&-]e>9x;gр""jJ~9I:Z}j~*ϷzW{xnEi53vy΀'x10숂6 $qP|Dsn<C`-qS捝[>34宪6Q ^˯4z ϸ=ϜjI +VZEB62ïOLͧ|tAٽ3tqxżM/m"I}H`R[Ujt63 ,9	YKldtsf4.AsڛaQafs2* .&2_YLk8w2 :dd5ם:QGJdI&1!cO@#"bnBsHE+zL-sF=<D6moqwqU0[NpnKQe9bYX=`!ެ$y6_PZگa!W3٢XRQ
F[uŚ_,Z.5DYJe((nr0K䲝7PcyΖ_v_I}я2H\T/^aqL
%]AF-77+xmu<e}\,Y4wIHqm<x=Iv[-{B8L֑D+75msWKf9׎wjiFꈫE-X%4!0||O7qRz;}KKdhͅPu^?{ȱy̓GeGA	4>RC
Kz/`eVo6e[̻!t;T{j/徘Znxe9\}u\M!BaaY;fǢ5nhHW3΢Ht-(An6x 89ĂN~4Ǝu'<]=wubEUy ^b#KPpzCw=~G9F|9@! tZFf5D׾Ϸf%~PnN*bԥNby+
-%.Zյ93L}Mw6Nx*fw١E`x7QT."c<dfp2ɊdLcT lͳ}eD'q4Q~nB	3'n#n\0%a
M$E+SǛ'|,ى._Z.@EYӞ,,'oٖg9XR0Suу6=M~ىqN8qS2_"/B7}P̈́ q(]AgYdP.e9_g4aPz"W#9:/(o	MĲcOaɱ)Zl`6:/q/6VNnX-]bVh4ֻ]F6Z+.lwvtYm7uo5õ!r#P#ڑA.X;zg}޻Ev&~͕! $C]^S-H?FX (}:FcwBa:P7BZ
\ihA0~`:r(u!FB+$s2a%i0cq"wՃőV_(uҤѪ븦I3<oˤdAJd06Kgz3tenfu|^%T	;&[X-W}j*$Ĥu6&@N9vGBC/ WusRB^祖4%mo`fǰD 9T;2˨2q>Z38̹lēdjZ?\Vnɱ3h7qѸːk4$=K&|:'LᜧPrg<ݑ5ŋـ7P`|7ʹŭIkml@݀[/+܋ie	Fg2iy?}SYʉݴ,YDiZ?V<"7/2lAN4pA~$/NK;2?4hM۩c쵥Y~?Ņ&5&=F&g&9Ȉ
An
0L}MђoT0^RH
g7H kg<=u6]%}u*ȍجKjn(C$XؤIC3fiE&9I\G}>PǤ<KKQԗ!HOv0͆q6whdrvltkt/&)(hEf2vӴ >|N^G^=LSLhy^^o4GVh&nR7QLBE$I.tχa0.%[,vAq.i髑;vO>FthU<6t, 3^7T]6ɊIhf5ۤ:vѽwrmpMYnA9pooѴm2b#zl_7\e@4F$`t{xId7rJv/a@A$OMs3)t&Rl;s溾jw۽Wr@˺ C12- v^lnlmiOp2&7[>pJCNr<^Ǩ/Ã/w?ۭcowh7;6k4{^eJ}aD"+bKHvEM<?43}{O;P_!=
O&7g٣"V3l{f|z{N۽W??K^_􅣥+|3p/t~gS4iS_}՛{WC&,Wݽ[/+MO5iiN('n<{[~7vM{;v]-l@Ӳ=}/Wk|3+irA#JL\e뗓|
BO3	J7X/"O'N(s
+{`W2ggKѮ`e;֞ v.vzqfsb|E"ݦRq?3$
k0W({[;wi	gWN(K>)"/F~SZgv_nkuwҏVKG±JGG$d-ڭ<ς=$^syƹ>l~|>|,Q0:ZD/
Os.&_.DjIwrlKINc{~TgGG;yPFvh9,DV/MNMa7M$ͳOOvC/=^s?qN&rͬ[F^b7KFdZ=jjcDM;pFJ?%uk.{5[kNYNY"NZ=_IL妚KG7@C5GMO_Cȋ'`
gmw]\e_v	kQ݄\'dŊBloZmCJ(Trq[o-"'a{>)Z^PQ[$,j,"z?t{wr%/]~ۭ^{ow'Y!y;twϓ=AxY|lm̀ܝ1ց]Pm_uX4	X]@iT@qԉ=Gtb6(M<nϝ\Ozz7;{i	 _}Z73zJč9շϭ{}FR{RoA3=GJ%Hp7O#%O1f㌭oVhzYW)+=^a_
7vA0vJ T
}6"	.ކȑB6`t30ؙxM6	 :C|GɚGc~Di;i}G0&{p|FLhmn/Sj&[ezx0<cwǐ<
8^f@j7S;9M_ЁI|lt:ǅbת$8ӋztvmepGUtVYGh <`dcUDC


Fc1'0{qVu* c(qwu0!c6}{^TFqlh4FZ#YZl9/HKJkv-*ic}^	锕lZsHu66z19n)-zBӀ- x)-SS~!RxJ&h6G
-<9d8dZˏK908v5qesH-csoCYp֩3pʊ=mh&~.8U(ee;M
r\z!>lhoCa{0%dJih=ݚR16qB->ý}:iI#gfueq'WK-$2ϨX5"D!j_|=_A/d4$ˊ)
GY3q.trIԛd82ڹ H13_R6HQA9GqIu [3f3,@Gx~Gl7au\"B\](I(ǞZG>#O5G
Y/dabXλf&d$n4jnMbvD$iLi)?I/o*OP.;c1EXcOWq@IApuM&cG >VQ|6[*jܙ9r;J!CeFvǆ9kv:m{<qk6pSFS/vC&?&B/ޚ*_ku7Nm#ޭ Otu6\(}~3:D}	%mͦ^	pv}|<nv7;vnA[;aml6Y{:=@בOuAֺVHjnحnԁ,lƺzlVjYT LMK<v	l8d[ tcFO>Aa׉OЂr {v:~<Aݶjڏnlyl3hZmdv,B-Ken=A:!Ea;rсҽAO	 >w-hhwm	lvoۤ۰;|ܵ;N(z]*Y>t{@S݋(	;4mTݵzlt0* xC>:Џ]l<[h^X SGU[Aumy}6#z7,h:40qK>5m_^{DNѢi6coMv5l`ovK4ngcc]>at"{Doеbn`)a7^o;ƺxJ"as

~A~mpvP<6X|r>}B똧)ɠJeS)YAOa+1@ɾmkH 27էHc1eQ%n	N^ׂbzyc|iR?	~QӚ_plBGZWk75č]'\ղT̋cӋoB-]RSvȶVTpiO\C!_Z{hsQ{f2+#':T`7%-BNfj[QҜBü~õFj{2s[0:QI`9LQGEW&c3`>Mroߋs5Oi9Er>PClC[O[yNnx_J2@NEpQhEFA1;9"ReNR]/I\ υWD$b	cl蝉cc+_QhS$/ùim_nJ_oJYu3=_#/#2_Fw@:JHsqJ퉈*z~{߽c0M#dfŕ*:	E++5NFi!chWqKHzx+̴l$Ls}#cL'_IH0R>m͘ N&~AQЛdC:(_<w_$3^U	<TS&	y`WAI#oۭY=8(.2|Ms>2+Yg^epԂы+--U[QOJF<IE!cre#jD?sj	S4LRA!ȭ\IwemJZMx\8
1Zmf_	:^d 7sYS.eN36q&>)lVkZbp`GJ1 l^`껟{Cɯ	қYKA,lE!W+;fVjpQDcONͫ@*Uvy<_dˉ	|a5ndqM&bܱwF43$nq	񼯡Bhx$-:SF_i_R;+˙3FNwp3ska0#_OeEl;`|_-2cw2L˫o&=PWى7(%ӴFݏux؛x'["޽*'hp(#hQuJ3df
1aU%g%9rYqbt6/mޢvN^ q)͈{nv2,URΫg٫=F(85&F¢9W6JJlZZ7߰>I6 L|=aOdG~QO=)Tch좦BIsM)^Y![}Io_͏d@ϝ(vA$gL*WY<Z31HceSQ^ȈTW<~SXKI?3	ܴW*W"$Zl(@R'w|-+͚.H=s2@36i}=3)ɷ* $k?_c0tYF
;zL0μf;xlgTPSwdZC?Y:$}G;t^UrZԂ &Gx$G50ɇoS!9Q/عP1fS܍ELp 4b7i)QJF0[^(vc~5OT5h2NC;#ErlJJPbWTddx]vDc4૒ArffR|A K	P%O_e*(KJ]-;M"x0ԅ3;)XЛdnH42HdxYW|f<v8C"	AGaIPm~FYo7X͋W̊ui
[
	6kW:T&sd30&P2|&!(kzv2s찷lb߬PUqT cduls904(q
qp2&
&. {&m4rSF3Ю~wWe*VM˘ᒐ<GR:,
bⓈP̀dܨ|ɉ/fdT]
MpZ|#׸`fM\(ҧD4aT7#ub.yd)عs%DC*Qr^
EZ.e0-y6٧dk~Ѹk\Uk8`Lv_;ScOqWX\:۔Y!sRH-p*4!؇Hn04Ui%pgNUvUC@.(&v=p?r7 lqrP9GcK[bN?}(i>sZSlo0<-{v6ung_ؕ܉Wq.d)}?hh1æ\~їɻ@,g&d.z4Ǐ|̈3JL]
a'F7ju{P f2ᛅ{g{,zFae!|;qmvWpQt\x++:uG#<nFj#y~u诬ZOdwۯPe%@r8:dc?,aŝ	(	\2iR錂3]L;`籫.cI9E;BPGOkVNxQ'bx<U߿&ؽZԱx}E4(ˀ:{}r;4KӿMp,DڴE^!3³aq,o9V/s6EEܞ+=n1!D~u¡[w|Xޙw;{foڹ
}zl</u>;y"7SGu`|u 6!UnOkÙ¥\NwՅT_a di)XFO3YsVVˢs	2[NFRgN*/"DJՐesʀg0lIgFSGT2	_34!Y$Rjm~	Vm]BKQ5:3lj\L.Ŗ&$sH+cf(`/>SmyAd'Q}HZ3bzhNhs1@EDq'u:	Fo,[uWNt:cI/S!j˚	!HpOE;P F5!D[s(Њ8tLi
݃|R?,x[TT$C^}C %ciT-0  CYsY/Y[vs
4 
~HP܁Yv5kL}lo{Z
 /DU;?A\|~fAu+ c(Kرٞ+ߕT%hE|ӒAm
m0<hw҄{M뉩[5g{+ 1Mpm֡"ǐQHt7`G#!@G|t~~H|@Qӳm:):U*Is'6ngs:GЏ=䎔(U^I ?bXgtꎧ${8!_ЩKlRmLhzp<mEK2F]l}D< #NX81+/˛25n5^l O**sU gn	rPW"IEIҠ45RS(R6S8зHuHA\D2o,?h;[S/5^ WJh%O{<	rFK~3~e7E(k]!r.]4˓pǗ"2$%/r
@)eI(_ kp.3L
3KfDj$ؑWG*dV.H}U*0W]R⋩3XTʦk䫉MfAzzhi&~aèfNxBM`]Sy5=RSܧ"-PYQ)ZRjޗKqEbd9Nn/]\z1`-u;;;s"7{?F1?k{m1z0{*&s85\щbҠ",e6&mt?lϦ6AJ*(hک`̷\<,!zDX.Yg63=(c^djȜM[ AJ1bYS8Ƚ\_kaQJX9臋g#^t<`.O
hl&4zN6D(Px$#$D%Bj6*ԆЋ;ڜUZ!aE9!qb&bH^hNz}-Lӝшm	Dk}jlt2y| Iaa(f	n^%L=輡$TO2u3
ղf[>)̷׼gT3fTv
o*Q4PVZ^X7Ϛ~w-"V!Бcq2sEuۛv}627QH6e7֬[J#\Q
q"bFI~:«wqe_zjع_M=wsݺ{'׻}Epa
iO~|WFh;GE%*?Ń<gU:.;sא0oU_d*yv4Wv+g'n9Az7t?t`HmopH˒Z
+0$e8;z?ƕ:sx
=t@EJEo:X!`u,T)0Y8#V?T.	AY v.N?KYM{ qmu!7
L`o>u4p_ons8\oh>ܑo^ۆ
e@aK4]<RR<~we[˒vDONgݝ:}$yE uNJAҮ9 -wQPuǫyh* P(Algtj6T9"oGdńPֳ <n<áY<2ۊ1u\*&;= k֗O.:SOdKyÁUdsyF2uHo5)V;](3`9ٓ/>Lf&نDĚEWeKvW>ٕu+j<\(
Cp*]Z u,c#2OyUu0'ȹ\%MEOd;NlЇ,GV &ڧ߲mڀ
XX3N,郼yC#h:b!o%<!hPCLɁL}x-f%Rhq&|` q=xJ6nFIXo^`cLzq,Q "(	Bk$uZh̢t@`HPO[ipBHH7"5^%0GPN@MuѮ\*/rb$;@<-7!:oK'M(.W?}=ӤqW-/^>L`e"	LH蹻i| j 