#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 u] vH(_G_EZmwRT\ݾ$޵-oDB$@*K{30gΜa\`f֚/L H$U*${z0vlOX;|7k?g4@9ݡz qI=$8Q440Hjݏ]$a0kkm` 8fy?wh<70$kӽH4`|F	`oD<硁kk{N_h |tol4ZZ ?Hi;Ν >V8tc :k.؉~ڭ񿓤_EӬfƿlݯwcvL0Wbv1d 3d57B7
FgD,_ >uåىǞ¼8baĎ`S/<+\\^>T[`<vyo/ś\ۣ`:|>rBؕ/^æҟuQnƂ[!d =  k N]~tƓ&4	gAU0}Csa/
{5Vk4xn_|q0b?h_kuFq?"cg:w8xx>L{W9I1Ϩ~i靛xĘ\P΃l+ĐD{;5ꏲ-\c";57([k{wtef|IaTs{{8	3ʗ\ ot7a_k[`wZWtsDKK1fʖ?!OF3lb0h);8azBo[;`
%~CѐAo܏`+F_Q1QG/fcoiihB9E}\Αl{ݬJnTȉboN8tu(ӵovoo6ol $CUvUAPŪlR5MI4&Twy-l kd-EUUٚ2h|@X]۩v(̍0>j}I$bi7|X,{Ȁ~ŬcVYVrm*@Z
eea`"`)Ym6tjt4bͧh`z^n\$|M0R>ȺhΰHn.yNQI䜹`;̯k~LKRPY
|#]W `
1d';a+o?fݮ	VMXrvF5#Y"I?_:y׭Lۯ_yG̈́zwo~Wt_ez"NC'<^>4vNoȬ,?YNdL1?w`n>l)˲`ȁXEQt"AW+7p{b㤕
'p^rM؉{O<X3?2}Fr*U3
>^=EaeT s挼!}{΀$A/b*\sZ^%s4KT
WVuw/uk=Z﫟ꏻ+%SCՕqn<}&܈(orf}'ԅ5ʿ5<N㘾,`]_T9`Pzw%f }"3E{O]@%@gEE	R9& pPv9Ls6GXԚBBѻF=Gn7,CrBlb Y$6Sf|Op9I;/vwܬo68 	6s"LۂBpMZhLܞi5n`'fdVr1֬
zY
sm_U$X|;W}},D=VH\Rd[0:ƿ!_D~{S,n LbʠY,)|3tG]_~0ɮO|-"cM'(?[<+iAX)<ZW?}F**$DR`{u-*[]#֨Y9rU	+Z$)߭dD1fB. mw ipt%Ĕ#3z/%NswRY%'}129r_uoI+ycA~}ϳ*x㛂fVN9Ͼ/ֳgUg*3WT筽W?ΪdGUi|sfHUOE=݃*ƍA:! GOrK8ܵ5CԼ)Œn?SneD*x̙I|_y8tRadP7BuC_W$;f1܃qt|X7ڀ9O4<?-=`1PEFƨ[@'p̈Jf6<Rbj|ʸ-V;Q-%oh<	6ׇSMj.շ
qM_j^%;˂%_.aqY\;Eї,KouH9$wv*BUTB٭ie9Y3Ӌ=M4xO![<:~kGgx;C$C&f(\$(gy]Y#9C_eQ/˿?{=0yRM5Ʈ_LhdM5BG&PbvYbPq02k@o>z6{}ӛu.rJT{|;aׇ>+5k,Ͱ̖IwLsLCyXDmcȖ\Kóݓ#vBMلRȹ{T4tlºfV[6Z%40ԿiZ[:ݑrXtU!LQv|3@ng@x{@WddD_%ڐj%jާRP,d㋤YMа!*dΖhkEqxd/Z=_zjɯvD_1v>)=jH	e )D2C׉%ZN]J-\#XB/So! na3SBHjy ?8L\ke8XxHHOؤbUi$}ZݴMayR㴕ؚE4FL`Ĝ ^R~p*ռgxޫEJ9&	b7)J+ȧ0Ɠ^JΗ!ItK*b1f@%As+~EP7VvI|jTָuqsa~ǩT7ʎr	YiT-
X\Pf0hFe鵩`fs9RRi	aYIE÷M7a>T櫾:#&%-7Ēo 
!).$.a&gT	SN&SFK!SKKKs)P(.0qlaPws)5X	Ӄ|(ZsC5RIXF(F+DBZ&
6Hvٖw~4[MW@ٵfFMaj2e'^䧌EW`w%G4?S.zQl,ܞKKf\Z_iSF_@1cwЩX2
~ެ¶2U3q-ƂŲvr4d:d^"a_+OvB3XlUXHT
W6FW+2ZWCR5#sx3$Ln쀿^![^+zdfC7v'Bw( ʏ euN+2kP>}R+fd8e=gif\E87c!]cx8KaQ.d& ӆaHK@]22~%(){mAE\Ia6^I.$DIH_`crukK#u<+'j7Hpr- P3WMŪ<RX39y'{/@c|*`}\iQ\jfɍC_}G͕(5R͜'2lR}a[l"\5~wX;;XydUt2pcO)d"PC[}p,}}'c6v؛/m\,KoG07]<W}H03
1o	/s m+H]z:-iyn#'6Yw֥qA2/pggϻ;[{3:w.<d[agA0BS o>RhvF ;>rtoSmC3)*Ћr||IJC|AtOGсMzv_+7UD]{JJGzd%i
!l,$/	N̔hw?tbRi;UmMXrUQRnf]D*PzA*VVr\r36<.Z(ode  ,]9,9Y(p#,;uo,$tA;EJZ2۔lN(MtY5 /1Z&MC>oz4	Q12ZzndA"3jSf ic v8٢.=WT!82*ekhjR֝Q-)ܟ_]X+,ܯѕ	ky3 [=GWsS&վMO8J#FD[1Zrr>n2ςtHgTYDx*'Ek-:u6{| m
(O8W:<r !
foAO
el&jsug+&ۈ#I1w+	Y ʈQF@o	Qd0͢az;Lc$)&tɈLc4^ 6*-0C)c%yYvÎr7)w?<t3KoI콆lQ:-\{-zaEfYuEnOJT+&SO.2J
Pї*cFt8y6G)=Zl|lԆeN1
DJB^
9iXͽ*2pf
Ԧt~8tI*.%SaRTιa?,ZqWbD"dt630|R`i!|9@vpzT[.Q6@Z Ӷq<|OsSYBڒ<4IPnhU-	/^0`n?_S8 ~uF?R&87iэ'rb;l	 yw	-$I4QPZu	eHT1juSa%ԅn Ŀ?wvG۟ NCwZzO.+"F^0S뛆~~;9?ޗb|s:˲t5Nwj]E0MIs6pk	O9$Q{8s)VuZ*EoEy13~{ڙRx<v%[ʷ'CLT~ߟۖ!f4-XLiE804h!FY3:a$q}&uLRxNxB6'I=!ĤҥI(*8H~F߼BP,Lp{t[z 9oJk,j6z"qYF.:p҄7L0>7N4$9pzBHFI=q}}\#u=*8ye0)uT<d4LBа"}O &Io3i	1^Z5ۅ_3~u26NHqኸc6.KN#x"(o[⩹-bZ9d!|bJ?)LeIUݼ^
XgF$N1Lb/ϰoÜB0 I*Nz_Ń<SBTH( Ѱ[
0߰-er aꎂq`8HKy4
1'rEDyƜ#vl2 <fH iMu)b~%ͬ$&xb{ȅ?0b3?Jo)4/1;Ҽu ;.V(S=jH4$^VkS6վ0ekd <_i5Tn`0(hh
$iEլQ5
F0(wEG4G=WMN"(V5bjZ"UKD2DxX%gY2%h%qD2VX;W+t嗎Җ_ZKS~i/7kيlD!-ŧ.K.K nVd#لlA6/>hb67H$-Q|H'֒o[;J5OLk&5>4
E4,,$KݜeoYo[~>#O̴,Eļ't߂hϸj9y!)l_+ݷkV2K)iDQ4i1f0Oy*_wrGV}Dь"џO,qH:zoEx}lڊ.O=0)ژ- g,~ea&Lw 1Q/0B^+5D=r%3v[N,_M$P6_egJTʔiINLTP%ޘ_j %&6.^-|-e=;l*LԔVtEu}>=x3{RSeJH$%0]7Gf拭QUG\ܡ)%uaʲ¨D70Kókv?-0姅{&FB4/P	)n={	v-K.sOnDRع'[J_lXΰtc7fv;dKJ)rƃ"-!]Rn)ڊR6MHBٜ^jEVbPw9RPweMI\\sYh:I- 	0GY=	yhkFFuOha9O 
&$H^\,rz{ Fω"5C!4DMè,x~-R)P5Z@0z`A<٠7Zt2G[zr#4C>2vp~}*jOnB7B9~^^݈Dc{"W_ ZTg>zGɗIx{ŝOA7]tpil2OhyWJFɏgEyήzX\sN2zZ݉8܈2o|]?"Ci-fJ2qn ކάx1*S5bAp°v>񽈜SaL\{~Ũ2ɼSn@bh]c
 K$i2ڎ"Q˦%H*˫D|ELvɜl9dq0
pu^ZҁtyMutJtԚOLb^>uGl,UITMi渌)Sg&lyc&ڸL#z@Yִ/rI$G2`gХUO,sC33&?7dfY4J}VH<JDwtd3jb8t2>/)_tbd`Rs&v]{,<BX˚jFu
 	9LmjH*AT%Qnh~f\ٻln
%vjEa
V;F-/@\9y%
stҗf3w16mPȽ$nn(|X7f5&3 `)[,YBYlEl3Im~-	(fZM3Iz<R3K6.J0^p?-Pzິ'WHstbQ͜jxs^ƛ8S	^ԉ-q'oWYα\\1ފIK3'Q0BCy0.Ԇmj&_lvi>zPs4`ޠ.Z3_<◵7ՆҵAlcK*}
-Dk O
&;3j(7(ZU(	\ϰ̥,+rsg/!Hioj]}#dX:Ԩ\k>H>!f> YR9H0گ߄˨8Z*Uk9S;}kŸ:meyͣI@eùd 10p9!erTOxEs:tb_#z.E$$nꮑq
91yKEIaEO4lOSJܰXlT9+Y@L-廉[{)YV+ϽD1H=cHB^"4NG~jdB~AԴѣiK܇#	؛1JEzENGEp+{^ml}sUT
5Row
KL(:aԛz\% 8({X303;{T8jQ8^s%w e2@@Xgadh쌝MO@J^OJ{{;2kׯ
Z Y{z~m5h=zǡG}7<}tTgYoeyVn1)n]܆hѼ}8H6Q5xSw4
Ak^a8PD#?\zgˤE"ɄCx.QゑܑZg!g
ː7Cwb00rK%(C5p`` Hw`q0\0]ЪНMl(0mu^G%[`{;1/ֻrlwyd7b#-|QљMȅ.vԿypWj1ZÆMĸEU/F*C97[!4p*s@Gz$t@{6{Վ7ث~fwa0wa~;ix<3yHO<Mrz^MQޘ%PX.h!-6S	M )cfuHVaQ6)_O~~rTz[dzKպ
"P^1b JC-$B߀sKݓ `ۘ{~dU}n>ƹ]D@Ѱy1=z%1=d%?ȘJ?r~wr@Ih#Q_ʘγܔު6ނAxd<-qZNgLEǩqwfveF.wT'O%;0>6(lucXʾf:Rɴm2B*2+ddsFтIL[UV/dtu{D,6AE8أ'1o &LcfXc͂*yԒONj<6 >#%EelNh |!Hk7Qa(M[Hɜ
:OV|r'l-W
8(Z*>U|Y~C

˰_iVqh6ke6mK7/S/t"C:xhyl̐ުpucT@,Tƙ^`gD1TqsE;.PJ?I7:r;`y~
^ |tT5`٣6N"9lEx_'԰d}k/TY҅	zSdPh{88&QjlxTo>e,Fvrg"y%gqiL._3Zy=bϸBJ(3C<c]>EP=]c:¼
Ul:Frʠ./JÈc
+ճϽDF*;"0D|~o,g\yViScH_oLZq/\T!}
N^840|fNI8XJKS㛨St
\_'kvi,7zDhBf^PsǞt\kA+qYʻV³P47`8'c!yI{ҵן& eoؖ\ V@:bOZZfdyEP-*`@D	J!⤢R6 "
e5Kg=VnY
s!$sA
:q2H|	'I:\m'*UJdVJ!2o>.&{{>\dn®c30Xr4c:(V0riY\Ǥ}cG+&|޸xsLv(j9S*;iI,8Rj"bYT4 13}.R3 m	sj_(ՂT?<2PKҶ8E4Gsdz˫䕪QTᨠ4zG%	ӗPUʣw[W$^8t'ãK/Ԙe.%+H$|-[R_&X֌buAɲ5fЕfˑ:5*Ńԭbr6	ՐYg?r߉3!nޘ<Un-5ptq2_nEAtbZphLR4q29?$.k]!םN'YXi@}a)yZ&/|sԯL Je4(Y,Ky*ndd+K}k>v69?-no+Ts52r,W{![2O/&YjEH,o)mlBc6]0;mיk"aAʾV`)30dؤdXeX=ȯܧôwk3BiυY+3ϰ )B~[strQ-ZJcC|ݹȵצņذnʸnzE=gf^Mټ{5t(s`/ݞx~ ŷٖK|Bm̉
n'$Ir<9h )ld~" OZҨi%jYYvnKS*Q_U_7m,A/~ƀ\]Xε}-p6|ڬK7,Ayjȋ IQ[ֱ7FΑ;1k#8[t@FfHJ`fZh`Y='Uϻ	pW^*zoR}蔚s0GqF65$C;	2Rw4[g[28FӱBϟo @{ǛCL:+j?;$ҁF /6ZN&Nf7ma3L
J_on^'3ih8!.$ʯOad"V%n$a<2Yc+1}d>bF:!݉duu,emLP%-FZ96D]CX+UmmpƾlÔ-ZQ{xI@D5a{N<f%ʌvlD0T;b ek9;vV	nvT޻߅zke0!(&磟8ZO:J~5jsJ.g'p3(owa'|0ଅ{K-e5X""&nڌ6<o`8LHaOnR-htbB2ςS
:Nl..75 tzAtUK38K	QCE2ĭ"f~L%$yIHvHzqrڴ,I>9QJr@F.vה=%o}Q6OlnܪިAAmU<Lͦ<oMS,6&iMbZk.[<s;qFheW'V9;^\J{).r6ա}'my<&axJg:]2`I;+b攭8Q5x[nP9W@y >yQ'187ݑ׆{ԓǦ<Dԛ&ޜ>Es`8rHlʛ-lnt3vALy[[M3\M
}vt-lnL>[˅rs@PfKͧρbf>BUu7PM

/[Ĉi2Lp%(cրAjZ138uB=Q@j
j]zzyuu,jAqH+n;o[v /%NT\˫⚙z=e]f%j9"R.[I}y\>,?U\nO2G/7PJQZr=<oQY.G䶌hFd5ݒghyqj0LNL.^vm<KB0ˆ	(Z\7kh:>=!/9FT0n>>;|5-v	.)hƺ%@<$j{9p50qN]4H&_=@x(a뽟zy#W,%Ёi+[ERLGa0+
<W@I>-]՞LEw~pMW,Z@Tvh43|}cQ7ۛ{Źe;HE,OtKY( |/p1"[|B7lr)Te>a+~ӧoP׏VkUe⹸x=G
bÂiy+5aXI
 \!ğ+.0._KKsdEpZ4c9MfP桦k3P3t̫Q:Wٟ#oT6p'Q	M}w~_Y|AM|ϊVIִk:Fb䔈'g3<Hb:n6Ѕ_OJ=D0|A>bhYa[^# S2#fYeWxl#BE-9]tyF5s]Hӣɛ0	x*4}_T8/;aIup#CJP`W)1!ܚ<ar_͵#Ӡ`NA)A4qR\Gsہہ_*SO^?v`D{ƂKkǨK~`Ȧ>2j*nX9i#t~R"$1vߡ+57vI&ȰG7QR,-5acg
S"v[4͋ڞ+@_6uCMa2ꔞ)@+s;y*W)1QXr$tF^&RFt[{(r4A_+Y|eݞwTviFUcFe
m 5K~s|\c<ހ?k	ۚY_Zq"O݈Nv@ǑCrA
o〚#q^d:DG#׽Eڭi5N.k5|/|ZkZjH\bt3uj?!e61HKXGШ?Q+ƋrZ>	;A.(:<[Ei݅Z(>ʹr a'8E,tfZ6nC9X{zy6)g#ܝQHFCSLҝ`vL/#/ˬlWK3|YZ2(NAnn+OV*FwzpFzR2:=f(lfEu77f+xn:JuuYZ>"Ҳ~pI(;+3[ zW//#w9bW'aZQ+s2AxXyIUaL<Gr]nbwϣkN^^kǴ|*Q#*y3\2*L''3,>ɱ-R,["]g$&sgZdC5*ʘemOW;aulw:S;AzkCNHRĽx2ѡO-~16q䁤57?!G82*@tR)ſ6vCˋ{,)\ n,X)Z̈́m奬mKh*d\kDrpӑ; iS߇nc<{oVRRo'q)Xmw֙㍈|@
?Oßc)t&S/żB\>xe}x<$#u|+nv>6/2R*cvE0:gNvŧ#2_+X,85B]r~1chW
²-[p͊SjgXgNq+u(zޚFq@q)7WIGgP4T?
J#jDI֑=F&؄U3QGeOnkh
Wj|'W;kK:Zyj~"ozW{x#Ei{Ӫ_WuOTc`ڭmƛ! H""Ӆو*ܸyTӇhRgU{-s2ďz)ɖVYrWM(/Cw\\`gܚg$+
PMV"][uuW]wfSb? OI:o8bVU&P4X66e͟wQޤb>db-`泚iP*[Q6a_P;k9`mvYgGء͔0`A( 
9 //R{y9yo{mHr:][pH^^)u'NЩ2Y-{_qHrةo	b\DlI(ÂiH~I2#ey<޲ J(f-.
}	.~>r^<!,|G 7tV8[Z>+2o+ћ$o݂{Jk:{;,*yZTk*J訮XU9Tk(+rC}a0nf)sa\*O8+=+隃8qRӛj2|}`=__Y.d<Pqs6\ǣi֛u2J-OE1Ky##dղgZ,_$1ndS^2ˑ^tW{O;URG\mm<(ԦD$fЄ}鼉s5Fj;	4裤]x[ Ғ]x OPכ\/<y]i}A.#uĠ,/HvfFs=i]V.P_AyXQA B[G\wR(
j&p,X^嶈|Us, 2qFag{`{H4|WO.cȍ]Wz[#x'YW/_T7`9XOHdo` n!oTbȗ_L	HGeo?~_XjdvCt};|S;iYϗ )vA$byYˑⶥEKb^VɅL;{93rߢmAӓ!}2<ʹz&Fhvh =y@'~[`()1^D3>dE}w&{p6g>2bjxE4?~!cxo@N_Ak|7!kկcDtG&ٝ9~V@DuTu/-`砇HYd	l˳)ƓiЭҚAIy֞&ĸr'SE_\`_auF)wZNVBf!>(fZR»ܳ֏4
EW2UĲ\ħ33hF=ybkkDԈ( ɡldb]'mxyX~5i7WKB[U+E\'7>F^_t}vYoHtVz\k>(4ō9rC4oP#|N2Rsm9V{^ޏ]$u/_Fa=Ni5pnRn`l. vp?aך?AP҃l-eܡQ]Sv<&;오`ԞK+۲XՑ; -CU0y)aE	N1#<T//Bi5^eZ!#>-?<<h&H fSt3@Jp\m_ǧnxE\`pr8W?-"vsJR4jz'O=lfi]pmc&Q
1+0SPt~Ō~e/&EY781l"NяݗTÁ;0hi|N]gbq,KX|˳yWf&wϠE:CV^'`.]Zx޶"B2冎sBٝ(8ww dބY0Cљ˟[B3O/.MR]s}|z9X^.=_x3ƠtU {;7KH9Q R|v<~IpQb#cKFTWΛa`E>!';q??цϝ/>÷9
>2hic趤YvE£%&չ&?&g&9ȐɞAn
 LGMЌ0^RH
g1 {<g49u6]55ȍجJ\j>Ԩ<%X٤K=3dIF&y3J+]G}O}WD՟8j>L}@zSp:W3)GI`gn_G6kR6[m*cN<8M+q?<<$V/2AY?l6{I|mJTdMT3PyJ/f90LY+VsaZchQ$(K-iKgD]4AWM$O4p3Ypw-wAn8{ϝM4!)7ˍRΛcMC^HTOv_հkWxX;~ЉdrA?^Rfes==i<BMqPls;I#uM*)|(f%_dg-&5[V~E*]_hEd2FƠeS΋7).of`Y;
XS	A{Kx*2<>}0nY_h[ֻ{z茼s.-[^B{/zpw?ٗȘݳͼځf_ea~w2vo8UAyfk^=/V;=ׇ
ov^m{,yxr_^	/WWy')^fMhLׯyҮӛz7L.Yϻ{o^SjOӒ$PDOMon*ev}ktv:v=[uk{xow^'"]痞|4Sf 3]k;Ietrs
BO2J7#ON(y
+g`W:g_gKѮ`E֞LV 3ߵN$39~^ZǓnZ[B.(ܠPm<cj]PweSJ^<1<̟/#)䏄W<TI9ɚwXy9GVɼik3}~=n
:X͢axg_d;@[M6-܀݉Ԓl/(&)ٖd-7)xP}ّw,FRg1"sGWo/N{M6aǙ%-[T, 7}g$,ɾwfMYF7ƽw%>:(4gJ͙JOKt4<ynCq	 ߨߟIJ5!l?lf17r׮gtzם(7U]t!4Pj;[[f9:/7XfײչwԼ5TIȆ8ߴZ6cǇUrq]k#'a{>Y(z^s%U[$,%0Oi[nco52_ν'Ig:xYswԿ E4>sf@k۬(ԛڬMPB	(06>Je>ڌJ#P{N_];?mQ>x#;IOzz7;G A?U\t	)M'c7vU<+U#iI?Q
"U<
I *0>]<-7gdEp^hFУJ])wRT'P3R鳱IdPG6,0Ceֱ3FlA4q7<d5ҮwE4A0
M8@<r1XǧLMVb:[P9rL]xq0=Ql_аowrޠԓ0虅Qo4VHp׭mVSf}޲քW
p+*׭b.N`I;FVt@PFg; 6.U=v|kM{*[O2kmnw|`q+-h$FӤfvvYF9.Ln(li:GB2$6k>
vjh5gcs}]ZE)fcXCbcj.5+h4G
-l[LE2RK918v5qe
sH)csoCYt։3X	ʪ=mhF&~.8U^/ee;ӯ\|<R(ƍ.`I@{
5ٵ<2V6vB-½}:IKCbgfuuv[ZK-82X5$Dj_|=_@/d4U$ˊ	
GY7q-tzFIg+8:Z H>k0_R7HQA9Gqqu [302,@Gxv93Gl7iu\"B\](I(GZG)>#,O5G
Y+dabX}χf:fȍd$N4jfKbvF$i̐͔)?	Ioo\,w#
o-b%8ί
;^偒r
,!Ɗ(>XAh⿊;+rgj焯
}H]]q\?e.`*/[m~nV{ѵFn<k66zcv]fu&̓zyծ{5;z}
IV	Iutwuv\}v7gD}%-Z[pv}|l4 8P-]omYΠѲ-nwk Y. pm_5F k^wfHjNԁ,l5[FjuF}jnժC5eu SCub6`w) zW6ֈaLЂJ km6u{mcmPtmHРíjvj6SW@:vl4Z:.be2u]Hށڥ2Qa 36HQφ\a#ato/,hge	l4vw]֠]
~nnAeM-t@S	ËkuƯ/k4lT5Tެw:0+ .50n5Ѽ|C SgUBskmym&5#~u,
Xб50`lc)5-xo^DFh40@yc絍RwqȆͶMX__ph:H]7:@n7֚@0l`o_0Z9~}?R;ɬ6:(KTQ~6?X|r>}B)ɠeC燲(V:bQ`s|Tdi*O[jPCz+z#Ϯ
'ogW3/<oѫ?&I$gEk~5y

{_bg|'n|::jb^ \|n=zC
&BH{R2
yҺb#GFnF]_9lFeVȣxF%: :sa+JSyX7O}\^TseOF3`z)Yy1770~DG|z̗Kޤ$JWavI<%?C.]yIYfx^\J
{ڃy-JW%W1A/s
EzReFV]/\ τe/PIrgƊ;WE1G!Ǟu'j\sG_nJ_oJ]5|3=/	ߍWz2wDk,Bbwj9UqqNB@rCSa:A</8Uu!-{3[_	&F8>u80R>o͘N~AQg:(_<?>zIf?\e3~-?xL2L	(Gߴﲐ{qPRUPwErdWV̬LC7aoESjvI?)I,?K
CS)W$_|ƪeLsO3!&ƷN&s&KՁ+EU}:'K,P	PX?%|Iqrr!s`E8 \NdR+G(8/eF+6WySo6V8\z3z)((8Jg2Q.*5bQq)i{e(Ra=V./Ąs
	l6J7p
18:HTZ^e:Ϙ7`x>0	C!F	^-hx<$-:SF[nR?{m͙3NweV9`
RG%ѩwmCeJu	`2v^^}w7tFp{exR2MګX'h3#L`$FơEM@)IkLX+ `B0fUA\h ufU_|ũٍLyLںE.\- uSZ-bX"EW'.6W{Q&qjL<C=ьeUkk6p!մGXU)	~-2fP˞'rV9L,H֧IyGP\bw8dpVmRW'3499
]60+	C%}5$FabyU/#ĵ?%L$Xu2R,2/t3OMqre NO!B) u厒eE0t.Xfx>gfU]3eFzG+bn<}VOatGO早U,~MJv}0,Sy'[dyʵ{Gȃ`Q{X%WM-j	`)ayKrQ5M&5zNr肝~h:X2@Cݾpc"L`n25Ϗbg4ή^nMvBԉ`
}"zHIqJ= Ν0ys|-e)4+$kR}&TFJڸ1ʒnuhDӂvZnso5g3g@8`CO$"A a01eЍe;wqڃ+ׯEx	~IUE1xo63//vv^1+.!y
a)'0ɵSDjYv%2@BF(qXf+xoMa4c~ ߓٛM%VuYT<>E fU%x[yM pGt(
.x&WUN0h
OL)V3=¡ݞ$	u-x6"r'/8*__s[F@&an^Yfޑka1ܦ'T[y"PsF*1@D]%QbY~A t1p#j1ijc?<kS,xp|տaWATT5	Lu	^?1'qOsWX;Yߐ?)OFJ;浟Htò$TR4Y"*(n*=Q+ bvR8>l16k`e4M.9AX^,N:7TJI|?ieˏWp.YdQ1}?r"z̰Сoef`l	ٟhc=, y献r'j*iׇJ؉뇑,Ǎ.48\ñzdouf#KQBjN<m\!\"iT7k0ʊNйm^wA]4=^R뷽݃+$mcY!Ӽ g:8sXl`xJD7CG@YLJx:Dqa)rw=vU0dl%ϕ>g8H tT)KУ=Ćyǚ^xG^^NjPx@7KN	3=TfVv\-삅s<Ԧ(mi, τs0ZMtVi3Gh0%g0:bCj+s3#ontڣw7,ΝXtpZz9T4y@]&u
?_/DiusE֥ᇊљ,TmV>;쁿Bg
/zEjTҀh5u M`=F&dY!XVmT`yT'Rxp1I]96+LD!LT Ւόʧo{d*gh Cg!Iu".(kft2e-MHgVFzQ'^|:=BG!N008jg=2GO3v}Ҏ>Q+cfAwtW9Y*_ՃH
>zCA+=L.k	ln_wb0e -:v/+	!ڴ'GEy%^ġ3aJW?$Wzydӥ8N%޵pItFQ0C}q4`:)M*bF$u(`[`6E}twn_ m$ԳP1@DwomvNkjr_/T$ΏA:_);uP!r@*vl
m%|
2z?eКr%2Cm94D3焕bW Hg\kDX(~:Bأ@1돏iX>>??L$nLhmh::՝*Y'3|'/gK:CCm	=*hI 0>ibXg?t&?' :N
eԟѹ8`RQz`4mE K2F]nE3NXz1,/_=dj|h0A9T0WV :֋X}\U䪡D@%%JBeд5J]O~Uٜˮr@<a*p"SM8sɺaò7W%oOM3_Ʊi:D.KFy~ erK~3>e7F(]!n}.]7ã˓pǗ"B嘾qx)dKT@_!Z(%i.qp)]NÙN2+,nu齀l2"HB
EE ɬqJl-4
an4ϔ	mV㋉F5XUʦ䫉mgNzzhiaìfNxB^`]gKy5mHRܫ"ՕPYj0e۱s|D˭d"9ژN[N/]$bËoyw{gClѹs=OIR&ۍb~io7yn٩zcۼw⿹>N}Wwtb~|NiJvțf-LP-*0 ۏfVM&,b'hW;ɬA1"<Ya!Z#ňe9O'qzZ"\Ub%/ݏ_<7)z}35޴ۭN39}	2ƣM:2Qf㆒Ng FEi^/~ R3vǾ6+gfa2TR$^,۴E$=6&4=,?΍C[#Y$ɨΓaLi(|Roloyfnr
*Q4`TZ<P78o!Y?E\B>"L((1vZm:3:Qa-8Q&>hoq.+T&T\H0R)],!hcJ<z);VΌZok};IBK+<K{Yo/:!KC,tˣâǒ_K?cGˎwB^C,
$kK#w_Hpkm̘n6F^s'I)OͿK@./\n]M4\|G44=ypVj/4s .>UVFmS1^;>e%~%JV@P+H-- i$A@#($A].4A7]V ӺNBn!14ۻ׶a Bi'dI@aK4Y<Qg)#[.Ir,i׌Adt駓d#׸~ZY;FX]Dg^2M.BV'2cgh<VhA4\ֹ#UΡ4H˹>R&G t"v+{YRa.$;za]#*v@"&:̅N9k`ziJk-SI<ݔKܪƘK F몷Xj5 :5odKX^4RR3L%3-
 TNgTqH왋7h|fT08uQbbR@rĒMC$53<Q4*DY(3軌֎6JG 8d1xKg-ps݋uFM hCֱ%@lsE ~7ǣ,}6 Bwq:?mK? l^wKk&A]pU'jȞ)9P)A/"vתH@u0&`b43Jܢ}fiSP)/N.KiZ+vRnIs<Cah,8$HǍMK\pDH(Wb5o+]@tMLҶm=-b}Rn/0] ^3{?5[_e_5eo~x#5*8wU5e<Ls|)-w|w
p
߆'L l 