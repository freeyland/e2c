#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vƲ xɒԽH*4E<GMR[)U *H"{S<LOOkì<̬5_sd""3L "K7aK^"#######qsP{NoKf5ZnvVo47Z`](vB $tn>d''%v$礁9tڝVi..a0Fo7_NEqq;w(8QX?ѾwrꍆG.fvh_| ywZ_K^4qOKlߏN|X=}ɥ_EYwy?흰`ʆǏ ,t!Q0:'`A<`'}N8S#vcyaXzGXcz{,^
|wƮ,6>f1NGL]oӦmC@ř78#$z -'A8p k \~tƓh&T	ggA0Z}Ca{5JVk47x/~8XǬl4.F~5tO(M0x{],'G~wn
c곍=VڬW!Bwg3e+h[D;qFk4Q+c8092/!n˨6 +"2pzP%/ݹ+8_Gon #N[wq=vle;' (8vF}M4dg\V9Z߶CAMpvas8ôLaoȢ`:2?Lc+*>#Ŭr⭬MVs'謏9moұViۍJ59Q"	Z	ymmWؑ3/ 	P*CErP;Tdg"TLiR1M*	:^<Umr"ZYlQ-*EE*$6ov*]!
s$
d^eF`K>V++$2`@_1UV5uGv
.ӟ0¾WRüT0H0j06{Z5:?5=/wy3n
~AIpu%_d]s4gT$UFS($r]}`a
W5'Iy%yuЌƬ	6H~U+8d}%Gn̮iNڿ6w;쯱*~4J󭣯	+ZNhg`T}Ó!K8	={O{{/w_=uu5o^:<|Q!ݝß{WY	/<?i䃤2U{C2k*E6ɏiS$lLv|{o056eYmeZ(:krz=pr ~tӈ	`-9z*pĽʧO̙ʍ/_MG9Q{%JLBt[sQ{Y:;#o"o3 Ն:H|7k,+r,[DuFu)[UxJUα~۶mzGnZITȮ~kZ8C7>cN.D/9teU}]we>3$;W)Uv"]K@}@}Dѻew	YhQcT	ԓ^\MQgE5զ.)QOA7s7!9!l6xaEh>a[$g{;;?mշX9&eA|)͊V4&nO4l۫3X;UZA5kD'GKC1U! }J^{r娲
	+*~gFGwم*I,_Tc0"Y:2рsF;O8/U^zĢ'Xwˌ[G~%3IT6RZꧯ`HSeDqH2z﯏⣸%]_g5kA\gj	 w"Y8ч~~Y&e0H[U-H_	1eiƹ^!rfl@VyI_t}#HT:EַߦW?YMAv2+K'g?6ao
w^TPY
f򌂢49Yy碖m?F '`%G\!Fj^bNKԩ	2]"
-xPK<LP$n}_{8 lRadP7kB5C?^S$9f1܂qt|X7Ҁ9O4%!?-=d1/PY~Aƨ[@'p̈]gJf6<Vbj|ʸ-VV+q_$oh</l1wz0DW*09}y&,|٢yqT&F7Y:HgK9 wt+BUTBgɭie53>ۃ}M4ɦx}po^?Cy}p%HwL>2?QNGA/iIK1fQ!w{T4F/sG*,,\"
Mسx7J7vr&@K%˯7o,&>2iw.*Q
E髌: #
ۯ~ه?/^M(ekQW=_xxRZ2J3$=\¢3y1ybB9,Ɛ-g'	F:7	ǥ*i>)RuVj`Jh`
td#e )躐Crhg6vπq?;Pɼň6J!J|@.	ʡI aCVHʙ-Ѥ.L^]G?}냪 ا)}X2c|b*!&)@	]',^j-:t*R`z
dHnNX>fu+%EtԴzA|o~p3'</b/Gc):B4a˰p00I\igE{i)[Zi+]49<9TJmy'yfW3:|&'i^RW~oad'/%$^0.4TE!ab]$b́rڸ#Tmo?̋Kn\vҳȩlA+EqAL 2+S)2ɣ/h
ӨZT
1̱8L`<<
s')'ȉgSs|%1@?ĉ0ׇM7a>T+>#&-7Ēo x*CR]I\H(&yC2Z
y%X8J;WӠU1T."Nt.JAQֹYḳN}m"ihU2Pb`sj$cMMb̬KuF֬+ \3$0}m[Lvj/fSƢr%]ɞA+T_f&ǒ쒶}bZPyX+t*_򯷫n1ML<uCq]4'&	]=TK$,VJYa$p"]]ra4JTa\jEF+a0lhQ|dof0]ץ;-{Wy纙x1ЍIdq;p ʱ6?#@ITa^cERS9}8|Lsalt獬-Ѭ+W},>g)=47ddZ=Tik	(+XQ\&d9em2")ƣ"	,6bbVu~giNXv%-Z_$ﯫz{HoN`5TJA):ϳ -0/[c'>}]_3yGt}}KTRN"r-'GUp%e%7~-o5"oJ5۞Ȱe]Eo}l@r"+jZTQ'b$'V*=%ъC_^nc-ö́؀ohs5G,]n4`n6yxfIH01
6o	/s m+H]z:;hi{MҸr}gxWq8uBs݃^]8QF2ʭ3 )Q'D)U4F#YFxTd9񙶠NlDjE99"% :'2QǵCAzBʱMQi^R~R-aᖞYcBd2) KeE.3%$5ݽ1sAN}[f,33sV;h(C
!rol)̗tRe@eR@`I_/`ʱ`e2F90dX9&/(d٩}+ܯtUg!;bW,R2iܦfô3GnϪ9xiЎъ^0i:)L|)L:׏mt$Ů"Q01(L	$VPg^Q_g`4ĮOYIYvFt릨s[BZq`a~ΉyNϛ%YRߝs85%d-mz2Q14&z܎PWT?q8tycED8wp#3T9)-\k;KoS@i|ĹЩpq$UE6{~bV-~a79P+3[1FTI3hXIҩlQF$t7H"i-WgE;FbLO4FE
)n3ީ3{xe$/.Q&nG_9:[*{!ՠFy9ndVk~EP/(KkY[ZdITگNbH8(3L %^}'f$OKSkncruF֋d@@\>2PHJnVX]xs66-	KRWY<WNgG.<raҊ86G9I&i/T=OS_OKcsڢwʷYxHG$i|l;,h??E%-sMs~	3 9VzByK&L)q
*q\#o3ڑ2GQ.G,/HN<p5h!ϕȔx͖0p B!(_b.$ip))ijA"jD]B	UDDB&D	5aS%@'ϝ'?^3 h֚S(Kя_~NFߜM=´,qK>#L-7똼3inͶ"2jc/ǣyN+_kTdܰH#!<{OO~W;wB
3zG߭e^4iISӫʯ3ް;R6$CCL&p"h!#&8(KuF[39ǀ$$I
o~zO7DD8G;$}T4Ee=ϐP݈P@3*]	bNpUd M^sHF&LcvP_8=RjrS8>Hb:I\ՒaD:*B\?"LJhXRն7F I_\op3	1^Z4ۃ'yJB
NpE\Kp%y<CPdoZ9MbZ9d!|cLJ)HLeIUݼn^
pG3`!Wg}@^b-ﰨOØ@0 *I
Nz<CA[Dш)![VC*hX-a/XƖ2RAyt3
J؏rvG8	F0	yrD9~$c1r;JV[	i$zy&S:ɏ\H1fLr?nf]6_=T7ӔW@٘i^кRB3oa6$N.^VkS2վ0es̩d <_i5Tn`0(ii
$iA0lP
A60(fwEO4O=MN"(V6b},;qw0RznX-%cna,1%mP[2ؖ%n%!D2VX:/VtMG޴MK4MCޘ,>Zd%YAV/~M%u	|]_%u	|]_u["+u*d|D@+c9i]##H[}m&w]7k'wYX~ fR^3),*$i%'I$</$=]~#KOȴ,pnYbOڳ`:;NdHʲю襉#.jT"S9*k|=pWh</;9F+>h)Fݢ>VSJݜQߧNpKX'd~e&fWD/B@XSg:,/
,λR]UڇTp({_egrTʔaILmTP!/ޘ^ujh {^m\ɛ^o.~Rq.e=Uly;SL`hyWT'jӃ=g(*Bc2ćo°&Qu#?dEw
WIFX$0j<Df9̕ݍƂax凅FB!P	)n?{	vŒW%W7"\)ܓ-]_lE_ΰt[6<߈p3{J9@;+nEW6mHBY^iO7"m{OTi1`T)ѻݴ$ron8e4$Au#zH#$ކ<4UFQxUZ@<~e,BƼId4W77"0KH͐M#fz0*
߈T
C6G6zO6~&.Uͦ=PE3&o4щQWͭ1WZ(8U7cXHpɗAݭHD'J;Bo(ߝַV=rW4	/&]y1)v?f̃j3ڶaܕEciQ5/GL\_itzE.rHQZK$nD~cN¡+5TbXК-0,|/"G'o!ƀ<w1 t2⦛{-uPe2ZǘbŒ-fHe\u"O&b|I8nZ^UiCpn:Vwiu_ :j;ܢ &A?:XPϣ6Wt$4Ls۔W'hyc&0r/ГGi544i֍'e*νKe3#.Xff:9Ln-̌h44eQy2É)?H&^dź9<HqDe|^ZFS@_~&⻊I]j?hکwzc
D8a&k׵N4_x$j3i#Daf"ѫ,PDe۝jreR)#]"(*ZX2*뵼 7r)(I?ŌhS̷uC#Βz`+֢a4cޘU4΀|JTn9A>;{2q)jzyDj6H|fݪo5KhHjG%"%2aj݀rƺx COb6̜GZ`e&s̒V$iT ?.-ܺ
;e9XT}qC(q-Nt38Es0L5|/us̻6W)'RD,CP]:ByOc(wPk*2|I^3^7Sϵ蛣VD""s+?]ohn
_BgSQajUM'_ PRQ.P6Fq0A3DIHUh^t̆j?C˰Ӊ1Ď]]O!(mzL197Ifd<aeEut<D82!q;;LgKJvwgh\ث`.j'lG䤄lntb0Y2YIp:,Yّtg( J'1M!O4w|8_*gU\5C~kfn8Y1Y|<̄N֭j/lziV%f(5h0|,3H`Xyf͒{OR#u/G?Li:fMh(x<BCmn(;Xou.M\ΩG5	2଴ґ/[[mFi|rK.,pIR0	Ş$YK䓽$T[֢bμZn>![W}ļ>\(9elW>yY$Eo
<_לɄ"A>3MEj-Iئ&cYkFX??>a`(nr=/1q"\og朸.R0fϝxag])Iv42ƽY]˹(˖Azgg2<˰I%cc U0qRIv1_-p}Qɏ5xncH!T}74}p{TwY:sWYY.3r#3N`@PwW=4pwG @,ChPQ0'Z4.Rz2=y	BuH2W<\B=8jp׉.9לS\ɺj8y;
1\2 	!ٌ";
08.ML]VA:oh
cb0ς=9F,0E]m5bv E<2?l	QљmȂ_fKS\(-Cfgr1F)*2U&|/]SJYݒy&38[(Xd٘v[T٫f1uX^u+an#٭FqkI5σp@{ē1t&w<ZhZ,Qٖ:wB7(.a?i4,(c-&'0 _O~~z*KdzMղ
$P^0b JCH\>N`Ʈ1sȬ歓z76۔1X7Jd"+"%/qԁ#Wi^owQk |\wr$*ӻ\BW~[mtneozFGa'*(kL^VĒ(=#@8yfO'm-hydƫ-P$#Fk>e:[_7Qe_dU)fqZRԂ+K3eȪdIgz\IUJU˅-$qXl'
 맰FgQ b4fր56,xɫ|LAլmG}F#JD2-^¿BPӅ  i(qs(~\Sɘ	:OV.sYo&YU-Wn
8èP(>*<U|Y~M

@|_7Vnq̨6kL>eܳ7m[7^:v^j²0-9-eLLFkI'L(&nr06ܜ`цӑT.\%hـO%TVފ<>
Kϡxy_s0|L9NT%#J3Ò1[eJ*U»IR%)yiFSku$^)|\/6:~</_Q؎p\_hl$DJDWBH	efPAwKҦ'0sYA[3@5c&!l:Ƒt ,/J
6+gHσwDF
;&0DD6/,fh1"m
y!V&IG%HEOsxx
|g4;K	͞`,vvsedn=ԃFϔյI83j^Xٓ]o9h2^:1c3Zyd=YS@jFb_Ox%PHhB_I|'a:Psgk--k=iIvAdE e<۱'V.ZJT*<)!tXp	JhTX7Yp(8h )Pj(Eʴ#qIǞ>$icds՝2ӫ9WYjDb +9ŗ+[<SW1Y'"kwv-B7h-ՙDQIK8>$?&|SWmZ~$6=GgP4ը0"%GIeҸn fp{{K 07*Óϊ8<5IT
6խd$< Eu/7qF쓶)zܲ#Y[_]Oߎ$T*^2lh"aJ\ahbwy4 -%ZAd+WWjx|E"0WӼJߕafi3\sDsWWsxL˄̖TYl5e̢A1ezQRsNsJq'e|TU7ql,gh?^.xgM+M2q[	4k^F=Qj 翀.Orj]c`ҕ7ɇ.qYc
<,v:a&{*穐o/N1S4Q\R[盾0kQ2pDrJJ(%Ҡg1-TS%cԭyۑf6s?-Vl[2WYd7BtK2O/&YjEH,o÷2k6N\籺Lϕ̪뎹q[xXw/̭rsJ56)$j:9k/>{ik5s0upowaTt8L3L_)9+n\Wo/÷wnú0ri.6[KܤwaV獥Kt97nD:FGS}2E. (f[	շC3(ljҢ3;**VvDҒ$EXMpp䠭,g <]3geGENwD[|bo[Ic^)Ǵ{r\Lm2QwoX ŠWeu]$(-Hh#Ќ-gvS#3uqr%	Sd4bd0w,Җ*tfr~+pZ/IQCFTd#:`|b&(ȆKC2/1d>h%-uG[g7m4<MǮ
=FFPD 1z*溟v1ϠJH;NK6F0<hY;9MLJ*꧅3+P()gW|kxw<9	jEBU H_[> wRUs,$a<2Yck1}d=fx
!^_y]_1aY7Tji~VkkzJU[C"q'Bdl)0e	*ξV^kQ~XjG?YK2ϛ"'ΦX+@Ʉd+sFpNƎUAfAV͛!A/umK\XsZQ@bz>F[3d8^#@Qm+8rv	K1vv<AL(g-|5Ͽ[o-p/b."EF]]/H&v07dXTf1B0ς]:Ll.*.7% tzAt]K38SO>e
QۡӢAZe_3MMJ2|^3^i/Cҋ3ЦeIȉ:UB4ri칐(y勲xZdtZJ}7jg6},.{TZr6i4my}+$
kWF_?z^IĆ!ޑಏG OQdgѮ3?Oci09 Ƴnxп"d=K^]3lĉyrGC戎_
3s.f?GH8EntGV6nf4^=POn
R 馲ڬz蠃+=.2Top5Zؔ7[-?f vZ姶
gTx	-NL>[ͅ[Qrs@PfKէρbfBUu+7PM

/[Ĉi2Lp%(#րAj/-^338sB=Q@j
bUzzu}},jAqH+nη;o[ /%NT\☙z=e]f%j9̝"R[I}y\>,9?U\nO27G>7PHQZ=<oQY.G䎌Fd5ݒgHyqj0\LLL.^h6%n!dJMY웵r+y4fKhqĞ/cj΅	t#xkM
i>;|~6	ֈ&)hMKCgM>,+ӈD!sw좑G0!C!ww_
 (oe՜-Iņ_YjΒ Fc7OOS^e+@fԖjOo;LG)&Y4&\h4fƬoȷ7c'vX>9ݟ8+㗲8Q@65_GB7,{[a<a+~ӷoP߬תl7}qy*- GIyņSާ19F<ք5`$)H BpV/$T|#R\$87IV 
M?E=Ӥ.9mwgj|1=u5xNo`z;N<6Ne{'Q[WxW`7hdMhB`$FNyr6M$*F8/"t#<tSP="_~Ad@rRVÀ !L,9kÃ'6Hӈ.<'i$^M~kj<7ͧ0D9FFk:8\̑!a0y3{JLH:7' O&n}{#g{%4(XSy| F  M+"Ur :r ]ϵ-sp1!AR1bo^87]S5,: o0'sRsl.k$}5*)rMQ0fI0%bӼxsEHІns!QB3_helO%B*9
`V\1yȫd<^шakEJIӊJ"}da6{XL3©ߌ3*P47ThpQ;+#S/<l\m~.kf~i-Y c >v#:˙Gv]F
JZyuT8:\j@mKj\7jDp_R!HyZjZjHTt3uj8l?!y0HKXШ?Q-ƃrZ:	;A.:<KEi݅j(>M| a%8E,t&\6nC>{zy6)e#ܙQHVCSѕ;ʙ^E_'WYK[Y%/F.dƵQ(q/ʝpV*F<Tet{3P(81+Jo{SV\en֕6XZ>"Ҳ~pI(;#3[ zW//#w9bgWaZQ+s2AxXyIEaL<Gr]^bwϣkNV\9jƴ|l*Q#*y3\0>+L'3,Y>ɾ-RU-O3s9otQEse殚lxd̲'ƫMm;Rtƹڍáf~)^ЃYoU{ )ţw­OѮ-)LJe$#t
`toA:Ͷ<1K_
&W S$'VV3asKy)khu M
iW4-#ct@gaϞ`:;SI_\x5#p~5A}x#o<)/Gcϑ*{>e/׽ϓ0 'SaGCFT^I"ybT7}νz̩NlzGk~xrAKST8&޳w\8tJF04z&$T~ڝ"D܎<Aʀ$Q:(|%a+i|ƶn_љ88չRʹwu$Aج'ոdj3ȱ^6QzM Jj-c3gkgL^{'*YX*?i[V:?c'gxN(h3@WtFT1	>Dk9}']M/e9ټ*1CSj#e(JC^[yb5aJ_$k3..2Z,lJ7G);GM\gw\j*$ 
kJ,.J߇D&x|V5z{s>;j a f!LJyͽ`LN74!Da6='`	!1Uj{ 4#omoﰶ#cIP|vIVkq݉E=t@V˞krc>vqD1t.#$a0T$ D6<nls9JLd36wP	p?9]USq!+-܌-@߷JnAuOZr<m-5,P{nUWŢuZ_*Z5X0]B
	80.y?kglntA_W8)E2|]>P0@ƞF/,
2l]k4`?'KBkcSNjk	35/^ZGZ~ܘPq.]Q/H/:*#恶6bdJ"~h>uƹ#KJlQ.r<-siEk.'}p-F.<.>LqbPXl${Q+Z.~(`C<(nU{!Ԓb|nh}pnr5T	9g"2V׹-!]՜;"AKQ8.܈=l,`oAq"ri
SO\yYz36拪F""m;	.r	-\r	s3B6X騵gKj}o?|sG:OrܜT&KVL/+|:RܶhIKT*pa'a/gfB[%hw27ĳO9W5-'7ĳ5nr?!K4\m@Vԧ}g2asÒaP=("%',ē~ gvBpZ㻡Y~P4&;*4unnLy>md'栺s~i;=eM{ʲG&Ke[`I4Lc(NDNJ4y\'ƅ;"ʏZgVjg3ϸjq0)~@	4ĕtU65lզQ(B9@ '~A6[\%j輠D?D@L6f#<i3K&rFh1H;ٸbr8ĭڬZ):aײ/ZikaΗ_G^tv[oX;naFY>(kd $thl $;9))G#\JK}똳F{cѽ~}?ww;vol4.\ !e]|toG[hK;w++[q^,?vLٙϷ~|Q-mNϮbQt9_h~0<Xa%$:#,NĪQz8RP<X00wwi7ܴ#qM}r>+9vYSd~qpbVk|E4%V˵@,9bvqk\ SW C" ]uꆗ3RBn4%mo`''^PWtLeU5/Cw<aԗhX0Nr%'Sb=9+4KNHCvnnN ]:Bm=EdJ<;Qp	@D	`sgv,g\8^\ܚ&xywr{98\y0"g!hPAwvOo߬,DHinnYDIٚ?yPADZ9n\f)Ӆ8H&^
 ?w"<wsd}i +˩c趤Yq?Ņ[+L*W--ς)Lr! =ڞAqQ߳	DaBoϤ 
#xhrl1f=kTıC	\U8B<Q^J I^_jg2~1M-f1|M}WyD/Sa&a0l"cL}VyEq^P+yCRP:u [f2vă >|N^G^=LSLh]/j2Sf޼wq}-Viٝʊw*@Ir?q;
4E~)	b0w5y:"LKL_ݑ{1ʀE#~ĄofƁc)~2y8? 
IVODgznq;;ǿ6 *79oZ7t{9r!Q=}̯~{[Vnl\2x	m!C#q0<Nnmw<ZqH.tz+gBܗ0HvN'h떹SxlQjwJHZcB@iu]\1-!d
}}psӖյ75>1ɘގ<n)9B)TBо{
jܕ0Η[,nv3zeJ=aF2WVdg/!=g8{GdYf>B/z<0p?;ވW`w Z||}po^?V=ׇ;ow_{{,yyr߾~>j܋QS/(	2ЂO	_ӤM}7^Wo^g_T\_n0{p4=դrv~~ ὇{OozvSɻ^n%:v=Tɦek~z_g;{
Vv?ww͔a4c%,j4R_}^w'W?d4ߜ&ӷL%-S&ʃA&<`E%u٬0Ga%uy癢R+v00'k&_j6wcl 7;fXXQem-M~FMi`P(gwSJ~PГ8eSPH^<O1#<<TOIɚ[y9{VIp򼟩s3{yޏ=n
X0͢axXg_$;@]M-,\g݉Ԓ,/()ٖd-(x'Plّw,Ff1,sGV/MNK-aG}%-[O+*A3d_zJfmYFY7ƽw
K<f,i-	63m33+9MkhwbS Fu⚓J5ڐLe2mk73:FnjpTj<&涙?tx-Yiu]\e_vk^}\$dŊVBoY-CJ|cn4Ѱ=̔i-_|/S͹	K;hw?J_zC[͍ns/%|Vׄ^3<=$Bdrl"`X=y3 omtMׂmV6B	(B3m||!.~7ˬ|7Gw;_wr=ß2+O)Wqx:ç4ؑcWy{ڬOܧiP'5FɈW9*$Q׫\x7tQ#o6ȊḽF%_ЍGAR3 h,O#hd|Bgc//8돠̏m;/ec:
;
N7b3pͧA$[ѝ|?GvS.zѿQn''ip4ֱ{3>eJn5)pǑ{y qo)ˬ}}|8sӳ}G,z}rRL/hB3E|}ځ[~[C[5dEZF6&^cH?{k`?׾nB`ty
Sډ7־n3=?w6Xb1fKkElvO'_FӞzq׭EX]on6wN4`I+h$FӤ67fvvY	F9.n;lsݘ5x;	rʐTol4x/4u("ُ"ZN955'"E7hFF~v)HC*ӉcgpFYQ0N2676t%x,o8CŚسhdbSR^V(ݢ0ǥYF@1siSB SЭ.cac'3,34_pFn[P?mw#ZCrOD-HJNSA8 	p5O(gOqs*	b4:O%exgYA:Co
=|g'3||dvCV'%"}q مRXR=u0[sB,kP^c\/<LFIc:f/fGD"FHɑ؟f	Bzl0`b,VR#=U()(^]bx@
FUY);3uP=|^`gU"uu=w`84|hlװWyj۰4gveo;]{) nt&xf]o~ةDdI[y^a^gΦn|U6Bһ{D?I҆nF{gsȴ1e7:]Ѱ[?n@ vTnۣFnw6,hk{3hnmڝkm2@Vuaڈ@ڰ7]qظ[MiZ:f~ܲZQ߰n}jաUMm!snn#X|nnx'(Q#	ZBtmBio<!v[4hpkmZvݲթSS́<-XXtBRvz7=[ ;(<t@G](lgTn۰A66	# l,fnv~7vݵ;vqkЮC;Xc&>ˇNh>6{>vB5cCfNF~6oʧf-V4`jjVX]n-olb_لвxS⦀ۀ?nʧF+kH~nC#7:t,Pxmj5u.Ttf[&lnn'RdvPlڍ&,%:+m1XOw6X[$lNA_as8N3UsOçOht>%T@al(EC1<()<s#&Q5ٷm@E1i,<7-YpZPKuv1CZP3U oq0I'a>/jZS0P dXj>sjhjyqO`r-SȖK\j.*#It(rK{>P}:ۍv;}oyG׃le#X2+D
v X]Ҿ%);>\_Wתyhu<xP=\teb^><cs&&8]&S'~>v1J甹k9$#s^煶ʹ&Yd@x~=^ES(+_f$ՅLH;_UX|6asqTP~4|ٟry+J\w`+e8w4魯߭1Kk\||U/#weH?a?gco4ǝ g;$bNfV\m\PZ mI2y>F&.:iGǫL!,ϖM9$7	¸͙N gngCʧMcSYpIOx2?pzl]勇5<?_w[du6"j$! *H1qtAm9^>%YZYWaGy%u5̪̔1t(^VZX?p?zqojWt8p1Ter5L"M_|ѹX)x	S&)ĠhI[Qeڤu>pb%kd<b.7
3]/2o9!2' MFNQSU6*Utٿb0#J1xÈl^`ʻk{Cɯ	[YKA,SmE!FUW+;fVJpQDn#ONͫB
vu<_fˉ	la+Undq1&bܑwF41$nq	񼯡B^I	"
$RHIZ46t&\ʿvVڗsgJf֫1`
RG&0љw}b}:؎0/e;h:KRDdKHK@^d'ޠLӶ)7t?Iebol^`$z¡EI@)IkLX+ `@0fUAh yf]_|ƩэLxy]8yW@Ǳ벧4#Z:ɰTKE޻O\ldiL?Ԙx2z
\l*:Ci|êJFN{z$mW W1F]=utnRFA2?MB&S}
%1u)vxCflտ~-?~=sJi0Tw1k\Ej&^d4B\kSL"9̞*sNEy"#R]gtOcE/%&(Scj\\S hP&w:A
HQUf4k %/çPJj$ߪ0BA!1EЍ)m#]:B:j	5RB]NvFej1d7vbyj/z1VIkhqRZ,zJ@}TM  'MfD9d.C=,Np71A` АA/خG)>9nzׄ[|>s3VT:8@D|ɱ!)#N@_Q#3pم&Ot.#E04jdYJτ*y(UIFYRrQ7/޺F4-fk[XUIai1F\p4sC
=&[A"8^>Ƹ:1<}.N{Pso=aQXү*TQ(8apfVxbpBbn縪@nByBz)լ	; #̮	(IH,3Z˵_lz{fǇ1>n{+ͺ(* *YjA-~^ _uJF"P^d	c=dQ*'MHn5I
'|w]U^P
nOA26S<V哌ϯ9-W a0QBy/ܪT3H5.o*<[ug#IMy@"Y.i(a
1,g J8Sژ41,_v5)Q|r|տe׸@TT5	L5	ް=1'q7Dw`	vؿC<)푊T~"ёӒSI*d{ītSF-Qy~OJ9|rG6o\6~ZQl4ٶa,Xcy& s[2r8m P*%$%-f ^dri
Ddnh1æ>B~їɻ@,g&d.z4G|⑀L3JL\
aF7jvP rV2᛹{Ǚ,zFae!;qcvWpQv\S++:sGCyNFp#y~uR{Kjk;Pe@r88dc?aŝ	CHon׳zb)tFfLC\c|URB?
R"R@d-A5kV{NxY'rp<U;ؽZԱx}4+:{={4JӿMp,DڴEf3ܳaq,o9V/s:]+=W{x%{;bCj0*s3#wƽwΝX޶sZ9T4y@]^
 ~/DnsE֥ѹh/|TmV>9Bg
/zEjTҀh6y M`=F&dY!X-fT`~T'\xp1I9:3d)UC);%џOϟPD'|Un@1aBz%jE	vS
QVG/E«1p1d[Pd3 %'Olz
OY	B`Fap#i9zd>}g<;}̵Vo'	5ŝo82:6kT&oՍH
>zMA+L.k	lN_=1*mn;C@ł`땄IumZB+Й0)l#Y<JLgY
GFG}"[Tu:g̡8z0pL&_1Qs{	:+0>{;/AC`^јe zעѻw6;gZ@9/{ITU#ISW`´2r$<B]%(_8^7oԦfo	̣Ў|W!M99adşUr6W*Qm>V2J,%z?hX<...S(uzU'ES%	>пb;l[gh-ܡ2C<) D Zx)W؟> g)]!40-b6:WrBjyjm[CQdzIF~htz^0p	K/ƝwLwH2>g
ʜ@'z1&5Hq$TiPlCq*RyP蛧:LWPyg."7vXp䍾)}NPkd%4ΧᆽQ^ń@y9+`?t*O+]ʥ@K+`rW24Pz5;xu5y
+2 #?P
Eؼ" Di8ܩZ}y-"=8WH"d8H%Vp	B+ͮ36E,*eUKĶMK3'==4C7oaT3'<%/0~H{)<IE@SJ,O7KM"cV::qnu:N#@{/wqa_aE`w/{;*p{.o-\D~UO1M[ov½6\edn 'W;:1F?>|'[4Y%Qs;f&\H('ׁ^3Gv+f&[GNJB+d ʘ?LEٰ7wBbĲ<A{a󍤞䣈>ssG#ĉGb]YJ/vk+S7LE$Zxh_ٸ@QksVi>i$vLձ/#j+YL:=	iD=lx	2mt Ia"IL/Kςc#sc$q9k$	qL}i6EOʭ2PjcRnYt^E2JT
\Wy2ZDh!!Б\3`צI9&aтs2QAı4R+jlSq"K]dI?GsUv}׻/잗vfzCh5.t}"rǚ
IO~|۾=О6.K~?xd'[U2-;VVޙ3_y	ӽ+xL[F=R@0UBZՁ(kÄP%XIDw8M-|v;8Hju<1;V1ۤ+)`H{"T"Z٭L.ZQ37s`3Z/ZS'	K;S:CnR`!<E Șpfze>Ū<KS=ԑp1(F} IN$#I0L\(i(ե#\[:Z ڬպHy*yո@D}L`^+"L޵-Ε~s8FQx//hcqp?	D68-zfjV;ѱ'I"3*M^ I5/@A>2;W1KF?[>OyfL
e2.!D@So<HX}o	ju"%V`8;&D5gD>-kֈ 9>6JְceHlwN;'NFMEFSȢ;-y3~Q>=+ZITM]QRфԦnbҭ/ rA!R^p:{TD'<퉙H_:Tǁ+<"G U&Zũ6'mNW06$=BY몟GudIۡ6MJ
h@"LߊXyCgR3i6kVd3Ĕ\PPqR	'?Cづ4sp'cK]C3=e@j]T8LR6-C
lQm I82AtQMhw0v`@@4(:-[Y:ݛOq+h$xH/eHg>&r+ayoپUWՒ_^6KLY_,@oa݆ޔR r 