#!/bin/bash

declare -r e2c_version="0.2.26"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(د_b5T8zF԰LD+X"ه}س1ۇ>̗G$EUuUbw{yF2]]FŚngtMhڭ?gi;!rC7
ArD;ecGs0|pFZY[ﴚ'F{ywqQ_(,~wqQOA~yh`!ߠ}??_N[Fn;ꗆ8tc 1k..Nqwqi/~A5uk]翾b;"a/c&Ȁ]gn<nΈ4X2ǿ`A|ꆕر7r7=yq"7<sÈŧ^DiG1.;rGy1|v}( xBޮūǭQ0>9|g+ߴ51Ap2dJmOѱ;qs8 zSBro2g8X#pmeGg<fBpvD1ٱQQ7:w8vEدSzƛt׎55k6Wi7.{LGw8T3+wn}1TR>UxcHh{LG
:6&1Q+x
=p;21|$Fe2=H%GI{Kww ۯtÈqO&*sDwcYO@'hb0h!;8A~9>gf;wL&K,:!4O.P1QG/fʱWMV3's$JkڱZ6;rD<:Y*mmF>.٥"T$KEv+EŴӢbZPLݡst_&mM6٦"Td{^Ƞuanu07>_VjH"L85~WV&ZBA"FYǬ;ڶUvUcya`"`Ym>tt4blbz^f\$L0RȺh373$g Jљ1% Ƭ	Bw$zkjU? TkxɑKv/ۭí?.ir̷&\Pj9ɣQM'CnI۷n1e5?"q$Rer+Ց>H6OgD-jCmr}Xr@}t	`4z*pOʍσ>_AF9QlRUfw!F@:mϹi63gA;+e,r%uUk[ʿ|{XnZܰ6Óz_xڼRվ=kp-T[I9ti6)H+_~C'Lԅ9 M>"S8;KK oWA}@}Dѻe%@gEE	Ҥ2 `urxi'N|hm
%JIk IlܢF._~rK铜_l58 +	ZsSbbf|!8@XB>[`~(8snF s:טC=:Dͺz9)~C/(G= ñ,zq[s7vd/_FVC7vLb)gPEd_crƛ;kA A/R=ft	dށ_M3>PTI PZ] x*2)7ė#ɰ使:⪖te,yk׬}AZ"3S)@^EE}8ݏ1H7`%-GϸJI+!!͘8jx!DV8mF(|c擄KN%_y-$&)&-Ea?*`݂eVN9Ͼ/lgg;
WEͽW;?*d[Ei|sfhE-7/\R9t@@Bp.ˢdìJԼR𱟮)P6eDKfZLYSL@:*H{_y8 tRedPkB5C_S$9XJAE-G'ȷyC(d:Osb^*ݷN}Q.gnJ )t> ǌعlp'ЮfVD#/V`nZOe#wr3<:W$`ME>T/Q4W}"Ѣ%S%{c,gbl%ɗ-J
xXge褢0&;dwJ,'wBV9#` եdi/oU5ɾ{ϐ_m~s[gӒA7mdt<4|xfU:RPG
R5w;T4r|JYD,ELسy7J7vb&@K}/Wo,混>=9Iv0&,.G*/rd(Л^l^@giwnx7,--Ggw^mcϻy:\X6spђ B[uh(˜H-oْ#ix~bZIq<p\9w;.nV%Ws_@MVե#)HAW4-x䶱kxĈ[8ޱt#|(y3(yr]c1#J/$A7|3;[VN\3mᑽ?~ '*J}X2c|j*!&)@
]',^3-:tͪ*bR`z
X4L}O*%Et2P}'S*=y黃m7ŲZ{z-IDBz%sJsiwRz¨i+]⌨9<9]Q~p*żgxޫDJ>^^b'Y J+ȷ0Ɠخ$[pI4%M`QHzXX13sPkTjn4{CĥC! WqGΉ &̋nR@E!$ Q]r^8Kzrkb'FT)$ߔveS橏fNvNROϦ6gJNag{Hԩf `t*.1E@-<H'_ђq$&]W&w_Р(&y:D2:y%X8L;ŏ+Ki*@e'yZUR9ḳN}e"ih2PBt9JuÚYHwv4YMW@YaFIaj3ڄ0ԅ!^dX(V7H"ޕXoX*8쭠j.[Ԃxn~#|$mWOCE'$tL
2MUQsiEL*{uMS:FUV{4_Q䉢3̆:%`"@]zqxT([Ɛz\+t,ȋ(6h.;&k>=#7kΙ[Y=W/Np>5zy]vzk`2]w2=,
ee"hCSFrU=Ha6BH,'GH9ob#V-nJW`N}qGāe]JoWҢOf7Hpp:v̪_[@I3f
@)(E'Ef"e˱sçOγ+7@҈b|BqO*/DĨ1FLt(^7+eoٔMm]EȻ:x'91u3tP?Xy9t2pcOdlPCgؽ>c l.jfY=Ws4m&j,iy- lBXBcGƠl{7@Z~4hWN--r=NFʑ۞N8쓳n=_gqQ2L	=mnxzgg!QɍDoYd(P:nA*y"a)9Q
I[n-y =2V  N߁cF2,ax\ҕFU^+2Rmn3qr8RTS3^0ӱLι}ŧӣ),u#{1r!:SbW5x
$!Z,eNd cN} <̖$*:8Cd$v]|8ɲ3}YMS0_C֊;#ʒHb]O-9jATBr;LcQ5?0}Kۜ~ߴ`41DgT,5~H8Pnc,Ct>,JS'͎kTaxm䦆3g6qp2	ɬ,;c9YŠ)x[B!
At>/R;0e*G1@W M\qSf+c YYvJj+QGY~KRe-wYkojvOp-rKZ|qNuHYg%
FnODtB sgh|7`eѬۆ ai$ݐ]})@:7riC~)ܮi*#M9KjLEatD<eDVqO
%&7
Ćv	˘FhKx*Z,[B0aJ	$%WT}gZ687"^PP6Nˉ8s%S8^'t>k/P\:X/Ih45-.2%XˉB*QMO)AUu(CsٞR?:~	lЗ?@@\b**,_{~NNGf"vO'a>~и
ʞNlo:&})h=A-o$Q{8s^)^ NE&鴺^t7d@qiogNHѽNlߞ4u*+4po*uahE3̣l0QĬR4b22{E	rzHN3/I%ܻ̃@czGTg(<(q` M"IhBnjA'2zOPAr 
ˈEXv]z+]Ƿ˹Ә!Z!)'y#;~xgR#o=)&;+ΰ8qHՁQ\Аw4ʪ[2:hAQᓀH=N&Dx*{il<g*yB63]Gix91 HP`tĜl$6
?B!K(xk΂NaƜv2P#1&ITK$ޖSntH/G:2Kt),|}KF ] Ce Pމ2)=hˢhEk0Rsn"6ѰI|BYwhdƚ
JR@y	WV\!F3}_,GxVI1͗)NX}ǜ#d2 <F{y 7&rZ±889>{怃'IRlv?Omq~j[*em2vBjhA?w]NYH`b8Q5!"\\1:i5(O4r9=ܣ!bTk#6fimr-NZ`X
j=5*~#~E8Qi2(ŊΡUyӕ7yӖ7-yӔ77gYD!5
ů!oH!oH aZd%YAV/~JNgtL|v2v#[O֒䮓ܵVaIZIyV҆VR@fY$itWdM k&wqpGeɸpK ўcHdHʲD҄sZb%%dUoMÑ4Ћ^*3p5ZD{(G?=PW\iG4|M%b}V	}dIg9c,1mAB=숵w#E $y)bYhH%@ =K*PKAa*h
>6x7C`RlRK&\p)X!ef˫aze]Fc>Qz7xP"+!L&#I|#{/Ya@]"q}t-BUtKB<Țga,ʒ¨a_?m2L3w	~X2	So0
S|ދ["^!\܈psOt}Q}!T:þSUoH2|-ͬvɖ*R m	c"LBRb]H47!	eqz=]=1PĀr% SfӚ̽洖tܓUZ@2S,:H#uSkFFuOTiaI+T,݄B	Id47"0KH͐F6đFv	yӗE*{JFǗ#=5'FNf2zSOnwfҢG\O@ךHQW͍1WZ(U7_XHpZo<Kû-zO$xv݀V4;o{$h^D~qcSU/\7{b^maø+l"Mq{]8m\dJ/r?pAdޘ^Z"$u;ބ/n1U9,fKߋȥq0Eķn\t2⦛{mKXE]&іDM/|K+(g`&d8nԨ]-hCpnw}`үk nуn b8&A?:XPϣ6Wt$4LsP3LqDeD-MeFB۪"56YؓÎo)Qd'}seKer:"ל3p,"@s+ⲅNh"llfEGi8N:
Vz-?[wj\Χm4W!/ϚJM%9)%١d/01mΪLZf@S%`Us@p֚ߥ[~ W26X(Z(cfUV3@l5)M[%Y[[8,^k=p]q2;X̆@qЙUq-Ns*kYиlaYwjRm*9fӔt;˭ţaM\f/i6)Pfs*i.0oPM[9a`|sIBsZSQBjtQhY'_ PbYQ.P>Fq0ADIHUh.-̆j?}$ed]4=}9$RnٌUtګ'#rlG<8_|H[ZK1&jJ18E!~*,F8֬L9vil{rܶxճca_@^:gp 4cfrkkBsB5䂚2u耞bG.\얾+n잎q
9z0KEIf6$/&YVǤ9V]0IRd$N(b7ʟ3QAӞd10XtIBgg*upq$SᑅãϸF+c?8|f\?^aEA8{9QΠG21dݘ;:(4_%Qf̍ڻY]t˹(˖AXmzgg2< YC8bl,,YG2Trx L5Po~9C__-~<?{	CǏr:˞-ȳzPDLfӝ
.J6pwGA@B=ChPQ0'ZKz*{&zG{
wk9JQ4sG(7d;l|U}aM*x0<8y;t'-: d0\2\	LC2 D2F(*uQp*Zu?l]ڱ]Y$x$o褸~s;]})bb㲦Uvm%/02g390+ԑXVJ1Zò':-3"eMdoRD䘗niwx.~lm~-i=UC ,cfްrV7	35sA8 ]9dt>;Gv{-4;ye'UZAE7w
	#Aae*YZWE٤P?aeʭS-xt_ԔٿZV!יFP)If]F.wIs{ `{+vdXsx
7cM]c.|JzOHHP]D[ޗх?Rӆ.y$=/آNX[D~x#+cPRK9+"^jKVz_P)?2>Q@QM6]crʱD"D48iz$Ԍ.)gCqce,yk׬4`'%e~O9]L$ MUS%ۘtGuhwU-*W[2F[#x d3e"
?N̓n &LcfXs͂~j7tV3	fUjA"ْtu|6d8^#t!H5YPvѾ`(bZČG	:OVhr1'Yl-6Sn+8EG(*
<Q|Y~M

ųK
ZIujǌjQƈ9<k@ԃ%:MZI!GvY3]z^֭3ZS8Wfzے-qپ&Qc	m87ڥr*+.fgn u2w</n;Vq)PXzi-N&kf_^21E aJF72;(cñ	IIw!NY*jS0xMYd{-lfx)~^jlSdp?MGXpp\S{ƕRBg쒴)1L& N,P UG'f#׉04eyQZW088\9<Ez$0PVcޥE]୚}7IHţOڧx%Dog4;KْqȞ`vv@"=dn=ԃv3eܬAmT$5'\In<Ʒl'ME<ė,) 5A@sv>QDQ"8W
]'lԁ<[khYW3I^LrԭEP%+,(؄=h")DTRjc6@>mWM,&aI5't+QaϞ\f!sepBB9^)+ӎ#	{!؎UwboWni o Vr*#3+W4D>~brE&Z0(G:ZV3a!	NQ|qH~L*ݧ:lb{,ѱ#N6 ?:6|<Wd'Ʈ2]E'Eh&^wql41~3BER3 Hq'CZ<_6qjY1)++C 1]ļ+*G^8TRuKEe&GqcdqMO d$|`)	SU#TH:J)*.(_OLY1^2lzk:Eå0}^VeV K@%%u֥K.S_JO^mrmcήrHGԌEbe-88hilkSȤmfBZJ%gwpEM`-3 rs3})Ic1e\|k^=kvk w F0O_J[ĵ<>FhfV%4ϨhYy5˕Wy̯/KY0ϤhHkPjGDN.Oly*F9RUR[(k1mDrJpڄ|&_
>_Ĥ;*wL\VG1UrPls`r!s.g~.NVl䕧?J8oan1:V]̫<mxŻ⚍"yަ=fUqn`&2*L9]~b拊Ti9k/{i+sosaTt8Ü3Lۗ_)9+l\Wn/7wnú0ri.6[ֻIsb2.eҹ-F/BF^_IYLl^OV:$9#o8R# y~ 'dmNU3+,7=S&B&KA\:`4
΋f6m6Wn(4K&9h$lhf*.RJclw- E\+>ku>nZ^\ݍ'k[ }2QoX L!uK+&QF	Hh# OkW[4odu=_e(Wpl8VG" m9Ug6~)Q +krGtSy_ʜj*qhZ{DLn=3歓2LghF7Z*84K팉N0WO_(UkjԗWf8YdȖc2yvuB:%]}2Zfòo	#7_sl\;xVkrqpyS$re5">W^Q~X3?YN=ϛ3)jmxIʻ9}-8'c*3AʠFV"A/u8]^@bz>z_08^#@Qm8ԕSvmg$YťAyd939y04xVזoB{ua&Lgqqa<q]^7ܘfȴ{d>+XP֑kkQa+-O*%JƁD&Nܛ;S>蚖wc2"-`2ΤfsRmQ<z'y;yTys\'fO'CVZ*(ͦ*AK@F"y{'#c5;kb7x(G>T<<EI@R˦'[GҎBrN9'AG!_/G={/%4m|3zzBխ^QvGCNU
g Q<V)g~p̋:PtGVT3/DJԄM<DȘV=ߍl>2HP&`S?WDSn~u.ڢwi)TOsU=<*-Z:UP3#l5ZS7q瀠fO/fFUVn<?(>fFg26t2q8~Yg5O}boղBWRPR.K++kMfj}6|}e4kϼB5k"SgST`V*ڱܡHT!Ts-I&t&c*y}tCUN\%[3L)\:rDnppkDٛ!QSX̶|/1	7'̙O	2M#|΂HZq%{`<<BQ4foVTh3D9/^X2=ޜFT}0WWG/mrJ`k9o[MVup{BB7g9o'w-A/߾Ax(᳝7~dΖbC,ggYNw2[w`Fx܌*$%4;-d{	?q%͢`2sEќ"!%,c:E<OՕq6Y( Qo#[_]牲Fp! SQ_9AOt(Mվ[7(݊G+2qS|}KJ`QR^nwTiЫ* aXI
 \!+vv.0-_KKsdUpZ4c9MfqW殦mk3RW]Ҵk^z	_ݟ#)6p{~PMcxI,>"oU+$M5= #1rJpna$.m{.6/OB=0|A=baIa0DG )O/FΉ\Jp GjO#|f暦xF`Tܴ}_)8׮z-\;!v%`(Dsf*vtnNVs0S9M;ZJoiPBr8,+%K|#ֲ+"Ur :r h=ϵ-sp1!Rb_8飏̮w@ua7(JĈcw9pM7JRA5gd(%h	s8rVRi^<\f8^Ҽ!huWL:Z۹SкJh}+$|L^#2b4CnҴRýH_/|e͞wƫԴovkt* (rR6xBHTa&t~?Fokf}T~i-i c
>v#:˙Gv]F
JZyuT8:\j@mP8毯Ո1,VCmh5Īk5_P!Q*R'1bB+Zn=H8<=F'Xf[%֑4Tg҉VhW䂬ã~#$]|<ф![DA`Vҋc]8IR	j2e36䃙gߙ*hlR}"&:uҼk2itNA0tseVVɋ-qm`J~r' 7ʧQf|+{;="p)`i`P3J3Eu7=3Wf+y`2JqxUiYaz$Н-D+Nӑ㱋`9᫓0P 9oz J<0Н?aay'ȻQ5'UyEutHFo\cZ>~T.\,d)]ŃA*svF?{93FY(O92sW@FH<0fYxNXæznI1z_T?@9	O¹Ţ˞⧧o@=/zi`੸cGHJ(]	9%ő|TrdN-Hٶ#]ۓeK
 qdieJZ&v}n)/em^IS!;m択ƚ%3dlH,>v	Lg0p'x:8	Ofwn폶&(S6oD=y]?ysL39r_{Hq9y x48<}0ɕ$<'JhcvE;J~ŧ#<^/(,8ϓ85B]r~1chW2´-1E7!q$f9]u(ޜFq@uĢ)7OMgPL4?J#jDމ<u4×LZo}W|rF!r쨟G&=pQ{Wr6ȱOWeynm3&Ϯh,,Jո6;r!ڌB ďCBіf"sSM5H{_I?;'Vc}fh]Umģ@_i(r6pA:1q[9 V3<>C7ዄvmׅE_mIkM<%+{g˃.YW@Qa^X)E4EiOϪ'[k@Xr>-$4,D,vA ̂i]:qho&CrDQMɨ|BdGe63|~ySߒN$hQ$5xĉ>zjSz eO4491I\<Q	eX0!ɯ01QG6=5[ d\4ɽE To!:a\O/DTo
g5#Cg%=5Pׄ4z[|cCiif/\%ZbKE)^mk~h];֗<eEn(P,C1w06DYJD53JJ@/+Az
D>P0@ƞFu/,
2l]k4`?'͢`jKckcQSNjBbgj,L_V$1l`]^2ˑ>tW{O5RG\-mm<(ɔD$fЄ}꼉k5Fj	4裤]x_ JEk.'g{'<y]u|A.#5Ġ,/HVffk=].PAyXQA B[W廝\wR 朵*j&p,XZᶈt5s,D2r#Va09$t+%1v+L=qpfgج/ʛ/9XMH$wn0.[tg l*Qk	Ϣ_?.~掲u@9xMP:存^*|:Rܶh9KcUr3N0~ܷ̄hKtgC;d:ngd2@-/7ĳ5n}q?!K4;$3OdY:FH/ٍ_>axH< yAk/I5z1EICXj"BIQgovceʳw
ȒΚAP5),$|%x2y:UZ=hC;)mvӐN8qՃS_,"/B7}P5R³Գ^}"#ԫbYNyl<UHJDC[ dj62ȓ6{<DX`r羟AUCš nŠfj?̾h娅#ӂWXvobvuXm7`%Mq>d%v$K?:K
>꘷WNo5.\ojS-H?6ZX (}Wl0ܡA]Sv</!-fYL,ԡ"
<Gt˰"Dtŉ@|5TG
ח~Љ:.Wn i2G#$F3xOenfu|^%rS	;ZX-jj*s$Ĥ*u&@ʤhL9vBB/ f/fZbRI@ﺡ`OaYWPqDeU5W_R	o`Ϩ/hX0n˓iW%'~ϠE-CjA ]:=EdJ<;Qp	K@D	n`3gP,gV/.nMR\k}||Y^,NC/+_/c|M:S뽭onnEd)'
@JkwgWg9&A02fkP1r>i6 .RrC'>Ïdi s'cp7Gx;u̘m)wAhY^Iea1`La߉nOh/Q/uK4A#5)r@{I")ߞI/"p321nTđC	\ѫK{j($XؤI3dIE&I]G}>P}<JQnv՗HOv0Nq6hdMvq^P+yMRP:u ^e܉i|<8=z
]/6h2SVѺwq}nR{LLN"$W!.t0HS-cKk0-1}5tG(n	9wb`FE+&Y>I7sL1v:8xk?k^myzcDJ3a?\eܭ@tH(÷p2jš+5ooM4r_Àf!H:=s3)@&R9x3f'3lk]вy|AKov7~Y&83ϛVc.v搓'b6O+`1<`0^yCv۝nf{-I~Tdg/!۽}Cg?C!8~DLߞn6TWcxřz4}ws_=|f$yzkv۽W[??K^yϯ_m'+'`)^YnRׯӤ}_v_e_T\_v޼|a(vE_izO˿MsGA=ynn)yv6}o6촛v#-[yek|zow޼s_OD)i|A#J{ߝ\e	i9%L!o%K,'cLɃLx9ו=מ%U٬0Ga%u3LQw)LT~Q~ړ5߂nZ^k_5<:s=GM~FMC`P(gmn?&H_-:g.qȦ ݽ<͏z_G}1TG#,ԙ0<(dmy癳:8B݇;϶^zCcd~~-	N9Pj@˨;Auo6܈#CY{"lՏ^HjyG<ʨ-FeNH
iݳ`vx"D#Ų=⩢9n;#a
kk' Doνn
K<@,i-	63[33+9~ukltYOp⚓Ekll]P5u*jGY#n`"jGb~L:GG^<S,ߵZVﶻ.2/~A]5:CM.5bE!6{V\|m]]k#'a>)NZ^y4-r5;?J_zmC-1[k/?>+=/~Ǚ{y2oȦC0u'3:Jkÿ+(B;m|ʿ!.~SLfZS4wr=y֛vA?W]o\g֓;ro<֫S#i$IQ2"W<*I 0>]<-zxț3"`8nY4tAQ\;|})<4*;'P2nR賱IPG6xuY]8hoiI5W']i`=q3
Sjo-el<N1;?c_qsxTf5=uNNcyS=7qa2*	<8=n~{udyzF6&^fH*Fc61	F'0{QVu2 c(x:]x*z8ZE4n#-Z%Y{czsVo̿=n-:Y%t\SVBښQ*Nnt*oڌs$d)CbK4v|f?7:EWjkElA	$
h6G
-ltLA 2pWǥN;S2Z1qesH)csoCYp։3H=ւOeŞ6Y4vF#s?hm⠻; 퍀bT"lL	4A[ߝ]#cac'3,34LpFn[P?Zw#ZCrOD-HJNSA8 	p5O7(gOqs*	b:O%exgZGA:Co
=Z|g'3||dvCV%"}q مRXR=u0[sB,kz(40AF&#qtˤ1U3k#"LCw`LhHI]O|ySyr(xTo84tկ
/_TaҮ
1V<xcnB˝էON4\žҽE{pI*՗lYikVgc^k:]NU3ܰ[H4,ת Fy`Bɲ-EV/ښb(*Ujd/9Ji*l~& hh۝Fg؝tֺf^mu\cuЮՎ|jBن75{*[]\[ݖYj퍶ƚڰWVp,Z LMK<6l
d[ t}|6֨oa ZAnmn퍁^X购Vްj
rֱ9gfpy`Uh@
dkxCنnmJFڂ^^v6-@zүNO	 >w,hhwm	lzqkutVFlPv6g]*-^]k@MHҴQZletƺ|ju"xnb{C S)-{s`BukxmdVBZvO4lhɧf+*@#Z7@y1Fn۫PɆͶ-Y__O5]U7@n7Z jWXw6X[$v:i*|ݯnp?`
/;iS?'G'$?OPjJP<āBӔ;րWenOZ#Š:GF4+.
ߟ'_g3/<_ޫ~Z5F%^`@kAh
FS}M>q'	Wjz8^ 2^ \|χ=*iMF
&BRH{RJ3]@K#G{ϥc.mo[vk;z@D
#X0+Ḓ*LvkxZZƠ%)L5StT,5jW˵\ޓQpy
!˭ߔ<É7(a(ug~>.6c_wINM{qNyB?)M0;0OίG}?+ycVSG<ϑS{>>ڢ*粰fxKsW:H%֙0vDC|6aY3qԐ"ch I?&U^G#ם0X%QռM+wW'Ke.Z}U/?wiH?a?1J7QBUQ#O1"wfIĜ̸ԼZW'!hiƣfN?B1xwﯪw;HHspUo)囡TM%$#"/+]{&1LX$}n'lxleI7q6ZbC	~?_m޿xU&Zꡚ2Iȱ8Q:|!hiKe!h%YYqߦ(_ӜJjU)#ƹe#RS{ZR#jb4j$Φ Wj,0ǣOPa]`Z´<)b`$
gM2pb%Oda.tr43⯄Y!26)$' mFnQP4U65G?8H,đd#MW{گ7t*sX%0Yih(X
5hs<P|8ްd~UKE̆ZS] ASiD*y-:hJ8 qORE)
YNVYH<XP}E-/ug:15=_)ߠ!(sLA"⎾E$;羫.}W3,1:-l8flWjj2=DRSk&2!N6/E^i`'TVz%9	F\OBG4.h(2%HOU1s/m~N2U/K=ibO`ŭPTPĥ;jȄOdP P<,*ddP-*b}`uPhsDpGjJ6>Vv4ENO) Dс,T5|4	3"j H팚
)> {m71oJcC`UWj/ Ftbe)і>%NL+YI:缔2B/OcU/%,'(Sg5T	)kjrHS%_E>;0t.20@6@W}3n)	#KK*ƘiHAFo㗩ҡ,^pgh9fSw>Z?y>ñNy#}YE/ƪIb+@es L<8\0B!CX#y7y$#ot]*v?Y4"}Wʎ !^]eO助&K"!99!k ҄E|>uSkd(dɷ <Eה4&xm10܉hΔS%$9ͤZ&M@3JȾ6@URǍQEPG6t,&x;6Nsx#ga\8r9}I,Atvزy:;q͝Mb9Y2rR3 Q3k{[oo^~Ŭ8)	ـkEsXhW;
.06 p#
pA5-Q)jT@i4 +%>gr+ Ya?b Yd4s>(bFΉi4(CPC.l3N3!(لb
X%=YXШ~wWjUQSQ/."e%1}%tzRBfNTX'/ub/S\|Āo`+U͜4h=Ix<15q1w@>]	`qfma2E㮴G<SYaUF>p_&O>숟>hī}'"ڇG<gsp4ry+fx^jr
	RG2;QR=@D3KQ".̃1&360pzŬIq̄,/XÐx4JOtz,;r08q8dCx9mnɯ0r@+p
p0ސq0{9Kfxj:)M{ >3<sbWf^ަdk)ԉ!*V+q$MvUUJ&|@L<:)ɰH:1pY:+͠yD'ǃpwH9p ^6>ÀNaF*TX\K$|3wOw|kpTtPyYr$ |C7	!W?!y~w诬ZOwԷ^lӬX͖'>pTɎ1wevn7n*:~BQ<f:-uW>`t5^FV_ƛᤉn>DP=͒`4At=hc7ZH.Iܬl!1ra&F=L]%P<[NrQ,g8B!;CVȉf1;
'bpBeqDЋ8bFыXGU4㧙xVr-BAy"ECoB V
ܢAx-جK#7LyyEL>xNfpA =g$r^ksd=8g[APE8K$$'K?D~neLejASN~
l{߂5Lu	^a "X52ts9%E	&ġ3aJ;?IcD	o+q0*vnȯ3\kIUΡP¸QQX
z!~3K}ntheuoŸcv9qfk[z}VIT+O t.);uP)w겑C$U	loKMIE9:C@G@jSpmRQ/hjZ	Z6&z2M9CDA+˕zmjG\ȟ?m?F64 xXhs?h(<{5Uͥ*=ۆX.2<'JYxa$wcR%f` =p͸[>;Sw4996ĕ,0pLې/G蔥F
vPc52:o=0atI?Ƕ>PD2MtU
6;	oV~)O|T9'Ma~7V_Tmj]x?ѴI୊mB䂀ʸHĻ]V++ )F(-|F${ݨd)9\5rDCC$Ds:QJxR
f&qJp)IN7tg75CX
`=WW@?]21|;Lug&|L|-RF6~QL;siQ	}Y8|Av\`8o+x̚%yUbP)e24g4@ؼ?HNxB'aFZguyV2f8ѦeMv4X[{Ȳoܟ-/fnzܟ,rR:<ts*JP7Y'<N'w-tM3>{FJ*(h1ÏvCsaxp6M̢=Ν:U%Lik ٖL<3{֌䣈bwG#ıcGrB2sIaYoHuNMJG2qH@/Jl%ZD ;ڜUn`E9AN@`|ƐK=R2]',bL䘼LiZvܿ!>&򨶷%36`(Bp4y"JoJ:n51Jm:dZݢ6Ǭ6dj:F tC)MLupR%D!wtQ&~nJKqEa"5AR`1«?wqe_9jM=[sݺv'׻}E#/X$u`O~|ᙛTLI̣I_*?Ƈikr!;sא0U&*[E"C~O;o4Wv+fCVǌ]5;.w'an] >sQB"x\|TO^

O-w1L}{pUB\w(xY(ZbP+CXe4ys
'=jiJZ&HOJQH @0 v9pd+Gk6\w""cL`oz-}x_+Ο
*w_ap79OZW<w}sFo}/FB>Z+9-Ec8)?4Cם+xR_@'>RJf'[J8C&T YkƞSH̽oY2^Ԏ{2J 	ص
mOxl(JtO<*@Wj<%3)hP|Rk/J=Qnd2??{X=4@j'Kĳ1%; SOTd[&E|BAN`@A<KzO?`l >{7_oWE}d/;=w1$qWr/vWxd5$k=}EM` V ɷ oC{,FBk@7i{Տ0y(@( naCmnؑh15tQ2#.>tRʢmUb C"zH=#9ۀhA >^pcI2wД@i1Z @X^Wi?N8 Y
OԸ9$Ѥ$>gH2]q_@-1KZn5K*Xs*315v&FHJ94@AGnrKw{! P 