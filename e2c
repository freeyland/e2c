#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 4] rH(8˯JLI@ޓREQU֭IgjDM	heY Ky:{v=f؇]u " 2nJL\n?|ޫ^u:~]7W\tڝNwZkNtюwrQ440gHj]\`?	; F?WSwrQ_}E?
g 6| ?<4ps/7~: v 7RzN|V/qއ%\cou]\|Gc'kN.ů=.z͚nk{.)J?fXuƃZFH!sħn{#1;qOG,r37qY|Ey~c#wWgׇB`	.T%?xKq{LGN2%k_X 8e2=wu_6f%c@fDgo3t6d>8uOFP?$Qx`vFTh#$
(Y\Mkxtuiv]k;QśaػiO*FKK4%gSK9z^CB ~OϘg*?Vn0!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAWDE.$Π8J
+_sWFp~㿹tP{??+9rӥ%~e˟'a^14QӐrYjk|jp7-vn0g!Nh /Gw0(ұ4t4[!CΜ>NHJnVXm7*ljwD7\'hy:kK;M[I^abϼ $,CEvAPŊlR1M*I4&kwy-jl kd-*EEٚ2|@X]۩v(̍0>j}I$bi/|X,wȀ~ŬcVYVRm*@Z
cya`"`Ym6tjt4bͧh`z^f\$L0RȺhΰHn-yO/dQH䜹lg;LkOKRYl
ܑV	q0\Kܘ]Нin_aO3iUn+ͷ&Tj9ɣQM'CHq1{z;{;/w^=uu5o^<8xQ!ǝ;	m̡{Jow̚V+?)NDL1?w`bl),˲`ȁUX$EQh"A#+ĕ7p{bɤ'p*rU؉{O<-?2}sdf˾WWp(C.60*9sF>_7g@/{ux iWX0>
_W(W5i2T귛-_{x^Z﫟ꏻ+%QCWՕC7>M.A/IYDy~	C"*>ua;ѩwOfp2oW+PG*2Qx]tZT }j;84Wmpԟ8iY
u%W5>d3waYZf'0w1|OpIN;/vwܬo68 )Ç	.6i:A0q{gk^
'5VO<bbY#:98Pj>II˭WW[/wz_P*{9T[!IsIoӈ&p|2O~0+j,F$KeU&yӥ1z|'wW|	 V%>LЋTY4nqЯa8PJ2
P]]YURLব Iea|WlucXʾfuV&J |/}ǘU@jқK_S
|i\΂YSfL`5"8mFT IaEKї[?Zu0Sd}MZ+\xUd/2tBy}av}?=wEE<ݟUΨ?oqV!;*((J3E:*jSI1n)zF^y<`kpiRr^LNMV6h=X1g'vQ| 0oI!@dMhF1܂qt|X7Ҁ9On4W !?&=`1PYFƨT@'p̈D zdx*̭*ժq[֩;,'Vã>ZJ26x8^$c\NEsaP~U5`sEL,YX-E)sY	,Mlnt.jr|}A6UhNK[r2g;{iMfk^=Cyup%wH7L>2?QJGA/)IK1fQ!wT4F/s*,,\"
wS.{^` ,k]+	R;՛,/K୏L!'kbJ|TBQ*#ǁN>Ȭy֫ztOov֋p*rJT{|;aׇ>+%k,̰IWLުcLCyXDmcȖ\KóPݓ#VBMلRȹ{T4tqS¬fV[6Z%40XԿiZ]:ݑWtU!LQv|40@ng@{@WcdD_%ڐl%Jާ\P̈dIMТ!_+$ΖhsEvqxd/Z=_zjɯvD1v>)=JH	e )D2C׉%Z]J-T#B͚/So! n`.3SBHjF ?8LNXkeYHHO֤bVi$-|ZݴMaiR㴕XEF`Ĝ ^R~p*żgxޫEJ>^^b7Y)J+ȷ0Ɠ^Jl/iSK* b1f@9Ams~EPVvIdjTָuqVsa~ũʊr	IiT-*Ә
XQ&0ehFy)cfq9Si	aYIE]bPq0*[Nޒ[`I7m 
!).$.a$oT	SN^f^-,_
_
_
^؝LGFq4hUiCRK5yazo"meTunhfO*hiEG_HhZ@+CA؜nR3nܮ5+)
H5;(I#LmCċ1\̮dϠygsd[/m2cIvIیSK¾s1-J<f:SFA/כ\X
~&Nu~XP8Qy.w]=TK$,VJYa$p"]^ra4JTa\jEF+a0lhQ|dof0]ׅ;-{Wy溙x1ЍIdp;p ʱ6?#@ITa^cERS9}|Osalt経-Ѭ+},kg)=4ddZ=Tik	(+XR\&ϟd9em2!)Ɠ"|6	,6bbVt~'iNXv%-Z]$ﯪz{HoN`5<RX39y'{ÛW }DWW1D'$"rrTWZZj0Qs%fT3ۻ>-6HTdqzI^j;VTbժ@er:_8ñd2Zp!ˋ-Liؖ>cpͶ|h"M+YҾv[$Ai9ƎA	nhѮb=4;MҸt}gxq8uB㳿ۃ^;QF2ʭ3 )Q'D)U4;F#rVFgxTd9񩶠NlDrE9>$$ :mhCk&;`Ώc*
Ҏ~{yZ-=4hdRDAʊ']fJIj{i1Y)c悴*6&,Yf~	f(w`)v3Q."hB(]u lq+R.9љ
I[~- M2V > V&aChrB޷JWu v"%[-cmN]n6L;s&C6sn7=̄sh-݆@Y@2Q
 
Ndژ@bN}(0K)UH=up:JsI1egTK'n:`_C:֊;+vFt%s/݌.wчPũI,!kiӓ1҈Q1V82}š̳`4+'Rƙ;4FJIQnS6`ݡ^:@|JS',k&),-[Bnw3Ɂ\qފ6HR̝=BJnNd32"[/FBLvuvx}~^c$)&tILc4^ 6*0CWKnR&#,%Y
,jvJpϵeC֭Yu{T*Z1$xFw&_VRT3)ݵ҆_9s:`KdVTOЈz2T RR>2PHRnVX]xs66-t	KR;Y<WNgG.<r5aҊ86G9I&i/T=OS_OKcsڢwʷYxmKG8i|l;o48Ǟh??E%-sMs~	3 9VzByK&L)q
*q\#73ڑ2ǹQ.G,/HN<p5h!ϕȔx͖0p B!!_b.$ip))ijA"jD]B	UDDB&D	5aS%@'ϝ'_3 h֚nS(Kя_{~NNGߜN=´,qC>#L-73i&n6"2jc/ǣyN+>_kTdܰH#!<{OO~[;sB/zG߮d^$iISӫʯ3ް{R6$CCL&p"h!C&8(KuF[39H$$I
o~|O7DD8G;$}T4Ee=6ɡ&)Qэ%y:áBY%M-P@rޔ\(5?'Jދ~`dK/<a_<q4f'#*G:5JIވ-TU-)IA$ +5cʤ)Um+c58J雐HE]x!	pDW%WYwÏ <d	EcoYhӚOoi'YcRдMAb=/sdN­B楇s;R[`=ra8ŰkxEEx@柄PHTw>> FLRR!5/Fj	+(X~7
ȃp=TP~;
.I6	4L#ED #e($v's!PܲOM#˃ u4	|I~TDכNg73횴A%4L*ݼlORE츤Lφ!prIB|_)S`N5% X 	Jv@OtOOS&IO-fbFQ̨5Ѩ(V6K4(~H0bu
#VѰW4qAZ"̕!²7x@,6KΒd,>+	%JAXtӕ7yӖ7-yӔ7yc.~C|Jd
Y )_JK.K.붬EV"UdI)V: nszFrGFqܭ'wk]7k'wYX~ fR^3),*$i%'I$</$Y=]~<#Oȴ,DnWYb`:ڳ$;ZNdHʲhmĹLRJ*)p5GZ>sB+LSʗQZQcs#uE@^9nQ^mž˨Se&L6f_gY)n$5&#f"fۙ^}Gun)e!D^ WY2eX'S!F1T<z7W=Z. +pIdWpK4ߢhwKYO.{6[^+,2aI.D2Aus$aYhoIuYA.X{ei^[竬V>,,vD{3YP/4sixw`^a!}<TaBwJ[^{qK+Ēܛvɖ/J/PgwJ6W[\fE=RR`rHGKHWԵ[J+R&$,N/kԽ'0]TlZt7ל2{JHB0̑EV iaoBz2|-(	*- 2GD!Yބ$2ܛkENyOTia9QfHC:đ(	yӗE*{JF,#=~5'FNf2zSOnwfҢGO@ךҐ÷QW͍1WZ(U7cXHp!o<Kû-zO$xv<.ހV;o{$h^D^qcSU/\>{badmaø+%ȳgW=,jr9F` DnDF䡴H|3%87oCgVja5[8qaX:^DN)0&.=?vCxbTd^)M7Z	d6.ݏ1%[u7mGo(e$*˫D|ALvɜl9dq0
pu^Z҆tyMutJtԚwELb^>uGl̯UITMi8)RL0Lqy^{:eYj>IL'io	N:ʀUyCfG]>-trZg%h*i~vY!ˢ(!d.R~БMȊus0xЉ"?K~ۊI]j?hQvjc
D8a&k׵N4_x$j3i#Daf"ѫ,PDe۝`reR)۩#W"(*ZX2>(뵼 7r)(I?ŌhS̷uC#ΒU+֢a4cޘU4΀|JTnG@pn7v,G_[PHʹ.g,$f;y.f7Y7,\
Y=anazZ!uiM̏7_O.Ţ8ՔD鼌7a+lqr$)	9O)/({)cݰ:M9cNǽ^f<NCaڇ?'zaƩۀ5sLZCQyN_y"hFqkokTǖUBZȇ( LvFcԴT-QoP(QRٹ faCmYFW0P`ςs_NC;[Cё
ެ&#:oGHtQ|H!f> YR	9H0گ_ӨZ*Uk9S;}k8Z:me+qͣI@eùd 10p9!erTOxIs:tb?#z.E$$nꮑq
91yKEIfEoB=ԳHeܰX,T1+Y@Lf-廉[{)n͙WD1H5cH̢B^"4G~jdB~AԴѣiI܇#	؛1JEzENGEp)d{^ml}sU5\ow
sL(:a.כz̜% :8([X3f03+{$;jQ8+^s9w e2@@Xgadh쌍E9O@J^wJ{{;2gkׯ
j Y{z뾼~mΏ5h=zǡG}74}tTwYoeyVn1}.n]܆hѼ}8H6^4xSw4
A^a8PD#?\OzgʤE"ɄCx.Qゑܑw"g
Ӑ7Cwآ30rK%(C5p`` Hw`q0\0]ЪНM(0u^G%[`{;1/rlwyd7b#-|QљMȅ.vԿypWJ1ZÂMĸEE/FC)7[!4p*s@Gz$t@{{6{ն7 ثg7a0uav:ixܑ3yHO<Mrz^MQ^%*PXNh!-6S	U )cf5HVaQ6)_O~~rTz[dzMղ
$P^0b JC-$B߀sKݓ `{vdXU}f>ƹ]F@Ѱ1=z%1=d%ߍȘJ?r~wr@^Ih#Qʘ8γܔު6wt+S=bPjO{˟`\%1Y&Ssqjܝ@8yB'm-lK!ɽS$#<*[]#֨YiΪA2-)k'=ЭʹLg
Y«*Ƥ3=Q`$ӪJU˅-]]^o<MEiPwyILF	ӘYXT%ZM3ҩV;vgDP0Ht,]߀e8) )5]RaMGԦ)ipv|j&FA10i2ΓU\x	E;۪j˴ۄ8N1FG*k$+
Od__qB2,n5+&u[3͚m娀E<k@]:Ȑvyd9ӥ9-eݘ95UCP4ՅqG-٬n|06ܜ`цc-T.\%_lM\'-=Cq}*+ogp<]i/d9lCf>"<H~xjX2ƾ5,@iBRG.D)T}Jq^w/Q:klxTo>e,Fvrg"y%gqiL._3Zy=bϸBJ(3C<c]6EP=Ycښ¸
l:Fr ,/JÈc
˕S_^A
#J	">?SSǼK)1[5$F~")?Uk|gG/0td.,%BSƥ){MکzڅRh/ٓ54Sf{=SA"Vrb&qWϨcO:vi6e˸WÌ,jYdNY	]yt'c!yI{ҵן& ekؖ\ Z@:bOZZgyEP-*Ya@D	J!⤢R6 "i
e1Kg=[	
~*z7q,9ʹP]HYv$ԇ$vulacfz*K	`%E2|pKC7*&{z~\dn®c30Xr49c:(j0tiY\Ǥ}cG&?|xsuLv(j9UwnIӒXpDĲ<i@cg8]]f gŷb_6QY1)+<9?"PeQ{xM%e|'mq^i"q,HVWӷ#='UWA"[ы8.I"Uۊ"ǡ{4=]x)8̥4/Sw)yX1D\&1Ŝnْ2Ĳf,U+[J-8uhi4lk\RIC05CLN&2>4oڏWęJS7oL*cxt͚{8tqxe󝔥,ӃBiǴgatdr~H\غB;N	
1y*RNU(R[盾(kQ2pDrJJ(%Ҡg1-TSޗWc*h`yۑ8@\:ضRM+O^Kf߸ݒy12WV.Bzf<OuNnfrr̀Yu17n\RSnNi!c&DM'3|-z/qF~.7>[㦞IM{.Xg)}	w"#>g堛MjT[{΍zXF=7-ņyz77`nXUyۥL:97nDCGS}E. (f[	շC3<+ljҢ3;**VvDҒ$EXMpp䠭,g <]xHge.ND[|Vݴ;Tr]wai=di.ް@%͋!/Z˫&QFoY(FB9Gf<-l8!ծfs+MU_j%##dT3?,&S\9zO2de7m4KE=Sj&O֐K$'(ZdKn36epcWaj#@(WsO\uVvgP%I'%K#l,L&N&%UfDٙ(+µNf<;pBU H_[˟>DRUsI(@ydVb2}vuF:%݉}2Zaò6&o	#~W".!񿕪D2N8cTaT}-$ V='k]eF7wE"NMV	f;ЃY7;*ZS
ZoBbTԵ
BzߐJOyʧOt@\%kAo5rh]1.OW{U\;Mְt>hpW%2,o/n،6<m`8LHaonR-̴cB0ς]:Ll.*.7% tzAtUK38S	QۡӢAZe_3MMJm$~g}{}d};$89mZ$፜S%9 D#F;kʞ7\(EN7Uw *^}jSNʢ)_m/J+X&1U-oiDs8#Y4٫y.x=EFqL9X>u<6szʁ0b<g	z%O3.`1VQOw7^r|(+@A|f\rxg	Ǽj͌Ƌɍ}SOaW
"MoG9\0gV$6hvE67HA ݼz>~G>;VK
j&cT{E9Ap9 (3S@@]3yQՅO&{R@՗s|bĴ`rN&nGr1k VMV]:!zb~ 5EQ5*=у`ZN8d?۝7-U}'YSUqL=Ğ.UXU}yN)r-äx.n*.F٧CzsBr$(-Ed7My,T^#r[F]#2n`{3L}pθRh5.f&x&&BR/t6%n!eJMY웵rKy4fKhqĞ/cj΅	t#xkM
i7Wsy,o(nnv,55Z­Bsb.hP|{Pݽ{?[Y6gKRW䳳,';``VY#<=q`Ny =U[B>|3ᘛ3L!\4e&L_{4fxǬȕ81#,˜&r?qW{eq4l
>jEpquU'lrLY0G=R?ѩ4!Wo5ޠt+C֪ʜ8sy-+ GIy)V
$I!Bb+RW=]a)Ͻ&ɊD	g"hr4%>]M[f8&/;iWuL?qޱG>ilrWc:j*6seW<GMt))Sf>Ց=f\F!lᡣ?>*z.ab~lpGDG dA/FΉ\Jps!GjO#r@p暦x?HaT4}_z8UÒq1w؆ەߝ<؟bBҹ9YxL<7wk+ZA
]1i](N鵗T ,<?l]	Ymd{M}dvMUܰsFS"$Cρ{hJ͍U2E<T&˅=AHM&ٗՖ:L⩶w"aݜFCX/:g
-JUJEsk.&G%_$	c2xpEZ;/(m5^%hfS9fThnZ70VGJ_x(#Q1uN)N[nڍT,g
t5t!	(:(Ih9q@RB~48r[DݚVCm☿V#ZAʷ/P|ADH%z<SaPSMgѹ$8Zћ(u b<N,䂬ã^=$]|<ņ1`DA`Vҋc]DL;Z	j2e36䃙gמ*hlRɝN4oZo1=k]S.e\erǕUbi/BKf\g	7ȍmiJ;NH%\HA
XFg';%ӌ}鰲C
lUz])nJ}$"-}Pʞ,<XYcb:r7y0$!yNu5=FDTFs}t1<,5&{7j<$Z+oNoHୖkLϡ57>ʅtr:Ò"x0XeN^ >c 1LG]F׈{?`:']f,τbT	fiПZ>- q+8=Bjv-@"in?%x*.nXőR<zz \
ВD>D^F92IA Flۑ/s`r8k:pb%kW[KYC[hTN=&n#w >ƨtR	ObS1l磭	
Ň3`}OF??SLįx/ Ǽ@>xa}x<$#u|+>6O2Rc/cvE;ܳNvŧ#<X_+(,85B]r~1chW2´-A7!qzz+u(ޚFq@u)7OIGgP4?J#jDIFbTbIXc滋O(#ǎz<~'Ha5+5@@m|.Vڷm;1y[daQ=oZ|9o3	jL;;x~ Ic=Fdz:1QŜ'4ϟjAjj/#< %NQ/e9ټ*1CSj#eJC_̩b5aJ_$k3..2ZlJ7);CO\w\j*$ 
kJ,y.J߇D&x|V5z{}>[sl a f!LJy=gLN7	4!Da6='`	!1Uj{; 4#omo-#IP#vIVkq݉E=t@V˞krc>vx:[ovʰ`C*_acLlo{7j%&hl{@IBt?to/_*˩8kGJ<jif%ɳ އ~^JR7ڪ+bѺwN/y$ʊPr_,CAD!tCDYJ!53JJ"/+Az
#>P0@ƞƗ/,
2l]k4`?'QKkcqSNjgj,L_>$f1l`]^2ˑvW{O;URG\mm<(ɔD$fЄ}꼉6Fj	4裤]x[ 2Ӓ\xOPכ<y]Fs}A.#5Ġ,/HVfFs=].UAyXQA B[W\wR(
j&p,X^嶈tUs,D2qFag{`I,4|WONcȍ]Wz[#x'YW/6_T7_%6r	iH w`7tK nwcOȧ_ӝ	HG%_?~_XjdVCt|;\|S;nY{
-6A]$bzYӑⶥEKb^V1vx5g	oіΆvt>_]B4;hLܞܠ z6Ev,OfpYQdYF9/ٍ_>a'[<$t`Z!,5Qssvceʳh%;Q5e]K9(kS=2Y-,K
dpt&zІvRڼ/;1.Q~'.W"<zX;uQ|][c\<PYHOJ +(1c6Bj,<jQOZ*Q{$G%!- bi5X`I=q^",0932lACš nŠfJ~-޵_G^_tv[oX4[NaFֹ}PW q~CA:Hv|\RhG;*[cok5ZR"etڝVq? _.G.&~񏟻uf~k\z}~iu0Ћ,.);uyD'0ǥqX,ڡ"[m<Gt˰"Dtŉ TG:zF1^c$Ჩ]^:cw%8G.kv6̯S7<". 8A՚ _;	|hs9)(r_=fi]Rwmc"}
\)`w([`KLbFJHmԒZVK衬F%p'2Z;SיX=i4_.djZ?6ɡ3h7vtΐխ	$=KR|:'LᜧPrg4
ݡ5ـ7e`t7Lӥsǋ[\_//v^.}p/fvK^1-E*Hﷶ͒RN:]`)Ͼ_EȘÒ4@&yEuOgȉN܏Ïdi s'p7G򿲅{;u̘ݖ; 4qpvsI}m惡ɀY0I2{'~Bt66SP2(9T(#Z7/MNMflAUj8rc(76kߪ4+whI)=$746isL&/?t~ѱI,f{CQ"o`*0T}MCel $AMݖo=#*o}~SZ?.j%#I
J9Zn`٫;4-'W  >ZstW?7fT#٬7]\bkkUZv$#o>9 T\-}\|~%7 M`aJX &\i髡;rO>FthOQi9p, h 3^7;]6ɊIhf_6Znq;;ǿ6臸,:s:oZ17t{1r!Q=}̯~}ϛVn]2x	kp!C#q0<Jn|<ߥZq^yzw|B+ܗ0vNGh릹S8QjwJL%HZhcMk:t~1Fe!La;/vwܴ'8C՛f}.~(b:O%+1@`]y#v[k.[vnۺwqROXͥ%bKHvE=?43}{O;P_ =NƎ7g٣"V3lgcJxbP@rΫzo%/v_W;=ƪ=5˟~)-iA>MԗzAO^I%_ywC/zJSMZmdɫ7?M%ֳ{vγ^Ǯe۴lmzO_m}?_D4~<~f~_Ј`&o4R_}^w'W?d4ߜ&ӷL%S&ʃA&<M`E%U٬0Ga%uy癢R+v00'k&+lrZ Yowr39~>ZǓnZ[BN(\Pm<cJP98eSI^<1#<
ۚ<TIɚ[y9{VIp򼟩s3}~=n
X0͢axXg_$;@]M6-\݉Ԓ,/()ٖd-7)NxPlّw,F3g1,sGV/MNkMa%-[OK*A3d_zJfMYFY7ƽwKp,i-	6I7m33+9~ukhwbS F~N9qﭤ\~$A&3ٖv=ӻnDaGVT6ё0w;=ˮ_P!rͫPKXJmMe?v|H\-7:ݵ<q2瓙2!eʼ>WERi;{wr%/~[͵ns/%|Vo^3<$?Ddpo"`[=y3 grmtMׂmV&C	(B3m||!.~w>7YGo੏vzճ?aORIKuOi`=#|๵^b/O8uOj9Hr(tUH	W9ioicFlq{JB+egK$SY8FCɸJ^^$C0:2w_u/v1f;cotƁDg~OH6Y;ݏ(z' \H dxiL#q|ʔ@d+lE/S<#GA_-Yu&Zpz'G=	Yxv0X_LjgzQN}چ[~[AW5dyZF6&^aH{+`o+_vI08)z+_7[͎V C5l6VTzq597n=-Ȭκ&[o9vڂ;ǭ4@NJZ_UBue%4"08"ntz76#k;	rʐTo5x/4u("ُvinc5(,/Ѩ+nq2p]r`:qNI3k0ܑI}S&ކγgB7Y>{`L\pv^w\|<R(.-`JȔ@{
5٥<26vB->½}:IICCgfuevWK-82ϨX5$Dj_|=_@/d4$ˊ	
GY3q.trFIg82Z H>3_R6HQA9Gqqu [33,@Gxv9Gl7au\"B\](I(GZG>#O5G
Y+dabXλf:&d$N4jfMbvD$iLi)?	I/o\,w#_-b%8
;^偒R
L!Ɗ@|i4_Eȝb3Ss
vV-RWW3CCʇ/x{KsV?m[Zkuqc7	pS5vgb.:ejPo̓zyծ{5;z}
IVKuGҺ:K.RY>3Z">Ǆt	Fn8>>6 쨖ݮGYZgh[;5Zgv8Scn-fZ]qظ[uiZ:fhYݨY[_ZuhUӢn`j\[H Vi!{lֻ	
X#j>ABmXH4Bi1A[mղlVNM[@:6l4Z.of݅&PKa@RCo(۰[^OM.Ra*mXH [k{đ s{͂vZFnw;uZhu`hvgM&t/Юա\|l$iبkv)|Yt`T :gmc]>5Џl<h^!XvgZM{c`u5}kfB˚vO]ȋ4lhʧF+kHhMF:(O<:z^h uZA{l؝lğ5]AA׮uք]zmo u`}mEh4W7I$3LQ5Gy8m(j9(|1OSAˆR43σ2(;W:ba^}|Tdn*OWbPcvz#.
'_g3/<_ޫ~5<TV13n?F?NZf0&0l[!;`ϥm8ҞԸLB*xϑ窣|h7wr=zȉN`7%-BOPf7*)[Q0ü~zj{2
QG[ OIË9OaEW&<#3`>MroߋsUOi9yr>PClC[K[yNfx_J2<GNEp^h+EƘe9"ReFR]/I\ τe/XI<rgƊ};GE1	G!Ǟu'ֿh-_sG_nJ_oJY53=/	ߍWwDk,bb<wj9YqqNB@rcSaA<8Ut!-{
34<[7I\xCAg:Ji)6fLee"<'s?ˠ(Kq荳{/rO|m*Wل_) Q8JǑE7x,did]Q9(32SЍl0ex[nh!hŽ]ROJF<BPF04?sj	S4LRA\IwyuJjUx\8
1pf_	:^d_!7sYC.eN26v&)lTZ`Glc!jؼ`3{w?n_7Υ7YڊBԮ4V w
,c*BM)Ɖ>GƛWY,c*Ry<)(B'ٰW*ڛ#M*ĸ#c Qizi?cHy_C$'{EH"26phlLMZoI-/g:11Vc|M=S8nCeJu	`2v^^}w7tFȰ2NA)mSn~t,;"HU9A˅CAS֘$3W $4`,9+A̪S7xip򢯀ceOiF?ta1ʗw^=c^1Fpǹ1dD5͹TU"`WWӲ=bU%#'=6m+ b˘@]#.{ȎZ::Wd7) &{FSi좪BIsU)^Y[yIo_ɏd@Ϝ(vA$gL*WY<Z31HceʜSQ^ȈTWlll<?&3OMqre NO&B) uzrGWٲҬN:,43`cC33+᪙|B1C7>0pti?&H
u9>uAż?C2߼gxډ#oA0X%)WI-j`)ayKrQ5|&5zINr肝~h:X2@C;pc"L`n25Ϗbg4ή^nԉNE\CX&+S!D0 =}_$ǆD8%~EHFFeND<Fӹ2BHo9d)>klT%ueIIyqGu4iAYzZzN
N9g7r元!Y7 Id01gy;tڃ+/E8	~I54E1xo6@Ǜ;s=UrCjm)լ< ?.8I.3Zʩ˵_lz{fǇ01>n{&+*(* *YjA,.~bʖ _|JF0^dc=dQ+'THn4W
'|wU\PʅOA2SVO9-bW a0QB/ܬT3H5.*ܭ<;g#]ؑ1N qd)s)@*QbL9G
KdRǰ5yاDg5îp~Ujb3AOjlf{Lb3NRG˟Dw`	ٿ!RHw*s?ȇiInCiEp7VUVU7@(xw?r(q|6W9G#Kb.?(i6[=sloك0<-{1F6ung_Җ6K]24b2~p}7EaSQ-C?ˌ 3l?Q=Ǿ{X@&E]%T&#Y5;]pLc3=SF@=2yڸ6+BD
LӨS;.שom0ʊNй^wA]4=^R뷽݃+$mcY!ü g:swX&oqgxJD>C@YLx:DWuE3S!.1{~)Jҟ+)syph@P 2ܝW{5B'ѽ: O/1v/qu,^0EJ`F24oa,4Q6Epєb L8lX[ΨՋNp"mf^?|l"9>\HEvs_7\V>|MPEW:H<~gmoGu`t56!nOkж^F4`]#a d91XF3YsVVˢs	2/\LFRgN*/"DJՐesʀOlIgFS>T2	_34!i$^juv	Zm]BKQ5F3lj\L.Ŗ&$3H+#f(`/>SmyAd'QmHZ3qhNhs1@EDq'u:,[u?Rt>cJ/Sc)jH!CXpOE{P z%!DR]s(Њ8t&Li
݃dV/,xbݺѻQ_.9`y(2s/S#WE(@^ oϧnL-%jAޕv>>|m9iR-Pp+̞xUHs)Su0"7	tp"O`f{~[hI*ʗ NI=\)([,3.CHNvNX9')ļgոJTӏ%9'Ǹ)KI=z,6sx~D3FmCIѩTI<X{'>~=znRpaD$wPF;O
@ t09^Hw>;Sw4991	qJWLX>dhFF[/o+Y^_@5rޯ uL/y qqdAxmo S]ņ٤2{^몺 g{&R,)	U*P~j#xʦ]v^'i"hH9g -y/|kJ2KY	iaoW1a P^pxopFLK>BV ĥ%0K rxtyNR*BD?_N(m^W "4~[-Ӿ<Yg^FYd[ɫPBQH2k+[gxB+ͮ36E,*eUKMK3'==4Co0aT3'<!?/0.w3H{)<IE@SJ,O7cKlͳ"cV::qnu:N#@{/wqa^~Egϻ;*`kΝo-\D~QO1V]6[k0׺,,2wuG'" mȈ U%?@l6k`"|1jBVm Plʞxi6$2B̡mFu̡bI⡜E0g9X2fuHٰ
#L<soi&E8K>?x&X;R*Th+CZ_g3/75e  (HLI4HS}p/Il? yމp	t_BkSWjU0ކ3)҈V{bUUŃ"jHL6J4,?[#Y$IeLi(}RnM}oyfnw
7*Q4VZY78o!YǯE\B?"L(QgӂkጉUM'Wm8ǲHeP/V[`fœM܂s1gW%g^+VΌZok};ޅ/y X^_o<!<sGSڿac/%ϟLDz
ģI;sK!a	\~/Y[x=_ :fNJZ}I!OͿK g.&.њ-_.BFO^%\y|Ǖ)xi{L>A2SQj1riIko:%"XɟlYgdI~ bZi@Zhi	O; *F!%0~@r$o	P֍\wrX{m+ĞpBtfJCex9r$ǟ˒vDONgݝ~:I>uq="rgv͍ϱ.7,ͼd\Ne /pxЂh.s7&ùC)hs[};	Lw><EBK=V&![3	)HwNUú:FTDLJuer2+VӂG^[>8!y)FL1 +Uo2 .su&&jȖ6	!ڱhx2g$ZJf([dyAJTةU<[o3ٓ/oj_̘`4&pV+ĂE%clSI>$jf4x8khTjPfwmX @^54p<tcWG["W=1creu%A.,Іc=Kp. {ӯ6CoGXfm@Rzt6<M3'~}Aټ"4M0YNZ1Ԑ=Sr>Sv/mz_EU"-="i+#8`L'lffEҦ0S^2z]zVv	`!5:yf:YpHďe(ሐPr;".kNN0#mz3Z0'^aA|.[!g\j>k"yߠ4;FkTp0kybŝDS S1Z_NNO) l 