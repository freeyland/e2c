#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8PdJ[)U"*N$35&I2, I%r<{v=f؇]u " 2R7Q%&.qpG~>UW;F++[oX;U7?gI;!r7
ArD;߯䲱h9i`o 	NuwqQ7l$0_]mo7_NE~~;wV..aw>0}E<硁k{N.>OXiIRh!_mW| yw{}\5Vg~4r_p+vk_/k״f~!=f)f3A,X:Vs~-t`xF9S7\xȎq'̋#F8F,>"J<?uّ;ΫOC!	F#X5&C't\Y6l/}c3M/v3n SJH" Z7 ֈ:\2CLN(<0;v#*a\^vkh&~k`4:X4W+4=v&xǏË7w8W0*޹i6rtYec^76 ~1T~naBcFȎ?}7c{/ȼNbY/0܋\qAqWtw箌:JsڠA{сi~9rӅ~cz'`^14QӐrYjk|jp7-vn0gNp /G?ËT`}GыYc[X}!`gN{is$rc7+Ҷj6;tG<+YW
6m&mz>١";T$CEv+I4&ӤbPLݡstţ_&-E٢"[TdkVȠ5aNeDan_̖H"O85~VjeDhYeQIYSwm? ?Sk	+A[JR D fYmpȚ8,͸.Ha&|-u<APW[^N9s΂w +^|$ݗA3F #]KW `1d';fKm=ĞeҪݦ	Vo}MXrG;1O,8cz;{;z/w^=j/߼tpFK&BL{;[7?+́{~ȇI+fxC0k"E6ɏi$lLv|7wG
,Xz2t`-ylȵE|9qݮX8iu?:I\C=zA8rn'̏~Aa#(BUj&_!Gq:-(,
`Μ7 WbC$>˂9e:WP]W-(M`|i_xXmZRÓz_TҸRU;q-X]GqƓgbɅ!nQsйȠ
O\AttǓ<y}{Re!Bە
'ѷL=!^6q 9&HeN=N0T$N|ZTcQm
	J{Tޠ	edsGHLE.BQ?	st'9?iѸ ,'G	0.6hV~0vgnB'5VO<ȬbbY#:98PھIIޫ͗;W=/(G=VH\Pd;s7<ƿ.]DṠn cʠY,(|3tG߉]~0ɮO|-"M(?[f8+iF)<ZW?=HjY#NU#ɰ轿:㊖ty-/z1kT7ΪՄS)@^VEdq
Mzs	`R!6Z48:bʾҌ	sB9؀
;)򒓾zy1rG_uoMycA~}
xӛeZN9?6aowsi/*(bog{wZ檣"jwi<(oNmj^e?{O%ŸOJ.z	瑫|>vg"uj­LHBAT9c>+y~+ٜl & Z3Ě1"!`7d[y<q8/Pun'(rB7B2 :vcF]?uw`W2+0>TfSmY\Yzj! xCx`q;Kͅ!BUaԀs3deYP6׷e<*΋s'(75ҹD:>]e٬kpT:-MnM*ɜ^iq6śzlUyp%+C$C&f(\$(g y]*Y#9C_eQ.?)|H$y#׊/nTN~Ƌ˒i"x#Fȉy+Xb+Pq02@oz{}~D\նw{?wG5dӐҒV [ui(ˌH-oْkix{`ĪS(i<p\9wj۟."UXljX?7PKG;T6
9$)*[vmc@cc
hAV}uQŌ(ؿHZBRlY&pa<WdG2oo6`hGccɌXTB2M(SaM%N,Y4Ԛ0u*HUjA :>Ȑh/x9q,6-:@R?ϜdB沇,~&X__-½FDBz&sJ;ilkHgw,|?`C@R[S)U(={Ǜ^ʹ%PBJP]E5Bhd{IX4P	u13ʑjeXAܸZg!ѫSقVZ֙eVRdG_*+>l%$'QLc+cqFyy3NRϦ1JNac% $7%Sd%awBnXV|wyJ:1LZ2n%U'f*T$DQR%L9z5 xeJ|)p|)0|){bw&0wӠU1T."Nt.JaQֹYḳN}e"IhU2Pb`sj$cIMbLKqF֬+ \3$0}mOvj/zSƢr[=Va?l(6L&nϏ%%m3N-	Ŵ(y#ϡ:WTLu_oVsab*{[<uq]4'$	nzb?:NƙHX8ʓPHD,&[`i(ªfՊV4`hT`*>	7v[bx-b/ȕ
=2u3Yc;ZGcm~ 2㨨%*¼Ɗs)ԱNsalt絬g-Ѭ+W},kUKzk`<;=,EZ
>(f@Nj*H
Hr@d)9 EBX+]3=_YAc)F]I?G#'<g@_5RPIaiD"˖bO+7@c|*`qOID4
DLơ׫վeJdE[fv{[W}a[l"G5wX;;XyŤUt<p#Od"PC|ð-}}#66؛-mL,KoE07o<]<S}H01
6o	s m+H]z:;-hin#;6Y֥qA2/pggϻ[;ͷ{{݊3<w.<d[ag^A0DS O>Rhv >rx_SmA3j)*r||IJC|AtOGцMw
+7UD{J9JG[zrg%i
!,,$/	N̔hw?t|Ri;UmMXrYQRjfG*PzA*fV\r3:.Z(odQe  ,]9L9Y(p#,;uo,$tGA3EJT[2۔lv(MtY5 /m1Z&MC>or4	Q12ZndA"3jUf Ńɴ1
j;l^`PS+zkto5c4k5)ΨNtu῅.tvvFt%s/|/wѕPũI,!kiӓ1҈Q1f8>SPN]Y0)J|#KP%(pEf/ M CG5}Ta-Y!;@m8`bodtQ}$)a`%A7KrD<yHz~~v#!Qt:;>/1ezG&1/BW M\uNf+c%yYvr7)w?gޒTs٬5q[i%ZrK{Ͳ|!\cS,	=e*S <Naû /|+)@W_ZHniïGc%Q+bhD=PD*))oy(dj`igc!7GtH.<9fPD%)Ы,+CLIR9皆0ia`$L5b'HmdEM19RmѻG۴Si#}p4>t6杷cODҖL99	Z՜P+=!v%c OlL8.)Hԓ(#F'dm4ʉJdJK\w_ t/|Ixʔ4B 
J5A.*FM"@`Jt0ߩsgA`kgk 7"_a+ j>5P/,TXxL-oeKW't@{_z#L783rkɋa
<m@-l޺!rH*6q4!R,FE&^40c gw3'0hRN򛦙45?%eCL20ik2n+^	VqaiH=aCލy_g5N3HLR	꘤7t#LmNzҧAKQT31pޑ)Qэ%Y:BY%M-P@rޔ\(5?'Jދ~`dK/<a_<q$f'#*G:5JIވ-h[檖ä QX		eRBÂ1Hz{IMȎD$Ң.<yUڄV8u"Ņ+OH,;G "f,4iͧ7Q,1)MhZR 1ޗ92'V!tCx)-΀0_Ibyâ"<cOO n$*;QqRnyECl)ZP@h3Sa`,`[J	A8F*(a?\$Lp"rk 13bot;9G(Yen'@x&~ :>
L	$?*rQ"M'3LIvM|ogvLR^n^gcy)B"JAv\R
Prgÿِh8zY!rMTyϩw0f,H~(SgtOOS&IO-fBGRU
A(V6K4(~Hhbu&VAAXdB;;IқvKjX-tCg<%Cm`[2ܖ˰[McXkt"o:-oZ)o\,k:dYAR5^%u	|]_%u	|]_7_mYD!5
/Ct@Iw 'nv=[KV䮝ܵfaIIyͤf҆fR@FQ$tWdU k$w,7vBg#Ӳd!%fqKo?iςh:y!)3G;&d%RRLA稬I8qdzV^aV񞣿YF.d[u&~tj{XmW5+-vsF}:9c/5Gc1Fm1]6kh
7'bMmb갼0(Xj;J^gLJwYVkRI?t")ÒC
1ڒ(B)^1rX2$۸7\$E]z2&s٫*v&^bE򮨬OԦPUty%$	(dD#3BaM+0҃C?`Ew
WIY[B#TYi5lv"^iZc0B|#!y|7_{qK+Ēܛvɖ/J/QgwJʎW[\fE=RR죝arIDRKHWzaJ\+}&$,N/kԽ'0*^TUlZt7ל2{JHB:̑EVM=ioBz2|-(	*- 2GD!c^ބ$2ܛkENyOTia9QfHC:đF3	yӗE*{JFA#=5'FNf2zSOnwfҢGO@ךķQW͍1WZ(8U7cKpo<Kû-zO$xv<ހV`;o{$h^LnqcfSU]>{|gmaø+:	gW1j^r9G D\no7\吢H8%87}cN¡+5TbgXК-0,|/"Go!ƀ<s1 d<⦛{-uPe2ZǘbŒ-fHa\e"O&d|I8nX^-UiCpn&Vwiu_ :j;ܢ ƱA?:XPϢ6Wt$4L3۔W'hzc&0r/ГGI5$&4I֍'e*μKe3#.Xfj:9Ln-Ԍh44{]H<JD@ʏ:R	Ynb:QVgy@bd`Rsv]dy,<NCXɚjJu2 	9Tmj)H*sAT%Qnhv\Yll
%jEGa
V;貌z-/@\9y%
sqwҏf3w16mPȽ$n(lX7U&3 `)[,qF{;ۻ_T&?<ŹSA/HMg/p)ڜ]ͳ	4WM軼DPPFtY#̃SVPNY`ĬYsdY*Ԓd9M
 }ץE<?[\p,jT/c2u jhNfwT~良uywzf4<9ĴOh%;ٻ!K_4O~i"6`M\F/i:kz}3Tۊ(A^$Bdn8ˀmCl*?L
DK _
;1j9*(Fv7hU(	
͋LPbhv4t26ؑR߁:#B)&&Ɍ'Lѣm ANt#3Idy6|@$AmgR:Sp[]TяC/r-Mًȉ`SE>2M3EqKUΐT!~K:ݑNh%ڭC<A,dmIxeЯ(m,fHZq]S/t>ŋ"o|>~C	,z~sQMBb|?uY(VX1'/@?WRӂA5r-3zmZuj\A}?AtmvmP f1)V Ů$YK$Ҍ0mdƼZn_"J0/,@S)1վO^IF1mq+嫚3S?xIH/!	epdnQQ6T+^̓6wrs.c'΃pfs^ms913?Qi&W>?%qW͘7ev1pB. ,[B}	V<4,RX!$}W O&@J6_ɭJ{{;~6g j/w w [^FF>'?ָg0Sk GaeB_4gvaOw*8naC|;8ep4oRE/BcaЪץŹN>\OOzgE"f^8n`0>-y3T]XvӐ׷s%(C5p``Q- b c^f4:0*Zga]iiA(F\?zb-f_L1G6Ғwja}:*:ð)p:Ђ(-Cx0)*2f'|'}'SJYݒ*?+f٘ㆰI[&f٫fRvX^u4an+VkI#5!σOē1:&<дYu<넖oP~}l3AP0iX>xiuKMa"D02V#"k25evUu&@@hPoRŭXb-cx??s6rf~co9׎Z k8bcM]CϏ|JO0[ݒ0[P]ogeJ?UE6值luǬ)G^?ޜq]ϕ1qlv)#De 8=mVz]8դ?2m?Q@Q-8]cr[HGD'!lC:ikQ݋I3nLPr&1a|WrɗF}:HuViI3@xRtncD GmL:G$ӪJU˅-$ἉqXl(.,.S-.%&&1jFL^fj/SfQxdrtB6()-(!7`sx|9H:BMT)ę؁hf[tX&cG'n<YKE^dvL\M(f% fӠ
)f__qB2R}5+&u[SZ稀E<k@b3,FӴ[Ҝ~h(5UP)5T@Gfvh7EJ^nN0oQ*AcF_-\-/zTV<>
Kx~_s0lL䈈]%#Cʃ1,^eJ*UܻI,R%)yiF[tu$^|\/6%;</_'S0؎p\_l6KDl+!25"=%iScL@@Wpb6tmIaP}#˕	_M@
#J	"d]z7S8Rwi6#=qxf$Ң	O%g
q\E3s̅M̸gO1Z;UOPj>4{jelo~zg8"ZN$<h57iǮ?Ʒl7E<ӟ,)bz5A@sv>3,DJQVDB3Nt^{a:P3gk--댑=m٫INA5dE e\w/ZJTf*<J"tXx&)JhTXÜip(8p	)Pj(yʴ#Ǟ>$icv3՝n3ӫw:SYjf +9昙g+P\]TW1Y/"kwv-ЙB@h-F<֙DQIK(>$?&|S_vZ݌>?3C'3uLv(jWU
vAӒDĲwi;c7g0]]f gŇt$Lm*WbSVzvDóӛJ(LCJ
D
nY̐,./.o{OFx
Jr]0})E.1vt?<J};[-p1I2%ˏhrr98$RpKi^Rbi3Ld9{ܟ&ebvfKXW3[pgRӨ2]Tw9RF2Sknj*q;8H]6dK}hƹ3rSTUn-57xX(5fs@Yާ9Ҏi5®10JQdu\w;3d=bybT7oN1R4Q6}aט~eDQ*KA1?bZTv$g3cyۑf6?-Vl[2Wid7k![2O/&ijyH,omtc6]{0;fmk"QAʾ0V`)30dؤdfeX=ܧôvk\iυQ+30!.B~Ystr^-J}C<g|޹Qȵ0oZ&8ozI=gf^Mh٬n5t(s`/}y~ t!>6PphcJeMMZTxfBERيюHZK	 ueq2\'ǞTX,C7v9))u(p]ܪʛcbyc@2ڮ.8S>mԥȠļy1hUY\42J:19r]4#imagƙv5s\	l¬ET+a 
Yg1_JqN"?ɐ9=Pp(,N9>1{gd[C2/1d>h!-uGӽ%,n>4iY0\z  bxY^U/bQQ۩A$v4ʗ,m`xѲv2s28TTO!egWPRNzc:4xHsDc	V Q~c-~z(# JUq'['{w+yuuKduu,emLP%5FzZ[96D]<CX+Ume!,Ô%8ZQ[xI@,E5Q{N<f)9ʌv<oD0T;b %	k99vV
nvT޻߄zke0p(cx8ZݥO:J~5jcJ].gpb##(owa''?fଅwK-eDy37b3ڈ%Änf+ՂL;f 39,E/*PS˔qSPRbIDW;S9[=Q J!0-%n]5dФD?/&JwF޷GڷMַC3ЦeIȉ:UB4ri9(y勲xgtZJ}7>jg6},b2LmZuifI0׌3F_?Ѓ^IĆޑಏG OPdgѮ֩ESTAY7<K_K~Ϟtɀ%m ]zDռovG戎_
3sΧ?H8fEntV6n4^=POn
R 馲ج]tٕD	s`rHlʛ-lnt3zALyS[U3}\U
>VK
j&cTg{E9Ap (3S@@]3yQՅO&{R@՗s-}bĴ`rnGb	k VMV]-:!zb~(5E*=у`ZN8d?۝7-U}'YSeqL=Ğ.UXU}yN)r-äxo*.F٧CzsBr$(-Fx7My,T^#rKjoDMd0}&s>8g\)3c<|]'bGh%&,Z<vi8bO~ȋD1~N~by5A&x+oOyÎ<_ld߫M5$e__D;pt=Hp{B8y'.I/ <uznU Ay+lI*6p`R{z 0fFx(*]%%4tU{2xfv<Jq5΢4IeF17fE~CX;Y34_A^q 'l=BUmlQ0e)uը
D	ӄ\xҭHoy\* ڷ %?OcLsXy	*HR\ &
$\_tIvZ8OYqfhA`Cz,I3]r,մxm{jBywY8t+c{m.O1*6ءbC?1ί:ɓo[
ɚ6Є~MgH1t惛ITO_6;EAGxϧJ{D  14Ȁ$хDW}/ B	XЋsb3׆?|Om#BE5&9]tyF5sMHӣɛ0)x&n`/r*9aAup8#ClJP`W)1!ܜ<ar_#Ӡ`NfAWރ4q̮RTIGsˁˁ_*Cw瞟?r`D{ʄKKǨK~`&?2j*nX9i#t`L)N?܁=4*I]H"jUR*ţ&a̒iaJjKyT[ssEHІns!QBS_helO%\*5
`V\1yd<^шakDJIӊJ"}da6{XLS©ߌ3*P47ThpQ;+#S/<l\M~ͺZ ~G=h7`}rmFt*3:JxC$I8 q@!z?uͣՀnM6r~__]~I jUj(VCT=OSQ/e{_()ϳDZ,L:rFAj1҉HXhfW=rAQ_>O.TC	i +.b[n5 粩pLm3wmZ4I)DB7b-TT5.	f2r.2Z*y4u%3Bɏ|QƶR$ʌoYO|gwX ,3ߝaFi)aXWWzӓzhf*sVj+[OB1lB~~1}`}1<?=':	Պ_՞s	ģK*
c>Tw|]sZTG`$V5cgPQA܅Ya2>	AImU<T2nht}Zg#_ykD֏/j.3wdd#c=1^mo4O-Fn5; KȴE<xcI)F]\kn,~BvhIqd"U"/#褠S sҁmȇ|YR0@"Y\;	s[KYC[hTN=&n#>'xt1OS1l磭	
Ň3`}OD<ůx.ż@>xa}x<$#u|+Nv>1O2B*vE;gNvŧ#<2_+(,85
B]r~1chW2´-ћ7!q'$f97P%I9ЁF(	[LS9rCOءi]GՈ#	zf=>%؄W3aCuyGnch
Wj|%W;k$A-mڷ-ɓk;<jOU(U~Ҟ7U~N>Oo5
Qf<$.	/"2=蘎b΍O4} s1}']2olju)wU2]~/XxƭyJXҚ0%d/ڵ_^~E}xj:%.;.5\h E5xic\yM
C"Z<f>f6la	HҰԟe&3fg%4!Ga6='`	!1Uj; 4Cmw%cIP|svIVkqݱE]t@V˞krc>vx8[kvʰ`C*_acLlm{7j6>%&hlk;@IBt?t.ϟ*˩8NkGJ|j
if%S އ~N_JR7ڪ+bѺwF/ʊPrO,CAD!tCDYJD5SJJb/+nAz
c>P0@FF/,
2l]k$`?'KBkcSNjgj,L_$1l`]^2ˑ^tW{:URG\-mm,(ɔD$fЄ}꼉s5Fj	4裤]h؝#҂\xQF.<.>LqbPXl${Q+Z.~(`C<(nU{!-r+};j
?
sa5E8e,.s[DC9wEnGr#ӀVa0=$t'1v+L=qpgج/ʛ/9XOH$wn0%p;1'/^ 
`UE/,52!:=-\e7,}rsR.u[1,HqR%1/Q]g`ݜ	oіΆvt>_]\=4;ݮܠV?z6JEv,Gfp>YQxiF/ٍ_>a#{<$t`Z!,5Qsczceʳp%;Q5eK(kS=2Y-,K
&x@t&zІvRڼ:1.Q~'."<zX;ua|ʝVcą%<PYHOJ +(1c6Bj9,<FjQOZ*Q{$G%!bi5XVI=qV",0932EcACš nŠfJ{2]z}aBf5ZNVot`%Mp m>d%v$_ɥT'z3{^mbWW..)Vgc_tڝVq?_.J]MH?ԡW?APr;1e/r&Ƿy pϥZTJ
*Xԑ'CE1y@#aEL+N#s,//B!5;]K~$-=< [yIb$m]^:cHp\m_ǧnxE\f?:՚ _;	|hs9)r%_]fa]__D")0S@Z,:qË))!J4%mo`&ǰ[PrDeU5V^R	h̨/:uű`eFB<*Oz^cDhϖ >z#͸Y[+:wDOӶ)54J;ƸL1 !}tɂ\II|pxqqkkkP7˅4rFXs1iy߾YYʉ\ݴ,eYDqٚ?.yPADZ9n8_dY){Ľ8H^
 ?w"<ew3d~i +ۉSǔҒd&+..GX`Rwm}`n0`La߉PfKmL }%ۖ^`DX+ge8욍ϩ֫QGn%pFVSsEyn!)~&Mz}N80/:6uNZlo:Y$_WrcLbAzS`ҏ--G{$R3^]ǹ{Aw5IA)GM6{s'p:dbDG+tjF4o6=KllJTd<-~&PH/F)fKI]PܿդCDcI7߫h}R
0#eph_!
IVOMD7JEۭ6z^s'W׆cהwfM.p/? VՏyj؍+X=a̽D=hD2G-gQ+ CLW~#ChrHAm07rhin"Yɶ_{=>0uoVr?*hYgd<FƠ%S΋ݭͽ6{Mɹz>?N	w	ZN1sU 0Tex<pvuL
z׀]\N
raA~		:>43}̧E/'#3QDo66h/^om>zj˝yj+\*^罟x^PL64e>#0͟^>ȧIOoz??޼˾"2d?|a(vEWizI˿l~~ Ὃ{OovSɻCQۃV*@Ӳy?}/Uk|3Q҆]+[Kʻ~]Ј`o5}^w'W?d4ߌ&ӷL%S&ʃA&<ٜ`E%U٬0Ga%uy癢R+v00'_5߂j6wul 7;XHQa-M~FME`P(g6w	WN(K3)!/B~SZg`_nKuwҏKKGJG$dڭ<ό=$syƹn^zc[pL~Өe~	GN9PjAˬYw"$lv;AJ%YK'=P?*۳#ewv<Qo8(ˌ$KӒ{Â5msAxsI%"d{ӂr%ٗ8x9pdvq/wsFd=jjcDMH;pFJӒ5=y핆X@Qof%rz2$1G,f[N冡j뚃΅2*ɷm*#/z)`j}5+wZ{W]?2BU&*	YV9*5_[.ntVVhǞOf膴i)\r	K3iwp4ɕt[co5W3_V{N.Bx"w'!}!S<	?Zɛ96c]oSo¿kڷi/4WGRz׍駫8B;tb6(<+\Ol:^@Oׯ<[73xFȍ9滕ϭ{}L{ZoA3=GB%Hpʹ7O%O0fmTܨzCW)+ms/FeO~ B;%{*n8H?2?a0pd((\(c(:vFb?N6l1v?띀w#p=<>Ncwa466c)Sw-%l<N1<;?cS_qrxTf5é띜Ʀ/$&>zfmodb}1	E-:;yq4|MknQw	RoԐ9-;OjM٘x!|.^/}ځ"co8.}l5;N_$z~wVYbk[_V'_jӞz}}ŭEX+2k&[kL9v:ǭ4@{5:&:Jh4VSXn[[[YY_w5L9eHl7V:jOzJcU(,/Ѩ)nq2p]r`:qOI3k0ܑI}[ކγcg+7X>{`M\pv^wL|8R().-`JȔ@{
5<66rB->Lý}:qIgfuevGWK-(2ϨX5 D>j_|=_@/d4$ˊ1
GY3q.trIe82Z H>3_R6HQA9GqQu [3&3͵,@GxzGl7au\"B\](I(ZG>	#O5G
Y-dabXλf:&d$N4jjMbvD$iLi)?	i/o\,wC,b%:
;n塒R
L!Ɗ@|i4_Eȝb3Ss
vV-RWW3Cʇ/xKsV?m[j^_WkFn<k6zSV]&?u&,/ޚ
]:kvvm!ޭk Otuu6\(}z3[kkϧD}	%-Y!Xo Zv6vjA[۫~eؚidW 1|jڭ6bЬ[j}E7;6GVcnvdaٲ[Vc7Vs^Y:iQUJ`j\in@vC@*<'(l}-!@ڶa!\WWEz_nVˮ[Va[:5o9kȳh1h-dk
4Y Z
kxCٺjPNz:ZAv6,@Z	{kup/8 "|nZjh핵oʚnX^ou`h[-(4EнX@ZrO됤aꮹBZA?kن~`DuL;CUj}k[Eo˫kfh6/i yqSBcMԨ3|z]!mhDQϿWHݭV_^JNhUoڪ|® EA׮5ڄ]zm#u`}mEhM477i$3LQ5Gy8m(j9(|1fSAˆR43˃2(;W:b!G}f|Tdn*WbPGz#O/
'_3ѯlz yc|ƇqR?	~QӚ_plBAZWsvہ}'Ϯ.WY*ű?ŷL![~.sg;d[j,85.ӡ/k=^shC(o7:J]\P9,eVC͉lF%9 <}a+JSr7O}X^-UsyO3mP)Iy+7qʄW|tvINM{qNyL?)M0=0K·#>zğbhk镼1|+)ss\IF#gȩH
mwsIx2v{<PW*LI%0v<-lX1,{g(Ł8?h 1?J]w`ďWe8w4./oMOD%.>>Tʪ_!4ϘnLҷt Z#?c{`VG̊%xu?>?B1ҥ@'AhWi72I:'FxǰęN k1?`0|;16M/,ǡ7uPxQ>C7 3]U	>RS&	y`WAQ#o[Y=8(*|s>2+QgZeM¡ыM-UTy*Սai9Ech)'L)'1ZEj%r߉ժ>pb\(̈tuܿAn$;ܳ\˜41f:mFLN] S8T٨T
E"ۋ8"2#yfރw+~&o'KodY/%0
4\i@ Y:*UES=2*=e;7Y**?W|y.'&SPN`aſTU57GTqA*ʐ% CH
1Oj!%@(KE el&iЙ07rb+]lk_Μ7pb(c|߃]f	H{*+HGq<݂	,c;vGcd8콼O,n.Ia/!-{exR2MڭY'	wEx)ݫr2%Q$11cIfF HiVYrV	,e)"F7o3!-jwE_	 Ǯ˞ьhgd'bP/)zf^1Fpǹ1duE5͹TU"`뗗Ӳ?fU%#']6m+ b@]#.{ʞʎZ&:d7) ơ{FSk좪BIsY)^Y>[zAo_ʏd@O(vA$gL*WY<Z31HceʌSQ^ȈTWoǊ^JMPƆոR2	'g@bGLd:=lYitA='^O虙pLIU!a^EcOBS8Fut4cc?kRm} b!o^3<rޑ7՞b+tX00<%9@VO>|X=$'ŉrx]z|?Y4n,bb f_]aORB}07r
G3g@	|D"!Fu"Bq/cCR"GcjG$##cs'"L\_D!G`i$7@	UQ6:nEݬ#x:Ѵ bk'n=aV}N
N9g7tf兣3 R7
qd01eЉ.y;wqڅ+/Ex
~MUF1x[o62Ǜ;s<UrCjmsׯNufM1 	gavMdX'LBbRN_T5d۫6w=>]Д|Ov7K7B3
T ̪dIuls904*{|%*Cy%P\@	L.GUd4!a$)ʟUVYSf&{)=I`[LlDXO2^pT>$"@"a.^Qf\a1\'T[iy"PsF*1@D]9QbY~A (t>p#J1ijaX?lz5)Q<fo9߲+\_UdLvEvGZSw'Ѹ+,.Xm̬-oȟp#=RtuO$:aZ{*PEqxU7<H7eȱzG3f*hxiV[eѬp%MG_KMƂ5gB?%}p/fځR_OrZkmbK&7@TLFߏ3l*#tg}} rmB''pwϟH9ëܠāJva0qfg*Hf=|3s8%P(l@5{'~6.4*΁up`Sp4p.`d7gPM*.mw
IXV0/ÙN&;[9p|еzZ/R, (83u\xI+xCJ2RB\3X$*%büF}j/	/jt/S(kK/nܡE׷KN/ѳgL3ʹ8[MTyMkQ.\a<<3j"8'c尲HsEWQ/<ȯAwk0;Szg^x;|}w܉M;נUCuAT॰R'Bi:Qd]~(8ar@wHf8#Wxk4W)P2̰]D9l: 2q&k
jY4sn :AH̩֑AE$HtN	-̨|f}J&:r{<d4[K-O/A\W+^MаR:z)*hF~^%SؒՄz*ieȬ,9xŧ#Txʢ-/Hp7sIv#S 9J'>ڱ'\;j%>v,`Q3QIfjS6KeV݈z'ݤJk@{Ȇ,i3@}!T,^ITצ59,J+9-"1Svy 9#..pvԗEuX^Cp&0ꋣHiU#85 1Ca/񩼫[s4l&iPw)}hosZ-U#+DU:;?A\<`?vC&U	lJ-IEđe"yˠ66{Keuv}iʉf	+'+䯒A,7Wj Qrt7`)	GOĆןO>@O}r~~H|BѨӳm:):՝*I'3|'gs:ECm	=*hI ?i0,`o_P:u_[ 'dtې\Ml0J6vq	jdo=?`JG"e%T.wR{"',wF25n5^l N**sW nrPWj" ɂPAih.ajlJAϋguB9o0]A8f)d0aY~ߛђ7·/c_k2D.K:Fyz 8/g.1o<.Q #t.(oB\\o.G'ď/EQx)dKT@_!R(%i.qp)]N©N2+nu鹀eEF
u@*$A*uP):S^h3_]4R6]%$_Ml۴43#sOK<4h}[F5srSiAT>$R	4}z;}t+"?0~:VtDHw..b?lywkgClts=Ko7^S㿭ԛ:p7VWNon7G^#>-g笒FYc.$EtC
@#E}3v#'b%!N2keLßH"Olثj;H1bYS νFRWkaQDJ̹mqؑXqW7R3{KHM1S#' `4ܠm %g6n(ta;ڜU`E9! E;1)auˈZh{J2zf&ӰN%uOBrWŢ*\ xL^$@R@Xnmch3:16J8I^>a4vL`"'6Pj:L)Z:"Jvo+u㬁c6ZDh5!!Б\S`&q9&aтsm8ǲHeP/MŁnފ/u%7$uUفW_{0SzjyNw{Gȥ]֬@cxh }aqytXXk/aǓ7gߺBhٱΜkH7^dzv4+;VǔYFhzww`HmmpH˭km>OidM?FP.i(T̕3[.~N-Kڵc=Yw;O:$T{,LozLcFY_X=(K#sadeSSn3 d	oz3+e\e9πbal?f7 N; 1:ɳ%.yB2
!	-MA9(C jucL
2aZftN9r/p>N/^ȐIIc
.gRzmHլѹDpY[6cR-L	hh;("¨k AlTP<ʾb[jTM+;!q^znz):m- irwF BYvF&kZ!a; g$[+9bpf+1N?Sջ!elŮ;e<1zY+ȲVR@In1JM.exԳKfAm]0yrYXV#*O/dd􄁉{4/ry$H~$B1nCP,oy MM?竳`9Zs<雵A*chKD}YjP轚*d$x5tBG)i6~9\QVT>i0b@1cӑg4gHǊMՌxģs-h $h)m@BTHz갆X4(\Ê`SǮ^Q%.lL$.q -~|, vxuz^oX}1I-WX-<N/͖Ya?};:~?mHk
6YO3bk@-ii! r 