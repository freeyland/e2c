#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 8C] r 4/(:dJ{"X$U>:բ:+$(3"+"Kd<<Ύ^`vkKD )qp8ޫݗZݦjjVVmWZիZ_/Q섀I},HNN&H~'E/3j5[hܷ]\zքoݪWkp;:FuwqQ_\\6\|Apo藯^G_k{N.!Od@vYZCk87 _)yv?tw޼{}j;\Ebvg<=s?(፽۹=nd;tE~d%ny3CY޹9σx}'vD3GyEa&gl]m?m7jC7W_N0Iʶ0\|7D{=QM;$ŪU~p;֯[?Wm׶>0't3nIE+"vq#O"a#Qtq\S?>e?kƽ__{}?uhwq?:/_[5_o;6(D:5moڙo;vY?Wbv0cl3+ТƽJFX*, u6\zN@}Nݘ^|CPzA/4F..(ΠcA](K~`" _P&]_⿝M*atPumhM̸I0- =wFD" Y`2yl-s}5b@׆8u?9@T
D ̎(sWCa/	
%kJomv,cZoh_kZvV]?/ޗxTz7*}XZz)>,1>ۘ
_~aj	8a1/?l60!Hxw"\hdǃ_͟މs}^P&	BtQŭ^Dʏe.(%說ܹ+c<___[YkqhV]\ϱ--y'7+[=ΠAl,`JGF}i6<1>GF;1K,:ƃ>qqt{>qy0|@ CޣO^jK'Ro;wBߋκ8#vVK-^b]+݁^/ri됧m6m&m:j>d@d@rT[5:::;txZUA5llƬAmViKanPd2L%Jz0I_:E\Zܲ
Y'럗w%uRR D^?byW`P8j%L0JĺdNHn-yO/d$r]}`b
W5&Iy%yvPGƬVHҕKH8f}#7fW4tGl_z
{IgU4_;R$vG5cE"5קQlw/v_v^ywiWj7޾9xxVK&BJۇݷ[?+ׯ;^x~RɇI-fx]3k,:E6iS$SmLvbݽ7E,z4p`.}lTȵE:P|9łRGLܿ84b/K :qc'fK|6Fr׀Ke3
>^EeT CKjv9Y}F*]}Z^%su4K"ߖ
WVeMeIGևvZIT.?ƹrylšC>''"ʗYBy~	C2C*>va.;hљwOpHoג*P,GJ2QDxY]t[40mjB$-4Sip9YQE),$
K:~(kS~,f{IDN-4;Ff*"ttqgv?w5G`5&B9L RHM܎teV/軝*3N+nFg0s+
BKbU@[h$GRQ˹mA99gh(D
%ߚ7M6!ڧT܀Z7r!5YY,)rtG߉}5~S-˄HEO07RF թl;պARvL7P$ò(>KZUǬVf߰J*+QLP$(-dD)f%P8~7Y-h53͘8kt!B.qތp(`WEKW[?FhuЯSb=}yS?i  ;||_XGǬ;{ 
@ykӀ2 &7VL5TT;|	`RtDY[+>$H͓R	;3:5VK[a	`ǜ*^E<F%bNV m Z5Ĝ1UEbΫnV5F(ȷAy}y4ȕ 8/tZz|±cY~Fh[DGN#Ḧ]zgRf?Vbևrٌ|*- U3q_-%i2/Rl>7z	\"ҫ_A>'h%3ޒ-ϓ <*΋c'(75$:>Mu;٬\b:1?;Ol[U[D쏇!1y7˨hG6d%/ŔE={(KhcWeEe/ؿlv o)A7tr&HK#/WoTG_BB1'ᝫDR>C>Iӱ82`o^z6{	}]~%D0\Uvv_><ãGo&Ki3lnp4eF"/0+#Z^!4	M4hp+.!UxlV*X)?-P+K';P%$)Jb#J5p<fB#&#|XC|@.	ꡘ YcCTHʅ-ѴLǊc^^E{yA_>b~0br{V2AH	e )D=e(⥣)@7AZZ ! AD&x}	ŋlZl&Y4A蜮^/.|愧cr=ym?$fGhGm65%.6i+-U,IGp/)u -Y*Sڟ.3K
wU fe(xIx!M˽d$	F"Bb{)Y_KTHbpOM,yA!! 1b0f@9A܋s֌x j.)-^&Mhźp:5Nhq\ffq* <Va] I<EP0)eS汏`P;Ia>BI\>2f&\+9h*L1@()	w}KJ.tZci6)D7,iɸ#4<.UhI)wE,q=~8-Jr2[@X)PJJPJ*Lh
?.׊3̍b(\E2Nl.JaQ.ҹ[ḳC'Ҋ6иW·ts$19C1Rݦ$%ݺ^E=MVp[jvIcLmCӝjALxT} +2
~?|bdX]R7ВXL&)sOŐQP+v%-w/S>˾LEqRn`œYu<Dѿ`V̔;	I*[UBg)	毑ՊV`icJ7;Yt{^n^[$^P*zfڗY1%ﻱ2<n{"Be O0-V5e371WVIsK{ܒ:9@8mcݠyu;KoQ/QgFu#ӄoHK `IisH߀䔵qɠ$68$DV"ۤ$/lJ-]_"v90O90JjY_&?{o0N`7ÿrV癓DЗcg{ok>_	Xqk99?KQ%S,qv+q\,{YKj{vu.ɖ,M+Q~TK~GxZw\LZ(FK?LF/5$u77G~4tlcNTͳt5Ґ}♪%[[#(LN˼8|n(t[YF*iIK@Pfd.iVڕ?ñwh?mtnvJ¹<1n|y mO! 2HFم7P0,ʣLh#[m=$Q{CANN(B|$H	z-qlؤk6㮊}o^+޼xQ*apIO1V!2ɂTQP䵲"IיҚ^aOWʸ oƾMKn]:*XJmL(Zʈ]9L7]J'tRіߓ,ʻ9r~Be(" k a8gn-e]0]'HJxq3%-?kC?F+zɤ+c\ا002!\?FZI!0L"> wF-ĬSx06&Xbmc͋sFxR>\">qf&%iTMQЅ}Ή~NE̛%yRߝs84Zd4fiL#͡>q8#'rƹ7A|+G{}R[֢XoWGP@̉s0xq$EUE6{~V=~f#7P26HS=FRBn3:"E%[}/FBTLh6;/1tI)|nDJ3L1q,;aGIE~lj3koI쾆lV*݂mZ	xb֚%|&cSL	Z1K&S)3Nx)ybW*cFʴ9e6K+=}n[L|mԂaQNў
FJ#!/l@4lx,^~Ņ'y8'l3*H8{B
*i/%W~gsC~00BQDlS3\qCj<$}mڮ4^2Ƒ>8I*g:;8.%"ZOg	mKƜrќ_DrCjN(:`V)InXE{RTH=rc9 4$K٠QOLf<WS5]ʥƾ	ed|~ĖvR
Sӂ "j\B	SDa`J̴0߮΂h^kXkՠגzQ?f*qOf?zgw1=xaY}'|FZ`m{}1E>JQ{M%m[7D	I0*C/ٟYv+_+2HaXRwY]=';!3~߮dA|{_4ͤEhX݃mb9/]joh{pH]ChF0n%(:v$$I*o|w7@Dة'{T69Ee#OPn݈PuC+G#캩32)fQ4kO 2zK/a[OqN:7ARjIވd-hG⪖7ä(QXU	)eRCC@|HU${Mr5ΤP&tx,{)hO3~u<D6aNHq劤6,KN#z,o[9bZ9ha|cL*N4U7̱9)
RϭK>cOyLLO;38?л04w> L9h6bj@̍P@/l)+U$PaM3({ GwT\pmDxQD>ʥ#PI1'";Cdi@	G{th0%ITSo6܏$#of$5iۃB._hU};NeOyٖ٘PE@Aq<
P&8_hH<\Ҽ09_צda*<;Sk	(@3@dy¸)S5AOO4O]&IY5::jY]aQS?5Se&A&VĪP|i$/Y1naRznCX8peo#A[-yؖ<nK%cFh5i˛iʛ˛1e)Y,B H_D*JD*J@jRd!Y,At5@YjaO Frܭ%w䮙5z!$I
^=WOPO ԋ Ԓ$$$I՜d祻$k]-w}iݑ:C왖%[k,[7,1Bhy9:4%S,	-Ofal%&)`a'h#:B3r0ҨS5[b;[iq3j4N|;3گӜJXEM=kԀ兇>zukb.*C]*9p({2ͳL9JdJP& F_2D 
%ƕL%OFrRѓq^-`b9X2zLuzc^EDW"<DoَaMNQg`Gpr#v3ߡ(&<q呦&%FQig*1befn}+-y_c$,Opp+w/ļB-ʽJeml+Bu}ߒyUFܳ-*&{Ij	蘺!L9׭ʞvP&WӍA3Zx*^TSѻݰ$ron8e,,A<0Y3xSWFuThc+sl/@۰D"y{s#9
-`?'k:ބ9LoFUJaϠͱ~'{~*U͆=PE<f8? 	JhJO'^=FU\7s^h7(\<|,^^݊Ee{&+oG~w>;bM~2+W?S\z䢋V.?=>{;|'h~7}?B r]ƨE9-eN'(
|seq!GM["	$?+&^G˨B*v"C{?:	DsfR\usA
LfCYK&)8P6MCOœݳɮs|X,.W+eZܰڽɾn=_ :i+ܢ F?9Cg+YMF8i66e1 G!!q9/WO`<Jfߨ-})9<4NE~N4J`wٟ7qddHiILv1,3G1bR`IF|5ÔV9erf֑	"Sh̓ s
IsޟRsE-)&Zġ=+8``dZ^!;-(̝~,v#yq/FWbq;>$4rQW*}7F}F-fhƫ60鰛AOL0dRgDwQeb?[]yrtĆYݬDŏDO5m^S(*=zR%̝S;MӍzݴnJYgל^7As.fUݜ:1=ץI~Bw"g"ĩVl#9DՑ'r6멓1YASXx`m6є%t<A}俈8~<kI;@5r@tqd@)nbL.f+<gZ.ZBdne?⻅@
Vr~KhleFq;Q!<`vAKNv8>$JB*B:f68UF\OfdmZaSxdz;ƲB(pN@AtI`
sI}de6/|^.;%yxVQE%)圖͍0]3+4Nl >HAeWtL3Y(6~A	cY$/L&?$ZlU%᳕ev/<@3J`eF*	pԂV3Q&iKmTzK"ZWC*D?ajמ{9pkSGfLZQ
^|-ϼXa/axk)"R_|{sQEbb;،i_( #,L}Zg86uuZMj7ߏ-cr?܏-cKb<km_H)he-Ĕ љ  PP$3ǨOf03Kd{f͚1;bcr:]d|¼>'9<PȬbn>.9~]qF#:SmƟW+JMQLg$-)
?.ʆkJW?ewgp\#`w0ȉ r:8wow92J-caŘG8(T?8ۂ17zKLI#I2C@i3Or0͕}_0cV%7[/K%?3v|ޫ~(QV,r;cݚ
7",yN(jɊY0t+d%=QT0#z2]L5-_+pP/ZV,rLmh>h&Fd6\[qx0M<)A
iAee.M9qOww-<O͌xwx'Q_<P	ݞ7#g`̈,DFÖ@"F~t/O@>AB,(t{|Bk<4P$yb<nȼ@餞@I${B6d !;aПI:ryE+zuv>{z'CUN@z]U/5ԇ|m%\%]Ȏap@MY'IS(FD'FpӢ6"p<]wP>9Nb&
`-BifwUs_Y$^u?xbE;NP^Nnx^3:k"{uL dkh2,Q	j-_/k"@HLڛٖo~#H u%??c_h9t_/Tſ
#aLLYXݾHP|n|7iu"{zd&X js<pQ5P:7N#;h@u+ѵV8;oqvY$ /3h#VkM&rЉ#s	KDȅ<]&ꬊӝneǝU<G&guiL!Oi;$݀`m8!^gm<۟o\Ʉ'06ʙd\>\Gq)|u.{17<Ye2-'%p7~YH!Ә?q,bW<?
ͺ UV䟬l!A!KŻ)dĞUjSdтI j8fV,xSW;PУJt,O7G/*BMVbW*D<gi2>.=0omqVM[5ܺ,qG.&*?x![,TW>k/H+ϮXrULƯ+W]^q2gmK7
>ZIk,~AV7(gnt8zLESn:*ya9\&li.fg={ep_.`/36s$-kZUքS&a8qB;Da: ط-xP!^HeJO)Kf'ev	OC$˵m:gHOhLu*kS&T\W|iSR8ʱ[FL=흀)p}brhi{٤'N!n`yQ
+ҙX<}UQJ vLhNy+>O5eM>iY'x(ު&GEgs1pspj4+
g4K9p7s{gPS
ߪOٍr02A존3KzF-9{ֲs%-[&6fgI+%Sug4 %%"^IycQtFRa gm?Ocڰ-Aĳ˞5L$QvT"2ac3:5ň>[J>UfBЧ*ܶ*D:.YXJlT\7kix82,8vR	!	w6	#ʞ=$c37<+{&XfVR!3*ΆWzēpF?.v7"xDJ@mj.$j@!1t#.0(uHyL&ߧqPl{}Y<>IGkOfj P#MW1KMPMEtrjzhtPïön 1<_MC&(X+~h} +&1evvxsgӛ eۦJ
D6\!YY]^M@$T*^'eX*x,')WQQq,<&.]t+WW|E*═0WмJߕabY3kr,#-f˜Tzptpp^Ykj(\TH@m577MYJIYxF2^_xMo?5`}Zh\ۂF0YፗWCa`RqQ}~#(,l.5LIkW(ug3a_#WA7 >K|!edR:n_b#SUD,6>a)P-~ͰOeG[OR:]G[oʼc*^K_y-=Yǿ馹+ia=V线@ߋ`4-:&OE7PVwLۢ7$ƣ"}al-3fna8I%Q0^|JbKp~,7>][mM.X)}W"]">gjPm[9[έZXWFn<6Ćqkan16W+㸱z)΢=fYM٬!`4(/z~bt&>a6B(ش14eM]ZTxfB%RŊяHzK	 ueq2_\' TrEYnZ31sb-vط-1;Aֈ4vZ΍jϱ6|ZK/AIxs0UZ^42F:129vt#ie[TKBnH묛p%ʂ)21r@ i:b8ܾ;cحp|'Cf^vCEY	rs0Z<3{gtÅ2INHɖ,H2/6e*pCWŞaj%@)x49/溛61+JHN:K6D4hY:9MLJ
*뻅ؙ,Y¹N? ##,4oe鱬TVs,$a<rYc+19}l\_3y'__9y]_0aY7T*iDnRy5ƵH{+o!8m*0e
*^+Q~TAD*G?YI2ϛһ$;t'Ϧ*@Ʉd3FxUAMZ3-qW!C-qYb!iohN(8Zϟi:I~5֪d}J.g;p/aRi)zP4ÎןrD!X[,N(ϣÈX#&]^LHaooT.(̴b،B*)m*z@N)E~S d
G_ʍޙgdV  ]	a]5ۤӤL?//ge;cűz1,=?;oZd%NYe9`DF?s(y&N.U/w *^}bS'Nʤ)_'KTΔ&)\,}	FGxqqT`xw/ܸ8McT^0ecm}ny<-&aĸJ쳧]2PI[+bf8Q-[^6^ռ/+ a|f0Op_ygǬ\k͔ʋɍmSOaP
ݔ%:R* AfYGn}My"sύRP.i/\k_qA;oa;d
\J.&@ei}x`INT|j(k-/LU*pd@jhr.>ό.WQb]>a54Oޙb&RpčT{bfyuu,N8ddA>wם /%AT\˫b=g5%\f)*"R6{I{E?,?UF٧Mz盓s+"%$==诈rIYhLm	ZoGDͶdp$}!sV:l{b"/BL<qx"&|UhpRl[ʓYP7XF-xBStwLLW(܄Yvq|M)رPwj`o[bf8-maXF$Ag gSd?ѡ">tgwgowO@ْT@7,)!]l1鈭pʫr(MI-0t[](9P%U+ڔXߘcd<|ȧ#zeRs =|Z,p"[__Wf9B7!L)Ti?a~ӷlP7W+ee㺸<CyQر445aX	Y
 Ȥ\#M88.dԺ|#VYqf,iAPË~̓fY'_i+b;moճqFn;(,\ɟ"⩄dGJ}X&:/,ޠ&woIum9'ɓӅ.b$b=Z!N60O{D$1tȀ$<P}!\,9kAI.$XQIqDCCcSx\4/h&Le%՞s
EbzUyvXRXhő΍j.f,suq(ބxd0,1G#{|.YJR*in:x:JU/5sp2 ֥Pg%`oq'fWTK-] 6b])%C9pUq76KR'A9>edMQS̒iǔٖM6φE(/CºέZƤjRC+};7y}5R
c |$ɫG^%JF[y$RMV<Pj+Yj:^5mP8F5u ܨrRW6xFD\Q6|~GGag,! 0?u#:әGv](E #8
 lUo0Z)sF?kZ5+/ª!f_٪!VIRJ<nN[}as6yM<Zv%Ǟx.pb;~C7iIX]rAq΋>O]	ȧ<6̤秺8¸gV	p,!=wEAe딲(HnOLt(y+B2qtA1rWsUVR_֕L6
%?EiJ(ӿ(N? l@Xfx~wF
)ҼDt7n
R#-WP?n=9pˌ8o}W//ws>	OcWjUQ3\CoK&ۚ[|[sr+(eCOൖsL`5W>CʹQa<:l"x0XeN:e q9GF78~Z;ʽhuNTS[,w{y#VfժџJ-`ՏFk8j@"+=%d*NnXıR<:8{0\Ȓ>F>rl6ٷ#ܸ'wROD .՞+Y˙csSykh	 4F詯[98G큶Co<{ڃzwVҹONŉ;b'[S1[7 R8ys39r_{Gx_&Gs8|p`8}t<#w'|+vv>1D$O<U->a^cT*^|6>- @ҋ8
<9S Եi&N{i6}Nv%#z{x4F.$X~#񝓜yN孃6}IRo8tR:J<ףOI`3r= &GnfՈl 	zb=>%Mg~W|rq%v.=J)D^\
rl~"war}ܑVY{޴;<uyg+D!qg z$c:%7h?!ZY^ǸEK4N*qyeaUF:
ˣ3E>8xz.hg3a3UĊ|g|HiF|]y^霘.S2w>yh1B (
K庈ϻ(mj!tbl%;"28JTNM#@}ͽ`V;+4
!Ea6=gh!1*o:{]gﰲ-,Jl忓㕓#':Oi=IS&8$;|jU7pLw.#^o%aA7TBD2<.lo=s9&0f-.
}	.~rQ<. mhpZs36|6!챭GoI=>NKytXUr k*JjuV_ʪ +L}"r,%NN)K~&þptӝeX+,>uHAzzrs0fZY:lnSyR+:|yOOG4.e)0}H'`;;[㝬*9zel|#f!I=Co6yl%TR`~Ag3?B7;o6Xxrk<	HpPfBOTRd )ދ"Ujt	\ơqWe󸢾fϻAVmRnṡWvҸ$Z&h,`,r_DC9wDLpXzXipd;0D;vع^wl(3alՋ'x""k;	.;r	-\r	3B>X٨Ol}󟧅f'ܝT*SV/K|8R¶LђUrg	oѦʆɴ>__B=4?܎\V/軝jy7Y\*=>: =	|h
F~K2鷌 EAoi7zA57qEMCxj"BIQʔ)_+ Ov:k3CQִ,Gd{EB
hhWiEyoOSu\蹓1y/\0Dgr:/NWpCf1>f u(]½Ə8
őP)Ie9_?dPv"W"9>/7ɢtb">{<LXr,Gd:~4m70CWǂWBUKER'׭'/jn6[gŏF]VUkZXux1?ǂtdax]X;S?,-=|ȶNpi^@\cv-_beI4eQ*uȬB>cڔ0B`<@p85EȆO/2@ٱ@ڄ]ѯdcrzo2<CnKt]VoUmgnxE]H=jI@>¹t|
_,fiYhSsmc":b%03n_̗ȴ~唔|%/GEIk[78	hjKNgaRQ+pJ<'#SZx89yͷOJj]t0dm".y9Gt<mSOj#RCŹL`\0!DUÀ@~zh08wVn9l$P6֫<jҋ!Hi_}߽]Y&3ΛiDKB X2ʠ
>?wAf]1%Q׉qV8
(p")w3d|a>ǒ-[KVUmߪZ<*o|W_.	-ۿh5ְkKm|2fmvl5j}ŕk/0q\*Zڼu?T.a)c_k7] km.1mr_n2aRשX:Ei;ne2:+ۑD+Z0dv\c7ܾYLծ]YG@{Ce*4(0/:5)a
bw<A_L@{SA܋xT-G{Bgn@W֎sZoGk-Bl؅R ?؝=@zG
y~!jZ[ժvUz}/2԰[%{I9TU)Bɗz3H"	"@{a6w{;=_IL_+rh"T{F&[}z{ZD~ =eQM}k5U\`knUk(ڽXk?='m
)z͚CMM^Or>[i?Mf֮-P&=G
PD[rg(Po(%Z~Bu	Ct;?B]7դ"RhVzUjwNu4[Fl7Z{N	-!(d}up}ն591FuNlԫ3L9L)TҾ2FU|t}+//iYog :bs_Z)v^Aw/;N/)?gُ(Nf>B/;<v?p;:ހ)`w@f>:8wowZ|f{n@r:v{vݎZy^tROz:~ !S3"Z)Ay͛|㛃Î+!J_yoK؃%5Kwuɫ?u%ZNo tZv5-TlJak~z_'ܤ<kʻ0^R`oj_;&ӦOOͨg2?}[$04~4t&FI+kT$׳Yea'gK`y^ S?HZbmԫ A5E-ghi4Mknh/R~q6+\a=} +NwX"MǢso6?X|gpɕ
^1=IHDY̋`5^əY癑qsd!#Pnw{?tk_=gn|M,Oo^P4	=R=zhi,Ntd.?|Em-'3*cNo:?y8N9(ˌ,K`jAQ;zRXU^]qIYRn;9*r=pVoef~NxQ檍4c}JdX*WJOO&T?NN]{
__ӱsi~ȿ!2ɷ`7U0w[ֽkM?t^uF&zY2VE5X/kYT7'3e+Ztl[ c)Wu/f?};B2F}-]m5]\"fE mp'>B)+q(.S4
NXd- 	NZd	/tWGRSlfc|?"˘k##ۭ};=y}]|"vJ_zo\:ֳ;wJ_X%)<=YQ2=iuJ^?>]<-zx(3"8nVQ/F(>X)lJ]W) WǃP3}>ػ0;2w_u/q	 N7ds`<MVk>cj)h=#{ 7Ó}zƣ{}@nt>TA_-1̪7173;=M_0i}^6''bVK8ӋJt~p62
-YAh_4 <ԡgcL}

:FMc@)i'`YިVD oXbchSJATmڄ2klvkN46gI#_&lZU'Hk 4]9	B֮OцΑh7kbm^ڔކos"dL"b]-VPkVBL>͉ dnN4B
k VV+lp2$ 2pW*N;329$҅tpbO'QFa4!cfe&=h&~!$UZ('wH]3yg,HU{#?@P<zPz ho_hRI3p3:r7ݡR(<#*jC닯(ɥ&@8xL&EogϽa9hz#ؠE<`_ U
7gq>Θ >t>u	*}q؅ZXL©?|:Lqa~9~TZCw4T1A~F!#iPm&ic:of{DJQOɱP؟UfB{7p&/R#a*=*)(v^>)]jx@Z/	TwfʠrN\*ѽE{AoCй~ѴajΪgf^k4m{.0:!xzmî?V_lWe"SeyXm(Mqzk^o6 ?6*+!ښ(PWjWeiE?ӫ^_1&2L(oصV@cjjsPk֚umznuU[cuj0@vS>F) l65{U[뭺]ت7썆hٵU߰uQZ-*j7%Ub56P- i- q#	zBtiDnmVD*XoZ]m6zްZU
qֱ:g`Pqy=m 
T.UQ jЮ5H^mDZ['ڋ'NkTְ5UuXof۪mF׬C=Xe7 XC<EмX`V~5ħHRtWoS6jA rƺ|7[X#xnA{CR {U5@ZjCqkm{m:#ڐ,T(QOj>W6lB%6*4,pxuQCn4*v
ٰ[-F?k	&~]vmS	

m@k	31~ј.)+n;ifA*pVSr|aqcf$(554AO1e+1З{$sPz~ȿj4A+#?>%8N _@0;z aO|]Դ~#\W{v)ۧnb<:jb.2m }v|^HK=%ZV#q=p<4nm[o?~)?7]fTf3{_{NtwA]ftZ`bhWK˫c"vŜl(`xNM\-_syO3a@w+Iq5#YZe鰄Hx"UY1LvMNM{qNyJ?)M0=0K·#>zğbl+镼1|SG<ϐS{>>ۢo*pfDdtTm4מ6e9&y)Iu#̄晩*%IuXZRl"X8f=\l$t_7y>hA95]|:+w+7'
7<T`U˿/20@1J7q')C4&:{(bNfT\]H\.([?m d|9uj:!/{1m4[7I\x'Xg˟3|-tÇMAs&X+}!wRLs?ː8q3/q|7oÇGץloDԔIB T(cHi"i>\.4
t(_͜'U+30SЍ`rixY#]ŝ]ROʪF2%(UQyr%LSO2I!:pPSޝ+6].T\Z.9鏘{!R0#J"s
9pjs&sP`iE08u ]PdT+l+8^@/e8$R[ͲwJ&o&\JofE/J
d𴲂 Sxf(%1Nvqw)zeRbVĮdf> t{TVFio6LUu.q;' Z ($>륔-@B/UN2E}Cj4djF%ճԾ; e|߅Y-gc:%;g[2PZTop@WOtN1=P݉W(eӴj*OnpH^ěx'kֽr0$`ꔥ5!fd
D1qU%G%9rYqJwc|1q]8xW Ǳ4"ZZUKI޻wg6Q&qjB<CQe1WV \'j~u51++98paC_w3L67ё"I4
s"`O1XeKRNM*J$z&;G!!t-q(`P8Ld0BRks"H"%LJ3Ey"\C7LK:3ϵMvJe`ρ")`uzrWٲҬN:,T3dC\>pLI2BA 1IЍǡϪ)m-2B
5zpORBN T0dꐌ7opbx=j{1VJ9ةM-&t=ezEʦn UOSG$!9S.مЎ1#AJ,s1 gPK7Ky:)¡^J!FN/C[a^(v5ϜLkl4
U'.-G ;$'r	,w4ad~\vDDtk)C(H8X&@3JF1f URƭI@Z,f[Ɉe[>af	k4*l[;f.K$c+hDGA#˲NP(bJf<vrA݁K7"tC_!_RS6>CQp¬*kfŅ60iU,Z͋ST*YSv92HBA(I>XԔ׫+?mM:ܓn&+ͶL/*n0%d[6
$M >pFtG9'h]@	JFet6!q )ʟ$fX"R!%<tM`-#rW/M_s[a0R'x/,3ΰN?EVj(Ԇܼodm<~$]9QjY~Ig  :
8UPanLʿtx,ޟww
SNSvRYӀ.2У*aHT!CŠ@}YTZ }~1k+')H4|:]<|J4T.k<B_(^eE ő$7y~⑯&JLpCb)gE?- 'qt2a
d޲{a,DL dL+pZG֥ڝUNIK|.;yDz		LS*&`؊3*#tg}~rm"gj'pw/L9\Ďj;u0rQՆ[86QMga	2XĠS?7wEDai Z0^YљC4;0ͫ23aʛNTywX~Mr,ZOHÅN&;[9V>Dfm=(JO\6.hd8|&c+I{N~"P`2\WH5C'ѽ9OU.^ܺA{M/1諣1sL#ʹ8[XTyMsQ.]a><NExGae6ZdmZ}mb
aϭ8>\LIkyq- Ʒm\U>|	ӽMQV":Ȅ<~kGuֶBk9}a Z+ktf[4̰\$%!i0L(ę,9hFsGs̅ӑԑS-#;ʋX6R5b2>ZI@nMtWeHf+l!Kt\uݔC+Q 5Ews6x5)&LYfb^Hd)A[^(	oT>V圓GNuv+>ڱڧ\:Z%>z,`2QHj>AY.Bk~m="}ơ^^RT	rC1L4GiX>bRd6`QZ)iq茘RO{ɖNXv)ƽ3ŭuwm\5r63Qdf0_=8JJQlhz*{QÝ#P[	u-L:+Q}uxZ} 뭳Je\`$l#IcS0fg`aX8nD%]av%)(AlYA_F/⋷JSHnwDYQch[\-\月rO\J9dy͂qs>Kc5OpQXz[<O...7S(uzE'S۩er_qN}<I6S,ܗãܾ2B<+ D^jx) >;w3w0:9qLNWX5dheDFK/{q<(V$=k4>_Av/X_č@ㄧX	65vn4^l I**W ln.rP*@%%ʃdSӬ5K]OzUٔˎDr ,aؑfA"7~Xf [N_֔>elyGW?zISw֘^Ay9+?*+Tx˅`S+rW򠳫i8+qՐ0:j :,LW8^éA53+nm龀eE
m@*%A$Ae(\hv)/X/G.: TL	-)W6-͌Ғ5Z߼Wч^͜|Ϡ`k&OE+&+cg+C?ޤNK_4܊ldD6[<We}\^~ޑ6n˯>4#u6 N@VbueIё!RG$k;X3ttfh3j47{w#akA%ϟfw[]3.~goi'y
 ^T--?;
<އa'9˃c?Dԉ69S.96[oU~?k{TBg	tiZz2Q:d:dvXwr*>l(ّ4 *iXaGT:#
G֖5PLuQ&綀pEP-F\v;80`,w\U*`t2ZvfB6K_ɵ&oPL17fU?P~@MUY^M_Aܿ¢:d,rCHZ<qm :F3{o ཎ"#ؖƵkDSAj7jq9C6IbYImRxl{Sw(͠JH:^[.ByF݀j?~:foE⥉14VDqRa_vƮqwpX`U,"mh0x >@Bul Cd&_{H:^Q.µc0#Kajb@1aGhP~&Nns`<qSJ{ȨObṔI~XQz1 $DSoISS&\n\>p!I,$>C}B ,Ya
t~BsrCC@Z\CSD!%D0j*rCxysܥ>+p:/ZFx;C=pߣngK˹U5uԮAtUk%<cd	^B$Ek8o'_4lbu*vcb>MSfťzRe>+ ^Kof?1Xhj!vTbú@YG´Tv\DEa8=$fkL442hFIa F'y|7fy4j>^ ̧L* y[fS"^@,YܣZpG/gdPCn	?t0+Z Dk3'`Ēg}˳s!с7O)9g7(^)2cToޝ>>$=/1*
p523] MQbg}
!~$q]3#j:/47UL1@BsZ7~`\\Vj`+TA*@iq0bQ8fi1VwPGe3&]~b=Ax@ڥ\$ -xݒGd}@ 
V)1C`2ςPozx=6G (:nC]uRNfp|y,kYZ&gV_ŘXD??w^+x5WUIʗWωq&fȗ;l80s7M}؇}؇6*"  