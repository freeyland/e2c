#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 
] r 4/(:dJ{"X$U>:բ:+$(3"+"Kd<<Ύ^`vkKD )Fqp8ޫݗZݦjjVVmWZիZ_/Q섀I},HNN&H~'E/3j5[hܷ]\zքoݪWkp;:FuwqQ_\\6\|Apo藯^G_k{N.!Od@vYZCk87 _)yv?tw޼{}j;\Ebvg<=s?(፽۹=nd;tE~d%ny3CY޹9σx}'vD3GyEa&gl]m?m7jC7W_N0Iʶ0\|7D{=QM;$ŪU~p;֯[?Wm׶>0't3nIE+"vq#O"a#Qtq\S?>e?kƽ__{}?uhwq?:/_[5_o;6(D:5moڙo;vY?Wbv0cl3+ТƽJFX*, u6\zN@}Nݘ^|CPzA/4F..(ΠcA](K~`" _P&]_⿝MUA&CqY?Enbƭ~H2i3"	Fg{or6dIP'Qt`vF1r]{I T(YV_UZ|k`8X`FZUokqx6|tǣFQ{7Ma1TR+mWKƐu3=xy&Qf	AjĻgB#;D@jl0NL/_2I*ng¸$R~t/s	Gw()|/}]?2&t{a?HsDgKK	fʖ?#tO3Bofh.;Qx_{ڨqz7-vn0G>΂Ofc"8O\.(҉w{4[!CΝ.ȶRˮXiJljwD׋\'iy:ikM[INkZbGO %"-"lN`N``rc/VAmf¬A A 1+fP:FUqw=l>S8ARNiyut/;>`	+-+)+G%]?`j-a=TT`?H(6{^<?԰=廼7E	?S'$9)*[~K(A sW}m,xvͷIR|I^Tc1kU;ߵt!Ơk8ȍ;[gҪYlՄ(׎&Tj9ɣQM'CHi1y˽ׇýWovժhͫov?ҨRoa=+-CAyTaRˇ"`NMCT&Tocw-F",1-u@_y:U rmQT4_N'-/p''<#(G/"N)}ٯMG9Q{5R̾Bft.`3wQ{Y>В]>{Π_vkj'A0>
9_d_W\uR·BYvSY҃'ő]V=ˏq.\^){qgɉ&nPuй̐
]AttǓ<q};Re!A۵
'ѷL^Vi 9&LeF=I8T8tGN|VTbQi
B^ffͺG6-]~뙝r}up}fuvXMЇ|@>RjFE+##]ĳn`
G2Y5̡JB|r<X"־.ITTrz[P2{-¹rfqčMH)#7FeH GtvV>;K>w"m'9z_p͇?锤2a/R=ax̻e#f$@u*!xh.-~F*$M#ɰ}>⒖tu.{17D /w"8n~Y	&e0ͦqVt3~%LFD3&0]K7#`J@Xg}}ZXO@^CT {i?-_e~~|;Vaoki@1 4 榣w4 ( ͩ"Sͫ?l_i7rzi)z/<rV	RsN:LNMV8h>1ggvq|a0oQ@V1gUhhs)
my^preu>inK4$_pg DD!ږё3bnޙ㟺}նXa\6#
n:s@̪WKI!kǋͩ^4WWE|P8	gb̲ 6a($ 	,Mbn|.jrz}N6k&&ƥdO/v5({bUu.p%wFHD7GL2?QMG!/YIK1eQ>{E#zØ~8UeYfpY o?r9`J,k]+	;-?їi x磐FIx)=bP 2rt)؛׻^n^Bcvn|	7̢,D{w߳:<Q_)xRZ2L34=¤3y1yfȋ"9Lʈ-FgaWw{7MoBg'D.JơkdH5ʲA$VJam҉B	u6vπq=;ȼɈ7$֐h% PKvz(fDuu4Eւ$(Fؐ/ragb4+S"?WѬo^}sPW:&LaB"j(tdOx5a
*j'Mւ@H5)t|!ѻ	^2zsb"۟I-M/:+|{9e~^g}1?3>It[k@MZ,JK~>Kѧ1Kl
oHG
筴u,r7z@uy/|`y>EJ>^^Hr/)I+ȷг^J֗b/SK.APz@̫$Y8P|GP+b5G;^@/sڴKJ&C|WcIZ.NjZg<g
$>Uf|X+HrLc+cqFy{3NRPϦ1JNc%ڨ
SP'g(JJ]7<]X|guJ:M:KZ2%M'O xCR]K\AO(FyC2V
y%T4J;ď;˵si
FR5ya~"-e˴tnV*ЉcM,4. \fIbPl)IetWQOӪܖ~k@S[Іt;q7ӟ2sx_-Jzi~¿_/|53=?l8$;?Ӥ>c\S1d]Ʌea˔-ƂƲ/Svp$Xt$~tV2}/Ѱp/'3eaNB,VYjD)*ekd0}e6tژh|o0%ݞץ8-zWy9纙paVLnL"۞kcY~ @2LyiMC >C`̕vҜ7Ҟ1$z/mX(f7h}wR-[hiԋoԙw4![hai. +XR\&7d9em\2(")ƭ"d6)KR1uK׺ez{4]GLSx.eɏFi'<f_9URTaiL"Vb1s}5hQ/,8ĵM)8tS8iE=t߬rf=a;
bdKEWT함b?%Q<xJY-;Iv.&MFgzJ&䛆e#?:'u|gYiܾnrwLՒDaje&e	>	vLGH,{#v贤YD(^3JWlV4KQU_;4w[t;%gp\Fy
<?`z|B#L(fVc@RUU&4㑭b^!~ ''Wd>W$ńZ=uh6lҵCf|dqWET7}o^(0T'WV
dA((BZYLuiMw0ͧ+e\Scߦم%7̮L
,6n&yBeĮbn%KʓPNlA:)hIHcBPaH?	aa_2c`5z w`Ȉ0
MQPȳSx\.BBwĮYd$yGe<ӸO݆ٙieƖ5sҊdҕ1t.Sct FX&]DB;Ub)RP<\L ñEm9#b
ΆAaVYh.]8E^vƴtۦq
[BZq`a>`Wr?'"<l}C)9tUT	l-}z2Q34&~܊PAj[S9 p#=T>)-Bk۷+#oc i|9pn*"e?q+qG?l}tQy)c`)!7KrD"~Xz~#!^X^_niIvE~S>7fS8xIYM$"r6Ǚ$Uv_C6Ern6|_^<d1kiαuyx-ΘJ~q%BB)؈Kw'q<<1`1#eZڜ2\\p%m㈞>&6jA^('hO#%⑐B6Fv6<r}/Gq$oaN=!F}崗|+Z?3QϹc?ZqGb!(Gdl6Sp|	R`!|5ArQHzZ>6m@mHy$3y䳄%ScNh/`"T5'JOH`0+`$`dqՏNG*zVxlШ'&C+)arRc22P>]bK;IRp))iiA F5Ab.)FM"@00	fQBUoW	IgAhk{W@ZDw jkI=T(Kf38'M_ӳ]oF aXx߸	i;X^uLQR4|hfQBЋz`݇JƯj
L2Rg@vo+NHǌ+Y+ߞM3i*zQy&V`[ꆘo iK2w)-R4ڠ32{ u	hi9x 3%hc
rݍ09vɞ&:MjNQ@@SDE=[7"f
g.nG;oJ7YlEbo?^0w/V8`ӀE##%p7bz/hj7ڑ&8%0)duT"d49BJRպ7F^\oq3)	1^
_]%MX R\")%b8˒ӈ~!K(xkBV}zcN;fMMAbj=-slNʭ橇s+Rda>8%"AE` 1NO n(4*xOi%<Sl)'Ph3saP,?a[JJ	AG*$a?$BpF"ri 33fot	;䃈9()Ydn'PxƑh^ :>*L8*rR"ԛ'#HIrMZ}KgFcwߎSYj^6fc9auPPOB#	h0'4/+L׵)_
1TZ
ЌY0zTͮaP?-?SIR@0`5::jZC`l!FkXT)?OTsI觉U48+_.Em[T^P8!2Gg-qЖ<jK%ےn%Gn	ح:+Zn%o!o&o7gY,D!%*JD*JDjF*ڲY,C!K$/2C:nr֤ZrG7Gqܭ'wk];k&w^?IRB=WOՓ: " $I(I5IR5'Yy ɚh~WK]EZw{eĚ%-=VM,KZmkMlqK"eB!2@ÓY7[xz=Xy6>F=G?>Ќ\(Lq4|M%v؎VZ>r$_6<!4g41m>$FDzw zO<5`y`ς+yq˲
BPJ^L,S -)>	їL%48xcz5exIq%o:bs\%Td\j˫8ze+wE>S>"CW啰H@9&O=x7[h=pcXSuG\w(
g1<F\yIIQ԰xڙĴsx+û v-wyDޗ	Sk0܇@&\컵
1PKronŸRٹg[*ۊF]`)*+d^mnryff;lKJ-~$qZº2:nSu+݆%t#vЦ@0cՔ9#sn7i6ܛkK=KP,!:̱EL=k'$ކ=4UF1x3Z[s0<6,H^܈-rv{ƠBω!57a4۰8}UFR`g*a3hsl}ɞ_{A'qu':r3Th#@7ӉaQWͭ1Zs0*O'_{$WwbeYI_yFݩϼn}kX%Od+Wf6y?O^N5߉3ڲM:uF(\gW1jQrGs}:	Bow\ieH8%4}ϊøW2P5cA:^DN1;&=?vC<hƣY#WjiЀ&л$v?tV,fJ!MS*-Gdl+\|d+)$ApᆫJ'7voo[,uO,nW7NZ
hAC3 3tQlf7YpVNbj4þMyv@Q<`k\0$7jnw@J5+Ms0ǡM+7]g}ܿ-RZbR0]"r&X,_e0akoAdud~iZ$9 ܂\z\E>oIqhz?&XXs4Y&lWNj@)
s稤 H^ѕXɀ&ͲFԕzߍQs(*M+L:fPESl)L(Qy}{TVwqWn92]h$!3nV7k"Dd} y#SM2|&JT	sEqStCh7R5gsw5MМgYCUnf7NL wuiRƷ;qݩșHE5qjH2ou$FMzꤼhLgД44}olqwzfj4e9s@E%p3/~N_(4Oڼa*6PM\64]5Y(PSK
ϙ(o[ُn!|3ĸB܆_@AyNa{TO$@PS* i7`h|O%Т΄~,oG#1;vAwy@r9G~۠mDV5?$㎱/
ܧcP]EshYW;łNIuzkoy9%ds1zJ77aa.dRAmGE&L(J8>koXc3>x8$V+[%~eIle]!̰9CѥJ`LIڒd^R筆 Vd&PߠJ(QO؂&õ'^/ԑx ӢVe_3/t>VFŋ"o,ZԲ_ޅ:~TX&6B1}/)Ӏlu]@|c2u?܏-cؒ0%:G[R
gY@1e)`8@t& y4	L;1$Y'̌#^d}f̫XtN0/0`l2<,2'b_WшΔqs
}SvIcuᚤOz:~`(r;/1r"\oݛsNRDkX1f,N03+./)`̍2xH.. rRywZy*Ө}$|se U4dRInO __j߼.(hEnԩnXͯ(Kӭ`:mt
.;iO/(*&`'e<T\*)k^bOXez&u6zEFXSXftU:@ƣӂ\EhLʏܢHDζ20Z*ãnSqmPx}Ht*./-FҔN2'3p#3NpXw_ߪ$<ǃz*Fbcqe L!@xKO)b>Dtd>QaOzLM=4PFӁrz=;gbI=H0G#G!8Bswà?Y쓖Wu.&A:V%,鉥tU9wun[Yξ~ռs;ڼ`#/|d^(RDvmȢ?`MB1":|9:w>\ʃ(,ߎoisɠ;I}"fן.^5uIUw+6YͰ%cz5{䎎5W/G||JЉt؁^`M?/ɉLgʛ*0ڌ4
(+Lϲ|br	NDM-{/P%2Wa"}A`2` #ɷ?_
@o=>NB`}o5W̤ K<XmSrwT7J|egn=Ub:F3`	K a-ZȜ5Sb.ω:eqkѭLȄ{_Lqn17)2wy;6'w묍cV96G9އ(.咯e=f2'\R6>(kISdS߰=Gj6tOzD@U!'+[yW~ԭ;bvhyoy,O`0c5XUCq{@oub(QR%:_GhBe$3لsA+}e/URP"`D_TUf4y64M	.M>oVM[E3qgJ&*{![,T k/$I+ϮXrULƯ+3]^q2mK7
'>ZI.y,AVw`guhieGe;F߁J^+nN0oƭA	{Yo:v;ŗج+g?	'FytV5`X'2	Ef,3Xν>>a**$E¹W!FY.RSJD7&h3?8owyrgN<	aG?|񛉿1_ZrgzXvBj(S$f{'$u \=\+Z|6	Dx
 X^
t0c_GFF<W؋O,cQMguSüOAtX	jI"hU\L\a.e;M7_mB%MRNΜ!jT<Bj/gkvyǷzL~(L"QΞ\i|A˖Y IT@ %xnp.fWR8y=T=ktE6lKGj&|lEe#g{-2I"!,L\\M1⬢ϖRV"i
J0Kr{F=2n"PN,TBH,gBu7u<2HڲghI*)tLe'*	<e0ČȌoYL6(D\fd.+ (IЍpGn 13|zղe6 ,E?a@QwTD7]/)zZrv9B5qѰ驰O~_/K@b`	S`pYtbS֐}gG/Ϙ.M2|~oID"*.Y̐,.o {OEs2,L<B튔+(O8rG"/L:ȫO}x|z?"JH+Mh^Jʰbi15nLΐrWW3OeBx[=;8r8/H,55ziyV*nL$:&O"n%@	z,</P&?-45
wmA#Ȭ(KSW0[,(>?VLyz6AHN$e+0˯˫`@ؿ2p2KEqAumt/1J)	Vhb|NŰWRKhv fXȄTi+W#y͈m
(s)_J#طRMe-?J%<䞬_tܕմY+s_G$E0tȓ"(;fmQQA0`30dؤdfeXo%9?hܭ6{Ȧ}zESܔi.rzZh(-|qV-+#7kbøz櫕qXxAgQp_JQLlD|{kp՗z=?1n}~0}!lژr<2.-i<b	bG$=IRW :H28Z/ēEt*Z9X,B-Й:1oXhۖc
	ڠ}kDn2<-qSt>ץ$9*-
vEexm2-*gU!7uqDXeAK9Q Kd
ZYG1An_1KU8!U/`S,N9-=3K
$'$ZdKt$28㡫b߰o@<{sMz{P%K'H"nl,AL&v&%fL
J߬o\'ӟfihah7燲x\V*9y0p>v޼ƣb|~wW尬	*EDH[<eSZ=TH{Ɖ6i2{_Kjb?(GxӬ$[M]gSldB{#<GC* SQݎ&aVͫ!M^,ܷtX'xVYtϴA$kAk{]>NwM=(waǋSt	g˚ywK-eG0Q"ff.NH&~07X*fZ1|lF!?ܷ`C"pI)T@Xu#/NLVC@p+S Ao.c脰.miR泲X{l7-KrAYe9`DF?s(y&N.U/w *^}bS'Nʤ)_'KTΔ&)\,}	FGxsqT`xw/ܸ8McT^0ecm}ny<-&aĸJ쳧]2PI[+bf8Q-[^6^ռ/+ a|f0Op_ygǬ\k͔ʋɍmSOaP
ݔ%:R* AfYGn}My"sύRP.i/\k_qA;oa;d
\J.&@ei}x`INT|j(k-/LU*pd@jhr.>ό.WQb]>a54Oޙb&RpčT{bfyuu,N8ddA>wם /%AT\˫b=g5%\f)*"R6{I{E?,?UF٧Mz盓s+"%$==诈rIYhLm	ZoGDͶdp$}!sV:m{b"/BL<qx"&|UhpRl[ʓYP7XF-xBStwhPLW(܄Yvq|M)ر^wj`o[bf8-maXF$Ag gSd?ѩ">thwgowO@ْT@7,))]l1鈭pʫr(MI-0t[](9P%U+ڔXߘcd<|ȧ#zeRs =|Z,p"[__Wf9B7!L)Ti?a~ӷlP7W+ee㺸<CyQر445aX	Y
 Ȥ\#M88.dԺ|#VYqf,iAPË~̓fY'_i+b;moճqFn;(,\ɟ"⩄dGJ}X&:/,ޠ&woIum9'ɓӅ.b$b=Z!N60O{D$1tȀ$<P}!\,9kAI.$XQIqDCCcSx\4/h&Le%՞s
EbzUyvXRXhő΍j.f,suq(ބxd0,1G#{|.YJR*in:x:JU/5sp2 ֥Pg%`oq'fWTK-] 6b])%C9pUq76KR'A9>edMQS̒iǔٖM6φE(/CºέZƤjRC+};7y}5R
c |$ɫG^%JF[y$RMV<Pj+Yj:^5mP8F5u ܨrRW6xFD\Q6|~GGag,! 0?u#:әGv](E #8
 lUo0Z)sF?kZ5+/ª!f_٪!VIRJ<nN[}as6yM<Zv%Ǟx.pb;~C7iIX]rAq΋>O]	ȧ<6̤秺8¸gV	p,!=wEAe딲(HnOLt(y+B2qtA1rWsUVR_֕L6
%?EiJ(ӿ(N? l@Xfx~wF
)ҼDt7n
R#-WP?n=9pˌ8o}W//ws>	OcWjUQ3\CoK&ۚ[|[sr+(eCOൖsL`5W>CʹQa<:l"x0XeN:e q9GF78~Z;ʽhuNTS[,w{y#VfU?3ZՍ8Vq94/EҋW Sz0KT⍱c4xupa%5%}T|@gmloGwqO柈&7 ]$˫='V3R&4h*l7S_c$rpmc߇nysKܵO9gwnO(cTo@򍧃=p8:	_g$~s߿L. qp<
 y2IF
NW|b>KIx[<}νZ̩TNl|[+&qxrTAkSL9%>\9lJF8if]Hܱ;F*;'9q+[m(=Gq@u[y35tCGGgQ{~L̪y@:z|RK&-?&.J쨓G]
{nCS$(T3y'jehE\}#E)iU#vy@'x	0mWB6@$	yHDiCtBKn<C
`q닖8iǝTxcdˬUtGg^}p\Πgg$ 6#|Ү:O+/kýP91_\Чdu7}t9bZU&APX6u-wQ01BiԫtoKvEep$F0Y/{,Fv6VhJ}39B#JߋlzF%B&c4>+UtvA^cͻae[Y$%@6$Y'o+'uGNu0Y+{_MpHvԪn	\FlJ8ÂnHN2-eny\޲{rL`0c[<\J\vy\\9ZtflhlBXc[!u{}Ыnk0UJ߻R]AZ5UrWLCA.E!4CDYJ0.y?-S&.M85}j_	;˰VX|⑂2|	]aF͂w7+xiu2g-Vt'۟Rh]V^8.<Sba'ON#756vv\+%E;Y}U&s,FB4!"q{ȯ&Cm1TJ%/g.-iՅ 6܇ovl2
GvyN̄:wy"fyARE03IC㮾	qE}͞w
)sCcw{/퐛)qH,9G%LXX^很tes,D-Fs#Ӑva0(<$:'1v+\=sQfl/ɛO9EbEv'$];w-[tg@|(Qk	/bm_?O'?|qGY:O1@;xUP:^pm%q/QC䎻t;!;97
ߢMAӕmi!}2΅z&Ah~hQ/@'^w;))	nD7.UzE}uF{֧>,\"
?a5?}%cdoAN_	Ao|7>kToDrG.镕){SV@u\/=`giKYd	lˋ8ЮҊhAIiޞ$s'b_`_pQuZ'._"/b}PhJQ{q#_RrNȠd䉯EEr|^ oEDX'}xYXtho`4.ܯI믆6N[q/jn6[gŏF]VUkZXux1Ntǂtdax]X;S?,-=|ȶNpWx\cv[dFFUC#uh҂Kcڳ0B`<@p1{2O/2`ѪLAqٝ@acrzo2<CnKt]VoUmL>".9l\y$WN~\BN:bWY!!&mV7\ۘHJ'"W|Ѿ /c7(i~G}?>9Ef)Bm&Uk"2jhi|@Y
֪_-ԴXk).s7tSPM=EdJ2;Ap|	GbGoD`p7r҅ŵIסlǫ˽WK˩y9C<D\Ҿx?{$Lf
 J}7d9FA00fdAie	|~O2̺H%[%Jw-yq
P~Df |~%NZ|8Z?8W[vڂUxT\1Yx3s\ka74eVj԰kk+_`8Uhzy?~w?3w?<SƔnH ͵..t\bry4pAd ,¤sS?M^sދ6@#t^W2:+ۑD+OW0dv\c7ܾYLe$! G@{Ce*&(0/:5):`
bw<3_sҽLc~@{SA܋xP-G{3gn8P֎sZoGk-Bl؅R ?؝=@zG
y!w\Z[ժvUz}/$԰[%I9T(Bɗy3H"	"@{a.w{;o=_IL_+rd"T{FT]zlZD~^=eQM}k5U\`knUk(ڽXk?=Fm
|):͚CMM^Or>[i?Mf֮-P&=ҊPD[r$nWn %|"lSr	Ct;?B]7դ"RhVUjwNu4[Fl7Z{N	-!(d}up}ն591FuNlԫ3L9L)TҾ2FU|t}+//iYog :/-[; ?{Gm'p3vؗ@ߝoΔ{O W3n7;cH|r  ynOw;ýWnGDv/?DM)꧃?ln}u)-ia>MZWzaG~I%nˎRԒ%;{:@{uv캒wokNj:-*v:q?}{QK|qRnRQt{]S?/0M7jtF~]iϧfT3֟dLb?R?:Ty$ݕ5MK٬0Gazj3EͥXW0<Xayq[O~T /)~-6U ?"Kb|NFCŴۦf74^)s?8@cocw\;^a[QߦS9oqwF?#]}DPf~Y/a`$}$ENAJ\8Jy}SZwog:5Я`ƌ37sx&7H(v脞e=4Iܴpx':W2fǱI:bՏ|XYx<|A,eFH
`iߨ=G)~(.U˸$xZRFvr7TOݸ8m_2zz'?<ȠUsFd>jjcDN2jȫJFߧ'ukxZzU'j~'׌R/XMvSڹ4F]Tw|*C؋bV]F^5I˦s:/r:WI,X׋Ma?t|H"J՚oZ,q瓙2se`\QO-:[VPV>˝\I8h!\pӮ..D"w\~OBRF8Z)eYmyj5Yiz@w"ݴUdTz"?X3_O)2&v~Ngvlva?_z?H뗞/?lƎһzI|x>O~Vo(A:sϽ@D%hp҅׏:}5O0f۩nVG1ɕy-E{` 0@ T8dgO '.ŗxKEug.70hܧ4fڣOڮw
zňD^0M$=>=QCms=>g P}7
[ac`:
O@sǁ{y aɘMfÙ띞Ŧ/4>FuU͓db~1%RE%:?}i8xMcnQgO^٬p/vVг1
C&>YiM~Z] Fo0|So[N["z~7Zkق@m)zq  Ս[MAXmB56Y]gi['zX3z뤑QhYժiӜVkקhCHA5h6L{mJFoM92p&_[V5 Q&ڎDvk27kk'!5 UZOPU^h68
@ v+RvL'MF\:R8(#0x1]ulMVOX4tpYN;OsI伳y`П`H@a=t(NzGi/Bg4UϏfl9~ԛPJcFZ}
OE5HJN ^VT<&UǢϷ3N0DМ`4r=AzuZc~lТY~q*nNC׳8	gL _FX]B8t|PBhB-,&Txkc&80??*rdPaZ;oMW swll?46[1TSK7="QLCw`LXYE(*|zbs8QSKj̑߰YtJ
;/ה`.	5V<xc	VJB,띙2S>.Jto䞻~P>t.6~)j4mYٰF^k-N3^۰Ə?UHT<pxmV[/JrSܫZכ3O"J_zf?
ԕUYZqj4_LLJv&k5#بvԚvfA]k^alnXcm ЬݔO5D
4 k^}e|jzn@{a5Zvf7vujTVuM&svn"Xͺ-|5xZo' Fm0]k0kkĢlcc'Q
7֛VaW^7V@u٨5T\"0tOas,B5Keln7@)w <Gm(gRW0A։0m5,Azn~vٶj-5Pn VgjO:4/خU._>6il4۔Z+.Mhutސi,z5^Uc:нֳPF^[Ƕ9Cfu6E*mlSڀM,no4P:M
'?mԐz݆B6VxQ|¦i!Gߠi׫ź][T®B67Z0yL"c4K
yNrmptP<_X|v>Fɠ JeM`fyPSyeJG8E0%(ܠZ%`ȏH7z+Oa	΂@`>1 ^7?g|%2m59C0ժ^n?NZ.gc˧La[~,@_RvɷVH(ph*\C%_[_*7f~.A/Udf̞^--]PCY!-O/ЮWdE9Q!puZ^)cgӯ@w+Ii5#YZ{e鰄Hx"UY1LvMNM{qNyJ?)M0=0K·#>zğbl+镼1|SG<ϐS{>>ۢo*pfDdtTm4מ6e9&y)Iu#̄晩*%IuXZRl"X8f=\l$t_7y>hA95]|:+w+7'
7<T`U˿/]RO٘oDǸ!@Ipq=Qm1'3*.׮Wi$Z^.؇I2y>@:5u|	I=6CY-ƛqQmϙFgn:!&9畾{^ǐ)eH8y8igy䆷ãu67"Gj$!o l*H1~4aQ.O	YYQfGʪV)cF09ʴ	,ؑ®~~r]{K.)'eU#pPªF(<o9E`d)'L8sYI.Q~Wa*d-G̅)R%jܜIvg5ٹD9Gb04Ѝ":.p(V*keQi/텏Q__Ghsfك;?Uf_7I.7%2DExZYA )<e@UM'rȸ;w
^2d)+TbWWey23a:M=P*|#մ7@TqA*:S	Jm-DRʀq @J@'5a2Jr#Ynj_Νwb2}u{|I=?NL8+g۱;%!pwS?󸆮&ELDTAwJ4kJCc-5W&&(Fu'38Lbh	:eiM! Q:bf\bQxgVG!j/mܢz^ q9{Vv0,FUR>#kv\OPG#dY!hm̕&׉_]Ma?~JF{/:%mg $1:G]=MtfRzA2>BSE=EYŒTS!=~?I:Q킵A]KJ;.9T )5Y<Z31H	ceǵҌCQ^Ȩ4Wlllǒ%m&8smӪ]Rs`hp&Gw<E
XAUf4k:!%/O:zfF%5S*"kP?:H_}0tqj;z[K0BdlTP3'3̇#?:$͛!7;4^b-vBSIx ]OY&'^Q@dQ&9ImΔKv2A̢qvTҍ{N~p1sV<?o8yM3':0MfBՉ}"~~?Ȏ5ɉpK<M{#98=]8Q]3Z
%R#N-)VI ХL_nLHqk%KYiGVu2kY֫OXxjJV97pf兽 R07
Qdo a%<cPw͡h2WPA0wvs
3sywpYq17sZ 74K>-wUJ֔cPzFfJe}$4)5J_[C6jCN(dy	Ċ}-4Ӌۧ@ &LI ٖbn?ISe-ϺD!]Q	C=dQ*MHn5H
g|w=ɪV3¾Tq	@l{)숪UEלƖ1pc}$	0K7K723,OQ'
a)17ﬥ?Eĭ_@:	E״xN0`ֳ_RH%ΧNUpT/.Kݝn>'ƂǬӫ]sT4 3f*J1Uh1+m/t߁_GfIx4R#ߩNW5Ģ%:WYsÃtQF@q$r躟x䫉qx>f-XʆYO5I4Ln!^8909-{9
֑uivg|N^f ^{&I;"z_&\`I/<݋''0(z:)F0r} N]?f9nTo0A0d73xYE"&1Fƍ]%Q`FcHVun>WVt%LꭌF_XU޼V_"i*e ҼpɎ0se7vN&,Q#"q[Oke2&/"7qwnJҞ+)3<߷H!t%>R<Gm*/	/+t/{gSK5nТ멾`SKm.*H3-9V¾@Uk\K}-zτ317zrXYMm+YۇsF=DدAs+0:SZg^|o:|~w<m`U_taGTै2'BiQt]j~-Z()q߬|r?@g(V+d3,}IHl !
q&K**,9\ќ st$uTȎ"MTXf>턏fR>7>CeU=y
[.:p.@b7evJsaݜ^A)Sلzme,~gc4xJЖ$4
AwUU9)wa슏vh0VO04XL7RZgàO{P3G䭺)ZE[OHqhUBe=#P+'aQZ֢mBX0l0"Msr9XVJZE:#Ta%']qLqk]][k/dMLpc:$z;p,Zn/Ac^
n^CyGp%BB]5:ӠCJT9z_VzRY)GeG<&Hsٙ6XVD:8Q'c}WXs`hI
C[VЗы-Qyo!+'9'RY`b^f\!ǒXF3\$n=~"pdOz꓋'EmC	v$AWSd`j=%8(<PE;
 Ѹ׃9^J!ώ~]~N|ptb"oC?cpM G+Y-&Zǥ&(`܇.(J,/I/xkWк&q#82V·M7:H?
H'z1"5壘8tII04kRWS0cU6:7Kq vY@P3Hg 58|B^juy,^ݰ5&W)a@P^N
opmCJ
+Cr!
ܕ<|uJ|5;xu5y+4 ? (" AWp*yPL
[fE/ {uan$BEIlqFl
0g}VˑN5*eBKķMK3#?=2C7W3'< _0.w3h{!<&IA@SJ",ؙO7k?/QƴM:]_kTkv\*#m>_!}h Ǳ#z`8EZIԕ%EG6wDL9gF1}9LLn\DCxϝY\3ۍv3g]t=OXVAī]aмghJNџ3̙9<J"rOOc+ໄe.=Q=r~&[kUn?+|{ޔB_h\x2Q:d*dfLq*52,.KR?)܏t4EGޔCyez9LꥊUޠQ$ާcwJ']X0`,w\U`ote."l! ^p%goɵE[;Ԃ:M3Kͺ^oTvYKGWSw0("KRV$U8vI	ew^Aq߽"uДÚkDSV Q`jP!$q<IeRxk{R7(![+"[Աos@z;uwgmv;>mHW'7$yCS܆8}'4{G%OFA/Hb#oӌGBn3ݑ1$̾dxtm vyCq+	vVǚvZo?kpkLRÁ!05rB@1agh
P~&VȾ%x(C-5	㗘$PĠ2nb HZM܀CLS~B(Y8I|-V+w	@HTJ(d}4,g2S!MV  mTJ b$A4. Q"w	W\>]Nu?;Eh?|0=?NPuÙsbn*x6 RS5mƘq:_| d{n$?HŨu@WNyyLctͥq̌XM* ̦9p)B5?$\Ԏ*R w\Q 0B6DTHjcҨWX9ОWI!b${)gs1J={!d&T?
x6d2
wEv&9d3Kw$=l3R&D儂U'v^tbI>BۀDXCާhzA@D{/ބ0lM_Xa^x<x..m@ܦ(1gn9lrXs(aU3-#f257ŕjMFA Xf!9eu-+^Cg?0ƏB@GՋ0@ 81{1ӑtu#RmٌIq_X+v1	@!>%ϵ_ڌ6 `TuLJ=kyj][u@ 	P:uZ5RVfXVL<Nœ7%c;c~f??%l+ؚK ҫĜ83o&@&!!O  