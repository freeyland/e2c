#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vH(دïHӪhtJ$޵-oDB$@*K{30gΜa\`f֚_2@&En"Kddddddd=jOV[m}v:YkxXn*|XE$@9݁z zD?cGK 	40vy?wG7b$o5j񿋇_fv???۝񿋇/(,>-x?wO~~ehj7|6 Vk7hAoMXˁ>߾$?Շ:KI X{ȉ~㯮GiZW}fv'3F~!9f9f3A,X:Vu~5t`xF9S7,=d}N8#v#zaXJ'؂c~o/dr.+/nݦҟ5aCfzBna P2r dv~O	I@q]lg91@kCSx(	iŀfnDU9vP=p%QaJ٪*폿O;F[lcoWi_mz~?doqxx>L.{_>q	ϨTz9>Sۘ<Z)6 ~ާoTmjbFcv#hdÈ7oͯޱw`}1%2/h!abTu}e{83ܓ W[rאַpnv:.ȉNK%~eKz'`^1PӔrYl?mGGjpu;e7b߀Ed8`~۟63Ŭ^:Jۧ
v愾p9Gv-^dsC'~:a_+ӱנL^ۦ-ۤ[2;} amMUJjl/VeiP5A4\CȋG]nRgY kRMIU6漐Ak*vy%070Hf+Z$'atK+A\ Z}cV^RrVm@Z2{e:eeA`"U)Ym:pϪd8dcz^n\$|M0R&d]q4gT$Uf|S|!*3WMl|Xʸ$?,1Ř5Ʈ7ߵ|2"!& k/x͑Kvc/ۍzy&`ۄJX-'ig`T=ِ%p}a^^oZMʹޏZ5bjw?lov7~rO]l)ò`Cjyv"(kZyenW]ҿ8@$b.΍ 9q'fq 7(nr!\1SyH)]c)ܳ?K*3g@l]kÚ\a{E\V/+nw_7Yph}|=ԯLoc.U+I$ a)+or&d;='Lą%¿|nEqLxǰL.}+D>]If A,3E@8]@~ "&H csᙫI8썝tJ^{*T៻ 886nQ'fׯK|FMܸp1Y.(ۯ6v7~ܨmԯ8 +	Zs+tRo|!81}+c+mۭ1؇:LzA64vbB z\Cz=)_}fUO*Qa9f$Oq,Q\<79oo|q,Tc0#Y0сw9M7(y1M&0Gkr;>DЋ\OX4lJYp/s($hy-/}~\<*;`*X>\ƇqY˺V<+f.J%	 ow+HNbVD.~;l&q΂iiƵW!i3B1;P|'_sC/9G_o [!1NiZ\
xΛUͬ¯s^|_؅ϪdxQA{/vgU)/{ovUɶ3
n&z;<7r鄀]ɅC/<\EYyυ%e7]%R&l|)v@&0Ufwq|0oq!@]hc-A;0ps` #6`pGg? >՜AxQ(.X8}w3TDDßNб3bn㟸ԱXaR12n:uNgpäRR@!FpCz>#\bNn-jᯧU,ʢK%:__w;Ge!*ө٭Iy)Y3޻=M3Ƿ{/o^ll~3\d4!A!OzcQK|SY3{GpUKá
˲߈?{=0yRM5F_hꍗ˚i!x#Fȉyh(Z{X9W?*}@'`dV_|j-
mu+.rrT}r{QG>˅5k,Ͱ̖IwLR9<O,s"P[1dKYINTMulTȹ{T$t蚔xdZ]2j940ĿiZ[:ݡG
*\(o9>#]3 F<=+Tn06$Z;F9:"iA~c<Ϸ
Y9e3)Z=YK+V`yi7ٯ }WOSVM5$˄D֔U"[ĒK;S@Q'T B!,O;1g98tJ4蔮v-}'=yßm7hp&vGD0m&$iX*mUKsֲ!Q /_Y[ƟЃ)1%wR{QwZhK-8ῶ^$;E@I0v
3k4Rrvd{I;i
I+*&cfT"?ν:'jx^^pauhKCTmhřk5nhImXfgq*U&eþ\BxUj<9L'>Z_;aa$9qqYzm*sGZBrCb81<EVR-9/@k'IevFRu4{O2$%%$`*a)0Ǭ'OKKKs)PT/.0qlaPwsOj%]J׬&%]cv-+	M
hE|:( 7W؀34#MZs`f["ߍU4Ӵn7_fך5i{hbS]xד2X6݂M4BB	^~Uap{~,.qiIw~-Mɮ|c\SdY˅mei[,m{S_8i~;pIu2̽Dտ`W씅f'ҥت,&K](GeVl5{Vd,FSP8(vuncA~Wɫ)j_ 	nDv}
>"[(?dׁ;:>E9Ua˸X_..\L1='y-9KK4*ŹKY
#&s0#,E.
JʘLl7쵍eq"x#v\"~F\Օ/r ױ[#ޯG+KK#F$28f@_%RPn,HaiD"˖cϟWW#:1>%U3͒^Z}G͕(U\ɜ'k"ˀ]a[l\pUGU~wX={eXyɕdUt<p#O)dPC}p }}#6v؛/U\lJoG076;WeH03

_;2'd#ZUVftu*iyn#g5Y}w~A2/pMg{/;[wo{{ݲ3<w.<dZagA0DS <RJhvt;rxoSmC3)ʈr||I7C|EtGQMzj}c)
.}\eR<y?4胐d6RDAʊ']fJ_Hj{i1Y)c6+Uf~	f(^)j3Q."hB(]Q lq+9Lr-6<P
Ȣ,,tQXdM2,<"{5e0+oC)IQk4nMvra:l7gchhE4bsV&D@bW8oͨMu?LF	$VPg]Qo`1l4ŮWY{IYwFthp
&kZq`>`gDW&'lk}}LU\T)d-y2fQ1<&z܌aA<"~"eS6<TrCJQtlP:q:x \<7IAiށrßM&VLGbtt)'kAU&.G7'|a1`E!#I1IKFd"ДUKi=|2]e7(wr7qȟ@qf-ɕѐ-jP`QeVk~EP/(t,7]=n7Ȗ SRm8	 hx
Pf|HJ$}we$OKS:jn#yr.tƗFm_֋d@@} eRn/\xs6S:K+t0	@wxn]2B$e94E+J,H$faP<~=Cj,m/'c.ZA/j>*fH%)q\?՘ip#y~>KH[27f &ZUKBW!3%/WD)1яI=r9cyEZktIAyDgɅK|
Hw	-!IGiL#TP3$ʐb,B$
4\wI':,lv?@ t{\VDEʌ>,Z7	i[7Gt@0#,78oߦն7p{4y=ۀ>Z¡!rH:i4!%)ViZ*EoEw13~oRx4v9['CLT~ߟۺJ[CB%t Ǌ7E804h!FY܊3:aFp}&uLRq7k;̉pR=w@41tiR3z0'I5Ix(/mD({%njGw
ۦyDQF(-e".}n	6TyOIN
wGJ+Ttgԓ-TU-+^IA$ +=ʤ%U+O1H3ΤQz'dx"{il~yUڄV8uŅ+OH,;K fTsZĴS9x!L1fMS
2c#snB7o=;B=|#;St/4*;0g *=D0$@@Ҡ
WA-hȔX$E!R
mnj4얰7,`K\ <hzAC%{i#@Θ|QDR`="BL2@N70(i9Bn@&s>6(8Q`JX'yP)^o9_IWJ"kۃF._hOTݝڧӼHZEԂxJ-B_VCe6eSSqj>K@ "zV':F9hh}5$mFUJђV)Z*aXR٢#8=8Qyh:
h(VMāʷFZa7Ep0a?϶lO:J.G5ybKG~i/-)4䗺b~]Fd	قl _|jIk&Ik&	klE6"ېMdI)V; nqzoAL|]O%Vo[+L5
OHk$5>4
Eԓ,,$K͜eoYVo[~>#덝̴,ļ`:oI4tNR2$eYbAh7qčLR4"sе)krn觼r;F> h#EGnanQlVhSof[Lʥgl2gβ=)};Dw1ẢXC[gz&/(^ETG]UÇTY( 2óD%eʴ$GPJc*
y)Wo̯zk5\ V6.'\U\z2rgjS5L}2]Q]Ou.ԧIH$pZ7Gf'Q7\[xr#.enx;FXKiYfapVڝ'sKCڵa䧅O&FB4P	)nxn-K.s)7"\)ܓ-=_lX}ΰt7fv;dKJ)fɕ#2-!]S{)܊l9~]=1PĀr' 0f˚̥\sYh:I- 	0GYB	yhkFFuOha@9O 
&$H^RE9==aPD!G&aTN__T
Cl6G6zLkO6P)e>zKOtfѢG/@Z0ķQW-F{
-\y@qછ1,$0A!F$	>y`N}swętW4	"]y3)M/~>'becaü^F㏵Eyή^Ԝs2|?y;ܼ2o|]#ʝDi-xmJ2qn]|C7Wj=au[waX;^D	Z7&=?vCxbx^*]7Z#`d1.O1%[4Jɣe,$yK+D̝Mvɜl3dq0peVZЁGS`|-F0@`uu<Z`cyEw8XOjO45N4T8/{[6TSRz݆ޤrQ-S,j5Eem[>{koa`q=\$  xFx~~g\Ԋ>mn}gE'~8.:
VUF-ZOrb/m2W\!/ϚJ͚%9.+%فb/01jLZf@SS*ڨmԅXN}BўG:a&oٴno5C4kYv\/	d5E0+Te ÂW}%_mn_I;jT(b&/q=Ns*{UM-CjRm~*9VkД|O>`5[dMaz/\ۀ5sgLr\GW7xNsYyh|_F7$TK݅/`*w!՟:),
Q (?)Ψyh{ZO8}ߠHRQd&4sAfCޒ2vU^\W q)mF2:ިVǓ#l'Ȋt%P_LNf>۸QP9H0گ߄˨PG劵ǎ>l\hfrܶxUce~_AYgp 4cfg}kkJsB-V>2ubG.\_NQMrarp2*a ]JX=9)xU{0L2wRWUYV+"d	bxqVI~Wo!}+bȌmqG3a%m՘NGj|dۄnQQ1ܝ+^Woo_R
K(:A?{a.]|B=O^řn˝*?8*Qo8gs%Wӊe+yY24:;LsѡLZnm* /[ld.{#W?yo B<buyk*CǏz4Uo yzܱJi%yo1)T]غhLqpPa7#p	ּ_4J}t/B#!pI9D.r	ÝFcT͵i+ؤ!g
Mː׷Cwb00&ES1}IH
aF`]ӄRx\l`Di@6./,1%Wa-x=U	%/*ѹdbmu!'a/w6rx]ohZNDN.aC"k'oG*UzA[ w%6縁4il^_oNc1ޱnٽ
kI{5牛/OZz@}[<zhڏ,؆:wAw(6aBh4l<weVG}/&rk	oSnr^ox_oԕٿZW!YW@?B+`*j*$l:6J q<DUۦ<XU%q2G+NV +i1Fa_ZGSu>=@[4t1#Q_x ʘԐVZqoUz]p-d<2>SŸAQECcrD85`#;pX\'m-8fJƝSɤ F<㼍
[YcVoXi*$x=ՔڀZPJ^Cf0uc?WOlncљU)*ii}ݪӅ-7Z?o<MAm6htiB'Q&1j$5eJ#=T'rDP0Ht$-߀cS&. )5_Ra諑MEԧ+iilj&DA-b@$dNu'<_ڋsTՖ+wpbDWUHVc(,C

ˀ_iVqh6keZϳM]Lâyd939-e>95U~kfDr/05*I0vܜaюs]A)oM\-2Cu=+ogS/@r<]ie9lSf>"[a:طA(]Hv>HeʹW)΋#*c4SWMu}2^lSlß!;"ÝKb!-PCb;epkaNRGWBH	efsKҧǰ+IG3@5\W7Y*]'xEnREiu+yDixez6hrBeGP40*m
t6Z|7ɤIKڧř+Gg4K=qȞa|ujNP&>ln>ϴveAk5$7/mמZGZ{(,ȢV^Lx ; >I{"(PjKNس<G'{6u϶ZZ{ִW3#\+jT ʸTa(I
'}ZOUh(tX?}Ш^7p2Pp8nhS!
P0?	ԕG=C}H\j;`W6jw Vr$*Wmj&}d/ӇMصpa+Q.&w(8NgE=J&1r#\.0(+#W+TO}hXc㗫u@~tnd. EQezkOL"i@cg0]]f ]bWo&m;U
bSQRo~DnWj~ICH
ݩĝm<#[]YZIS{WF+
F_h$aR\bb?=y4L=UĪuɬ.?ܣDKa.5yrKÊ fֹ2	?$!-./p+ԗ5cXjPlũEkM1e,>3tHARvgaj-MA,?>}t6bW`h[᣻'@&,M\dyJ'<>Eo'6ryXdLψS0 ?쿕6r2OD:Efob#SUD,>e)/PZwd+u+g|k>v䁒69-no+Ts5WYd7Btd_Lt̕ռY*S߆ 8-mz3`Vw̍"2Dƣ"}am-ÒSfaI!Q̱^r>J{\_OOiV=-=fE,3̔mΑrr͖Fh)펭#|uF##^búuk[n6,+qRby})V1ѳy}jQT_5D o-XCŕ65iQUNHe+F;"iI",&x8tQs}jZznl|~VLS(p]ܪccrpuc@,m>SL>m֥Ƞļy5%kiE8(-HhCvь絅-:gvS%3Uqz%	VS)g4bd0w,Ҟ*tf]r~w+p[/MUKfȾGtJ9ߣ8#yy!ELM8ŖL΂d6v" ax3WtgY~UD:p(_FlfRPE-l@ԝi^`_B9-dӼ!->'$D#O"G&kl9&cϟWW(<WW1&ݝOF^WWrXj"a׫V2Lظwa-W=$qSkY%UGU9zX#*3})rtRlMhH627xx9Xd&Ⱥ45ޭ }.$vHӠ[\Xs./D1Q=.LԙU+V/eSv9;{WťAyd;=ALmZ,ЊDE3|+j3zyS+UBj1kO!r1Yc3)L>ϋ*:dTXU&c)NT.V蒯i$?Aȿ\Xj)]Y5d(&KwF޷GڷMַCҋ3ЦeI~ȉ:UB4gԹyÍmZdtVF}7>j"5/eRKVo{41LkZsi=0׌EcŚ9ۑ7ʲ OPX+饮֩t8SRA-7E_HgtdvJWZYkطr;#x%sD 9@T3o?}ʵß%N4cpnCsG63:/v!7M'y(x62{Eٸ2\ar=W	~ŊĦnF7 )hĴZ.U?/ਠGf^ZA\xAھmϰ%'n`<_T7%PlG^(ntaƻ)T~ӸLnnGR	 V<eW˦vN>'>*JQALKO4,֙SYG2҇N;U-Y#qLĞ(YEz\x)qm¤w.nܜ*F֧ysBr(r=<oQY-wTw3$j%9%n3q 9J`mKZw&6`<<B+Qfoʕhͺ<Fr=y /9FTݚ0n<<_5!__D?sD6-v9p%0oN]4D%_;@x(`۽yV-/%I+EOa0$e+@fӖhOn;?Lڦ0+	`j-%+X^cYD/bl;?F	 ٠6|!Uu@l2Q0e#uˠ*Lӌ\훦jAV$7<^Vn[R*[ 
?/csWy	HR] &
mJܹbSHq\87I 
M?E=NI3]r,/<txm[jBq❎y7;Y߸tc{e.O1i6ءbC)ʯ6/oY*6Ђ~M'H1lGI4O^6;F0R/ G1 w5}t!l*EAktPzB0tNltPV|8"ThEgV35<<SaKK9LE΄~"Sj]^pJcbnWJ4vb	Id	M繉[<u{Odo2
VLoC=6@YR+on;^{;aKe
̖UpX`ui-tIׯq'fWU];G m /KJ?Fs;t.IH&j]R*&al$bNӼxౢydhSX7ӹVۘB3_hen6OSUJCsLkT.G\"	s2|V%+~Pn.W,2ݞwg
,ͥUovMH47UhpY+g7J_y(Q9u7|([nڍTlg
t=t!	:Ih9q@VJq48r[DݚVC☿V#ʇZAʷP|ED%F7S^PS^fC}$Y(u .b&и.)z䂢n-%]|Q])<W6Ǻn)p̈́PVjk螹nkަY $w#&:uҼk2ItN@0t&seV6ɫ-ym`Jy\J' 7'Qf~+{;=(#p)`i`3J3DқDr7Wk5iYz$-g}Wo//&Cw7b焽7'aRV+1s1AxT~MUa,<G"F=Gל_ѭ3	ri9TFTgPpe|UOBg0e$ǶH*~TnhtyZqf#_NykD5/j!3ddcw=1NlonO5FGn^5 KEG<7đR<{ X
ВD>D>rdN-Hٶ#]^ۓei J߉LxV^}:M;zkbHΐq:r x0mcO70~JW$/n<KͶ?ٚNP|<s!7@It,1X|ߑ?*="	Y+WޗqO0RWp^!#)My2Oؙp_9N|`5viũQ,{=4GRm=#^	;'ELsTwԡM{sš(	WLS9rCOءiLՏ\Oy'Y7a=RM&/I1	d^9ø;fQ"Z/WNz9t;hY[~ɻko>Z9gUʯ6; Uc`ڝm{! H!"uو*ܸyDӇhRgEK`⋖9ݔydV*]x!;E.Hg033U|g&+|Ю,iÛP)1\u]7}ty|Ep1@ (BrYD]7,j!tf|%"A2JVAB{,XFNvhF3%B#ߏl~NF%B`49++WvAi^cAuK*FW濛c'O=S8$9|jqD1p."h'a4\$¤L4<lm}s%(fM.
}	.~>r><!N npXs=2|6FoVs{}Z/a!Wɻ֢ZVQ
~FGuŚ_ZΩ5OCYjm((a(s0Kⲟ7Pc}Ƒ)\sG5N }~zsQ}gű^o( #W#O,
2jl][$`_'XSxO	G
OG8e[i0A@m'Qȍyu';Y{ޮ:jyhl#AI6 "1{ȟ&S&Y]$TbӠvawXK% Q틷'<y]g}A.uĠ,/Hvfzc-i]V.P_AwyXQA B[љ$};j
?
sa5E8u,p[DCtEbnGr#óVa09$Vt+'1v+L=qrfgج/ʛo9XMHdo`] nߨ /oP& "A"}appwӬ$/ IE*vA$by)Hq2EKb^VɅL;93rߢmAӓ!}2_]=4;ݮ<~0plty/Y\}>9=8	ln1U<"r?4?}%cxo@N_	Ak|7k֮cDtG&͍ٝ9Í~V@DuTu/-`砇HYd	l˳)IЭҪAIy֞&ĸr'SpS-NBf!>(fYR»ܳ֏$
EW2Ĳ\ħ31hF=ybkkDԈ( ɡldb]'mxyX~5i7KWWB[UE\'7PІQ]OV[m}v:YkxXn7vfzZk>(g= 8th3 d;>RG;yj[oco6[Uj~Qǟb6Nj787On`di]|tZoKS_mZ`[`w>iJ1_/&״yoåZTJ	+XՑ'էCU1Ny"aE2N#g/Ji6U+]]JZs#-?$M<1ć!g}/ж;#55A{O@:M%WN~\@I
mla\O)͑j-$JpIAsYQ*>Np_ L/f䄬k-k|1.Z'w`'ǰ+E8Ӛw^Sg4Qi|N]glq,KwYx]Gӳy7ڭ%}ϠEs-CfV#`.݄xޖ"B2冎sBٝ08w# dޘ4Y0CS˙ħsǋ{TX[/v7_>3х9#J_
|ͭ?-"ӉXô,%YDq?<"7#/2=:ANs^~"K /Nk_:ަos~e +ǆƌiJ@Nk~7JL~ς%Lr?;J~z#m?zD/aJw/
xyp|l0jTőC\QN9梲TqcEzCg.='x}CL"'b7pYZ#5T?@ML_AzS`ҏ,5У$#R%ؙw£6򚤠ԣ&vعO
|q:A:%G^=sdy^3-oGFQkxq+7vTQ7PL疜BE0#Int_a0f-eX!*ô4iQ$(LKB(4O Ihf_ԛ7z֪x6Hzܘn@%n޼m0bzzm6]_mܛ@ԃN$`p|ON2k]{*5wf-3roÀe!H:nRI>mM6+9*?skavfUl7;.61!_l
~ձ4>1Řxތ7js}L9B+)TBޒ{
fޓ0nYL_S4]<LT96_^u)}&43{W_=NF7gޣ*V3/w7h&_|u} IzfI~f+\'U߸罟x_Q74e^#0ͯ޾=Iϻtݷ{$!K֫'eg+CJSMZ>5-I2zE$iPl[0mZZL֖4yow^'"z6)itA3J^O{ߝ</&3ԟV3lo͟Gi<N)&QnX_e -%
M]@7=?3-Xzj
ڪxfX/HQHa)tOV
˝?v6>jrD66U-?u~|PFf59fəR$9zKr̹ռ9J慇B#j\΋7/w~r{7nm=@?"	=R- havNdd{-._|E&7%ɒ$kADjr;8Rb/32Jx1kE&Ҽ,x{ivmoXi;<<"UUR{@Nl7ڋ<3?q&r<%8~X7МQs{$2(}Wׁ7fv*Vr>-<3'_^k?0*νN9Yr;
U]נr~LLDCPEwoCȋG`	eZ[f3ˡ_PU!JͫPKlXYci?r|ȉ:,Uj\\owVlXĞOh/hr	Kyjsiajn'5,lftj{;y
aϋqx>L)14~&&ɛ90cUk6]k&k4J	XU@icR*fTꖞovjóG{tb6ۘ>x#;ƽ;y=xvm?@Oe/?/Az6rcGnKk,^^<tўUyR9H|(tI	[>iwiя'8C+v|E7UJ!`/1rI~ B?5q|*yqxu~b`Q|!;Q0P>Pu쌼~4lzgIPN@ZFA1:80hG1Fٲ^7^L'/1GA\ʬ}}|8u]rG,Zu|\M/&pL3%TǟF'4+~]FUdyjf6f^fH``¯j4q08%4CUjÂ\b;TZTZq69;n-Ȭ:[*>vxgckfZ@IavA5Ϊ:i5ƌ*:09*::묷Zw:|k	z!__QjPCD>sk뭩U4;ԨkUBХ
њB&!S |+WRNL')٤829w$wROq,c`fy`րWӪ=h&~.8UV֧<InPswsyg4HE{#xjKBZn?SЭή山\ods]%@8C73#[;ZjGyE
'Qy
w|a%k"A^VT8uע7gϽQs	b4j/S)*Qkj!V	Lc-#G/qfE hZO!C..r$Cw#~'ޚG0d1YϾCJ3F~ቍgd2V{4jfKbvF$i̐͔)?
YooJP.;c!LsWqPAp}Mc@|,خ7_Yȝb3s2V[.g2Tmot˯-vj5fkޱWkzn<kZc/<a&3ujZeU{5kZu
IV	Ii~GһK;.rE>3z"Č]owzn8>> ݪjZj_oڝ&[U\cV8l! ͺj:{m~fFa@M{i5vj5Nmj֠W:-.K_BZ0ۘ
U֑UF  jˆDc^]_"V64pse5vմu{jר+݁2&˯XYt@Rwvw:גQ)
Y kl$l5½ő ֪m6-F5:kvձmj@iMvh^6`x=veCFvf>VFƱ=<`j⬪f^[hn-XргxįC:
7z	-kH^oz(Ou^Gn6vYmfkkM)CCV(jvƶ4ֆvb+Fs6ٯo翺a`Ϫ'We:ʏӺώh|>%4@a+UC5PSyeJG,2hrn/,b@uXjyHsE-ipRPkvv5RPV* oqcO|v\ԼS S_jc˾pK>q㗓'	W*,)SȖRj6*#Yt(rky>ړ}6 Q;
zNhT
yH9jk(g_7V&t.lEIr
NWjJ08r=msG%+iশ7]7]pGCg|}ɛSKʯ+!fS>=bh铤M/)KW% (%?mwUrYȸ2vk<PO*ȪS23!alIa%;-lX1,{g"){8?h 1?]w`ĉWe8w4,-3_K-PoҐ<7co䣌8{8bNfU\_-CI(ZZ`t*6H8<F}J4]Bã%OaÐwK28876";X!&1ЌLT$n'xei8Q6X#3|<|2U*#5g dJE<R}lB"͂"=<+*W7#ü)mՋjT0t0Ku-RْRR5Y~J
CS)W$ԿU˘0gCLbMMzK+}'VV*tN#Yg ~J"K
9CD03h#7`q¡zW/zQq%?#PGyV-0|+Ip.ehVbpp)4m+2uM'r{<dTzq^y	Y*K{CAS	QA&E!0*H@o-|W,"//o"97R3H.7g816TD|K<Pѩwd]2č0 {2u$"2%%A^#ޡLӾvk)s?}Nb`c]"ME{5`AS8&3W $4`,AȊrR'Lr|E]2[@YٕTMYo^\&doL=8t2
Tm*1++iݏR.I[t9Xy	3 e39PD&e$8th剀<Uc]TT(yH:K2kg7Li&&G!&t%a(i1\Cj&^e2B\ksJ"9Q^s.Ey!#wR)YkI?	\߰W*W"$Z(L@JR_0y+[VZ4mz~	Ce`nlѺ(WfV%S* $P2]?/9$Y-//{YX=*Խ~cxXVOzv}j'Ǣc^Aװ`; .ɋG4`Zij=(8';w* fdG%;}v=Ow6E0ԙ>K	9gp+tgpo]&S':Aal;Du9v8#Y;};a2*e)4+S5d)>klT%meIMyqGt4@jOX$5l>o,2g3g@8`C)
qd01]/u.eħ;_څׯE

k~IF1vݍl˫7̊eaX
	5k7:Բ&Kd30'P
,|!!(_e"`f9`^nb߬PU4 sxM
"s`h wQ|"VK\@	L hV	V:iW
1%ytU*mm2şȸ&'d\}  $決jj	FyGoppϚQOti84m,LoFP\hCZtsDqKfݭ\䡙6]KYv׫1?=m4jW&)6ӡmtݧ.k!ƝİÜ}YtJ {_6~3k+2'e)HTNͼ}XAjSY${Zճf}|Le9:G^ۼp4/i;f	U֦cB?%}t/:k&R\qZ:wbe\l2Oܔ̾x(yVaWqsC?$m	ٟi=" y+r'j*fcׇJ؉뇑,Ǎ48&|z2⮑%(lajN<m\!\"i,kk0ʊN=OwA]49++WvSwݝ"mcY	|:@t2qLH.o=ֳF4D)tFVOBb$UPd<wP"P@d=ĆyǚU_yG^T^OPn<ESA3=afVv\-삅s<ԦM(>.ZXA	^cax3j!8'cT[Y'9MW UǇ-Ys(aqkPЋ/֠(jQX鳓BYJ~(.?TܰJ ̭a -<+m^Ke8;@6]m8-g`.Z9P]Q Kd$uTȮ!MTYf:xDfT>7>A%U=Cy2hn,?IB(Vf +eA/'u)D^C3nI#br˔vnBB=̀2d֫;j;eՖ$8
AvUU=9z|Ѡꉗvɯ0ZO3$XLR[`f̡R	VPדXgL7)15N蚻 ag߉Yp' B$iO:JNCg̔9H.uȂRLg$q)GTM<#HS<laox  &zQ]lU VhDQ}mtzcjuRf]K45]` `NT
2t$<BqJPqmZ2hMAfGA0nµ4=1u+k$	5:2
Ο8yY/hZ<Oϟo(smNNդJd=Ŷ;M[ P3ce1JyR &>1Bǻ+؛g>N	!4b6zg	raBji<R`LAVd$3j4:N<_Avϙ8G-8ㄅۼ=o SCņ	٤2WU]U,jrE=O\QNJJFv)f8TE.^9=/}]	倾y|UD
p*u`d~o gK	SM3NƱd|\^#>M7UL 3\|Aw.$DYЅqs	LR]?8/G.G//Q|Gc`jLDaRDO3=eWX_H2'R{cEF͎|
=*e$rAꫲm(R>h_]4R6]!$_Ml<s#HK<Թh}wGf5sZw?_Ki4
^i$RJ	4ՒQ;2?6G_Ĭ5tlN[|?(6?z_v{0lA;} G_7>3Ym6Z};yr-9XzB#1`0"a6þ0kSLc%Q4M0׏a6-!zDX-WrV̞ɞ@1kD6u|dɺP2,g)8%0y)u]%YgqؑJXSxpKIEk$qg_j5{*
$ 	F	Ij>"'JCѽHg_$ ]'f/"l`}	-nB2l%I#Kۥ@=줆		b1<)qZpdAICΚ:IFu$IH]3bIU4wM=c1K50+e«F@jH^87xbz,"FzYԎuAHǡ
[|pfu2OeoiΪ)ج[J'\R#i
"v&}EW~6lC}ϻx/o5ߝ<C%'{Gȇ]֨J 1h ExiN<ytPtjK/Ia]V&{q4(ޛ}(i;s;_16fvLju}I߁)KO@./\,f~.A*ٖ!<'ᰄݒi\KeZiRRI1o6!`w,}E!Y9%G 1@t X*$@#($A].tYNG qɐZ3rqF9J X_zP"w,Ο
KxZwnu8+nwh=܁8[5Hr.n6A. PqMZ ϓ&	^kD1"Þ4)}MYtn_~4Ѝc1p+jVIPݾbi'J3> d2]D۩
J 	ȵ{+S<a}Y)liU7RР8Iۻa _An$&#L#aY@*#~wmtYBkP-@BIwǝNlUGld._knJ
?p$s´K; ?Vt>\␨QaP%j#;V+^Ұb3A7<kh@ȮX<cE3G-{t9.:qܕZ\ha<ݮߙ
7>mliI9:2H JMJ$}"n"+)j*2seOd>(ZHO'Np.xr+S,2ǯ5
 c/$('03MM+}#i{swbTz,;ԙf,R@n])<N⥮zpnCg^~aW9~b܂>IPiC "ĥ	tO̸,};e_|39/_,B?p_{woH^؋81Gg)8|`hVAM}MjRon d 