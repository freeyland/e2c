#!/bin/bash

declare -r e2c_version="0.2.18"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.e2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80 and 443 availability check....................................  "
    e2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
        fi
    fi
    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.e2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 z] v#7(__hW&J.-Tv׭%U]MȔ]d&IJ%y:0sfYYkfaf\D"Tv`Hf@  oiSV[o}v:YkHl:vݬZhkb(M*Ǳ? d;>GC}N$Oh]$AǟV}~w72{'7J:O\Cx'A&zپH|if(כ0k4sscp>g?=8x4ka2_~K^HFOl7wڝLw/1lv&؀M"ހUII4<#`Q̼ES?.}I`ď8aq4b <,	\K|^! %H4P=wKa*Kr{Mφ^~v.u,C3ߺ.g>h-,5 IFO)d9⾏_f` &Pgo4fBhv%s'~B<Fo(uq<ܒ حRjΛtoӝD-1oòO۝i{d' eo˧ɸgR~W*J]̅8FO,] t;zb>$[AČ 5ٱ7L|{;&Bxkx};>Cu 2|TaxR988pޗ?wwRf~~3Soji5a:9R)8_G`0:=WM4ds|V>5o4~qvlpv;i7d߀%t8`a47?+.`mG!z8(~&'fؙArٶVn2+zdߋFe::6m&m:١s M &@6L4L4 LݱwtLFMnRcY0k&l&l.TA(m!["'qzl>R4ARnyem|>K42s+ZΪ~YxXff,W,U8%2XUeONCx:B7(k 's@,AN4k]'BS^% {(Ɯ1bH6Uʈ$Rm.I4{~譲'irӄ̷*)(qu<ggCiqOޫ>:1e9`ok{8lhq`5.H.確%+jBmJ%]X0JA}Ⓞ	`4z*xM'>0?9|	vzk}WW劽߅, &=m`ldμa0 5WJ`&Y
!51xΎFյ]vKy~w[ג+Պc2CV&iM]oAػ4O}s*GDrO5K+ wWRA} +LeP
)FS?o:9>479]6Dd޻E/zh<vnQ#7U2>q_]([;[{?n6W5E>N`JP͜\	II
y!;hwk~0:r~x~F20s*a֘Ū=ͺ&O_}{bg'\VBeR`8E/|kF7مoDR#H,+L4].xI^|&vڻ+>qnHr"CLǨ:N<iA*l  wA+@*p Jpr8)YJf
Y2RQ:3ABJ1}o2$fs	X2|lZWI0sr%zGDfν]%Λ	*؀2[+/^&9F_lИ`\K\
@a?ͼ/8~_؄ݭ y ̷"
@yk2 !76/TԲ=x`rt%y.2	RJ	Kn&RZl|JKfZLs2 ד }~Ŝl uZX9o;Bހ26` @8!A 4W܊0|? *%؍pPR{	;cO̊hp̭_+;vSTYNtG=|TR2)67SO4W[M|ppYTf.`y!֐.I_UqYJ/${E,hm#tpܟfg̜qz[;u} %#e/ﬧ;m>3ܮ[GhCSQ4v@كwk YDe7_Js`Jg|gr1r?vk0^D_BMsbNsR	c|BP)'N!ȜX9tOw׭KCgIγݗ;{oٻ~ïj!dcbd,AŅ<S}$3˂D-D2,I1iWN{ס3wzjGg+P6s_bc	7Ш$?Ԏ
%$Wh^(m'0#go2j';	TzQ J1k\عCu⚜}ܕ5-a_/_|_qWmǜ1v>̘1R{VAPӄ6EմYB&RK{Pk$	0=^
,_A}N@ܾ]uth&|F!)Y.ۛbه`чz-Ib=aVZ9LI4G)MayR引Xq&\hȼ~-i Tі;7^h[ԡ5aB_wH}F>5Oܒ:$$Şj|.<\X1IpPkTj4e8 [pφމN N&,4Hns@Icd ~lpݬ8qN<zL41נ̣ikO!Ͳj_+rXQ׶6ZIaggԩf `x,2E(<w|-ٸ&{\p&w<A$,D8CdOIQRRPR2Bh
][XOr1Q[ȔjɄ|ȥR!,KsJXƄNc}eci
[HB|9uÚ[wv4YMWYa$1cBZNq=HM2A8$RhXŠ5y49KCBYͅuZPSq-xAϧhP]=UQi8S,	2M*UseMLxuM]:('eVy\3,3@8Ǝ8ςQ.BLp32YbRJ܋ѰQƀz}'H,ll\lv"M},{G>-3k.XZD=onB},k/g=4j[xdR3zXnB*JZLՆl3l;eq z	A]=XUWis}`V.n/F`ױ˺.բUo8pv_:ܪp3WI"KrX;ՉwǏӫ+_^\]N!u1jZU0|Is%b-W2JV*:F~-COդ~U'C+Պ^_p֏c_\laM< asP[ꅚcUndn6yWsfImDanc4&	vLȶGH,G#vT2ܢD(>3 d)[H^uD%rB>sai?E,$J([!
1[ra;P',PVrhàYH[AYw},& ,=z!aV2"ex\27ܽh!?&T{Ce,/ĩhd0>C;'yΤN읻'tz4e'(@N'zSI&k.aU:)(~Lw&NX4d"~ђ$XohЍ4ŭWY 	;&>1Թ?Eӿб$rs3+y+H#Y9zԒ385C3ZqgNfyl5ACl/6Q>kY4A |b3`ZB}>TZxX!'e/>K@ɩ7ɁCfG5}UavMf3g6=IĮͨ,c7cWҩlbА5XzicU(L~m:0YG4΁ 
SIIZ`ήeٕӮrSnq8revE-+ojTvWvۂ{aF,	fD<&U9g31AgP]} 
Ilx^˞ٴA"y'72D:!#PzF(w Ч*3sr"HIYům*/-[,
	{+/lĨ*J9 sqGLn27Zqv	#tH2~KjšLK>#U<憃y\%1k#jY*iY)㼔1͟\n0ξ@Br鞖'Zؒaj
VGF3)eP+_=Xub=fX򔚰)w6|وhZtʚeEBTԼ7Yt`&7N1HG >4nhcopun0=5imBe1
HQI0.ri>J UAn"0P~3~Slhj'LYU~q۾J:H{!^}\ǚ5e4(1f0FU\2gzŗ\K}9{]	o0;1L58;ϺOx0}Mg^&Fe43o08Gcak(@.TzWOpS['A9Qv]мSy<F	;Y}(<ChAQOeG0z*7<bmfEK\^>G⥗!uG1rA30}ķ%#C>	艵V5H)<P='S=HA]xW_+Cd{xiSnFR!Ipy$e=|	CX	m8⩽&{(VĚfC#+RMfrÄtcmW.rY+kG.S`"2X&g*{0 +VYxGCeD}cI2dŔ}07Z[XA~-RE&t뙊IR;@HJ苡~lB/F.5fO,t;yG(-)Yen(Pxbr?a.%zV7=q7- \Hzus w'n \}+>ф2,z~S=pCA:
M968F<՘+R6jWn~di֑5
ЌD7N=CݭcH6h&h:#!PU|WNA):!/fuj>?j$bh5QA+фiM)PX"\`
j=~num".c\4Ёґ_KK~i/.?e-YB +PŧzM"_$5|M"_$5|͎|M _se-YB +P'rt |FaTc>R6ԷuԷ(P
^C 4 UzQRge[Au[]}ˏc\{##W^[H	IGLFrۄ&,3Ւ(QAf4帓e+/3Niµ2&R|zqdCҤ[Vy+a]x
}w\jr c<1׼*Ņ[!7	k\oHR#cz14q
	АR	*Q$ӆ%9Z$  oͯ\ V2KwC~d.=äll=)(Y훊`}6}UBOEDIH&!HnN$>г=.LZpxr] P. UY-+ܽŬ,(j9*%fLiZc2La!c|Xz7UNw7{oyZr{r#ƕ=Rl+B#NYW;!kk1nfs϶T"h^nz03uK.sKzSinu-v0@0ʱ/# C7֌=ܓkNk{JXBʱEvy	HG݄=kFf1ؓ&[	K0vH^\-rA0ƟFj5`4Mú9}YZR}0TiØrlcAdhɜb\]oɝUZ4	HPZsP6ctxr{1+-T\yVj/,ЭF,3	py`N7gY\Ixwyz?O#f}P-8Y[-|uΎKK&w2(O@W9rqʼ}u;hr2qi>݀C>9t1ՓFW2sMѪQ9[c$3%d:^ԟEq-,L.hhK&/]?*.w~$}ls?^[UV+t ={}{fu3ZLOEZ'}Ŷ0v"[V8jiI%ZLӁ,ekomXʄm+\-'Gme6&;ۛl,4\b/|Cu<As-"r	227"^ݩ9-bf?Bwy,VQ]Xg~YNe抋9YUYCRE3&yIk7xFÌhsHm6[cq/o,_:bhͣYڴZ,v;yNEWoޚ.l!ÒV}'_-n^A;|'PyS2+M$=q5wW4=5#ϚoyVaM}3-i{>T稦S.C/n0
:{ubv.(o٨+3_8Q@-:	Eeޘ@YnFU!<aqA5FϻDEjL-I:ITr!\mRNVL3%<r@rf4/ju<=nڡ?.}{+VR},ɥl\!9i0$گ_Ө:Ng%ǝxq^"-ql}s(K.>zthl/4,_C.ʉ,3i}/+v羯nugh/(ټV
X= q1)xNT{2TY
ŻOTuf,kAӞ!0z{tEwڷT(NHݔOmG:3^՟t`R W^a$Q<ȕzOKA׏dxȪ0vt$L~y@gm4kiܽWGo;Y2- ,TQ4p ROZ篶϶Z7{{;/#(W/j 9VWsw/'&=j0<=gqXg; 4{oă؎YP]Uɺh£qxPa6+p-Q^ja/B>CZrM\	@wއB3,̪*t<8}7Ǒ+:cd(<Hp+
Lc2 B#2K,7b Lk]#wv9ᾦHoqI]u%`bfGWU:}v\P)<nRG.lbCMUŊlw`8qЏ&'/.k\AyYcQyA}TDYcKOg~J),jF-0:a&\o:X]{[,WN2E乏8mBۺW6_pB7(.a@4,֖ǼkeŤsDeʭS.t߬֔ſL#)Q;o.C$R I0 m\;2kyxnf۲!/\
D@Ɂ3H6 %bJ@^ilǬޞMDyy#oťtstD Ԗ25RQ׵ E7ٰw)
SQfɶFdb둌S3ɝySIUN'yK5Y¾dmT_A^0@{q#"v әI@֛k61L%鈫[*WBVd\{@,6ȐwDŕ5̓n&L'?0zԔOIb=7 >%%Ubf^ä#|1hqYPTSҘh_0M5yfGgZƌGɜ	LhraYl[[cQq.^UQ<H+[Yv(uf	gn~xHA_xvyIC+^m~]Zy1ڬq5Ht;g=/ڶF`e&-yhiLia/V]S8yfzG₲]+mSkm87zMpaW\&- gh<b #Xy8$y5[\M6v8d afnd
sY0 qP<ƾXYcT*֒SV
x{Ҽ80&>knoDo!EA+ß]CSga8|Bj(sCǰc]T 7a2-&wcfk0n8B 	^A~|`I
+Qp,g~OCn*N(' ;"4D~3/,Tyt)1z*C.|,9>јk	g/0t]dv%=(	zT=BDzxY(fj'f!q?,h8bnI6~`8i,i%>T8}	^EcR;ȣB%\*t5w܍'
l2ZD<[kjYW3q]V2!qlS4#*j)1Q[!BЦPIL\fJlt\̻'yx\,8gX.nj22PIcQv,t9`1_eЦ` -u+#3+.Wemf$sbrG+q-kؑA ڕNuZaL!Q"Opt`ƍ3|z01Ư8ڀB ʖ2Oű=Ұ``:;I 0$#4!h8$m*E1(h8
" ^Q{x 6H,ii[A;39Gd>Ԇ6«
,pVD9e=@NYĩfb)ZzoիJVAL![0MǗ_
KW'k3V{*Ct	D}v98κ]uiteJKIb6_|Uu3\5sdfk3Zp8`Yi,B
z+724^.$m >\u.#C>!07ɓgmްpt)im=Z(>~#(V,xN)df[m^6"c~s[g$Rnv,fWydLC--3iZڵ,Qc+S'd
mͭ)ԡEj/
|sB[$/\ŗ/3K!`}ae]mXsַS~K7YS.mbSf=i&S(>cqk &L7vwֳ*\6k>Mz,Uǅi[JhO.`n-ÔۣO|Qg,1{io"rScҳdٴèhO0!]~5oJtr^-J}kbd|޹Qȵ2oZ&˵:ozIR7be:"]Uw'A (Ϳ蒿3+N
HqM~9 Itb5ۓ[)RiCM$gM
-=2v\[+_\e{:3=[N|ܥۈK1"smGxK\aWup:(	o\í	v'}[9dwhZoVz=] DV	,_J9#FG m9mm _ʳ\MU8~q(s36{mYnd:h|Ioa<;'3Vٽ#f1D	*Zr
XHhuokYMƂluBf?O~yQ'-}2Zeǲ'驜T"^ǜW".ެ励@ڣF/ojz/	դ~U>+?YUфM鍅qj^@lb;}-<#*sQ6mfam
Fo2ve8&(jZՏ5 sk!zǔr"4ǬX#(o3ۛOg}mm'Mh)8"ӄYxK]v[R<KECͯէre]3GLxr((Pd:gG9;? ʐ6<~;aZZ,ȩťpppmr9r9nq$CNSIcgS(Vm6ݯh<#z
5lQ,ҷ{]l T$V>0"$[S*jzWa}'s(o8&xy/jb^sz1P؍/bf߉xr;#@9L@H{<`E96EI'6)0Ֆ9*%YA"	DF=ǋl>2P˹]TӼ
DSn`8T.:U7ziTSU=8*-Z?UP3yd5S70K]96l`Un|
[.;7rO)w6iPr&Oc?^C#J!Z?bt}=Q	Bn 7z9:Jo'1NsyY4SͼJ5XYts5*uq)wO@Tl!QUL D1*dO=^oڥt<!j4'elBn@lkB7#aa1
=.o33czO<;'kťl
x(+&|VG䚥}'n֓4~ɱw^\;W7({cw-9wU0IQ@O X!6ю%xe ܞ+Gכܦ?Po{}jnވM Ae+b*x0HBm=w}6W]GcP')ݥc![pra&<XSt7	`hMI03s\gcQ6*;c\rBg]H^2n)\xi=B"/|bB8jtQoԐZ"3ԿjEx)^/о`8h?`sLyR@&
mF8b7ӽkܹ狲,Y6:8TQ.Ë~͓vYǟd 4o׳~q~?8y+h|J`?[GmPy#$^wu_@7[l }ӄ~M߻Ȍ1|G*Dܧc/`# =T'D/	{=8]9|wq@JOP.'_ᡁGĊjMiUfxDs^cD|i<!Go"6
kKCI_@lj f*v<X:7'륀NXhUn7}s-gp3eXBowle8vkYJRK|r7HNH06S-k\*LfJ>{}h_`nU߫!sDE"!DtFcCS[% \D-JJu\|39r}8/Xm4kL/Bi6tn4:fhׇ\ŗ:Z۹{uV䨕+$|L^#RK1ai+yEwQ1ًטf1	YZ\
- 5J~ceHT3mz .7(w>5Fn%?.i#
v7`}rݍT,g
8kB)(w$ 8 P〬bh5o]v5F.Oj$葟sWCmjUgX|]IRK<nkH]tSIE0q<pХZ,?OB?߭qtYFKf fZ\9@۲^"~fg\6oK9E6(7bSOc-Vɥ?қ^&_ƗY;[Y%K#|TZ2"(8V 7ʧIf|kO \@Xf4O0vF
9nz"$`yٽқ4+D<̍n?+BG$Zo\Ec0%ϲtoAl}4$Wzy-y__(1OaPj^ȻQkVaMyEutIFo\c:!~-Q+)y3\X>ɾ-t?,[ihumXsfQ.p5GywUٻj1 V:f5luS5X=Q2
jA9ᷧo@=/zi`/*Д&äw͕(Ѯ,)lkX &+ߒ|m;=y_&|@!YY{h%5>x@vy=51wK"Gg(8}d0]O70~J
a4^Lr)e;\CQ>ly{r~49!Oo,>σ}"s8}p`}t<#wE|+u>O2@qI ů1α	wR^P _QEMr~)ʙǰɮi[7aљE7!<Lq+	kPFޚ&؃FDE܏S5O`7(pr7 #H0xd(n\o2yyg]%Nz(nLȗMz	M rgMP'.~VwZv^>e=VUԮ3z=wyg<5X.ʕ ^ }%Q<@\BKnЂpj;gxƋ/Ff_wS፝-[.4宪Q^FH˯44z9ϸ-VQoZMf"ݘMuWY1ڇ7sb?OIzyb^uF!(*C+庈᯷(?L&d|^5Zkc1[DҰ_d&A_ϙh:qioBrBI٨|BLGa30迯z=n˘$R*ߒ]w1K.zjz ˮ=	ڵGxx	kv5sF
,z̕-{I%<Wbb&nЪ`w0#,bloІ5C'd3<{,	f[|LhT毇b%/[j/ꊷ~/6\eunP}MF9m2ݲ7Gx3}36/<+`І~zuQO⠎Qg FKwUV-pufs]RӓzQٙegĴ6#Y#dղXgj,_
wf)|%ۚ:殸rxޓv#V8bd! >>1ΛVcdvPIMˆ4LKU)ͅ _zj>r'@A2{h|Xv,E1'TAҬZol%p]%{z/YZnyy\}7>?;2nMXXYƈ|{,D2s+	vNhwHtGa+%1vO}_zʛ۬GVcf8}b 8A(+nGwB"|˽^ӷ\aqi|F>bzF,Q VEFlSj}o
?tG;:S;PnO*b2KOGߖ>ZҸߩo\<̰°3!-4=0.<'+waߕ'tӏ~}q<-K\Of'=o<~<[AtBA|8	?a#[F\g$ߏhX!L5Iss~ceγp);q eHhS]292"!Ex:>ZiU\Lw2 fŉf/VO}o89>a*(
,'5вY#+E
 ^V7lVI,b:=@$'>A.n+c\%z "(SDXa xE}?˖)cAaa̪"VLZ5b~Zmfg"zۭvjv־}TiKM@8h d;>GC}NrFڭ?Eu\}E ztZoV}N_5fK>xW*GoW?~`vz{[/{[?/yI~QuYDb{hh5(xhJ^0M7hcV+>hk!tY4>0:AC/JAFQ]wt';	FCy؏fϘ,vfq;uNSN~IÊ&?9&s]8D3rXpF)VLgd32F~!3`< 
滧ׄ }OMV]ɽ*8' o6@TVI.H`oijҫs7?t1I:R`s\O`j?ESn۝7@"Vq4'LQc$6	XoxUlǥ{Aw5YAct!vع7韦 x
q8szx21{祻&b*7d0O?h&5{InrmA1p7qM8P*]Ͻӓf9"IY+] ߪ8N!?@M!7|9<YpYQ7h;D]CV*O<p3]pSoU_k5]o4^ۜ}J%`Ѽno2bzzqIϛNݭ_9LeNz5G+~tQ+.EW痾#''x,{sG׍Amݴ7J
Z樳s.Lu̝t0f~E5_NE2V`d7a)AfQ80'b6Om.!b>`YS^8:fZm:ߝ$X
3
r8W*[O_@7{ϻp;4%3{W;P_;NF^0g#2kzWAꍦpퟺo/v˝pR}~OzNWʼFt^)L^:I[O{??蚏^>"2$\wl=՚埦%ISuwmhev~ܴ߭vwn--R,>݃5x{??F4⯽	0WJw`- ӹwfi/3ڟ>f2X`V?ytyP(G)
6Qn:B_e`DŇ%
+Q[|).mw._?͕`0G7덖xS[wx^:㑶ܦ AM&hW(6gvЄګe'$2Y~wQX+t-tr%:ӯO>"`Xj>e&-=~NPwoNog?ty4l^/@OQ~Łutpu'*ZfQyɍ82ɚnR)4
݁R;kiG%1,i^4;-7XG2G7bx񫤷%~zCa
xkO7vz޸"]uTkDۣ綶Hd$͂nmTJOdOIs0^kInaZPUknl]P=u*jǬFD7ei`2S<_fپwfKeRng历XN䅐7tzqYo,ѰA,N2Z	2ƿju[z]$SnrνGH^AO,$0pG}M(yObUk6]k&k7isEzgLi1BR*ͣG7}uKO)yuƺNqNO_mza?)=PnOJOh`=On3g,^MFfz\O(A?GL%hpy0v>jx:I@z9h'8H;|!i'zECh2G(*XC'K'XLGBgs썂&EaM>%dr@m78mc{}?F&80P<j&[e&lN?0_c(S3EI4=S7_PCk/~pr:A'q4l{jfi<\+LFÇ_6+a]E߷UyӍjF6f^eG5kZmGËҎ᰻eh{~ ZmȾG*_-9< ZQǯ ̚6X`yFZ\_F7PhuXnyZך^4HAtZuyfޘ#?-DEĆ^}{ުf|n?66fhvڳQ_?6)@<Z$gkG/<j59
@ VǥdOh&a!̥c93K̍3m}pᚕco6Y^{Zgm\HV6Sς=LnReyo4JU{+
u&7)!ߏtk|m6b>̣{{qI4gguh#-ͥPxgT=//@;m{9h,18}at=	FY 	b4j:O3`sM_(U܉A0ildq>zLg\0`	vV3T1&Cgja90Sps8$[sɑB"5k6Q_a\/=BFҠjLRͭɃQxUYS4f4FJWʗ7Ǩe~"XNUǞ|Nc[BApuM&PcT@},خ7_Yb	7et?h0,hf˭7vj5fk7Dؠy֨?rk揵?5I|ԘkY E\jF{hN'=[_w7@?J5j,EY"x >G
[owzmo8?H۪j;Okݯ7Nm:kn0hPC:-6[e?rZG|o]kN}m4tEt5fۭ֝#Sp5PUN8e)Ss[H~p*POэ6: {N}t(\P!bngQ_nnfӭN>r5j
~l`ṣzAW7܁&PKAz7=rG3 ^S?:: )7j-P]~ŉ ֺm7AFl5:nqnQߪA;X6Xp	l@b}zBe=,u*o6m\ }?ڐ-6~7hHqR9Κ{t:ng}tFBn:P7h:4(QCךvG4A}j	'~:~^TGn6v*yĳZ?66/6rdvXl
}z<ֆV*+2F34n5W?pVOAMW=i]'h'IanT@a^k"?%I(}^a+?9oFZvfZ
ߟF'^B cK{U _XOZk_||i)Z&(XO=RqOɳpk3(0Џ0my;`4!#RVcp=r]b>_@z^t'G^rZ*?%sbH)p9>6A'Q!r)4.S*W\YZMx.BDD7)i>ɾ/.)чf_H/W[m5M쒲t$
{ƃWb[J
kU7Ẃ2L>'\ńMDYUY%X1!g!EHdI?纈^y@,TblFz'_nJ_oU/4XU|3=/	߭Wz2<w3Tw~Q ߾e0efƕ*<:D++wv:FXbdwWe=ѝs$9<Z	)*.ƹ!CtZګ|@JdT1҇P&ʟAGY֝(C+N#||?탷tWWl/E/sAI1JNqCowY1"͂"=<)*W#uՋ̫VckQ#aw#g]iQʒ&rRSaJB5c`+"32Ș0!
Tr6)-ǶOT*UK0Zq"K
9mUquNжh馑`.y+pxѻH,O`,FlC$f,[~S5|gVRw 9cje+XAm.SLןx	oXyY?࢈A+W~D֍'GTVz#SȾ"~dg
4G)	@R#*;FjxUֺ6]ifQ+-7-O{ew*;h/`)hT|w]=49'+.|W,2,1t3-v^Yu&Z-?a *dIMRb!L6δBV M=VHvIaFt}M+kF>ʫM	kR9CY d/Iޚ@[^V
MY*;/\c/艂 q わb@uPjuFBba̩\J)H5+Z1>Vvw4ENW)( cXa*T5j>MF	pZ5> M}j~oeb$1
ǆ d_b铫A
I\a)$V>*q')̂$W^p^k:=zJ_~M(igf9NJkk!Zbp!t:?ToE9'2{^{ya.
Wz̵*_cLѮ(pFt4't#(Ԛ]oO{Xy2̻Pjzr7	aƱlbUS],2p%yRb5n󕖍d6g;nф%1 bWxP0h?qzps[uE"r?* L&p/]6*S/9`P+G$0H#Jd9N0%wp12:>;13eT	eNsG]U+T)A>klR:nL2鳐ЭTCmh۴j2޲cpتxDSJge¸<|ms]]^F_*`;Lc_oY<?yɜIvH&"YyCt.0
`'g@@>KIF_Бλ>nļb#>*Ȳmɐ0Np=s%q>=K ]NXE*hWC?yUG͠o@[GݱvUO>5	/]=1P`BW>]	dQ@9Pj̦qj푛LY0!7&ӓ4j(?H76䙆bVϚ=.n_p4̢Ѣx.<kgŨ	7tm~~qW{,k"*bB=bθivF	A0$ksL~$Npz  RݐTyízi sxѠꉗ.7Wxzq ~&D8l(Pe3L9xCPUa*B 5`Q-/l4SĐ"]k.8X&2*9#Yٷ GF4E;69D{1.aGy؏C!7Fk|'s<?i;PP!=Q[dmR ~psf%Q`A#0Ukk4N=HXӮe	V&_XfT_T_ҬXT)pevNn7PU"ho>?
L|#K56o+wtN%124Tޤ"ը1Okvnn!6ЧI6v{T&31.~1DǳU5VM6!❘3R ?;Yyp{EEԃLu`pDЃ8Mza,IluȘL</;Ƞ2SbѴ܇Bj'47wl0׷,>@܈q0}

ih=']\"EϹ gcsj1&ml~/QZDayzĒ1&8acN9YnidD0Xx7+?b9W+eXeԚ01vy@wL	OKh?,J%y#_g%#G 	cX=q(-
n=]nde}7zĉcv5qzcjuRQ2]mG(hN=ܔ;#nF:Y\og,TEy -P@}wiv")osgr5ے}2Tr7r5r%9n#COhi/h(<[WTUZVՎX.7s^MY~s` ǤΆ.N>14BMCv3%p|:μxDջPD)}*:BtG|t KzuGAmvwW`e(Nh8eguG_|gra!j-O[u	qEM^{_
'ƮUۭSx :nz00;|B-p*F(_LIfr yO#-1MǕQ}Ahϧ7J,`f=N #6ݩ+LIE>PZQP+#GtMM.΅/x0fc5sxJ)W*ӗ21݅dڙ˭ljN)uL:負ABnh/
hBԷF1b(M]Bi翲iT9¼M>D<Sw?ӑͲ1	m[d `AcE>ݛ'G>YWn7Z;IJG _M?v͌C(d8Ө0޴2x`>ۃ
,` 	ԾɼwAjDy  K]6qq D#k4CQ@?X|T\8xk]Q"ZM4<ʡ$GdcВԧs/Zq
3.ٴ=ɦK`򬨜cFQgG0uZh5{.G$
򨦷H;PD>`gD6ʕQџH:<clu%P4Em;0,8ؓp6IvsݬNRB QމiFrAZvi-ƝWLUEEUTCOc\#z>]l[37K?G^V_$_ޕuY(cXNW7A@fSڕa/RXtYrTzk/
2[ۍKx$7ksw_3b:v̎zs?"{{0z*
bxU-
<+R?0PSs/'&i2{h7$eBGt0TҌIN$VZ=Xe<yȔ/>k)aևh;$@%$&A!ՋH\=E?|M]]L{ ii*uǠ"b<.N8x?^@?ޕf|xqt}?:O06[;x߄$[7|\HlЂD]AhM&qp4ES,'}`麳&p{i:9ހ%	_Imϵ	]=(fx1
Bzgzf}|ʢv<@VPb D؏FCPJtfLdsgTs-J{[FGZ!g2^0|Փ枸"{/j?z'Ȕ$ﴲ캃?mLpfIul1I(QCsE(p?%Z%Om܀i@0g[wJ "apOQ 8	&m=!d	ԏW/v䶏xd-$m`M}$ԏmhd6].h9@A w,FBkCnn
90"x3[!q0#8_o9W*N#bklFR|m
U &\$ D%K-y-ɂ*A} *<DW0wѾAk1 `0p@p@=i>q[TqHl4K+K̯_6DϮr#oy?LF~nBZҼW)^qh31R΃*28rw|>ݧt}O>ݧt}O>Bw X 