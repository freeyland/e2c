#!/bin/bash

declare -r e2c_version="0.2.18"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.e2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80 and 443 availability check....................................  "
    e2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
        fi
    fi
    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.e2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rG(8[_,A̺@E	A	Ӽ5@@ͪRf@y:{v=f؇]udDfd] Qypw֠j4.^~k^鶛lZ/IŀQ8/IɎfPOѧۿm6.ja4xǟoNsyqQo7{wV.jH+ݵm\h}B
k۸ 04<o7]i0~2NgV^gPʮoo|nyQOc?
*
~'o0{/_oܵm\F_w5ou{7[`G<aS&؀}o~:~N5X3/<gQzǕ/Q0c?Mi?>ј'ABiX&)\K|v>! )H4P<w+a"+q{MOF^~.=6&f!GL_K/:n3n@(`pBD" Yxݗׄ9|2:OFP@8$DI
t`n'c4\g!í:%7[J7/~4ny}j[7;a:ozoR}W*.YusQ7.:Ag1/?1!Hxw^h⦣_݁Q0ӽ^P&	B,×I;ӪH?/$)p˘[zFmC۽hKN*s~e+Gѡ7:zɠ?@M]vp1gշvMvs
dR!n0FS,q$,R>qy0:G cޣAʚR!b^ȶjmUY6|j%i0H|/yzGCEQeoEo{JK K 9]]dLL{A:Er*&ڄY@	d@	d{Q̠Bao:
qL/fk5J$q+kaZ^ǜ#V]RmOF*g6cya(j0嬻.{Tp:֣?4=WE	?S'%.9Wt:}pB^k"9*/!C6L#HW"i4!'~.qOpҊ"oxURX;ԣQO5O(Nދ~urՏE,v`%ǟM:LRx[y0胎t.KQ⻢>V].'Q#/4/>NO(,"^گ~8,d"l w./5{%6YAMl{.Ȝz`j1P/+MBdKkUzku</:j{K-Q۷nkKVkVVtM*ڗ|c<Wm>a̩; $8J'ƥpHGзK)<YUew
(ylq!j6GYJƣ,[	+2ۃw5	j__IjmܲJ̇odGMBpQ;O_nlml^rY;!1B53=`DB>;h&~(:s~x~N20s:,1U)| h5dT|[v.̶5J(J
hŕo2OM8>O~ڧZ]܀A4I>#52mD*7w"m_᜼iAG$
a/Rgt	dͷa5(BUE *hu=UHLenħCeX	]MߦU#[[	׬Yc_.AjJg&(A^TEE2?H)JbVp?)-Ǧu8'gW"̬oD4kkЅYἙ3%賭vz!4&&:ׇ} eIv2/3/ߗVaow )xw?{< ;(e͹բ?lw_=0~)R
F<\EY}9c?)-P6e:m)3M&p9SM@kTv2`&'*C1'+k] F5|,UEbΫcPW`g8*89FA"/4Γh{~89"!?};<g41۟Y؍qPRN{	;cN܌hx_Tk5;vTYNt214d8^ؘ}lN2D׿j⃃GB<s!c315,WIyT&{lN|֙aUhB@uE?*s&/c[1Ŵd$еC)9!-[y8O~g-(jk>r_:HG2j>F!ov	4J|К=JwoC} E w[.{P}L	㌃_!-s~aǿoL%d^8 4&;bZK ʜ<43аo=zC=~~)$09t|<}WzU_-l\]d	t>7(8zEfY7E[J$b31k崖q:h<s?'`Nke^_HzP%ixLb#m{9TBr텸6-πq'8
p={oS<H@ާ\k̈Zd틬IPMpX*$ΕcE~ox讬j	'?~(ǿj>戱aƈ߳&!#lǾJ/홖?LCEʪ&{!(h/q"۟6vIUf5>@VSl1}̋dU첽i(}&}7M2l,ܞJ((Y++UT=L{AF-,u[YgB`@F܊5Auy#cox陶EZ>^^HtWM$ė_[YIVԖ4\BR쩊=5i ĤI؅(vR~p9"-K_=y:80 Ϲub9[XEz41LisO!3Ͳl_˭RXOP϶6ZNag{Ԩ0g `t*N"T}`tbks	Wd I.|߮t&w^@נ$&Q%N[󐗢EF݅$,ϰ45Kb(ZWf%/l_H[.`YoSJ<&t#hKMKx|8/AB˹Pk$ܲDk׫ՊKV͏
s irPT8)Dj	THaJ҈_K̷L5
VR3z%-DjIُOS%e>MeC*~G%⩫:䦎JdJib]U+kb`kA5;mg@䊦O0)d641v~r:dڀߜ
V瞏GU0s;?@Q^fabi B;cs;amU]wܒ&@x3Vjc1_xu;KeQۺRg&u#rPVT\&269e]\YC:zMSj9u4~'zN<ez|5ɏV~ s<f_-S2TN,aYL"VSǗo\^M%}ZB:^aWI=W,?8׿aRdE:[6eٿl-IVFy^PWUXGjj}{:9Ͻ82Y79֐&ߴ^^s6Ű^:]@ug5IVFcrK߂`G`ʄ|}4@Z7RoשN#J=NNˑ^N$)YO$o_/'s۸f	-BX\rCRbeC鸥	2e,w#H2XϻEyWGXYBX,ңWJB*~^NP:OKQ"$QˣLeTZL,)u3^V1qLޙ{')Lt~ g+MX&I}q\4y׋y1RP<Lw&NX4d"~ђ$5_'hЍ,ĭOy 	;7'>6'Ը?EӿаN9ظ)<$,B=j)tUtl-s346~JP=Q6-,Tpvc<d@C p6xVɂ?t3ϒ)4=8mv^C\Pf^'~f6-?&:WFLڌ*o:qsQx_,&ȱK΁ߚFQe]l/8E4E~ji9S!_s9)2Y+g eY~*i0{]{Sv7U*(H+Zsm0vo3"NI<fьEnnV
@(>Q|7ddlZ 㣢Sai"=#z3tovP9]Z$UGV+xrKg60ryވ1iоO#7
vz	#H2M LV|%ks)A<,o밬qKxXn0ξ@Bkr鞖_b$%<\ZaZ1@QOf@|$b-`|`!Sr֧'/m
'_5 iբ5ًۙPA)yo&R{ُHn晈'0J/Ak\s~hcOpun0=뾷j?݄::&c>a<Z,|W[@tV,E2'`,ƷS/^'xjŵ\YTqsr}90tL${o9)L45ki*Pc59}U	ryh!x&_KpF/?g%`ӣ f3D28c<>	6ЦizM̼P,MftLL!yP<z:! ȱZ0[:W΂$8"gBpG\-q|N,^vRw_qs+4G|k22jAჀX+Hku)'}g:Ƀ4ۅZ"X˪,a(U:XgURd[kΐ%Yxkςaƞv2q#&AHߔ$֖SwJ/G:rSl*L|=K̀J"tU
aWhP7 8ֺ>>eLcaY枽lcj.Ė9PB4^hL![FT*P_+D&t6r37v4رwBE&(x+"$
QOS3cwS_9IT6mwCbRnhƆʬi69kZvBכz`?]?m?MӠwCΊQH/`"8Su![B15(O4
I8=ڣ!"TK#1gimp-BNXY`P
=nu]".ZЁhɛțiɛ >Rd!Y,A_D!oHD!oH@Rd!Y,A_/@0)&n ݆[Ww=uQwmu*RZ
^Kա  4UfYJҰ'y$ɺh~Tw~`{ȨpKހ11ޑ`Xq@`1̴Mh9W,dSL㑑{4qЇ^*E\>h劉IFM%_뽲,[ꕻ<L,|Нs=γ(S-\'?1uZz$0݃9By u)z!rͳB9dZ$6 VDzuoJ%ƅ!O+4ne'gfV[^J+3Hu⫾~]^Erak7r}"nnio g*>E({G=ڵ
EM$7ϲ}YJ2}\bx2\X]/XnW[ >c(`hM*Uzb^\\qsǶt}Vm!rM}m_yEJܱ-*c"b]\"ܔ]84a	mrza<]3P%̀
K.<5cMZn%Q
l_s^5XQacy"|%-x1Z{
ds7a	ѿɋ+Ea1ZHͱF>̑u{X/J_UJ
-a3_m̠W`|$k:]⫫=ݑ;BFp8 	J^i4zos!f+jQ\MW&Cm^^X]Em;&h'~+>wĞlVDk,@.l7~򳰾ީiol[,zxgurS/ɅFh'+s?Adј^ZByQ4'B6pC	9hը<+a6gN':(ն_d2mIł˫rf杽g=KQtk+j6gvo/klu,nW5IZhAK3 3DԲrX^dؚ_[;\t
G-5-´ 7И^2`4[h[\ȌLؖs"{
[f,`򃾽ƴ|N)72^5KD9BM" s
3Y9)SsMQ+)fl=8``oe/dZq,藏$.8>a<kCQ[JOg9)5١`/(3m+LZPFf/GZ@jNZt+v`L'esO̪eѦ5jm&qctʺbfgxŬtRemL/>[ap­vڙT+|7/DkKs|ec3eUzзV*.,0rͯB_Yn,uj:rS"BR\en4Ze	-uepV#~~pYD9-	ŧ;],_	(;m^eK5IAhYHI%"aB>rv?)GgwT6i|n!HvCET|gS"߭-XgVF
N`H_QtTkJzq^"-q|WSK.>z^l/,_B!+7h|/N'v玮ngw?٢V2DL8[DuB4^"KU\n~)Fn0IAO C՟G$tVou\1Mxx33ΑZ_iOOo~k,/zWc%Y^nӋg#n̏q/Ov_Qq͚Wek! tVyl;<yyT":G1keag:)p%h|`:WvvNAjsbE6Mp{ar@MX;U]L5M?n՛"`0@nTxxpUiC|=<Zh<D+cMƊŉ?E`o׎뺧Zw %x|Y Nq.G)~ņu~2rpl|UaUq:S rAY$^Mc2 B"2K'7'| J]uiv9ᾦHފIqqp ƻJ|'i%^/"/|q?YUSxȎaQ]Brߛ_hپɛ8LKarMtF^2( #|<$"Ǣ|K$d+旞2S/^=uY܌6+6[-`60vL`z-^;iu|Ihd2tD{#e杼0G)YZBI7w
	#A a<Uh_/+&$
/NSnjifI,.uXH_e)CJpytI'yhƾnꑛ`ɛG#\pVۖ1VT7JGdП)@55w%mhrVCfOؒOX;MF&_iC+-4鯉{-5[JZHql؛cVE`3pddm#`HΩ.)ʈ!ަoӢ[[	׬Yc_.dj ~O;]kL$ MU5tutY@U!g+[2B[#^#d3e"?VI7LP)sQM+8լbfDPУJt"]_Ce9%0)k=]Za1wmV>T'U,.EUC١1ir{q)u3B̭)eV2Җmx}VUV*
;[r_.nR8]\PxZUl_W)Vnq)6oe],-sX50EAK5"dw9פ7rZʦpnTw1NuGvƖlJvTh(Zq{e+M^\fɲ7:?7`PV*?	gCztg?W`//vń"^X3z7248(cZ,ñ
id](+%T-|h^F/>jno!]۟Wov)NN?M,8Ùo=RCg 	h15\ą~pl{	0$8hLqp8-x"=UPJ vHhp'3r~dj7H"aճTtCɹx\58$;m-&waci1[rCN.HpGr0_rn֠~df͌.6J[F&ʓVSSu
8 9;[?^<*yTW+ÞHca[&R჈K-C-j=l빖QGʰZT2rMC&aYŜ-e6f:j!DvJ0ҭF<{r8̕ÂaqIBXzŦV8.+W呄=UB*[U[ZR2rbxe!fH2oYLX.(}%{;2D;ҩN2@m1X)$j@	a ̸Qv RӒ|3OF6=\y_a@YwcWٮ"Bh.^wyl,5~7BE23 Hq'CZ</	S۠`/xܳZIVLbˊAP2yq1kmr[H/(DLf"q:H(W?1܄,R:U=NUEҩUfb)ʚU}`x˲%23^M.A+
Tl]f8
 ^6^Pc]0"#$~9EMB_z,ؕ\\,
^9Ps9-88,,Sf/3iY-o$me!-M3ǩ*\QS**飥ak˹>(XLnYkކW-LZxV;K=e/
-ZMcl4ix;,׬ּKÒTZ~,t}lv1D.>L)ze&@KZ`픥Z"*tbuy*㤘,R 7ʹ2:HҔ꺘E]bAhk$S}Ɔ'5kw~)Pq`߽31;k*uPns`s!s*g.NVn2U?J8oan9;V]"mxŻ	O2Eޤ=euqaږ`"1*[S6[03TMvx-wV㋈űB̊n@6+Rm8cN	D+MT׃7\.תeComMl;jaSش\[ƭk waZYǍ6ܔBVY_QLlQOVD:$;#o9R# ڈ 2öb
p? Mϴ0(K[gsϔ^1].NVn(ˈI&yh$nhie*Jh-ހbO3CZ+?ju.[^$ck#rUG|Y9WƷ9zՑ^`X@5N$>h# O
WWTou2=_w+U/8Hyd5eչ_tDkSZy:O/48¸i2E;BgMnsz捳2GdF7GZY+:7Cs'hrŗ/Kb՚#sտNf7Y,Քl!?~tw_^2y./ߦ.>]^2cgt7UMYDz95.E]<BZ5c:G^x4rm6">W^Ig7ͪ:Ɏ0<oFoL_&%+9{nW1i0kcF7ʾz),΍ .K,9+%9w/DQkW?~$+}S	Vk US)߉дfRٱLonL-8B6:㈨oK~dnY.n>W02ۢ,6X6ZZu352PXjB78]ai}76~-qfmÔ8XSoK[Λ̛sr8EPgr:Tg*ƟB)jz@#ӳ(~)ѧGLߞC`	:bȲXXɑ8rOQ'ف{o/<6#EiCAӎIQ	6<!׫y^ϝJB%c5u~B_[íhCYU	_EgS=U~OiG,XtbASkmYSyRJmJ$, ADiUٽ>Gn Q>cE479I)WzsӸ\_jiRIL?UÒb@}KX%%;OVrQ1}ʞcJ\qfQ˧ @$oyqKUreEFg24t258~WYg5Obo媭iJr$"/W֛j}ƌ;]zf=
5jceMҏG9&UVӭSS3ډr;2̷&Q-t&g)yurC\3g4QS̹:)K$gr[F]2[V(H{EkX_f8}i4m=Y+.eW}Y0#:<K="u!8PN'D1N7BaA%3E%t_OA(mrZ`9>pD=$bVMp{A"oNZ@~PXǻ{;ۯ^/	$(ouŞMbC:IMgYNw2[`F|،*$%v-uKv΋-̄m
"tͲ%TIzFsn̊҆usKA,˗	|r?UWdy"@>ޢEȧ/dB7. MvLQ/fo٠5+2C/^״n[ F
^n_*)4TǏp,v d2.fĔ+u.0[[+p
^x(;.̒U1C2h<iKΛM}􉛚,p~KMMA,vI6f[=~u<ȢAF5&{0O<.a,V oЯ s"F/|pCEW8=B4"@||<Հ>(	Q{pp7҇`ｊ8DO )O/Fޱ|Jp@#bE%	9}twyJ.3U3X{C0!|$nZ+s\Q%ۡ;-\9!f5` bxmXs{?T,]\@'4[*u>澹c,XEUte8vkYFRJ|r77HN<H0qSMk\*f J1{uhȦ_`n]_&3DE#8Q"D${JOY>	̑I"L'+)A8C8$GBٖM1w)2=[otaLZ]X/cxKU|]<оWi-б \ZAjqE#/Tֿ)&K+(5܋cfjZfS f!kY*4R/=SmܠuTͻܫ')[X݀ɕW71)YϡK\ \ HbCA\t5 b}PeV5[+<対CX~U7!fyUC`W5$IE*dETLf6cSlMgÅI%,XK9GaJ\:
;~\uxoˢ'0b0,rږT4o= ǲx[HS,ZTE)>xk^Kl:?k\SP.E]erErWL%ׯ-Bˏ|Yn%
}[+|xߙ	Վ
dLccr無P6@%.Vz3fhm4V-{D!Ux?3 X",;a(J_LG&]OGZUϯ_/8U3q)_^kUyת"k**(BOൖsL'/$j%%|Ktr{'ٶe*svV79{w\!JvNqY5#9opNۤ?9I8VZq~zLz
[q>7W>Dd4b`r cKk(qyYjh qdemZZ.t}a*/uc>c9M3zkbDNQq>t]QO'0JEaH`'r!e;\CQ>lzO{ricω"!\# qp<	 y4IFWo>d䊊Ή_be>;h^?ғ!P ^QGM[r~)ʙưɮea[\ CD"nBO姝)Ry*VxJ5M؃JD܏	q0OQћx8j$qS<u2×\Zn}W}FJ줟&&;IQzgr6(ȩOWL]{Ѫy\"?ϛN8bsmw:[C"f	Yυ "ʏWLσ-%T-zQ!q֌k<b$VMu?83KUnh+eLCӫiX5Y _g/SڍT^~~xj>'+'>-U\Wh:tPz* CH`PA; jt6ӭLOK(S%I6`^ 590'МrX(('~JK\dzV>WmDJ[I+?^;񒤏ڴȯ4ClCÇnN)yڽnCSd{S@	/a"ɶ[*'s7)#¥r6+z	Ϟ*;lB&$y4_(x?/aXe(pp_m..KWCy y(N&6KUoYk#<sΞ ؗnGU0hA?;_ 7tqQg FKV-hwfsU2ӓfYڙjg6bg#ΕX$22*56mq/H':GG\.mq"$A3,"CqCT	||cTj[)i~>R1/ qxMF<.:	LuW*bYٜ RISzJ
wS0藴+;y;ꭐQb|j{qn>_<ruX笽D5nhIWΓH41R+<+lGaGC"8
_y-9C?=}a뉝hv7oe!bE_NBXr;	[
	-\{r	BFX-R	O/L5r!:)m;T.@=xUЧ:V/>i~[fh9bgU
sN~΄Slk8d;o,/eYF!Z2&~_Љgg~#<y^?Shw@vpQx{?0	$#}v|~L	Ieɵ;}&<c8ݸe(jTɝH27WV<6f9p]>4]ʲf-8%#/ rR4M'Ӕcuт.ԓrnJ2Ɂ}.W<~{Fǫx(]@f+\zXٚzY&H TCc%P-
-R~|KvaF4ec#8ho`4ZώIφ1VˤN["ȼe[j4.^~k^鶛z`ݛGxMqޗdGG3zɥ\A2no۟O2^o* z:oGluk@7ס7nyVTm%?RʰhN<~d\YiEA`?zr1(hxH` ,$9#'bP9\V;C/8a2|pH/_}<!1R4&gϼ}u{CA	G,؏A˛zI@G!;b+^},@BLi<Qsmc"L
\	Pw(W%*L|NJH<3瓲MB;&vW?aVQ3
2ΉMN{>6[*xv2=-B6uj}ܲdmB	zOөIb$[j8)3LpfbABV yL|=4?xriymxv?XU7t${;e6S QZvA<"$15[뇊UT@&
yTynPxA  ͠OOv͔1goJ[_o4۸ppraɷ@90I	2[~abtlf&hw!e	tgYXz~	`{Fou_r%N  z}oOI&=[*/{Iq4d_Lj`{iH#:vP9b>tqY[ Hg?ownސWdѨ[M*cg^:8 bw:eb%'*ܸZ<qfV~'o;+vJEFd*IvuP>kGYREзK[]ǚȺI2&3xvSYQ7/;D]CVe{nn'.87zv;MNUE9lʁwpmA#/g'4%L'0FCu"o$"׊c?.
׼kfivct?B]7դ	Vz9joܽ;7;Yﶠ]kV7~99`d]PX傑L;O_nlmCLLq,&Zāof>ay _i{	[!G ]*7[<t_FN"¨?V*2gӾs?do#?i}qF\;{B&}O/`>HaVIzC ^nyScy|/)՟g?`?=ho+b>#%{/^*jO/~|ozb/pȥp{zӾVl=6Izu/nK˳~fʹxwula6Fz^ⳟ7w[5WzfS@ozw6Y)Y5\go3ט/O,]T 2a\(_7!/s0H(->5i
/ox͕7`0G-ep޼o#KM(sƊ5D@8jokvp%}쀂"r/^6W?ˍ:aID釹 mK-F<ςͤ%^xO`ց>}s9Td$p6_${qAYM6G݊
gT^
=EfM#wZV(8ypF`d9,DV//KNMц,PG"Uud}XV^G<UۏCo$L>vw-~!V7k^oq]WTmD룧H$$OnͭTFOdr͕ ~Zf#zpguׂ߮ZvcXɮjPT=fU&z(˝4[;</֟{(kMZȵr\hȂE]^)qKך7"L$0.V7XXGlKۆK7\<nڿw%|Vg{A<}$$;>pwcM`9=y3 _fut-׆V&X#3VXv*i2BR*Pc7tﳻ+/3Jd.{nmݝ/_ra?<P~*c='|g*>A:eq-#J~4P骒F	\zӓGӡx#'"j2cѨ팒4FPd܎bq*t}'s'鹬,^\gx0M6(xbGɚc@m78m}G E&(י1P<0&[e&l<N1"?4?#0_FiuxT4KÉ/8!zfuo6:db~1GkURE=9=xt62*zެptn[г1*C&>_m0]{4_w $ÐvF/[V@ L:ta@l?l (F 6[ =pz2k?`^m4yYv{}ݣvBMcnE6A^gfך#4YAmlxezs,w!g[z&of-`xЙ	Vs  ` @p<lnh( I eZ+K14'db0ZґI}3KMrg	5/['Un|ɒ7لTFcX߻nR(tXyo$T{+x&7!!?tk|m6b>̣{{IJCguc+PxGT=t//@G;m{9i4UM>^(:<As.GZyAf#xG:Q{`
-|>H'\0||`	vCVG3TAKũA8
B9\i`~~zCw440A~V!#itgic&/{RLca\Xa](|zSyzP)(~Loؿ$/
;/TaЮ
5V<xcnBﬖG0\ŶҽCUU2nIv۝΃e6nkf<im?6_l7d"`Uj]+Zw96"n} jx5XHg=C$A}>m>ͦ^q~$m茚]w zwl6pu`PNz:;e?pFOܷ.ᶺ-jN6Nkl8r(2x5\
d[@tcFO>@7\azE?X!N5p{nvZMmPUՁ<mo0UDnMRE({[@iw z-h:ֳ )7P]~xD @EmGPp{_ǭކ惮ytePm g4/خ7 ._>v$iQ69g|juX#xnbL 6:r~[@Aqx}tVBZnO=ȋTl*{%6|=bqAhQm_vkA!nxhƺ|¦"Gߠi7ņ\o6_m;Ǻ0L"cLVk ~kdqNA{x?zH
V JBS`ytO2ڠl{UjT
xlD;|Px$:.f_J<_֫U>iv_F%^h@kAiS}M=''ߋjf@^`2aMοarCvxΞ%iCF&BSD{Xj3/!}5x'ENyV/QzI4̉yt1u
C#ڔ6D@ OQyҨ]
yGѡ7:Ѻ(,~ӒFj&ㄡ֝،}u:979ȧ,"9[m=˷9e}yNKe?yƋE-r
k:2ݼq}NRS9Dm	c+LX*JblQ6NQC^I&"zNF?a0Sq9Lk_U+C?_*W`-OnMҷtƹ#)Dȳm0/724/Wq$ZYìя,1"i2yݻ˪9Ҽ=\	ƷP.эjhRh;!൦,~Ap	w0b,{Fau8zV|>/{I}uY'R+=Jȩ$>Zߴ[cY%Ypߦ,_Ӟf,30[Ft?p20|"+x6\LQ<h8/aHH?@>R#aV**0W,ꤴܕjyj5aQf_Cd_!7)h$/yuFfIP<E65FQ8:?8,U[,o~,M#o\nL9JIbUJTwS`ԹJ2YK(=	XuTYϪ?UŅ⼌AvD77PLGVz#S>#~dg
?4F)	@R#d;eFjָUֺ6_i_Q+7
^
Pp3k5T04x+[_MNtỊw"1P3>]4m69͆	[˼.#$UȤaMwBxihL8"
?m`݌qcdfD'qy:G
A9^`fڐ&#>8TE?.t@_:Wh+>{DØk}Jxckw"=Q 4.A(E\U̜!JuHR,1U \*@uM>p(V)C {V]2y6z&JQ\!ľcGruM5xfJ|Zm[WItҾ!:KYx5{ŗJB`:1VpXc
IJ܉aEJ '7?UCNcՄwn4/ukjrLSБ"}^{9z9c>
gz͵_}Lod(pFl4P`.3Z?XLmt~5gx8K`@0XU^qXL#d)Jl7+-ɼm~sv3\b%	n bWxP2蹟U(m/7QQxaz?tBڨ'^r"bPfBI|"[xMs`Kǉmfyy	Q͙rt䈄2'oh TDI T&YHG6L*&x6l鴙w#o>\mZ`IF`U:¸<|ms}]].8F_j`;J#^m8	<9i~L&"Yy#t1
m`'gfa,$9}AGZ"GW5t!˶#$Cn/h89Ho1@tXkB*t9a=W	V^׃uQ)_3hbAQwl\Vk7DB;t@UAWB;HAȀrGQK,*h~0gJPٴ5N>r)K?d^\-!^t{¦<PiӅ =hysx(YwYm1*m79+]^`!͆kヹ}J0 4FW F˾3) O1J^~8HO8IN)BȇfH,V?4)x{xas >_ŎW`ag,o"'hHr*h;-w C>fgy
j>c`-骘;p_4UQ)*Mþ<5)ɰ&ڋ	p	[<#5A<g&Ae;7jM08Iۃ
єO]7Fon(,"nzW3H.r\9x O`;FC<a^'D<1Ka~fQnFj<f,HǇ\vl[,fXA{񜤋7f.`6+YX2F#DxZ}}/q᠉&FP?hV_2Br41n^	 y/"bH_QAxjF7:! ZsC
G}=?c/>?x01zq>@x}-%fC]e:dvUi$unvPd@n):Ѵ<BjP$4^K#6o2`:{'oYAmUC}a~ғ(.zNGe"DXswARLxKfՔcIJz(_"X	KΘ^f[9-V`;ӎa+0-
oG~PtQU4Z+NYJU!	vy2Vh:8,*y#P9&# 	m=q&(-
f+*&ju<0jRj76[#뫵jKf<,?FQc?ESv܉Fq6:ҩ&=_,};cڤ
*Bh
3(M^IY@`[S1ݖLcqרL&-dW(Aߕ~c84xr_E8M@]X2vvvnҳk)ZV+j$w`DSyNseFQ-b8GPsi17۟y/9G?9OiTHĚ\B~-\LķA8MлgYW[>q60l{~qfbC]v]wDEp&fWn1.ȝ}تOO5}5Y{{.6*	Vmw儀#| ̻]~1)6<~dN2+ub6%s;NŌ6:ɧӶk:jHD{:RZxT
F&\"0aoL]o:%]i!FB sc45`"8މ'wR-~3\	1z2%z
k3eBr,V|63u:誠ABnd/
hBԗFĵ|(f̈́]ʒBi忲͏W9¼u>Dc:<Cwo8,ه#ecn6wuA
}|ӻ׿hd_5s{n7Z\5J{ 9GfǏ]3'y'<N#w,4ms>7,h nafXHDx.1o2otөp^;dz#ȜMhgvohO\^hej"Ab+cGX	6ZN&?3GR9TI#l~d -pN>Mi@}]|m*q0{<˜e@0bȝM˙l$=,ϊ<fT	uvT/35۰rD
.jz+ٱ evO$TY

L&FIZ]L[Vg3"^L(=PG7t8)%(f77IeVQxŠQU$]T5̈́:⿬7ƕoatqa`i4U&k.˭\obw!C4a}jt6*)<>372kҪ4'~9(~dLAIU*w*7L*/ aݪl?JxO>7WkFL7VƜulm\o^tnM >sUB"x\|TĴW^ƣ
*k.w!LxqCR&^V*1`TL fY2MѸ-2%p$'1`U ?Tma(dĄ0(d "O*rbm@kx۰J	S2@49sh]oϹ|(\7f"~GA8_iU|C[QouܸPDbk8$zuBե/MpX<Mtm4=ڀ$1̻?ImqF~_ӓJ., ġ|}wǷ,|/J_	l%@h;B{&A*T<
}6ZZXJρdCk&Rza|`E+'j&mӃL"{ϑj?x'Ȕe$u캃L<,Y2&9M>[LeR%*&б}\ !
\;SDBձ$<u4`;¼p!dNDklA0 ACҝpLNpx8G|w@n(iGN2V0AL؆ rh{m=Dx2sd4W^|uqZhv	fyہ}ܳ`}܂2qlܭ^:,.f$Ň,k."($W.I$v#xh1vX,HT	9Q"%:n%/Z1 
xN>t6"ЅޠD[@@hLfħ|[ZYZ&~R$~W8ye[iͻs-,q9u牆8=ok$5<"=Wݿ任O` X 