#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 "] rH(8ɔ=y)XUiݚzFd V& IDsalk__@@fUMTK\<<<<<<<qsP{NoKf5ZnvVo4Z`](vB 8tn>d%v$礁9tڝVi..a0Z]o7_NE~~w(8QX?־wrꍆG.fv_k_| ywZ_K^4qKߏN|X=}ɥ_EYwy?`ʆsǏ ,t!Q0:#`A.=`}N8#vczaXjXcz{,^|wƮ,6>f!NFL]oݦmC@78%$z -A8p k N]~tƓh&T	gA0Z}Csa/{5JVk4xn_q0bFZ64=vxǏË7w8T3*޹iK6rXes^76 A1T~naBEȎG?7co{/ȼNbY/؃0܋\IAqWtw箌:Jzi_ۭ&Nv?z9ҒwcYO@Qp0ZiNfrXo5i58GЛlqv;i7dߐEt4d~;WT`}GыYc[Z!`gN{is$jc7+Ҷj6;rD<]{t5ۥۦ-ۤ[C1g^ ١";TdvbE6&ӤbTLɵ;tx5E٢"[TdlTN .TfDIzl>Q$4S^eyur>V;HdhVb1,+)kꎶg]?`j-a}cVRüT0H0j06{Zg5:?4=/wy3~AIpy)_d]q4gT$UFS($r\}`a
W5'Iy%yuЌƬ	6H~U+8d}%Gn.INʿ4诰*~ni[G_V*a&{ē!K8	={ǝݝWݗ;h7w?ҨSo^A=,CAis瞟4A*>á5"4ɉLi6&;yLͻM"qY,=cx[9끼ht6Aڢy=hje^nO,ܿ8@$b.XKN ;qsGfr Wӑ|l!wlq	R5y8C^N0geo
U*Q+Q]w^RU0ns_[I{qh~?6Do#\/WWQ4sr!|iȡE0t.2S*.kqz1$`^_TaPv%j }"E{OM@%@gEE	R٧& Sz9Ls6GXTBBһF=Gnn7,CrBll Y$6Sf|Op9Iθ;/vwܬo68 	6s"L˂BpMhLܞiCWgPwFIUsw329XkֈNo,T *AprR,>{rkU˝ʞrj+$p.Taqd/_FTC7&\ePEdD>}#ND^sO?ad'	z1`-3n4#S	@Haj+˟JjY#NU#ɰ콿:㊖tu.{kT׬ΪՄS)@^VEdq
Mzs	`
R!6Z48:bʾҌ	sB9؀
;)򒓾zy1r_uoIycA~}ϳ
x㛂eVN9Ͼ/lֳgg
3W筽W?*dGEi|sfHUOE-݃*)ƍA:  EOrK8\5CԼ(Ŝ.?SneD*Zx̙I|_y8 tRadP7kB5C_S$9f1܂qt|X7Ҁ9O4!?-=`1PYFƨ[@'p̈Jf6<Rbj|ʸ-V+Q_-%oh</l1wz0DW*09}y&,|٢yqT&F7Y:HgK9 wt*BUTBɭie93Ӌ=M4ɦxO![տ<:~kGgx;C$C&f(\$(gy]*Y#9C_eQ.?){=/0RI5Ʈ_LhdM%DG&εQWbvX%W>C(}@'S`d@޼bm:7;v`el%=yjg{5OCJKfXifs+^Xt&o1<O,s"PK1dKYINEulqJ=E`OTa]Y-XbknߴB.H,@
*\l;> ]3 F܏=+T2o2ͯmHv%Svr(fDqu2E҂$&hؐrfgj4S"8<WQ}ǯ_~_WE;;Kf?UL%$ӄ2E֔Y"ۡĒKCS@QT BLOM7crixR	{)]$5m^[	Od.{w?loE
P5`2,kL$'Llj1WZY>nZʦց|fqJ{W,"w#@0b` `/)eE8RE[މb޳wYLۢ%	/	~%ĕ_[YIl/%pI4%M`QHzXXW13s69Q[ۏ?"(W]l?7z5r*[Њ}tQk\:8@0TLZeŇm$4iLys,(2O}4OwFI
c	rٔ18_)lP䆰 qbt".1C@MkH'IoIK6 ^ʐsD07I^c`@)P/B^	///~/S@r8p*ŴQ!CىE^?=72U:7_3+ty҉bL$4-m \fJlPdl7Iut7nWHӚkfMsN]vE\O~XT.`}uvWgJ3U92xŦ$mƩ%a%oT3V
)j.[LSu?;?Obj,@,<uMI;Iۮ؏NIf%d,08.Ve0XD%{ekx"0}e64(UCj>273Oؽ+trBsLVb<y|$VX@n$*j~0")Üqʾuc'ubNZVshAs>5zy]Kzk`2]w2-zX,)}.P̀6nTfQJr@ddJ1v+WWfz{4\',S
x.WUɏF=7XO|mq'yπj*VYD>ٻϮ޼#:%>)'*2Ւ~V7+e7komOdm]Eo}l@r"KjJTab''V*=%ъC_^laMö؀cohs5G,iܼmt\͒"	(DNۼ%01vd:OȶGpG#v촤EPgd.iZƥ#?é7h?nl*ܹ4Qn|yuO!< 2HFٹ7l0,ƣ&|Otb$C/"|_@%y(Y%~A>nEz\;44ޡ+t~{TQv+|+"nɝ>A+L&X"
TV$82SLRLJ3Tٷi6a2K03gEK2tAB+f[ɖrȉVN>rhlE}Xnҗ,4tX2d2,GW+D)IRm4nSvraڙd7gahhE/4es&f&D@k6bWΨUUu&+@pEA]zN	Bq0dUVKb'Ѭդ,;Z:uSԹ?ӿбVXع_3+y~ftA{w*NM}e	YKqF2b9(},eX?2ܡ74UrNrZm P:q8tjy \C7IAfiނr˸ßMʌ&VLFGbVtt*'Aɣ(.'|a7`E"#I1y_Kzd"tДUTi=2^e(wr7ȯ@qf-I=אjP`QeVk~EP/(,75n=Ȓ SRi8Պ	 h60·xeʟ<-NEn6yDO;_"j~Z/FԓEBvFv>8rc/Gci$oN]r:K>rm)siVƙX9ʑH2L~y"<*&z6XZ_N'\#|T:5fk[8RIsLgcy9DD),!mԘSnKPnU	b[B0aJ	$WTy{юI=΍r9byAZmtIֆAyDkɅK|
HGw	-$IKLI#TP$Jb$B$
4\'J	*:,l팶?@ \DY*~,<`7+wr: ؽ/=te jgj]E0MIs6pk	o9$Q{8s^)UuZ"EEy13~zڙRx<v%[ʷ'ML^U~ݟۖ!&4g5XLiE804h0!FY3ښa$q}&uLRxNx&B6'A=!ĠҥI(*8H~F߼BP,Lp{t[z 9oJxXl%El?0\e`ץ0/V8`R#%$oAraL檖ä QX1	eRBÂ1Hz{IMȎT$Ң.<yUڄV8u"Ņ+⒏X,;G "n,4iͧ7洓q,1)MhZR 1ޗ92'V!tCx)-΀0_Ibyâ"<cOO n$*;QqRnyE#l)ZP@hsSa`,`[J	A8F*(a?\$Lp&"rk 13bot;9G(Yen'@x̦A :>
L	$?*rQ"M'3LIvM|`g&SvLS^n^gcy)B"JAv\R
Prgÿِh8zY!rMTyϩw0f,H~(S:Z)\F(tZàTX+uޥGu?M?\fb$z4:EXڈ!_,lǝ¤JM%bDXeBKڒd-nKJBneحt	^5ʛi˛iʛ1!>Zd%YAV/~M%u	|]_%u	|]_u["+u*d|D@+c9i]##H[H֓䮛ܵVr,,?IR B3)LL
hH4ԓ$usu
w.?'NqdZ8,1n'Y0B'o2$eYbhGsLRJ*)5GZ>B+LSʗQZQc4s#ȅwK^ďnQ^mfnΨS'g|Lh2h2F+}MMTG DM3Kmt]댉W.*pCC*	8 2ݳL9*eʰ$PBd*
yJoL:q5\ V/6.M7h?)EѸE\*mW&Xe+*Þ3z!]^	d1H~|aX:
ա]";T+$WY[B#TYY5lf"^iZc0B|#!y|}█W%77"\)ܓ-]_lE_ΰt6<_p3{J9@;+nEW6MHBY^jO"m{OTi1`T)ѻٴ$.so9e4$Au#zH#$ބ<4eZQxUZ@<~e,BƼ	Id47"0sH͐u#fz0*/_T
C6G6zkO6~&.e=PE3&5щoC
ڛc)DPpqnư*y$w7"e[H+x/s~w3[X#I\$ţ O˫.ڍ_4}2"hqWuF?􏥑FϮ:cԼs2q}82o|]#!Ei-qJqn;	~2*S5bAk°t>S4wL{~ 4ɼVni@Alh]cK$n2#Qʦ{HrUWP<39'%`rzRݛ[ݥՕ~5X5p4tC?||cB<ؘ_Ϋ240qnS^NLaӏʽ@Ovʲ|0N$'Y7:t8. (|`1[0m$33JѼ77TvBjEQB\'#%P{` -ơyiE8Mo+F&5wijEka(*,囬if4\:-|-SԦ-D d`@UowaF˕KQƦPbhfPtt[f* jպc.˸dȥW0w'Xl633nO1e;KrY.nX·ьzcVe;{+QeRl`'8wv9L#%w.Eˢy#	R}ʈ.kypʪu:=0s1ky1KVZZb3	XP {ິcs+ bQM~t^S89a^T{2ՔN
oױ1n\G2㞘I{'{W1BuIɯ?WdAu%f7x\x]O>עos[7hދḒGt09|Sm(~MEW6}XXH0@Krg4FM@E`Ͱ%!Uyѝ2P-ÎFO'ư;rAw{~8>;pS'U18?$1a9z@]ȄEs0Y+/+QTٙra"=^Z⛲щf|fe&Y,fYd[zґex:t +4-(jZd<5Ӽn}G8tzlUqqP)ήbdbg 77\di02\8Y׫$^L]W[4 fki8BCm.g(B!bK27qp:'$$S(51n#$Fɲ $'0V8IRd.MnŶ:gw̫["bRcsgӸ"A8]m>**{Us& E-g$Z)țM/G>9beCOzuUQ.|zWcDyslg朸r0f({agu#w(Iv`0}Y]!˹(˖A zgg2<˰jqBo
 9U֋0!BIvooO1__-`ο~UPЋݨȇwRf>uaB>w<ѻeyVnt'0pÑ(ǻ/Sf8ǻYG5@o!4F(N(z]QܨD9A{Uwz"JQ$r+)/<.l=
{"kNWߥ5N%qvnŢce(LC/D3w`q0\0frD';XQ`ZaK]<4>E=`c'^_wTFZWGEgr`7#~IM-Rh"dp9klbT"S^ҍ,塔՛-8Ӆ9n(E mm3j5eU7V0:a@XoZ]s[<G<_rm^MQ^%*PXNh]66S=U W =rayܘE& K	/SnJ>8-2~&SSgjY@_g(/1ԅ%V!Uܕ"B&'A0dcη1VsȬz76۔1
X7Jnd8+8$/~bB]WvJ.|Ϸ(5P`F;aN9IόoiM,=ꭊX+~G2գ*\&q
jfe:">Nϓ$lf;NI[p]lWJe"3Ɉ}8oEV=5kA*ŷMKeZ`i(b3usOvHWlncҙ(9ii}ժp~@,6EXQ b4fր5,x zɫ|LM<mE}F#JDg2`^c,~PӅ xk:i(q<p(	t\DPɘ	:OVMr;'Ym-Wn
8B(*<U|Y~M

ˠ|_שVnq̨6kx>e\y7mK7^:;v^j0tnIsZTTBvTڇcgD:tTpsE.NQr(fgn\y2w</nק)PXzf[RM֘f'8dcxq:A/*܀}kKطa(MHVAB$\@KܧRrYd{-fxq.#Ųß?gHx?P&P؎p\_~k:DyJIDWBH	ef :{KҦ0so@[3@5#&!l:t ,/J
b+gH=DF
;"0D.Ɓ/, XȌ1"m
xV&IHE?OB\[Fɂ3s̅ďxQfO0Z;UOPj82.{fflo~|gdZN$	5IǮ?ƷlE<ޜ,)x 5A@sv>_ D>QVDR_Bk?Mяְ-AKǞL$ZU"2^
ABIE_-m*hsDvZb"${B\:nk
s|!$sA
:q2Hܗ'I\u'}*C?UJN|efJcZoULa݄]_\f`{rJ
Z_u&Q",$ac7:
 = ɏI%ԭm7cϏOgf<\ tF\R$R%)B5,Xuoby/d FFexYq'g~/	SJ_ՂĔŝF=<2nҶ8E4)[s$z˫䓪Qū P^Ҁim$L_
CK[Z/Rw~'z	=\.IDRc)<x"mfk.qrOIyR3*A(Y4bB-5ӳfi{Q)	ZJ<&哘O!ǫ]LigI&wp[<n:f#%^WJ2_κEAcZ㳰kLR~2[%.kl]!םN'Y~X^À<[SL'*MoM_-5_8"9%Q%AiPi󳘖Uw\V֯1UzռHV3bp\ܟ˖R?R~+TSҫr,w{![2O/&YjEH,oml_c60;mߨk"aAʾ0V`)30dؤd是eX=ܧôvkBiυQ+30!.B~Ystr^-J}C`|޹Qȵź0oZ&8ozI=gf^Mhټ5t(s`/ky~ l!>6PphcF0eMMZTxfBERيюHZK	 ueq2\'TX,C7')D(p]ܪ뾛crpwc@/^8S>mԥȠļy1hUY^42J:F19rG=4#imagƙv5s\	l¬ET+a 
yg1_1KE8~!sT/{PmY*Rs0}b&(Ȇd_b|&9AR&[ꎦwKY|i(Ӏ`4*VB H~.S?*I"8i/Y`e	dd6q2)6C T/@]u2i&΀AZ@CcOB#51ܧO+70pa/N
1ACHkoظwaT5$q"¦SkEm%59vX(3})+rpRlLhH63'xd9Xd&ȺQԚzV ~;2襮V 5"PdhV>}*Yz9CF[
)uDx½jpRiޞ spFU-ЖY8PC"fh#.B$RAq[T*3m>2,`@},S*KMAI%^]`h:RnNTo.G(iv´hPuYdoAd>/yi6YI/N@%Gx#'TIȥB/iӍk+<?Wڔ|hzۋ$3ILkեi[g,p'Q\3Hn*xzG>i<4<EQS֦G:OD?--䜞r:ϺYBB^}LK,i{uXU'7<56Gt
Px(Du>c<ק?Y1/v=Ơ;2ڰq3bzrcSǕI7&/(qIaz=]!~ЊĦnF7)ĴZX/?UP?UgGjtZA\xL꾁uϰ('n`<eFT}(k=/TU7r	d@r?OL.WQb]?f$ɪ߰S=S'DOSU .\'zWWR˩VQ6|e{мRD5kʵ*SPeV
O#)"PneԷÒS6tH/c|}tCU]%߳3L)]rDnȩkD!Q-:}/qFJW
D"_n3-㱬Z5}Vn)fݬci-ؓ|LӃ߹0aDuoMѹ	8^!ʛS#ϗ1wj`ko[be8ˇm:aXF$Bg!\Wg?Rɗo
A}z^U Ay+lI*6t`R{v 0fFxz(*]%%4tU{2xfv<Jq5΢4IeF17fE~CX;Y4_A^q 'l=BUmlq0e)8
D	ӄ\xҭH~Z*9ڷ %?OcLsXy	k*HR\ &
$\_tIvZHyqnhA`.Bz,I3]r,մxm[jBy7Y8*w{m.O1*6١bC?1ί:ɓo[
ɚ6Є~MgH1l惛ITp@_6;ECGxϧJ{D  14Ȁ$хDW}/ B)XЋsb3׆?|Om#BE59]tyF5sMHӣɛ0	x*nOa/r*aIup#ClJP`W)1!ܜ<ar_͵#Ӡ`NAWރ4q̮RTIGsˁˁ_*Cw?r`D{ƄKKǨK~`Ȧ>2j*nX9i#t`L)N?ݡ=4ƃ*I]H"jUR*ţ&a̒YaJjKyT[ssEHІns!QB3_helO%B*95
`V\1yd<^шakEJIӊJ"}da6{XL3©ߌ3*P47ThpQ+#S/<l\M~ͺZ ~-h7`}rmFt*3:JxC$I8 q@!z?u-ՀnM6rq__]~I jUj(VCT=OSQ/e{_()&ϳDZ,L:rFaj1҉HXhfW}rAQ_.
>O.TC	i +ű.b[n5 粙pLm3wk[4I)DB7b-TT5.)f2r.2Z*y4u%3Bɏ|QƶR4ʌoyO|gwX ,3ߝaFi)aXYTWzӓzh*s^j+[OB	lB~~1}`}1<?<':	Պ_՞s	K*
c>Vw|]sZTG`$V5cPQAYa:9	aImU<T2nht}Zg#_ykDՏ/j.3wdd#c=1^mo4O-Fn5; KȴE<xcI)E=\kn.BvhIqd"U"/#褠S ҁmȇ|YR0@"Y^8	s[KYC[hTN=&n#w >xt	OS1l磭	
Ň3`}OF??SLįx/ż@>xa}x<$#u|+Nv>6O2R*cvE;gNvŧ#<2_+(,85B]r~1chW2´-ћ7!q$V97P%I5ЁF(	[LS5vCo@ġi]GՈ#	zf=>%؄U3QGyOnch
Wj|%W;k$A<{o?\'v^=cګ=<V¢TI{޴W;<s~gv*DAd z(tc697Nh?!ZY^GxEKt^ʼsyUcUF<
Pt"W`3*	`Jk>3|Hhf|]x]dUYٔo.SwΛ><"pUI ्rYD]6)Lj!tj|%'"A28KRABl{,Fn6hF{39B#J?lzNF%B&c4=^v@iFCAm[,N쒬濗'zO遬=IS/8$9|7pD1t."$a0T$ D2<nlos9JLd3wP	p?9]USq!+-\-@߷JnAuRr<m-5,P{nUWŢuZ_*Z5X0]B
	80.y?kglntA_W8)E2|}`=__Y.dT<Pqs6\ǣi֛u2~J-OE1Ky##dղ-X 0xiiI4rcZC0wEd#xǫvZۈyP)M3H	7yj,ծ*iGI@̥%ʟg7#_xh883]GjAa)Y^TEjzR,\yW?e󰢼jϻVS3C#w)rP(,9LXmYe"ȍ$ہ("Xiޯ<0ؑ0GN0c^l*oKl`)*Ҷ?! r߹8^o.@µ(0Ox=;(dUZK ~Ȭwp7wݬ$/I[lI,oħ#mKļDuwvrf&E[;y'qC<dxusL^;ТA0q{rN<[`()1D3>dE}w&{p6g>2jEd7?~!cxo@N_Ak|7!kկcDtG&ٍ)W@DuTu/-`砇iOYd	l˳,)ƓiЩҚAIi֞&ĸr'SD_`_auF)wZ/NV@f!>(fZR³Գ4
EW2UĲį33F=ybkDȷ ɦldbY'mxyX~6i70WSBU+E\'7ճkn~6k:z;4ך:J@9!}(HɎKH~'RruV{^]\j_D>Nj`7W`l.v>va7#ܭC5`[;wKKcEq^,9vL٩Ϭ&NyQ?-HϣbQG9]hd~0<SXa%$:#,NğPz8R:Xy0vli7Ѵ!#M}rާ+9rYSd~qpɄ$]Uk|E$xV5;,9bv}KݵD.)&U`+rŧݡP0.2uË)!iRK_L67nhq0cX.E9ݗT;0hi|N]gbq,sX|˓iW%ϠE5CV^'`.xڶ"B2sBɝ(8wf dބxY0Bљs83O/.nMR\s}|zY^.=_x3ưt {;7K"K9Q R뼛v<~Ipc#cKFT V`E>^!';q??Yϝzw41cot[R,^%&&&g&9ȐozAn
 L]3MP0^RH
gH kg49u6]u5*ȍجJj^("%XؤI3dIE&J]G}>P<NQn՗HOvj0Nq6hdQvskp/&)(hEf2văӴ >|N^G^=LSLh]/vwh2Sf޼wqMViٝҒ
u*b;Ir?q;v4E!|)	b0<%=Qe@ҍ?67(<tDz<t$+'fɂ3htAn8{ϝ\_i`A\Sn}Pܺ79>[iW?Ma7֮`<96w8%rV:RF8ds8=Žh|.JqPp;I#uL)(f%
_g-F!݁괺._uNcdZ2A?qdLMo6>pJCNr<^Ǩ/Ã/w?ۭco7n{2p0"KK2ֳދ3{~ݽi#2f,p3v@{ߝo+ԻGEf>{F|z{N۽W??K^ׯvzT{	8j?r~k?AS3Z)y|/+!Jۭb_^.γ݃ׯ$PvO^Mon*yv}k^Ǯ
״lmO_m}?_DavWvxң?4⯭[FktQ*[]SdRIP2~2vDy<ȄǹSL]٣ݴʔA|=_(7/<S]v._߰`0M][4;M`Na??/VGx2VT; mZkvKSQ5+كBiբ
z'gl
ȋ~wXY5FC54²A]c6{g	833;Yv+3g*\3qnvۯ_=-8_A&Y2w?Qlc'Ke֦;Zs6 %ے%&oᑲ;;x(,FeNH
iɽi[9LHNVu=iIr9wFKOWLOü8khv2f޸_bZ#25E"&ymsfR|}f%Ӓ5<ynCq
 ߨ]\sABI=_ILf-wzFw݈rP5uABSJ\oE+ɷm&#/r)`Z}-+wZ{W]2BW&*	YV9*5_[.ntkyDd4,b'3etCZ4˔y}D?9ju\ti;{wr%/=ס~[͵ns/%|Vw^3<$CBdpk"`[=y3 onmtMׂmV&B	(B3m||!.~6YGo੏vzճ?aORIKuOi`=#|๵^b/O@qOj9Hr(tUH	W9ioicFlq{JB+egKRY8FCɸJ^^$C0:2w_u/v1f;cotƁDg~OH6Y;ݏ(z' \H dӀiP#a|ʔ@d+lE/S@#GA_-'Yu&Zpz''=	Yxv0X_LjgzQN}چ[~[A_ܛ5dyZF6&^aH{+`o+_vI08)z+_7[͎V C5l6VTzq597n=-Ȭκ&[o9vڂ;ǭ4@NJZ_UBue%4"08"ntz76#k;	rʐTo5x/4u("ُvinc5(,/Ѩ+nq2p]r`:qNI3k0ܑI}S&ކγg:7Y>{`L\pv^w\|<R(Ff.-`JȔ@{
5٥<26vB->½}:IICgfuevWK-82ϨX5$Dj_|=_@/d4$ˊ	
GY3q.trFIg82Z H>3_R6HQA9Gqqu [33,@Gxv9Gl7au\"B\](I(GZG>#O5G
Y+dabXλf:&d$N4jfMbvD$iLi)?	I/o\,w#
 -b%8
;^偒R
L!Ɗ@|i4_Eȝb3Ss
vV-RWW3CCʇ/x{KsV?m[Zkuqc7	pS5vgb.:ejo̓zyծ{5;z}
IVKuGҺ:K.RY>3Z">Ǆt	Fn8>>6 쨖ݮGYZgh[;5Zgv8Scn-fZ]qظ[uiZ:fhYݨY[_ZuhUӢn`j\[H Vi!{lֻ	
X#j>ABmXH4Bi1A[mղlVNM[@:6l4Z.of݅&PKa@RCo(۰[^OM.Ra*mXH [k{đ s{͂vZFnw;uZhu`hvgM&t/Юա\|l$iبkv)|Yt`T :gmc]>5Џl<h^!XvgZM{c`u5}kfB˚vO]ȋ4lhʧF+kHhMF:(O<:z^h uZA{l؝lğ5]AA׮uք]zmo u`}mEh4W7I$3LQ5Gy8m(j9(|1OSAˆR43σ2(;W:bqV}|Tdn*OWbPȃfz#.
'_g3/<_ޫ~5<5V13n?F?NZf0&0l[!;`ϥm8ҞԸLB*xϑ窣|hwt=zȉN`7%-B_Oĝ``+)[Q"ü~zj{2
Q[(OI{9OaEW&>C3`>MroߋsUOi9yr>PClC[K[yNfx_J2<GNEp^h+Ey!e9"ReFR]/I\ τe/`I@pgƊu;GE1	G!Ǟu'ֿh-_sG_nF_O_~¿KCiHt+}NHG	i;N	5ASO1 wfIĜ̬ܸZW'!hyA)0 d|M}*]:ut	I=}vCY-ÛsIoD\{Ŝ+	CʧMcSYIOx2?pzl\勇5<?_wdëU6"j$! *H1qtAM9^.%YZYWaGy%u5̪̔1t(^ZX?p?zqojt8p1Ter5L"M/\`Z<)b`$02WmҺD]^8ZՇs21Bƛ WWd{֐Kt}&L(ɩr
*_?_d{1đ)_aaD{6/{^O5WMs,률d#+`B3XG
Ptq"CFlU!KX
T/2Ąc
	l6J7p
1;HTZ^e7`x	C!F	^-hx$-:SF[n_R;{m˙3Nwp3u{A0#_OeD;[2PYRglxǀW04%)"2%%zzoPJi[{$127N/E0{UNrPFТ$ ꔤ5&f, 	c0 3ê KJ4s<*/>TM&;^ڼE.+ uS-dX"EW'.6W{Q&qjL<C=QeEksl6p!մGXU	~M
2&P˞'VM(HIyGP\bw8dpVmRW'3498
]60+	C%}U$FabzEO#ĵ?%L$Xy2T,2/cE/%&(Scj\\S hP&w:A
HQUf4k /çPJj$ߨ0BA!1EЍ)m#]2B:j	5RB]NOFej1d7vbyj/z1VIkhqRZ,zJ@}TM  'IfD9`.C=,Np71A`G АA/خG)>9nzkׄ[|>uSVT:o9@D|ɱ!)#N@_Q#3pٹ&t.#E04jdYJτ*y(UI7FYRn^uhZcnVޭ¶bΙ㍜Fyh{M2D$hq$2,|q+tbxy;q]Kz _RU6?CFQp̬7:+fŅ:4qU-ZSDYv92@BF](q>Xfk+տxkMa4c| ߓٛM%VuQT?E* fU$:x[6M pEt(
. {&WUN0h
OL)V3=¡qݞ$	e-x6"r'/8*_s[F@"a.^Yfk\a1\'T[iy"PsF*1@D]9QbY~A (t1p#J1ijcX?<kS,xp|տaW@TT5	L5	^=1'qOqWX\;Yߐ?)OFJ{;湟Htô$TR4Y"**n*ݔQ bvR8>[m1Vk`e4M.9AX	kN:7TJI|=ie˷Wp.dQ1}?r"Z̰СoeF`n	ٟc=, y献rj*iׇB؉뇑,Ǎ.T8\ñzfoqf#KQBjN<m\!\"iT76|eEh\2n;Ϡ.Uj{]PAm
6ha^3Lv쇹;,s<v{ %"қ#k^&XA<Qpf)rW=vUel%ϕ<g8H tT(nKЫ=Ćy^xG^^NjP^ܸC:oӗ"^b%0TgogtSfYq	P֢x]hL}1 y&{6,-gEpN'ae6zdoz^L>x6_pVeawf$΢^wٹ˛vAB>^&KaOM5tȺPp0:sP
'5Wh]E\C\0v0 ,ę9+e̹̏.&#3ZGvl"j29ec'|$3*脯4F#l[HB/:ar]z6AîK!襨 B]6qCx5.&LbKVl^pNP) Qߨ6}$GL烸v_|c'O~EvJ|Y f:CFfvm䭺)ZG]OI1h5Be-#+'fQYҢmgBXl"Mkr9XVrZhE:4Ar$G]T1k]][/dNL`9GS"F[q jn/@bQf^SyOp%hLB5ӠSJT;|WfV[(GeO<u$	v~йL٩:XVF:8V'c=Whs-Q$KGVЖы--ayo!)'9'JY@b޳j\%ǒXFc$=B9_|<b?c"qa
EN϶Tw$AWx?b=%80;TfT' h:@C/];a{S̇ҩ;8%+Eކ\FjbAVYHM3[MP#|tCP:ʷ,C//wSWs& 8aŸ3 67qpb IlRTSX/wcuUdR)N*
MCp(uQ?5S]<WeS
z^.;}T
4O4E$3\ 5|B^%Juy포^4ܰ7ӫ0 (/g8~	78sᇎ!^&it%Ay+ܥ|s9<<	~|)"^^]K!s^ҟ/'B6/It+KhrD?wi_a~vˬHd/,2έUR$5R3J?̕fיBbQ*%jbۦ{ZE_?0v;lzMҤ~ Hu%xzeLxe۱s|[ɆIs1+G8:F_ ݽ0/^[vwsFEJ.ug"(z&֭7;ut^ouNon7G~c>-g笒fY.$EtC
@#E}3v#'b%!N2keH"Olkj;H1bYS νFROkaQDJ̹gD#e\ofڗvةb"GO<AxI@/JlP(w94T܋4sC@vb&Sؗԕze,LaJꞄ4՞XEU6 B`6HФguyc$q9k$	qL}i6EOʭm5ԌRYt^E2JT
\WYm"$gКkC(gC$S7#5f0NMrF'
L<â6Dq-eʠ^Rcݼ	_J'KnH93ŕa|a`g7ߍV>\BK+<K{Yo/:#)m~ÒOq"ϾX,Ѳci9א0n.mɴ-<|iίWZ3i㿍Ѿn'ߥ3[h𖯨{G6|~n9dI0F	briwwlc]Үɺ|:')00JA\9s +956@Ɯ7nN73+9mDu3v(ۏ@&HN,%5O\A!?5iЉtX  Ze#d2Ӹ~rVf.}N fq::I?鏝ax,xTL
U8.Qdni:ֱ@T|q.SZ~^ALa5 AlT@<ʾb[jTM+;!q^znz)Z[u*Z
@P+MִBú-1r@n<HVr[Ub~2}?cwb]sw%Jh61b*+We,ށb\qYYAFkE(hm.u_/?ӋYx+Y8=e`"g͋e	PA/Ї2[b  gc/<mafmФ
QOlE<m#39z&
Ah8b	AgM,tǑCDD}Ƶ}vz|TeU0 c,OP} |kt=<ұbictS5#+i8	+vJ~71::!]4yXplJĕ+хm˛8`ŏ"bЀWgמN&_+:OV'a|\%^Fc٪Ҷh0-/$Bw|\}UZ^ƺ0W5+_^>+̼yzX@xs-mڦmڦ65 p 