#!/bin/bash

declare -r e2c_version="0.5.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 -] r 4/(:dJ{"X$U>ԙY GYX"iavvvflk__ @7Uè3.p8{۫ZZ~m֛W\hkv
	Jwux5b'TC^SA:Hv|<G;ll(%vl5jVqQ'73F	߬dUmQ>.j8vN;:FqQ6\ܡ87CEoUWxb/JAK,n6ۿZi(f.xl|Cwݛݷoٙze^ fl=vƃOX0*z@6Cסo'Vng+s/>e1%ް~蝹a,nwbGd1p]#_~fx1۶/Ç?|C6t0Cuw{8lizewCJs%]g;3J"߁Z,Xg,casZvm#sB9ApTd2*~/YQ,b$v<"_^l/|OAʘ")kYi6}\8tcWFkAЉ~j=C˥A!Tyiδ{0`sǇgYg7UB7
gTiǿ`cvj3v4m40z9ap9rA/vAq dpB^ 7j6l/}5C2ΪM/v3n@!LH<@L4g>eNFڐ'gg8jB~hvD1Ёٱ|Jwuq<SdZ}W_ů-1Z+44ZvMV{q	+C81J>i6tXi}Z76NCg34LRc$;5 Wg熱wteb|
IeTq=%{K8
3 GI{k7w/cboTjzn7^ǏȉNc-~F#gЅzŠ?@M]w0ejQBo[`%~}A̸G8Dq<\<"!Qg/fcoahB9E]Αm;˥]/RӮbNUӶWoo6ooEozJE [E 9-ٚd	L	L:GG^<Er* Y@6d@6dcV̠UBao407
{(r}I%bq/_.-wnY^}ĬcVZTRVTFJZ{a:cy~P"UYmw*x0`a	{wy5~NIpy)_b]q2R$UzQ 9g>X01NP+oT;dcwk%$BA3>pȑKv#/r=i̤UsU4_;R$vG5SE"5Qlwtvl{iWjwovow<8ҨR{q{󠻻qczyJPnq;'|q;[u>ƢSd&9I2d{ۯvԼ(Re3s6OgD-ׁ):b'x\rEЉ;/_<3?3-_H>G6;\*+h>Nx6sS-
egv
cuIekq\Ѹ.ۊ,-/-ʒ<i//gڕ]~sR؋C7>}NND/5uET}]wd5S8;)*	J߮$U<Ydw
H,h1a*Ԅ6qZ.i;rӢJSXHztXָT0[6h]w8TDh*40\,~#퍽׫+rBM>Ds, R4*ZQ/ ^w;UugT8Z݌Ϊa5(V[C/1U!]nINJE/窫()*,~knFG7لkRi>rj`Wz$Kgge鳳y.Iz|'vՏW|ANI,"3G?[f\?KiF)TVGIi0jک2A"@D@9ǫ0.iIǞZ}Z(\ND1A|/)}瘕@mҫK_PݬgiH0W"̤oD4cXхy3yVNpM//Gl ;ANy
-t q ;|m}_XCǬ{[; 
@ycӀl2 &7VL5oTT9x)` vl:{;9{Ai19q5Ĳy9c'&:*t,&4}Bs!L3B5H4;GPh
WZHyu4JM^ru>H}nU4D%]pg DDß!Zё7bnީ㟸}ԶXq\6#u*yZbPi#^&]]oNjEWR+0DaN<K&[@'xRGb eQnktsIt|VvY{W$4gt:15.-&Oz}FUۺD쏇!1y7L&*-D
y_)Zk(Q~!(q9C_Ue`)Lɲе⋑ -M6_s}	>
iĜwړ.J9h]P%'N>Ȭy:54Ovk`Nfl)lmy}|?'O*R!dMSҒܠ[i$3ˌD-DRjit+aF'ulD˹{T8tS̲WgRY4J)W99XؿiZY:݁tU(!NQۊPƮ0#xĶ}uQŌؾZ$BR.lYpe<Vd2G2)o^͛o6`Zc#[߳	B2L(CQM%PC/ݾ?LAEASZО0<:$α/c)' n_`5ɺ	Etմ|O~p3'<ϋl/G#')0;Bc8n˰p(pI\ikhA5;)uiRἕE\t`^^P`G<.G5Ӧ(CKi6_$3E I0rzpj5\BR%{jb%
Yy1ʑj^fxˋ wVvAid/k4iB+VIqB ]23S'ʌr	IqT.iLyp,(2}tvwI
cJٔ139_)<p%yԉ)pĩOס>fYNt΂uI^ƐrГ7Qb` )gP/B^	///}/S΄ b8x*ŰQD!"M^_H#2-9J<:t-h+xE|h:(@7@3#MJ}`jY"ݍUӴj7_fǚ)4=an>ݩN\%[}>7^;z&ǒ풺D|bs<>CFAoכ\X
[El14} MEqRvඋ'x{<)wdqYȅRS-JQ?*p#'+D3n#z)$.n;BMHTd/bJwcd\+tE? mEE՟`"[Hkgc漖%us~qnB1F+vjBK^|FF	BKs6 X2%[)kmAIl7Iq6n<I,%M6II_#؈[-cE:r`r`hy񋼿*M~42N `>̝6nʩZR;hNKk`fA_S/_읭+7oAc|&`qOI$,h
.ELۭT3Is%젗_-3۹?`Wx$44j/EI/V+0jyq2ijo4:/S28֐&_7,K_б8f>Su4?ۭ&*T--{5(L;疿9A	i|oޮR=4(׌;Rt}q8v~⳿wN;QG2ƭ03 )^(DS4;Py4`9AZ	xd$}/"z_ %;$~AnEz:46ڡ3t)p2`*m໷nw^E?)\ғ++uLULf U!yHquĺ{GZ+LJ7طnvaɍ2k0SGEK1tEC+[ɒ$ y}$VP]aH?	aae`" k abgn-(e]0]òHJxqS%-?kC?F+zͤ+c'002!\?FZI!0(L"ڈ wF-Ĭx06&Xbmc͋sFxR>h\">qf&%iDMQЅ}ΈPEy9fߝ384Zd4fiL#͡G>q8HO3o+G{}R[Xo7'P@ԉs0Dxq$EUE6{~V=f#7ٞ26HS>BRBn3:"'[}/FBTLvmvxݽ/1tI)|nĺJ3L1q,;aGITF~lj3koI쾆lV*-۴Z}-{\YkM,p{O3%\2!$d8epHqͨHg
V3R)\҆_9s:`KlT؈r2T0RR>2XHΆB^X\xׁs62d(/	'\rE'y&9tA+H,H4f{0/=A,=/#H.JQϑZ>>ߦH3)#&)z1o["|жdj)% L$7R	fv @8Q)HԳ\/=JO4dvs%:%^5L\j/PXF痘Kli'I
.0%0- h&H% 1ŨIH4L;J
*>,mm?HV:-
e)3,`[wr:}qteNZ{j]0EMIs֡o%$gf}Ho$#aKN}fytarthi<|I~4g&mJ ͙xI=V{#EۛEzB4rFa}Pv.A-ͰS7q}&mLRq7n͉S<O4ѩtmRsF2·%*ܺ7PW8	FuS=-yd<xSr͢hf|(E/{Ae"M^Or)㘝t
/)({F[L?Rі4U-)nIQ$ 93Rʤ֕1"H5ΤP&tx,{)hO3~u<D6aNHq劤36,KN#z,⯭Z9bZ9ha|cL*GU7̱9)
RϭK>CTyLL2;38?	л04w>> L9 h6bj@̍P@/l)+U$PaM3({ GwT\pmDxQD>ʥ#NPI1'";Cdi@G{th0%ITS7<$#of$5iۃB.w4*SYj^6fc9auPPOB#	h0'4/+L׵)_
1TZ
ЌY0JzfUͮR?-?SIR@0`V :jZ#蘮l!ƪiXT)?OTsIgUl8b+_ˣ7cM+E8g!Njxi\?K%Ow^)^<ɫniɛiț35Y"e"d	5AJD*JD*
䫶,E"ːEd	|X?鮖&Qܮ%wJrN]#OPOx@@-IR+JRMTIVy^+H"ZՒ|G93ĞiY#%f~Ko@HiBh):ya)ÄG۟C\2ŒHPLAq8e^br#VvG>уߏ,%JT\2:_`E	x],:O#2ɗ1Yx:#Mt84ю6:OZ^xX긠GJ^g&񲬂>ԥ3`(<$HtK
ebt(SI@@Vޘ^j@ ^Rl\ʛ΄ ]d)q.=5*(^ʊ.]/TO:PUDty%,9CnN$<ZduQzt,=⺷8FarϣCWnjRi5v  ^aZ}0=tBww#ayj}7 {}K+Ԓܛ1Tvؖʶ-QʺʲW\fŸRR졳aIΖ[Ô⊮n7a	erz=]3P̀XAghkM2ZThKslU顋7a<uykd^A0?3*L!Ѽ	Kd,7b1sbHͰu#= &a4N_
-`X觇_yGhɬb\_]oɭ<Z4ȓƠ۰ǨF-T\UwcKq{$w7beYI9_yZݫϼn}cX%Od+Wf6y?OO^N5߱3ڲM:zF(\gW#2jr H}z	t^neHb9%4}mW2P5ƋcA:^DA1<&!=?vC<ShƣYíWji䀂&л$v?t`,kJquS*-.d7nKbK_($ApˋR'7vo,uO,nW7NZ
hAC3 3tQlf7YpVNbj4MyvBQ<`k\Փ0$'8jnvlAJ5+Ms0ǡM+7]gݿ-RZbR0"ar&X,_e0ako@dud~iZ$9 ܀\z\E>oIvhz?&XXs4Y&lWNj@)
s H^ѕXɀ&ͲՕzߍQs(*M+L:fPASl)L(Qno{{)7P\K$dzM2/kdJWfJT	sOEoSrU7ORds4MPYTn7M wui78&m7ݫ|HE5qj۳2nu$ɮjh gPI;i6Jyhfs:Kg8erVFpɯOBAe򐦋&Jqti4[9;rf"}!s+oVh_@c(C(5=)l^O
C_:tJeԴs5Qo0$QRZԙ0O2h:xd<bG..Aη7';o
c^»Ǜ$3Co2ò2ܴQ,#'hVd~fz;lAPc;$G|9AsݴSGh^Z,QĳPpKF3TO!Iv #dtt{Y좸~zVe'ˢI Dg=>;ɑa mgeQ6L̮P
Tqɇn6Pjtm-dae.1v&LXTlVK=Q+6S=Rߠ8:[n{1pSG1Rwv/c/t'!;#é:*#iE7u2 ܒ9<ʽs9q"1@}Nl[mBQ<{Nka\[TnRC?9aX- Ta{;^shnҤM-h3MM񡄣~}3$X҃}H'N[Cü2AY ߬%gdT*[YgNhj؜YF|)%T_KZlT/iL#:#QL;K؈Й3X$)̚Y=BrrARfKg̫ᾤTN$1/Mɒ5}QeoXlON8g6*
tu9ȘzYStH(U(ݭ7r[.#'΃˵mszs+<ϱFq|埐=kZfOL_Oʖ!XN+@ey{\ooA>*9^x]&](7mɜWwoJ ځzujY,\LtANUsCf&ЭbHZDŊdO,;w\fmLior_$)7)n73MHT2އfpq*gIi\Ah\:YHDζ9Z*ãnzq.POT]6(,ETI"r@M7@	 >53QG hJ8u`Ff3S9%^pW|OQ4%sxb}G|2P%q**׳svp1s4zQ`Ҧ9 D=sl?3i2K<k VLK>cҞ,tW9wun[Y̾~߼s;e#/|d^wwet)";r2O8 s]_I|N&;E%k[:@r~@D.t)RoƷ?dPs|<	-Bi-Gūzpx*,fU6vb|vrSqG|J6th̾t^%
68+7`:Piy3*'+&j [7Ij9^*V!&F
)aZ|+*zh3@'AgC׉@F[#3)׏h7V۔;?_v2ۙpp?n'%N%n0%0y\wjDTNeΧךXǀE8:&VzYI{dNXBq37),"lyAֳ'謍ct2Gś3zL~j&L2.z8r̖=BrHYoR*4+{ژ8FlncU<?ͺo
?YB/n7ɨjx'0Ggɖ[&	Y=V[O^5z\6nz͸E=JDg(9D"p!t!h4:%U%bEU͓yS4V.խI/^3qS5msπ)تLx
`x&Y×O4~ٸ I_xܯco:)fr\ǢTh±OVx,i[D"c5UEC(L(^=(1t4TXqsy+η\&(fg=ep_B	 %X)H81.kZUք&!j8wBa: طӪP!t^HeJO)Kfܮ'ev	OC$ϋßm:ygHΏ8LuAMc1cx΃\Q/NOG7BHeltN0GK35@#&>pb6p(` ˋRp_Orp6yBШR#BCKc~{$Ba> A>AxfMiGDz/$bp
saܩi>h<,i26r2zh 	VKiJ=h[;BX/3`wLF3yzF
eW_JKZ1%L՝Z|`x%Gq Z
m{eMֆmḦ́"-luadZ&V<!	^й)FURѪ6B>-Wa	&qI+d/Vb^MC`0JLXNpVILn!IE3d$ _Y83\2J"dFJJux#6>7,&~\n"Ei32DDBB]H$BbF8\ZGaIq )$4Vm'KJ(XL #*Ulyp TEmAӪRO#C"N::=x!S7 H|Vbdc,!aj%.rAVLb(evp<	R&yzd IљH%E dOIUp7^s]2})E)ǋϓaŇ)'{4>]x)$̥&4/Sw)eX1D\P2 [rx652촦yiyJaUEXjFDQi±"I <^uk$SIMK`rWd֎YK?jWCa͓qQ}y#(,l.5L5֮P"b#f,F,n@}b)YJ.Tن/Lwsܯt je6(YKy*nfaojL~5/;׌ܦ-2]R5(TSMNLcs~/LwK:L7]YM;뙵<up5EgzG=(;fmQ<kIA0`30dؤdfeXo%9?hܭ6{`[M{.X)i.rz͆Zh(-|qF-+#kbøukn06W+qR\eB7bfśEGW}vC. ({7	ӷB)'\*lҢ3+*)*V~Dғ$%X*Mpp࠯,e@<)]@E+o]e[Ƨt&FO.nHc: AqAi9>a=Iz]ݽ~Jpv˂FQoY FF8Gn<DcʙeUrusD6VY8R"FcC 9BV~QLWrRdlo(dBn32INHɖܒd7w6e*pCWŞaj%@)Rn}S߃*Y"m8/Epce	dt63))6c `gWPRN/z}:4kHsD#D@(<m'|RYq'[{g[<0Ɨw'jY`RTIK$ts95DCXKemi8fr])SPX*
zX97R>xޔ%ى;~6VJ&,$s4t2eh֚yVʾ~?IK[ۭ .K,9-wNT,DQ=O`Y63d_#hzOvQ}Kاr<N91]ywK-esYkzKa`3ֈi_$`B7#C~rAafRL}Vы =t*Lil.H%^]Ph<RnNPo.?2 i°h0N2&&ey6|V7=־m7-KrAYe9`DF?ks7(y&N7.U/w *^Q2iʗzۓI*gJ֊KN.oaDp#ydI`<8*X0<;rn\qK{1b/6<u}<V}zʆ0b{	z)wS.P1VRww\-6^ռ/+ A|f0p_ygǬl7S*/h'7MA<YB)c%:GAqUA.VF+Rn4{A"\Pn^ja|VADQA[GPbiwZAJ.&@ei}x7`INT|j5]XqjV M`54}9FBh˨qD1.V`Y{YgjTN	1RGci)G8F*=Rc
\FsP2 λNZUc YWeL^.XY}yv)r=äx*&ɹTْv}NXƞhWDM,4^O&&L-7#f[28u^ܐ9W
6=1ȗvL<qx&&|UhpRl[ȓYP7XF-xBStwhPLW(܄Yvi|M)ؑc|wj`毭ZsPG\F$Ag gSd?өo >thwkgo{O@ْT@7,)I]l1鈭pʫr(MI-0t[](9]*FmJo̊b{wbgmHSa2q)9J>aG-h-*FxSQG
/0M[M6(͊P曧˕2q]\|~
 (WXo?cc#Ϛz,v dR&DW]aj]+s83K M?E?NI3_r,n;njZ|-55xXNۼmlo`:=6AeG򧈁x*١RC1ί27ɝo[Ҁd]h@f`dFΉxt჋ɩalv$D!<S/G2 	9}t!|+1TA!:A=&z1pNluPRI;"VTpQИg^3W5"=	S^`IǢxX)v*jbnW Z$;_qĄsc脙&D-zܽ
7!+7K" cvFTJZ>:DמDxq5bwSdкJ!>?j!sDF3qa=*7fI$0G'Q̒R,w	z<jYr}91Ri^=\Yeh]XwԹQV˘BS_jho&OUJA3tk `Z\>yˤ?^ވa+ODJIӊJ"}e;XYk&`
~3shƀBk@_S?1UFo蟉5݄mlٯm8wH'Om݈NtƑCJAi 7q $aH j〤@v48r՛ǪݚUCU#w5oê!f_٪!VIRJ<nN[}asyu<Zv%Ǟx.pb9~C7iIXW]rAQ΋>O]	ȧ<6̤秺8¸gV	p,!=sEAe딲(HnOLt(y#B2qtA1tƗseVR_ԕL6
%?EiJ(ӿ(N? \o@Xf'x~wF
)ҼқDt7ժn
R#-WP?n=9pˌ8o}W//wsO?	oOSWjUI3\CoKO&ۚw|[sr+(eAOൖsL`5W>CʹQa<:	l"x0XeN:e q9GF8~Z;ʽhuNTS[,w{y#VfU?3ZԍW8Vq94/EҋW Sz0KT⍱#4xupa%%}T|@gmloGwqO柈&7 ]$='V3R&4h*lלS_c$rpmc߇nysKܵO9gwn϶(cT6o@򍧃=p8:_g$~s߿H. qp
<
 y<IF
W|f>Ix.>cg^cT*'^|:>- @ҋ8
<9S Եi&Ni6=Nv%#z{x4F.$X~#񝓜yNeAJ$7Q:P)|%Vmѧ$9t|qzTG #׳jDI6bTbIˏƳ	+g>9;dQ	"J/ULr 9IZzo?Y;׶n1{H+eqQ=[ի|:n3	jL͸3IB^=QDdz1PŒ4kBj,k/S%Ni'8ټ20CUh#QtWf=3㙰*	bFk>C3@_k#ʋZp/tNW);M\~<VqUIV्r]D]6߇Dd|Z1jsu6[j`a?'ɦL3zvRL0Qs	4Jwmg꽁TysPٔgI	P|s6I[IݑE꧴@ʞjzW>k8y;[ΰC*_cLln[j67Ld3Rp?]?WN|E6V8]Z>VCeVȣ7$w݂{&B<}:,*Z5LR{nTWlEкwF/beUnPPKQP>9e''zt%}ta_W|qE2zHAzzrs0fZY:lSyR+:|yOOG4.e[8.<Sba'ON#756vv\/%E;^~U&s,FB4!"q{ȯ&CM1TJ%/g.-hՅ 6ޭ3
GvyN3̄:wy"fyARE03IC㮾	qE}͞
)n-g^Gv^s!7SH0XsKh(}Ye"̍
OC$ 4|W~0ؑpΕfGAc^,&o>K, Y1H wa]%p;'/^΀
`Qdwbm_?'?|qGY:K1@;xUP:^pm%q/QC䎻t;!;97
ߢMAӕmi!}2ʅz&Ah~hQ/@'^w;))1nD7.UzE}uF{֧>2*EjJ	.ɤ2'n}֨^15ᩉ
]$E++S'|<ى._zEYӖ,"'ٖ9)ǣq
]т6ԓ=MIpN䭿8pʩSO\ȿ8YE^Ŕ/d?9ԕt*SO?+(G;@4''~A6_\!j ""(&VӉzO2a˱4h\24__mT-I\o29~eTvwݦj?-~5ZZ]ZkWWǪP9>:}*HɎ'ׅ%}lX>L/E0fߋOVD\%0BPGnq4<~?IÊd,$:'UPfQ9)o.Z)4
"[AU$qXK/N6n*3DeVf]|^%pICϝIZX,bfHIյ65&&`Vs^+>ĉh_L{ᗱ^LI	I7ZbTFHﺡ`ߏAe[p^sDe0t>[0Y
֪,ԴX[' S|gPCoO!kw9ʧizRɔ*e
%w܅!$dOވ6.XCprǧ&W_]o.v7,|r/67^Drr/H76~wAd@*o)[/"r``Va(
* ~EUKVYD]'gZ*ʉp͐s |&)'2po
/qZVQ_rm˘+Jseۿ~hY1k[fQ>\,p_s?+jawagR}?a723NSZ!h]i7W)l}Ʌh;}w`ϝN tY/ZOCNp/	WPdۖ'\F:+6?m@1@JeBv-*啮_=*T9F/?x~ѩIqS`g.o*\},}eݴ(^M㡪o<#Rހ8s<FߵvBxC^8Znb٪;q4	īixQy9_0r_߶v`_j7X^W>.3JUZX(Cř]-]| M$-!>HAn}x!d?d9l"7)髾;pO1IgDр~]٪XhڈHId'?P&K$+'v_S?ɀj?++Vڪ=&Ѧ>ٝrKެi=t[g$7賕f~ZjvmeyȰH$I(!b E6Q((_X;M#u\M)*n%>_wD0	\'^OL`Uo4Zfx嚨im? в(yAK;{?[m{UcTg(RZ:<;SɴB!Ju,+!cTPבA׻z1M7O~rRGlW2H~u=?43}
̧m(u/w'C3oݍno67^ow\ $/7m~+yyf߽y')ݭ72e>#4͟޽;ȧIOtWL*	W睽`_wN.λR;'vu%ZNo wZv5-TJak~zow'ܤ<k0^P`oj_{&ӦOOͨg2?}[$04~4t&FI+kTW$׳Yea'f3EͥXW0<Xayq[O~T^ S?HZbmԫ A?5E-ghi4uknh;^)s?8@;cmlcwG\;^aP_9ݽwCVa\r宂>~_"(3~f0E>"X!Erf%sVyfd%ܼ>YȈ)T|W0tOcƙ4_ӛW$M;tBρT$[8K+g_Q[ X?Gey#g>Π$c2#id0XZoԎ?_Wle\BG<-T@a#;@A~}k'D6[Y}Xobdxj#2X5F"R'
U}jRzݱp]*?[ZZO[m?Q߷Wp/58ɮP;&"ꎜ|vSyW+Yh=&sNEYgjr9+zn5l)QDZZRE5Nz<|2Sƺ|N!V[d,lA3T1GUr/W2"3ZoiQ_iW[Y"h{;.tp?'!mP	@Dq|l͂3֬6YHӼV<=XUXn*Uh2BR*={CT/]2&v^mͰ_.PNK/_Rz1tcGN+k$>^<p_ 7JF ҙ瞣U"4NǧEE3rVJy@}7Ň+ŀmވʼ=A0z x*@^^Osg 3{}GYY":`ֱ3lA4rz|Gjgc~Fm;mbD"{/:{|||O{P[_?r/TuĖt³ܾqC(`{E2fY55::Fpz'?	yxkf0_rgzQN~}؄[~Y3f+(':lLĐ>w@ZASA_VilQ08!:K
k`@la6}km_)>v<Օ=#juVSVPfUnjmZֱo4V̿:nkumVkiue4'A) 9RfZlu+^[sUNIDVjj*@hԁɧc}u9DݚMʱFHbm @VjգU֚B]J|ӉcwJ&GQ0N$176&dt׬l9}<~$5$υjV$γvsRz&9ײַjoD('=2h껽G6;S#^odrU	qnY [;ԿXjyDEVSQM{h}4;H#`Iı74'\O}^| `2Gqau[2,Gxzgnקnu<A/PˁI8ZG0>#O5ǏY)a(bXΛf*&ȵ(d$$mL'ԒxlH8 S))9V~Q

,@X(}NԄRڿp7_%vǝc%5%KB>XBU㿒;Kzg*焏%l[d.g<_wJoMzl6FsֶWjZˮ⌧<jcfU&?U&aj>/^֫\*Vfm"ޭثuvUV\>WSj"Ӿ]k	Zn4>=j@ lݬ6lXPJWk[[Xe@f4k7Smn4fZWmq_o8ZUު[@:Ѕz^kX]X5]]UUݢvp\] Vn!{lV	7B! LW6L$ h5XIԠզhfê5U-gyjS܆*PMa@RE([5P &:Q9
Y&L$lUxD bAE[+KP^۫_lZn5z*p0ԃ[vY>S͋+UWM|Z$5Mw6e/
 ʧzڱ5Fd(lWXt6ѶWV-`P_Yn >yqQ@bkkuT63|~mk&TNmSB_+k5Fޫbk5"mT"iZȑm7h*`jV0ж5Ln0钂z"AꆁӿdF!(5,_/_<lF2(RpYS@Yc^Fٱ(|}ɺmG J27VI#2̀v0,ipR :L2F_֫ |R5<y20ZsM>qW'	,sp`t)lˏ賣JZ6*	Etqk?"kjVz!xo`t2&5k&Rt=~DD}eVHǖN	&v޸<& +b9ĖBqԄˋR9d9n;[Q;qy\K莄'R%lCΛd男#s|>'.ƶ^÷9e}qN+9Y-r.	gFOJFCy9\DShґW:T7LH\`	bH_T+)UI&5cf{LBuϋ^3p5	Z˗Ѩo/GoG/qcVߥ!ſiHWOtp;N0a>0Fs2bj	^@r}Hi!/wRa_gh-i3bI';X>[i+p|Oxb>m3zYg/b.^GYCo/G~񄓆?|o><Nnx?>*]e~#?~LD	(GJwY=8QEj|=ZQi2nLb*g/,ֵT"RV5Y0.(lEY/j\S?C_4.V-aJI
i3\IwqJrYI\"WWd{VK4}*L(r"k^?^d[1ő!^z6l=SShh6U|4Rz=+zPR 3pLP`3XF(Qtq"ˏOq+-BO%vy<_d'3) 3t? 7\M{sIw`ld*Ro3ta<ahx@!A^-hz
t)P!T,6/Ŧx}'-.܌r9_Aȗhh^S8nCiRyP2\=g9k:kRdJK@^t'^MӺv4t?=Q#yeo❬^b$Zj2Cˉ$SքY+ŠC(fU!h(qfY_|)ލh-wE_Ǯ^҈hhebT/%zob_1Fhǥ	uD1B\Ymp!Xӧd䌿jQ҆}@bse/PKDl&$(thp=USM\U,Ix.K;K2cK֩KtC.XЕġIC
RP01<pI/<#0V~0}\+85jKs1y,Pl֭ڕ*I8K
grtcP$_efJR:a\.PqgfTY3%y"B%C7>8pt)@>F?QK
u:<u{x<S|<C2޼grÉ#oA0=X)+b.4eB~%z*t@VM><OldL9`.C;,)Q`GPA/.{)>9mykD[|>uS	df*Tз!GX	'ĳѴ=sٹ%u:CP"E0Ԓbd]JD*$TI7&YvI7+ߪNFt-jk6XQmW`j0L7s]
=&[A#8^u:DS:@7籓c?x\>M#
!B*5cfzŮmaӪY
	4h:Tsd30;'P2,|&L)gϯWW*U/tJ@':+ͶL/*n0%d[6
$M >pFtG9'h]@	J.Get6!q )_$fX<R!%<tM`#rW/M_s[Ga0R'x/\/3ΰN?EVj(Ԇܼodm<~$]9QjY~Mg  :
8UPanLʿtx,Ο
sNsv/իRYӀ62У*aHkT!CŠ@}ETJ }1k+')H4|:]<|J4T.k<B_(^eE ő$7Y~摯&JLpCb)gE?- 'qt2a
dܰ{a,DLg dOL+pZG֥ڝUNIK|.;yDz		LS*&`؊3*#tg}~rm"jgpwϟ	L9\Ďj;q0rQՆ[8֓QMga	2XĠ?wEDai Z50^YѩC4;0ͫ23GaʻNTysP|Mr,ZOHÅN&;[9p|0ܵzZ+Q, .(0m\xq3;pcW?MƖ\*H9E
'd,A9okVyNxQ{;u@_ !6/q5,^"^b&WGoc tQFiq
Xx]Lm}&y4,n,Ջpmj^>4!~[q|֙7:{fAoڸ
}ӽMQV":Ȅ<~kGuֶBk9}aZ++tf[4̰\$%!i0L(ę,9hDsGs̅ӑԑS-#;ʋX6R5b2>ZI@nMtWeHf+l!Kt\u]CQ 5Ews6x5)&LYfb^Hd)A[^(	oT>V匓GNuv+>ڱ'\:Z%>z,`2QHj>AY.Bk~m="}ơ^^RT	rC1L4GiX>bRd6`QZ)iq茘RO;ɖNXv!ƽSŭuwe\5r63Qdf0_=8JJQlh z*{QÝ#P[	u-L:KQCuxZ} Je\`$l#Ic#S0f`aX8nX%\av%)(AlYA_F/⋷JSHnDYQch[\-\月rO\J9dy͂qs>c5/pQXz[<ϟ7S(uzE'S۩er_qN|<I6S,ܗãܾ2B<+ D^jx!# >;wSw0:9qLNWX5dheDFK/{q<(V$=k4>_AvϙX_č@ㄧX	65vn4^l I**W ln.rP*@%ʃdSӬ5K]OzUٔˎDr ,aؑfA"7~Xf [N_֔>elyG?zISw֘^Ay9%K?2KT.y[> .Ag˓pǗ!ax)tcm~C38-2iԨ80dJLՖYj?~w|HDIj;(`"x</~8[|/%p4LF5[YYdA{$ V8H8Kb7Z3e@"TUeluKT-~%h]ՇUm3zuiP?PJZuu%;Yj(3a(/wߤJoKv`ۭWMvmTk2mӨ;h$ѻy:8[	L_w{1Nւ?7fpo֚tw-XnjT׻ eѼgpJN6	3̙9<H"r4NO	\zJz0mzמ).Bᢄhy2Q:l*dz8FSb| U%a(܏t4MwI-cs)f*A#KOMle߁)碟hveԍ\_"+\LP3 FZE']A~"m%ozS7ͨRp
,15fKdAMl<Z߀? :l,WKY
\4TVնIM`"4tuԁziҶ6PX}kj5M Qaj8P!Dq<ײ2HeQxkGb(Ր\tm<]獺_f26v.#zwE뷾xfyL(1 Mv>rh*'
۷q4QK}+2ٷ`> G^4P\CfڭF;f{w.;[KjзDf\^pLW 5q"5=FSBjI/$񽻄Z$wUV@B_6Eo"sr'Qrs1Z@V| /`D%h$Gpe]:v?L+CStC=ne380@kZF\CcD0kY0[;3snO	~,
yCAtc식HC=G\=^\,wTr%Ⱦjn݃ؓ;#K xovǐ{Y1j]=
L@ÆNyx`צ1q̌P* Lƹ֛1B 2$\*RL;= $=br8C5қ@Ԫ) 34(FWR(``Μ=݀EdMxhr.Д(o7zQCsYN,ܢCϲOH<3
zhR8UԀ&N%FӅ%}g,ko	9a_쑽4L\az7^lOV x-P7ԅ9!v-ڃ<?6V<P{q>u7M+u9b;< yg R
:y~drzxV9@hWc
>q|x<4>JA w~ ;->wI]ns HvAC#GтG(_0,>XDOI<uS[#8@#
Pt~^p#dy0Ils%iy4'[9忒1D?Y{oQ'z]|{UPṈ3Sy|khM_4aa~?  