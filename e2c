#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vH(_G_EZmwRT\ݾ$޵-oDB$@*K{30gΜa\`f֚/L H$U*${z0vlOX;naFspQF(ǡ;tCo d;>.G#$?FviwZVպH4`?	9vn6_NI???;D?
g 6H4S{}XN_h |tof6Rǿܧ/hǡ{>pYwߏN|w񿓤_EӬfƿּ_$=`"ac&Ȁ]gjn<nΈ4X2ǿ`A|Kر7r7=yq"7<sÈŧ^DyG1V.;rGy1v} xB^7/Gt|.+_⟽M?_'L[oݦmC@78%$z -A8p7ֈ:\
'#MhN(<0;v#aR^jh.k`<6fNgVmti7.=vxǏË7w8T3*޹iKm̅<zOm@=O_c1ޞ(@5&ٱ3\s" 5n{I^fƇϑyAF59a\9?;(+|Υ6JsQowޮ5`wZ+:9rӥ%~e˟'a^1PӔrYjk|jp7-vn0W!Nh 7Gw0(ұ4t[!CΜ>.HJnVXm7*lnwD7\'he:kK;M[I^abL V١*;TevbU6&UӤjTM;txuEU٢*[Tel4N .TfDIFl>Q$4S^eyur>V=HdhVb1,+9kꉶg]?`n-c}cVRò0H0j0̔6{Zg5:?4=wy7Ipy)d]q4gT$Uf|<rP$r\yv`c
W5?&I%ewЍ(Ƭ	vV	q0\{kܘ]Нin_aO3yUn+&Tj9O;φ,$cw/vw^v_~{j/߼xpFˣfBL{;7[?+͡{~I/dx7dTLl,'2Kۘ`oko076eYie^(:kJ~=qJ ~t	`/9v&pĽʧOʍσ>MGwdfKWW|@C/瞢0t*9sFD>=g@{u oWX1^|?ȹl-չzեlqGo*U+;u~iOƕ]}{J8C7>sNnD79uEU~]`|DqLxG/K0D(Xd3>zWw߽'. Т"S8iZĉOZ,jM!!]Ra}U#A7sw!9!l1xaEh>a[$Wܝ[;[{?n7WX9&mA|!&V4&nO4CWgQwFIUsw329XkֈNo,T *ApzR,>{rkU˝>Tʞrf+$p.Tyaq/_FTC7&ePUdD>}#ND^s/?ad'	z1`-n S	@Haj+˟JZU#NUUT")콿:㊖uu.{kT׬ΪՄS-@ޔVAeq
Mzw	`
R!6Z48:bҌkB9؁
;򒓾z}HT:E7ߤW?YMAqx3K'gvaow*s^TPγY
ޫgU򌂪49[ym}?TF '`%G\!FjޔbIxKԩ	2_"
mxP[<LP$n>< mr:0ds ֺ!+rvm8:AF,Bm'ό\|끃UP]pgJ"?#tc-H	g8feS?qv%c
kJj>eܖu +ɝ𨏏74}é&Q5[}PƸ/X5/ĒeA\ߒ[_U,ʢK%:__v;G!**ִ?EΞxds{ϐoml}3\t<!A!OzQKZ|SY3Gh.UK
˲߈T=WH&{c׊/&nTN~&˚i!x#Fȉyh(Z,1VՏPJe85P7wzCo>|`el%=yjg{5OSJfifK;^t&O9<O,s"P[1dKYINMulqJ=E`xOTa]Y-XblnߴA-H9,@
*\l;> ]3 F<=+T2o2ͯmHv5Svr(Dqu2E҂,&hؐorfgf4S"{8<WQ}ǯ_~_WE;;KV?UL5$˄D֔U"ۡĒKCS@Q'T B,OM7crp鰙xR	{)]$5^[	Od.{w?loM
P5`2,<kL$'LlfTڪY>nZ˦ց|eqJGWl"w#@0b` `/)uE8ZE_މj޳w[Bۢo	~%ĕoSYIl/%ːD$K:i%M`UHzXW13sv9Q{?"WClr>z5r*ЊstSk:8@0TLZeǇ},4ՂyLes,.(3
O}4OwFIc	rT09_))lP䆰 qbt"[bPq0*U[OLޒbI7c LʐsD03I^c`@)PY))eݹ(~[]nXNVиX60d;ѹȔɄAtQѹYk,N}e"ihU
Pb`sf$cIKblKqf֭+ Z3&0sm[LvjzSƢr[#VaËo(6LnϏ%%}3.-	ίŴ)y#/;WT,moorab*hyKcAbih9NI2v~tRN2s/p/ؕ';etyU,*˅P,$*QU+p^#ǫh+FJW9Tt}7v[x-b/ȕ
=2u3Ec;vZ;@ck~ G2:t'QQKTyIMK5c>C@̅v2ײҞDz_̮1{zX0(_k2ziC0R]%`IsIȠ".0$DV"$$/ڈU[5SEܥ:q`R`hu~U5Л|i$8^9]CzwRbU
J}),큙H~J<铽W }DWW1>DOID4
DLơ߯վaJE[fNw[>-6HTdqzI^j?;WTb2Ԫ@er:_8ñ2Zp!ˋ-̾i8>c;pͶ|h#M.[Ҿv{$A阷9ƎA	nlٮb=]<ό;MҸt}cxq8uB㳿ۃ^;QF2ʭ3 )Y7D)U4;F#YFyTb9񩶡NluDrE	9>$% :'m@k&=;`ίc*
Ү~{yZ#=y?4hd6RDAʊ']fJIj{i1Y)c悴*6&,Uf~	f(O`)v3Q."hB(=v lq+9R.9љ
I[~-h C2V  VaChB޷JWu v"%[j-cmN]n6L's&Cvsn7=ʄsh-=@7Z@2Q
 
Nɴ1
j;lQ`PS+zto5c4k5)ΨNtOῆ.WJ焵_]+E9Kj_YBҦ'ccǭq-ez9JC9}7Cwgh:VO3wh?"CܓµCt>6ƧNZ9 MRPYZd 'f2g6q:〉mD푤{,]feD(Jy 	_؍(2f0}~&1ezdD1/P M\uNÔ1,aGEr:uƙ$W^CAEruZ	AYtغ"[LL~q@)'lt@ao%(@1#yZ:]<p#m눞?w6D6jC^h'O"%!/@4|p,^nͅy8l3jH:B?P$z{t|)0)S*\Ӱ8+`sT"d2:BDx>ULmN h	8{D-z|uk -i[8RIsLWc>x9DD),!mXR$ L(7Vb/[C0aJK^RE?:)zrƓlwF91RLiɅK|
HG<nCRSՂD(-2$5P:)0׍bJNߟ;[Oƿn z';@uçjQ
/MClk蝜vKo19 {eY:s'@;c"|&魯gGK5ۄnꨍh`}Ho|~QIArâ"=m	)i<}zۓi&OMo*xmKUӅ[&WMrFB4RF`}Xw,AͰS>T:&)p'o!wyibRҤfdpw$?CJTCyu#BopPv	&8uS=-T=P7%5^E5=D{,#a8ti&x~LcvP_8=RZzS䉸>H.b:I<\ղeD:*B?&LJhX_Rվ'F I_7xƙ4JOEv//yJB
NpE\1Kp%y<|	CP7-\1Ĝw2ΐ>1fMʟd2G$*nzH?w/z
G3`#w}@&gXU7a TX!`IAx'
=CA[Dш)![vC*h-aoX2RAy0
JruG8	F0	y<zD9|"<cr;J6	i$Fy&S:ɏܔH1zJrfVy\v_<=h֟T7ӔW@t٘i^кZB+oa5$NT/+Dϵ)j_25TY2ЌiЯea70|tGG4k"Xj(tZQkkeѻHN?+LD&Vhbu+>EmSUiDPA0tCh@[2Ԗ%mɀ[I-Q4#F_KG~i/-)4slE6"ېMdIT{]_%u	|]_%u	||] _e+نlB HHt1v&}k$|(n$֓okɷn|k%ߚ'Y
@h&5II͢
IFQznβҷ,kbF-?'NqfZ8_YbOotg\<ɐeB+]kW\2K)iD{T4i{2=f0Oy+_wrGV}DxџO,T#2S<-zo?Ex}l9O1)-O:M5kh
?'bMma鰼0(Xj;JgLJwYVkRIl2)ӒC*1ڒ(J-^1sX2Lm\/\$U]z2&sTm)X(-D}zg"˔H&n$>0x58H_˽-bCS3L|%4=MeQio&2|a2,3gך~Z`O"Mi4CSzދ["^!\܈psO(ي
Fa)*'7$^mor}-vɖR ;H"ZB;Sl9~]=1PĀQr2 Gf˚=沖tܓ5Z@2a,jH#xS"0+sd@,@2MH"=YAƟEj4Ci4ӛQ9}YZR'j`9C}_xkodN1.󏮷NGi-Z}d$0y5(N|Up՞HsO!z+3n\u3W6#94<(ǢD)!D̵ݩ|n}c8/'qE'ҕ;3<=/o4~`dTEю,~k#']uƨy9eJ4/r?pep.GKZ"qd++&w^eTjt;łma|{?:hx1䙋hy=w<jӀ!к$v?+lId43%GM$UWP<;9'%`rzRݛGݥ͕5X5p4C?||cB<X^Ϋ24֓0qoSR'N0L`rrГGi5_$4I֍'e*μKu3(#.Xff>9Mn-&̂2h44eUy2É)?Hfdź9<HqDe|^ZFS@~'ۊI]j?hڭwQjɚc
D8a.k׵Nt_+x$j3i#Daf"ѫ,YPDejseR)3]"(*ZX`2* 7r)(I_ŌhS̷uC#Βz`+a4cޘ՘4΀|JTnԟsy{Ae[[;;lYle<@s)KEJeFu<9eӺ}l9N<]M%;B-IV, (=p]뱹} wrJfNUr?pQ/)Y
{\\0f*qd=`IZJ}'JQXXwgwlAS#qOLYｓ+$eLW+Q6lTetIfL37^Sϵ難QD""U#~>P)6Ԉ	ϫP>,OdF@3:]!im0`l|fXEм~(aG#cX	 ܁=?BP+br_ox0ċ=x ȅ.qdB"v9w,捗ȕ(sW]OB/r-N9I	`
E2M}Xr,-=HϲQ<z:NbT5v-tC2i^<q#L=Tj8(jgF1qcf.r4wy	.[ᅇ^&.-KZP k5ФчMR$_9hԦ䈹إkh	cM"ȝ2GssKU.Ty1`10q]٤MhU1G.:jdB.AymK|6~cS	c@#*F)??:~k窨dJ+,1q<Ro3sI⧜֌c/L7F/)ZciT*C\ EYzŶ;=yYXZ!H(\t'SVċ[/
V%۽W?*j/w wC/vaѠE5iǡG}7<}vTgYo  w.3r#3N`Pwf8˻YG@H'o!4F(N(y]4QZDA4A{?wnQ$rqk|c1.
2<WɻukMWSZX}y;'.AD
CӐ sGR4uQpM8d+̳`Oy_;|pzW[>9~Q9~l% d|mTt!'At6rɋc2ljZfSuX{I~CDUjIЗ>9ތn.x.lq+|-inӅU3U,c̓ޱrV7u	k5qA8CQ
Pzhڏ,ئ:wAw(羇a#Wh4l<L:Cz 	,$ (ߦj;|[dzKպ
"P^1b SJC'BsK `ۘ{~dimxq,U%q2o镄o
p&c+6x;\YHz(߰E#םFd\%2W4u<VE`F_eGU_UM#)qU2<4&wHtU@}'lfN^I[\lq'Iu@T2)aR8oV=5kA*MkږM-Jr+3FJJ6Lj4ɴ뾅ZnUpraI8x"[ۼ"	ѓ1fH<j'Z͞s/gDP0Ht,߀a2ܩs/0|IW@VCU<>"V2O>Cyjx=Ȝi[UmrP )cItUEdePK_6RW(^F@GŤNcFY+(gm[HUEtbhpKQ֍3ZS5.Q]PgF2	ٞ&0PcD2(Ub^&-Rex_܂:Tק)PXz{R]֘f8ec0`JfoÒ9ReJ&DO!AY.JU6IS3?oa7ˍßm
vs3dQsßymEIlGW=J)̌vAvIAuCbrwh{ݤ;*\' nnREiu<~Lxez|rBeGQ]ZMq1~UI2iQĽ'rRS){&UzC9M&`)2.iON)Is]ʞ٭v؛2.VzA!{ұOs#X=lfQ+&[u;@M肝dSҞ4
"TB'oI^㔽a[:Psg[--=ikInTAdE e\J')[JT*4QD:,|JhTXKBYp;(87)Pj(E#Ş>$c[sܚ0ӫ7W]j(P +>Y+|YNop	`%	#iLGXI$n˥udz(?sJ>C$n(EK/ & MG5)\R$)B5,RP9uLyN EexZ̈́(	sj_ՂT?<2PYҶ8E4Gsdz˫䕪QTu
ᨠ4G%	ӗPc)ˣ^e$^8t'ãK/Ԙe.%+H$í^R_&\֌buA5Ff)̑:5*Ńĝer8	֐Y?g?rߗ3Yn<Un-5~t2_.EAtbZphLR4q29$.k]!םN'YXi@}a)yZ&/
}sԯL Je4(Y,Ky*nde++kzk>v6Q?-n|Wl[2ߞWYd7oBtd_Lt̕ռY*S߆S 8-em3`Vw̍"'<D"}amSfaI!Q̱^r>J{\_OOiָgمxӞ"VfJaASHHY9fbZvVxsօkMaݺ-z7Xqݸ~)m1zͼ~)V1ѳyjQT_*D o-XC65iQUNHe+F;"iI",&x8rAR02pE .QJcؕ ԭW-vq~nڎ;Z^ٍkP[Nm2YNwoX ՠWeyU$(-Hh#Ќ絅-:gvS#3Uqz%	VSd4bd0w,Ҟ*tf]r~w+p[/MUKfȾGtJ9ܣ8#yy!EKb;-qf-CUO	 -\!&TII|f-K`'?'IICUQwy}
%솯7pO·D4qhr0T?y0P>}w]]1
]]}2Zaò6&o	#~W".!񿕪D6NTaT}=$ V='kC\eF^6wEN"NMV	f;ЃY7;*ZS
ZBbTԵ
BvߐJm{LʧOtA\%kh5rh]9noW>U\;Mt>_ipw%2o""&nڌ6<j-D0!?!J1Ӊ#3)L?Nы*g:dTXU/T.Vrx)FAȿ]X.m2iR_o%;##&!hӲ$oD*!4_S\HE<-qqzU35ϾqR6MVo{Tژr5i4oy{K$
kɢ^X o{_xq+q(2`jWtDS.TA]7K_+~Ϟtɀ% SzDռovGC爮_
5sg??K8E8ntG^nft^=POn
R 馲e\=.22Tpp5/Zؔ7[?f 킘vV巶
gz4[,N+h|	P70Z,瀠O5tv|䅪FM6nHXU_ӂe:*JQǬX6Yvbjgp{꣊DZYj=*␑Vw\W_JfMW532{JTaUIs䙻E\-6⹸}Xrf.el=^oʕ룴{y6]룲Py]mwT3$j%Q%3!>9J`]Kx&`<<B+Qfo-,u|,M{C^!sz;&54):7a+|_y3|v2%[N]RuKCgM>l+ӈD!sw좑G0C!vv^
 le\,ņL_j. F0OO\Se+@fԖjO&o;?LG)&Y.\h4fƢoȷ7s'vX>9ݟ8+㗲8Q@6/5_bD~uU' oL
G=5,?}4#WO5ޠ+C֪j7sqz-+- GI}ņ)Vk
dI!Bb+?W]a]).+x^r$+`&؟EТiL635>^lePyc^͎z7.0xyE=@JhMvoerj}VJ_Y0#D<9!F#pD0R/ G2 w9}t!l+UAktPzJ&`̵?$PQKiDοC]c{\4/h&Lm{-5/ͧ0E9NazuyqXR.p0Ty3{JLH:& OX&n}s-g{%4(XSy|a{#}!M;"W2v :v Sϵ-spឱ AZ1j_8飏̮Vw@ua_0'ݡwJ͍]	2M<T&4AGMØ%هݖ:M⩶w"MaPFSXm:g
4mJUJCsLkT.G\"	s2|%+~Pn.JyFi]1`Q.flQFBk͒\))ߘ*m~i,7 DnBshr9oAkk7S)qdЅ\Pj$8&HjWY*ѬuovkZcZ(Kj5)߆VCڿVC@"y2L}z)BOq6yM-F7Ғge '֑4{Ԋ񢜖ODB74sztQ~FwJO3-ymI/uBg%p̈́PVjk䞹^{ަMY$w'&:uҼk24t ]:ȹ2ki+_օ̼60
<EnJ(3Qje4tO0~w
"aeQ]Mo~
^Rz~V+_A=zxNʌ?^fya`9aI|VJL%V^RUư\׼ݨ蚓8ע9}3Z1-{?JԈJ*
IKOrlA*KꖈFקg97FDY(92P@FJ2fYxNXݦ6۝Nbh~P/^ZP Rq/ށL_t,Sqs_My )ţwOѮ -)LJe$#t
`toA:Ͷ➼1K_
&W [$˫'VV3as[y)khu -
i5w4-!ct@gaϞ`:;[I_x=#p|5Aux#o<)Xb?#E<|$t1^{'a0 >IH]1ˇDĨo00ySx
Vh**/((NPf8qLgp8ڕl04z&$Tڙ"D܊<Aʀ$Q:)|%a+i|ʶn_љ88չRwu$A8_q1塩16w+gcGl?ۣADZ  6ΠVڷțk;1y{HdaQ޴W;y=s~g<v+DAf z(tc697.h?!ZYGxE˜^ʼqpeUcUF<
Pt"W`3*	`Jk3|HhV|]x]dU]ٔ.SwΛ><"qUI ࡍrYD]7,j!tf|%7"A2JVAB{,XFnvhF3%B#?l~NF%B`4=^v@iFCAm[,N濗cq݉E=t꧌@V˞krc>vy:[ovʰ`C._ac̈loGj%&hl{;@EBtu._*˩8kGJ|j
if5[ އ~J޶R7:+bպwN/UʊPs_lCAD!CDYʜD53JJb/<+nA梚g1_o( cW#Ǘ FKw56Thfs]R˓FQLx%!õ9~)'clp/m#?Fnk8殨rxNW+@[`1J2iC<4aD_:o\NB%6(i~1u@>8x&#}O^mqZa&tиH1(,E1(Y\OZK?`СlVwPy7bb|f}pn>r5T
d":W-!_\:"1@p\{Y^d;0E+:;rs8Vwt3	flՋU7A""m;[=72[H{3sf l)QkϢ]_?n~ru>@9x]P:X^rm)qђUr3N0^ܷ̄h[dCdnwϯrkvZ4&nOЉ z6JEv,OfpYQdYF/9_>a'[<$t`Z!,5Qhssvgeγh%;Q5eK9表h:R=2Y-,k
d@t&FІ~R޼:1.TQ~.XW"zX;uQ|ʝVcąPYHOJ +1c6Bj,<ZQOZQG$G5!- brh5X`I=^p^",09+2Ec_Aš nŠVJMO6Zo^u:>]7S$huN۩wXi5un|n@9!ڼ}(َKH>'I6Z^[ou.:/0n8Eʍ _n_:ZV5JQ_Zzm;b!`N~͞jm#*uiB0~:rvFC0]<:>a#i0au"dw(Ց^(mfkL<wx凇tmIlÐ>u]	Α˚͠ϽKN@8:i%WN~\@I
Qma\,͑]m$Jh沢T|

 /S7v/Ť(k~}?=>R*#QTj8pFc-֩L,s4/qy65/_Bhng(ߥ,Q>ֳZDHqS(3Кv @Н4fh0:s~urҹŽIkCۀ[/>3˥/r	/}zo{[|fI)'
@Js.g/	"JL`d,aȃ
: y<"̺٧7D}'GV mh6G]r{;mXݖ; 4qHx޻Ĥ7d,X$s?Mt:D7	cA&KIALz`&&k6FU1Z?VͱH+:t9v&`:I$Gie먿"O`*?ɨSQՇHOvj0Nq6wu>h?Xy;̂qQPyMRPu Qe܉i|>89=z
󥻚y_&R8Hb0fy"MViٝҒg t)Tj!KEi S.jF֘>#DcT I7F?SR.%0#ep󨰿C`=7sL1F"w_$mqOYnB%u޼}n2bCzzm_7XmDԇN$`x|ON2k]-{)Qw&
-kroÀ!H:nRI8FiM6+1"?skf5VսwJmcZ9B1hbk`w{gkoMkk|b19a?h)9B+)TBޒ{
fO_.?̀mco7n{$ROXΥ%cKvE=?43{W;_=NƎ7g٣*V3/lgeJ޿xbPApΫzo%v_W;==5˟b~)-xi~A>O՗zAO^%ywC/zJSMZi/mW{('f7{[Ͼ5v:~{P~cFnZ~zj/"Q`eҳLOVF#5(w/&3ԟ>e2lo͟G2QD'
wW(o7-2u_Ň%
,i-]@7= fVkkfxg	Ifsb'cEۦf45QXA=y.&_-C5q̦ؔ7{qgyj_c y0TC#,/?5J_fGx}0	W7y^ړ<3s52sye?fhlz܂t`E-sh1ƿ(p?vBρTfmZϺ%0g_PMR-ZoRl?4R9)#Y2(bAE椏4 ^ܛ5n>ŻKZhU,!#~-X@n 'HX}%*͔ћȁf'o{.Kw,Qh=>Im3;3+9~:i&y5݆@QoHsA?BI2d!,f[N冡j뚃.2~WXQmgwkkL:GG^<K,ߵZV:.RC2BWf*	ٰV9*5_[.ntkyDd6,b'etCZ4y}D?ju|?:4ڝ;IKg{߼6fVs-[w
!ыq>L#n X$Lck]<'o䀎v:N	ZjߤQfC!iTq4 ?սúSLf󿁷>2ig~zpԟ.=^+Oz2vcG^sk"^^<r r^sQ誐D	\rEӢyqFV5*n4=uԕBq?/cMeO~ A?5{*>{qx{u~do`Q|!;(^(1Tf;cotƁDg~σH6Y;ݏ(z' \H di##x|@d+lE/S#GA_-ږY&Zqz'T=	Yxv0_LjgzPN}چQo݇o֐9-;OjM٘y!| 	Q|ځ*&co4|l5;Ng0X$z~otXbkRZQcWִ笢^
K :vl1|YO˷Zk_&J.kt:Mi}mVmiht3Ha]ޙڌs$d)CbSmhסV|867ڥUrjj6֎5D*6֠ZF~FAT$+)*ӉcgpJYQ0N2676t%xL,o8C0ɚhdbSR^V8IaK 퍀b0*lLA[ߝ]#cec'+,34qgpFnfXP\?mw#ZCrOD=HJNSE8 	puעO7gOqs	b4/%uxgZGA:Co
#\|gg3|dvCV%"}q 0؅RXR=u0[sB,|h6Q^c/<qLFIc:f/fgD"NLɑ؟f	Bzgl0b.VR#=U(9(N^]b;&R,wfڠvN\wPʡaնakv^k]{. nt:xγfcî7[?le&Qg_A-1<wWXYnۧ lalm^(@WzWgiE?gw|FOdQB߲.AhحgFղѶ۝5^-bvZb gݶX[m@ٰzW|ovl܏ԭƺ4-@VeoVn׬ݭ[:iQSV05d)[H Viơxl~w/lc-@ֶa#\6FEƟ:Zo[]ofް:u
~cwFŠ+Vl!]e)](evB9=ɏn訋lXz66H:^H w{͂vZFnw;uZhu`vTG4E/0@Vza𲍿6 KF]KzAkWV7d0pV5X	xo.4ޖq,`l_Yn<W⡀[66WނK$noЉ&M'~:z^h uZAGl؝lď5%z]vc	[	
c@	;1	5SW7_00N'jDiCQ'G'y:ܰ\6y~()<k#Q69m@E1:i<Χ7-ipRPKvv5CRP3V oqcO|v\Լ\a08̰*~}ϧOVY*ձ?7L![~Ȏ.sg;d[j"8'5.ӡ/k-&:9|\mv6O҃hti	6#2+!E
v} X^ҹ%A)<>\]WV'yU
<$xl?teB^>=cK%oRR}_\R~]+0cԟ!mC[KS𮼤,]3</.	p%=GIA+EƥQe9"L2#.d.gBٲҗD$	cxlc_Qh_YV.ùIou/Go_¿KCyH|+NGi;N	5q^O1wVIĜ̪ܸZG'!hyq0 d|"M}*:ut	Y=}CZX-/xGgJi)7yfLueB's?ˠ(Kq荳~/rw_$3^U<Ts& PAq#eoZwY=8()*(rs92+iQTfVcMG ы{M)5Ty%)Սai>c2h9'̙^'tEf%ժ>pb(,tuҿBi8|g9Đ9b0؍"Xz .phQjEvIi`?#{PGyV߫7|+Ip.ehVbpw?ShfۨTN1NyȨ?4޽2Tarb9U6wXJUY]C{rIwd$*S2gLA\0<k#R	TR	z#W-yC';}2u{A0#NuD;d]:܎0;{/a;h:KRDd8JHKڽ2NC)}Sn~t9dbo&E0{UNrPFТ& ꔤ5&f 	c0!3ê KJs:*/T	M&=&mݢ~.^ q){Nv1,UySΫg٫=F(85&̡hFª5WvjJjZG䄿|AҖ}@l3{eO9P+_G&e$$thq<U#]TU(yJ;K2k8`+6+LK.HЕ>IC\P0<*Z˟~&Va`Vs)Kܗꊍgϊ^K:MPƦոR2	'@GLt
:rG[YزҢN:,t3`cC3*ᮙ|B=1C7>0pti?x&x~H
u;>uAռ?C޼gxډ#ohb+؄00<%9L@VO^|X=d'͉rt]z|?Y4i,bb !n_]aOORB}07r
G3g@	ԉNE\C؍&;S!D0 =s_$ǆD8%~EHFFeND<Fӹ2BHO5d)>klT%meIMyqGu4iAYzZzN
N9g7r关3 R'
Id0YW|f2v8A˕"	AGaMPm}NYo7uؙ;s<UJðjk0roNueM1 	gavOXBBbSN_5v7=?]Ќ|Ogo6XoօffQMh UɖTm"s`h 7UK42"K(,!\6V9iBpER(?ᳫ2X,P<R #<t{
$و-d|}IlE߿yl{	fyGJqpxSQn@m8J;OFF ehZtI{D	Sf9y\DƤ!kaiv߯Ok|U]SR$ 3f:.%z:ĸK?]	`q~fmCL<)T~"ё˒<SI*d{ģPFQY~OJ9lzF6o\6~ڬQl4޲a,Xcy! 3[b8m"P*%$%-?f ^dqy
Ddn1î>B~ٗɳ@,g&d!z<G}1,3MJL\*a'F7jv rfᓹGי,FFae!|;qmvWpXQv\S߀++:uGCyNFp#y~u/R{KjvjۯPe@Or88d8=`Ń	;(]{g2)R錂3]ǅVLCc|URd<W
7R"R@dx,A=kV{NxQ{18u@_@]c^zp-XL/:ELb'0TWogPVYqZP.\a<ν3j5	rXYÔ`ԋ&zܚî,̍Ό쿹Ykݰ8wby5hUPkUt5A*G~sֹ}Y*FgnXjRY
Z+5kqQKf8.@6]m8-g`.Z9Q]Q Kd$uTȮ2&R,3SvWK?3*pNܞ<Oc4$!Rk&Պt^p!4х?`7Gcbr˔d7!f@Z1EKn<xj ;jGҪq}>xmK;vBW?[G_,j&)߭q0dt_mfL~U"^+I30N蚻e$a}߉YpTp? *[$HkӞu啜z΄)]a;{\O`:8UZ8z:%٣:,!8E`ԃc4v`֡mٰR-ܹ}	 PB4(һǇm4G9Vn~DS:;?A\|~
A,,+#Mرٞ+ߖ(Z5++hEAk
m0<˷Ҕ͜VNV_%g, 1Yp5ncIN,	1
V`ǜ?>cq12Q߶TwdAWx-b=%80;TVT' h:C/];a{S̧ҩ;8%+ElކRFjAV[HMt2GM"|tSP:ʷ,C//wSWs&"8aŸ3 67qrbIlR\[Z/wcqU=dR)N*
MCp(uQ?5S]Ves
z^.}4
4O4U$3\Ζ>5|BG6BS/|n8UL /q_\kx] vgBP
&w)#\.O©_c.ᥐ9/Q}OƗ`ja4w9g;UeY(s; 
u@*$A*m(>S&X/&.`U)X&mZ9y%\~[9	9xewßA/״!MJrTW@g)goRwoޗ-"hcV::qnu:N#@{/w0/^[vwsFE>%Io7ߺf.덵n~I*&ps8[]щ1i08rq*!o6x0BBQD7l?9[Y7Ch7ٛ|[<r,v2]1$Q,l*dɆj#L<Ĺ6?Hi=L^s=W9t?";~Lh>v,V<^{n6;uSTH'86F	J:?61{ξH?`HN̄J2R4SIݓF{ʆ@(lF	> [tt,879ou$n:g͒$:OO3ͦ]7bI54M=1K50+«FҀSkHzC<kMdZst,tlj2F tWipRDgXF}r(ŹtRKjlSq"Kt䆤9*?;>][;3kn$_/	?@.fbx/?Hޏ۾/=О1.K~_,yd'[U2-;ޙ_zӳ+x,[¯݃/y"1cwV:{ϝw'V?	7.^su6s a8ZZg<p1^/SWb́lTZ<\ZRM{I+ۻ׶a اܐ9tqaR<[M\9Q~Kڵc}t|:z2.e+9O1P9m v iD1&V2-ԭ6ÃH :Ds1\
pz\;꬝dus#~irB/Ohx$xX\IMt&w0i9ֱ?=L	躇=XgQz"iF1N B:ѩر1}"e0EdB[
[AY07)5uZ/;GgbFpYl;LcZU)<#ITQCZִ`{u-_E|fT7kȒDKiw0;Z&}F2{hj 1vGx&^48dcW󇧣wE{r/rƗy(P,DGҧ]=Xh41>B 9ys:7kÒjc%¡4yf J߫ټnk1&!pU's?s`ɻK_HaG{UDrEKP\e:S<o̞fq9{vZ̔yx^KI4Z*xLhH*ISzgkE@j WJ45q\<qUxK_E blb@ūHgx#Fn/q.6ױf_v-<{f_0Ɵտ>lzVTU7KĚ;3o('S?on|շM۴Mߦ_e n 