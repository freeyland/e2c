#!/bin/bash

declare -r e2c_version="0.2.34"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 Ľ] ]w㶲(_G8VҤe[iu݉mwsr}ZmHv>>ysu5Zk/@$HI۝mvb(
B(TְٓO{5noGV5NtMhۭ?'ƋY;!r#7A8䲱h)y`ow߻'cEYאָCwZ}NѼonCj ˷߷]\3{}XJ7h_o;?ƣOWУ锵ۿl{^zt(yw邏_Ջ:Si {ĉ~Ѹo0˪5ou{ﭣ?{.j?fXuFzFX!sħnX{c!;qOG,r37qLX|Ey~#uّ;kcz/lt.+Wiӿ 8g2}!6_tf$PfDg3r6d~}23E5 D4;؍h#] uJVoyn_q0b.^Gټwqcg6w8xx>t{[=i!ߨRy)USmL/e?jQ76a1/?1!Hxw#\hd_͟ޱ7tӽS^P&	B,×QmaWEE.4 %ܹ+x~z<L-vu9iC`֯l#088rƇ[Ofzh6i7'q7-vn0GNx /w81=ŬY9*;
"v愾pl;XvVU;vZ˦vN{u¡go@N{K;M[IUv zPB]%]Qr [E`ZE`Z &W9:/jT6a&M M ۋbo
GyVpG6[T"Dl8CeP]Yj
}-fꊒhۮVe#Vكײ:GABVQ&gݶ=%p9,ո.J:a&|-u9gnBg IΠ{'*&ɓ3AS>KYSHժ@>pȑKvS/;?ǙjrՄ׎&RPj9ɣQM5O ~}jy,vpǟM#ZLbx[;0dt6KAڢV].'Q;-/4'<OS(G/"'N<~8/<d$#զW[\뻺.hH50ofX s挽y|ƘA45a_2>_We/v꭮ڷk<i/w敒]+՚C7>kpn)7[i?tйT\sj=":cIqi;$6J
;(OoU(z;J,a4i6iJé.[	k2ỚE/\466nQ%U2ޣfa]2X(g[ww7+ZB>qN`HP͌/蓨a0uB^gkA'uVO<@PcbU;<X"pWqF]NJ'/o8||PoQcbp*V\܌ 7لo}XR#H,kLT].xI^|'wW|8 ][!E,MQ7y?iF*	@`VW>>HJ)LMr$VwWA\Ւ}͚5% dPE"ȋHp!fUPI0eBgI0sr|%}#^.D
o@ >/^^>aBc~oR /s}( 4_d/2?wBy}av|?Ȟ;{;Ov_( 񗭽?ʌPܜ[-?sQͶ~?q#gvH1Rh8uY찛UIgJ>9QjʦLhbL	\0b֌9SP_ytZe(dpWZHyu4J
AE5D'(ȷAy#y:qG b^R$oG,>; Q.gnkRs7tOܑ]̈FGj[EV3#
n:u@Lgtt*I!ƛǋͩ^4WWE|pxYȔg.doy&!`U<l.Uq^rl͉*w~;:
-ZY9 $cO~vfgʬi|wt1-.	t#FJFHV&YK#wڼgf5\×т~)χGxC]fR݁d`͔=Lɲ&ĵ⋩ -s~a'zӕot%d8 4&]v1V%T Ord*؛ma͞Aczn"Z.[Ov{}5?ow_|UV!k#u-a
,Na.UF<,H"Љƈ-%FgOLrZ˸M4.]9w;.nӚ0B+	Y7oZVNlwl/ ]JHTQƮ0#nxgd';	zQ} 	J)K\ٲMu⚜yn5\-a_/_WeG1v>= $Ä2DՔQ"ۡRK{SPQ;j$	0<
,_f}N@ܾ]usj	(>sY6ۛbڇͽ`҇z-IDz%-sJsiOvS(}aiR缕qF\t`̜( 
TQ;W띚i[%4Ov	0$|=k2J%{IX4p	BC bR$ar;BEQ?썐~@@ណ LATY倊  |Y㺲qN<zN<9$ߔveS晏fNvNROQϦ6JNag{Ԩ0g `|*.1E-<|?hɸ\&]WMJ9l0AQLJr!e^O+!ʗƗ)uBSJ8xhqB
RC-ya"_Er P͜R5ѡhiEC_XhV+Zy~_-Rݰ$%ݸ^E=MVpSjvTIcLmFS2A\O!JϏ%4b05q4W9SCBYɅeZPq Ӕ-xAٯOSvБ$⩫:f6#U0uD\Y*`^TQ)?"'W}H!!DY˅Bhi}bFf.YL
[I}1Wa8qSϡkiEyF~ȇefMZdQ)Y-\pV9,FmZ9N׍LjCEMCXAEisH?ڐ䔵qe*8!$GV۴8o?CSzu/`|qGԁi]ʁWRf7p8B~;f/-`$p3
PJI%9,I}j4_Jߧ%/$qŰ3ҡz8iD]4^ZfS66um#֡;ɉTըnU;C+՚ZwKZ^NOg4Lf5$~#?8bhUGiܼnBՒ֝[#(LN%	vLGH,{#vTܢD(3 d)[H>9K|f5t=oޢuE,7$*([!
1[rn;HvXPNn-7ʐy(=2" ,=z!?'$eDd/U{њ.BBwĮ<T4{Ce,/ĩhd0;?C;+zƤN'^|:;	I1
qc3(vQsA*@T(L;	2VgKK~ْ$5_`Б,3ĮOY 	;3+>ѧԼ?5ti8y3,yˋ+ِ9Ԓߝ388D%-73;4&܊Pq:-Upvg<fA# p6-|wd{E3 i|9pF*/"p~̦nr.3X5ETljgLTrt0'4#rt/ |[b#5DԉnwO-;0eKIb4ρ SMIaκ^)ʲs4puġrǙ$Ur70Jy9iwr[p/)%̈pSE!Ouv\-4Za~" )ߍkY4!H8zX&C}I7$xxr@rx
N]ڐ%yJk+(~oSd+eբ0:x$\"+fXEip4h'ELr{_bT\eL#H2-L ̔V|%/ks*sA<襑	,o㰜<W25@c8	ɥZ~ĖLSSp))i\N D5A2?WM"ѧ	=*,g
|ڡ/:U+_-nYӽTf_6{~NN?JOE:tP	]3||F+{~F;똜Iwu>uC>a2^4RW\@&鴺^t7b@qiogNHѽN,oO4u,+4po*uah ͙xIrSK6*jV	+Pc5=a|Cэ9=eN3/%8ƫ_q0r3wSj{uāI4g^&-Ge43g4R8=S캩ik@>.%>EzϝqVXF-Btv,^|bvz_PJ!8C'y#;~tv'r#tzRM%wWaq㐪۹!x]>KEX	!Tk⍊DXA]'+ܓJoBg"f9cWWCdkxiU13ufSZzJG!Jlc#"a,8Foi7cRDMAbjm?zJ2Ox#3Hė_Nװ!0BW weI~C SzT9LEј)ڋ`*iLlaO2J(k*$a?H%Y%cΔFQ"![a&N7;qcsP"RdSoa  >iĦ@+=9IjƷ~h[L*mCv?V)۟Fie'tvhM ?=??-?٤tZBjab8ctbnN9HïA LAѠ"_A5Knmz-O[`x
nu]".C[Ёh$ɛțiɛ1e)Y,B H_D!oHD!oH@aRd!Y,AI_hЁ0v5;$	L6䮗uvr*$)@k%ZIZ	VfY$iltWd] k&wp{epKRހў$ޑHdXʲĀuh9S,Bd
fX}XM/[xzJ<\>hgGIH_'|E	xX@+v~Bm>Y/YB:GtwT.ppvZ8<׉ka2@wXϔ
7ԥ iQ$S%01$  oLz3\ V)/)6.͠?и5R*W&Ie4j*W
*"a2͉Ļ:ͿB%ԩG_k"*S$4Wբ,<GsY/0sixw`^n!C|<Co*0;e߭'ρ{=%je͍W*;lKge[bIWwʺW\fŸ=RRMarCDIXWz׽X7EW6"MXB^jObm{Th3`+K0-taM[̽氖Yg	*%d[dמ`4jMC[<_52^A0ƞFBUX)dDfE2Zl[g*1,fX#O~	H#݄=ӗ*C0/6zk0O6ߍ.e=PE%5oc=FU\77ZBŕ^5(Rzl^^݈Em{&+h'<~kE>wĞ|9++	Aqe[ Oˋ.ڍ_4o2wk~W^?Z"Mq{]8m\dJ9:02o{]oʉDi-xIqi<{CB'tфсZ+y"r-sк1b 3En<.ĢVnQlzw%Qw.?ʙ?.s~$G},4jW5ڐ.n/luW`ּ-Z46/o!Y6W]24I[aZahC'*cji25F.4~V%)Rc)<rueLv7WYϩ>^Z!0w`y9Z$% ܀ꌸl"|Swsj(jEu/bƦ9Ca-	VVM9XG~Yc抳~19YU@2ZI,<&;rcE3&yIk7xBC|9~S8wk--߁eg3g~,y>QV	3{ˢu{9j^[Obuq&ŬpReM/.[npvR*fC^@qЙY#q5NsKWs|E=qxó&nzзV/,0rͯB_0^Zn-.uj*2S<r@)V7_-Vxn岀򆅺A8s+?oI,"~Ǩ[H^͝/U
C_62j%
և(&7,$$QRk˅0f_IC;YAW'M`Os_x򷔛6i|\%۾bjn,ׇ5u)VR}nɏlZ#9h0$گ_èX:5k%ǎ0qBNz`ksPc~=f:1SR/!D 4ǮϦFG;ravraqc7uԍSKɯl^+J24y1E̲0'eωbI¬%x7q,Uq٥jy=.Pð':~<Z]Y328RoɍBQg#>zUQ. fg0ԉ rǗ{O9QϠG2*Adݘ;:(T_%q͘Wevl. ,[bW<<*fᏬD03g;Rֳ4BIfooO7q|;EA	@;+tC/vav5IxOq7#}tRֽ9uz=SB[1gv8Ч;`?\lVǃ4hz8u`AuuUL@	{_V'3Q+>b!Axp]\9_ldUߥX8)Ci`@ 
נ}B׳L LђTCFt\E[vlyk	k1:+X><xW_ɾ8]N6ͧQ!QՅMEK,C+P '0-ɉ΋蔼d:I䂌Pʂ-Γ:ӥ°9/=E(-<_j{eUߌ+V.0_;a&\:X^{k4VN2];=c^MN^%
,`P~͝Ch3dPi>xnْǼ
ibR,?iʭS-|t_/Tſ
們9T$7o.c;$R Iu0
m\=2s,<7cM]c.O|jN+/mC(.%P>aƮ;en9ϛፌNVZi4XR[j~G2׃5RK#k#	janS2Xy&	lImp#f⦜IFvyK5ⱯYƾd]h?=`Z>tA1uWUOlncЙ)Mgݷ UV/Wd\}GqG,6ȐgDhŕ5
'2	@M'yՖoZIf7 >!%Ub/.q.IQCB
C_k:%UI}HTU3)ɴLًx7ubo]Oi/VLL 'kUEA leX ԙ//]qbZNrcNY(cdwf^m̃):ZI!GvY3Mz+[	gVMUW^uioKeFBC%/7'X4eĮKԑ4b wHVq)HXzk\Uքfex-`A,nd
cՙ7qPǾ5XBc"#KB$RKܧ2Ω&Z8uS<٦<;=.~^1.!:Z5#/BHen{KRcL@ɝX .'fc׉0D X^
&ق/s͠Q`GZq2O,Qy)1[5$
C.|$9>Vkg▤-04Yd.l,%vK1"{QҩxڅRhأu8Sf{+=SְۏL|Qsu\i|A˖q҄[YC|T?q%xn|9WR<
*T+ΕBWCQxa[:R჈gK-B-j=j뙖IadEeGM$ň>[JmTBЧ*)`"[3{Dn0Wl*!$a:qXz$I#\I*XpBe'f~a{SQq1dp=K?.v7½LN2@m1h.$j@!1q#.0x/ <%ߧ:lb{,YcGsm~tmp EQae,Oű=Ұh;;I 0"!h8$LmjY1)++C0]ľ+#-7AʸnI#H1D5u,CP4Z~G;C>v"JeT:$NR
+kJ+S- ^-X/xͦ4i1+PJ=]*pDt	Dmv9:ƺMu5eJKIbiӋVm|6i~y1gWry k$2̑YhYǁe0}1\`Iېjq#)+kin*qM5e>ZO@]!&䖵҉;pAkyKWf[CaԃQ}"GP"Y4F7S pht:,IEzHGܷ,ʋ$R[~}X*ze&@CZ`씅Z"*ljuq*㤘,R 7ʹ2:HҔ꺘Eo\bNh+$SuƆd&4Rȡ$&Q {gbfXYTAYWy %ɍluu8[JW(:cqmc:L7Xv3*\6k>M<z>UUǅi[hON`l[|R14g̗[[i/"rS+ҳ;sٴBp9'q/?%RsVp\ݶ1^o>ܨuecrMlnusƆje7n^ʠs[^e}%śF1QE=Yi`挼HtF (某;MFWXnzMufYx*0mPZmJ8PQFAi>R?M?vIٰ|GUP!)]8澱[<NdAխԻi9&O{nu=\铞TvxFԭ	vFE`8FF;GxgxZ[XڢrXa*M \l" ~qjíD(%@ZsZW[EDAX;c8R|nPS'&\'t9ޓ8h:+0xvwOfT{32IƘ:hc.@Z tFYZSs5&E1Ǐ+7/0A/R*~FSըH9<׿aSJ3uZӦH{+qXWu9~P#o(;)13~ѶgL̼s:qb~=ePkmVʾ~[2έ .K,9-yw/DQ=I~H
͗g_#hPvQmاԙSmg$YAyd:31y82xVc	ل<%¾-=Lgqqa<q]^7ܘf(ȴ\|*WP֑kk0וE~`R@HZ	+EfS<w!%~ Pƴ
3hkĩƂz[\	wg&Wޜ#)JP]\ex!Z
بͦUߍσ=&ߍ?=EsO3>FjvĪP<΅}<xx8⥜MOl=8OD?rN:AB^{\_J*iT̬WnxD/9A>uTu|f0cr&gǢ\\kWmS&a	"dLF6t$]Ϗa0k+!7IJ:m0R凔
'[X,*(|ظ.PT`Pf3Gŧ/ f
č.,x~4Y+44:gөxȚ?eվaWrNg>*_r,o~d
V8di|;oWK[($Q+k0zv=fMf5jݠ:PDe~%a9IrܢnKa2'7DPIZ5=ohIY&YNmwMtafD,f[τ˛̧2M#|΂1hZq%{h<>bhpR߼SɓYP7XZR^xBScxs.kjQ}[3Y,NWH:渊?|n;P*3_sX"h<s|svrע1
kć
>~rAވM Ay+lI*6rD{~d}1umg (20NRBciKBHnyM_$Y4*\YhqYQڐnp	et"O8,^ (aGhr-DY#PMr)h SEG:|&˾[M6(͊˯5ef@V`Qx;*4GU,v dRJ;;l-_K/ʎdUkЄp^4c9OfqS⦦mkRS]ҴkVzfPݟC#)6p{~PMgJxI,>"oU9'b80PᐶlG@Cx藏
P="
_}A}nCGB̡!69kAIn$XQIYDC]\4/phrLe}%5c<@bzUyv^Nu]hn\΍j.f*[u's\˳\-VAn%xdioZvFTJZ>:DמDR邸ǿ5bwsd=]
%x.{}`f_`v]]!sDF@Q"F$#ρ{JݍY:	2̑I"T'E)A8M@$ٗbٖM671"=\uaLF]X-xڥ*JMJUJAtk `Z\>yˤ?^ވO_pEz໨(5^%`e~3s¨Y\W	zoOL2?sQ0rr7>z[}4sr;oau'^݈Nt`#;.rE p UkTq k-ڪZ)U(sjVU1k̫ϸ!I*R'1bkZn=H8<}F'Xf[%֑<TAg҉VhW催A#?%]}<ф![DahfS]8IR	j2es6䃑gxY(lR.|"&:uּh!Pb~,tg]:ȹ2kg+`JK_G܉4mY
E|G\$;*"Y3ʝBiۀCZM
zXFCрZPO)A,B!/}`~1}퟾ƞ8	_	W
ݹ>SU*_kM,nTE઼֢֚8:{=Z1-kR.
IJOm]ŃaU~ssܓgt0Q:UM5Yx`̲x+MnI1z_UD&]X"h!'"+^%d*NnXđR<8{0|DvdIidbU#/c謠s cKmqyYjR48C6tb%k->76y/YASa;m挞%3l!h,>v	Lg8tx:8	O9gwn(3ToL򍧃=y]?ys39r_{Gx_$9@>80>:O`
H|҆c>:&Pɯ0ڲywRxF( 'yrT&AkS8rJcor1q+a袈3igTwNq++P%I5ЁJ(ES5qCoHgPL4?B #[Ո?xh,6I5./<4C ǏɗMzM jgmPc'/V幵O<bϣU(E~ԞV*?b' t ˅d3D?F_	2=4PŒ4ϟi!ZY^8i؀rWE(/íg^]ΠggN$/Z:MF"]uuW['sb?OIzyb^U&APX6u_oQ01ByŴtoKΧEep$G0Y/{,F[^։VhN}39B#J?lzF%B&c4;+_v@i}p"%@-$ٕA~ԝ:Q4@OmJdWٓ4MlCÇnc'O#"bntsHE+tzLi-sF=<D6moq`(U0[HNpnFKqe9+jYcO5!<s{/KmtXU k*JhxAkhPVȇbApa&"R$?g˯t$ dݾ	ZOO.a8@#djTr0ZE:ϲlSjy,
V[$>o;$n!$vauKH'iwa{,G^=h9jull#!If=Co&Y]o'TRӰ%/&1U*Zu_>yg䰏<ɣ2C̄wy"Kx/`fVo6%p]%.{j+嶘jnxe9\}2\?朵*LXXY㶈t5s,D2s#va09$:ޒ;rsعVwQfؼV/6_%o>Kl 7! r߹8^.@µ((x=;*dE@|$R#3kQvΒ(7'o
T'KGۖ-giԵJ.6v	a8șm
lhL[f١E`x4/."c<dfpdWɡ3q;ak- {QD.Kv=gOX<L-#H}3q:h^0buCQHDRٟ_Yl8d'li ?eM[ʲG&K	_@ `Og1w9OJm'-ЮKɀ(?Y=8>._*(,|'5Ъ^"+E
 U67~(!^]rh d[\!j ""(&V󉉰cO2aɱ~4m70WCgǂgBUER'׭P|ьQ[WXvzhuX;uhvۍXQ_3*ǡ;B q	Qwr)/nkgwwqOA?AtMlzʵt z:oG׀_o5:`[à;ow_cpG^,vةiHKG&+m'g0ԑ;O@1Py"°"DlD >*B??SʀF}N)inik2G#Fj3|OvOsVa32>us/	hw|QS-	;ZX,_`kTHI;56&@(L9uGbQh_L/椄s-i|1-J$_`ώa:Wpʊj0gԖQe|N]gjq*sXz^'ԴX~^גgPCo⢽!khJ{|BDt<mGOj#RCŹLx#k{oJ,o˙ŧsǋkkml@@[+݋yyɅ9I`
>}?yUYʙʹ"!YDiZ?T2"7C/2lcЉxq
P~Dx4àAWo9זtn+L.F}!>g&%ȈoAŪ0he)tYAD{	`;pS캍-~W'GnF^/qy梼r[VG@{Ce*<'tC̦#'f1|Ბ^*G1R_=ةO`4DWȣ=ę{Y7]kǥ[A-75YA5!vعOS ?؝=@z{
]_&h17i`0O?BZF^%SڶJE"2m\rь$Z(q;3A"o pZVa
1}5r"(nQ	)wʆ^SbFAE+&Y>I7Lfn6Fy*ZOCᜲ_n@9pnѴn4{1vq=}/~}O}i7ׯ`<	2w'B%~0:JnAc<TZq`KBӌܗ0xvGk\M)<(f%-If- (d|yzw{gkoǾճ7411ñxLlߔ>y h_i{	B> >땗nyf{0&bi Lc"Sl=y	=P{)?ُ(ۓ|ځb
yQ~w2q1/8SI3_m˽'<pl$^no=>I^ny;@xPpO~F!LO|J05{u>MZ~uի{WC&7[`iiN'^jn<{[O4vL{;Ov]Ɲ)lmO_m}%>xcp?_s?M._{`o6c~N2?m4߂&PӷL)hӉS˃A&<`Ekb*$z6+,QX`IYoLV~Y~ë'k+9lozq/#K|U_S_DYmo-@RӹE6Kvp	Wˎ(K()!j?lcʏ/ѕLo$zKJ̾Ԣ,NJ囊gD-fj';/_<a2_@ƲympCk~	CρTH-I݉|ϨdMc{~Tv[GGf;ypF^h9,DV//MN3iM^*J_,+/#*jq=^vl70ܣ5WGoΛ7[չ_bKFdZ>jjcDN:JċOK:\?٧j6:'dwq-(͊5g6߉UKգ70#IKk#/r!`zc=w{WMJȵb\gȂ%߷6Ǉĥj֋zk8L$0/'GnNݹqW[.rkt..B"w\'!ϝP;n	?ɛy0c.hmߤaJxwN_/MFHJ~y 7cJ=_YFyo'Vy?у'/_ja?<PA+uFc=#Sk*>^<v%#JAsQ骒F	ܠzEӢ8c+<C*R̨싒8Pd܍B蓉I {#GYYх":`ֱ3}6	 :C|Gg1v?띀>t#}Ͼ8>Nt`4#C@|@*[atrq ܑqC(`{c2f/wrOΓ0虅׽t,UIq/p֏_Gh <gcUL}a`o6_w 4_vǃ/[V@DϏfwu0 71Ⱦ;Nz^Ds)G(Zl9/HKjkv->Bu:e^ktDd.o74w!-zB 0vlmlvJA{rnj5׏5B
 *l66^9
@ vRvL')$҅t$wRߔiF,!cfea>k2MM$υ4b0SswyQF\
`H@ah=ݚ|(_Mz hot҈.f l9~:DJcDZ#rOD5ꋯ+(񅕌&@8xUǢ73N$DМ`s=AVc^c6hQA9GqIu[3f2,Gx~n7nu\B
\]$cw#d'ٚGE01~MG}	r-t3
IF[餚[bcd*E=%ʏBaTӛ#ԋ2?pLAE_#G~Ue{<~Ty
vU#P>v-*jޙ)9rJ-WW3F#Cʇ/xr8tzqk6qSvb!05GEċFiկ{Fs
IĶWY	KPGRK+.RE@_95ibB}nv{}i7~]M  6T4:ft-kg;l^m:ko0 V:n;H6`i덞oum4, Vmovn6֦֭klXԪeQQV85e.kdӲ␽oэO=6׉MЂr &{}s}Xt;|lo%jPFjFmmPUՁ<6[SpAQ0wrWm&(7^lZ@ʍF&6h^<q" FY%jؽVotzVskw6N8z]Z,=)؂ k>mBKwe/.
 onȧVڱ5v7e(鎱W5Ytoޖ7-`j_Yn>yqSCb-l3|~ۛTEml@_'Mv5l`kM%m7Z.iȑ=7hڍ`a7[0жM.Ln0z"Aꆁ?dF!(MeYo,>:
?yɠ JeS`yPSyeJG2ho/j@kU2@f@-ipR 9:2Fy¿W-OIgEMk~W`:
20ZO'nt6:ZbqL/a
r#vtʕzC
BD{T:*yy>ړ}2۽V+=	hi6?j#':T`7)-BSNZ g5= 6a+JSxr8Q}Ҩ]ryO3>1(t0~TVjh+_b>Mroߋs5Oi9Er~>W_gzz%osu✀Wrj/ǯŶʹ*Ydd4
ʜB^^3'$.bي"+"x[DbDY6AS~WEz]w`DWfw4߭2_K-W_!ſiHot+}NHG	i;VBD=?Ho2٦s2#Jj^@>J8<Fӷ߽j߉#!ъO.S7#K7I\0z8ӴW1R>a̘ e	's=QP(˺qMQbT+toEݻWل__|LrcAIv}oڭwY=8(.rvE|dWRV(ϼLC7{`;VZj$U,GlŔ¿PyH>E )'L]$'Ws%uJܕ+yj5&saP	6%jܜIvgMٝD#9{[04č".i(Y6
Ef4-o%&a<\B$f,uP}SghU|RJ
3fa e+
1޷R)QQ)LTkP*UJg	'ryp)dbReTeꋋ"[ZS]}ASmL#"i-hJ$ IrE)
[Nf[HؼD`}E5tg91@ՔoP]3୸o9:*+Ukt؝Lnzg9np7fC\CTUV:hRY7\IwBx)hL8"
_ƶnʸ1B2Kb3,# /h]YQZeHX: ^B/dK=ab͎`ŵPTR	ȵ;bZ( 
`_.6	QW6JrD@%d}eC8Xx^+=bd~M^G=(Vb_QS#&D![}ۧV-F&U]o J^Mq%>ԘNVBmc"İ"%Ky!Tr}ass	)yPΌr?6VJkk!Fq!t6	qU,UN =	C"T/`t6@13X얒hX2BBn<}HQFo㗙ҡ,]pgp9fSw^
݁8rh'>Ĭc3Ub@'>o)Prȑn-H^~ÍR7`.%v?Y4N)}ʎ ^]e銩&K"99ŊG3C` |D" Q:to9By|/)yL`Xq#ücgs'"
9[NPD0v4bd4UJD*y"$[TI7&Y鳐mTm4v:mZ:ϙ㍝eqa;Lt..201FHP;5:ҪgBK0lQp̬WWL̊k0E6hͼ9cT.0 mGeFSg	4>sV/(PP~ OPEJ(TJ2};;CQ2|&)	2EA#͓W}Vi)-`A8L5,f1/)?b"JxXO~#Q*VT?⻫eU2ƛB3n\Fb<'j$b0kb8@S*̓hXC:'u1.~̀o`3UTh#Jx<1Uq&1w_|ρ߇_fL'e]\LuaT }2yjQfG?A$^e:t]O~(s}~+]{r`-XLEN5H2)+d㮳rdm~z\0{,`7"Nȃ1&710tZ=Ŭiq̌,/Cx4J6OtviyABQ}g2!oCg2uG}+t\?
#mWtm,ᕛ|褮:!(J|(R̉]{1Nc-xS骘r_4UQU)e3?1Iԓau:*y$Gjpw
L9\w Y6>a'a0qV_H'Y;x;cIi$N<[\{,"$Jևncn wFL2[݌8!y~t诬Z9H/v_׷_lӠXcG4:|$dvX2y;'n_~8+thxմ^|Uf5172.oߓ*xԓ,vn+i k$r%l:%RUM""F.ĸ34vUgl5CyXhd#CVșf);
'bx<0&#ō cMzz5΋FT6⧁x^rT-DBAx:ąvD!L5<ZyC)%YyuL{1NpA=$|^kҚKd=wŹ`ֵn}C@n7IGN-Byߗl=a9Y)njti{0w~3vhb6ר&4Z˱X-JT!)SviurcgJx[T1sT$@~ҟG<&j#mHbPЋ9Yp3 '[+vQ Ԉ6[c뫵NbyLxsةkr.;MX \mɬ))(AX9(t	Ġ46{C$efmB Cd,ujQ`bXkzt"Q>~۠ Co<<CCU!qZZY^gPt:YP#%iq=gM:{)1fp-pո;C {3{ɩ;yFM8mt$2m91x6%\A#NmvBW`b(v?Ђ;0`܏P^|7"K0m/60~A<mr.&Ky|օm9IUYD9!:nj%/0;|]BlIʲQ'gKd|3r9^7t=GxͦPIڂќNR.^0	8%8A$$`:#XH}~xZ˥13P+bk Gt͟.w	>LSMP=|
5	0u
rFz65q*誠Av0\"1Ŭ=6Z|1uq2FeIYؓhiJZ+4:js* L^}dn'<!0"|w3:<*m38ЦiMTXe$?Yg~^o7V?ڭwqpMD[~U0`_iR(GinEV){Ƈy>^I@0=&nhRX=D,_'aϜsADy  s6mV۲<qa{a	=Ъ|QL$~@28vsHQHf.).i	W)Z& E	E!Pr_ʝL޽H3g?()BrozYʦK`ֵxUǌIBw&`Vnw9"Q.i|;2oF"	OR'Q46		NYcfX-XWgL_xIbtn>MK Jm.kDwZn1(rT.
cOi.tWí5ۭwr_U9<X٨LCKe%yt(<aCp*m8`RN0dtUykɭxHҗoi&nʘzӻwq:i:ХpoHR
30e8z~h{%$e|@`eo7jCE̴a%*RO{JRJZHPBfQHB0 q9tۄd+8`^7m!ԝ8* D<CǿVKUnxe9
.̻/WapC79O674{H^͍|.N$F#A ]jq8fhӤ/MwnH}I"H+zoK)tn'Fk-6vܚTrdy}x>;3>eA{Q:nLf(1 ""(ڟbYgQ@tO!<*/Wj<%3)dP|rK/J9Rnd2,??yT=A4 ye|dYf̒0)s'Tb[&U|Ba<KzO:?pn N$OT@D/;<Ñw,!$qr/vG䶋Wxd=$ `y>>h&4C3	[3|@A =GN#O\{M5qA]B@G5npH_qt0!wĶqzH*,?)F[H^$x%a: YP%DtC .(53\F(gUu?@zUn)Ƀa4-gOٶ4Lr{8I/w ʘZn5ZH+Xs*#3!5q&zXj905@E{nrsw{ R 