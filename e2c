#!/bin/bash

declare -r e2c_version="0.3.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_res="$(pwd)"
    e2c_global up
    cd "$e2c_res"

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 m] rH(د_JL',XUiݚzFd V& IDggck{}5ۯ/Yw 䅤nBUL\n>UmF-+.Vo[vnYXo6ڟ.Q q|(HɎg#ڑN.?Ffټ~6XvU4[}Eþ\_]\翅W~E?
g | ?<4!'h |tZYz] _oj;旆8tc 17..Vvwqi/~Aj׼dl]S6՘;~8`YՍЍB,Oݰ{#1;qOG,r37qY|Ey~ck#wWgׇB`	.TX|wƮ,{u5Wǌ?(顸mOѲ[qk8 zSBroapFڐeGg<fBpvD1ٱQQ7:w8vIثRjΛt׎7uktk;QśaػiOʏF;7MĘlc*|)A21$^=x}lVטw(r͕Fv<xa{{_>Gu#2|UqY^NB;we? 1s7:NQku0vjvռwq=|@?GNtZ*y06+[?GΨx4`ʇf]f}|s|4	n1vg#v)L8YtLGC1~q?i8?]<kc>܏^cT!`gN{is$Zm7ʬܲJ6;rD<{tuۡmۢM۠u[+C1^ ٦"Td䠶rE6ӠbTLɵ;tx&5I5	&٤"Tdl.
TA m["
s$
dVaF`K69V%0Z:f%eUѶ]GL%,=>*	&2PUfOCOG#x:e.ouA43	./k+QߒBv
~DΙv, XJ$i?$/1 ٘5ZJS̵ȍ%;		[vU4V6M|kJ%<d_d>N0fؾ7{agf<\A"Ix˂5[o#1=lF+\[Ѓą7p{bšŁ'p"lU؉{O<l>2}sdfWW効߅$-B (Nm l`Μ7YϗJ]#/fj
K5֎յYα~ݲfm'šSRU=+_tZ1rg5NmRW%f}'Lԅ u>"S8;kVyE"qC߮$Ǆd5 Vw߽'& JBId 9N,T4'N|lm
%JI*__ $6vnQ#旯u|DM\p᧷IN;/vwֺ+Z,}_%VmE` գ3
Nx4ȡjJ}wx+p5f*UP}SѬb[^\JLRǲŕo<ڍ]8~\^ Z?rQA5	#K
()|3tYA߉]0 y'Vz1M`1(3vr8qJ6 ʧImSIک nIa|kklmc_z}ڬT$7"Un_$r}ǘA$ћK_	k\j$Y3!͘8jx!D8mF(|cʀ擄KN%˭v^Y|
ǂ"^7˼/s}_؄ݭg+dzQA{;v((/[{vWȎ3
f埋Z/<7r退=Ʌ#/<\EYy9c/]%R&lt)ݴ@̙0]u| 0oI!@Mhc)A0ts\` #4`Γhg?>͕AxLϷ.X8}Lw3DDß1*<Љ3 3bn㟸CYԾXaR12n:uGJgxW$`uE>T/Q4W}"Ѳ%S%{c,gbl%ɗ-Jg8/IEaMvgXxO|(rNG +ɜ_앙5ɾ!3ֿ<:~kGgӒA7dt<4|xfU:RPG
R5GhSĻ]*9>HLC_],\"
o\@J%YV|1q>v7YF_L[\;ukϺ+G*/rd(Л^l^@gfnx7,-Fg;w_cϻy*ZX6spђ B[uh(˂H-oْ#ix~bZIq<p<SsU#w0]G'dV+Y-ڿb	7PKG;R
9$hێ{mc@pc
]F Qdg"Q>`(^cF'#_$-HoFZ!)gvF$g+|#{e%믞_˯+6`(}c#ϾgeS	4L5eHv:d(jyPAkVUjS %e>%^W^tJW IM>s)6ۛbه`чZiÖag$`"!=aΒVZMMI4ǻi)]aiR崕XqFF`Ĝ .)eE8RE[މb޳wYLۢ%	/	~,%ĕ_[YIl-iD$KŒJ($=,@,D9P@(5*5 7!ҏ{髆#DE GEPwV)@M B֨nr^8KzrޙڳeVURdG_t+Rl%$QLc+xhqFyŸ!(dy)cf'%^$9"X1:ESp8] bWҒq(8&	W*(%%8`j*a)Yˬ+IWKKK)Puom^ai8Cbv)D/$ԆL^H9
نگYzJ<zD1ZZW&Њ6P{P n.%6gF2$ܺDhi
nR5sJSѦD.b"'fe,02]jfvDlY3^~Ed2i{~,I.iqZIXw~u}	ȜBb(%zSTAYS>>OESqRNණ'֣tyt3=YLw XYnaېrTfLc\lYr\ 2e-/	|UqyL6b<y>t-sDbeP$I35:tZ~3j't-ssK4
ř]u^9,ȿF1Z9L~םLCK&CYAIsH?m䔭q#,N0ό$'EV"$/؈[SE:q`R`ەhm哼M~4/!
+;Ƀ}*$RtgI
K[`&_;G &|d>bx
0ƗKDZNN
rTTKj8jD]5Jf=;{uƼə,N/٫Q~TyՊZwKZ(ON'g8LF 5$yɻ?;Dfh5G3iܼm|B͒Ƹ"	(DN3(|ictmhZɏF*٩EPœnd%i#?ifBQew{gu`kWvFE6;KC F.
a1A
4BsνшNc?45t0Y.k|-h[=EPzCB/r(/t(
ŠIO=n\(J;yrJ
wFH~Q*rq\&Z2
XV$9BSLbKL	K$TA5[䦙EӢ1FDUtzTLdxȉVN>rzBA~+ TЪ
bl6 78Ȱ0LD`SWkBBwĮ<Y%yKeθة˭i'Ds҆y`B1tGSu#{1r!:bWxx
$Vf	"Q<` éϖ5䚵DІ_`	3ĮOYsHYvFt{
kBZq`a>`gDY)LqLg}VT-p2L94&܊PQ"ʩ<Fӱ""aCSodiᙯ\h$)4>u\q#*"y?&o? ΕL쟘i#ܙ#+'fdNƀ(&[N:] IF#D4nWmWE;Fb~.iV@S>f\<ʘdIV]M!rjuę$UB6AErZ	A0,tz3fE=^JL:l! #4R:ȡ!ai$/9=#ty03sr6p8W6HZ}X?vxOm=Aj)9/H.ja^ϑj	>*]ـږxq\;S;o48Ǟh7E%XsR~_9VzB젹% OLbL8>ߓ9HşǹA)?F Y\ |K .%VmZ:RF(E!b&HVɔ YI_!
i	Ŀ?v֟ FC׊|gct=cEHYП{~NNG?gI{s:tƇGIn	k{C1_=LAܳ.ARձ"Gb_UU*2HBZ!<"{Ə}[=sBxG߮f^$WISիʯ2{WZkh(Ҝd-оd"̀q*u1N#!)#C>oȺQ Ռ9HTz)o'o< wyt(bP¤f^`jPG(-znjEq2z'PB?#jˈEXv]z9 oA61;	(/(P9NRNFE$&1HFϤEiIBr)^qIϢރBnF+%cCH
>	h荱O73I߄OEr/-猼_]%]hӦbf(=V
9?fc\Iml~6CPd77,֜'|9dF|cLJ)HL-"Z_\u{R""zX~)zX;,*0T*,}0$@ڇ@eSz_hĔEk0Rsa"6ѰI|EYwhdޜ
JR@y	WV\!F3!}Zh,G8PI1͗)NX}ǜ#d2 <F{y 7&rZ±9>'IRlv?Omq~j[Jvɑd>H턞<u1tF?wC8HYH`Su#b\1zFi(4Or9j&k#6fiM:)5E Ch"0DX.~;-~[W&Dcj^$țiɛiț1)>Zd%YAV/~M$5	|M_$5	|M_5["+u*d|P+c8]=#Hɘn#[O:]+k&w$ 4IyFQ$I(I-IR3'y ɺ~WO9XGe2pK\ ў'HdHʲĄю_襉cj̨D24ic)]f+/3Ny&_vrCiV|Da:O,qHz_E	x}Z{ON,ɗ-!Cg~gm$&S{	D/@ЎXCz. '.,
$NdgrʔaI.{LTP!oL4\ VP
/6.Mo$~҈q;.e=5*^SEѴOԦzg=Uty%$dا#3&BL¼K%҃C?`Edl
pI\Yc1#Ϭ$0jEf;0̥ݵƂax凅FB̩|}█W%77"\)ܓ-]_lE_ΰt6<_p3{J9@䐉핐tX뽔@cEW6MHBY^jO"m{OTi1`)%vٴ$.so9e4$A#y	HC݄<4eZQxUZ@{U'}Wa	AoBe͵"'0(R3!xHkބ<˂"=PE͑{ēzI'qu';rO3Ti#' kAiǨF{
+-\ykછ1,%pٷAݍHD'J;o\+$۝7V=$h^D^qcS.ڍ_4z2傀hq7+~K#G{r]umd"J/r?padި>%Z"ӓ$;x*S5]bAkpt>SnL<{~Ÿ ɢ4nA@Alh]cI$n2ZQJ"+kDMvɜldq0
pmVZІ]UtjQk=h ~0z2:x-1;\Teh,'Q5-aZajC'Edj0]i--{K)Rc)ly^jaA9(jon,p}D7@BN0Wu<Bs.EhynuE<k!|SsZjEm56ŊMs36}['SYP[KtY b-;sd9
s$ҏ6b+Zh琗gVl&͒zЍqb͘U&Y3 `)`s@ukݺp1X\~ W26X(Z(cbV#-戁F{m=َkS33ff$pXr 
{$coew:hgbQMj9[]%3u ŉ{Nq5wW4=ӣϚoylĭ}良Jfk~49ҲOz+яQmSogn6`M\f/i>k6SFU\`ޠ+3r(ju;Tв<*,O$XDs]"liu0`l|"IEl.~0J2"?i:{r2HܲM:[NGݏcy:p3 O|'"\}μɛm\rN`_
Q:k%S;}k8[-mf+qthBW҅愔kȅ*R=e&͑Ӊ>Ď\Xݹ6?-}XMran2a`2˂6&ϱbI¬3FnY*vjy^DΑB]v?f^.T>k:>S{#+),tj}5rO?E[;WE0A.'΃pfk_=3D9fUcf~8L~y@gdG517jevl. bVzj;>yyXZ!ccag:r)P`|Ϋboj/w wV螇^jnF.8?SV!s犣*˞߭ȳ|PDLfӝ
.JpwGcۇ$j8uG`AuuUL A{
wk9JQ4sG(7?e;t|U}cM*x@8y;t'-:d0<Pp':d2  ie4K4ԉoNFE 
Lk]wiv91/J|geMWU}lxߟ<0nRG.iZ)lU8yq.kЗ.(,(<38]*̬1Ƿ3Wmzp{7fuo0X]NZ,߮-|ҕOF׎{OuqBӺWfʺ
X/8_ts0L1TL;K1Ak}Y6)T|_O~~r/k25eqUu&#sД$fG#Bs{ `,{kvdXsx
7cMy局oT	\17#b,TWý:1mhtŴr@^Ilu'ޞD~x#㇓+cPJC;zk"`jKV!S*Idu|qlcVEǩhA7qd['m-(aHƩ]qS$#;㼥[[׬^a_6dU*Ip*){ ŵ`Lg&Y7*Ƥ3=RI#oTZ%#e<~bA<S&<Q0<Q b4fր-x 8ɫ|H7N*㾘 oY()H7`sxNvu9H:BMTj`)iJ!L˘48w]ɪM."+mUefmp?U4ACEa3/˟qB򒂕VbR~]Z1ڬq1>u;g=ڶt}#j2`NVyhiLު洰u+Tu5N~UGvƖlψvT䅱6FraW\% ex_܂A1קVq)P881s~yq,ZX12)UgA`gdMHH",tJ-sR5h:Κ$k5[OWD7vJg",x>GzŨ:ZĂj3x+ldM7ta2)&wbfj 0"n8BE81N!zܤ0(ˋ0\rlfRBaGZq2/,GsyiS$cxj7I"-8]DR.-|>E-I B_`>3\YJ얌cD$S'vi7z5f7@=愋=i۵-	36:&hnt9WR4
"TR!co<Mְ-Au5Þ4L$G݊ZU"2M&BIE_-6f*hDvb"[3{B:n0W
l!$A:q2H<'IXpBu'fza*K`%22bpfJoULX.݄]f`HgrZAt&Q",$ac7:
 =~ ɏI%SMl%:6~)=GgކP4Vk.푆0ƯpCAHޱHj)~xAKԦR<Y +&1e|Ey(p_<ⰋwElӛJʸnI#Hb1đkX h8/G;C>v"XJe:$N4JEpW֔^ɧJ/xDfzk:Eå0P}^6UˬGAAKgãKKUZ\返/6Hk[ڤǜ]!lV	-[pq`RO2}1\`Iېrq')45pMe1ZπfCNiM-ke0[󪅗Y[a4}zC(mW,myNǛ1d`z[M^:o"S~[fg,\nvfWexLC-3iҚ,#S'd
Qέ)ġEjķ/|sL[$+6\=%6!_~ɗ1
;3aL5~5#hܟY_S@t;8yҫ3<w{![:F_Lti!=2Ou^nqsπYUt\E>GE>dSnNG"ch*gtZw^J\n}jArv}qgn\21'"W:G}A7.բ۷:K.\{nZ֭nnһܰ\ƭKtnחRi-[ԓ	fH'@lD n	a[d,p?MϔɒiP4,8CeM|[+M<h<(R짬	G8I256
,$TpX|17v'".QUz7i/I.ƀ\_Zϵ-q>ڨKy7,hi&Ő5AN(Qb$szxv-3*V+M8__Jp+ѿ#ds(ÕS\9#<ȏ/ef5x¸m4K=Sj&OAI{4؛AlYNvA{'huWʧ+4b劚#ջNf7,՘!?}w]]1yc|v~V3*GմFH_~5ƕHgHo-'(]E"WV#sYm%UGU9zX#(;)13~ѶWLׂs2vb}=dPaԚV ~[YKέ .k,9yw/D1P=~D
U}Vc eS);жbpRqޜ<<KkKEX7:coKOn³8]8ܰ8H./nL[1Tda~m>+XP֑kkQaYTJC)$UM]0277v|(5-(eDZdI[%N6ۢE(Nv(65NP*	Bu͞ROINu`9b4/M}~9澟` f|,쬉P<΅}<xx8⥜MOl=8OD?rN:AB^{\_J,i,fe[ý p%'ȇg Q=V)gp,:PtGVTs/DJԄM"DȘF=ߍl>2HP&`S?WDSn~u.ڢwi)TOsU=<*-Z:UP3#l5ZS7q]9`U*^> yč.x~4Q|JF=dldk(qD1:*O}`oժBC (I)oz󫕵:r*ܾCFNsyY4kϼB5k&SgSVW`2ڱܡHT!Ts-I&t&c*y}tCUN\3g0aS͹>*u-*foDMaa0|&^ޜ0g>%34=;F GkŕXVLUGžYSʣY`7XZR^xAScxs.kQ}[SY,WH:渊?|n;P+_sX"h<#s|9y;k#o| ᡸg{;~bΖbC,gYNw2[w`Fxz܌*$%4;-d{	?q%͢4Ie>>ǁ7fEnCKX%t>yҟ8+l8xQ@65ߢGȩ.eB7,rLeQ}ӷoPW_U+\7Ny(淃GIyŻSQ19B<5`e$)H Bp6#\sInZ8+x0I 
M?E=ΦI3]r,մum[j2BKy7Yo8w{B=.wO*0ԠW/ɸW}`ŧY1-kdiB`$FNNr>-$E8m/`cT)sAp_#>s %:@=Myz1rNltPRI?"TTxGEg3347\S`M"Oy'(hM^JbnWB4mkb	Id5	3湉[<u's\˳[Ѓ"K{<H,EH|t7N02qs-K\*Lz$|๤8lGfWU];G m0%bD;Tx[% I_D-JJe\ӄ9Dr}9/Xm4/jk3s/itn4:fW\:Z۹{uRQW0IB+.LGe2/hDG"%ܤi{:c]al5^3`HMLfl,`N3sC %2{\a2=ހ?k	ߏY_ZqºO݈Nr@Ǒ]CrAo〒#)qQ$:(DG#׼ePۭi5F.k5|/|ZjZjHTp3u[Nź<OI$Y(ju b`t"wlU\uxԫ嗤˂'0d04r؆X-t4n5 粹pLm3wk-Z4A)>:
iވPQb~4t ]:ȹ2kg+_х̸60
%?EnJ(3=OqJQ4tO0(w
9n"0ayY]M
zX̍RF+BGDZoC=/<t'x`xKQer'yElC0$>Tj~% {Λ/(tOaX~4[׼Xݨ蚓઼բ::{#Z1-[JԈJ*.
Ig,d)]ŃA*svF?9{93Fy(O92sWAFH<0fYxNXͦV]?Y@']\bтeOeE܋7 40KT\⍱#$xpA]
ВD>D>rdN-Iٶ#]ۓeg LR^}:&M+zkbHΐq:r x0mRO'0J
F`L$/.<Sv>ښNQ|:s7uitc1D="GIL O0RWp׿\c!$*F[v3/P/>1jl @Aҋ<9S ԥy*w;.i:=v%#Lz{#]qw*?LIB:nES}e@_[(hX4>e[c7IYLIXLwgOzf=>%Ǜ@|U2QGyOlCh
|%W=k$=>{o?Zv^=cګ=<V¢TI{Z|;o3	j,2Kx. I=(dzmi.97Nh?!ZY^8{)TXrWU(/íW\\`ggN$+PMf"]uuWYڇ'Sb? OIzb^U&PTX6Ve_oQڤ`>$b0-`iZO,K%Q6a]P:k9`m;Y'Nؠ90`A( 
9 O诬\}y1yo{mDr[K^^WN(ꡧ6Z$MM]йFPR
ezd{Qe@A`"ƶW*-D'LK7y#r6bǞ(kBYI-afiT/\%ZbKE)^mk~h]֗<eEn(/;
fl"r,%Nv@9[~3fA_W7)E2}`=_>0\+ȨE&wmGӬ/eZԋT;#>6o;$n!$vaug֑D65msWKf9҇wjiBꈫE-X%4!0||O7qRz;}KzKT)iͅPu^?{e䰏<ɣ2c ̄wy!fyARE2Ip]%Ê=XRLr_-7.>CC0Q3QcQE4sgQ$:qW͐57H?QD!0_y-9#7>w]aꉃ+ou7OW<`f]|QU|1R$TmGoB"sq].0kQa>!~zNwP& "@|,}aYpMo(YgIOuXފħ#m-giԵJ.6vf	f˙m	lhL;PC:l۫eC_\DϫxdWIߙLFAؘgp0Nh',ē~ gvBpZ㻡YvP4&;*4uv7V<'|,ى.t@Z.@EYӞ,ɒA`9XR0'ӘSUу6Юs1/N\0Fxfz:F'xM@z +(1[FH XSuc5ۨ'Ol-r=Q 1ٴL,k0ϸ(kgcv~qw?~q([1(Y\urj6N~k7ۭfkjvk>(kE 8thr $;>QhG;Z[Z]\jSPǢi[f^r,: V?~ԠX q;RCuЋ.);u)ox5a'uHsPsfI#:eXFJ`:D>!#5ˋ?PꀵJuN9iGLtPƦ>t9{^ScxݑѮ2O܋8d~!W5"vsrR[zXMiUPwmc"dS\)`w(T2`:_nx1'%$^jIIQ:-~z|R#zUUJ8pF}Gu&ǂ9w덗x<;yO[rNZ]2dmvj5	FA(mI-"$Sjh8)swhMp5c B6 MH#4?b9txqqkP7bngqzYz8"gQ9LAwoJ"l 46x7Ky}Ipc#c%#*hH+M@h0"e{ɐRNqnL;ev3;M)AhiwqvcĤ1`v?0A|B+tg:3i߹	DaBoϤ 
/xhrt]%U*ȍV3܁j~(T$=XؤIe3dIE&yI]G}>P餾<KQn՗߬HOv0Nq6hdvmkt/&)(hEf2văӴ >|N^G^=LSLhy^	yo4GFQknLv\* ]TAӶ'PI/b7$x.(_@#DcI7FlRξ0#!I+&Y>I7wL3kzl6&Z~?*Oᚲ;Prfߢi=z2bCzl_ꟺVݮ_2x	f C#q0<Jng<ZqTdzCy)BÎܗ0hvNGhkL)(f%_-JJz܏fZA>/hbk`w{gkoǮձ7461Ź\ތl6j}`9yB)fT@о{	J0nyjg;0'l'cd$Sl={		9ñg??f?"go7i}+䱇FL;{TLfk_=a~z$yz{N۽W??K^ׯvzR{	k?@~k?AV3[)y|/+!Jۭb_4'I=ԓWo~|[Jݭg5;g]Ki,݃5hw?_sX?/h_[	0Y~kvroA?Aj&%H3KɃLx :ו=׮%U٬0Ga3zr0EݥhW02PaeakO~\V s&Otz^k_/5<:s]GM~FMJ`P(gv	WN(KF)4"/F~c^g_nUkuQt?P=&cfjѾy>%=~4NPwN?+h`7$r} ʟP~섞uZ$Yg_PɍD2 ɚw)~xP-ؑw̡zrAY4 ^_]a5M$,/#Jjˑȁ톾3&b_z\O\8o_o3F^{7%~#jȴ`{Jw`ʍJOK:\?Zͬ'dwq-"4g6މUKcV#n`"jGb~\:GG^<S<zVo7.Y_v:kQ\j.dŊBlw!%*TrqYo,"'a>)6Z^y4-rՖj7[?J_zC-17/Zy>+>/~Ǚ{y܅2oȦC03ZkJڵ߄[Mg*U*bT՞?v3K[tb6=ͦN߮߯z탟0'+~i	޸)'c7v<6S#iZIQ2"<2I 0>]<-zxț3"`8n^4tAQ]}):*;'P2nR賱IPG6xuY]t8hoiI;ҮwE4A0
.{x|LhuG1)elU/S "#GA_-YYuu{}|8u=zG,Zu|\L/hL3Fg'_܆[~[E*2GiI#2$ٵ~V[EL	Lih[l`
H
lV&&f޷١բ6:ǎ/`ca/XDqkiV@f4F}^o6ח̿>nZVoTZӚUBi)#-Ӫfmltxc:s7n)gj:z%4@sٚYDӞMMHQ: MZo.^m(jr2p]r`:qN8a!̹#fdx:<kN!Ʒ|UiEcg421sZL>|qzۥ0ǥN4HE{#xfSB SЭ/kcac'3<34aOpFn[P?-w#ZCrOD-HJNSA8 	pj&EnP(8	zl!TF37iugRT08K8:
BŭzSFF ^<?	#@Ұ:!B\](I(GZG>#O5G
Y/dabXλJz~遍gd2V{4jnMbvD$iLi)?
I/oJOP.;c\cOWqPIApuM&cG >Q|lYȝb3Ss2vV-RW3CCʇ/x{͖rV;mzqm76pS5vb&ejoZyU{5Fu
IVKGҺK.RE>퍍sZ">Ǆ]owzno8>>6 쨦ݪFj[z{Poڝ&۰u`V8S}nMfZkqh۸YnX:FlZͶ][MS۰5hUâN`\S[H Va!{l6:	
\'j>ABlXH46Bn9A-ٴkըۛVFM[@6l֛.o0TO1MHځꥆ2Pi7 ;(<t@G(lgTnZA7# ֺm7-Fl7:vձmj@iM(^]Au§MHRQuP6nè t|j"xn6|S SGU5@umy}5&#:7,h:40ِOZ>WjA#7t,PxuYGn6v*ٴmf?	!zݨv}K	
}Dk	+1~ќ)h+nIfApZWr|cQ	c.$
(5Luh(fe>EQvt$*#&( Z#Š4F~_%8N

zɿ/f_
yƿW-&I$gEMk~5y

kX_ahgT7~>~rpRR1/qL.a
rCvtKM=!ZW!q=r<Tni]o#G{Uz^?zgz~nT
yD:s]/g?7V֦/lEIsmVjJ.(8rF}msG%)ࢶ?=Z]rŮ7ɩ~/)oG>	P}G]m57osU Wrj/GB[t]\,2, )/sB\H;[QXzIOBh>0VGޙ8QJ1O?x>H{E<u'Iy5o{G/*I/~?g{_ROfLҷt(cj{`fĎ+UxuVV*<0 d|bM}}'s4G+L/n.	&11nqk?`|;Ɨ1E/,ơ7ΆuPx>CWEGWl¯DԔIB} H1AM1^.34qۮ(_ݜfU/32SЍl_x[+RŽ,),'Q#p6Ḥ/TcZd5"1}ѫHiy	S&)PI\}I)wemJJE\80Nmf_	:Bd_!7mY]'IN24vfi+tѿH,đ-e#MW{+7t*sX%E0,\ih(X
hs}*<e7YʬcR}qQD az/W~Hյ7GTpGF|#Q`g
?4G%'{UJ"rJiq#U$L,̾VZ3gJmf*7h.S୸o=9:J+ߕ+O o}x;ZF!z^A*+dIMR~tĆ; yEtPRE ݔp5c,̉O0x2=rveMKGi)aM
G|r(qxi5pz	 ^)Mc{vv+n,W'.ݱW{tE&|"#8Gi E ,*ddP-*b=`uPhsDp诿(X}N99
?"dO٫_ESe$$th2jgTT舯I9!oVuhKƾyP*b  w}O$5s/xN!)awbZ,Or祼}_|F7Jz)igf9A]~5NOYRѨC:LO(*YةQwй /PtLV$$k.}PcOCR8zet&4jc\Nun`WOddzl{Gȃn`V{ًrRX#Ub .o)PǑ-VK^~m)Ɉms]sbM'Qm_ᕲ# aȠnltbұHHF E(vF#~4aOT"Y9
Y'A-(o"%q	(1+jp1;v.;w"1ZeT 	yNsG=VIfL򯍲Pqc%%}5VI69Yv\lp0BG_"q)#c2]lNs_=\Nq')ܿT;vzln`ٌ7/vv^1+`mB6ysF(\`ڽ&H}-\PA|;F>CKqU Ped
EɰB`J&HVHܷta[??Ĵ@aPC.l3NgCQD	ĔoJF*Tbʈbn
yl	.(,J0wb:ֈ1_vU)Y.~̀o`+U͜4h!Ix:15q&1w@_|ρ_'fL'E㮴G<SYfUF>p_&O>.ī}&9WϚ}#]a㳅
89^̢p(i2rf*aq<qYr5ԑO/v+fz6ܱRKD1`tz\ `1kR43!0$^(3/>$% AD\膨:}n3V_|a'Ջ01+XzCN^˒^>c{ħٙk9+}p/oidGxĐ]+YΕ8H&2*3&|@L|Nd@h,[<uA8z$AVUn8 ZL\a@'a0qF)Wt ,-<\8չE64{'~,=g\"%	Bsfc	Ѝ`;uGCv<?hzWVvBo{W(<4)ecĂ88|&d~X2y;;n߈~:4~BQxe6-sת>`tqnFF_ᜉN=@P=1͒`4 Hˉt,$<K9nV40fi쪾Nj2Ve9áE@BN4{o}`Q?S1(c#^xP?f^ߤW3z^2rJF?Mm!.yPkiM]L'de̋[~H& dC؈p0	
ip=']ל#F'׺}}*1^$9y_"P~yߗl=AO9Y)niti{0Xw~3svHb5W+'4RHW%T΄)`;{ޖ`:8UJ%	y_g9"GS	HX<]q֡-0>^=K=nshdukŸߎcv5qzcjuRI̶T#O t.);uP'w겑C$U	lڽog%kt46Ԧfo	̣^Ь׿-TJ04lLdsvRt$Ǎ?~mi Pl?S?Px,j?&6[K+UzU'E'
5%
l} *?*'J9Sv*D8G7-=mN
PH4r>`Xg?Av&?'Bzr+	#^ ۡFFGF!N$VJx4*_au< 8^ۼ?bøIbD9'Ma~7V_WT].pA鬉:S'Zu0S|EyIM%x廬
15xnȆchV6clԐְ;gDrMAM6b%^I%G,44nH4Sԋ`BC('(X`L:xCǃpK)I &IA4x ED%N<Ô朡2&jgɔʧ`y"\/j/eX*lc5;>ʴ3WéeRø@TP.d7xLkϸ_L\ܶǬ)P]G%f(Z=ȴKٷ	OD+R~V2F&#݌#ڴʎxkUY9\4/6̹ykĕ?tt(&?x֋_vw[o1lA;=wt5g-ө_45+䊹wuG:[gƛQAhx<nCV?gbXtCTFQ(ܤŘO?9xԬRQaxpVU,d̬bL;y]$#sm$ňe9Oy|"c0(\\%Ug3q$ؑ.@lԺJV3J2q*HH[/JLl8FRc(w9UT܋4sbHd1vM/gRԙwTGIBRO?Fî~9Q\wCh&pM8"Jo+{VkϷ3"BkaLm_'h҈3v:NfQH17֬s[J#\R"7~37u,1׆Ws0s?zzqNw`#/X5j$Ɠ >3u-=2%V.~?<2ice%;sא0n_dv{v4Wv+÷Vǜo!G?.w'V?	7.}T^x[/<[.BhO^.RM㪗c\/S&h@\wTZ,FS1{,t2MޠA ҀQx\&H4JQH $8	[mn:,cN;!5#ם؎x9J X<_@K#xs@2Q	08'J[W<w}sFo}/FR>뾭ZK9,58qzGS4i;k$$O`}7͘tn'Fk6r<G݊TRdy}{>N;#3>eA{Q;Ib(! $cעRJdiŲ9/ģ(=yX)liV^9Mo̤Aq[HY(D<>[Emz[fboҌV\wgcKJw@$h柸oRg%o	=L_8UԀN.-?XFH0do`^8>zSL{d:돇މ;#<n`!?&nMO{;]g#%i_{P7^M rzh'	M x2s`ׄ^	%@c5%	zp
 >h
M(@w1(8#]%
B,<Jj2))Hf}tWҮR$ Cz{=E!(X@MJp(A̐E:&	@fzV"ty)h\63E؀d>P!x1ցtmhP	9"JI6)=.&ib W'PB?F{ƐMGj1+RQ3hś ]PCs؁Q0
F(  i ` 