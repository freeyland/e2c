#!/bin/bash

declare -r e2c_version="0.2.26"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=m2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(د_JLT8zF԰LD+X"ه}س1ۇ>̗G$EUuUbw{yF2]]FŚngtMhڭ?gi;!rC7
ArD;ecGs0|pFZY[ﴚ'F{ywqQ_(,~wqQOA~yh`!ߠ}??_N[Fn;ꗆ8tc 1k..Nqwqi/~A5uk]cvL0cv1d 3du7C7
FgD,_ >uCvčc?a^0ba0fQQDˎQp^{]
%H0P=+~`*+qkLGN2
7m/}lMC2M/:v3n SopJH" Zp㳝] k ߜ'#LN(<0;v#*a\îuJVoxn_q0b&*f~5t(b7|}zǓcFQ}MS0>ۘ
_qgz
o	m@=}O?c6^([AƄ5&ݱ3\s"^!|5n{A^&ƗϑyAq_Fu5a\)?;()|~]yukNYzvRal0W	d9CWM4d\V=hߴ78GЛlqv;i7dߐEt4d~;*1#ŬY9*;
v愾td_vVU;vZ˦vGN{ug^<]]ۡmۢMۨ1g^ ٥"TdvbEӢbZTLɵ;tx65M	6٦"TdlTN UۭBƇ0+>J}I$bi/|XV;HdhV0UuuGv*.1ٿ}1/U8Ld39͞ևYݟFMC]ތ낄if\^YW͑s&xd2wA^<:9擼@0 ٘5A(Do-]j/9rcvNBweue4V4m8[nׄJX-'y30ɾɐq17o~CYͥ|O;H~6jY܊mu2(.kP[uFn_,ܿ8u$b.X?M ;qGfr W|lvv7wuU]<Njbsnv yC1_jj$˿\a"/]V/+9֯?78>56Do׸\-׌4YS/MIF{E}Sw&ѩwO5KK oWA}@}Dѻe%@gEE	Ҥ2 `urxi'N|hm
%JIkԾ?w@R;tǓعE].5s'9lck^q V`c Bpj+/|7,QpR`]݌A- [u껃[C1U! \{t*&urR,>{rs͗Wz_P{y%T[%cYҷnƿ._D~{S.n 0RϠRiD*
7]w"m?9zxŧ0@/%^z̢eXɌf} ARpTdRn*/9)Ga{uU-
[Y׬Yc_.jLH yU[IN0v?Ƭ
"\L=*	&q΂o4cܫYª/9鋮/7~浐`\更W0>ꇝW4w×Y_:<	{;ϾUȞ;"*/\QP_6^8mg͙͢?lw޼sI1n)F^y,*1RJ	s~&J@MؔiS,i1
#fM3a m`&*C6'_jb="!`R7`*j8:AF,Bi' \|U]pg(r,?#tcUH	g8feS?qv5"}sjf>eܖu +Kɕ_U75	6׻SD\"ԫ_pGLyfQZXh%kȂ$_(.+Qq^rä݉*wq;<
)ZQT9?8|We$~ws_=CfyfmMKK?aҲw6UkHA)dK1P|><
FC"PAjv`*u@fQؿ3bϾ& R*ɲص⋉ -9_7:d8 4'Xb+UPxʱ02k@oz{m~D8\՟m?y?GraEEKfX@gs yXK'o<O,s"P>p1dKYI0i+']ulq=G`N:[aҫח^͵V7oZVlwl/ ]rH.TƮ#nx{hAD}uQƌ(OFؿHZBRlY&:qI<WdG
jK_=_l >UQ3ǒ#ϾgUS	4L5eHV:dҞiqPAkVUjS e>%^W)a/:+tB|o~p3'<UKl/}(}՛F0lvnO&(i+UT=L{F-,uN[igD`FR[S)U(={Ǜ^ʹ%PB;PL\E5v%ْK4HapO],iBĢIĘXR~p".
j{>rNTp4ag^u_pSe*
4$-dʖb9]Xe;4נJ&=+(2O}4v}%w}8/}6e,9Wr
;ܣ@N5SUaw)B"m|W|eF:A I7

6)氿Fq0H0!e֧y+eݹ(,ΰ0r1aPvWj%/OM-Z)%]ct-+	MhE|/ 7ـ˙P$̺Dhi
nR
3JS۟&ń."'%E	F6Az{P`ou_oVsa݂L<u6^Pq]4u$o'	nz*:N'c"LU$LiBK+bbPkA5{e@"O0)d64(Ձp-\6fd겜Ťԋ/ƣ*LG2sZ;@eA^DAsމ4\1̶I]w:蹂~qJs{<ﺟ(m]k0ﺓI{a$T(+(}.G̀6jA
Br`99zEyj1vWWs{=\',R
x,}W5ɏF1(cVN`5T JA):) -0/[#>}w]]1yFtuuK}Ry!r-' Fa5gC7q\,;hX̦l"mo*F֡;ɉn?󝡃ArM;N΁%]n/W'3{J&f3= as1W[4깚Un4`n6yVsfImafc"
_;2'd#ZFtvhin#v2RtRufuL9bL>aO虷hsc~;s8Jn$ 
}"3D!qKR1lgKȉZVN>r3hϻE}XY,Up420aa?Ó咮4r58]yhujX^pSőD]]	҆`T't/>Maلsh=t7 (vYs]
1'A`2I >[TiFKb!C7~\.>qfdٙ5񉾨)kŁ]cX^$1.ȂwѣPũI*!kŝ׈Q1f8>҅mNQ>kY0\"3wh*qWz>$(BNܡ^:\MCfG5D=n
0l6rSnq39\qdTQ}Ӊ1£wGhRMҩlbА1HznmE(]e^_)I2C#s+|s8)I3Jw,@vJ%[ܨ#,%v٬75q[^'vۂzaF,YɈ8:Vy̬"^ Ll! 4Rײg-Cq^ɍL4NH.I ?LNn״VN
ڦ%¾e͢09x"\w"+F\Eip8h'Lփrs_b\]LB#H<-!0x+`d3-XюTxbqDem(|D繒):5@(].K$dRFD!b&HV YIĪ[!i,O	YĿCv˟ FC׊|gStg.c/BHY|/[Hb?z'#330J/A|hp}hcOpu7t뾃4i҃nʨh`9@yUuV"tV]E2c g,Ʒ3'^xroOL^U~qru:0"͙xMrKK6(bV	VPa1H=a~C֍<egzŗ\Kyc]NxVA[ 1=`#C*]γO0	&Lˤhd
e?`C75`baErƣ'Ԡ	x'e",.м[y~܋OiNrVJ-TɱL?<R3-qȝ'X0(V.h;eG\U-cBV ިI@KDourT'}g<ɽhO3~u<vK4_<@(E:bΏXWUe[͐%YuK5g	_0zcN;g$%o
So)7HVƗy#W%F|r%V@"U
î?	2o D3UӀeQ4b{5
y97hXA${RG4TcMC%)T+d#ޙбڈ>J/#c+$db'nc2YJV[l
#<DG9-th=Us$)6_o~v?OmSۭMmi6kR;M5CnbY?]?m?MӠ.KU,VF(Ɔ-v.]s4~Z
*T8!',0(]]"(]hKbEͪʛi˛isⳬEV"UdITzCߐ7$	|Cߐ7$	||C ߰e-YB +HHA1v5;$H֓n5$wUX~ VR^+)**$i%i$I$</$Y=]~#:83iY2x7lgAw7,1hy43m4aXII%2[pM,D;=~\iV|D!O,qF_{E	xXm_+vyB}:<%Y/Y@v:˾GLtwOPO~8;b-m麵0HjI^gfJ=XV RI?t
)Ò<P
1(B^1rX$۸7	E6\z2VH٫*vW^'EјOԦUty%$	[d#3tcO~8KK$҃?`E4U
nI@Y,#ܗEYY5g"^iZc0B|#!yTaBwJ^{qK+Ēܛvɖ/J/*WgwJʶW[\fE=RR-arCĔIHW]J+&$,N/kԽ'0>PT#
lZt7ל2{JHBF}ʑEV inBz2|-(	*- =i Q_7!F2ZdsUZ@IF_8Ҹn7!rH@}O0Tird=d#hb\_]oUZ4Ȁ	H`ZsP61ઽ>BJWq 	2NmGyyixw#QEN0׊t>;bOM˟HW/n|
t?Of/Z̧-lwe~#XZ䜹>;n1KL(@itvxEn"7^׋rQZK$qD>sЕm^4jt8łlBa|{9h՘xV1lԙ"7Nu^Qtsm	Sd6=t;ڒoWuid9?{>WmHnluVW`ּ-z@$6Syp^D4ij1`4/[h[5TSRzنs"{rQ-%jon,p}@7@BN0Su8Bs.EhynuE\^ݩ-WMbӜ(MITVV]9?_g~Yc抳~19YU@2[I$<$;tc=F3&YIk7xD0j^NZt`9J֙EkeL5L޲jjh֓f:e_03zD0+\Takb K2??[&|p@\(:S2*u ŉ{Nq5sW4=ͷ<(kNMꃾR^%35asur|{gh9,=%f7x3Jq]ln4_9eI8s+?o?I~Nc,c*SHY͝.
-ˣDK _61j*(7(T(	
ͥ\P̡,+sg/';Y-4Z{dzD.mH}7ך8wK+s>?UQ	9H0گ_ӨPG՚)ǎ0lBzb,LWK.>z,^nm-\hNHY\HWf?Oȅ՝]wō0N!G&y(̦d2 ꘔC<Ǫ&I
)UfUsp=*aړB]v?f R.IBzL1۞ttjr_<<ЙAxT}e6l~}U]r+1q<\z9'tHB0;3cG^řf7$;ьQ{7+_s9e2-@Xga$hR9O@J6_J{{ۯ~2gkyϯ_ B<bVW3w/C7q!uaBCTqTw34%yVoȁ}^P]EɦhѺ}8H^ xSw4
A^wI]WeD B~p/Z! p-G)&~.Eb^Tx眍7R7IE!o`$Eg` KQk>ЛiH&QARpDeN|Cw2
.zXQ`ZK;<׏a.xb/e_vRl\.{Ugi(CÊ&ub${i~R&o,ŉN{茼tY硔9[ڝ'4p_)s|_z:s@{Oy6{7 ث7a60uL`v:iux2yHWN<]:=^MN^%*	(`?焖oP~͝Bl3cP0iX>xncVV4U}Q6)T|_O~~rTk25e~Uu&1ThJos7p˝t)$l:6J ;lSrXcߨ(59R@$R,TWý:mhtr@^Ih#Qʘ8ԒnNR;`Z]K`\&19X"Uqj"@v4I[Xl=qjFerܔ3Ɉ!8o鱲V<5kW4`'%e~O9]L$ MUS%ۘtGuhwU-*W[2B[#x d3e"
?N̓n &LcfXs͂~j7tV3	fUjA"ْtu|6d8^#t!H5YPvѾ`(bZČG	:OVhr1'Yl-6Sn+8EG(*
;Q|Y~M

ųK
ZIujǌjQƈ9<k@ԃ%:MZI!GvY3]z^֭3ZS8Wfzے-qپ&Qc	m87ڥr*+.fgn u2w</n;Vq)PXzi-N&kf_^21E aJF72;(cñ	IIw!NY*jS0xMYd{-lfx)~^jlSdp?MGXpp\S{ƕRBg쒴)1L& N,P UG'f#׉04eyQZW088\9<Ez$0PVcޥE]୚}7IHţOڧx%Dog4;KْqȞ`vv@"=dn=ԃv3eܬAmT$5'\In<Ʒl'ME<ė,) 5A@sv>QDQ"8W
]'lԁ<[khYW3I^LrԭEP%+,(؄=h")DTRjc6@>mWM,&aI5't+QaϞ\f!sepBB9^)+ӎ#	{!؎UwboWni o Vr*#3+W4D>~brE&Z0(G:ZV3a!	NQ|qH~L*ݧ:lb{,ѱ#N6 ?:6|<Wd'Ʈ2]E'Eh&^wql41~3BER3 Hq'CZ<_6qjY1)++C 1]ļ+*G^8TRuKEe&GqcdqMO d$|`)	SU#TH:J)*.(_OLY1^2lzk:Eå0}^VeV K@%%u֥K.S_JO^mrmcήrHGԌEbe-88hilkSȤmfBZJ%gwpEM`-3 rs3})Ic1e\|k^=kvk w F0Os-Z]m4x3Wo	|K`Wg~t}쬼ʫeW^ٗብ[g45K	AY(5#"L'F\6N<r[SC*Mo_I5昶BI"9%QWlzJVmBN//b^w&f.+Ø*9(kj69G0ѐ?ͳn~+VSvpWgYd7Btt@f+P.BzUe6qi<Vo87n|0]t}rskܜ.?1EET*4̗轴Ǖ܀Ԋn70*be:aN&D˯un6].֫ESoou;7a]ܴX[ܤwaV[o2z!#p,&Z6'+B̜7N<?و  2öbXB~	)!n%Ӡh.mYq0Ňp3LTVfR+7TyxPOYn4pdj6l4t3QXHjj%boOS".QUz7i/I.ƀ\_Zϵ-p>ڨKy7,hi&ŐAN(Qb$sxv-7:֯s+M8__Zp+ѿ#d3?(ÕS\9#<ȏ/ef5x¸m4K=Sj&OAI{4؛AlYNvA{'huWҧ+4b՚#տNf7,嘌!?}w]]1yb|v~3FFaW"!՚@ܣD/\\YUrTչ̃AkhtEۂ/^mR2eNp_رsLuC25ѭ }&$eKέ .k,9wPdh?}">z5CF[*)uDhY38IVq)FP8YLooNյo,^Dط	7SdfY.un?OaE7*26W,(ȵ`ǵ0}ԕ'EE%PJ"IUDWL'x͍)
tMK J0oglS9)t
ʼM9E.FԂJP]Tex!S-?PlfS} w %wb=ČEñ5<#sydO$ x)e[S?#FiG!9~ #lxDп#=ӗK6 =zU=`pv;#x	lsD o3s(g+3?K8EP(cpn#s"%j}S&a	"dLF6t$]Ϗa0k+)7IB:m4Z凔
'T[X-*|ظQTs@Pf3Gէρb3HBq+7MRLC3}:
JQKǬ	l7jT	G!T ˷DZYj9n!#e9u_.3oFZ~,T5/ըjuvl*w@9UlH"(\K&lsEq1/ɘJ^{<B,Gi,&!lʣ9GeN[2bfH-K|gB	sSBp13A=߳`ztV\^!ePuMYU=<v%8QNŋD15L7ba'5E%x+o#ϗ6AB5H7-юB&C:B=W!\כ?RƗo <W֛{?Fl[]2gKRWڳ,}';Э;0n#<}qnFyنqK[B2tv=̄mθ fTMRhpYېn`1Ed"O'8,^ (aGr-DY#s)ᨯ SY':|&jnEbh~+2qS|}KJ`QR^nwTiЫ* aXI
 \!+vv.0-_KKsdUpZ4c9MfqW殦mk3RW]Ҵk^z	_ݟ#)6p{~PMcxI,>"oU+$M5= #1rJpna$.m{.6/OB=0|A=baIa0DG )O/FΉ\Jp GjO#|f暦xF`Tܴ}_)8׮z-\;!v%`(Dsf*vtnNVs0S9M;ZJoiPBr8,+%K|#ֲ+"Ur :r h=ϵ-sp1!Rb_8]Wu7,: o0PsRwol.k$}5*)rQJ6N0q#bӼxp̽ykCX7ӹV(;陂/u2s{uRQW0IB+.LGe2/hDG"%ܤi{^20J=|W	,iߌ3*437ThpQ+#S/<l\M~Z ~-h7`}rmFt*3:JxC$I8 q@!z?u-ՀnM6rq__cX~I jUj(VCT=OcĄVzp
.yz/N*%DQK#hϤиg+9YGF~I(x	CP%<6Ǻpndfm35rQ3oUDLt(y#BEex!^ҝ`vL/#ˬK#|IZ2(8NAnl+OV
<wzE*zGR2:=f(,f8	JozfPV\e7X="Ҳ~I|;3[ zWȝ0/#csW'aVU+s@xT}IEa;G
r]NbwϣkNVjƴ|l*Q#*y3\0>+L''3,Y>ɾ-RU~3sܓgt0Q:Ese殚lx`̲x+M:ncf~rtsE=9OOq/ހL{_,Sqq7*<Qջaor+@K#y	@'[lmG><'R LR^D@Bvy=51wK$g8Y<}6`N\%#u0&pr)fmMPp(>l9ވO{~4:1_g"~s߿}#us$& 'i+8_qya+IxNі̋w#zċOGx^0@=PPYzq"'Gqj45K1c={ǅ3MǰѮdi[\o}cD"nBN)b9IHsP%I9ЁF(ELS9vCo@ġiGՈ?#xh$6I5./<4CQ?ǏɗMzM jgmcgGgL]{ѪYX*?i=q3mw<[Bf	υ  GLϣ-DT1	>Dk9+5|']u?e9ټ3CSj#eJC_ib5aJ_$k3..2jKZ$lJ7)_;CO>\<w\j*$ 
J,-J߇D&x|V5Fg}>[i a f!LJy=gLj։6hF{39B#J?lzNF%B&c4=+_AiFCΛp"9@-%Y?+u'NSY-{_qHrml	b\Dm$a8d$¨T.4w=lms9J(Ld3&wTp?9wdYq!,-\-x@aJnAuR<l-5T{nWWŢuj_*Zs5C(Q88df)q[:,OW++ p8oR)ӣe,,y@ {ֽ02]+Ȩy&wmGӬ3e4ՖF-	NG8e[0}A\:ƴaz.G:W^=Hq<$Sf=7Do&]o+TbӠQ*ʟ^y#Wxl883]GjAc)Y^TE,zR,\yW?~I󰢼zϻVS3C#w;)v@h,9kUTMXjYeU3Fag{`wH,4|WyKNcȍ]WzʛR#x'YY/v_T7_%vr	ѝH wb]%p;1'/^ 
`UE/L52!:)\e;,]r{R.u[1Ttm)rO}cg`	oіֆvt?_ɐeF!Z4&n_Љgk~#"~^?ShwHvpQ:=8[n	u"^|xo@rN_As|7!k7c0DtG6ʔgQo);Q5eH9(kS]2Y2J,K
dst.zІvR2:!ӝLgqY9CSŧg5:Ͽ8YE^d?Zkq(]Ag4
ELGWĲį33FEyblDȷ ɮldbY'xyX}?)CAAͪ"V㢥w\]FceJV5ZY[cfuo5urC4P#ڑN.FwV..)gc_v;vּr: Na#ڀ_k5:`[;wÇl1ܡI]Sv</%-*giL,ԡ"
M<Gt˰"DtŉP|
6TGח~ˎЉ:W i2G3$F3xOenfu|^%vS	;BZX-Wkj*s$Ĥ*u&@̤xL9vBB/ f/fZbRI@ﺡ`Oa]WPqDeU5W_R	o`Ϩ/hX0n˓iW%g~ϠE-CjA ]:=EdJ<;Qp	.L@D	o`3P,gV/.nMR\k}||Y^,NC/+^1&)H7v" λiXʳ+ ~yPADZ9n5\dY)i9ѡG	T Z#SN_@:fն p_wqa¤0`?0A|B'g:&߄	DaBoϤ 
xhr]yu*ȍ%=5]WJ{,H@ohlҤ~ٙL_~$c夅Y>E?RU_(w; '`;I8{RzG2'U ;sqkkp/&)(hIf2văӴ >|N^G^=LSLhy^	_mo4GVhJUvZȀ=&&PH_[^)_KI]P֥ܿ#DcI7Fߝ[fRαq
0#epC`x9n&f;Un~U<5erݼi=E1bCzl_zVn]2x	[dX :F$`xxHԏ͝786/a@$֞S QjwJ6HZn{~U6_hY<F%S7;[ۛ{[?U{]cSɝF1;M	sZN1D0UeE<!pvuN7
s=¦?V*2泗ދ3f?"go7i}+䱇FL{TL\>paNxbPLro%/ׯR{~0/
f~gSoi־ᏯWL*Y/;{on04=էߦ9IRqf<{;Ͼ7vM{v]-<ӲY>};o^'V|͔a4m%LlfڽN2?ń4ߜ&ӷL%HS&˃A&<˜`Ekl*SqlV|Yv_n
]*L(Lao
`o7[YOc}/5/hOƊnq?!
k0W(o6pJP58XdSC^BҏѧLozK2̶Լ}MJ{LfhÝgۇ[_=1_AfY]?w?Qlc'K5peTuԝ ɺ7]~KnđH֬G1?Geuxl#geTЋ#2'MiY䴌Ye;<o"bxTQ[@l70s55Sgo"Z7[^{7%. j4g{J!v`֭JOK:L?j6:'dwq͢5o6߉U70#Isk&#/r)`Zc-+w{W].CW&Y=m?v|HJ.Uj\쮮ѰA̔Q'i-_~O/<r	Kt۝{wq%/ݶJۭwt	מL=pW<	q}7 dH!ֺxOȕcFu%F_տI x6J_ZJPnN?]C:Wiw[z7?n3'ү~i޸)'c7vW߾ynWŧ؋G4Lړ:dDүy9
]U(AWϽa|(yZ7gdEp~/hFУJY)RhTvFO#hd܎Bgc//Ꮱ̏m;/dc:

;
7qӠ?kN>c#J	H=({q3Sjo-el<N1 ;?c_qsxTf5=uNNctyS=7qa2*	|q<zU{nQQ'lL̐>dUWm(b.N`J;FWvte@PFwu0!70U_/*`}q9h46VFZJ :[]mcg=n-{N7[(	tVYmQIkJNfs5Ui&[Uޘյۃ7]HȔSĖZs{i@	~lotJhv˩\;)XI8l6Z9d8dZˏK908vdb0ܑI}S&ކγg*{ʊ=mhF&~.8U(ee;EBw9.=wzA*ŸĥEL	h{OA&;z podkҐG0nCrhuܱR0<3*h=t_OW +;M	`$QL>ݠQp<BΩvn$1j>RTPQkj!V)Lk=#/peE iXbš BgJabJ,?dOoѣG
Ynf顼_x`cA-tTͬ_̎D0ݑ	2#'u!?M	Bzgl0b,VS#=W*)(^¤]bx@*fUY-;Oi}S{UU2/niӶڝƪ\u6vkf<Ya7Z/2i0YUFy`Bɲ-EV/ښb(*Ujd/9Ji*l~& hh۝Fg؝tֺf^mu\cuЮՎ|jBن75{*[]\[ݖYj퍶ƚڰWVp,Z LMK<6l
d[ t}|6֨oa ZAnmn퍁^X购Vްj
rֱ9gfpy`Uh@
dkxCنnmJFڂ^^v6-@zүNO	 >w,hhwm	lzqkutVFlPv6g]*-^]k@MHҴQZletƺ|ju"xnb{C S)-{s`BukxmdVBZvO4lhɧf+*@#Z7@y1Fn۫PɆͶ-Y__O5]U7@n7Z jWXw6X[$v:i*|ݯnp?`
/;iS?'G'$?OPjJP<āBFӔ;րWenOZ#Š:F4+.
ߟ'_g3/<_ޫ~Z5F%^`@kAh
S}M>q'	Wjz<^ 2^ \|χ=*iMF
&BRH{RJ3]@K#G{ϥc.mKٹqGGNtZ?%B\LݪhV)mZQT?EGRv\=GZMIʣ99x>Rw&:c3p>MroߋsOi9yr>T#lC[O[yNnx_J2<GNEh^hAN*/!1_>#.$.[gBْ+"tYلbhQ6QC
^$WYz\w`Wfw4,-3_K-hP)_Ґ47co4D!FbHwl9qyNB@R~cIɻ_UwNhɫjR7CȣKIGD<o_DW*'LcSAI|O2>ʒnzlPŊG/<?_}m޿tU&JHM$D	(>Jߴ[ﲐc,,oSiGY%u5̪̔ݏ!\e-_j!5ʊrR5gS~+
B5k'(Db?8.0R-a~I
1T0^n3W_ҦD]Z8VGo20:9@W¬Wqd{֔It}L7(Yr*՚]^}LHBV}FŦ=D@KWTF~d9iLYI׊B4J4w
Q,aJIC(>y	oXu	TYϪ?U⢈@fKy_.ojoͩᎌFЁ}<
?4G%'{UI"rJiq'U$l,ξ:3gJԔo]9 [qG"otsULuWGo^YgqH6DO+H5@5_eeޞ"Fʵ܏uxؐx'"4Bed+ M	Wc=ƒ̜X#.'L!#lVtVVp'ǹ6P' %Њ˞4ffgV(_R(~}{HWd'2(st(}|2kHB(9UJJJR_הl|<i'[RP'寢Y2jhg4E@
@k3j*tWWb7`zT{r~%cHļIb(1U]ʫ;ξ'WdщU<G[;1Hde'R^rվ/lll<?%U3O͞ռRY
'QiT!NAFj'w|,K`H?tй /]QtLV$$k.},Qc"}#m_^Hx-(Ԛ]Ndj1DO:w<f&U8S],2p%~Rb7摒x';w ft%^);zv=M+z, n2X/Ϗbg4⇀HԉNE9*u"$r%^SGq#ìcgs'"9SOD0w4jd6QJτ*y"(UI7FYRAб[o<tڤ:ϙ㍜Eq,t..'0-FȮ>`7w6هڪg@KͰhGQp̬]nofyfH&d1g`](,hL Xagz*j;o,3DQU LFήPK8IFʭD-$+G$Fvg=V91-s(Yj%^bƩ_R>E0@LA'k+OPjR0y*#a!4E$x,sD"$NC*Qb̉Q
$Z#Nea}J_3 8AX;JqUi3#2FjOf{LbܽEKDs`	ؿ0SXqW#U,0*#TvUivOys4Uf>Hj~D|gC#w^`㳹
89^̼p</iRF9ek|X̄}j`#Y^(`) 	͆mc(b^h=b֤ifB,aHPfy%֌'^|:=IJiyAQ}8g2!Cg<\67Wxzq ~f8f8@o8Rٽ%3rkكW֦= AO噀k9+}p/foidOhĐ]+YΕ8H&*J%LS p&od@h,[f<uA8z$AVUn8 ZL\a@'a0qVw,SH%;xp8sli(N<Y\{,BDJfncnwEګF<?hzWVBo;o[pgӬX͖'>pTɎ1wevn7n*:~BQ<f:-uW>`t5^FV_ƛᤉn>DP=͒`4At=hc7ZH.Iܬl!1ra&F=L]%P<[NrQ,g8B!;CVȉf1;
'bpBeqDЋ8bFыXGU4㧙xVr-BAy"ECoB V
ܢAx-جK#7LyyEL>xNfpA =g$r^ksd=8g[APE8K$$'K?D~neLejASN~
l{߂5Lu	^a "X529%E	&ġ3aJ;?IcD	o+q0*vnȯ3\kIUΡP¸QQX
z!~3K}ntheuoŸcv9qfk[z}VIT+O t.);uP)w겑C$U	loKMIE9:C@G@jSpmRQ/hjZUDAP5g( 1heRϠMM+r'Ǩ cx|<bcj_gPuRtQ#%\fv=C)˷=d}Lw6tq4r>`Xg?Qr&?'ۆrBzr}V!nj̡FFqF!.VH.42_a@~PqG2Axmފ/´C@ɸ
2'Q<뚪M^^/'9IUVM\p@S75W`Tx*cewC6$eh%<>cwaψdul:Š#KZhh$}AhN6J/XJ̄:N4B	NP61	?	=ScAށ>ra+T
AK&"xx)8CL0ՄOՓ)OаE`_Q_C/j aig.-?*/kS_yq]8n#-c֞qq%YSW$JJ4%=ȴL׷	OD?HKN~v2J&sی#ڴɎxkUqY:MEvS\wqpAB[~UY0`[iJ&넞nEN){Ƈu>\I@e@=|nhQX=B",_&³YǜѹsADY  s6m|6۲<qf{a1ך|Q,"~D28vsHNHf.),덞i	W)V&u 	E	D`r_ʍLH3g?()LrgzYJ`⤘8EIB" Vnw1$QǤ\dF Ef!O$Tim^IM&FɾVg]BL[ffLm_'ht(ct۽n>NJ($NN3]֢Mi2(bR&(W
L62Ƽ/]xu.l3[43Ok[zrxV^!<sS#C)yt <aC'p"M8`MNv0dtUygVeHdoi͗Fʎl1]5/fg~n<LK g.JUhQK𖯐*pTA;?ƕ2u J!/+|QT*bu,&oV6p$G 1@4 -TZk)P4
	`Ȁa.N?lh- ^ۆN@DxlcI ͡_@+t~7xs@ᒜQp7<f?{^S|C늑oܨ\sq!9B"5u8Bsǡw4E'&}a躳6P{eCHAb]x]J#v?1z\itptԤ
 }q9靹-B&ߋqV5SF	 a?R	/y!Ec6ZaHJ́}c&Bz}`E'9j:mуLf"!{gk?~'Дf(_dux>Y8tDr>,yˤHO(c©Lv:0wVo6l@4Ѐ!{ :x~
ȷs'ӡGX<N>!n
p6<O> v1
}CYް(	J}V7t-`xρc[^rzMc^&3Pyfy;o} }5_0qtޭ ;-.JfŇOJYԢM 
]Y`HD/]I<ݢG|0Zx-(΃yLU<!I\X(-SzC*:\ C7 l_IZ&~+N|?H:fZkϭF>\sIz]e|{=uI	;(Mi_unYC P 