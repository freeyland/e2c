#!/bin/bash

declare -r e2c_version="0.2.26"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$m2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 %] rH(د_b5T8zF԰LD+X"ه}س1ۇ>̗G$EUuUbw{yF2]]FŚngtMhڭ?gi;!rC7
ArD;ecGs0|pFZY[ﴚ'F{ywqQ_(,~wqQOA~yh`!ߠ}??_N[Fn;ꗆ8tc 1k..Nqwqi/~A5uk]翾b;"a/c&Ȁ]gn<nΈ4X2ǿ`A|ꆕر7r7=yq"7<sÈŧ^DiG1.;rGy1|v}( xBޮūǭQ0>9|g+ߴ51Ap2dJmOѱ;qs8 zSBro2g8X#pmeGg<fBpvD1ٱQQ7:w8vEدSzƛt׎55k6Wi7.{LGw8T3+wn}1TR>UxcHh{LG
:6&1Q+x
=p;21|$Fe2=H%GI{Kww ۯtÈ_kZk\_=ݟ#':Tc-}B8<GF@5i,U7 &80۹Cݎ`0Y7di01|`t
lr?z1kVJehB9E8#W]UeՎݬֲݑ rpY!ϪFWovoo6@Ev.٥"9]*X-*EŴӂbr#/6MmdmME6٦"Bkwv$
dRcF`K29֪0Z:f%%e]Ѷ]
GL%}euKLκm{Vk=ck|7 g@Gs䜹	%Y<LhW$t$/?@6fM
#[KW"q0ZKܘ]Нnmn=p=ͤM&`u5VIjG<r3u?N0fؾݽpw͏y(o6pg&2X-[1XAFy:ť rmQCj.(łDL	ԣWc'W?}`Wn|
2ϑb&5s!6 IMl{M@9#ob!_1f@/KM|d+,W寫rX
We;u熵ڧ敒]{kɥrHʡOC58IAZҔm:a\dߧ.95~oz1$`^Z|} [U&}p(\(:-*"L& 83WMpt8qEkS(ATzMB88|_ӈHtm IObc5bvHG4[K4bs֏FyXIЂ3zĪhLܾC`sFIUww329Xoթn,T r!hI͝W6_n_}A9j)PmeыKߚx&p|2O`Ky>j,F$K(|3tE@߉]0 aw'z1M`'3j8qJ6 ZҧImSI I%A|W++lecXƾf]J |/*0a~YD,i>zUL_	1eiƹW!i3BP|'U_r]//9F_nk!1N7i!`p},(;iV?d/2tBy}av6}?=wEEm?ٟU_*lqV!*((J3EK.jybR%pY%;fUb意tMH)%ҦX2bF̚2gQAޣ`&*C6'_jb="!`R7`*j8:AF,Bi' \|U]pg(r,?#tcUH	g8feS?qv5"}sWZ|ʸ-V+!$oj</l1wz0DW*-,`<K֐es-IlQ
\V8+C'&I7$Ub=evxTR9.%sO~qv{ʬI?{Xl:u~h#%äe/ﬧ;m>3TpՑ:Rb|x8EۡT?5"e/fŞ}LTek7Zs~a'zote4qAiNʵQ7avX5W>P(}c'S`d@޼-b-:Ov`qhl9?~j{{̰NުGCyXDm|cȖIóP`&BWNلRMϹ{T4tqtW/8dk%nߴB.H^@
*\n9>n#]3 F=+gDɓDxQ
 	r	kٲMt⒜ynԖG_?_l >UQ3ǒ#ϾgUS	4L5eHV:dҞiqPAkVUjS e>%^W)a/:+tB|o~p3'<UKl/}(}՛F0lvnO&(i+UT=L{F-,uN[igD`FR[S)U(={Ǜ^ʹ%PB;PL\E5v%ْK4HapO],iBĢIĘXR~p".
j{>rNTp4ag^u_pSe*
4$-dʖb9]Xe;4נJ&=+(2O}4v}%w}8/}6e,9Wr
;ܣ@N5SUaw)B"m|W|eF:A I7

6)氿Fq0H0!e֧y+eݹ(~_YjgXNP0d(;+5ԒvM-Z)%]ct-+	MhE|/ 7ـ˙P$̺Dhi
nR
3JS۟&ń."'%E	F6Az{P`ou_oVsa݂L<u6^Pq]4u$o'	nz*:N'c"LU$LiBK+bbPkA5{e@"O0)d64(Ձp-\6fd겜Ťԋ/ƣ*LG2sZ;@eA^DAsމ4\1̶I]w:蹂~qJs{<ﺟ(m]k0ﺓI{a$T(+(}.G̀6jA
Br`99zEyj1vWWs{=\',R
x,}W5ɏF1(cVN`5T JA):) -0/[#>}w]]1yFtuuK}Ry!r-' Fa5gC7q\,;hX̦l"mo*F֡;ɉn?󝡃ArM;N΁%]n/W'3{J&f3= as1W[4깚Un4`n6yVsfImafc"
_;2'd#ZFtvhin#v2RtRufuL9bL>aO虷hsc~;s8Jn$ 
}"3D!qKR1lgKȉZVN>r3hϻE}XY,Up420aa?Ó咮4r58]yhujX^pSőD]]	҆`T't/>Maلsh8t݋љ
PL⨹U ɅA`)sH&+@pAf$ Vq82t'%i.HYjޟеVXؽQ<El|}jVTܙ}}eEnƈr(]Tx%2<sweiCrr+feP:q8nv \C䦠
Ëfo#75?˕L}Mfe7(<|w/,*Mȵċ.¾HQh0U7Uxځ/S1$=2<hZ4^ʲk4p'TP_:[*kjX{Sxkn-[В̈pcE:;.Q0u{* *ͤ+ ;@@ ] {-f6EdO#@SOɿK$OvM{ETqٯmʑL_R-,\fZ-
'){'mƘUt爃v~R-1h?(W%6L͵KX$4B[Sbq	SJ'y,qJv+>ӒHǹ FIȄZֆqZNq+=\#}A-zIBKip))iZN"Vjd}J	DEbE&)I;K`k ZoD0tweM2#TQaU?7+wr:0/={:ćWVwZg{C19;HA6Yh	/=x ؋hJ_Upu*2HZ!<{Oc|[?sBuG.g^$]ϤUWY!{[WCkh(Ҝd-Ľd"fh Ì!7d(JSFpv꜡pX|I*7v䍧%`"#V82Ġ8m<@A hLZFHfpPzT&8tS:&֐|\$k<|JzϝqVXF,2\:'Xν4$ wBHI9qn#u=
aI7ސ)^qIC,Bn炆QV}UEؒ1!Dk
D@Z]'.I%p7!zSKf;9#WWCh::J3s)-A
\#e{pU%YUYBX[su
7洓q1)MZR 1L̟rDje|<rՑYbKMn`/kX^bﰨ0P@<0 i*
NaOAS 0XE#8h/Zm@sa`,Lʺ+_pD#kH5֔=TP~BKJ
1	b9CBL򍁜nLA&v;!EdŦ 1r?˃ A4	|M́S5<Hb~j+OmSv?V)۟Fn :TC;4&F`U??-?٠tZBjkab8atbn粎9HA LAѠ"_A5KnmtRPw]U+YeHt@1/Vtݬʛțiɛ1!>Zd%YAV/~M7$	|Cߐ7$	|Cߐ77["+u*d|V: p:frG zrܭ&w䮝ܵ
OJk%嵒6ZE4$͢$$IÜd祻$k]3ˏc\'t8"-K5[^,8C&CR%&-f&3+)D zk|ܧ^Whϗ+ъ( C9鑅"H;Qk|(zNOS'$K>_gInG `GͿ3I-t!L*p@C*	 YU2eX
S!FT7W=Z. +𐂗d_C4h܆KYO
){6[^K+23þz!]^	d0qHӦ|!Β.X{ĥkO¥[A<+fQdF,oa4X0L`!|>HHze7UP泗@o^
2F+{닒C&knfsOT"hKQeҕt}F	I(KZ-u*- #U/ !B74e5$qrd9/@i<_42
{ JcOZd&,@2MH"̽YA_Ej4q 4Mè,x-R)PUZ@0z<aOA<X~7t2Wכzr#4C>2b~Fj}*jonB\5Bzl^^݈Dm{"+w̵ݩϼo}cؓ/'qE'ҕ3</h7~<jm]g{H=9gnώqLn{?R&P(}"Ƽ⠜Dg$xq7&$|qۀa5[`X:^D.e)Z5&=?vCuȍyW7k[-2Mގ$n|U]ZAG93%s?O䠏(8wÕFjFv{[ݥՕ~5X5p4ta0z2:x-1;Weh,'Q5ͧaajC'*#ji25M.4zV%^r5Ǟv}KE-&;雛-g4\_b/|-!T,朁d d`@]-owxFAecS4g7G(:Jӷq1U @ek2_<GV0r>Xl# ⬅_vyylVj,ɡO)'{!xχьmsVeҚ5h(/5S.XuBњGe0Z!$f;YNYo*
UaX+@Ϗ	7_/-b65TJ+lqbSy\\je-˚SoW1sn\_0Yn-uk*2K|I^LR\GW7WyNsYyhq OE͘2RVsB<`jv4=$%JBBsi9d6T#)sh'Yp 9N~rf4^>dw?R,mߍ&<E\}6mUkTB)Wa4*TQf-eʱc'Lc+g#5wU9K3[[R!D4GO'F;raurG`]qct4S;ɟl^*J2$y1F̲0:&ϱbI¬%x'q,EqYUy<\o
j$Pݏ/T>K:>S{#',tf}5r_?7oo_B\o
sL(:a.?{fΉr?̎!ѱFq||go/Ɏj4cn\m EYzj;>yYXZ!ccag:r)P`|bojov^nW5 =؅1݋Mp:~tH]X;U]L50M7n@ۅ"r`26@T xppQiC|;8Zepn !,&Bc9aЪ]+GU3;<V'3\Q>B pa' 9gͬkR3iء;	l  DO0f  5w`q0\0BQhНVA:acҎb0ς}%#y+F'c'ޡK5G^l#-|?[UyȁaXQݤ\b=/RrM8iq.k c|< "ǼtKăt+ecoKOgnHs)f`{79fN	,֮['oל^>ʉ'KG'9bLki+De=/SHmy &-SyjЊƾ/&k	/Snja`zMղ
$P^0b =
MIm02rN ][ɵ#{#TmJpq,U%ף~2G
D
j\ .:6tQk |\wr$*7\Zi_QR[j~G2գ
J%׵
jaS%2Xy&	lIm0#fT&wM9 >++lecXƾf]h?)){ ŵ{Lg&Yo7*Ƥ3=SG#oTZ\ؒ1r21 C)!V(qbt( 1a3kk<`U[i'q_L7۬P
FΖ9'$EA*}5ʇڔ4%CT͐<"f<2Mf/NyjFu=JfKUmr[A ):OtUEdePQK_6nRW(]^RxZWLʯT+8fT52FylYۦoR_,iJ:<;[՜n%њ.ɿ5#ߖlh7OJ^nNhùi. W]q4;p#I|qP!3OcHOoqK5Yc6␙)5;P22)UgA`gMHH",tR-UsRh:Κ$ka5[OqWD7vRg"+xx>Gxh:ZĂj>38+ldM7ta2)&wbfj 0"n8BE81Nyܤ0(ˋ‾1ل/s QNd&_XΎL.-ҦFoI"-8]DR.-|>E+I B_`|>3\YJ̖cD$S'kvi̶㮞)fjkz&q>PϨ9bOvi6e8i,j!dNA	]y'B ƹRj=Yן&dkئ\ Z@˺aOZgnEP-*Ya@&	EI!⤢R3 "i
m
e1K⭙=[	
~z7q+6ʹP]HYv$Iԇ$vu8`c|3pKsySYq>Ґd!p=K?.v7a½,D9ҙdb2II؍p,@e.@cRg>ԡecqJϵљ:&;G5vZ,<)B3c{a=+Pww,` E.?)By0l%{V+ȊILY1(_Q
W9a7?"]Qq<2[H/(XL48r{s$?ՏChz7p!c'nTKLpYDҩUJ\TwiEe|e*aK4^%-.A%+
ROW.
Q]R/y]..EW]jpR"x"mkhsv%sFR^8f,r+[%lǁEKMc?e,Š^3F&mC6ŝhT<.9+jPEc0l^xCNiM-ke0[󪅗Y[a4}*P"Y5F7cppͽt,qyFLGܷʫ,\[f~}Xzy&@CZ`R<"tbux*`$S!7ʹ:84OҔ:Eo\ci+$Suņd&4R"&Q{gb沲>:Ưf ss<vqbh5n'<QzuƙEV~/DwKtnֱ5"g^Uo+mly>c6}0s5H'l0Va3_TdMLӝ1_|9K{\O8HnxӞ"V感aBݾj^HY9fbZ4vVxsօkMua޺Mz7kq޸v)m1z2J
7bez"!yÑ P>!?l+v%_`26Y2֙eQp^|7ôIoke)Ur@GX5A'IfFC7Uv|V+/fn8.^Y[wzLRnu=\铑wxf^9[Z42J`(FB9GgxZ[Xڢq}#[a*M<G؄eũe;@iI:N9\Y;ŕc8ʃR|nPS'FԊ#:`rLQ4oa<;G3VYjgLwV \|m-}JtFYZSs5&E1Oγ+70A/R2~FSըH9<׿acJ3uZӖ{"+qX:yP?wrraxߘNQ[h[ūMJ&V޽	k9;vV	nP6߄zùe0wJ|O䠀\gAorh_1m;k'*.'˙ɃTtP%xګ<4f,<ӥ3ԸRƴ5CE#s)_\v\
G]iyR)YTT2 T5Atet0@״;iyv&m͖85ۘRoJ;ۡۤʛSb8A-$5{JUF>':RsFi6W	0|7>^|7 3}?@Y4YC98GzY)J∗r^6=:u<bvw90b<Gz93})iѣWnj< 6Gt
P&P>3|x\O9c^	=Ơ;2ڠx!R&7n BƴAndCiA(6v"r$sk\P/L7^~HQAώnagЪ꾁u0@%n`8e6sT}x(6=/47rD)544:ѧx̚?}îMNpO}
r7^ZYYk2K-V8d촁?۝+ۥQ]{-ߨYˏqJ=;UYMnЎM(GIkdmN(.F70SsBr(-ޚEd7My4,I#rK]#2U`{L9a|J.f&hB{v@Zn׊+1+㱬5}Gn֟'ɽx>ƒ\>L0賄Y(f?|n;P+_cX h<#s|9y;k#o|CqmoyS?o&%s$:0H|e=;wݺ6fWm')ٱo!$C`<LѦH+	`hM$+ޘ9.aYD/bI⠯E	 و6||!>O58	2U~GiBMjAV$_?Zהn[R
ow?bLs^Uy 	kHR\ &
$\sInZX<~^r$Zg&؟EТiL63w5mc] P쒦}^z֛7N0xEO
5h;UlK2.U0XgiyL~Z!٭oЯS"|p#	uhfopy`1t~| G/{HH]9&%:@=Myz1rNltPRI?"TTxGEg3347\S`Mͧ"Oy'(v&/kb	+C!65WÄssyn"7,W|Kza	^y/Yi](N鵗FT /<?l]	YD<{M}dv]UܰsF@Q"F$Cρ{hJݍU2E<T&E)A8M@$ٗbՖ:L⩶71"=\aLFCXx:g
-JUJEsk.&G%_$	c2xpEz;/(m5^%`E~3s̨XPFo`/L:QGrs71z[c4Kk9NSXw݀ɵѩX8kB.(5PuPr$%Ϋ〤Bhq䚷Vj51}Fa%oC!V_X!ZRJ<n"XrA)Xa0:20E-QاZ?NB74: d%&B5 &Z\> ۰^"NJV	p.	!=sGμUAc[r1ѩX-FxMKw
٥3˿N.vJ^,%]hɌkP,_;T>2[)xHLCrgP6P&.+AB4[AsP[ocZhHc'o e_!w>]O?#	_ZUͯ`yQa%\)u;EލZ>9	[-Cg0xsDϠr0ΰd$H**VSC4Il3HΑ/pO5GyIj2E1v6tMSIx.-X\8^?=]Ľx2KO-8@RGQWOѮ -)LJe$#t
`toA:Ͷ8؞</K_
&W 3$K+'V2sKy)khu M
i5W4-!ct@gaN`:;sIH_\x5#pm5Ayx#o<ǘcϑ*{>E/׽ϓ0 SaŹCI$91T.F[v3/P/>1zl @Aeŉ|ũq,;4Gmq=.	;E|$!7#ϩ:CЗ$4C$~0O}kR?8b7w!PV#NIج'ոdxZ3cGl?:$_6!4ګuA@m|~ڷ.skۯ1yvGfaQ=U~N>Ϝo5%f<$~
2=4QŜ'4ϟjAjh/#<%NQ?e9ټ3CSj#eJC_ib5aJ_$k3..2jKZ$lJ7)_;CO>\<w\j*$ 
J,-J߇D&x|V5Fg}>[i a f!LJy=gLj։6hF{39B#J?lzNF%B&c4=+_AiFCΛp"9@-%Y?+u'NSY-{_qHrml	b\Dm$a8d$¨T.4w=lms9J(Ld3&wTp?9wdYq!,-\-x@aJnAuR<l-5T{nWWŢuj_*Zs5C(Q88df)q[:,OW++ p8oR)ӣe,,y@ {ֽ02]+Ȩy&wmGӬ3e4ՖF-	NG8e[0}A\:ƴaz.G:W^=Hq<$Sf=7Do&]o+TbӠQ*ʟ71Gv1ppfBRd ދ"X՛vYtC~
aEyw)n/g^Gvs!SHXs(±(ci#̹(t8Bfȍ;$[("Xiޯ<ؑ7GN0c^쾨:oK`)*R;! r߹8^tK ,nwcOȧ_ӝ2
HI%_?_jdVCt~;\|S;vY -6A]$bzHR,"V;9;ߢ-Aӭ!~2!ˌ 5ChLܾܡ F6E~,2>9t&{pf?2	E#d;?~!!2͝'nCn\2%a
m$Eٍ)	, Sv:kF&sCQִ,dd9XL4>Xi]e.uNC;"rVꧮ3Ojt؟q'0)~@	JQ+SϚ?zidP.e9_g8fP"W#9:/(o]Ĳ#Oaͱ~6i70WSBUE\'70󢅣wvEF2]]FŚngY묭FntJ@9!O}(HɎKH~'R}pu\;k|31ovn\k]\OZN[?~^m@?ƭAPr;J嫯1aC/ryD_ǥCZTJ
*Xԑ; CE0`y#aE;+N#k,//B;u\7?7dFH+6Kgz3tU	ΑZ݆ ϽK' qݦZ+b'm?w. 'Z`THI;U-L$rIјs^+>np_ j嗩^H	IW;/Ť(iuCêʪjQ_F:uű`gfe%'Sb=!4`KNAf[F@t$"ʧi;zRɔy
%wFZ\>x:dFg.ϠX4>;^\ܚ:xyY^V_x3t {[ۏ݊RN:`)Ͼ"rL`dbAi	|lpf]<DN|"RNjnL;ev17WR,v?Ņ
¨c,$?ݞP^^h6j|R&>
ERп=n_DX+g8e8ɩcvTթ#7~W8<tQ^;H
 I^eg2~!Mf1|H}WyDo/SX'a0l"3K}ɘTy=䇭+½V;򚤠u&vعNxq8{z{2O1	":畻y_&x1ld0[Vu*=Vmj"QPLBET#IC\|N{a0x-%[,vAqZaZbjQ$(|ooK9B)4̓AWM}n',8c7Vt7Wq7W׆RהrʁvpǠ܋鳕f~ΫYMv',[Qr,""eԊ3?6w	W\kZhͶCt?B[{fRNDM6+٦"?skvfNfW׺~1>eL/6loomسVuMLq.&g7c\@7%!'Oh9l
WR/byTɗa@1;*	..[&X^B{/ϼrCp=̧mEw'c3oQ2i?{S	V;IC1˭{{ۯ~|r_OJWOXS<i/(	2܂O	{_ɧI[ϻ?_˾"2dyPT$IzjRl>li7m?wFZLfyZ˟6[5SF 3k;|sJBO3	J7X#ON,$s
+{=KLѳYea
K}gR+v00'k&+le?'0㟟kxu<+zȏFN(\Pξ~(MZtBA\XMAyѻ{a{y:K?FrcFX_#3-`xI. 3R3g7))3uqwmn~|>7|,fu0<ZD/
܏s.Q=Qw"$lv
/G"YE|oᑲ:xQWC/Z (˜4dK2g:Zc90DGVwee{SEm9r 9wFKiLO@8klu{\8X5"ӜQS[$(mG؁Yf6*gVr>-\3贳5'7غ~'VjT.ԎFD7Ԏ>$r?txYkmw]\e_vk^u\j4dŊRCl!%*Trq֚G4NF"}2SF|Q=hQ[$,j,mwŕtچ*[co2_V%|VO{^3<$/>dp_cM#`[=y3 Gfut-׆V&Vÿ3VPv*i1B\*uO;t5.:Wiw[z7?n3'ү~i޸)'c7vW߾ynWŧ؋G4Hړ:dDүy9
]U(AWϽa|(yZ7gdEp~/hFУJY)R8hTvFO#hd܎Bgc//Ꮱ̏m;/dc:

;
7qӠ?kN>c#J	H=({4XgF;r1ħL	[fzx0|c8wǐ<
8^jj{ké띜Ʀ/$>zfmo6:db}1G+UE=:;yq<zu{nQP'lL̐>dUm(b.N`J;F׭vte@PFwu0!70U_/*`}q9h46VFZJ :[]mcg=n-{N7[(	tVYmQIkJNfs5Ui&[Uޘյۃ7]HȔSĖZs{i@	~lotJhv˩\;)XI8l6Z9d8dZˏK908vdb0ܑI}S&ކγg*{ʊ=mhF&~.8U(ee;Aw9.=wzA*ŨĥEL	h{OA&;GNrgYCg25i Ll9:XJsG䞈Z:@틯+̝yYq0P(k&EnP(8	zl!TF;7i5fuK)*((҃5~Dq+tzN8g2"4KD1A\1	z]2٧aQ#k,Yk7yP^i`\/<LFIc:f/fGD"FHɑ؟b!36Qd1hđp|Ui_))(^¤]bx@*fUY-;Oi}S{UU2/niӶڝƪ\u6vkf<Ya7Z/2i0YUWj]Zu{9e[X^һ5{.QT`)"_D) )sxӶUٴk?*M ж;Ψٱ;5uͶfvY]\oXkZcUܷ6n-jmݵ5a6֭vlYT2xZmDiـŷ :[UmQ_P9 ҵvk^X!N	4ޱmi[aucs F͠k۫dj)T/5 Aa}lZFm_kmp/8 "|YZh5Z͍h:2h[m(
TB[нX@րrOijJz蠟u@?vEnLc;R~[Z:ԭ6#V!/*-h40ђOF>WU"q{ӁFo`Qmc絍&Rw4W%m7Z&kHDoеbn@Զ@з.,.mRHt4ӸU0_0Z?^\wӦ;hO§OH`:6*0/4yEI)wǭz0U_FAuh.hW~]?N

zɿ.f_
yƿW-9&I$fEMk~UKׂ́}ϧOh@d8A0)d{.UlH\M΅fPGDK\^]k_޶.6wr}zȉN+GaVC[Uj5=2A+JUSj<\YjԮk'P]+A[)Iyl#W5oAPW|Xlƾyv~S`vNa_!W<]7/	p%x#"}|8/EUea \ᔗJׯt^TNK3!alI:	,lX1(xg!@/AdLޫ,zF;aKy3;WMO\J)_Ґ47co4D!Fb@wl9qyNB@R~cHɻ_UwNhɫjR7CȣKIGD4o_W*'LcSAI|O2>ʒnzlPŊ/|݃w=~zMHC5ec;%pt(C~nBKMQ9d,32SFs?p0|*+
IiH6MA8(X/aG,̻Hiy	S&)PhI\}I)wieJZM\80hf_	:Bd_!7mYS'IN24vf>ilVktqxY0#q[	>F30,_}SoU|\J
3ea]+
1(P)DTk*5J'	'ryp)$a%Re>Teꋋ";,}@z96҆;2BUX [+t$p U%&)5SƝ"V9y6R;Z_(Ϝ7tb(kx{7SRSACwQ D o}@ѩw}W1]]ZgXbu[8l{gqF##=a |ex{2)r?MebCl^":N
)(H7%\K2sb2,3@/h]ZQZeJXb ^B/d^H@+.{JӘŞ[|Jx3Kw#]	4AyXUȬ!ZT2"
T.**.k++IяՔl|<i'[RP'寣Y2jhg4E@
@5:+R|NAw=~9?ڒo$b$1
ǆdg_b铫A2I\*S-}J؝V$2ٓ\uy)/9dj_666͟Ǫ^JߙYNPfj^,{eS֨4*N #5ӓ;J|%v0:a\d`l(:f&+\R
F5>(U1Ѿ	6U/S/CYCrjͮw[ c}2~"'}c;Ft ڋ^UrŪW. yJq`Ct?)]oFnPIF<o肝U~h:DlCpcʞSMEBr7r,
G3C@@	|D"LQ:o9@Dy|	)i#L@8Qۆcaֱ3pٹќ)JIs";IM2(%gB<}ḿ,)鋠mXM7w:mRvF΢øprf	:jDAHYX#dWretv‛;Cmr}aefX(8f֮fkހe3޼YqVS$h̋3BЮv]`4m& ,0IG3=Go

7jZSԨ*h &#ogW(J%}$#V"7A~@hd}ۃQliP,0%\%,f%gCQD	$JzRQ
ժ&2B3^\Db;<'J$b0Kb/0.&:̜EN5b_1_٧dW2jM9i6zPx5cj-b-}ρ_'bLae]iTy@0|RM}T?}ЈW UOE򭟵ݏyyh*hx1W&p8H唭ja1devz\0{$`7fD\"ÓcLfxl`
6 Y⦙	Y^$!BiX3x')Y	"BwB7Dappq?ps(>0_aŁW`,!`Hgrʭf>tRVG_[ %>}gyĮM&S<C
tUd9W/ I(L2M0xuSaucluVAO1?<YsFW ^km0q}(,ǍZUL"Hf-&|;dq9)!H@ZnܩC8:kv~B_Y
_ＩoB٦Y-O3"},;b-3nqp!&TthǣxΟFuZf/V}0qEj%j-&F7Iݒ|Rz/c%4h|"5'zno\2a/eY/BbLzKxB|YphC*wb ?[Xw:EOԁL}㈠7ԏq7Ō/"=hO3(s[,&Eąބ¹E<ZYsF	n&Y2	5Ƌ|6":̂@z9\Hp(`5Ȁ{q>0(n}#C@p26IHN-4!<˘ ѧL74:zk,h4DrkTerKV*MCgvyV`:8U*	y_g99#GS	H#X=Cq-CNf**ފq<rT? 1ݷr`mV+-?A\<`?SvRe#IBXhٞ+{ߖ,%stvԦfo	̣^׿-ԴJ0lLdXUsV+t"Ǎ?~mi l?
S?Px,j?&6K+UzU'E'5;\e&yN`3|HPǤJ|gCG zq!0M}v3%hrsm+)Y` 4ᘪ!_7)K=ljdtz`4~mE}dPB#!X4%l>w$歈R*L;ċ sO@ndպ"~i$[m%ڄ4qS3|	FM%w黬21VV<~7dARQ>[3vHQɦS:rk:分H4,tjzLD#eS0o`o<%1#j.(Bz0qd"bމ'w2с3TSMT=R[E0mr6v6qjU6p=fW⋉5y5KĠDKSMd(ihy}𑸝NÌ g'd2q8M˚,hPeĹ?[_~^k7?5?WY7 ux\U?ơQoNyN[T?g|XÕTFQTċa-e%#$ul"<E{;tJ$"	2gzAi-˙xg0C}GŢ*+Gd+/c7ǎd²):6pheP'_I٘K )w98T܋4s)!zd 	f=-NYĘ$T1y:-l솹C|LQmoyy?KfmP>`iD2JQ&At;kblu%TɴEm:YmuFAHR88FᤔKBT4Me`-:ܔ(N,&Ejym!c'҅W0s0@34zZuNw!G^>k5:I >37u=2$G?T<2'҄dCFWwL+!aLnU^D~v|iίW̆n㿻U"_kvV]\N:$Ry!|TEo
2I;GqZKc\/SpRQj1RQ7N"VZʒiln)O{JG
6LL a@r$o	Vւi 5mDD1V/:ZBwËW?.UP/wns8+57yP^͍ʅ|>! RSWsZ.48qzGS4~i;kW:$$O`}7ݥN:bǕqLGnMM* >=^ޙ{k߲ dXi%P3e kQ)ڞbٜQ<fxU4^+xJ7fRР+_z"=d-~
{MiFN\gcKJw@$ퟸɒLD:/*Djx
sh,j#$O7
0|o߮ |K^=w2zCċZ[;XcHɩv	 g^m93j@I>{|؋@N$ 7{o5po9@{/X:<v5!ׄ1~5n
9a7Q1Q0~._o!J#bjdF\|E-xŜ% Ds-zGsт"A| ,<D_e)bA9E7@~%q ;qspHI9I|e[g܁[cj4?5T0Ugc\'jL͑ s`iFu_] P 