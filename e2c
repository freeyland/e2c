#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 0] vH(iZmSRIrv֒{׶Y	Ih  %,uy9u50|MDDf@I /ޫ×Mjubng"ZծZVŪZ4b'PNB^cA>vr2яwl(|IqVj`F~"G7b$0֚^ߏ]$c7Z{'70o. 9_P~"^~eh`~\k;I|{kn6'=5A~9w>׆>}D?$=~4t_ݏ$mŧI]7M[ۭvfkNCw.1J.?fXuƽJFH!sKgnx	;uOG,rs7IY|Ey~ccw\kׇJ`.4%?xKr{/N2%٩/Y5,C2ouvn 3wFH" ZNg{ot6><sЀ'Qx`vFTh.c$*T([V_]Zk`8X`FZUo4k8AavYJO}FKK4Ǉ%6rtXisZ'6 ^ާoTml`F#DȎoޚ_=7 3ȼMbxX[ٽ0.\QCuޗpRFp.n[UhHϱ--y'07+[=Π|l,`JGF}i6<5>WV;1,K\,:ƃ>߸8W.P!Q'/foihB;Eg]\Αl;]/RӮbNʴu(Ӷoo6ooĎl $EUUAmQS5uNԩ:Tw{l kdAU6U٘2h|@Xm*Mv(̍0>j}I$bq7_.-{Ȁ>`	+-+9+ꉶ%]?`n-c=T`?H0ϔ6{^<?԰=wy7n
Ipu%d]s4T$Uf|<rP$r]yv`c
W5?&I%ewЍG(Ƭv+	q0\{kܘ]ݭow_]a3yU,k{GoV*a䧝QgCHi1y˽ׇýWovժiͫov?Soa=+-CAitaˇ&ICTftocw-F¸,1<-؋u@^y>E rmѽt4_Iܯy=#6NZ_ONx1%GЎDSك5_E~<Hl!nq	T6Y8]S^N0agN+߫%9U:WP]G-*m`|e_W|XnYR6>/]V2=ˏq/\^)gqgbɍ&nQuй̠
ޏ]XYσ;pIw+ОlGJ2Sx]tZT cj$m4Skp9YQE)$$K
:~(kS~,f{IHN-[$;Fb*Bttq.gv?w5`5&>tNA	p[_
.I<MzATlԝApZ`U\݌̪A= V.uQ%H^Oŝ7^w_oڽcA%9'hhDJ%ߚ7M2eRi>th`WX%HLt`Iѧ;8L$0GlN|lh<B	ݲ_JJq8ֺAtl""IeQ|lucY̾a-UV.'j |-}@lһK_c
iՂY3!͘kx!D.qڌp(J8鋡IW[?FHu0Sd=}V&ק*^UǷʹ¯sv/*w^TP
UGUyk*UyFAUߜ-RռSQ϶~՟&TFN/#Po%Gj\!FjޔbIxIԩ	2_"
mxP[<P,n>= mt6*1ds ֺ!+rvm0:EF,CmG ό]|끃UP_pgJ"G?#tC-H	#8f.e3?uv)c
kRl>eܖu +ɝU4}é&Q5[}PY5/ĒeA\ߒ[_OQqY\;Eї,KouH9$uvKBUTBg[rftwiv [ln}u3\x8!A!OzQKZ|SY3UKÑ
˲߈T|+LTekŗ#7Z*Y~az:fZȤrb޹~0J֞+G}(T2rt)Лϻ^n^`vzD\Uvv_><ãGofӔҲv 6Sui(ˌH^a7lɵ4<=I0b)ߴ	M8p+."UXlV*X)?mPkKG;P9$)Jێvmc@c
̛hAɮV*uNPł(8HZBVlٌ&paʼVd*o^ͫo6`hGcӄ#;߳dPJ$a;tXxi5?a
($UԂ@5)t|!Ѻ	2zsb,ǟ-M`/:+t{9e~^g}?3IL[gM,J[v>KЧ1Kk:,N[芭YDno%wR{QwZh[-aB_/"$|
3k8|d{I;i
I+*&cfT"?ν8jx/J/q:K&CW#IZq.njZgh<wJI}C/W%GZ0`eSᱏ`PX:a,>BN\\^
f6ǜ+% Nΐ>|KJ.tZci;SiYҲqC,:y=TI1wE$q3>85Jr
55 2Z
,_	_	_	^؝	LǝZq4hUeCLL8HG2J2zD1Z^1&Њ6PuP n%6ghF2۴$ԶD[hi
nRͮ5SjS;Жd.;*n&?e,*簾ZݕB	^~eifp{~,.qiIw~-M[~ǔݹBb(h{TA;ri[,me_8i~7ɰ:e^"a_+OvB3XlUXH+P6FW+2ZWCj(]GfSI.o;BL W+8/n O"۞knQ kEEݟ"kHj0g\o@XIb.-ἑ%usv`vQ%,ҿFF9~׃L"m/uKʘLl7쵍G%qA$xU$ \&!~FT/. ב#ޯG˟벁K#'28f@𯜊U)(Ey椰f"e+s5/Ab|*`\iQ\*fɍC[<eZC
[*gNTdV$W*8nDQU*+Vj{Irs1jn4:/S
8Ԑf4Kб8ff[>Sw4H}gꖴo]l$S;9No#cyB?me9?iXOW%-9BQzbպ|i]jWT|*nޠYh|v{zw{p)92HFU~=0( f`@> :*?X,6>64㑭^!>!''Wd>WDZ>vh6hҳCvdqSEAT7}o^( Tx'OV2fA(BRYLvIMw/0'+e\Seߦل%.L]	,6n&yBǮb.n%Gʓ@Nt:i`I@eB@`yH?	`_ҕcb5r 7`Ȱ0rM^PȲS_BBwĮY$yGe,ӸMٙ͆dFUsҎdҔ1t.SXcXu#FH&]D B;6Ub)bP06&XBmcsJxERͿ>C\"^qf&eҩ)?Ѕ}Ή}NXϛ%YRs4Zd4byL#ΡT?q8tyCED8w#;T=)*-\k۷+#oc@i|ĹЩp$UE6{~bV-~f#7P38[1FI;hXJҥlQF$t7~ߟH"i-Vg0<KFd"ДUTi)=L/˲vIQ)#PgYzKre5dX)/JpeAgͲ~%cSl	0-NJK&SO.2J
Pׁ*cFt8y6G)=Zl|lԆeN1
DJ!/@4lp,^nͅ'y8l3*H:B?PzB*.%S~RfsC~X00ĂQDlU3a\13Bj<%}mڭ mHy$3]8賄%scIyhΓ00ЪZZ_`0k)5/y~
Jq@~LIn+ZO5dwK%2%&.5=@($#$ZIVIiL#TP3$ʐb,B$
4L7J*:,l펶?@ \VDEJ>,`7I[Gl `a-Ʒg#`,Kx|nRㄿh~X^uL^R4|h	fCRO,boUׯ2)HnXVwYY=';!=oWU|{?4MoX݃m)bJs!ޒypH&8o!#8(KuFG39ǀ$$I
o|o7BD8'}T4Ee=OP^݈PB+]NbnpU MIzEQF=Q^$#EX]	)㘝7NV('y"NZVHZGcAVH{'$I	+KW k8F靐U=9WW)ChZԉK>aC	$4/x("ƺ%"u'ƬiY4zXȜ[[)NP_}lN$"?
+D??14TzhP<hp˃(0%dKnHԼB%l c?R&W*H 9fPPA	A('a&Ѐ3"GX|b o!_Dg9Fn@&s>6((Q`JX'Q)l9_IWJ"k'\=#3v
hN>#kZQ	
e~5[X$
smʦ~M5|4cD'+F5mMu$?5
F(tZ٢C.?֠Ry
#ѣU)XUʷFlbQd>fUj!b5D`,C-eoZ"Ж%mp[2VrK.nՍHjŨїҒ_KC~/5\x-[6d@R4^W%U	|U_W%U	|U_5_WmيlD!-'Cv@Ij7$A0ɷZ|k&ɷzaII}z҇zRAZVd ˚|O}diݑ:C%Wbk[0B'O2$eYbhWsLR&4"s=*kr=p觼;F>h)Fݢ.6QJݜاNpK'd~f&VW5^4Q0OuX^,YНw%3&^wYVkRIldgJʔiILmTP%ޘ_uj {&6\$U]z2&s42;SS&XQ2ZQJMEH)!L@9&#zI|a:-kUG݁qo%˽-bCS3L<a垦&eQig*2|a2,3Wg7~Z`O"Mi4CSyn傈W%W'"\)ܓ-Jb,QgwJʉ-Wۛ\e~߈p3{FC;+nE)}6$lN_7"m{Oh1`T)9ѻݲ$rOne4$Au#zH#$ކ<4UH#'j0xYsyyh$rOnD9==aPD!ǛG6aTN_<	- =mlP7 l[-:S-=ӑ{FVf8 	LhJ/B
ړ[c)DoPpqn0*/<+ó[r,zO$J;B+(ߝַV3$h^DNqgfS.:4}6'|gcaüuF􏵑Fyή:cԼs2q}?>92o|S#%Ei-qJ2qnǊ݄CWjh]`u[{aX;^DN1;&=?vCyb hVO+]7Z4`d1.O1Ŋ%[4Lőe=$IU"O&bG|I8n\-_@zrMMtM|kQk>#h n0z::x-;Ueh'Q5ͦaަLƵy2|4ƣ4i:w{;ך+u<?;aaC'4oUXo0۸[2Ĥ`&kE=h@Q)M$MCX˚aJu-
	95T)HsAMN}O"}R\WMu@1dZ^ -(QI_Ah)G1;Y͚%9+<#a4cU\֘4̀|R&P2`?gwAe>[[ytYݬ	Dُo5Im^R(ڔ*3zR'̓S6MӍzݴiJEgd^7Ar.fUݜ:=ץM~Cw,g"̩V\Ɛe<@\c9Myњ,o )SK/<6?Jy4hs>Y K=f_Fi۵y$Ԇmn _tvi2S7QNF5S-`ޠI-!2_<ⷅ
V~KlJv
5أDk O
|:3j9Vz(v7hT(	+LbVv4p<2	رR=:m#B&g&)z7ƲLq A.tc
sI}dy6o|\.;%E("rNJȖKcX.inZÌ\CMNWtl3Y"+1q|Vlڗ1^x$A+-`BWʲD|̮438F`ft @`ey8f$FWly!<	|7o%'lAcړu/ߗ~mHLhq{;:{@#lww:U$$Hnø,lx}qrJ4ۇ~~cs_ǩߤ}r̜ז~m_[}vYBlYayT0RAt&* \ȩv}'Y
N%!^dmf,X"LnBOX0"ÝL+*%*g42n7ZTRoʉb?A^]I*^tݝívJHԻ#'.+vKf<ZHÊ0dqQ&?qypH'GciVH# I2CiOr0͝}_ 0cV7[/撽K%? v|ýWuA;6.B/vNwvF5$8oDD91+@TNUganfnAL.oiHvlZ9xtqǸ_M1 t	ׇ<]aPgYknkJxfZ9aWw-8IFxywp'Q_<tL [7#g`,,/#,J^|;3EQ$P
ɟh?\$u.vl,xnn
NQzvNz"&`AP!- Dsw`aП34
9&Vgad]2ƦGrZ
)}0=ѼR<HK6_<a}6J:p~6O!ZN$F!zgxkcMhVTezt!Oe(gvtKfăzNl }E l=j7ثnҭwl2~z|wv~hi ăOn}{1K4&ɬZCye@aSͬ6uHZ<9fܼlr	n%
7m̼@Ưd_,+F`K0YH-ibiu"`{~d6 ns<p>Q%P
b's΄hR]۞)`m%RH"̯5Hzs;bd$*1;t/\V2PJYqK}wV1j9cT1nPԋ1y\.ifvnqxH~P|#qŨdRpp}ť\UǬVf߰d)}ZS^,/kIdS7McNUf	h׽ZnUpp޲D, ,-%7g1zf<j'̴\6^ͨ!%Ee,lS/0V3IW@	 }UBp\'y2Γ7ڋnkl-e8聉d\HV^*,ƣ'
ų+c&ʃ)f/䨀E0<k@OV2xl^pS2#\2hlǈvS䁱v_yK2(5vn88.srr.Օexy_s0lL7YE	3_v;(cn,@B҄"Z*^8/MD
jlW>exvrgb3yXgcZL,zip%Pe{' $}{	H19Ft4T=vnSNaa7:`Heyezy'rBe]8 }ZMaO0T&~UM2iA4grs>e.nj#d9M&`)c33N)TϞٍv2ءV	GBzA[7{ֲs#Xƛ3gQ+]$[ug4 %' =imZQT蓘=kpt757lKj&xlEe}Ҳg{-32Ø"AlTqRwK
L t\70e5K։=n%J
!jL!$3A:q2H\gI:Lm'*>TJdVJO|]Lֹ}݄]?f`1Rrzu&Q#$aC7:=ɏI%ԥVl/sňH-JL] ڔ
#b/)rZ8)huOy dfO^+D~5anS-+\PthvxWjʸjM#J
1<![Y]^M$T* Gr]0}%EW0*vGDW><zS=^HDJcW)<x:"mfk.h)Mj/I}Z3*խ@V4xrBOjU;Gt<W+R瘚榦	JIߚOp@1Mv>zhU\eۂA0YFIH)@/M\dyJ'<>KEo'urYXxLψe*gi/MҪ4Q\P_g[0[Q2qDvʢJ(%ҠXg,TSկ:c]ؑf6-|Wl[2_!Wid7NBt2O/&ijyH,og"k:NB䱺H̪q[cxTw/%XrsJ56)$j:kY.?GI8[ɯܧôwxi߅Y+3/ )B~[strQ-ZJcC<~ݹȍצذn-lts-ֆze\7/eY,Ri=՛).eL+VO 6>O5\ژLY`SU59PQTb#$)Rn'm$em#WI65)36>;+ˎЭ=5p&z-N.혜?:9-:N۹9&Out2(1o^ZzW9߲NA6pA͈y^[٢sfH2C\ggW0l8RF#FcG" 9Bv~UL WrRd\o(h4KE=SjF'`tl0$C;	2Rw4qf-CUO	 F\w!&?k%TII|҆f-K`'?'IICeQwy}
%o6pO·D4BHHkC9FjO"G&kl%&cϟk_^cݝ~@F^+rXJ"aۭT2|̱q-r
[*k{H=nDMelAג+b%؏*Q>4+UfeS|$k(Аlfnбs
=TuIPk꽅 }.$vH .[,9m-E*D1Q=R|LԙUKV'%Sv9;{RHťAyd;^ s^Ju-ЖY0ot3f.NH&v'dX*4f:1|l!?Xɍk)zQZT6Ư
K: .xɥ
]2P ׾ˢA:<f~L%E$~g8^4Y/'gM˒䣸/$hhgCs.Qe4֭n|Vţ/lI4[]fibc˙$Ҽ[e.p'Q\3H}h#{%x{G>^i4<FQS.֦WgߖarOOPAw.)D>{%,fNJU󎇿 p%W]k Q]L)~p̊:qp1̽6L{86fq@Mi^b:蠃+=.22opp5/Zؔ7[-?f 킘vV巶
gz4s6K
Z&_k-gh{E9Ap dKͧ/bf>BUu7PM

/#[̈i2p%(V@,k]9!zb~(5EyG\I%'zoWWjR)Q6|溓pUyĉj֔kyU\3S/符,E%VVm4G[Dʥb0o#/ۇ%m^e\I9J'~O#`4¦kwsT*'#r{D!Q-:}/qFA?n+Vffwb"t/BL,qx"&xVhqb߬[ʣY`7XF+䇼xC/Sw.$iQ[ctn,WȻ8?edO%#NaN}"nCW4?E#O?ջCKvww
 li\,L_jO/ [0OG\Se+@fԖjO&o;?LG)&Y.\hԦƢoȷ7s'vX>99+㗲8Q@6/5_bD~}]%2oL
G5,?}4#WO5ޠ+CoVjsqz-+- GI}ņ9VkdI!Fb/$T|#R'83I 
M?E=NI3]r,/<txc[jBq李y7;Y߸tJ#xm.O1*i6ّbC1ί6/ɛoY*ɚ6Ђ~CgH1t惇ITG_6;q@xJ{D$ 14Ȁ,񥰭DW} B1XЃsj3׆?Wxl#BE-9]tyN5s]Hӣɛ0T{.ԟPT8/;9aIup8#Cb%`Ddg0+tnMVKd_F&#Ӡ`NfA)A4qR\Ggsہہ_*SO^v`D{ʂKkǨKyàƏ?1j*nYi#t~R"$1tߡ+7vI&ȰG7QR,-5acdNS"v[4͋ڞ+@_6uC[MaI/)=UVvn4Ak_44ľAbqT,Ћ+>'y+1!l	_Ҽ"e;+ØYkL`n0M
~3shFB͒\<Sn1UFYoA蟈5݆hr9oAk73)qdЅ\Pj$[8&HjUY*Ѭuo01sFw5P|ED%FL7S_^PSM^fCэ$Yq(u b(мͮ)䂢N5%|]	<W6Ǻn߳	pMPVjkNs֦uY$w'&:sҼk28r ]9ȹ*ki+_օ̼60
<EnJ(3gQje4tO1~w
)"ai^]mo~
^Rz~K_A=zʌ户>+ほs0X.X9 J<*0&~d]^bwϢkN^^9kǴ|*Q#*y32*Gӟ}c[t?*VYRD4>N93HLΑ/p"OGyɐj
2U1۞vĪ6lZ5S;QzkCNHRĽx2ѡO-~16q쁤57?#G82*O"褠S sҁmȇ|Y`rEsbh9>yES!;m᎞X%sdlH,>vLsGx:xk?OgwnO&(co@=R8yK3wϿ瞏}.+}(F 'i+8_qyHU-fvs/>s*S/>Jj @E?
<;S ԥi*{.i:}v ,"='ެ	;vǈE|$"ϩuPң7Iqt
GIʃ`z=ztF/NCu}`~fZ;:@/ոdr3ȱNuQzM R*cIgP+;G+&oi,,JߛV:b'xn(h3@W.tLGT1ǚ>D:8h!~I7Nl:ЕjڈGx.Pꃃts<<s_%XiWx|o	ڊL?5yJ_yGٝ:
4	
<Q.h&!E-n3L\MրZ$HWiωiA^s/h:;MoCrD{Qɨ|Aaʛ.3}y;l˘ET2ߜCwL9;rNjٓ<UMjCçVu7O@}2bVBLsE+Lz̔-A<Wbb"`ѷn#T
57#Cg|j
iv5[ 'ǉRrm-5lP{nuTWŪuZ_Z5؆0]B	90.y?֧kM<5}i_qt7d8+,x`=_?0\+ȨY&womN7e|ZԊbO=!d6o1<${Mi0A`m'ȍyu';Y㝬*:zehl#fAI6 "1{ȟ&Km1TIĦA%/1:܇ovl2rGv	ppfBOR iދ"ؙUjuYC~	aEy՞w:
)<sCcw{/)rH(,%G%LXԱmYZ0aFa{`{H,|WO.c؍/\Wz[M#x/YW/_T7`9XOHdo`[ n!oTȗ_L/	HGeo~_XjdvCt};<-4<}rsRnu[,Hq2EKb^VɅL;;93rߢmAӓ!}2<ιz&FhvhQ/y@'~[v()	^D3.UzdE}uF{p֧>,1<"r?4?}%cxo@N_	Ak|7>kTobDtG&靕9{S~V@DuTu/-`gHYd	l˳)ǣqЭҊAIy֞&ĸr'S䫿pգʙ3#."/B}/P q(_AŅwqdP)͉eO?dвz"׈:"9:/QnCĺzOaɱ\)jo`5.ܯqNnZ}5Z_6Zݦj?EbF]mڭjUkZXk IшcA>vr2яwz17͵s}?w~|?[fQ.Rn{`hI/>f%|ݮի`ՅA0!{	ڣ}/ysؗHǼ$TwRcG`a.4|?MNÊ06V'bPz(Q;X)_]*p۶#|iZ~xxH>9{Pgxݖު
8d
.W-"vJRgOlfiYhpmc&Q
mKˊR`/L`KrJNnҲƗ5ZKꀎǤjWTá;1hi|\gdq,KwXV'gSb;)4Kn>CkvJ ]M=Ed<;Ap@D]`s?wq,g-]8^\ܛ:xuwj{9u8Zz8"geBPAow|woDDHa,(b<"7σ.3]:BNun~"/Nk_8^/o3|e +程ic_k7YvE%&&? &g&9H|An
-y/L3X0^QH
Fd=^39̮ߜ
UqPolV*jʨ<&%X٤Ko.	3eQF&J+]G}M}W^;՟Ч>L=@zSA܋0)GIV`gn_:G6sR6["G't8ecD'+t.jV4__kVU[jEK԰[%H}t)Twj!Kwi R5>>Ui}xkC2~r[E^SG}w*l
̈@dϱBtiE3£c&ؤ(~O}OS?j?kkVڪH_cipI)lN6x|=k^7{9p>zm_7][@I>wu	''_axN{]#u;򻅦J7'1i&xDj{2Syf|`}zj6[0ƽw'i|@+:#Cȗ12- v_nmnoiuOQ!L@8CN$J
(t1QE*C3_ݧfbۘv]m;I}uiIy8g?8e_"cw;y;txp݃}h5?/kFׇ
w_oyw<<{/o^v/kp~:K
AkU7<iW_m77GC&Ww[/(]O5\ݝý7$wPvOmgͮ+evԪv:~PAeWFsZ~՟:j~"QU*OT|Yywi%+F(W4i|ZnF?S@HJ&Ä--3I7*oM]9ʿݴA|=[(lpB[o_muh
*?/La?Mo^N?7㟝+xu2*65)tI	pspk{ p~=z=bm\",-Wȓ
^2[<IH&ʳ`dəYps/$!#еnw{?tk_=g|C,>"ڡzZ&q]\v?[\ZeT&zO/r:?y(.GTdFH
Iai`ި=)wtf\"BGZRFNr7i'F[Y?wqO(sF?jncDOҗNJߧ%}I?_VھIߵU0/-njP;&kBj/vS{[,תkYhH9Ԭ;z5ˆ}8ߴ6CǇȢTrq^"'a{>Y(]z>^Λ3!Ui5[0UlIJ_z/DۘvոwrҋqxD>wJL)w+~(.7Xd-@	nZdir"f(h3B\*;}u}plc᭏o$={f𧷻G3 A?\|	N9MgC7vKUy,Y?Q
"=I uJ^?>]<-7#g`EpNFУJ])l;>~%<*Z aOǃPtg%;a@ػ0;t_b:
;tY'\naOy&G	]`I6y`Hϙluc
jqQܾr@8`{c3aD_G/\,6Aa03{lfq8X-L*OoW?ꬠ?
2Gai330$OV0T07ՕoP(\voziz+DϏk`All`1}m*_)`}8
UTmVa	dXgvצo8iFcm뭓FZVGIfVN5M:I5j*09*kozw6|[	z&!_[Q5PCD>u͉U4ڭThUlAХ
jB!S |+RNL'MF;;(y10]u1b&ëI՞X4tsYNdw_7=n?ǥgYF@1:*lL^[ߝ^cceC'+43|pnfXP\?Mw#Z}rOE=HJNSE8	pL&EoQ 8{l%TG#7W_'RT08K0:Bŭ{czF ^<=@Ӵ: B\](I(Zǰ)>#,O5G
Y+dabX}χf*fȍd$$iLGԖH8!))9R~V
,=CX}D\R*?s;_%v'C%5%XKB?P|<cVKB,˝6S.pJ"uu=w7rh\l|)j4mؚYٰF^k-N3^۰Ə?UI|TWsPL7%V)UVo'FXe''=[[A?
ЕUYqϢhnf7ZMjvcmGQ@5f95fk͂6ZZn7غݪ:d5ۀY)F1 h65{-#Un[uPUoѲk5aV
[ԔnL5YJjW&լۀq(§ :[_m*X#j1AB(5mHBj6gc'A7֛VaW^7V_9(Qk0y
e)](evB9=ʫɏv訍Yj66H:^H ws͂Fj[ul[hU`kTVG4E/0@Vzaj𲉿6 KF]MzAkW	F7d0lpVXx64޶q,`P_Yn <W⡀[66WڀM$no4Љ:M
'~:z^ۨ!u7^GlحlZǏ5&z]vm[	

c@k	;1	1SW7_00NgjDUYMQggy>ܰ\֔Y~()k#Qk79@I1:i<p-YpZP+vz5}RP^7?g1J'a>;.j^Sh?Q`kj-8l`넫ryu`t)d%{!5llk\ Ǒe:PuD?Ǟ&S_Z~sc':[Z 
yE{]-e_7Wt.lE9fS.W+\Ap<d*E}JVMmw;<X"n21QgŰ>-ݗMII}qIu>4YJ>TG]m%Mû%eyqI+)?Jjҟf(]\,Ȟ,dXpyNH/S*Lɪ2S!a|YaKԓ0	
/lX12y%f8Oh 1?\w`+e8w4ꬮVoMOD.>>T_e1@ݘw(#q')A4"p~6Yk+4-/K*O$<2G}N}4]B֣eOaÐwK28(76	xܙA gng#Mc!S]0IOx2?pzldG5gx?dãu67"Gj$# *Ȕ1yAQ.O	EEx~WTf.Gyڪ֘`FA65<,״8~~r]{J.)'%U#ppI!chraU#jD_|1X)x	s&9Ĥ(Ipbd٤wsbhOd>b)9
]/P9)YMN.1dN26t)x{`GxH#2#yfރwJ&ߊw'KofY/0#dig2Q*.J5baqw)i{e(RbVĮߗߓ	TtcJendu51&b܁qtNt2%naX$g{EH"27hnLMZgH,77;12>Y-gc:-TGGOμxoK&Jߕʳ )Ïy\C]""QBZAvJ4krCc$n<&{d0)-7ZDČ5 a&cfXdUx\gVW8!jƓnQ/zH 8v]VD=C+)I{Fz6ʄ;C's#jm͕ݦ1{1++98peC_w3L7ё"I4
sZ" O0XceJbRNMjJ~$z&'G!&t-a(8cP$(L,e焟Dr+?f\EF4bccc1YkI?	\۴j*W"$Z(AR_ y+[VZ4ݐz~	Ce`nl:(zfV%5S* $c?:,_s0tqj
;zZK0f'xlgTP3Z͇#?:$͛W;&JIb-njPMx SO	#]idQ&;qmNKv2A̢Ocv tҍ{n~`1}sV<?_8zMgNt&Zn4ٙ
Q')-葟"9$%r	(1/pF22<qz.p"	eArVZҬ|A K	P%oe3*i(KjZ,f[ш[>af	k4*)l[;if΀pJ$k+HDGA"dak+эe;AځK7Ex~IUD	zo7׫3//w_3+.!ya)'`nޜ"P˚c,Z0@)LO2<^_{k(Woz~)w;o7XoօffQMh Մ-6۲E#@ n]hd;KE@Q0tY C&0mr҄VP(gדʚb50@ً Kq(HPb##*|kNb(b >lF^(%r)mzME'(1ﬥ?A?H$k%=^%L!q rJ
8V.N[aecV{U}ʮqz]*kb3E'=^iaLb%N
L˟Ew`ٿ!R&Hw*Uk?eIFC%i=DpUQV =Q+ ?br躟瓉qx>S=kb.g?m'Qt4
޲{a,XB@dL'pDֹ:UJINK|/;Xz		S *&wCPDv:;L?b96!3ѓ^8xO$O`QunRDM%`P	;u0rQՆ k86U<Mld	42
[DS?O7fwEHeiZa3pw.aWoe7gPJ7.]gﰲIXV4=3Lq,Sxs<a|Ѝz(R, (83u\he8|!c+xn9EۧJX#6{>֬;Gw<U98Z4/:ELb'WWo#PViqZP.]a<μNfj"8#<尲H:rE)9ۇMW Ǉ]Y)s3/7eqkЪЋ/נj0)Tɏz!Js(.?TݰBg9 ma Z+kVIf8.@6]m8-g`.Z9Q]Q Kd$uTȮ2&R,3SvWK?3*pNܞ<c4$!Rk&咠t^p!4ѥc#7GCbr˔vnBB=̀2`x<1*<eՖ$8
AvUU99|wa슗v鯨0ZO0$XLR[gàԡRD
VwQדgZaj%E5wYH=dt
(-iG}! T,ZJTצ=9,+9-"Svy0#.w.qԇKGUX^Cp&0IiU385 1Ca/򥼣[s4l&iPw%[ouV##~&Hsٙ:XXV:8Q'c}WhshI -[)(;,h0+.CHSN4sNX9Y'&|fոFT%9g'x([I=z"pdOy꓋'DF~ۆSݩyr_1N}{S4ܖPHn_YRv qs=v	n
>;O3w0:9qLFW,ؼ\ddEFG/{qto+Y^_@5qޯ uL/E qҋqgdAxmo SCņ	餂2zɵ^,z W}"R.)U*P~jx]v]'fiTi*hHg-y/|jʟ12LJuyl^24p4&W1a P&߿~78wხ!^%qtsAqsLJ_c?1>]+!s^FB1*Ht;+hjNE?w_a~wˬHdQv@2T(JIfTbe(>S&X/G.`U).X&mZy%j\y;9)9xewA/״!MJrTW@g)goRwo'-"hcZ*:qnZV%@{/w0/|{݃;vqe;qv:3nSMS㿵V]Wkk4)nuuG'g/d˙9+%~nYWވ	EТ:0jnB⑓Edy'5:OdS'K55ĝPk,g)$=ARGaRDJ̹	AqđXPW7S3{MLM@#' `8ؤc %g6L(tz0`T:\T`eZ8") E;1)awˈZh{J2zf&ӰO%uOBjGŢ2_xM\&@R@؃nmc$MÉgιuȹ96K<I>avL`"'Vvx{(5cv`Vx-Wr;էy^9HdZut4tlj2 tWjq4щ
ϰhǹd(]\V:L%5{`~RXrC/ƌ_-xwem@y+b68MF㇅ĸʒ!uksfp8Cr.B>ge,'td{fz
kw+xWK7<8mP&KM~mdcxbٝNŴ5[ CsWYόӓA9ώ?;	K-bHMNK kU"bM/q hD^j9N/>"C&:Cnev8j6@
QqoZf[Uy}E#Qy	jZWPA&Hr@!YsaBa9K-G6`7Yӓ@ԺX{jMո?7ܢJN];J爟uA[r_zIcgh(hnULM?$-ƾ$آscc4է@8% "K#QNtSYѷ|/Qs)@żFX:}d\wo	kEM"kyy`o ͙(W<јUPtQؙ%+Y"JDxP	yՑy_Wĵfæ2a)Z$ZXJ|&/p%KglX+7<(Z*zPK3]X9D&uW\=Fn2_1m_TtҥmD=,crlbtGAޖ_ֆ$ը#sh$dUM)w,j-hz7S(d֕֒Z(~cmzzV3ӽ&\PPq,Dl~2goMywp'gKWC_+f}-
UvV	eN[z8-2	q\y͉Q;	yG.[CPdS*֖}[hI7Z#/<-?F})yd~mk]&e<vVIxUjYooh/։5ufF8-?],| Fn}ٷˆ ., z 