#!/bin/bash

declare -r e2c_version="0.4.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 *9] rH(8˯JLI@ޓREQU֭IgjDM	heY Ky:{v=f؇]u " 2nJL\n?|ޫ^u:~]7W\tڝNwZkNtюwrQ440gHj]\`?	; F?WSwrQ_}E?
g 6| ?<4ps/7~: v 7RzN|V/qއ%\cou]\|Gc'kN.ů=.z͚nk{.)J?fXuƃZFH!sħn{#1;qOG,r37qY|Ey~c#wWgׇB`	.T%?xKq{LGN2%k_X 8e2=wu_6f%c@fDgo3t6d>8uOFP?$Qx`vFTh#$
(Y\Mkxtuiv]k;QśaػiO*FKK4%gSK9z^CB ~OϘg*?Vn0!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAWDE.$Π8J
+_sWFp~㿹>zNսwq=vti;_' (8rF}WM4d\V9ZߴAMpvas8LaoȢ`:2?Lc+*>#Ŭt--MV3'贏9moұViۍJ59Q"	ZymmWء3/ 	P*CErP;Tdg"TLiR1M*	:GG^<Emr"ZYlQ-*EE*_'ov*]"
s$dZeF`K:9V+K$2`@_1U5uGv
.0¾+Xa^p$@5frl=ݳ?XX廼	? $8G3**[~K)A9g>Y0N`+:hdcw$kDBLA2>#7f$t'l_w?WLZ?4J󭣯	+ZNhg`T=ɐ%Rw}a̞^Ϋ˝oz0_|z-1f?lloh޾2D6NxI#$|3:ސYS1(I~H$fcԼ$Re3kȋ6OgD-׃Vˉ5oI	O"&ѫ±*>y0g~d+7>|5Fr*U3
>	^l=DaeT s挼!}z΀_ A`|^|ȱl-չzեlqGo*U+;unJITЮ>µrujšOC1'"ʗYDy~	C"*>uaή;ѩwOpJoW+PG*2Qx]tZT }j;84Wmpԟ8iY
ufh9	O ZZ6}w<I,]~ȀOryf}qXM`\ImҤhE`K :u3
NjxY5ȡZFtrx+p5f*ϕ}}|b[^\UsDBJ%ߚ7Mv"eJe1th`WX$H.ΪL4`Iaϧ8bN%0GMv}lh:A	2_I3Dq4dҺ髤64RTYQA\C@90hIWWF}:ȑZMX1"Un_$+'Џݏ1Ԥ7` rhӸA+!!͘8kx!D.qڌp */9鋮/~ `\更W0>W<7?)_fe~鄞&n=~V!{Ћ
y??sQA{BvTQP7g645/TԲ=xbR$E[>HkR	{3:5VK[`ǜ	
^DG<MN'lN6 U Z3Ē15EBΛn^[0NoP0t4-3j @1盥G,>;
\"U R| s7tOܡ],Gj_ROe#wra5<㫥$`E>T/Q4W}P8/X4ĒeA\ݒ/[?8/Νʢ&Kv)חdQEȺF45,'sOz&o3dg[[oW"q8O~gDs,#tcQ0"/}KE#kҁ9}²"e/7bϾ& R*ɲص⋉ -,_7:dȤrb޹v0J,.Gu(2rd(Л^l^@gfnx7,Dg;w_cϻ}RXiHi+lnp:4eN$a7lɵ4<=I0b)޴M8.UGLCI*k6keKUr_@MVե#){HAWmG3䶱kxĈ1ޱt:MFUV}uQŌ(NFؿHZBRlY&pa<WdwG*أ_˯6`hGccɌg߳dP2K$a;tXxi8a
( UԂ@H5)t|!Ѹ	^2rY?5[*a/:+tm{s9ɔe^gM}>1H[[MZ-Jkf>KΧ5MK:,5N[iYD`F%Rh;Q{7뽚i[ԡ58O/v"$|#k<d{. =ui,
I*&cf#?=9'jxg^^pjkM>FNeZ-.jZgh;YWJI}A-$FբR0)`eS橏hT;Ia>AN\>2fǜ+9 NNT>%Vh	cm2_0-iɸT|PbHFFq0kH0eրR+eݹ(~[]ngXNVP60d(;ѹ+Wv&VFJ[kV1^:QVt>Tl@&510.*iZ⯀Ts͌4=in1٩NOnJi~?Y/^23=?d8$;?Ӣc\S1eYͅuigl[Luse8~'IpIu:ɌDٿ`UF'U1٪,KCDV},5{Vd̆Fj(]GfSIx]w{n{AWmj_G D
k?НDE/Q5V$5e3Nנ}1VIw^H{:蹂~qnB0F/~bCO\|L&NCKu%e"IS-8l<)YI·llb#V)nJLO}qFāxJoWҢOj7Hpp:뉯- $P3WMŪ<RX39y'{ÛW }DWW1D'$"rrTWZZj0Qs%fT3ۻ>-6HTdqzI^j;}WTbժ@er:_8ñd2Zp!ˋ-Liؖ>cpͶ|h"M.YҾv[$Ai9ƎA	nhѮb=4;MҸt}gxq8uB㳿ۃ^;QF2ʭ3 )Q'D)U4;F#rYFxTd9񩶠NlDrE9>$% :%mhCk&;`Ώc*
Ҏ~{yZ-=4hdRDAʊ']fJIj{i1Y)c悴*6&,Yf~	f(w`)v3Q."hB(v lq+R.9љ
I[~- M2V  V&aChrB޷JWu v"%[-cmN]n6L;s&C6sn7=̄sh-݆@/Z@2Q
 
Ndژ@bN}(0K)UH=up:ݷJsI1egTK'n:`_C:֊;+vFt%s/\ތ.wѓPũI,!kiӓ1҈Q1V82}š̳`4+'Rƙ;4FJIQnY6`ݡ^:@|JS'>-k&),-[Bnw3Ɂ\qފ6HR̝=BJnNd32"9[/FBLvuvx}~^c$)&tILc4^ 6*0CWKnR&n#,%Y
,jvJpϵeC֭Yu{T*Z1$xFw&_VRT3)ݵ҆_9s:`KdVTOЈz2T RR>2PHRnVX]xs66-t	KRSY<WNgG.<r5aҊ86G9I&i/T=OS_OKcsڢwʷYxmKG8i|l;o48Ǟh??E%-sMs~	3 9VzByK&L)q
*q\#g3ڑ2ǹQ.G,/HN<p5h!ϕȔx͖0p B!'_b.$ip))ijA"jD]B	UDDB&D	5aS%@'ϝ'_3 h֚S(Kя_{~NNGߜN=´,qC>#L-7똜3i&n6"2jc/ǣyN+_kTdܰH#!<{OO~[;sB2zG߮d^$iISӫʯ3ް{R6$CCL&p"h!C&8(KuF[39x$$I
o~|O7DD8G;$}T4Ee=ϐP݈P@3*]	bNpUd M^sHF&LcvP_8=RjrS8>Hb:I\ՒaD:*B\?&LJhXRն7F I_\op3	1^Z4ۅ'yJB
NpE\1Kp%y<CPd7-֜&1Ɯv2ΐ1&	MK$2G$*n^zH?/z#+S> /wXT'a TX `IAx'
=SA-hĔ-E!R
mnj4,|cK\ <hAC%9ki#@΄<RDQn`9"dBL򍁜n``|Q1%-4<`XGG)aGE.Jz~&I~33ܮI/TrLdi+~l4/Eh]D)ȎKJTl0'T/+D)j_29T^2ЌiЯda70tOO4k b(rEZQkjeѻHNLD&V`bu+_}5Kn@W-%]ia8,{d,@KВA0ZtJi,ˋ]A7]yӑ7myӒ7MyӐ77gYD!5
ů.K.K nZd%YAV/~hb67k$wI>q`zruvrJ'I
@h&5II͢IFQznN]A53	1L˒Ax%-=NM,K}-vF/M[TK,GYp>,tkD;|i5Z3F<G?=P7\!i4|M%ڞj+Z컌>\k$_jc0u26@]c^?a&bMm酼0Wj{J^gJrYVRIeQ(S%9}2b4SQ@ȣxcz3dxIq)oz%DI-}dWiU!L2.9]QYMԫJH$$0]7Gf6QUG\qܡ*\%uaʒ¨aG72L3w	~X2	So0<\@&T%P۽DB,̽Jald+Bhu}lߐxeZYܓ-U*&DxtK]k+!nBR{9hK{bJCHAO.@<8ͦ5M'q{si-'	$d YduF&䡩.3"0A)sd*,@2MH"̽YAƟEj4CiқQ9}YZR'`9w_xAio4dv1.7vGi*-}d$0y9(9|UpHsO!z+n\u3Wr6#ټ4(ۢDW^i~kES}y'_N&O+7f>y_^un곗yP-FF6P2I~,<+}vâ(sj	+NFykQNJk7Ssӯx 6tfƋQZE8c"c7g.FNuRts 
LfCS X%QwvR6M.AOd9V>HWի*mHnd_G7.@Gy[$6Syp^D4iØ*d#ϟ~DWȡP5泜t&9ƑणXř7tlyDL'	 qVaowR,*Bb8] )لڋX7i1K+h
ܥeY9 K4op]@7@BN6S8Bf.hynUITZi -W.Em/B=B{n)rU,b^y#bN^\0c,]̸?|[71r,ɡ[e1ʿb-:F3VYI7xDK}4tY7v9hrd>aOE:e!Ljq2xAObsGjY`b~uc¥PZr\in}R,SM8 aNxց'@r*:)NCRR_m*9Ӕ=t[>uajƳd>>F}~_=~b9iXS1QKn𚹎.{547(f̭G09P6(~ME|lQ/T|XXH0@Kdg4FM@E`E%!Uy2`9ԖetEu,8d8 c54;Zm2=~KkMx;gcp@*cpCUX8R3ر'VͬCZb,L<T9K3KXR!M4GO' !;raPAAiTd\Hz,Գ=M=T_eBUXy$Ia֒QV؜y<|KD]?f^.>,Ϻ.U[!B@|TL&DM=f$Z}8)}Y\WtxTJ?E[;WEPvg0ĉ r{9Q25cf~`8Lz@KϘ29s Q-^ΪπeyAqXXd
Ԫxz{E|Wzp$~j'sZ˝y;Xn6ѣw:~ԧ.yCHOG5z [6gv0Ч;@?\mfۇdZKÉ8uG`N	U*N4" A{wLJQ$rpL8)r5.9kY^>k9]}:LN*x n8y;t'-:#d0\2\	! "@tGcە	:(*Zun]XY`ȯ8\>8b-g_v'Gv#6Ғx0>_yȁaXݤ\bGw#?,ad{MPTdJB_:j<z3%AgpP讲1tGBgWmz{zY['kk9sဴē1z$<дYMu<oP~l3EP0iX>xn2fV`eBh%
)ZO%WEƯdj_-L#[Р$
<Bb-x?=	!FNkGf-5oPgl)cűoT	ӣWC+ _݈#WxGOO(5P`F;aN9ϸ\i<M8ꭊh)~G2գ*5&
jYb;e25y	َ-tBdR{?L2b0۠e=b*u&J$ӒxCݪtnz,ZmL:ӣE&M2oTZ\ؒ}<TDxWO`m05`50LU%4-jոc'mA}F#JDg%^3`lPӅ dDmJgGˇhfbT4m#&K(n<Y5Ʌǻ^dL\M(ct$hF2hDVe/7)+/VbR~]Z1ڬV
\ȳ-]LХi!GY3]z^֍3ZS5 EP]gzےzٞ&Qc	m8B2Ub\%4ex_܂3קz)PXz[RM֘f8dcxa,n:ᇧ%c[}&$UxB$\@Kܧq2&ZGu]bd?/7)ϐZ1$2Z5^#+!23=%iScL@ɝ5@.PNFaT/7)8(> N\9[<Ezu$0P!3|a9;:u̻Hc@UIijĹ'rPS)w&:Qzt@9MR"4e\'D](5=Y[O3`7?3e$Bmu-'f'{<cןj[Z{5̢V5Lu ;I^I}"0(Pj
']{i~Pm@(eez&9W"qIĞP<"N*j)nSA Q$~Шbqg2Pp8nS!
P0	iGK=A}Hl\;9&`W\m Vr^$3+W4>~bE&Z81('O3Z3a!	NQ|H~L*ݧ>vlb{,ѱW; ?:7|<Wd'Ƙ3]q9-GPMD,ʓ1FqCݵO%Pj1XQ|V|-%ajS)KZ U:8TRwRjIV&qbdQouy5};ޓ|R5xD-˰UP풄Ka(r*\P껭	\+Y/_]~Gӓ%\jL2~OAlpeKS[\^-)/K,[jReՠdقSF3˖YJAfˑ:m5*ŝ9ԭ^SS;m!oC0^xN14u2vmA'ЬKwWF0IY>=!vLy|vIW:O&e+鄙 ˫`cB+udZ-u1߸+G$$$RY";m~R^J5[ })z%0ҏfy8q>MdeKïۨߊm+T}GUdY-',se5"gT6k6N|!z.Us5H e_[+0k2lRHt2s2_n}jraZ5nt!޴¨pgq!,9RsVtXMݾ!^o>ܨuasb]lnwsZe7n]ʤs[p3_JYLl^=:|9{k0՗nO<?Qn}P}K(8132&-j<c	lhG$-IRw G:H28zoڅ4Z`|~VJ.nM1Kuߺ1 usmaM6dPb޼򢵼*ieub$szhF3;ЩR*k8G؄YeũV212;@iI:b9\;ŕc8p$C^|CFTd#:`rLQo<ĐLrLM8lPgh:vU66": ax5WUgEm~UDq(_1FɤldRRQU?-l@^`_BI9-\dӼ!M'$ZD#L*U5"G&kl%&cOgWWo^a_ݝ'#f9,kc*Q-0j0|ͱq%R[jkH=.3Me,A׊Kb%ksa5+QfyS|W k(АlfN^رs
=Lu25ޭ }&$vHeK]ۭ .k,9/D1P=|DԙUVs Sr9;{WťAyd;=ALg-|5Ͽ[o-3/"fh#ӦnÄnf+ՂL;f 39,E/*P3˔qSPRbIDWN;S9[K0 J!0-%n]5dФD(&KwF޷GڷMַCҋ3ЦeIȉ:UB4ri칐(y勲xZdtZJ}7>jg6},b2LmZuiI0׌3E#.:ޑಏG OQdgѮS?Oci09 ƳnxпW"d=K^]3lĉy p%G͇g Q<)p̋:p1̭6lhX{7q 4y|.0HPî~֐[?hEbSlVo7\dsbk-*zxTP[hoat:fr\j.<&@uh}gX7`2#X>}5U]XjW U`T}9'FL&d↫(qD1.`U{doՊ*RSTUS=˫kfTCFZqsysݲ=\h~)q5Z^@)k(2+QUU'͑gr(2Lȋabt}:}>:x޿!*GҮҒYL&CؔgBu9"eD5"S͐F8D+Vbfgb"t/BkXXVLDžY+Gn4Gy>\@L0:܄YvQ|)<בȢpXIhQS8!*4,YF)˷*?>xS/o
+es$:0|eA>;wVf5WM;)S+!^0)<EShGcGp̊\<s8²ihb eWGCJ Ȇ1\y	WWy¶\ 9sS,:LrpVJ"14j̉C=h߲R`޾ pWl~1i) IAr +$(u%:kbyqnhA`.Bz,I3]r,մEym[jB3y7Y8*w{].O~1v6١bC?Wz:q[
@Є~MH1>l[Ip@c6;e:R炀/ G6 	wL}t!,0ѡAKt{Jb̵	7~D4"ᡋ4	gi4=OM)E^%Qxњ`?,nswm]	
)&$\'TsqxKe<#|YR*on9^{9axLe-Z̖U8qϘvi)HvI/qGfT];G m0<%N;x[% I_DͳJJe\Ԅ9lr}9+Xm4/jk7(i^yn4:bCzKD^h]T4FbrTLЊK>&/yK1mlH	7iZ@^L2f;_UviFQ8cFeݎ
- 5J~c|\a2=ހ?k	ߏY_ZqĻO݈Nr@Ǒ]CrAo〒#)q^$:(DG#׼EPۭi5F.k5|P/|ZjZjHT3j8?E+y61 [K XGШ?Q-tZ:/@A.:<KESlj(>M| a%8Et&\6nC>{zy6)eəQHFSѥ;ҙ^F_&Y{\Y%/F.dƵQ(q/ʝpV*F<﹃Tet{Q3PX28+Joz>TVh\eוXG"ҲI;5[ *{eXO9/#wCbW'aZQ+sn4AxXyIEa<Gr]nbwϣkNVjƴ|l*Q#*y3\0>+L''3,Y>ɾ-RUR3t܅otQFse殚lx̲L(FMm;R¹ڍ#f~)^YoUy )ţwOѮ -)LJe$#t
`t<pA:Ͷx<WK_
&W &˫'VVz5{:&M+zkbHΐq:r x0mzO'5Kn$F0.<Sv>ښNQ|:s7nitc1D="	pIL O0RWp׿c!./%>1>fg^=j'^|:= ꁂo<9S ԥY*w;.i:=v%#Lz{t}^qw*?LI"ϩqP2/Ii4
_GIp`zt&9NzC,T?r=FdMh$6I5./<5F0>r쨗G}rVS8R+Y'2j٫}<߶g^ṵJOU6;#
ڌG 1CkDcU̹qBvΪ=2Z⤋R捝[34宪6Q ^˯4z 8?ϜjI +VZEB6"ïOLͦ|pA^ڽ3txŬM/m"I}H`R[gUӬ瓭5 ,9	Yldtsf4t.A3ڛaQAfs2* .&2_XLs0jvj2 u:`d5ם8QCJdI&1!c' sf'9"=&qf{QB`"ƶ*-D'LK7^lzdhSFoV<{}(-尐lQa(pb/~RњG%2JB7TMDNIr<]?c˯t$kݾIOO.a82dj|r 恊Xy:M>oSjy(|^$6oW<$n!xKHOb6v܅+%k;^}S%u<F̃LiADbM>ѧΛ`cdvPM>Jڥ_G"3-iͅPu^?{ȱy̓Ge4A	4>RC
Kz/`eVk4דe[̻!t;T{j/Znxe9\}u\M!BaaY=fǢUnhHW5΢Ht-(An6x 8F9ĂN~4Ǝu',]=wubEUy ^b#KPpzCw=~G9|9@! tZFf5D׾7f%QPnN*bԥNby+%>)n[J\$%k8o'Psf˙m	lhLU!41z@C:l۫gc\DkxdWIߙLFA؜ep0Nhx}Ie ɳZ;}!8NBUa(JRH:7g7V<6O^YYsP]օ=eY#%XN޲-r`O1'@Jkmh'[{B˝LGqY%3Sŧܵ5eȿ8YE^od?	{JQ*SϚ?6k(aVYrp̠f䉭EGrt^P"" &VeF%c9#Sl\1tO_
_
mVqܰ7}Ѳ]~uNoKf5ZNVotk`%Mq->d%v$K:Z^[ou../_FaNi5n\ !e]|toG[_kAwׇ<`[hXH"SAa1$b\P1Ţ)*rQк`xDG+ OXItLGXPI`q~yJa,iL@0F-3xO:vWsfn3:>us/فfY	;Q[X-W)jHI.u6&@ħY9vBE/ /fK-i|1)J ߸`OaMʪjt_R	x¨/:uű`cFR<.Oz^C[h=>zcY[z@t%ʧizRɔy
%wFZ\>x:YfFg. Y4>]:w5Iqubwbfgqz`|E)_m<~ko,,DHin%YDIٚ?,yPADZ9nǝ\dY)m8H^
 ?w"<wsd}i +SǌmI@n{~wm7F|W>؟S Cz)TGgh3	5AA,r@{I")ߞI;"p{92dvT֨#7~cV+񪪹GroԡcAzCc&>'dCL'(-b7t,BݝƯBG4T_ =۩M`8DaУ=)ؙ'%½V;򚤠uvعNxq8{z{2O1	":Kw5LTpnW~`O?7z%66Yew*KK2&jiS=%BŗQr3F$x.(jE#DcI7F
ەRQ0#epC`x9n&nE.Vsxk?{kr{ʁ{psA#g+Wi5,'>>4"ãXǓ]ʨ'l5M'}9
nn ~nI9v7ڬHE97fޏJcZ9B>1hbk`w{gkoMkk|b1R?h)9B)TBо{
jܕ0nY_h[ֻ{+=9\Z)o^3PN1ӷgվdx#^q=*h5?{?6[/vz$/vY`ο~jOQSiO/([	2ЂO	{_ӤM}7_Wo^e_T\wn04=դߦ9IFzޚTn=רi7<uzZM֦SOOD
J?|kk+fF#5(wrӮ_LO)g2?}[$(Y`?P?;e<Nds)&QnZ_e ͊/sVXRכ[|).Ei
/
oX{f[[&u&{'0㟟+xu<+65)t܏l
?w4j	ݢC]6EE{;~,P,ȍaQ1=CIH8H䙙y癳gw.87Cg;ׯ,jG(6EBzԥDk؝H-ɂ9]~NnmI~"􉷁lՏHٝyG<bAr#2'}iߴ`1qx)\Bebn;#aIĿk'Do4;]owq]/Bl"@it  ܶ9Q)>ip]G?_v!8o䚓J5ʐLd2mk3:FɮkpTjz{(]aEMm3yLkY"׼5TIȊߴZ6cǇUrq]k#'a{>)Z^s%Q[$,݁nFӼq'We7oY\;\gsE8c?OB\{BD6 y,~.ޓ7r#Xf@Iބ-foX1g/4WGRip E駫{ss_:O1yunyN'_={}ӛt	 *_yo\g֓;r*o[)4P(*g{BW$Jzso.J=<fY0ר (bRV
{ƽ1?y`0AlE1#sGl,^GBagxCaֱ3FlA4q74d5ҮwE4A0
M8F@<r1ǧL	MV`:ER`P8r!O]yq0νj?Powrcԓ0虅Qo4VHp׭mepGtYCh <5adcD}

FukҎѨu8`1YcLoKkEw'_ZӞz}".ZmƬcg=j-sJ7(	4Y%]]VBm(#-nFwyck3nΑ)MZB]ZM \hvʩX;)XIkѺB!S, Uq)4&aɝ7elnm<KY:q&t5SYjl|qzIAaK 퍀bH"lL	4A[ߝ]#cac'3,34cpFn[P?mw#ZCrOD-HJNSA8 	p5O7(gOqs*	b4:O%exgZGA:Co
=\|g'3||dvCV%"}q مRXR=u0[sB,k6Q^c\/<LFIc:f/fGD"FHɑ؟f	Bzgl0b,VR#=U()(^]bx@
FUY);3uP='|^`gU"uu=s`84|hlװWyj۰4gve퍮X7:vs g<Yaכ/23YДx<wWXYnۧ lanm^+"E鳛^_>%2sL(oٍNo4cjz{hΚmmumuXcujw1n[>5V1h65{͎둺XYj썖؍ܰuUV5-%ub6`w- i+5F  ZۆDs^X!v[	4޶Z-nY͆aucs FŠk]h@
T/5 A:"Ea;rކҽNO	 >,hhge	l4vw]֠]
vnnAaM|.}lBb} Zʅk6>m@fNF~6Ss2ZowF87V[Cokfh6/i ԅ)`A֠|j[vvѤiԡcc絍RwԱPɆͶMY__O5.tzXkMXJuWXOw6X[$lNA_au8N2UsӆO§Oht>%T@al(EC1<()<s#&Q5ٷm@E1i,<Z7-ipRPKuv1CRP3U oq0I'a>/jZS0P4eXj#>sjh넫jyq`rSȖ\j*#It(rKy>P}:ۍvu`5z.-oKZf<xWnT˫S$T<yԇJ5d9>J᛹spQ۟xЇL`>|Ǥg|}Λd男#s|>Ç.^÷2w8'd?yڋ]W9W1./cs
Ezyˌ^@<		cg
K_QؓH&w&bӏ&3C=/EINeZ&Օ/
I/~j?g{.)_/#;? %98%XDk=?H1&s2rj^*FlôϏy1p4yt8IC%$=<Zfifyo	&t8>u80R>m͘vN&~AQgC:(_<w_$3^U	<TS&	y`WAq#oZwY=8(*|s>2+QgVeMG0Ђы{M-UTy%*Սai>Ech)'LCW'qEj%ժ>pb(̈tuܿBn$;ܳ\˜41e:mFLN= S8T٨T
E"ۋ$K#2#yfރ*~&o'KofY/%0]i@ Y:*UES}2*<e;7Y**?U|y.'&SPN`aſTU57GTqGA*Ɛ% CH
1Oj)%@(KE el&iЙ07rr+[nk_Μ7tb(c|߇[f)H{*'bvGq<ݒ	w<c;vd8콼O,n.Ia/!-{exR2MګX'	VwEx)ݫr2%Q$11cIfF HiVYrV	,U)"F7o2-jwE_	 Ǯ˞Ҍhd'bP/)zz>qc2sPcj/+,ZseD֯e?zĪJFN{$mW 1F]=utnRFA2?MB&S=EUS!n|?ɀ9QH킴	]I*;Θ5T"5
/x!)gb&fk9d}xF7L+z)ig&6AVJ@$$AM29)R@䎒2eY0t.Xhfx>gfVU3%FzG+bn<}VOatGo早Q,~pMpJr}0,Sy'Kdyȵ{Gȃ`V{ыJRXCZbSoj0 Y=Mj`086';w fte;}v=M?E04>J	9dp+kh]&MVBԉ`}"zHIqJ= Ν0ys|-e)T+$sR}&TFJ1ʒnuhDӂvZnso5G3g@8`Co$"A eac^=؉w5W_&%B5cflae7/vv^1+.!y
n)'0ɵSDYv92@BF](q>Xfk+տxkMa4c| ߓٛM%VuQT?E* fU$:x[6M pEt(
. {&WUN0h
OL)V3=¡qݞ$	e-x6"r'/8*_s[F@"a.^Yfk\a1\'T[iy"PsF*1@D]9QbY~A (t1p#J1ijc?<kS,xp|տaW@TT5	L5	^=1'qOqWX\;Yߐ?)OFJ{;湟Htô$TR4Y"**n*ݔQ bvR8>[m1Vk`e4M.9AX	kN:7TJI|=ie˷Wp.dQ1}?r"Z̰СoeF`n	ٟc=, y献rj*iׇB؉뇑,Ǎ.T8\ñzfoqf#KQBjN<m\!\"iT76|eEh\2n;Ϡ.Uj{]PAm
6ha^3Lv쇹;,s<v{ %"қ#k^&XA<Qpf)rW=vUel%ϕ<g8H tT(nKЫ=Ćy^xG^^NjP^ܸC:oӗ"^b%0TgogtSfYq	P֢x]hL}1 y&{6,-gEpN'ae6zdoz^L>x6_pVeawf$΢^wٹ˛vAB>^&KaOM5tȺPp0:sP
'5Wh]E\C\0v0 ,ę9+e̹̏.&#3ZGvl"j29ec'|$3*脯4F#l[HB/:ar]z6AîK!襨 B]6qCx5.&LbKVl^pNP) Qߨ6}$GL烸v_|c'O~EvJ|Y f:CFfvm䭺)ZG]OI1h5Be-#+'fQYҢmgBXl"Mkr9XVrZhE:4Ar$G]T1k]][/dNL`9GS"F[q jn/@bQf^SyOp%hLB5ӠSJT;|WfV[(GeO<u$	v~йL٩:XVF:8V'c=Whs-Q$KGVЖы--ayo!)'9'JY@b޳j\%ǒXFc$=B9_|<b?c"qa
EN϶Tw$AWx?b=%80;TfT' h:@C/];a{S̇ҩ;8%+Eކ\FjbAVYHM3[MP#|tCP:ʷ,C//wSWs& 8aŸ3 67qpb IlRTSX/wcuUdR)N*
MCp(uQ?5S]<WeS
z^.;}T
4O4E$3\ 5|B^%Juy포^4ܰ7ӫ0 (/g8~	78sᇎ!^&it%Ay+ܥ|s9<<	~|)"^^]K!s^ҟ/'B6/It+KhrD?wi_a~vˬHd/,2έUR$5R3J?̕fיBbQ*%jbۦ{ZE_?0v;lzMҤ~ Hu%xzeLxe۱s|[ɆIs1+G8:F_ ݽ0/^[vwsFEJ.ug"(zv.vnӝ\edn 'W;:axPجi{@ܬ!fYTjx |gSLěMc!%QbM<0B܏dd5WkN7_,9WB1CE27eΆuг,g)O^|g0(\%^i3qؑ¡B[Zov?|') )iEFdJJtο6g:{f~H?`N̄LX2Rэ7,IFèʆ@(G	Eb1VeYpld=I%IBu$/S0fMn&G!rkh{xͻL5cvk`VQWRDշtϺy1}:~-"fZYԆeFAH8`_gLUm:onY8F*zI*ފ7+tn↤9*?;>]\vϷvfzCXk5.ty$`1ǚH}IO~|۾/=О6.K~?,yd'[U2-;ޙ3_z	ӽ+xFʎ 1cwV:{\N:~n] >s1q֬ovinz2-;L?KSeH9ugRKKy֩z/p2M?%O{JGKKx OFP4
	`(ab'~˿MMz]k0_!%PR(u7cYJ*K~w.K5c=Y:uw$(k mɐ:D61"[ r2rovVX]Dg^2KG.B$*cgh<hA\6P\ʡ4H>R&{ t2Gv+ȝCTkz? 	xީnXWǈIsWZ X~zZҺkT'H7)5u1x[,B7MBA^%ʁN*dY^@R)'3sU_E[o17f*?7:(1d`)q yUjbf!TRλ(p,]FkGlVa#W2yU3'ȅcE&\Yݦ|e !D|\_S fK߬HQ/]Fiƒ.1Cį6{7_Z)FP`2>ka	AkgJgnmPK(zݵ*Rd%(P8c!m` q==͌w߼:Y=fʋSFo*R9 
.,F\5~p,Z4	)WV~m˪	%Z,Q -~gȦ&itF錗1I)qnvCu߬NH=ן-2oZI2gVޏNcFc^l'ܙiyNT ?05PnNN;c l 