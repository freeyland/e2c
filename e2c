#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 a] vƲ x^"]7Y)Z%(Ijq:e
$U)Zd~yzzy5kΗLDd&	$PU$E{X%2222222WXvzhuXv:7vX3E,@9ݑz qI9䲱h9i`MvݾG~6X~wZ}E۸wrQ_}E?g |g0?<4ps>_^S-[fz@J	E?$k=hD~W}ɥ_eyoվzvE0c_ٹLΈxX(i d+ر7v7=yq"7<sÈŧ^DiG1.;ry|v}( dBޮūq0=;|g+ߴ51Ap2dz 6̸5J&O)!h9¡7v0g4X#pm|p23E3D8;؍(rG"
)YZMkd|u:no6]\#ؙ?/UOxZ}7T޹igSK9ѨCB0~OϘg*?V1!pxw#\idW_͟ޱ7t`нsd^P'1B,×QmaWEE.4Π8J
߫_sWFp~[e?Znp?z9i`old9+&jӀY.6wo080۹#ݎ`f0Y7bi0g1|`|ؘ~b֬{o;sBߋN8#ת]UeՎݬֲݱ0rpgmmF>.٥"T$KEv+EŴӢbZPLݡstœ_&mM6٦"Td{QȠao:
QaW}$D5HĆ0N_ՕVwȀ~ŬcV]QRmϪ@OZ*]jR D(ni}xZO8,͸.Ha&|-u< PW[^N9s΂w +^|$ݗA3& #]KW"`1d';el?qʞfҪݦ	Vo}MXrG;Y"uilyu08}Ah_|zg-1f?lloo5`ok?vp`HV, <[UˉK&oED	O"&ѫ>y0m}d+7>|AF)nB53	:Z9V.<J"9s_f@/+MЍg*  dWX>	_WvTw-6I{qh}j<5D7]֌#DѕB)E?pй \kZttǓ|s8]ɞ@з+Ɉ>Y Ue		Т,?ijԉOj0oY5	pEA-Ԓl6Fdisw}XG,u/+$bk`w{gkof`K8'0(IlDbE`03Nx4ȡzN]~x+p5f*`dԢLb[^\5_J2ZE|ߍ]8~Z]  rɒA5	#(tC߉]U0 y~'VzfSw`*3n4#L ?	@`*z+Jj 5WՔ#ɰ⽿:㪖tmx֬YjdY@H yU[D1fUsjgB4.A,J)FH3&0N^N.UwRX%'}c֏ ,RY~
ǂ"^7˼/sP؄ݭg?+dyQA{;vm)(/[{vWȎ3
fv埋Z/\R9t@@Bñp.ìJԼÜ𱟮aRYeDhZZNY3LAj8HM| 0oi!@uxMhc)A0rs\M` #獠4`x۬g?>UAxV7.X8}LwDD_	cЩ3 3bn㟸#YXԾXAV32n:uǀit4W$`ME>T/Q4W}P&8/Y4ĒcA\?/[?8/Νʢ&Kv)חdQUȺ
45$s~1x)ogV/϶~Dh6 ɇYFGW(%~),ʙ`<B^nFsWeE_Da){/0RI5&_Lh/MW%DG&εQWbvX5W>/(}@'3`dP޼EbՏm:7;v`el5?yjg{5OCJKfXifs+^Xt&o1<O,"PK1dKYINEulqJ=GpNQaYXbknߴB.XQ#]rH.STƮ#x7W6$;[);F93:c"iA~S
I9e5)\ݭ+kV`|_~_7E;;Kf?UM%$ӄ2E֔Y"ۡĒKۦS@QT B1LOAי7crix]蔮-}'30=e_l7ht"VGE0lv&V)i+UTmL{)\ -YꜶK؃!31Rh;Q{7뽚i[ԡ58O/v"$|#k2Jhd{IX4P	u13ʑj㞏eX3/B/=ڵg!1SقV㦋Z֙ڛeVRdG_*+>l%$gQLc+cqFyE3NROϦ1JNa% $7%Sd%Uaw@nX~.V|mN:1L-]o x*CR]I\H(yC2Z
y%X8LVӠU1T."Nt.JmAQ햡%ḳN}e"YhU2Pb`sj$cIMb̭KqF֬+ \3$0}m[Nvj/zSq	k[=a?l(fL&nϏ%%m3N-	Ŵ(y#/:WTLu_oVsab*8yScA,穻h:NIv~tRM3c/p/X'+eteML*˅T,$Q+p^#ǫh+FJWTu}Xb-b,ȏ<2u3Y$c;6vZ;Ddcm~ ǀ,Ө%[tt! bٖ:kS/[Y=WЯMXd=R {i5ɴ{a(VPVPQ\&ҏd9em,)CQ(6,6bbVt~NXzv%-Z[$jzSnHoN`5TJA):y$-0/[#'>}w]]1yGtuuKT}RK"r-'G%p5g%A-o5W".nj-ϞHۺ,b\Dըn?;aOjM;N%]ZTɅ3xJ& 䛆?8mѬjfSz-ҀyQ܅%-[oEQ6xK(|ictmhUYˏF*٩EP[d-k#?Ù7enlܹ4Qk|yN!< 2HF(ٹ7l0ƣ&|Olj(##/"|_@%X%~AnE[y\/4鮡+5C,7RD2J9Zj򇅛yrO%i!,,$/	N̔u?trRi;UmWrYQRjf]F*PA*fV\r-:.ZodQe  ,L9Y(pӅ#/2l:uo;a,$t'AӐEJT[&[`(MY5 /mZ0Z&C>ov4	Q12z>d4"S3jUUf Ńɨ1
j;lY`PS+Ft:;uc4k/)ΨNtu_]X+,ܯѕ<	sp3 Z=GsC&ղ5O,J#FD[1jqr>n%ςlHgTYnDxz*9!E*zuG6{| m(O8Wz<r 
foAO
M/l&Gise{+&sۈ#I1wzM	Y: ʈ~NF@ғ	Qd0vx/%=2lhی+4^.˲vI8WNG8ʞhf5(Q^ݲN+5?"f[e囎W[ZfI)S_Zq
4Pf|IJ2PHvt"7&rK~<者/ZQ-?C#ɀ"SHIy@@!;P#M!8/m&C}I7Yr@xN]2B%yJkäq&lr$LFg3װ_zΧq 
)$5|HEoږލq\;٘wip=~~>KH[25攛f &jUsBLR<Ƀ0SGQ#eRr\X^Vuj('&C+)/arR#}B2ҫ<]BKgHR*SՂ(D(-$5P2)MYjrIN?#[;O'f z#l@5]jQ*Bli䝜vK/9{iYc'|FiZnZm{#1=LAܳMh%m[7DIe'^4?NƋ;Wm7~U֩$#9`k#fyda~4[I~4W_g`RP9<\.@dé"l!C&8(KrF[39$I
o~z5DD8Ǟ;"}T4Ee}}U$DE<6"=
F
ea`C7أBmSrcf(-e",.l	K)dZ()'y##~tgR'7Wx&&H(ħT@$L*oBvg"vso&©(.\|&0\eIi?%YxkB|zcN;d҄%o
S}#snB7/=ہB=X)ꗗX;,*30f *,=D0$@@Ҡ)͠Q4fJ|Ր
y05VKXAT@c4̠졂Qp5N´LgJ("(`B!&@N7_0>(sU}Gl^0iN"%RLtr?$Dnפol*Fg:Si,P?e5f{".d%e*~6[K"ڔL/Lzsy/h4OQZԴ9	~z:Znw%i01SuN1ŧfё_O4O#XAA"T6,--FEȨeHa!~oOvoGpTte,P͋D7=yӕ7yӖ7-yӔ7ϲYCV!k$_S	|Cߐ7$	|Cߐ7$3|ÖJd
Y )_"%=JNotL|v2&qrܭ'w䮓ܵVaIZIyV҆VR@fY$iltWd] k&wl0uBg#Ӳd%.fqKohςh9y!)G;&Nd%RRLAǦY8q?dV^eU䜏Y5.␴9&sjXm_"-gF}z3b/>[bY=m환L6Te|01'b-m뙼0ZWj{J^g,JuYVRIdQ(S%92b4SQ@Cxcz[7exIq)o%NDI'.d,WiU5L2.]QYM.ԫJH$(\7GfQQ\G\С*\&vʚa.ʒèa?N2L3w	~X2	So0<v@&T%P۽DB,̽Jald+Bu}lߐxeZYܓ-U*!&GDȴtL]p+anBR{9hK{bJHAO.A<`ͦ5M'q{si-'	$dPYduKF
&䡩.3"0*sd*,A2MH"̽YA_Ej4CiқQ9}YZR'``9cz_xjo4dv1.7vGi*-}d<$0y9(C|UpHsO!z+(n\u3W6#ټ4(ۢDW^ic~kES}y'_N&Ϥ+7f1y_^unQ볗yP-ZF62,|.}v(sw	+Oy;zQ$JkkSsӯxP7tsƐQ3Z{E8uc<c7`g.FMuRts>
LfCSPX%QwѪ<R6MBOd9V?HVmHnd_G7.@Gy[46SEpQDմ){L?)RM0G99h25gjc ds$siA
/K!Moo$gD)ʣ$feqGǏ:>	Yk\:Q'v~0i)|W5[K-LI;.\-<rCZQ!,dM4^hkokkyHE\$%  L{|	sZ.^66As5Iݖ%%SYPKtYbf(L@8bÖyqsnbYCr5rcPjq1fě*&o0XR,hn66efkq+?kqҔ|`V )CeպālԲL&ÒEZ -}\..ZB+;XTlqxC(q-NNjvWsES<I5F|/啊LcP)p鸧}ҼԌQ?:ƣ'yq^s8ab.<ɗ45ws=mBk*0oP5ș[9q*`|BŞtKP:2R#p?BO<`iv,=P%JBBd6T+s,芜Yp qfA>rkh<QEW؛tvDmI70Cך:w"\<s5*!	XpQfdʱc'O~'yK-qlX>y$N\2 }Y^М|k̤9v65ؑK=.
7uH8֘\4祢$
57ȥeµJPd9_\^0kMK^ւy<|JE]?b^.>Ϩ._U[!MUݙN66(4I{e${Sz6?]Hy(.l/wr"=^aEA8zo^=3D8֍Ac/L3z/Ɏ:@cnT=\ EYz;>yyXIY!@ccaij:vP`ᅒ|Ϋboj/wW5 =؅`63w쳉>uaAwh:ӻ`n<E`>	| 
.oxwph>$E/CX0N=ũ; UGPEr'}'3\{R"jB!Gq'XXC
y]rR3diڡ;l%DO0t0Hҥ;0d$-LՉoN&VAֺocr0σ=BAx7]}%be<lC
&uO|+-Oa)kob$"eX"塔-:ӥq9nX#}E -!>jeUIVy:a\o4X]ә[<'g&!:o(m
(E'|}bf*IsT4G*,*IQ'?Lzym-2~&SSgjY@_g(/1%V!U!k!mIu0m\;2kyx
?cM]#.|J:O(.uKGh^ؗW;^L{,5P`Ʈ;en9_q[ic8+-`8ꯉ~G275STK#!o5&78+d".>J6'I褭-6}ɸ2?~ʙdhaLY[ck+5kkElńLKZ0V<O3ucRlncҙ)/ii}ժq?7$vk$Jm ĄY̬!k[Wmnj}<|3B3"(QR$:[No2Zsu.0&$jSҔ4:CDS5ã0h˘4CwSɪO."mUemBu#U5AC//U~ٸIA_x趖:-9frT碌?fmF u.oH;<2[՜nњ)>z8#ߕlh7y,J^nNl9*A/iv6[G.s'3O҃o84jm6{!Skgddp)?M5*cU4!BD^z"锕Z>8/$O5IB6k2";eyM1M<xw~ %<g\	!%A1.I"(ndRL0m  ra\Edpb6vtIaPa	eق/so Q񆟅!ԩcޥEC୚MH>#>y*ĵO!3#Yi2vs)㊔=$jT=B!|4ɺ~鍞)jkh918gޱ']4WrвeܢaVbTC͍/"5JFAP\)tŞ썧	8@<x"вΝؓ^TˠJVXPƕ{Bq|R8諥ԺMm!|ڮBHYLÒGgOVB¢^̓CD@0_N9r!(TC|W'0.SV !ICfX^eR#>X)̬\i|d_ɞ)YkGMN^@k1`$Z$LbF8]ZGaAGl3 13tѲDƏdB 5tF(rZݍXM'cFK+ 2<AKԦR<na +&1e$A,j]xq<ϣ4D N/M$}ɢZv'jT*6a4G%	ӗPCOʣZU$^8rf'K/Ԙe.%+6H$<\ZR^&XԌreĲn-5B-zuO#uڞkV;)s[7$pVS҇fa,>C*y8׉aZiꞍ\eۂN0Ys놗Wa4p}zC(,uLN[Wua)3A#W0 ƾH|V"J[jbEXq9WHNITID,@jj@{X2U`L4~5o; |p	ܟ˖R_QVtyҫr<bG![2O/&yjeH,oUm|0c60;m/k"aAʾ0Va)30dؤdeX=ܧôvkԣRiυQ+30!.B~Ystr^-J}Cd|޹Qȵ0oZ&˵8ozI=gf^_IYLlQ>:|9{k0՗P<?Qn}P}K(81ǣ2&-j<c	lhG$-IRw :H28zoڅ4Zo|qV{zJ.nM19	KuK81 u"smObKM6
dPb޼򭵲&ieuc$shF3;ЩR*k@؄YeթU312;@iI:b9\ŕc8p$C^|CFTd#:`zLQo<ĐLrJ&[ꎦKY|i(Ӏ`<*^B puAS?*I"8i/Y`e	dd6q2)6C T/@_u2i戦ΐAZ@Fb՚OB#51ܧO+70a/N*1ACըHoظwaִ5$qESkUm%u9~X(3})rpRlLhH63'xt9XS/ fGePk[\MHʠ[\XsZF^@bz>z/_3d8^#PQm8rv	K1vvv{9aXc3k{fxWt3fiS7+UBj1sCZAeo 3,?/*Ps˔jSPRbIDWM;S9[K0 J!0!Ԡ%]5d,&/JwF޷GڷMַC˓3ЦeIQTB4gԹyÅlZftZJ}7>jg6}ɤ,22LmZui*
kɲ1X _xdqǅg(,S`ʑPW9SRA)7<E_׫~Ϟnɀ%m zDչovGC#^
3s<'cH8EhtVl4^:PCnO
8QQpZUU]sdpQA\-&+n"k ^n^kaVAL?WգjB{si5˂Vs=ǖ Rns آPRݨʍgS]j9V?1bZ0̦S7\C#w5 k}ˮVMO}t|T.?:(rh^Y[[o2K-VC8d?۝7-۽U-Y#5qL=Ğ(UYMz\x)qm¤w.o*.F֧ysBr(-Gt7My,T[#r[FC#2n`{LepάRh5.fx&BR/t֝n!dJMY웵r<v.Q8\OȋD1{N|bm5C&xWo-ry4o(>xX"j7#ۃ|]:<y~#E| g{;~`bΖb#,gY^w:ÊFx⨜*b'%4t|2f%7g\ ChxMRhY+o]GX9-#Mۯ8H	 6||!ꪾH6$`ʡQ~iBNjAV$_V)sڷ, %yǘX֐U  L
[I|bSHx0IV 
M?E=Ӥ.9mwgjڢ6=u5xOcp`;=FNg{'QW(xW`8jd hB3a$FNr>$jF812
`]T)sA_#f> %:@=#Cz1vNlPRI?"TTdsEיg~34<AS`Mͧ"y(hM^*bnWB4OwbO	Id5	3D-_o匯_+t"Hk 	dvETJz>:[D^DSh%b.wNs&d=]ZJ>]RK#6#몮ŝ#6B]Ɯ&yCSn<Ea/Y%2Y.	Ej49ξDaO52x(iQyn4:<bCzKD^j]TFbrTLЊK>&/yK1alH	7iZ@^L2f/:_UviNQ8cFe
- 5J~c|\a2=ހ?k	ߏY_Zq"ĻO݈Nr@Ǒ]CrAo〒#)qQ$:(DG#׼ePۭi5F.k5|8/|ZjZjHT3j8?)y61[K¢XGШ?S-tZ:)@jA.::7KeSlj(>M| a%<Et&\6nC>{Eƶ(eəQHFSfѥ;ҙ]F_Y{\Y%/F.dƵQ(q/ʝpV*E蹃Tet{3PX2981Joz>TVhBen46XG"Ҳ~pI;Ń5["{eXO9/fcwAb焃W'aVU+s4AxX}IEa<Gr]nbw/kNVjƴ|l*Q#*y3\0>+̦'3*Y>ɾ-RUQstyotQFse殚lx̲L(ƳMmv&R¹ڍ#f~)^YoUy )㨏w͕OѮ -)LJe$#t
`t<pI:Ͷx<WK_
&W &+kC'Vjz5{:&M+zkbHΐq:r x0mwO'5НKk$:0.<Sv>ښP|:s17hYt#1T="	miLO0RWp׿#!#.WHunv3/>u/>zl @Ae酷ũI<;4Gmq=7ޮ	;vfE|$[8Cҗ$,C$~0O!}kR?:S<wPV#N&u4×LZc~_|r 9vEJ)D^\rltվpUoy3nZ5R'yj\gyOVc`m# H5"ӱ*8yLӇhR;gM{2Z⤋;'Vc}fh]Umģ@U_i(r6tA:1q{9Ւ V3<>C7ዄvmׅe_mEkO<%{g.yW@Qa^X)E4EiOϫl,&[g@Xr-$4,D<vA ̂ie]"a7À!9(̦dT@\L>!d2Fjup?_ԷeL#to.jy?^9;uNjٓ4MbCn1.(FE6Z݄2,搊W(#[Ǎ-{2x.G	l"`ҷ0.'r*7pC{Ś둡({BYIl._kBgEj/፶5X]PKEk"7<PQP69a'e;ot-9w'e>?=^☰竑K #˥*[*nnrW`x<.XOI(yiyD{Zp/#-?VnLk(8q殨rxnW@[`J2iC~?4aF:o₍vB%6(i~1Tњ/)p~zc?'80:h}"I^ʬlm$¥
wC0v6+;`^H1u}193>r||B*vXEDE+kѐfΝE[Q8)܈=l<`Aq#r"i
SO\yyz36拪F""m;z	.r	-\{r	s3B6X騵gKj}o?|sG:KrOܜT&KVL/>)n[J\$%k7o'Psfϙm	lhLU!41z@C:lod\DxdWNǨAؚgp0NhxIg ɳZ;}!8NBFݸa(JRH:77V<7O^YYP]օ]=eY#%XN޲-r`Og1'@Jmh'[{B˝LGqY53Sǧܵ5eȿ8YE^od?	{JQ*Sϛ?6(!a^]rh f䉭EGrt^P"" &VeǞ%c9#Sl\5tO_
_
mVqܰ?EW-h4ֻ]F6Z+.lwvtYm7uo5Õ'r#P#ڑA.
X;zg}޻~pNoޏr?{5vt
i^k%y^T<`[h
⎼XR"SAaI }zXqP1Ţ!a*r`tD(+0GXItXhE`q}yJc,:ai#	|rާ]'9rY۰d~qpɂM_Uk|E$pV+,	1iGݵD.t)pT`+rŧݑU~Ŝy%/EI781,+_衬f%pN2L֩L-s>6[/+<yŏ.]rZM\43dm	Fҩ(I-"$Sjh8)swdMqid B6 M|#4?c9rxqqkZP7bngqzYy0"g_,NAwOoTDr 6x7KyCEpccc֏#*hH+MkË0"6x*RN'{nL;ev37{m)wAhwqfI}eɀY0I2{'~Br66SHS۠2(9T(<#Z7Y!/OOMfmIUb8rc(76ߢ0+w(I)$746isL/?l~ѱIz,f{#Q"`o`*0S}-#ek4FaMvo=#*o~3Z?.j%#I
J9Zn`٫;4-'W  >Zs^ebcsMj5Z..ɪm[TdMg*PIy/ݯf)KI]PܿaZbjQ$(S|oK9HC:4AWM}n',8g7z6vmot.4)7˭.(.}M]^DTO4w_մWz{6Јd[`9|'7)V;W3F.J$8(ķ	ںin&NPDjS/sǿz|`\Znw?*_hYd<FƠ%S΋6NPfq?N	w	ZN1KU 0Tex<pvu.^t@k=ªOV*2ֳދ3x~ݽi#2f,p3vB{ߟLo+ԻGEf>7V;֋C{{;<}o_7NWg)^GMhLׯiҦO7L*Y/{o^WjoӜ$QDO^Mn)yvo6촛vv#-[Xek{zov^g"]ۃK5WF s=;i/'3ԟg,o_DN2QD'2iwW(_7-2e_fŗ9
+,->u]@闅w=_s-XV`hPN9iƿ8/VGx:QT; mZ Ej
#0j:sB9{|Ppe}섂&,ǝm?uV~zNPFPg~(Q$}$ܶyz MN֢,سJ;L}lWwsWo,@?"	=Rm"hiNd.?|Ay'7Hɶ$k	Iq?GGe{vtΎ#geTȋ#ʲ MiY޴`qvx$D<dxTQ[@l75W o"[7[iw_aZ#2-5E"&y8oknR|}f%Ӓ5=yFG{u?Zdll]Uq!!ُd?dKZnɮkptQ;Tst?txy\vUe/MɥzBVh(6նA8>ĉB-7"q2瓙2!Keʼ>ERƂ: 7Cۺq'Wq7oyZ5wr	۟L=pg<	q}H!ֆxOșcXu%F_տM#x6JTZJ]XrN?]Q.:O}d{7ד>^Zy? H'WV댞z2qcG~sk*>^<vqڞ%#r~sQ誒D	\zEӢG8c+|A#7UJ!`ϸٗI] o?qq=BM8HB?2?a0rd((](c(:v&bM?6lfoQQN@ZF>ABӘ4hG1F)ڻV٪^6Lx1i/8&׿Y<L+MuNNctz3=7qa2*	|q2~u{nQ]ao֑9m;O-٘x!|XEL	Lix_nup
H
~]g.Lǘx;v|-{"=ad~zh=v674@ǚnJXWBu:e%4֜"z08"z&=oLo}Nnp$d)CbK4v|n?6wJhjkE<^IцB;mB Y RL'))~MF;;o4y10\u0X&kbO,8㱉Ni4JzYΣvB^;A*ȥEL	hÀ{OA&;oMz potk҈Pn@rhu܉R0<3*h=t_OW +;M	`
$QL>ݠqp<&BΩvn$1j>RTPQkf!V茼Lk##/peE ۍhXbš BgJabJ,?doѣGYnfDy	r=32F[&騚[`cdE#%GOB`R˛0?pLXG~Ue{ܯ>PRP*|]SI*XU
Z,wfzN\ΪҽE{hdCvQݱaiN^ow;{zsC@ڭgcjݐO23hċAׅZ{9$`lw~p ]i])"Jߌ9-icB	}nv{}i7~] 쨶it͎[zwl۽6۰u`N8uSsnwm汵n7zյq=Ұv۲ u [mvn۽Ɔn@ZUe: SSOA:-0ٻ `ѓOPuF  zǆDk^>F(>%hFjFmc۠- gy7.oV݃&PKa@RCo({l[A(wPx#y赀zHQΦht`!atooG@ϝu]o[6i6Ng5w 
v^nCa-|}lAb} zʅk>=$MUwe/.
@?ސOc[?i,F;Qd9zP:z[^5Ce-M=~ܒOF>WӁFoX<yqn=Ͷ-XO5]tFذ-XJWc.,mHF¾憁q?df)(ME-7O:bJ2RtTbyPSyeJGL2io/b@5XjyJsAoE[ठbF>1g{u@_aO|_Դ\Q0°ƹ}M>qg	j,؟[-w?bGԳUp5Gړ:PCֵ/9|4\uweWal4;;|ED
,ưeVۉoUCV59 6}a+JSt7O}Ҩ]ryO3hqkĘ['*Iyx-78uʄW|dv,vINM{qNyF?)M0?H#>|ȟbh镼1|+)ss\IF#ȩH.
mwsU2wg<PW*I%0vE|6aۖ3qlbcA4|ٟry+J]w`ĬWe8w4߭2_K-W@)_Ґ_4Ot+}NHG	i;N	=1KO1wfiĜ̬ҼZW'!he1)( d|M}*]:tt	IV<}vCY-ÛsioDXy+	gCʧMcSYIOx2?pzlZ勇5<?_wdëU6"j$! *H1qtAm5Y>%YYWiGy%u5̫̔1t8L^WZV?p?zqj+
IIH:gA8(dUYa\HS?C_t.0V-aI
1h0sVT6i]"XZ9G!M+AWǋxN=k%̉>@q&np9CjM_.LH{_>F6,_}so6U|8\z3z)((@Jc
Q.4bQ`)iyRe}V./93wXjM%
~S{sO%wlD=Rg`Uޑބ[*)uYD^^*(;Es,a-odYv%Ѿ9coPz~ 73V 73)5TF_NxỊ	"7v'Sd8콼O,n].&a/!-{exR2MoY7ǍwwEx)Rݫr2%Q$q(cIf. HiVYrʡٛ,'5)\*F7o31&%jwD_	 Ʈ˞tgfgbP/U)Wz>qcj2ᎳPj/+,ZPeD֯e)9>s9AUW0 ]=utnRFA2LCfS}
%15)SxCfl&տ~5?~]FmbpR m`BWj3&}HrA,Fk|JI$2ʁZu(/6dn_"?~n)yꥤjnZ++px
-vhf %ӓ;N̖fMW?pй`X`l>ʕY	Ĕ[F5}?毊1,Y#m_g^HH96ͱf*Uk;L->NycYe/ƪIb,aAWv CO÷]i d÷Lrۜ(eE)n"&V8 1hU4]d(% s#gНy~;1?MvpϧNt*R3Yv
Q'!o"96%%r	(1+pD2;v.;w"1eU 
9R3N3VI LGPqc%%.шvh<baϙ㍝ewh{M2D$hq$2,jA׫txy;KZ_S=6?CQp̬7͍,+fŅ
4qU-ZܵSDYv92@BF](VQ>X[5#9|@vgo6aYoVeo*1\DӺ|6]7_JƸBUd=d6UpCN?ừ2BpI{#)f:
`[Lq8D(6>22nT>ėV_p2ynZYe:k\n0\&~CSiy"]6rf*䛑:1;]9QsY|Ag!(t9yhl/J"-2`dݿ<Sr5j|h\55M0SlA;zHMÛlA;a
1'Ѹ+,}X~mʬm9)OaEJ{7p扐Ht|$wR4&**~P _~R89[-Zm1'Vke4M'aX	XhI:7TJI|qi/uҫ8kl2Mܔy(yVaSqqCˌ 3l?Q=G{H@fD_%T#Y=pr3=F@=2yڸ6+BD
LӨY:.m<`:skV7#<?hvWV0oW(EǲŇy9@t2ٱLH.oz4D)tFfB\b$UDBդ?WWP"Q@dW{5B'{1<u@_@Y^zq-XlxeH7Vi%&X8hCmZuᢵ.pٰ?Q9"mn^F7w~l":Э;>,\Ievsw7\B>|=MPEQ:H<~)uȺPp0>s:mlP*B'5WhL\/Z:B/	0 (,'ę9+e̹̏-'#3ZGvl"j29e|$3s*脯,Fsc[HB)6a\\
z6AîK!襨 B]C6uCx5.&LbKVl1^pl߉ΎP) Qߨ>
}$GL1xLF@|c'O~CvJ|Y f:#F'vm䭺+'Z?@]Oc1ݤ5Bem 9#'fQ]Ң^gBXl"Mkr9XVrZhE:S4ArGlxpV*!!pD`M̃1bj4uÖJ`,]-Ͷ]@ b?P F$(,5&k=WkznvOruH t.b?3v꠺fC%U	lJt*IE9"iɠ66{Keuvni	&ԭ3&6WjPc(~:?jأGbgᏎgaH#>:??D$n>!(6TI$~@mw৲9@B{qGd* ͆Cch܏wG_1,`o_P:u_=pgdlې/1L%ȉI66qK	jd˂o=8`J"{e%T.w{>"n',}7/6d|'L9*NΪb~7V_9A(߫ueᤢ$TiPhgbCKQi)R)P[:LWPEg."7Gp䍝)}M/Q+zd%4ΧᆽQ^ń@y9%K`?t2ϢK.]
[W9.eI8KvrBwr^
u͗tr9F
!yIʤK/EY8SX}y$z"^FYd[ȫPݣBQH2+*[gxB+.)kE,*e5KĦKK ==4CoQaT3'<!%0|H{)<֞IE@SJ,ʨOS-cO@3c|9|L̋@'nuEHw..b?lew{gzlsGu5gwڽ6`=/wsr%9\XB#1`oiPq0]a_Du){&ɦ1|(
'0+,f&y\/cg'e"Lik$)F,˙z6k-L> g}W	k|t?"pL=vdDưe?IA$qf_O컔JqdhD$zr_JCLH3g?$ ]'f/",`}	-nB2,%I#K˥F@=		b1~eZrdAIC:IBu$/S70Z-a&G˓rhzx{4c1Le9"JEo+s;"BkuLm_xti+ZѴB/,MfUGS	3NZܼsԱ`O%c^+VÀ΍h};ޅ+S<lT@Lcxd"2nyF;<:(:uP,L剰>8AT*̙W^Ct۴U~/[x=_Zsm㿃ٹn$ߥ3%+xWaHp\unw\+3uZ逊Rbߨu*BXBp$G 1@4 -\<$@%($A5]-6A7v ^ۆNCn71V/z-}x_!w,+Ο
+[߄ <q|7:z#3~{q67j\\dmFЂo~ӆ{
kOC
j*eTFGC5!K	"T	vebߝ>1c"){m:Ot?/^!g(kiNpݞѩ@ǘRբL
a)RմI5VTM7c5ﴚ
ZH	amO8Ҋ32QF>YLі4@c$%pMXQsHo5(N=U]"6[g1/>CkĨ,hT!+ĲK;#ts~W>Me%hpDѨ%,h2RmǲW2oy 8P6p葉0/鄯D(-)1B>eX=5
0~77	nsXs雕	IK$}y^u1gIL+ni;Ɠ"`8 gͬ:Df!!&D}&>.vw_"j=VkPdS+Bǒ43;}yr}X4	z,̔OxrKI4 Td6	!U.uZԢeZ]M\z8!$_xM:\q}"i&C62IۮskO?
I	wYCu_oFH 3_vXuO̹zw	yGc}\լ|z'V̙y ?F45Pnk99 h 