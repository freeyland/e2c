#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8Pd_HRU,nMR=S#jLD+X"9ggck{}5ۯ/Yw  3UMTK\<<<<<<<+ƠjvoCF՛NkmV7?gir8C'prArD;U礁9i[fn6..?vjwFqwqQo`+ٮ;/..~v3J ]\'So~X{'h |tZon)__s~\f{//_aK[^QSfv'n~!;a}o-b1A,YCVuA5pBtN%3'XyNܑ:Qz̍B:$,:sCJ\/qر3/ʏA!cϷx+qgOGv0;۫W1:Jez(zOѪ0p( 28sg$B{`é@39d$	xCٙFV!ׅsᨬ{UJV7ImXǬnwi6ۍNC^wq{:v(|{W:I1߰~e坓x\TR+mmJƐvgg3+hD;Gc4DW_͟+'w`à{/ȼNbY/êTAT)?8=()|/}\):
t|vnv\ϱ'06+[?xgJGf]f}|s|8	nvgcv)L8YxOGC~q>:i8?]>kc>n+'o;8#KJJJTNvFvбSـ<Jvoo6oJHE6٦"9m*X*A4Ӏb2c76ImdMIE6&٤"Bo]ۡ,`W?	@#'D"6pj+O.
}-fҪhWL%,=oEKUK)TjVy՛FuCތi\]Y#1~- 
	sG},X~I~}q^j4c1kM;ߵt"! kxɡ+v8ki*6MlkJ%?VR0ɾɐ%Rw}AĞ~o{ZMMhiD7qwfl{EV}?9׋0nToq̚ANCT&I5o>c&¸,-lX@^tЩrz8=prb~Ӑ	`-9z*`lGҧO.̙Y]sXAr6Ke3
>	^l=DaT sn!}zN_V @`|^|.ɱl9z%lqWoJek;uGNZITR嵲qN4<&Ɯ\(_rz};ԁ9|gIDw<0~S0D(}Xd5>Vw߽'& bТ"Sة'IjĎj̫M!!Q]RQ}Yׂnn;,BrLll Y$2Sf|Op9Iθ/vvw~ܪmկ9 16}
"˂Rp-pOiCWcPGiUuSsR29XmTN^c\ \G 	8z9	~ju_QfO9AC%8WT*Y܍08oǗ/^J@HR"aDduVf+
>Yw"m/9|W{ͧ aq_`H	ORfũm 0֥O`HSeDq3﯏%]_g.+F\cr̊	 s"^~|X	&?H[U-H9_	1Eiƹ^!rfl@	VzI_t}HT:A7$1W?YMNv2+K;pg6ao
wnSYrg򌜢49Yym? '`ƜG\!Fj^bNKԩ	2],
-xPK<fOP$n}]8 lRbdP7kB5C_S$9f1܂qx|X;Ҁ9O;4%!?-=d0PY~Fƨ[b@'p̐]8gw+
lx:̭Kq[֙3~'WV>Z36^x8^$c\NEsaP~U5`sEL,^Y-ٲE)sQ	Mlnt.jr|}A6
[j<gtiNf^?Cy}p%wH7L>R?QNGA/iIK>fQ!w{T4F/msG*,,\"
wS.{^` ,k+81R;՝~/KେL!'ib+EcLUFN=Yz~׋W?vß/&U尵lޫwy?:zTrKX<)-axaUǘ,̉ecȖ\Kóݓ#VBMلBȅs\4ppoºfZ]5j)40XԻmZ]:Yt!LQڱ=3@n9g@㞸@WdbDbmHz%PKvr(fDqu2E҂$&hؐrfWhsEzqx\Y]G畯~W
P9Uю3ǂ#Ͼg%S	4L5eNؑdPkqPA U5jS`{ Cue>dY?m6[)`/:+t{}e~^
۟zb}4<f|#TMC;1	Z̕*|VOs%u -YKȅ!= 1TV"J-D1;ެjQׄ?؋W/-$pI7%M`QHzXXW13sف6>U[ۏ?sC(W]l?7z5r*ZЊ}dQk\G0TZeŇm$4,畂iLys(2O=4OGq
c	rٔ18_)lP qbt$.6C(9@kH'IoEK6 ^ʐsWDW07IVc`@)P/B^1~@׽z~4hUi#Cc5yazm"me˴unhfV*hiEG_HhC+CA؜nS3nݮ5˿-rH5=(I#LmCċ\j	vWgJ3U92xz$mƩ%fٹ%oT3V
)#jέ[LS9u?;?Obj̩P,<uMqqeWOG'$5b	gUyRo	HWd\,uBX 52ZF̾2mt5ÛLI'uwKbErVGƹN*kr<y|D6$8VXCn$k~0")Ŝqʾu`'ubЎFVshA}>zy]Kzf2]w2-zX(}.P̀2("	ƣ"	ɕXlJ-]_"rذ O(0[I_&?	N`=>jʉXwgA
KZ`&_ O|T{v}HQ/Q,H9ȵU87q\,{hYKn{,u&4NkaʷG?pke>$>wj7PMƗp*VjHroodlW8qof[>Ws4Hmjo]n$39mP7ؑ1<!ж4U'ӊf!(ٱIk]Ӵ.+C*~WwS'k,4>=o=|?8?х}fi$K?;xAdPEw4"`Y GLKi餢]ݐ!~!''Wd1xDZ>6vh>hCV_1 *xWϟy?ғ;+}LVLj Ed!Y,OpeXRf.Hۉole`fΊrRm7ce"V.cWR1-"cR9rhl_
Ȣ,7  ,]9LY(p#,;uo.,$p~3yJT[2۔9lv(mti5 /i1Z&Mr
x
3"ddhɄ#DggԪJ:Eic#ԕ`EA]zF	Bjٯ?dUVIROiIYvJt릨s-pcȷss+y~ftIsw*NM}eYKqF2#9q2>n2tHTYnx*>'Ek-ڀu PQ8tjyl\C7I@fiaa?6+qG?͔L쭘nC$c4,fTN6(#GQ:^IOxn$@4"#I1~_{d"tДU)TI=R^(wr7ȯ@qf-N>אjP`Q[N+5?"f%5M,p[O-$kyT*\2$xFw&OVRT3%)ݵ҆_93:`KdVTNЈzRT RR.y)(dj`$ic%3GtH.8fP)Ы,+#LцqB9熆0iEo$4'b'HltEM19m;C۬SIv#7>d6wp_`OҖL99	Z՜P+=!v% O|L8.H(#F'dm4ʉeJfK\@ t/|Ixʔ4B 
J5A.*FM"@`Juة΂h{ [Pk@Z~nAfjy+Zb?g#So&aZظ	h~XWܡc%3inͶ 2c7T>G>W7~U]V8#akFCfda真znf,]Kiv4W]awlI"͙xM-VE+q*u9N#!)#EGLpȻQ 댶fؙ}II*A87n	qP\gH41tiR3J{28:!%*<7P{8T(C@Λ5E5D{8,%auɅ'L0'NqԟFԧ9pzBHFq9q|}cu=*8%0	uT<4LBа >mo &g\)}c4ݤhO=ru<6NHqኸc6*KN#x,mnX9MbZ9d"|cLJILeIUݼf^
pG3`!Wg}@^b-ﰨOØ@*I
pOz<CA[)![VC*hX-a9.XƖ2Ayd3
JrvG81F0	yrD9~$c1r;JVY	i(zyð'S:ɏ\H1fLr?ff]4_Pɥ70b3?Jo	i7/1Ӽu ;.(f(S9lH4_R9צd}a<;S{	@S@yBjz!\$ӥQ]
եQ]JEY]zxAQ?uSd&FGQ4~E"}Mި4EPA0tVed-lKے[tva,z+zn:-oZ)o.ooϲYCV!k_S5	|M_$5	|M_$535|"k:dYA\E{8i]=#H݌6n|׉Z]3k'׈kmh4
IyIjq9Kw9I]=}dic%-5K[zI{LG{ǵIY!<4q%U-Jd
:GeM'ngehŇlB5r.3Ұ5Wj{Yi3.|9넔1گJY_EU=!khLAyW:eU˲r\А/A{V)GILTіLE"OiU'r%ƕ'%(֓2K_͖W31J˻wye}6=|3xR<+&T@9&#zI|a/kUG]qy%|-bCU2<Ha垦¨a792L3Ww7	~X2D1So0<@T%PK"^!\e܊psOt}Q}!:þSUvoI*|#Mvɖ*R 3H"ZL;S]k!	eqz=݈=1P9ĀQ22 GvӚʼᴖtܓUC2a,jH#xSWFJuOTia7  
6$H^e܈,2z{ Jsϱ"5E7!$mèy#RQUC0z衾o@<tRWW7z2#4C>2pvD'^>F\7S^iW݌a!UF'_yěWw"e[H*x/s~w3[Z#I\$ţ Oۍ_$}2"hqWuF?􏥑FϮ:cԼe3Rq}>2k|S#!Ei-qqnǊɜCWjh]a5[{aX:nHN);]/ry` d^O+M7Z4 d6.Ŋ%[u7Lő(e=$JD(Mvld?/`}V^+ӆtq-Ux
tԚwEO"^>uGl̯UˉUMyސT|q9(##;\Aִϧ?$IN^tTJ{)yٲt?P:QvE HQ`E@ZFӡ,ȹ%#KNbcbdr=WQ)jT
ys4YfhXZ[ !zqY!r>{4<H(,ğ+m^ۋƦXj^fPt[\m*+j`.K4ײBF"_(A&6K1ߴBHYsCYnLOj4ɡ^ :Hb2FSYI#ȷx~@-K}ýׯn*gd.-ghf3d
ޭV]lt2~$|JʅoRCBWE0NYnd7C7I{)e_7W^4N+2bC=~26"NYN!ĉW 0g}MW[n蹮g.dy|IjJI%^wg7lNSάqo=YFM$:eLW*;Q:*K%f7x3Jqln4_uu<"u+?oYGs_BgSQSW}T'_ PR0Q.P:?<PE<Y3+ŎFM';v@ws~:>~[GpUU@6;ę1Z9@]|ܵc"i+/+QTݝra$;ɝnX⛢H	x}
e62MuqK;#`()Ǒ"}e&dGH Ur23y8*n,T	ܠ)V-03TQs`83q_oêE \lod'lI"ٓq.G7rHI#lq~ST[yǸa哟JZ66S8pSĶYa7.#s+^~h:t}tٜ0c%qf7iqќYL)3ЛO>bݷ72Zx?%OSYDEC7BOSJ]r^hYmM-5R8InւU^RJnmٜy<ܐLMfdC1s# F4}2Oc\ho}3jO&+M $
NYߒm4<б_//8/{*^tgۇo^BL9&v^0?fΉW!EsǉQ|W!/Ȏh1+R29wER{PY3̍}0ʧSV%ǋ;/rfK%W;?3 t~=ýUN;.7r^=4KӕkFӉԅUwi<Jݪ<K˅"GNh>	,2
.
hX>^U3g4A^F/nc;As7[	w(E!d:*<raw{1j;E#ݹt(T;OiT2d(Bpcp< b;#ێqut²˿*Zc]2^^Y')\>8ub_峨G
7(CmH_$kKW$-EAghch-ٕWd%tNy(evtKălEc[KoNHs	f]`{9LgN~/֮['-oלր>YOݞ{}-4GyelK@a;e]`0Lѳ>TL
GSQeH _Bߋ~vzJKdzMղr$P\0b #J-ChOC)GN}ƎX[ϴ#NFlSrǳGX7JA>d+'/%T$sCD&ϒiQk xgb$*Q)t?\SW2H[cne{PGu'*(kL)W89-C8yzY'm<.#ɟH2y,gĸGQT$__g.+F2EoOJJģe!ATg#M*,cҙW]?&VK(UV/vv<"έbtN~
ktX2
@LFzׂj7\6f[jA"t6ɉ4$#tH7㈛":J~j/rAIC:OVdBSLh;;L\M(ź*m.Y4Tx 9BW7)+ϮXLrWLʯT+8fT>2>UԳm[7!MZq%f5,ѾxI^O~j.$Ir08=#MDƆ,p~` WY/Iv6B'Bq}*+{V<>
=rxy_s0|L9U|#;c6,@iB\
Zx"Z*e>%8/"xH5Iׂk2:;y~sySgSmG֯v7KQb&aB+!23*;%nSL@8@Wΐ#6r#:qaP&}c
˔SOa@
BJ	"6%wRzGSawI
<| V&NvHE/;O}Ƞ/	g4;K`@vv`/y[i>MՃFϔ8մI3jٓv4SrвcF1KT'`	]y'""jWr'ilց<]khiIML$EP%+(= 	DTRbݦ6@>mWy@YL.bOVB¢ȿY͂C8HA0EI8r.(TClW0.RVsN!qCs^e`RcXYԬ8\I$0^IZYkiwCk1$ZLb8]ZǁAV6 1St8Բp ?2|<WǤ'w6]1W9-LPMD,
sD4rCWffb *ϊL<<IT
6G/d$<  yA/7rF.)z7,ܲ#Y[_]OގğT*^9a@2lh"aJ\a|ǱY4:CKd+WWjx|E"0WӼJߕafi3\sÕ.R2WWs9KMTYl5oĻڢ&eS~3NsR~'<`T_<Ghhgh?^gzO*M&3q	4k}.Rj 祇.O3r]c`ҥ7ɛ8qYcr<,v:a&Ȳ{穐o/N1S4Q\R[盾0kP2pDrJJ(Ҡg1-eDS񬹬G4cyyۑf69-?-o[2WYd7BtK2O'YjEH,goÃ2k6NdL̪뎹qxw/̭%r3J5)6)$j:9k/>{I'ôv:w	i߁Q)30!.BvYstr^͛J}C`~޹Uȍź0o-w3-Ze7.eY,Wi-׷&LcP׋ my='TrmuLIOXvB*[1IKa	76N+v᝙Vp+{~8>tcn:m=&Wĉz׿䦮znx3F]2aJ̛^uAN0w!cgC3b"*qf:U2C^(W3tRJ#FcGH# i9Bg6~YL WdHKo9l4KE=j''frl4$C31VRw4%qfq٦Tt7l[mEt HjISN$Qdicǃ%Jɤ~Z(;Urv7[IyC#V$$ZD#Je5OL#51ܧOgo^aX_ݝ? #5f,mcJa50W0|ͱq-R*[*kkH=.D -e,Aג+b-VUģQkh&.AI
P2!J]* 3A͎{K\M퐊 .k̅9<ʡD1P]c$E}DYd+/p[.RA'ˆ 7*.ڝk13<n	"􋈎xF'UlJQvu"vߐbSilk3	L?sv
G29x䔔Xu</DLNVpGxɇF~oLeh[E64	/J$yI{yl^I/N@%Gx#'TIȥB-/iӭk+>Wڄ|hֺRae˩$꒴3(`)g$~4c󽒈C<#}eG>(΂)k]3;Oci0>|?³nxлBd_e%,vJU󎛿 pG͇!gfQ]<)~p̋:p1̭6lhX{79q@MiQbz蠃+=.2op6Zؔ5[-?f 9vZs姶rgTx	ͭNL>[͹[Qrs@PdK'ρ|fBUus+7P

/[Ĉi2L`%0cVA,k/^338=PPjJ|_wR)QvgupUY؉jڔku]3S,%VVm4GSDʡ|0o#/ۇm^yI9J6g?aS9*sňܑ1׈L4C[2uznݐW
Ą"_ꅖk[XVLDƾY+En4Gy>&L@LW0:܄YvڝScד1wj`kmnXbe8ˇm2aXF$Bg!\Wg?Rɗo
Asz^U AyKlq*6axR{v 0fFxz(*]%%4tU{<xsfv<Jq5μ4IeF>7fE~CX;i4F^)qb '*Q.z<.d}`R81f&	7y[_}zvChߪR`r poX>11:`&+!IAr k$s~%&"%ǹIuQhYt-豘&ti3O>sWoVĞwl+L{ⒷYt*;ܓ?yĨbGX;/?&OoI+$m@#1rJȓnbQ1m|U!.(B:E~|>U
uC%A$./m%;y rOĂ^
s*u	~D4$߁1ɽfixz4y=OM)yN"Qxњ`?sdmXhcj.f*湱?u{^?2
ToDxe=>@>H,AH|x7n12qs-fK\ʝgLzкl؛8lGV[w@V:xCo0'еRuol.k$}5*)2MQ0fI0%bӬx"yehCX7ԹV(x陂/u23{uRQɗ3IB+JFU<hDG"%$i{Z00
=|W,	Eovkt(* (rR6xBHTa6t~?F5Fnġ1Ew~XXL#R#R%	-G\:H*tPޏfGyh5i5F.k5l/Xaj5$JE*d:5Rm<[ZNa|DNchA9-N`vMq dj%4B5 $ZL> ۰^"~
V	p.	!9wFּUAc2HLLxf+y+BExѡ)^ʙ`veOB/K#|UZR(8厹Afl+OV
DwzpF*fR:9)f(lfEu=Wf+xn27jJq5x,r-iiz8Йo.o+ӑȵP.X J<*0&aQy/ɻU5qXyEut.Fo\cZ~)T.\,d)]ŃA*sꖈFק{97ADY(92sW@FH<2fYxNXBm:FRtƹډáf~^ЃYoU )Ew­OѮ-	LJE$!t
`toA:m;!=ybL HVvd-gR 4fi["?GϢh`<{:iOVRROq)춘+lcE);")<~~9מ_/ay_ơy8}p<		 y2HFOW|l>dD8'FU~wϜjԍΦxd3@=PPQzG'Gqj45K1c={ǅ3MǰѮdi[\o=I7+nBL)bqеolԡKz{FaFgl{>%.MዓP{(ԏLiG:z|RK*-M	+>٣;xa%"j/UJz9tAњ<^㉴ROU6;S!
ڌ'C #EDϹqBsvκ}G_qK7vN:ozДڈGx.Pꃃltc<<u^%,_igx|o3	ڌ><5yJ_wy]
41*`\y祍A"Z <f>F1la	PҰ_e&\0FvvT Qq	0NJ׽]g;P}wXݑ1$a$e5xe:Sz e491I۵M\<Qːm41eX0!ɯ01QGv=5;ە&hlg;AIBt?t.[*8knF
|j
iv%S :'~)^JRڪbѺwN/JPr_,CA.tCDdYJG53

bfˏnAz
c.( cS# FKwU6ThfsS˓z^Lx!õ1~	'mps/#)?FnLk(8q殨rdvk@c1JRiCv?4fF:o\vB%6(i~95^@><|#}OmqZa&ѸH1(,E60Y؈kK?0`СlVwPy7`j}1>7rlsnr5T	9g<2V׹-!]ٜ;"AKQ0΃܈=l,`oA{QBri;хSO\YYz36拪F""m;	.2	-\r	s3B6X騵gKj}or?|sG:rܜT&KVL/+|:RܶhKT*pa'a/cfB[%hw27ĳOW5-'7ĳ5Nr?!K4\u@Vԧ}{2acÒaP=0$',ē~ gvBp6Z;YvP4&;5unnLy>md'栺s~i;=eMzʲG&Ke[`I4L#(NVEV6kiN-wREŉfϬU{qq!tARh*+yr
=lL=kتN@|%sjiA,)O1+'m-2=Q 1޴L,k0r8/ f㒡~PbPhj)d?,{iEWVی~;5ZW\lwjv]kZ6J@9	!X}INN
'R˰:V궺]VswqO!?Cnuz~wqe ǕW.G~;5nV[y^_Yym3t#!Kl~]Eb?E;ҔT [y9bV1̟8=FH-O/:`mRpU\$7fC2GS%FBz=x}@ڕav 	.ܐKF rZ+dm/!'EDZ`٫լ̑jL$r,JQ|s^+:
pLg嗩\H	I;ZrN@qo%D1=UUＤQ_+cuc˕h\LM⧋->|-tZw6;sDMӶ)54JnF3&z1 !~p'tʂTitraQ~kP7˕4r1^29i}߾YYݴ,+5~X1r}6L!Ri9QߎQ()@~nxӠAWvSǌiJ@N{?Ņۋ[+L-}-ς)Lr!<:A8/)ߩ	DaBoϤs 
xhrfoJ/RN%pVZSEy&"ǂMz}A.$N/:6ɣNR*бL#TP}l:	tqZ[@H6`gNF	֏Z	R֩2{;%p:zdbG+/Vjg V,o4=KlR.0[rmNN"$Ws_íOR䖒-c;3ARbj茜SQ$0|lK9Bg.4̓AW}n',8c:&wv֮ߏǿ6{*67oZڶts9!Q=}̯~{[VR^2x
e| C#q0<of<Zq47J/'O+H:[fRN>݉6+"?skqyof.v	B@nv]\1-!d
}}psթlh|b1?l)B)DBо{
jܕ0Η[,jtRZeJ=aD"WVdg/!={8v{Gd>B/z<|w:8U>Af^?f=ǃ;ow_{{,~yr_^	OKWE'	^tMhΧLׯiӛ{7ӯT*Y{o_=8xShҲo{d^J>C=~7n~}^$%ڕZRMSOOD1Jvo/=*)i|I#JYY'zZ^w'W?d$ߜ*T%-]$ʃB&<`E%u27Gnuy發R+v00'k&_\`wr39~>Z'mVBlu.)~H%A&s><@gTcno>cά=8TH7qwsF?Frߩ6^PgvS*a8}(dYzMFټTI8Ji}RhZn{?+_=b],ʟݽ"ڱ6ԥZt"qU\r?]~ZeLڎቷwRᱲ<ry(,FeNH
%Iaeaܨ=)7tf\"BG<X@f#xH}	}k'*F7کUb~"j4g{JIwWJOK&L?rk$N9g^(Yl]]70TMvSsЅT#u~4ƴd70[v}*\΋\rQ/+Vb7jV@DJ7N1hEdvEk{2o΄hGHXUGՆnVqNo7.Ytj=Kg:xIs}Կ. ~4:6{f@kZ(e^ք-V&	j3VPf*h1B\*býJz/'\f㿎>RnɃgwz˰ן<^JOWcz2v"[^sk$>En4r&ԞT%#r^u.P*D	\tAӢǌ#+lAC'.UJ `ϸ[ؗ%o?qwB(?2??e0^*(:r}'&lzgQ9QuOAZ8F>G~$!=1h[[	*ڻؚ^6L'5G	/(Ǚ׿Z<*-uqO"yS=kIn2	~q<zUsnzaoUoU9V.?86`dc5D

fUsSNѨUh`zV&&f޷١ռ6:'-`ۨYDqjIV@f4F}Vo6h4J*i;cJ;Et`p$EtZuloL;#s$	rPwl ff]LMzDC(b%@B&!U, ܕq)ET&aɝ7Elnm<Ki:r5SQgu/jjl|qrEҝaK3?퍀b"*.L	h:{OA&3 z p_$Ӥ!s3rR:h9c+ͥ`xgT,{"j // @'V<w
eEH@8}E9#ӅSHcQ|/(((M:ŭSFF n4;	#AҰ:)!.Ε2Ĕz#scX~He!'ޚGtsY֬By	2=32Z]$騚Y`8#E#%COB`R˛'(a~螳B,XJD'WzT8xvIcK(>Wrg)_LAyU{%Аq^^eU9ZJimv*ޮ46pS7ꛕZcNM&?5&C/ޚk7*'AXe#/v+ tu54\(}v3Z;gD}	%J!J#جV5*vׂAY4F]d:Y%Jh4Vҭu}]HͪoTYj4+Mٮk]Y6fZհ*2x*-$ը !{OmvOЂr VJw;B(ڭ>674hpse5Zi5M]- gy6MX0MHځꥆ2PYi66A(wPx-~4:HQκܨ`!QnG@ϭmwFVl7:Vc7ەfsЪC;X]iBa|}l@b} mBc6!IFvF~т~lc@MLm#Uul urw5*MG<u /n
Xа.40ِOZ>WxeՂF4o5X<蹻YGn6v*٬DZ66	!zݨzKJ4ֆVb	9SW7_7'l2EUmᬮZ<OIPj.JP<|>\iITF"mPA(==_FA-#+i.>(tKp]4{
[s>LIOk`:2ZPl)WNt4ɱr9Mż8?)d%{.5llk\M Ǒe:Puŋ]M>Wz~svx,it"2[	JX]Ҿ1)9>X_ʙ#y@u3<x(9\t"^6x:cs&&=?]$S'C~=ϕ|h1|+)sWs\qF#ȩHmwsM02vk<'WW"Hs0v.<-lX1,%8?pz 1?dJg`W8w8魯oMOD5.>>Tʪ_2ϘnLҷt渓 cVC{`VN͊5xu VWV>?2ØwﯓP'AxWI7$2;ǟdFD~hũN k?`0l;1
BL74G;NǖQxQ>CW"3]	>RS	y`WAq#owi]/|us>2+gVeNGxZעzэz-UTy*Ռai9Dc&h)'Lc,ǡ[Ej>pb(̈tuܿBn8;ܳ\4:m!LN= S8TY/e2݋$
+"2#yfރJ~z&o'KoY/%08K\i@ Y:JeES:}2*\e;7
YJJ?Օ|z.&&SPN`aſ/Uյ7ǀDqFA*oƐ C
1Oz%!@(KD el&iЙ07rj3[mi_;#(m|߇[/)Hٚ{*'KgI4݊	w<c;rd0O<.Ia/!-{mx2Mګ%X;wEx)b"%Q'$11cIfF HiVYrV	,u)$F7oR-jwE_	 GÞҌhh'|P/%)zz>qg2s@cj/-ZseX֯'e5++9=?qiC__sDvWᑷ&I4	sB O0.*<ץ؝%
5w[T)M\jLZPJqƤ2I.QxqO1?30VJ0{^+9e%hIu3cXKI?5	T߲*W"$Zl(NAR'g-+ɚ,H]o}R@3K6i==S)7* $k?z_c0piZ;z[O0L݀;xlgDP޻3gdZ#/^:G=vG.t V+58]->=%L vE>ʦa $VRɉCp]#N'X c hȠٗNT)':G)>ڃnzׄ[|>3VT:!o9@D|ɱ.)#N@_Q#=p؅&Ot.#0jxYJτ*y(UqFY\rQ7/ޚF4-F1kYYHan2vG\<w4sC
=&[A"8	^>Ƹ%:1UxJ Aͥ"	AGnI$Pm~FBYoÝ7[5X͋W̊rui[r	6蹛W:T&sS0&P2l&!h)'/VU.h@'7[K3BS(
T ̪`Iutsx04*{|%*Cy%PC	L
ViBpIR(?"XMMR -<t
$vȈ-dx~Hl)E<6ED]pTN}#%WbL(X6l%f֝D'y#%hc24d)s) <@*Qb"LG
kcTǰ4{}W٧XY5U]ST$ 3ŦN$<zĸK_~r߆_'aIx
7R#߉LW3D#%WWiuÃdSF-Qy|O
9|rG6o\6~RQl4*ٮHL@d\;p@ֹ:UJINK|-[@,w&䈊3bME}|/5wXΰMD]x{cc]{t8PIß8N/mfNhw2?x7sx3YTC{ei.)0M2\	++<	GCyvJp#ܹ^
u/T}K삪;PK< q>9Ie~Ry;;ˇ(ݸg2)ꌂ3]ǅL3.ckq.áE3Bp[^#6k׬=Grpf<U=ؽױx}4+:{y&4JӿMp,DڴAf3ܳa~,o1V/s:]+={x{;7bE0j{*23#owƽwΝX޶sZ9T4Y@]^
 ~/DnsE֥ѹTi/lmV69Q=vzK1{ꥹ4`"a d1XF3YsZVˢs	2,\LFRgN*/"XJՐesʀNlIgFS=T2	_S4!iF7$^j}v	\mݔBKQ5F3lj\L.&$3H+#f`S7:Sm~ d'au_xHZsq;Xr+̵V'	5m2:6kT&oՍH>zMA+L.m	lN_=1*mnC@ł`kIumZB+0)l#Y,JOgY
GoV_8`Y(2s/.S#WI(@^ os̆ݰϧnK-j4A޵z6>zm1YVQp˞xUHb}Oٙ:XVF6?Q'Sa~[h+ʖ -[)(YRghG\݇hrMJdyςq36+r`%O@qS {Xl=|4,͇):=WUE'S%	>пbz;t[gh-2C%,)  Zx)O=v3Jghrsl㔌
3:WrBjyjm[CQ~ERp;u۹`b^;#oG<772x|&L:+b~'R_M9k(KUtEIҠP5mR0sU::7Ou.HA\D<o,/h}[S/5\TJhŝO{8	+W~s~U7W(]K>Wdi0+jLwj\	
Wd|5FQyE+\\@sW`&STr[fEr. }eqf$\
EI ɬqJt*0W^gm֣ˉF5XT¦䫱mfNzzdi:o~afvpJ^`]gSy5-H̧<ՕPY3oRWo'/nE
LY?jĹn۝ŅQ~x?bdÞ=/y+R*ۭb~׌joZ]CzӸwrsu9\-	l98gX퐷j4p!!/ZT`@z٭(!lM.9YN+	.wY(cD2y2gUC	F˲'qEo$EĜ?:|&N4RʍVbf}i[)(r$dG[dL	% :rg_JLL2?h;b?%=Qm|WFd֩I#\XXfK iH
k+tp,869:Fb7FIP''FR3bqU4]&^J݄͘)^KgU$TINx%nqL/!i?yh B>"Ll(>u:3:Q`-8Q,iKJ#A6y+b/0ԕLܐs1gW%g^+ya`gnqNw.ȥ=֨6V@O"xx}e蒅qytXXK?a&Ө?gm*TRUH~*Te)Bv^m-"SΏ|~lw=OM]3ֿ "1pxͼv?[	λcK{I AVV& ?V	zK䥖C_IĐ2XOeVldXfћ4D+(G\*1FHr@!IJ1Ņ\:v&?b3qC]y[d4J;0 cjZ\3yNP9_
/^_&_N-lox95mR㴸.jc1m4q_	PqrDE7,o"Q~Cѩ,ؾ	~icykŨ xT"	2~B#EJjU	S Qpe.Lz8@:G>3`*T*)>#2QAKYV`PNg/4@?do~ARiZLyB-ֲhhD̓(eJrK^j_satJQC#
M8إk󳎕_AeGAN?6=*m~70ȱcOy
)u3@QO|GoyH  MM?3mN֜aemhRE^Ul:HIۡ&KfF bLߊYyCgr3y76kZ#G\PPR'?-F4s.wy]L$:BR+CbQu Д R
4J[UBEy7Aƞ6_	>@4Ls`.4ɓV'?omYid?Gd[Lxjq|\kۻ֚l+j/Y/։%s{^Kgl,@ŷa?Wu; v 