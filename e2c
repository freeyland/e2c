#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8PdJH*IUqZ&5Y`&H	dHR,c震}س1ۇ>GBnJL\n?|٫ZZ~m֛W\hVUmj֨k}aG('wC $;9PhG;l(|IVjԠFnH`o5[5fV=70hU\}wqQ%	..ߋk{'ޠ |I_kM_;VkCp}͋:KI 7{_Љ~_;v/'5ukn3^wr=d{'2~c&Ȁ]*nܫnΉ4X2ǿdA|Kى7pS7=yq"7<wÈg^DiG1.;vE	|v}( pB^Wb.+_⿝MUA&CqY?Enbƭ~P2t dvqI@I\q|9>1@kC3h 	}YŀfnDE9Vߐ=pKNUj5ޤ6_;1mZk45ZvMVwqg<w8|x>{_:Q	ߨai齛Ęlc*|)A6׫%xcHh{LG
&1NA+x
s;z21|$Fe2Hѽ%9GI{kww 1q`߮Ukkj\wq=|@?Nt`֯l3Bt;.k&jY.+Uz#b>n0c,q,b~r{>q~0|@V|DՖNۣ
vuq:GZvJMV*gS'^:aOӶ!O^mۢM۠u[;} a-*EEHjlWdS1u*Nԡ\C؋MnPcY kP*AE6ƬAmViKDan_V3H"85~锖WGriDhNXiYIYQwm?/?Sk	KAۤ

AT~&gŶJ=՟5pyY˛qS3L+Z 뚣y8."2=D!sﳝ? V0ү>Iϻ/Kf?B6f)pG򻖮\B$$s/9rcvNCwVu~Cw=ϤUئ	Vo}MXrG;1O,(cf{{v߼;촫U5Wov<<|Q!ۭ{WZwf	/<?iä3U5"4ɩLi6&;}[Lͻ"qY,=cx[8뀼ht6Aڢyhji^znG,ܿ8@4b.XK :qs'fv xWӑ|l!nq	T6Y8C^N0egU*Q+Q]w^TV0nw_ZI{qd}(>i׮Doc\/WQ8sr!|ɡEw0t.3c2.qy'1$a^_TaPv-j }$E@M@%@gEE	R٧& SOz9L36ݑXTBBһF=ǂnfnןز@Ql$"MK9:rfgqw_nmnoYݬ]s VlbCD R4+ZQ/n`
fdVrh1R-,T t*AprR,yzuWQf9AC%8T*Y܍0o/^J@X2"aDtuVfK
>]w"m'9z_pͧ0`q_`HEO7Rf ũm 0֥`HSeDqH2,{⣸%]]e{jek!Gr9aTWe|,Yc7v?Ŭb\2TM$΂Iiƹ^!rfl@	VzI_t}HoT:Eӧi!ap}*({yZo|[L	=g&m|?}EEL+\uTPğ_8]gͩ"Uͫ?l_iB1n):^y䪭bE)意tHp+%ҭPqЂ|c"`FgC6'_jb"!`7Sd>y4p8/Qun%Ǿ~(r3B7D2 :rzcF];sSo2+0>,fSmYg \Yj) xMx`q;Kͅ!BUaԀ!s3deYP6׷ϓ
xTN@eQnbktst|VYGW$d]E%t615.-'sOz}w)FoU[:ÕH쏇"20ˈG:%/ŘE9{KQAt`q?,rY(M@J%YV|9rv7Z~/KL!'kbIc\UF}Y=z~˭?tKßۭ/&U岕b{QG=+%k,̰IWLުcLCyXfDPK1dKYINEMlDȅ{\8tqoºfRY6J)940XؿmZ]:݁Yt]!LQv|3@ng@x@WddDmHv%PKvr(fDqu4E҂$Fhؐrfgj4S"?WQo^}sPWE;&)L%$ӄ2E֔Y"ۡĒKCS@QT BLOMcg9Lni{)]$5m^;\	Od.{wG?lQE
P5`2,kL$'Llj1WZY>^Zʦց|fpJ{W,"w{@0`N`/)eC8RE[ދb>YLۢ%	/	~%ȕ_[YQl/%pI4%M`QHzXXW13s69U[ۏxzɍծ]Rz69MZЊ}tQk\:8@0TLZeŇm$8*iLys,(2}4OwI
crٔ18_)lP䆰 qbp$.1C(@ukيNI'IgIKiv BeH+"+I(10 US`YWFK!WWWW)vgSqguVan8ZCb(D"`M^H[2mگJ<zD1ZZ&Њ6PuP n.%6gF2$ԺD[hi
nR5SJSЦd.;"n&?e,*簾ZݕB	^~eif2q{~,.iqjIw~.E[}ǔչBb(zTA;p痩[Lue_8~7I:e^"a_*OVB#lUXH+PFW+2ZWfCj(]GfSIx]w{n{AWqj_ D=
k? mEE͟"kHj0go@Ib.-%usܶ`v^9,ҿFF9~םL"m-eKJDl3 l[%q@$xT$9 &!~FT/, ב#ޮE˟u@oxtpX@I3fU)(Ey椰f"e+s5Û }DG1D? $"rrTJZrV*O~㨹Y|ʙD,*x+cM#Y^QW·*G?p+e>$9tj7PN)VjHroohxE-9eb[s35Kڷ.EQy'P7ؑ1<!ж4UӒfx(ݱj]Ӵ.+G*~Wc7o,4>=n;|=8?씜si$*K??BxAdPEo0 `Y GLKiV{OQIT^D+P2J+|B-Ez\;44ޡ+t~o2 *xߛ7/^E?*ғ;+}LVLf Ed!yHpeD擕2f.H۩olef`ΊrRm7e<V!cWR1M-I ': ys$}! nܤ/`ʱ`e2F90dX9&/(d٩}KܯtYg!;bW,R2iܦfô3GnϪ9xiЎъ^2i:)L|1L:׏Vmt$Ů"Q*11(L	$VPg^QT_{gà4ĮOYIYvFt릨s
-tc8ss+y~fpI{w*NM}6=(e=nňs },eP?2ݾķ4UrNrZmP9q8tjy \}7IAfiށr˸Mʌ&VLFGb1tt*'Aɣ(.'|a7`EvxKzd"tДUTi)=2^e(wr7ȯ@qf-I=אjP`Q[N+5?"f5M,p[Oͳ$kqT*\2$xw&_VRT3)ݵ҆_9s:`KdVTOЈz2T RR.y(dj`igc)7GtH.<9fPGRWY<WNg.<äq&lr$LFg3ռ_z	犉 W$5HEoNږ>I\;٘wYp=~~>KH[25攛f &jUsBR<0VG^#eROr\X^Vxj('&C+).arR#B2Q>]BK'IR*SՂ(D(-$5P2)M0Ӊj|JNߟ;[;폆f z#;l@5çjQC~5;=?>L<le [jgj]E(MIs7pk	o9$QzQ4r^)UuZ"EEy1s~zʹRѳx8v%[ʷML^U~ݟ=ߖ!&4g5XioVqaiH=aCލy_g5ΜsHLR	꘤Ƿt#LmNz}ҧAKQT31pޑ)Qэ%Y:BY%M-P@rޔ\o(5?'Jދ~`dK/<a_<q8f#*G:5JIވ-hG檖ä QX		eRBÂ1Hz{IMȎX$Ң<yUڄV8u"Ņ+OP,;G "n,4iͧ7洣a,1)MhZR 1ޗ92'V!tCx)-΀0_Iayâ"<cOO n$*;U RnyEl)ZP@h3Sa`,`[J	A8F*(a?\$LpF"rk 13bot;䓈9(Yen'@xƑ^ :>
L	$?*rQ"ԛM'3LIvM|KgFcvߎS^n^gcy)B"JAv<Lφ!prIB|_)S`N5% X 	JQjvAOO4O]&IO-fBGQ5
A(V6K5(~HhbU&VABXdFIvCjXtCg<%Cm`[2ܖ˰[ucXktӖ7-yӔ7yS75yc.~C|Jd
Y )_JJ*J*
૶EV"UdIV: nrҤZrG7Fqܭ'wk];k&w^X~ zR^=)P/*$%&I$</$Y=j]~#K뎜ȴ,pnYbOڳ`:;NdHʲю襉#.jLDsT8h{2=f+/1Ny+_vrGiV|Dxߏ-T#2S-:_?E	x]9O1ɗͱN:M̮t5^4Q61OuX^,YНw%3&^wYVkRI?t2(	)ÒC
1ڒ(B)^1rX2$۸7	DII.-dLf˫ؙze]F˻>S><CW啐H&n$>0x58H7G\1ߡ*\&axdm	rOSLèa32L3Ww7	~X2Dޗ	So0<@&T仵
KronERع'[*ي
Fa)*;$^mmryfV;dKJ)v$I-!]SW)q݊lې8ҞnDRbx9RPUswiMI\pZh:I*- 	0GY5FHyhꩫH#'0xYsyyh$ronD9==aPD!ǛG6aTN_	*- =mlP7 l[M:]M=ݑ{Jff8?	LhJ/B
ڛ[c)DPpqn0*/<+û[-zO$xv<WހQ`;o{I\$ț O'W]?wi0eTEѶnR?FN>Qr?Fh'JPp{˼M](D)IĹ+&w^eTjt;łla|{?:	hx1之hƣY=7kӀ.к$v?+lId43%GM*-"xg6s.>K pjzLғ7voo[luOnW5ZAC7 1tQlϦ7!h*Cc9X439qS/0Oyetd=4ƣ4i֋J	w{;/+Me<H;AC'4uYo0p[2veKkE=qIQMMHMCXɚcJum2	9uT-)HsAT$N}Oi"}[suMe@e7Z^?(cI?S8kIH1;(]M%9+\$(a4c\V4̀|d&b2`3;{2q.nrzytf:H|Lfݬnք&G͗P6/)-n=)F|=`o0Kj2ӛ 

q΅XB̭o0S3jT+}ch2tu ɁnzhNgԧT}良mywzf4圊9s@
J%<4A߀._4O)ݼ6`M\Fǐ/i:k2S7QNFUSQ`ޠ-!2rSGf/y%t6e+z?:Qay"%
 /P5aK+qC4*JT]u&lc;?O<mV'|dH?ƓgY&^ PG 'ع$^C<W>ADQmww&˅vzko:'%ds1z07Mai.ȏxO:L,vBM\>pXV}d*<\u0k	_eY">XfW@V,g03TQsT28	3I_oê+^mnHVtj7hɐI躗K8uFqZ4ɊָНT[y=xQœJZ66WػpSǏ*Ķn\HGV6F9%`CBgAñhԊoV9aRf7c|*ĺo_od>)~JąLTKhv	RK
- 02aaC* :ՋuTaTQž$Y'PTrAqdmf̫h"<p:;O0ÝL'*$/@_g4X:nc@R(ؔlcNQqQ6CUO/;[[o^B\w9FN]a??1DM.ybcf8LCboOȎfh1-Vr9w𗓲e+ 3`gG['an `O@Jo^D{Jw2g j{v w h\^FZ1xgՋsݰnܰ;Tgfn>)fՋnA`.fFb635,(u,!3]!MGT]\p[6pR1Z9aOw-8Lxwp'Q_< 7#g`"HFlh|<zݏ%ߘ'sEVs=d~!QP\gT*:' b
5ap
@D=w?9OԩsMH1u N%,itN*' Ng*C=+ϓdFݗs90V # j/-Xjw>~ĘnEErz/t}C)˷[:@<
<i[[6٫fC~8z&Lo8&0_fo<u0f5EڌK	E? ~<{-4xeLY'|j,f1F^*IЛY9mjyrԼy& K	/CZO)z_ԔٿZV!7&H2BC|+`*^k!g 賡D1Vs,
͓jv6%w}xΏ|JOx	eӕ,"rY8 +h#VkMFDsam5?a.CDU	>=vVzYŀ?2͗?S@QltOӴ	َu1rA鑌w*GVIeQ|rWWZ}ZHUV.&KRR)/kI1d:S7FaTfvhսRjUpp&GL@,> ,R-%g~1zfN^5zj [.0fA"u6	DTu.0&?ISDG	}T(i2ΓՃ(7ڋΙl-Ffn8d]HVX*,M(
ų+c&-)f娀E@&<k@(OVy	lE_洰S"1c2=b2hlǈvS䅱6.zK25\q4;#D.sr.?Wf=xy_s0lLЍF?	sչvP<ƾ5SY҄
aA6.D)T}Jq^43u$>-kwGNx:":~^lStʣ!9ˣaLuAP1_Z!^Z2ldMwO`2)&܉fj ._M}*u"&AY^)./,W<}*(%vL`إ܉_X!@MqcާE⭚mH#*1=^+ą'AscS_M#i2v=7C=ÀjT=BXXٚx)jj91pgg-<WrвeYcz҉OTwF#`	\Y"'#e+j
2gm{y`Gm@W^aez&quS<˞Q "N*j)bTA	 ,&aI[gt+Qaѽ7ܬ!dpBB9Ah)+ӎy+{!؎TwrL2LeɰȃįAfV4R0_ɺYktJ|@ki$Z$LbF8]ZaQ6 13t:5ղeq'! y?c@pTK&E&"N
F@5t}ݗjkj *Óϊ3U<>{IT
6G/d$!6=<2jضҶ8Egb"9,fHuVWӷ='UWAX[r]0}%E);ΣabIf~uOW$"^	s1ͫ]IV<m65IdN'goqu5줼LlKV@gN=[j>:[fBW<G=W+wR[zMM'^5XkJSL*cxt͚?ntxeyt,BiǴgatd6O\غB;	
1Y*SL'*M٦/Lwsԯ Je4(YLKy*ndwRl.+=Ϙ*udjv$1Md/eKß?w$VGUdY;݂̓unv3Ky⚎Ӣ3y.җcfyG!2sk	ܜ ?1sCƀM
NfZ˭^.Ws0jY^ owaTt8LL_)9+nWn÷wnú0ri.6[ܤwaV獅Kt97nDfJGS}DE. ([	շCSB)ljҢ3;**VvDҒ$EXMpp࠭,g <]x򦪕0mggeiDˉBT߶T=[rSi=7m=Ǚdi.^@%͋AK QQ[։7α;1Ok#8[4 BfH묙J`f-\h`Y-'U:	pW^*zfȾGtJhQd_b|&9AR&[ꎦ ,n4iy0]z~  bq^u7bVR۩A$v4ʗ,m`xѲv2s28TTO!egWPRNfc:4xHsD#t닄D@(??}`YXI(@ydVb2۹fx__y]_0aY7T*inRy5ƵHg+o!A6eg_Kjb?pϘGx׬$GM]jgSdBC9{#8GC* SA͎&AV͛!M^޷@|'C3Pg6W/qF[6BpL eC0$bN5xq{)ZjB[f&HDOG<Ëx)6vyu-D0!!R2ӎc3)L]vы
G2dTXu#</NLNVx)Ao.Le.m2hRI泒H{d6-K|KeϹD[._<[תWE~TkP)'eєuыI,gj֪KNoiDs8#y`q`5\Dly.x=EFqL9Xzpo9~ZO[9=@u1uó|'NX
e+'NT;n<56Gt
Px(Du1<ק?Y1+v=gƠ;0ڰq3bzrcSŕI7z=蠃ή$0HPî~֐[?hEbSlVo\dsbk-*㗪\P[X-N+|	Pݷ0Z)-,g`,UjyUխ.xB5+*l3#x4rU8~OX	Svbw{죊=q%Y^]]1K-\FuP2ҊΛNU}'YSUqL=Ğ.XY}yN)r-äxo*.F٧Cz監sBr$(=<oQYHGd5ݒg톼}pθRh5.fFx&&BR/X'bGh%&,Z<vi8bO~ȋD1~N~Aby5F&xkoOyÎ=_dߩM5I>nv4Ї%b{9p50_qNN]4DD_;Dx(dwgowO ْT0,)`.vYtQ8UfJJhAmd(=̄.yjE[hFmo̊|{s8vlgin2~)% dOQ.z,.d}`R8(BUf	7}[j|xRVf>3oY)0o9 8J+6,yƘXV  L
5ۄ@t~%<q0g%ǙIuQhit8-q2MfqW|ᮦ3RW=˿^:	S:=#oT6p'Q	MɎ|w~_Y|@M|ߒVHִ&:Fb䔈'3Hb=!.(:C~|>U
\#%A$./m%;x rĂ^S6{<<|m*i8wksrkFMބϰsqSCCSἿHl^o&Kb+C!';_Ąss&D-߽7r7+t7"H cvETJz>:[Dg7^DR?%b.wNS&d=h]ZJ>F]RK}6~USq.HÿcJpa=)7VI"ȰFQR,-5acd_NS"V[0͋ښ+@_6uC[aI/!=UVvn4Ak]T4AbrTLЊ+>&y+1!lH	7iZ@^L|ge=|XLS©ߌ3ѡhnF70V&/L:Q['rs11u;g)[nڍL,g
t5t!	(:(Ih9gq@RB~48r͛G-L6r~\]~M Eh5Ī+k5_Q!Q*R'שᨗ/lbt"-	{`\&
pb;@~CiD$,4pCk. kS/Iϧatai +.b[lj2eS6䃙Ӝ*hlR9ɝ4oZo1:4k]c̮U\etUbi/BKf\g	7ȍmqJ(NH%@
XFg;ҔS~]ð4'?
lTzU)n
R#"-WP"#<29O
<xn0Gc04>Kj~%V{A&J(z_z4Y׼ݪ蚓8բ::}#Z1-[?JԈJ*.
i',d)]ŃA*sꖈFק){97ADi(92sWMAFH<2fYxՎXզ6VTbh~T^\P Rq/ހL{_t,Sqq7*=Aջgh׀G&Q%I$#t
`toN:Ͷ<1K?L HW{Nd-gR4i*d͞7\XsDrpӑic߇nc<{:zOVRRO'q)쎘mwֹt@
G?`1uFW<GxXIb^ N0\ <`@}';Qy)Qb`f	;"3R91P4)85B]r~1chW2´-wћ7!q$V9Pz%I5ЁF(	[y35tCGȡi=LԏLyYG:z|RK&-M	+g>9;dQ"j/UJr 9I:Zy}`?Z'v_0yz>H+eaQ=oZ|:o3	jL;x2 I\^=^Ddz:1QŜ'4kAjj/c<%Nq'e9ټ20CSj#e(JC^[yb5aJ_$k3.3Z,tJ7);GM]gw\Lk*$ 
+J,.J߇D&x|Z5js}6[j a?'ʦ!LJyͽ`LV;4!Ea6='`	!1*o: {]gﰲ-cIP|svIVkqݑEt@V˞jrWc>x;[ʰ`C*_acLlo{7jLd3wP	p?9]?UN|C 7W8]Z>VevVH+I=>N,尐ikQa(Kwb/~gRњ%w2RB7MDNIq[<]?eov߄9w'e>?=^☯
 #˥**nnrW`fd0z)XOI(xBkcSNjk35/>$1l`]^2ˑ^t[eRG\mm,(ɔD$fЄ}꼍s5Fj7	4裤]pЙ#Ғ\xPΛMF.<.>LqbPXl${Q+J.~(`C<(nU{!Ԃbxnh}pnr5T	9g"2W-!]ٜ;"AQ8,܈=l4`oAq"ri
SO\yiz36拪F""m;	.r	-\r	3B6X騵Kj}럧f'|PnN*bԥNby+%>)n[&hIKT*pa'a'gfB[%hw27ĳO9W5-##7ĳnr?!K4\GVԧ]g4a}ÂaP=("v=WOX<v'$>h8wC/F&(iKMDwTh")ܜX7<{dNTg@uYvz(ʚeqL`9y˶<q<<P *6oiN-w2EL>+Y= >N1B
(,|'%L@W\xV٘zYGJ ҜXSuC5ۨ'Ol-r=Q 1ٴL,78+ f㒡~PjPhj?zQ=s֙jj1mZo_qZծZVŪV}xP IфcA:Hvr2юwr)/co5k͵5ZRB:fvl5j}ŕ $=Rc f?~nW? p{	Zc}/᧶yoʥ[ZJK
*XԱ#MCE0py#aEC+΂ cn,Ԯ.R7]EK~m$-=<$y4Eb$d]^97e%8.6o37".UjM>¹jnV4CBLڬn1&Ee
yE*}0_nx9%%$m7_iIQQ-~|r5 0Zp~F}-O֙,skꯖdjZ5?=flɹsh7tzːѮV	$=K#|:'LᜧPrg0.ܾ5Չـ7#N`p7$㳥ǋ[W__.^-}t/vWK^1*)Hﷶ2( )uM{Rv_EÒ4@&yheuK7ȉN܍Odi 'õp7CΗ򿲋:vC-8k]\}Ĥ0Ad,$mS?M8EsH@+*IA#V}ΰp3gSW"JJe{OO啛4`vF`<J$9ia*70~GY>-2	Neq/&➳ԷlJ7.?rwޑ7$SE*cN;Ku?4<(OV\,2&i&_ZV=KlRndMT)6&PH/ݵf)bKIKps/|KvnoGkC2~r[E)SW}w*l2Ȉ?w \ϱ2tdCk3cc&$+'_S?ۭj?kkVڪЊS؜lB9pvִnn2r}J3a?oZ5vm0	t\"B#N?NnaxL{u7::/'1~ںin&~hDjkSǿwf|`}zj6[0ƽw'DOuFcdZ2A:8>qj8C>]o6ՙ>p&pHQ*ci_icTjޕ0[4߬3?jeJaF@dWˎz~CY#2fOP_ N7g=ݧ"V3nӛVo$_zq}( ynOw;ýWnGxҪv/?GM1꧃?Po$h|F@>%`?ysO6՟v|sp_}}E0dRr?|PˎT%;{:@{ev캒wokNj%tZv5TXek~z_'\<kʻ~^҈`oj_?&ӮOO(g2?}[$2~4t&F孉+{T`י2gN->u]@7=_S@DۨWk
<:Hn֚:_x AR8=B{b= V8+wBoM4yo6N?h|a]mDPg~[/a$}$YzPNTH8Ji}RhZwog:5`F3wsx.O^Pt	=R-zhi*Ndd.?|Ei-2*{cbՏ|Xٝx<|AA#2#}i0شZ0nԁśK:tU3.!#T, }g  >5UQo#N[ެw? sFd=jjcDMғFJߧ%uk*xZzjU'j~'׌R-oXMvSڹ4	G]Ts|C؋b
fV]F5ˮs9/rͺWEXY׋Ma?t|H,Jo,Z,q2瓙2seʼ9[ a)Wu6/f?;PC:F}-]m5]\gpE8c< OB\dD	?ZɛcYmyj5YiUPf*h1B\*R;t=K)&Y_Sn?Λß2K)Sr%x:4ؑcSzwZ/OigFɈS:J$Q)]xwQ	#oFḝZ)_PߍzGRwJTֵ)P2RЋ$z({}GKX:¬g.70hܧ4fڣOҮw
zED^0M$ٚ@<vO0 L	MV1t n_8pO OUyq0̽rU?Poogwz0虇Vm6ON
8Hp7mepGFYAh_4 <adcD}

FMcSNMQo9^o1ZcLoM+EO'_ZݞjuV"6ݮڴg=h͙uH(	4۬jթi%4]9Z]RDGZDYc[_oƴצo64k#!S$$kk5fJhԁȧc}}9F5굵5(V\@V=^Wha d
R9?.t靑a!̹#{:͍2	5[GNn:|TYECg001D>|IzyE;>˥gYF@16"lL	4^[ߝ^ccaC'343alpn[P?Mw#Z}rOE-HJNSA8	pLj&EoQ 8{l!TF#7Wu'RT08K0:Bŭ{czF ^<=	@Ӱ: B\](I(Zǰ>#O5G
Y+dabXλf*&d$$iLGԚH8 ()9R~V
_,=CX}B[R*?s7_%v'C%5%KB(>XBU㿒;Krg%[.<_wJMzl6FsѶjZˮ<6jcvU&?U&#/ޚ֋*fm#ޭ tuU6\(}z3/D}	%jX[pvs|l QYmjMZ͵Vְnjk Y6 pnʧښh" ͆fU޲q=RjvU u [Ѱ-V]vn5ЪEUY&TSj7@fC@<F} ]kڰkklcc'A7֛VaW^7Vul٨54\bah 64Y Z
kxCنݨoPNjЮ5P^mBZ['܋'k4ְ6UuXof۪mF׬C;Xe7:>ˇVh>֡{>v
Bc6 IF]MzA?kބ~laQGL7[U5֨k=խuX3ZV xjC^ak`F]>ժ_^DF	SԪб@y!FѨmdnf:'Rdv
P۵:,%*+msi';h-Fc:ѯo翺a`*ge8YMQggy>*0]֔Y}^Fٹ4{$sPz~ȿj4ZF6\[}zQ,8-(:h~)(f{ț3>Ik`z2ZP;ܔS7~1~rp\R1/.2lyX>;d/m8ҞULB*xϱԗclf?5--o KZf< W˫c$f=ŪyJ9t;.طJq}G8spQyL@|Y1Lgs&&8]&S%C~=v1JM)sWs\IF#gȩH
mwsE02zs<PW*LIS!a|YaK"|]لbxaaKLBqAbfȱ4WphY]߭0K+\||U/#weH1@ݘo(!q')A4"ld~6k+4-/KO$<cG}N}4]BңeO_aݐfg&`[`a4L'_K373a&1АL$}n'xgi8a6v#~oy&al~tMH2I; 
%pt)]D>mԇe!`BFA.嫙aބjEyUfx/;5-
\RK
IIH:gA8\R_XH&?#_t.0V-aI
1h0vWT6i]".XZ.9G!#N+AWǋ+xN=%̉>BAӆnp9CRY\v/H{/|02"C=l=X|m&q¹fRP:o[Q
0NeT\i:8!SxJː:S]])ϗĄc
	l:J7p
1;HTZ^gOx񼯡B3^J	"
$RHIZ46t&\ȿvvڗsgJowfvV1`RG&љw|d]<؎0254%)"2%%zzoPJi[;Քk%Q27N/E0{=aAS֘$3W $4`,9+A̪SLd{y]8yW@Ǳ4#ZZɰTKI޻wg.6Q&qjL<CQeEksl6p!մǏYY	AM
2&P˞gVM(HQy(P\bw8dVVoRV'S498
]60k	C)}U$FabzEO#ĵ?'L$Xy4T,2/;t䱤fbiծUDI9Q(; NO *3[V5]z~	Ce`fl:(zff%\5S* $k?:_c0tqj
;z[K0f;xlgTP3Ż#?Y:$͛G;t^rZԂ &G"Ge0ȪɇգLrۜ(eE"&9 3h%<]Pc(% s#Py~;?pvpgNt&Zj4Y
Q'!-"9$%r	(1/pD22<qz.p"	eArfZR|A K	P%Oe3*(KJZ,f[ш[>af	k4*)l[;if΀pH$s+HDGA"׀V؉w5n^&%B5fnWae7/w_3+.!yn)'ڠn^"P͚c̑j0@ɰLO2<^[[kȦWmoz|)w;o7XoօfFQq Մ%۲Y=@ nUd+KE@Q0tY C&0mr҄VP(wדʚb531@ދ Kq(HPb##*|kNb(b >,F^(%r)ezME'a+1?A?H$K%=%L!q RB
8TX.N[aecV{U}ʮqz]*kb3E'=jia{Lb%N
˟Ew`ٿ!RHw*Us?iIFC%i=DpUUV ݔQ ?br躟瓉qx>S9Kb.g?'Qt4
޲{a,XL@dL;p@ֹ:UJINK|-;yXz	'	LS *&wCPD6:L?b96!3uѓ^8xO$O`RunP@M%`P;u0rQՆ k86YM<ld	3
[DS?O7fwEHiiZ0_YљC8;̫23aʛNjTywX~M|,+Z|OÙN&;[9^>Df}=I)rOg:.hf8|.c+I.9EۧBp[^#6k׬;Gw<U9ؽZԱx=O_tx@_<Mei%&X8hCmZu3Epٰ?w2V/s<]+=W{x%{;7bC*0=*s3%owƽwΝX޶sZ%T4y@]^
 ~/DnsE֥Vh/|mV>9Q3tZ}bJ3iE4< Ȧb"gE360?d.<X8ΜjT^D!LْόO{d*gh Co!Iu$)(W\kft\2ePOe3 %'Ol|
OY	B`F~p#iU9zd.]go7;}+̵Vӯ'	5ŝo03:6kT&oՍH
.zMA+L.k	lN_=12mn;}@ł`IumZB+1)l#Y<R{gYGZK}$[Tu:g̠8{0pL&_%1܎Qs{	:-0.;;/AC`^јe zW [gJ@9/;IT5YG` `´2p$<BEKRQqdmo2MAfGqpBrsɊ?1+l$=U|,Ɂe\??M!XJ!''c?аx"S\\\<!7P4lNNuJ];w Ns[C!}eJ5yR ƽ	R%g> g1]!40-b63:WrBjyjm[}QdzIF~htz^0p	K/ƝLwH2>
ʜ@'z1&5壘Hq$TiPljCq*RwyP蛥:LWPYg."7vXp䍾)}Pkd%4Χᆽ19	r+W~s~U7GW(]:>Wdi8+jHwj^	
Whx5FQyE+\\@sWp*SL
[fEz. {ean$B
EI ɬqJl*0W]gmVˑF5XTʦ䫉mfFzzdio~aèfNxJ^`]gSy5-HRܧ"ՕPY3oRWo'/nE'&/QǴUthjvKt_(F?|w[02a\8<U|?V1?koyvުjm]wrM&ps8Zv]щ1Y08rqJ!o땸7BBQD7l?9ۤon5xd;Y$d@bIfiTɜ5{Mq')F,yĹ6Hh-L>sW9|t?!;#N48R+fjf}i6)(r$dd̆	%N:r_JLѽL3g?$ h'f?%}Qm|\WFd֩IH#Z툵XTfK iH
kmDiz9q969:F7FIP''zݮ	l>Q
.yfnr
*Q4`VZP7k8"BnTLm_F`t
V [2&3:Q`-8Q,YJ#Awem@y+b68>"5ji?,@P%%jK"7$%Q&N8( >ifxCRrLߦBjEvV,!kW >B󋺁}km%,"~˴VvKVϰ]o@A>`e|!-Syҋ%NDIg}Ze<Yv0hNt˦Xw|ښ]ܼ5PE+?8'zo%,<!59E @VV&7 VJ-)C@ܧܡ+1d 6H2CowvYDe+(Ǩ1jm4] v q$+%.Ju9V얗VdP h`;Zw)Y1	 ԇ[Z2NT9r#p><^%ybid/<I55㴹>ZYDWǞ5ǸI/)]Pq
DC}AYܽG-	Y]c/#ScYkx\|~`Fͤ Ia-z8A{kFX+K'):hJ Lk~(sa@$Ys&9my XA4LA6ddMK(F9xPhG#%qZHY~ү9K"B $_J-Xb3r-<(J*:PKR]գ XeQ7hP%R}Mf*r.OI|BrR$_T'6_yD  MNķ>ۜ9=ÔgmHR:D^?SGM~ڨTݜVw=!*<BoUYBКS/_MNЯgiE6=ޫALInE@-%(}|l6f[b}犙>?yP*hDpH2I/{&;EBK(|J.<XEB֋B+-|!PdʇNV+k-dv2zqxeHgٕ*i_s<h?%*xUEWMĒ:#oV[mhC~ z 