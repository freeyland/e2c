#!/bin/bash

declare -r e2c_version="0.2.17"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.e2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                #######################################
                #######################################
                #######################################
                #######################################
                #######################################
                #######################################
                #########         #####         #######
                #######    ####(  ###    ####    ######
                #######    #########    #####    ######
                ########       #####   **      .#######
                ///////////       //        ///////////
                ///////////////    /    ///////////////
                ///////  .////    ///    .////  ///////
                ///////          /////          *//////
                ///////////////////////////////////////
                ///////////////////////////////////////
                ///////////////////////////////////////
                ///////////////////////////////////////
                ///////////////////////////////////////
    '

    echo -e "\033[1;33m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80 and 443 availability check....................................  "
    e2c_loading

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
        fi
    fi
    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 3650 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.e2c/log
    e2c_load_project_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 +] v(دï&Rf݋dn6)nUI22˙Yhәy3=g3gy5kK&"pI Y	[L  ~>okn>65ZviwZVo4ךͿcόIz1r?JA)pD;$I2<x:}ED~X`o7(#֥_w#{wQ5?w'a?0<<o5:k}E$>_@n=yւ_|(eo[k_%4 1k._K~-Z"/>~Nkits]kwb"AS&؀}oj~گ~ψ5X3/`QzK_`?b'~	҄%~|	;KO LR>;yC Kh4z.ë\h2x6bȗg:aW[oݥm i?%"y,Q ׄ9|
9PA8 FI
t`n'cR] {5Vk4xn_|i4b?,oӽw7;a_ogRyr_bLb.|(AU6xb}l|v3g0&n:Lxq}{>Cu 2|`8Bq8
+_)g__6ZWhKNc-F8<FGF@5iUֻƷI?80ݎ`ڍ&0Y7`i4X')`x G|D5ߧ߉"vatl[tfUnR^QCFCEAv F(!vdg1M$0M$0M Shw-jl0kf-"-"y1	5ۥ,dpGG6[OT#D?cWY^%zZ9fe-gMvmd=^VjX*D9\ɚ'V'!k>CksXϛq]5\KX늓9|Eg IΠ'.)S)bcoz?&T/8O%;1[?'irӄ,*)(qu<g{ȳ4O8S{wzcJ!gpƉ6X[)<=X@Gry>ե(]QCj,V(AłQ$L1cV#/U>}
`ܗ~z
2 w*U{%6IMl{Ȝy` j!_1P{Bd+W+r8;VVewug=28﫟ꏺ+-SגՕc?!sn!7 <ػ5O|sGDrgy8%H#mݕvPD*2SDCB
<ha' qV'g&p쥧֦qppj0A ڡ?-klJG$.[z˟4|kG`U#T3!6IT;I?=!/o^F'5VO@bbY;<X"pȭGhbYׄQ[/_nع:4JT.+
)0ʢw#h?Mv"eJe1rj8|F$˴*X.ي$/>y{
]8ew7$	{K&cM`'n HUE6P XV6ʤ)/9*:HҊuu.!kT׬z=Aժҙ	DWU|$K>ǔU@%1K_	cӺJI-f;"5u5B\⼙ ecw^y%4&6/fxfV^xO(mfARbo, 榈{, ;(e͙͢?lv߼0~9zR
<\EY}%e/[)-P6e>m%3-&`Ĝ	Ơq|^8 t\a(dkbm4C_S$9%Jx^|ˠ @<yܮh|œ0|? *%؍V	()D^H̄^xJnE48b֯*ժLp;Ω?,/W:C|
10d8&Rl1nvh ᢐLABL!K`s+I_OMyYJ/${y"h͐s:8PYVsOz~vgq|֛wL1-w%ߐNֲw:m	I#fM9P><*h={0B}- F oRz$#I/ƾBZu~a'oM%dކ8!47;-1V)GS*2Q1x2	G5CϷ^͞Cg9|I`l%=yrg{MosM_)l`4\lt4(5zEfȷE[J$O
XT94CgZ|Z'[dQ6keU
_MVhejAW+6m/myox̈[9q |vMF@{3O.1XY9b;WVcP\Vg?~('js8eXAMATf	5cK?LCEUH	0=^,L}O$떦5>@VSl1C̋O&t~v$?gh?M;)ĉZ,*,s1neSn|fqzW<.w @4d^.i"Tіw{7^h[ԡ5aB_wBH}F>5ښ$$Şj|.<\X1IpŁ7;[ۏ	 g]z.{4m.5u^&Ns<ꝶb`+<	ܵ_kUk1V0Y+)&:tb &)8YׄQP|ouF>н%#?a$m8#0Ze2a%<}&i4.,D8zL02)*_
_

_
^fԝMA⇽Fya,_F!le);%vM=jNXYo|eL1F^W61p_n$ė3\7Iu|7nWH3ݔ~%f@2؀1&Ŵpt$$B*)꾖XHXi4⭤j.[Ԓvn!K~#n|˦UpP1Yu2έ	63UZOIWĠX4cªeqȡ W4}lL!I#6`С8YH8is/F
LGy~;GQ^bAsى4\{U]%M~c1_xu?KeoQۺ`u'ah +Z\f2.%e]4W݂g-u`E-&&RNՕi/ʎ`ױ˺.բOUo8pv*_;ܪp3W rX;;'w//AHR|&@}L^H\+X~XIjja-w4W.NjnUiJeï-bu?OKjJRs-AJU/8VTWƕxtFVȺ̱/.0e[ȏGkmq0[s588y-2ye̹%on$
319mMoA`0eB=Bjq4hשNKF[{D#e+8I|SثlI߽_LgQ3	_rCb03eC陥	2eeUG[nMCZneQ{VF[AX*CX $D9t$4UЪ)BbT{KT>?Fjvsa~}&p9gpb=	MH:?LQ2K'KIR_\&0ϴU:)(~(LvIE~i$IOGр>Yi![8E}$ܚ\TSM?؇u}Έ= t4,e|PũI?4wnW`FƏ[)j~`{9C?ρn΢di۠/PiB(>, IS/-CeG5@;n8OmgaW
0ӈ	XBMnޭ;-EnMtOȑ8g\ K3b5F6n؀0сO30xx*6y)+<NV)/FqvMQAAb\њ3-mgIi<1"-#O1/b=AY
@(<Q|6duP<DOa
&2wB2/žOUfvc 8_TBM_Ҟ-η<(<\w(ܧ\Ei4:G$!Mcrs']dkl]\P$~[hšLKNf#S<y\%1kѲ6TӲRy)5c=`},Ob$xHZeZ@QϠVA|,b-`|aԄN[ot6rوhZQ΋PEyMoR{/ُL~eקc0J7@|hp}<z}ҹl2ul.ԏQ@(HpK
Hsoun5
etoKμww+y+ߝm<5*+po*P, xMrKKkjTj3r{U	iN3t/%_sK0r	a +wbPjw`hS4LM̼@,tqf;袗XXCra+SFz̯qXN-BuYUʋ)AzMRv7P~j!8ҵ[n}uaT<bmdWG?¥EJq#HQ	/A¯Zj0e0JDIpU"E=|	CX	7^'L=xM|bJ?)Ɍ5*p'Rkϩ*_Ab,xe+xX!@8m* 'aF}ݿó$2yFԾF-kbeklGсC+RX#	Q&7	S#Hk$Xj>{eyG()Yea&Px&~:G!9J-if	~ MY7J.¾hiOt{=Ɇ8O;y?Qy+
"L
J)Phb&1aUcrgG٨]TxSd4w<Rp >???A

($DX`0"_h^.Gfu
 MBa.f:Eɨ`h*Ћ4ݖ,!0?ώlOB@!V@\Vt}/-䗦Ґ_7kYD!5
|i^%u|]"_%u|]"_#_]YD!5
|9ѷF3(ۺuշRߚU
^Sk64f(RWY,,}+ɲ&zkoq2pG #+=1cxF!{c)SQ8mBsՒ(RAםI<4q W^a{:n Pt><y'GZe$#=&{]Y^!Vĕ;\N,ȝuI1}ע']!(6	k3L/Q<wz;2\ӧ!` =T"HK`b=H_5:rX'LRl\/)~6D,@W&zr}ije*w\d=6Toz/z*#LEr`qs"ai{mXaU(=8_VxpZ&p|?ʽFL2Lbdf.-Ϯ5,T27
)n=}v-1PK.OnĸRٹg[J_mE_)u26V;lKJ-
EteZ`1e)&,-N/_bc{Ti	3`+ٴf$.O9,,AT`y.݄=eX#gg1yO-݄BҺ	K,'b12X#}B݄=˒b=P%c+?̓wI'qY|t;r3Ti#c' AkAY۰芫F{1+-U\yRj_XHq!Oo=ٍXDgLEle7`NN}}wĞt,	/~"[y1ȳU/\!7j1ƶeM o^^Ghw}v^_*-\4=y O	2=~x2;A2qi
,\,C9t1A'fg$8yF8S?Kg>Kt2MDy-Ζe]&Q,<_t*˫(xHvɼl9ci4xu^Z҆tMurM}k9`־-z83[as<V`kyv8
G005Lcjyd?|gyܙb-iK-7fE}[Yt0IdcY>{o@a`q5ZEden@}E<m!x3w3Z)jem66Ŋp+3{K2s[',w}^+Ζ93b+/ZzΡOJϚg9)5فd/(;rۘU<͚CO34L/FR@jӚ;O+`9J֙ekmLLkeyj~kS3;NoMQJUaX+@ϯ	7_/頝J|hn	wty9&Wbuν`򸚹+՞ͷ<r\&A{hcݰ:M`Z@t喞EHBr\V7[WyrYByl}_F7G"4kܥ10xѽCsM)<a~AQf5Fϻ@EZCN-#Ua83`FteL	4:d.G²SXZm<9n`ԡJg˫s>G䩵Y4ׯiTJYqS/΂kgP#{e%_~텁k(}l&͡;Ŏ|Xܥ4ҭnsjZԊTa6Rq0\>&/r*Ki)xWNݼ)βFnG5L{RPG,h*`w*uplnJ6G#GeqOz~t[;We~c/IΣxP(zk_=D=ɨv5ka~84L~yO)f4ki*죓B@b9wV}*³E8pc)R^t'JW[K{[-۽?5
uov_%5 ?ԇ71lC4䐺 !w_8ѳj~=+Edlǁ^	|/.dÎxywx4Ѽ}<H^Ű S8t]]uOew %x?ܬPge?W|!AЮqF5ރYgSU3i(軱?\j?G)Fk^Q$#@aHF`H@TCx]lbāY:..,W/0\?	|W[?غ|X_F.˗QQ1M(D#,ix`֠Xevò'De e26/C9Kb_˷;O2O
t2mm~/Ci=C &^haEfNX]N:X]s{[,d+'̢cGxkm+sDeX9T\ts0L_ TB?1AY}Q1)L|_(TLz*nC5ٚ2a"}I`:` ?np2O ;ƙZhGn-5ofm-bTũOt\7'j^pl(yV糆.*y=L_%CFg:5_卜MniKM4魊vYj\{#k~d56t`U}Ul;N6YW~z$Ԍ`r7TR`gAZ<鱺V5kAj</nn:<*|mL:VtI:ժӕ--~~o<d;e"x*VǓn&LRYćfF=j'lZ	f >%%Uebf^W#|1hqG6dl|@483="xd^adM!S2ۺi˶T
<NYUYBEs/'jrqqVb3~]Z1(kwFQmF`e&-yhй<ι.Uii/sVSݹ8z)[₲=+mSkm8?2(5\q8PG>GCU<gS!t~_Ɇp|B'E)#2,8(cYNYtcT"6»SKxRxѼ<`/&9}$ЦކB\Xj.T)xw|3y 	7!5Ac1.M	0SH[3*}/eCK0 E#
ÁlI(s͠Q	`GofH12.EA:U/Ze2_ۅ%'sS|\"FK\b#%A](=@=^sOr`?6ܬAmu,$'\qǭ?)Ʒb9'MX'ħ^ ;?&U<
*TRWCq]1/ְ-A󵖡w5ܵ\ϨneX-B*YaB9&1E0b3f:js!Dv)`孙=:n2Wl&!$sa+vqXv($1CTCs]nuί2\\@q+6589~	W1kh5 J ŀm(kQBb'8]:GqA0#FHyL&g:bb{L^yR~(z*[Z,v;Bsc{da=+tRt,`[<!anl%V-)YlEy(QCAy`ȳ$)zS3Ӹe1G6CAmȘ]8&'%^duf>C"ȩr** Nui*Rj.fV`jd٘d|I8rʝ{mêrW%~..GY.)_<]9XC1Gj`buF,
5ᔇYRAO3}{F&&6*坤ianN]UQ2P->3tq3]iQNyq .XLYrFkFAiZgi3:N!5j5w4ҵ9$3S߲8^grӫe7/#BnaI#В׮%Xe00[i]>J8)&TJBVy":Eo\cAhk$S}ᅋ ~)Pqm`߽O0;k.u־s`!K&6]Qf=yM"Q~}ƙV~~/LwKL˙n ="g_Uùm0l90.R6]Y(sӶ̕5MO.`n['fȝ3:|-;f/q#bq.>;Azvc~l |68&Dܴ+MTx׃n6].֫eSooM;7aSܴX[[¤waVY[o6ܖv!_YLl^TD뗻n#}ڈ ŷ]wfNB	6;AD6uRcyXۓ2e7܇-e?Rh)WTZ,C7vH'ЙMo9ݪ7cq)wcD/ڎ®1JtP[^4Nrv[9)2;=<̩+׳ѩU~gwY% ~񪕜EgQ Od
yg1An_ʳ\T8~q(w36mY	qs4}f$醷0͓ieT{xD	*Zr+
QJU/y'kЛ!~>b%F!:H!xx
s<1FOOH9<վeSJۛ5R5H{腳MM#V#qEo%!ojgA5+9ae3zcab욗/)X,oN_s%LͳӰ6,=QL^]nqYc)Yɯz	'=UC`.ιq&[;.BWNA1:-*U˙ŧF#depmiρ-<e.-[EvR<_l"gr]l3GTxҎXJB&J,ƙzS><gc@N3isrmq<z'y;y\ys\AsrS􌫬r(G1JUUOϣPφ2}{%9BIb7xF^!O#;AM@\nfwۧ^xb^?G&P(cx9/W;ӋJ59;zEp{z;#@9L@7y3/t?rm%N)87-a־)qP0oYaz"4O2To?i^)1IJ*%4ZKJ'zT[Z-ݟ*<|KS78:G3Ό788ӎQs"yaQե[|*çl4LF%~Grk
-Z?bt}=	Q	J JA2o~`Z4fdtA>]<7mFwY<k,Oq54ªSកv4(O`Stw%we]:>Ilobh<+Ms}R$r[b]23ތrl+w\	)a_f}γhzrYR4Ɋ	a(\Էzd{%pr] Fr!kѽ;NWȻ0
f8i?
B+_͑pcX 
Y1	s|9m:9J1#M|ClySxM Ae+b*x0HBm=}6W]GmP')ݥcn![s^a&<XStƍ04˦$]kXXYD/~졗A
|,^E;m6O|3ߨNzڥ/]T~BYFn͞AVd_?\Un[ F
^nTtyП)YY
 d\!M	Vf\af[+N]x>/;͒3Cg"h<iKΛ]}-p~K]M Xf}^zޏ6N09oES	gMv0on\(f}V oЯ{s"r-|pC7<B4:"@x|>Հ>(	Q{ppGz{q@JOhS.;_ᦁGĊjMiUfxDs^cD|i>!Go"6
kÒ/p1؆Հirb:a2WMe`JcSѱF[˯2\ӿ@rz@q$!{ϟk90[#zW=cB6ceP!CE6y5VqCp爤_?DC4|[% \DͳJtB|<g(s8pV҇iQ=5\f^Ҽ!lӹv]3_hmlOSUZEsk VdV\1yK5/hDoDN?(7|kS&yf;_cHZdS !ksY* (#S/<lܠM~ͻV>GP-X7`}rmFr*3%6T
J  	+8
 1n(4ovkVSV=KZ5+߆UCڿUC`"y:2TLj6sSXM^f#uM%E,0G/9GAj\>X
wn!GW/.IEo4aa
Y0/-+ũ.B;h
z6e3񶔃gמ*hlr}#&94ּh!P9buXi\P.e]e|?g+`i/JKn\[VgJƶV$ɍo	7c]Lca無84m	XYVz;fxl=s[j#-7̌^"1^	˧doAlC4I}VZ<P% Pbџ t[:wckVaMyEutIFo\c:!~9R.
I,dߖ]U4!Z]g(guVgeA<H08xÿYݥ6۝NR ~ 8J&]\#h!719tȵE/2ZQ R:Lzz70\
Ȓ>F>
l`-lG1'ROE վjE񅥼5s M5W4-`|Ag$an`z?{h*..<Sv>OP}:!7(Ir#,1X|߉?"!BE qp<1 y<	IFW|d>d%8#v$;Jv#^+ 4-ϳ:5bSer~)ʙacd
´-0袈!'<Lq+	km(}zroM4Q8QQ IzʶF~_E"_0>r=F9œ'CY&GzyWsaz;˄!.iD^\
r/g}yomS&﮽h<.ZߛN8c3mw:SC\	Y "ʏ7$$T	-'=h9/U?e;'_Ze=fi]Um V\ihzsA;1s[+7ZMf2ݘMuW]6ڇ7fsbA3akŬ
BPTX.Vu_oY^Lj1tj|wi`a fL3fw\	8Q	s	4+L*WgaP{-cH	P|vI+Z1Kzjz oeWyd.)EZN]sd{SA	/aɶ[*'̸k7(#r:z	Ϟ*;lB&$y4_80/aXe(ڋr/6s}	j(sCIt(Rf[6ggM}v_y]E=Y6˃:>R0@FAGb]+̨yM
-^<x'yg6E*;z(0;5씘y$zDZ>B\KBN#d[Z`[;nҹD'8^}S%{<ؖ$9hƉu!>>1ΛVctTz[<~1d4 1qzMF.1>	L#5bŜ RIKZj
w[0藴+;hd^(u}1:=~lBZ^zPADU~ђj/'[:_cn6x!َ4	yD@q[rcG~z'ⱻYz0nLb'H܎DVxOczM
ĉ[H{33fA`Ud62/jVCt{\|[;v֙
])6A_ꨣbzYӑe,w[:70Ιc	mml;q-Gc'wo^="y^;[xthA؜uqPM$!SOy<$[F\q/Iq|?kկs25qTɝunnyn:N\uPV4).{I:<]+twvSѝwqY%KSg5:/>8YEAǔ_Z1ku,_	ܳ$ELG:P,He9Oo0bPruآP#>/( jj61VC{LXr}?+)cAaa̪2SVw>gUkn>65ZviwZVot߱RL\2*Ǳ?gJA)pD;$i/m/^5i]$)rg6.RVУnOFר뷆7FCo8}QcLY5^,{Az#Xs}~'}s>{1c7-%4'	7]64$|Sw,=s$OƂ0M;'O172,/(!2CqSo5_R#G~
fVpoDe
Y3~@@{KcU^Zo<οcMh$07,Ư]?x?ԃwmGI?g@'Ӟ!W{ޑdѩ[m*c^? p8dc%G'ΗjȯX&Y? C՛ڽ$lқr;%wq9T|>0=mQ#ȟ"@%&OJ'ȺI2m{vNYQ7;D]CV*O<p3]phe_o]o,^rۜ]L%pc޼n@l2bzzd_q?m:v2cNvrP`p[px1Ci4;rւۅ7qDA4ޏM{3pߠ՞im"?s/^	i]iQtNyP,cF6M><u11<!Ll4ssL}()fLA0"FJ O_4?ۭco;[w,b'㼥%cvy?C>:ͿDLF~T("yŹzw̚{zk_=fF<| F=~r;NOOzNq WʽFtK^)L^zS̓ş^jM|^%ᚏs==4+Izu{knS+^fݴtwqlq@.m㽭~}O=?o'4SF 3Cua- ۽wY/gsڟ=2LY`?V?ytyP(@3lr]ۣ(tؿ /KKV8/S]u._߰f[80Cffit@ך;I3~_nၗxv@t@4,:Gt^
qγ8h	բ
z5w2\A{;(X&,R64/3'ӛLdNPӝW/c#G:p~-l#/<K?@MWCwHk|U={nR+4
݁R1iKxe$1'-x}YvZo:6^:<o"Y=_xkIo9J 98@ח]u=pd_Z^7Z#
=E"&y|sf2z}f#$}N)A8<Es;LsR[T*jǴFo|H^5?tYAZ]V^E&e/h5٥-DVCrAy!D5_[/ntkyTc59'QF=g¼Z"civѼIx[co5r߽(,H@qm>wdB[):4Iu(6 I:&k6}z౳	,0Qz4#$2<
pWW^N(yuL暴vNӼ'񃧯za?YzH'V,<x䧞7ϜxEz\O(Az?GB%hpy0HO{5O~<A7t8~Q)I?(+À=2_vڞ*Nh@&ik@4PA̏m<Y:I/dc1EMa:`α7
lQ2<I+2?|ߏQɾ:>"f467ct)ڻV؊	/#t̗C͇GQF_`9u;4^|q'5<I8pdv4X_LjgzPKN~}چIo}nP8-7OjM٘y!}]׭ 1'0aof:
1S YcL,oKke ֻǞWtQotzʬκ&[o*9ֳڂ;ǭ|@N ͂4F9DGnFwyck3ʷ~VΉ3MZB]x> Ztnj6֎B
k 4 Fh]ㅍv$ojq\ʁ饩?.6	a.ibnm##d׼l{ɚjKFphBRb}|QuHK{Q[ŐSAL	94~Ľ[ПȋAw2yǅ&x`G̷4:@QbQ3 D>Z_B3_@/5w 	rh,18}at=	Fy U	b4:OS`MG(3~uTq'zC8gx34bCgja0Sps8$[ɑR"k6Q_cB/<BFҠLLRͬɃQxWY34f5FJׄƗ7KQ/ 8c!Ec=Wq򕖃r
LƊ>XAh⿊;+zg>Wo*!t?h0,x*zhXnkv{5E\yllf$>L"yViYۧ YZd򓞭vE^u,rY@ho?pO#OmtOu7$a;k^-bnZЮn[j6bΚV͎ziNӁ恮4[FiuF}inӪMrm!K_ݺF;T|
5ޕ 5-,P0]kh7ݵ!bigk/QN-p7N_8(h1h-0n,B-ݚꥆ2Pᶚ3 ^W?M.: )mP]~uŉ Afw~5nue- G\B/нX`Vx_i٥bfrƺlC?vEĳ2Zowj}pkS7Zt[Յh4wak`FSj[vݍvѤE?m4[f݅J6NxUo]AA׮uUۭB߶7:JEheƭ&@	1⚧8mh'(~'YBC`M/O
-d BAӥ,]hxT9;lPx4:)􂿝f_J<oޫ?ƪ~Z?F!AԧBb#Q>K=g'ߋWf(S`2/epvtI4ۡCBSD{\j3h]K D<}iKfgv޾E.-?%sbI+ҼxZ^ƠP)Wիj_RM~Mx9]rQS}E˙Oɯ!ef3.>veI=VNYT1!~,g<~~3eo܊8 fQfQ`S6cjS2(31alYK">+$o3q!cd#?]~@,T,elN.'ʿ/
I/~+M_ij?g{ .-9'_G?_Fw@>H3ر")Ʃ|5NW+$-/Wy,A<`AQ_UDwΑh90CgėOT0{$zD9EXlk!?˒Qǀ 6@`*a&'j9jY7Q>
7.'|6ic}o*W__}T9 c#;߶c)EZ%EqG\^ZMQVfVe{k	{-`arS3U.i"'Q+p1FhI_au{nEBd 52f9'̩rADUlB}MJ]^{VZ5G~X
bԂ/ӧ0\YW(ic`sP\t|E\7 ]PeR}ËËϢqпK>	FĦ=DHr`P{w?o;|.u7Q	!1(PƟiLT
5d	/tVY"Ovy?(c8C(+U{96&/Ȇ)BGQJ2nr2^#5Eckܣ*ck][nQ{m7^
P;eV;h/`	hT|w=49ӹ-,_3,14-8~띥z=?a *IM3b!L6δBV =VHvIaFt}M˫F>ʫM	R9CE d/Iޚ@[^V
ME*;/O\c/YlDA иDm"{qG1s:(5z#!J0TI.paU+p(U*C {^]:9WdjFG?(bΨؑ\]sF"^ۤ7߯GV&MCtl JV^ɞq%>4NVBmwbZ-gOr9祢SCi_xJ_APr?56ƕ.WW9C<ajBdC/ފr#&dzq]pl!z:&+\RRF1>|E1軞6U/ ~yCrjͯwۧ~<At~5gxK``(t,.(b+n@esLz3[0BBSX]=oFF2oad2ƭAl2
S_`X$"xaz!sBڨOTDB #D78#ctKxP)GP$0w4TM@䳑J޵6 $SݺIENz̦vyg^0åVM'8*tqy>Wy#{ XIq!'
Zr0:xz$I2dQӹ(*5D#EP.fa,$9}AG;F"GW
'|vUjȲtdM~D@=s%q>=K ]LXE*h=ya}R
C]L4:JՐU5hIx5qW)P.Ȣ큶1sٿ՘MqjFL-{l"pܟxdM<֡_Fgs8zfh^j³|T̅7*]_Ua kベcJ03ƷG F~ 3.oeE%:v#$H'!bC7$Atpq?Ѡ>/]nɯ0
@+L0̉p0ِQ4PԳ{9f
jx}{TƧ@jZ_1d{i^!C"\*q$MvTrGS #]hv2l r|\g<$D##P#oxU Fc?0$N<x~t:B4KM{wK>ȦۤA$,ŵ2K#0Uv5	Lph]$s+fv/R{ˎf^mDۥY'3,W;b˕-0n~-bd,"x>'?f&nz q8QI7+;ڧm'MtT<RiԘivڰK$BzI&LuLDć|:uρlE#EX`x'L(V{^|QB0F8" cn`6
3a2[]-f4ʎ:h;(2h"̔.|<4KDJ![5(͚6|`-K?j5z7b̂q߯BzZh(bפ5@sn>Hotl``PM9ƤMRՏ%JKH<϶XraNؘSN
L74:iG0eXx7<b9WeY
KV2jMHco̴v}L	Oh?N--I?(ͱ9N(FnW-h5%E]٬ 9|k乢Ǐ YBYf[8qӮ$P#}hosZTK:ꤌ~dţcS4aN}6$ѱN5A¼ݔeA (БݝAm]Hw=Uϒ);T5*_27jw丱Oۏ.: <qǣI/h(<&G珈T5*v-U+ʢFrK47q=(7z
4{Lf,v6tq2r<``o(9ミF'#ޅRF?#¦,4U/tF|d Ku5A#ԠfW+C2'xheg)G_|W<N¬Cj[M[u	[Wj#auVY@jJ܅hf
K0ycRlx|o)dZ1DbJv0'mt|ϧmhi2HD{>QZ`)38#|`/t3
|4z7
9WxGdf5d"`~~ÜОc5sxB)W*Ke@r,lvR&?*uA	`</D	Q7bb(̈́]Bbyc[Ө@sF·ڋOZ4LE:NqZOG9'm=ꂀ%6|{whl_yMVou[_$M+@yRc0`"I	9>k[Mh-(
GX=x`źxp.K( {tFd"	d5zA	f;7_\huf"AbG+.Ǟ~Zv2hrF@7Z|ZT^Tn`EV8B+N `rŐ;StA{YY̨2fNk5MnňD\Wc' evfOd\Y
'LͳWV]LSfafMo_pŞt(MbtZVm2ONM3ۤ]ҢMk6bR*Ϋfou__"_͸003*c}5`EpNһ!GAkKց)
#~4x ]0x⋥ Oñ<vc:TKK/(I-}	;Ou:fNʏF{?"{{0UwRK(𔯐1(p	p[;.Mp{L(<\ZҎ7zA%:US<mJ| ƀրpi	(	s q*$1!
ÈeSwŧt'@cxZJ1Slihˡ^@e?/-%K࿊_Y(>W2Ɋwx"d7|i4|\HlЂDϽdtBsqp4[<Oug-Iz/ KXw%	@Sf'M6ӔUryo!N3#=>>eQsQ;Jj+(1 "G#!(K9O?yTw-J{F͓Z)g2^0|ՓU枸"{/j?z'Ȕ$캃?m̊pful1IQCsE(pN`
6n4@ zd泭;K "ҖpOQ 8	Ro'=d	ԏqW_m9^F]⑵=6Q$?ه |5U
Dx2~ҝՑ-9&<f&3^,7{?"7Q:+X?g?`ټ[u$Yl]H?hE[oH^ x%a6 YP%DtC .Z!'h(:G\<@z5n)٣~2}ieikq+_-1\m&ͥ,q9׉8#ok(5=X"#W}w}O>ݧt}O>ݧto:
 X 