#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res res_count \
        error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 (] rH(8_JL',XUiݚzFd V& IDggck{}5ۯ/Yw 䅤nJL\n?|ޫVی~;5ZW\l:vݬZlkfF(ǡ;tCo $;>QhG;l(}NXfnH`o۝Vӄo;:Zs~wqQ_'(8QX[?Rn\|zif?F_RzN|V/qއ%\co]\|Gc'7Z_ڃeyg_1l1;w	2`qB3"/Xa!;FcvƱ0/Xgn0ԋ(("eG(8<Ϯ$]%?x%=
#'t]Y~6>:f!NFL]oæ-C@78%$z -A8p k N]~tƓh&T	gA0Z}CsaD*%I/~8ny^Fޡ_ߏ3;~^	<o+oT~_*sK6rXQ+CB ~OϘg*?Vj51!pxw"\idǣW_͟ޱ7p`нsd^P'1B,×QmAEE.$Π8J
_sWFp~3r^a'sDwcYO@Qp0ZiNf|Xk6տi8GЛlqv;i7dߐEt4d~;*6#Ŭ^:J;
v愾q:Gv-^dS#'A:@ӱ7 O^ۦ-ۤ[2;} am*MEHjl/WdiP1*A4\CȋǿMnRcY kRM*IE6梐A:vy%07O/Hfkj$a+ka\ Z}cV^QRVm@Z2{c6cya`"`Ym:tϪt4bcz^f\$L0RȺhΰHn-yO/dQH䜹lg;LkOKRYl
ܑ	q0\Kܘ]Нil_eO3iUn+ͷ&Tj9ɣQM5O,$c{wo~CYΥ?y$b?Dʈ,X<r`AlȵE=\N\x'VZ_躏Nx1,&P^EWɃ#_y~H>G6^oxuU]H"Όbtav yC|ٙ5a_d|^.Q`([]׵o-_j{x^Z+j;+%QC5.HW*#)n<}V&qK]oўwй4O]*_#":cIm;W$7JrLOVoe(z{¡lr,0AO NB5MQħ֦Pp_ш ^Obc5b~\G4~z+4bk`w{gkon[ %h	̫ʪ ]bV4&nOl۫1X=:AJZA6w^cB \G=ͺz9)~jU_QaO9j$q,^\܍7مoI,Tc0"Yd0рw9MyHK`_ w}lh:A2c/s($hyJ-|z\<
VʑdX_ƇqYKV<5WWz=AJ"xS)@^VE"G;ч~~YD>ƥL_	1Ҍ	sBdf76N
+/^^rak!1N7i!`p},(y^o~|S	=MzBܡlw^"jwy<(om^e[{O3q#gHѓ\h0eYpWJ>5Q"j¦LHbM	:1kʜ	C\i_W 699 TZPk	9o;DC'<ePQ	2m`yJ<FyC\9τ|肅St?CAKd9@J 81#v.:;˙H5[+3)㶬SwXYNtG}|UJ26^x8^$c\NEsaP~U/-[2[7Fiaɢy&!Z|٢yVT&dGN|VėQYHъ"tx̹?E^Y7[z2c˳wt6-	.t#nLI^NǓYO#w|gV5#u/XC8EۥT?5"e/7bϾ& R*ɲص⋉ -9_7:d8 4'X{X9W>P(}c'S`d@޼bm:7;v`qhl5>yjg{U̰NުGCyXDm|cȖIóP`&BWNل㙚si>:l%KZ]1pj9%KXԿiZ]:ݑtU!@Sv|Gng@{@W2';);F3>a"iA~4"
I9e5%9\+k-a_ǯ^~_WE;g)=+JH	e )D2C׉%FQ]J$؄T#B-/So! n`.SBHj޸ ?8L4>gh>M#;'		sZ̕*mjJҨ9MK
Hg*wŊ3|w0`#@vI)-©*Nzfu(xMx!Nd(	&"OblI%$^0.4TE!abQ$b́rBIQ?~K_5=9'*803//J% j Fub9]4О-zͯ"<[Yb[.!I<*E`S^C3S-ƝAɝ0f .KM3x>1(9| J)r7`H>+6'MFI7M
UA).$.aoVÀT	SNɢ^f-^M,_
_
_
^]L{k+Ki*Ke'z!y6d0DȩT6~S5K'Ҋ2дVڃps(19C5ݤ&1%ݸ]E#MkVpSjvSFڮ6-'buq=1+c丄]fхY1R&?O7$b˚I[/-%IcIrIˌJº0[KhE,EA/כ\X
~&Z~ŴXP8y.w]=TK+bZhʚhUv؆2W蚥JO+YWfCs*]HfRUNbKB8 /kd/#ɇn 3"ށk vNY$+DA5b>B@Ewҝײ^0Dz_Ǯ{<ﺟ0(_k0ﺓiRI Lh6rV۸PNRGO'ɁmXl-_]j"	r8N)0JZI_U&?	N'`!ĝ>j*@Rt>hI
K[`&_;G O|d>bx
0ƗDZNn[ 娚)7q\,hZ˕V|"n*2x#lY^RW?p/>89BtjTPNp)&jHbw{~2vlcBmjfM{-Ҁy1߅%mzoEQgP7ؑ1<!О4USIKsx(ݧ[-KG*~6~AΝ(O#VwXWAP("h{9 h<*`]T[L'{2v9"_P_6QBAzB_#36_)_?^Ap#Ow/>HGe2) ɋeE.4%j$6ݽĴ1AN|]KnY\;-ʍWJmLHZJY9H7_Jvgo-7g- ˽Y  ,*9a(p#䏄>uo{x,$tAʃEZT[n[ܨ6(MY= /mZ9Z&C>oz4	Q12q#?+(v@_jmef Ń1
p;lIxP+ڐZtRuU4kU)hNtuOῆ.tvvF%/ό.wѭ`IAҘ'cLcȭQ5?0}*ʏ͡ʳ`4+(ƙ;4F; KQn6_ݡ^:@JS'&k[')l-[Cn9w39\q(7HX]>BrnNdSb"yc[|/FBLvvx}~^c$+&gh]4smSTa~ede5;ޤM|+&PGY~KRe=dtX(/nY{s-m4M0p{1cfPu{T*ͤs/MHnt^<nHOne2TtG PӹKG$00_A۔#2k6bD=U%N 	{=G%xtgJfk[QIsLY0{"}}bej)7K%M(7ԪZ	V狖LR<ɣ0U|O6#\0kc06\dQs%^
.Qh/PHFz*XIhxAZ<\JeJ Y%Sd&Q+	:?@MXIs@`kw ZoD0twNw36aTQaU?=Y˹WGt@x?dۛ	pG7>4ngg<)YrZɋa
<uՅnʨh`9F^:RIF8"13~Rx<v5['L^U~q۾J}ZCCL&h%LaoVqaaH=a~C֍yfg%+Hy͏o8y7sCJ&5[3PHN?BoCpP&8tSC-:+lM!2\eMB	'+Dn57DMGɯ8d(O`|+-.[0I@aN|Hʑ~r7 9G{&4rNK%뀼OqcNz^Ytr#7<e1eu^\-cBxW ި9CKDo$@rN&$x*{il<g*yB630sJKa
,p	xc6VGh3d	EsoYP>)ޘNj7Ƥ4jI21Fp,\EJn{X<"7:_zyâ"<CO PCTw}|J}(xأhɦBj^}.LĆ%VPo(˴T!USPA	A (^B,ZĈw&K!Ri|c j9Gd(Yenm*@x܏  nMźcS}bwUO}~&	D3Lx?τ4kMƦZY T~:ZjI7

)T:
Z D"Һe_OO-CF1j"R6bj"QS82O(H#~%~E$Q0ŊNi˛iʛsⳬEV"UdITzM_$5	|M_$5	||M _e-YB +HHI1vՓ;$	L6䮓ܵfr(,?IR B#)HH
hPOԋԒ$5s
w.?'NqdZ,1n0Yp1M,KLZM`K{Zb)3*)HַHǽ_Yo5[yvS<#Jk#a_~zdFCҾk+i-Jc=.=}WrIԚi	:c<[&1mޕ!:iDm|v<<waAwXdY.ahH%az@ =+,PK+d*h
vxczGWxIq)oz3|:]})X\e͖W*ʄ*[Ee}6=|3xR"+!L3&cSI|aZ\,fF]*q}-wCUK<Țaf%Qko.2|ef.5+?,d70`hN&T%P۽DB,̽Jald+Btu}ܐxeZYܓ-U*Z,&GXDtWE]DC+1nBR{9hK{bJcHAO.A<ͦ5M'q{si-'	$dYduKFW&䡩.3"0ؓ:Y
Kyh$/soE9==aPD!G&aTN_	*- =rkl  lM:]M=ݑ{Jf7?	L^kJcކ>F\77S^iʣsW݌a)UH6//nD"ʶ=W_xZqTg޷zG&qE'ҕ<ϟ]un!೗yP-D6YJtX;?INn{?>'6V=(}s#FXw$xܡ:%QZE>8ucc7g./NuQts
LfCS(R%QwѪ<R&U^YC'dK`!Qpk+j6gnluϬnW5ZAC7 1Il/7!h*Cc9i1Sc:,&St?Kgnm[RMKeN,W{'aGѷPd'}seK%er:"לsp,"@s+Y۝6rEP+j)Vlc#8*Z^2l/#QS~,\q/F;<k
Hf+5i_dnh>2i͚OQ4/[օXuBњGa&oYno5G4kIv\..	d5C0+\Te ÒV%{-n^A;jT(b̀"/˩q-Ns*kYM]@mRm*f[Ӕt>`6F/1d'Mz/ۀ5sg$y94*^n>{Z*+Y9s+?pL'N^_@SQWFnqR]',^ PR9Q.Q:Fq0ADIHUh<̆j?]3eNd9_[6=}9;$'ɽSneTۭV'#mGH<Q_|H5B<QP	94_%G劵)ǎ>ly-rxUca~_@^:xp 4cfvk{BsR5"#2u}bG.,\囟N-nq
909͋IIf000+,Fy!~N/v$):c&΢خ">_0EC%c1s}K3:;18zãϸ)??:~k(FDzWcDyslg(Q%%쪲j̏({ag:w(r3FM߼.:_ʖAXzg2< tC8ncl,,YG2Trx L6Poy9C__-`ο~UP
Ћ]XqS%IǡG}ª74}qTwOyoȁy}Q]̺ĥqpp0Pam6#h,V_9殊7p/
" pG)&~.	|}STܟ/6RǰIE!o`$Eg``g b
CӐ  ȹ ǌᒑfI:(bDi:D6..<<dt\=|p|W]ɾ6ٸ~]J;6ҒWXyQ֙MEa-G<U+퍜Ê-Q{"O塔J['4pK5I|7_o bƵް٬n&˵kI۵σp@zu	ZhZw,QYW@'|nHf)Fd*IsgiC5hMc_=/&K	/Snra `zM,ղ
$0` zی0UHuZ~nxC6v
xco-׎Z kPgl)9$<*Rs?cf.j|;}A4}iG]cu1E@[4r	g#Qҩʘ8@ҐQޚF];aJ^+`\19X!VqjN@v4I[XliqFer/ߔ3Ɉ8oV<5WW4YcJJF@r-,r!ә@J61L	&[(UV-lFzXl!ϟP+k:1ee05`u0O)4=JŸe&oA}F#JDg+=^S`(^PӅ dDmJFӃhf3;82&?2MfN]yjrv=Ȣf[Umr[A ):OtUEA1dePQ@g*lܤ P<|_שVnq̩6kHeYϳ-]L=XӤtyd9ӥ9-eݢ85UݒO|ijG[.03k:*yal9fTo\f I:r;`|y|
<-N&kf_21E6
fn
sՙ7vP<ƾ5XBc*$KB$R@Kܧ2Zթ&Z ;uSsR?٦h?Cr#>ǜŀ=ZhĂjʜ3,ldM7ta2)&wfj 0"n8BE81N|ܤ0(ˋ0pbrl鹟gRBaGZq/,ǕyiScj7I"-l8DR.C|>18I+B_`L>3\YJE#*Sќ'vi7zK6L,QsŞ\m|A˖qYRPP47`狸+OA*Bs-{ұ7&dkؖB Z@˺aOzgcqEP-*Ya@'(	E I!⤢R3 "i
e1Kٙ=[	
~Nz7q+86ʅP]LYv$Kԇ$v,t`;}3MYq10f3*7*&{~\dn®+30Xr39  g:(j0tiYk\Ǥ}C&?quLv(j+ӵ\{Rf"ICc]8áL$$5X\~R1%ajS)K+Rb <rnqExŋM%eܼQaQDx6u,,꭭)h|RUxX˰03
G%IɣabU^zHؽFwqMO.G$[^
tq˔m^JW<"UI!y0gqyLأlV'eN/[jx)[f#+G괯W/wT^KSm$VP]	҇fa >Cm߶#[-`@
/ݛ^B^i"0OiY3].wC7ܴ56.af,,Q@|}
)fEjf/{sį$Js)Yjx1^cLy3@\6:&SM+O^K߸ݒY13sV.Czf<Ounkk/̀Yuٱ0n\tR􅹵SnNg!c&DM|-z/qF~.7>U[}qGT\21o">WE:G}A7.բ۷:K.\{nZ֭nnһܰ\ƭKtnsnnDuCCK3=. ([	ͷs|+,7Q&BT'Ӡh.-8C.&UflxJ*23Is)kmȑ7;|SՊtclw؃ g7D\|VݴSTr]ai=d$k.ް@CV9Mzo##wC[fxh\dUZ.P6|"~q*í0E@rҫmS@WNq ?N9/=dQp2,N9>1{g['eώьboUfq:iE`_Y+06+Womp6Ʉd铽+ruuKdttu,eMM95Fj96D]<Vm9G^*g1j/	ըj?rO~x׬&GkќMTfQڤdb͜(c` ,FV̂^pnpYc!iou%:NVo':0l_x9Dm-RWNA'+*.A&˙&R{%X򼖈dE7SlfM:;mٰO-./+W
*3mt6,{`c@}p-S/KLAI%N]`h:;nNwMNP(НD&#LAg2^Rr_%H|y-N)i%Y݄'	j^%D*!4|g3%!蔦/M}~9Np`f-,쵆t<ׂ3}<x(r"8L<8OD?r`4Y)B^K\2,i X(˪aM p%Gi/g Q=_-)p,:ɼtGVts/dYT"GEXF=lx>?2HPށrcT?Bsq~{V7o[doWsk-.)zxTP[hoatf:j.4go`\@s,_	XZ. ,c=>|_U]X ]q*zOɀPb]=fuceUaWzN>
 \%zկVR˩Tp8iYmv
gm>Ȭʚ8Z`OY]qXʬUh
szxߐXst(cy}tB3G}yL&CؔgBelDnːYkD!QSX|/q	Gcm	6m#t΂H횏%`<<BQ4foVh:v&$0Y.^J3=FFT70v9><_$
 eWܰD;X,d9p"_obM~+4HQ^=@x(Z뽟zy9-%ЁA+YVLGn0o#<=q`Gyр8I	v-]{݂-|3PW3$Y4&\gx2Ƭms1	2|'eGqI ȺַXy7WWEM\9pSZ]}ӷoPW_U+\7]Vy(GIy){II2$I!Bb]$T|-R9~Qr\$Zg&؟GТgӤ.9mwgjϺ6-u5Y^xFM[c`z}-9`~\3uT*6s-S<Cen9Mt)g>e\!lᡃ2>*z.<?$u.:";x rOiמ^6;?Aҏ4F8t95M#?v&_T'XSi<!ej6
7Z쇒m97m؆ەݖ\Bҹ9YxLyn"976i+nH \vETJz>:[D^DOǿ%b.wNs&d=$WZJ>WRKC6#ŝ#6B]FzCSn<Ea/Y%2Y.\iFd8ξAaO5׿~mf:7jCzKiԺJh}+$|L^#2b4#nҴRýH_1.0f6{`Țe~3shFBkX=R0UFo@5݄mѬs/8wL߂v'nDb9SȮH@7q@IBˑ
YǑk2Zִj#Q>ߗjRXaj5$JE*dzd4R60<O'!$SQg(|u b<{q~иg+䂬ã^-$]|<+<6Ǻlwp8ͅېfjk䞹^kѪJQHFEѥ;ҙ^F_&Y;[Y%/F.dƵQ(q/ʝpV*FysT
et{щ3PX(WJozVVVBenԔ6jX)="Ҳ`Iա;3[",{sX_LGnqaW'aRV+sn@xT~IEa/GGٺ"F-_DלDQ3	riTFTgPta|VNNBg8c$H**VSC4:h3HΑ/p5uGyIj2E1sj6muSIx.-X:_o@=/`੸=(*<Qջawr+@K#,ȑN
:0:$fێ|@kylO	&W 3$+k'VV2AsKy)kh 4fki["98C`x0mM'0JA$).<Sv>ښNQ|:s7itc1D="	IL O0RWp׿\c!Ŗ83u3/X/>1jl @Aҋ<9S ԥy*w;.i:=v%#Lz{,}#qw*?LIbmES}e@_[(h|4>e[c7/IYL
Κ"XLwgOzf=>% jU2QG-+yONtCh
|%W=k$]>{o?Zv^=cګ=<V¢TI{Z|;o3	jL;x. I(=)dz:1QŜ'4ϟjAji/xEKt׽ycdV*Mx+E.Hg5*|g(&3|ЮhÓP)1\cg
 ><2pUI V᥍rYDs\6)Lj!tjb%"A28KcxP6a]P:k9`m;Y9ؠ90`A( 
9 O/\}y1yo{mYEr[K^^WN(ꡋ8Z$MM]йFPR
ezd{Qe@A`"ƶo*-D'LK79r6b(kBYI-afiT/\%ZbKE)^mk~h]֗<eEn(/ Lm"r,%N v@9[~3fDA_W5)E2G}`=_o=0\+ȨE&wmGӬ/eZԋ/:<#6o8$n!qыg֑L65msWKf9҇wjiBꈫE-X%4!0||O7qRz;}KzKs)iͅPu^?{e䰏<ɣ2c ̄wy!fyARE2Ip](Ê=XRLr_-7.>CC0Q3QcQE4sgQ$:qW͐57H?QD!0_y/9#7>w]aꉃ+ou7OW<`f]|QU|1R$TmGoB"sq].0kQa>!~zNwP& "@|,}aYpMo(YgIQuXފħ#m-giԵJ.(wf	f˙m	lhL5<PC:l۫ecn\DϫxdWIߙLFAؘgp0NhW',ē~ gvBpZ㻡YvP4&;*4uv7V<'|,ى.]Z.@EYӞ,ɒ`9XR0'ӘSUу6Юs1/N\0Fxfz:F''xM@31@\)JWPpYecyG:BK%,<jQOZ*Q{$G%!-bi5X`I=qQ",09֢ f㲡~PbPhj?|ًVZۯVی~;5ZW\lfjZXk>(kKJ 8th $;>QhG;[co7[uzR"j:Nj77WӈVj?ϝzV5f\z}Tzm;b!$`N~)Y_:EϠb?Eү:T aNGbVq48*;BHbO/:`ES:SťP~)-=< {4pb$]^:mw$8G.kk6̯S7<".ƟjM>ܹjƄVSZ !&m6;]ۘH	"="W|

 N闩^I	I;ZbRN@qCÒ^fUUＤQ_F:uű`cze)Nz^3Ih&>zcmYZ@t"ʧi[zRɔy
%wFZ\>x:8eFg.ϷX4>-;^\ܚxyY^/cP:dSom훒2( )MR}_EȘCȃ
 q<\"̆H٧]!D}'G27T ][ SN_ٛ:NSm8wZ]\)-1|9]ς)Lr!L<
 .&h 7eQsh/P$3RF$^3:]fWmIa8rc(7/+I=$746isrL&/?t~ѱI~x,f{CQ"TMo`*	S})Ce]k $AMqo=#Y*o}~=.Z?.j%#I
J9Zn`٫;4-'W  >Zs^e"$sMh..ge.J2uմ9)TDLj!Kw4Eq)	b0<I%=Qe@ҍ?7n2tRC,y!
IVOD7Z$lMV~U<ំ5ew9-EzAeDJ3a?w]_efeAԇF$`x[xpI@7e/a@1$ޏ֮Sx7QjwJl HZ,}]k4kr@˺ C12- v^lnlmص:'8ЛFm!~!'Ph9tJW/cTP͗AחF17	oPwj=z\JJ2ֳދ3{~ݽi#2f,p3v@{ߝo+ԻGEf>{z|z{N۽W??K^ׯvz?S{	8j?H~k?AS3Z)y|/+!Jۭb_4'=ѓWo~|[Jݭg5;g]Ki݃5w?ͻ~_Ј`.S_m^w'׬iL!o37X/"O,QD'21wW(_`W2gΨ->u]@闅7=_s-XzzުXXQH׵@:G`tDa
r`okPQ}섂^ę%(ǝm?uV~|PDPgzMቶdO)WQ=G&9dfjNyG%]~5PwN?+h`T76r} ʟP~섞uZܺ%Yg_PI$ڽw)ܜxPlؑw̡zrAY4 ^_V]?a@M$==O%vC	[/=_5Wo"[Ѫw_bwZ#2-5E"&y>xqcnR|}f%Ӓ5<yV3k	]\wb&ARՈ!!Wsk.#/r)`zm=+{,/~IUȵBM.bEg!VuX|m7Ѱ=̔i-_|/Sy4-rՖj7[?J_zC-17/ZN.B"we'!!S;2l	?ɛyIcUk6]k&k7i(Z/4WKR{$駫/Us?m1{ԇ<թ7]_?aOKO)WvqSXOn1+=xnmŧ؋G4 ۓ*dD+y9
]e(AϽa|(yZ7gdEp^/hFУJY)w&RxT6>O#hd܎Bgc//䏡̏m;/dc:

;
7qӠ?.w&]i`]8@vc3)SV٪^6L@kG1/8ƹ׿Z<*.Jpz'<	YxV0X_LZgzQN8=n>UdyjF6&^eH{5kfUsҎѨUh;`1^g6LMoCElt'_z^Zm"̚icg#͏g6˿>nZVoTZӚUBi)#-Ӫfmltxc:s7n)gj:z%4@sٚYDӞMMHQ: MZo.^m(jr2p]r`:qN&a!̹#fdx:<kN!F|UiEcg421sZL>|qzۥ0ǥN4HE{#xfSB SЭ/kcac'3<34QpFn[P?-w#ZCrOD-HJNSA8 	pj&EnP(8	zl!TF37iugRT08K8:
BŭzSFF ^<?	#@Ұ:!B\](I(GZG>#O5G
Y/dabXλJz~遍gd2V{4jnMbvD$iLi)?
I/oJOP.;cfcOWqPIApuM&cG >Q|l,rܙ9r;Lá!Cefˆ9ZM{nmv޶8)MhX3]O25G^ċa̪ׅ{:$`lw~p ]i]),Jߌ9-icB	}Ӯ;}n77~]u@ vTnZzn-hkk=7Nm:kn0@VuZn7[&@i뵎om\Ԭh7,@Vio6fۮ֭ƦݩmXaQUV0e.ԩ-$հ㐽oЍOm5B! H[6,$hZHР͍lڵVjM]- gy6MX܁&PKa@RCo(۴M^K:Rn*7j-XH [{đ sk݂כFfw6ڿXͶlZ5`h&g Mt/Юנ\:|l&$ۨkt(|haT :g}sC>5ZЏml<7hp)XV{Κ{}`uu}kFBvOȋ4llȧz	+kHlz:(O<:z^߬#u7A{l6lu]FAn ހ]zmm"a}mEh4W7I$3LQUGy8+j9(|1OSA˺R4ȃ2(;W:bK}ƀ|enOWbPȃQz#/
'_3/<_ޫ~5<03n*?F?NVd0&0l[!;`ϥm8ҞTLB*xϑ=cYoOl5`[>?rR	#X2+qD<2̡v XYҾ%):>\[UV+'y5N̍<nx :\te^>:cs$&8]&SX$C~=v1J)sWs\IF#ȩH-
mwsU2Twk<PW*I3s!alEa%d<	-lX1h-xg )8?h 1?$U^G#ם0X'ռMzk_U+C?_*!*eU]R'L_G?7_Fw@:JHqJͱHz~~߽c0M"dfƕ*:	E++}vq2y>&{U־9EBãO_[ȗoRK7I\H8ӵW0R>a˘
D,N{Qtg:(V<x!wuU6W"Gj$!>v$JGQ|YYmWnGx3W)cFQ680ԕ~~JC֊UҨl8p\R_X-O
?C_*0R-a~I
1T0s5W_ҦD]Y8RGo20:f@W¬Wqd{VIt}L7(Yr*]/>&q$nK>Cb" yaƂ~]#ov5VIQ,lE!W%;(Vr\F$Dnǀ#O+@2X2T_\|a){u96ܑH:BGQ	 	^RjRZ#1E!k,"k	w4yC'Rۆ}`
@D;+/|W,24cw<܅cK>],jh
{)櫬<cjjr.;`$@6^&V$,C,b,E īcIfn@FxQœysM+kZ:JLkR@DY Kc}K heOi*?Xq+/e)z>q	c/2ᓳPhj+,Z,%Dj@T%EuEg|Ҧ gcOU_E(e($$thT*+*t0פ\b#5w]~5?mL$1>
	^P7+Yy9}yXjO$1	'bS+&VJ~U^pɋiٗgt䱬wf޵W*^[*
9)?@䎒"e-ue}'м1YeVJAARb
/14Y-ˉ_^H=x=46z*3n`WOdryг{Gȃn`V{ًrRXΊRb= l)Prn)VK^~Í)Ɉms]sbM'm_ᕲ# aȠnltbұHHF E(vF#~4aOTe`$L[QcE«KPbUTcdpwk}vDc4S੔AzR|& 	P%O_e*(KJ"#pk:q?bǭVtm9s0.`FP$RzCc2IlNs'=\NqF'$ܿT7vzln`=7/vv^1+*WgB6ysF(\`\ږ&H}-\PA|;F>CKqU PedCɰB`J&HVHܷta[??Ĵ@aƺNC.l3NgCQD	ĔoJ*ԗ4bʈbD
ͳy	.(,SJ0wb:ֈ1wU)Y.~̀o`+U͜4hIx15q%1w@_|ρ_'fL'EG2SYfUF>p_N:Ҝ羅ī}"4WϚ}#wJa㳅
89^̢p(i2rf*aq<q;YrԑO/+fz6ܱRKD1`y\ `1kR43!0$^(3s/>$% AD\膨:}n3V_|a'Ջ01+XzCN	^˒^c{ħٙk9+}p/idwĐ]+YΕ8H&2*3&|@L|Nd@h,[<uA8z$AVUn8 ZL\a@'a0qF)Wt ,-<\8չE64{'~,=g\"%	B;ec	Ѝ`;uGCv<?hzV@o{W(<4)ecĂ88|&d~X2y;;n ΃p0C&ŋ^6j2axqMkOm,+od*Ιm.o
x+	vn+n@8IGBbIʃfE1a0Ʈ(&a0(_3ZD!
Cj1;
Gbp:eqDЋ8TjFϋXFU5ݻx^r-BAxEnB 
Ax-ؼK#LyqA|L>xN&pVA=$r^ksd=w`ZAPE6K$#'K#?O2&k25 h)'k6T=mo./sx \jdFբJЙ0lwC<QRLZ$!q <"gZh2!iR/0.`:^tޫgǍ bnqѮFC#}[oo}ZV
V:=j]IcS0eN]6r$5BUSRQafvN &\-yYViڅLprP@bPrAn1O@ۏQ2 =\x
VDf3hEJ϶D@D#XEWM3遍cCEM6D ]Mchޅt7|n".dЄcކ\FWHB,7UHGɇt!c|tNBRnvkBW`(vEd0aoP^|gRg!^lx\:2';늪d\NO4e4]D@ 2oj5(;ᨩѮ|m!fppF'-3|F$wd)9\5TrBC#&Ds:QJx
f*TyMJp*El7tg7XKCgU
`9W@XC]2|;Ljyg&|L|j-R6~QL;si}(d AvW\`hܖۊkx̚
%yTb_Lf(yik}𑸝<L g%ld2u8M˜,hQv+?lS~^C'ijxݟX[/;{oŰA[{=gt\D!f/u~w~z&FӸp'׬?n3G ~7<~fXD=!ayYlʞa5PPEAp/c:@AI9ExN!^˘I6DH$SGZxr&D=PwOkaQ8JX9gHޱ#'Ka٨u V@gҕheT,2_zp|p@PksV>i%;ňA[duM/gRԙvTbGIBRO7Fî~9Q\wCg&pM7"Jo+{VkϷ3"BkLm_&h҇3v:NfQH/7֬s[J#\R։"7~3/u,/ֆW00szzqNw`#/X5j$Ɠ >37,=8 '?<2ice2$;sא0]l_dv{v4Wv+Vǜo!_wr880IwB|qepiҶm2p)MW~}ƽs2{ާbe7ju\I,iv%n+/O{JGڅ q*F!00~@r$o	ɦǚvCxokF;r&x7}ǿ^KޗCx%:nغ7ap79O674yP^͍|>}[! RSs(Xjq8h%Ӥ/]wj/MH}I"H29 o˚1;Ol195v_0|zwGzg}|˂v4%XŔQB HƮEhڋes^GQ{RxRs7ߘIA$^k~Qx|Nw 'd̞+O	4;,#4'HN?qߤK2)
zhp)][~2$ <4``;#}b,-mx#{t/vFx*
CMNy8GbwoEGVJҾ,o囍(	М={|:{60d׊-t	9|&1hkvVhvf9@ 􏉂>ALQnvKMQpFԻJ,Xyd.SRS]	H r	MC%"PEP Ճ!atL`w1C1
Rиlf.,|BciXBѠsD2@mR<z\bM0Н4i06SB?F{MGj1+RQ3hś ]PCs؁Q0
F(  g \ 