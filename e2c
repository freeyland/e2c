#!/bin/bash

declare -r e2c_version="0.3.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[0;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_res="$(pwd)"
    e2c_global up
    cd "$e2c_res"

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(د_JL',XUiݚzFd V& IDggck{}5ۯ/Yw 䅤nBUL\n>UmF-+.Vo[vnYXo6ڟ.Q q|(HɎg#ڑN.?Ffټ~6XvU4[}Eþ\_]\翅W~E?
g | ?<4!'h |tZYz] _oj;旆8tc 17..Vvwqi/~Aj׼dl]S6՘;~8`YՍЍB,Oݰ{#1;qOG,r37qY|Ey~ck#wWgׇB`	.TX|wƮ,{u5Wǌ?(顸mOѲ[qk8 zSBroapFڐeGg<fBpvD1ٱQQ7:w8vIثRjΛt׎7uktk;QśaػiOʏF;7MĘlc*|)A21$^=x}lVטw(r͕Fv<xa{{_>Gu#2|UqY^NB;we? 1s7:Nk]t۸nv:.hȉNK%~e+'a^14QӐrYlӬp7-vn0g!Nh /Gw0T`mGыYtJCw@2	}/:td[+F[v\ɦvGN{uco@N;M[INkev(F@"TdlS6^ӠbTLi@1vёQܤ6	&A֤"TdlRE!7uۡ<`KDanܟ_*H"L85~W&JDA"FYǬ;ڶ럕veurR D0jiuUhOX8,͸.Ha&|-u<
aPW[^N9s΂w +^|$ݗA3 &#]KW)#`
1d';ao?ʞfҪݦ	Vo}MXrG;kY"uIf?llK|O7H~6oYfmy"(skzP[ynO8ܿ8u$b.XM ;qGfr ϗ|lvlq\1E ´D`̙3 +3[kLͿ\a&8 ]Q/kv9֯[?׬8W>wWJʷvk\TV+FRxƩMJʗl=si6|0qUGDttǓ|w8H#nەPD2QCB	YhQa4 7ijĉOMQ5	AkĽ;-jui.V>i`Z~XKЂWUĪhLܞCWcztFIUuw39XmTo,T 
z*urR,>{rkU˝r^	ՖI
XGo/^ˡ@X.
2"aDtPa%rƛ.+;A 1
A/R=ft	,e_N3>PTI PZ^ x*2)R;׭#ɰ⽿:㲖tmxkVXz*DR$*߭Dv2$zs	X3!|tK-9:bf}#^/ol@V~I_t}ΫBbq"oB^XPīv_Ӽ ;|zγyC/*(boEek
QyFAQߜ,sQ˶~gF '`%˲(0+#50'|kD
ԄM.6źub֔9v< mr:)3ds0 ֚!c)rv,%xNxˠd!y2p#r2/P	(r3B7F' :qcF]68uwh3+k0>,W*fSmY\dlpHǸޝ%^^;Zd3doEL,YC͵$E)Y:(71LɎ ٝ/;|ãE@y%s2&o3dg[[olZ]"Fݘ<'FﴷϬjP]UG
H!_s(qxKE#ف}k E_Da͔=|H${c׊/&nN~&+˒i~{܃ӜknbYc\BSL}YzҋW?샟ۭ/&šըlwy/?:|TVKf..Z2:X\Z:yybYɷ![r$BOXL]92ggjzݣj褳,ju!\P,auSjuvGRU!MyqOm(1w]>ˈ6$JL$Jާ\k̈RdIMЈ _+$ΖhsEvoxd}sz~_>c|1c|l*!&)@]',^E-:tͪ*bR`z
X$L}OJ3؋N
 i{gNx2%ßW;f{S_,P,P7`2,ܞL$'Yj1WZ)Ix7-+,c -Y+Έȃ!3 1%Rh;Q{7뽚i[ԡ58O/v0$|#k<R%hd{IX4P	E13ʑ%FF7D\1b/}|䜨hϼ*I[Z΋tIo\;8@{5*VLneUm$4iLy-(2O}w:%w}8/}6e,Ġ$G+:Fq߀!9P^ڜtb4JZ2n%Gd7A*T$GQLZR%L9%z4xe4)J|)p|)0|){bw!0ԋ3,Ac\.E2ڐ;|i#R!0C5KOIטG/(FK+:DBZj
e6Hv[Hwv4YMW@ٹfNIaj>4UE,^Ĭv]EfYƠK4<UN-k&Ëo(L&mϏ%%-3N+	ôny#/WhTLu_oVsab*8kybA穻h*NIvztRN2#/p/X'iN+kbU-bRʬ^Yy-K+\YfC,^%%
"W_`9f_G0geBwHB7iFc[/]\afSe`nf\A83{<ﺟ(^k0ﺓI~{aD(+()}.'Q̀6nIf㙑jrRdZr1vWWy{S\\'S
x|WɏF77X|eq'yπ_%RP,IaiD"VcĄOgWWo^@]]~t\Q[jB_~G͕ȲU\'bgﶮ]7x?9%5{5ڏ|#zX#wZQ󎓳IW d|Ǟh//0yװ|}'c66@,~hf"M]Yv[$Aiv/s A+H]z:;4x;MQRt}gxq8_(Jnlܹ4F|y~E!<!2HFhٹ7ѩl0ƣ&|OtbhjC/"|_@%X%~A^nEo\4VIǍQi'_RΛ~\)Qo;JE:dVRFAˊ$']hJIl{i9a)cĝ*f˔43wZ;h(0
!Nrol9s
I[VZ(odQ Z[XzC,XrQFɑlj2w\YH莃ؕ'8$o7;u50Q߳z^04OLZ(ι}3h
Scdu/F?DGT@1Q
T$:A$b v8ْ\֔HڐZt:AuU4k)hNtuO]Z+,(K?_8]?B9j89NƜI#GD[1j~`8JUD9wCgh:V$P$3wh*,76"<?횺Ct>7ƧN+=C9 wDRPYd 'g6q2〉5mD;s|,DrI珣 _Xz(4;H}HVLR%=2*hی4^,ʲkvI8#WNM8Xf5谨Q^ݲZ+5?"[!NO2[{!b:;TTI瞟-@>q&@w Z9t5Drx}r#,:%<3g@x<\&yfNn4N
ڦY5K'b'HM8!tEM0L9R-G<4^>8Nkgʂy+ScNY/kBV5'JO4_`I	_{987(炑^_"($+$/VpB#}B28ĪMBKR*S҈(DU*$+p5X2^!M?5a9sN ވ`Ztg̼)~zs{؏y#ioN'aVNи? -amo:&)h{օ6ZV޺!2H*:q<Z(RLq}JE&U^Z:d@sQogNHOlѫߞ2izU^cSo*uBkE3̣ڗl0Q0.[.i!A#edЇY7䶚B:gJP 7?G`]"#E*]lak^cCMB"JEO9áBY#M8XCr0\V5?GvAmcK/<3<>f4f'c*G:IIވȃ$T=5-)YHs>+:Yt{QȭhUbqdui\Ax'-16w8=HE]x!MbTt甖^jQ!X"1l,ۃk;ɲf,%ޚS13ԈoIiՒ7eb]$R+˼~\JDDoruo~9Eo+ xEExz*@柄HP7Tw}|JO+^>wbhBj^}.LĆ5VP2(T~!՛SPA	A
(/*+Ĉw& R
17r2؉sLUx/$QNK86`0'vWU6p"Iכm1p?OmSvkS[i.9rn1tOO4Ogni0Su³}Du:F#Z.31=<S3D|m,)B5EdM!~oGoKDta,P͋D7yӖ7-yӔ7yS77gYD!5
ů&Ik&Ik fZd%YAV/~jb7'wI>q3pm$w]'k%wQX~ FR^#)(*$%%Ij$</$Y=]~<#Oȴ,\nYb`:ڳ$;bIY<4q!S-tVƚ#-w,e+le&)Nw(ъ(<,Zg9鑅:"I;Qk(TbS)\%R{%d茵ѯdJy/kh\څRݟR:c3ӥex[!D^ LP@2,e*DZU
J%ƥp$OqQ4nǥ'cf6[^+y2VQG.D2Øts$aDho`IuAzpG,=RU. k,f;dF,pa4X0L`q>HHz9UPֳ@o^
2F+{닒C&knfsOT"hS2ҕuhʆ	I(KZ-u*- Ӗ#U?!n74e5$rd=/AiȾ<_42
{ JcOZd*,A2MH"̽YA_Ej4Cix͛Q9}YZR'`9cO_xUo4dv1.7vGi*-}d$0y9({UpHsO!z+|m\u3W.6#ټ4(ۢDW^iǃ?~kdS}y'?M˟HW+nb
t?vEKןFW^A\m[0fcihO476LDVitxE_7^קr"QZK$~zD><rзCeFwX,h=`֍tϏd:YԕFqͽ:(2KbcLQ>ɖDMFRa#J<T$Wye=.s~"w,F*Wڐ]a˾n=_ :j;ܢ &A:XP/6Wt$4LP3LqDZLFӡ"ecoI5Ej,m8+\-?(E2C͢M֖s/hHG\sE\20g-ow||NAƦXiwPtۦoc* ju+{._e~Gx,Ga.DF@LsY* ԤYCR1NB^ʤ5k<E0C0rn[.;`9J֙EkeLjeպ1h'1q#tʺ`f&xpQՃKZr\d~~-LzNL,SM8g^Os8sϩ<fgzTY-UoW,0soB_0^ZIo1q!8<mm{Mu,=%g7xf
:hsuEpV#~P-"~ǐTCZG( qNcԴKT-QoP$(QRͅ f_IC;YFW'M`ςs_Nx[6i|]v6۾o,W5q)Dy7ym+TB)Wa4*TQbdʱc'O~-'y-qlX>\2 }YJ^М|PE̤9r:1ؑ;aB^2LmRQY!LSfYƤ9V]0IRu(M\4KQ\nV`^-ۋ9Q̋tMBgg*upq$vS3ᑅNzãϸF)c??:~k(!zWcDyslg(g# j̏{ag/w(F3Fݼ._ʖAXmzg2< YC8bl,,YG2Trx L5Poy9C__-`?~UP
Ћ]X]qUSHǡG}ª74}\qTw34yoȁ}^P]Eɺĥqp0Pa6#h,V _9ʞ7p/Z! p-G)&~.Ef^cTx眎/6RwIE!o`$Eg`8g b
CӐL   Cf:(bDi!6..<<btV\=|p|W]ɾظ~]J6Ғ͗QQ֙M>-C+ò':/S"eM҅塔A[ڝ'4pK56x|!_o bfް٬nf˵kI۵ྗσp@r}	!ZhZw,QYW@'|nf)A*Isg<5hMc_/&k	/Snra`zM,ղ
$0` zیPHurZȃ~nwC6vwco-׎Z kPfl)9߽<*Rs?#fDj\ .6tYk a-۳xodpreL]
XiHwQoM LmT_0dJ%鏌OT0.PTsטr85M f;Nl뤭%,852+nʙdĀpaX[ck+++FJ%N%eP9]L$ UUS%ۘtGU?iwU-*Wd^}/@,6ȐgDǕ5
Ɯ'2
@L'yՔoIb7 >#%El/.q.IQGB
C_ l6%MI}P4U3i3&'<Y5޺^d%LL 'PF2h(vFe3_6nRW(]^RJWLʯT+8T52ƧyYۖoR_,iJ:<;[՜n%њϽ5#n
06ܜ`نsӨ7T.\3슋ـ@O[0(TV*<>
gCztT5`n//Ř"^X3F72;(c̱	IIđ%w!NY)rSxMYd{-|fx)^lS}pχ?HUGXpp\S{ƕRBo쒴)1L& N,P UG'f#׉0DeyQZ+S<^X-x"=UQJ(T+Nfh1"mdt/V&IHţOڧ%Dsg4;KݒqȞ`vvԀ"=dn<ԃFϔqS=8gԜp'm4Wrвe4aF_T͍."GJ!sFAP\*t5Ğt썧	8;<x"вfؓ[TˠJVXPƱ	{BDR8諥Lm!|ڮBBYLÒxkfOVB¢=^̓C@08M9r!(Ts|W'0.SVG!ICXL2Be TFfV\44PI_˥Yk^LN2@k1h$Z$LbF8]ZGaAǏ2 13tzвDƏ8ڀB t-Yű=Ұp;;I 0"!hxIT
6?d$(+ǲ[v8mxzSI-iiA,738r{$?Chz7p!c'nTKLpYDҩfB)ʚ5TɔU/ÖX/xM'h1+Pfz*vU(:zrxtIu)RӦim\Ct<+\42đ-5c\*eN=,[j)[f/,72i^.$E㒳IUT0Flss})Ic1e\|k^=kvk ,v F0Os-J]m4x3Wo	|K`WZd~t}lv5ͮʾOzy&@CZ`R""tbux*`$,R!7ʹ:8HҔںEo\ci+$Suņd&4R"&Q {gb沲>:Ưf ss<vqbh5n'<QzuƙGV~/DwKtnޱ52g^Uo+m|y>c6}05H'l0a3_TdMLӝ.0_|9K{\O8Hή/xӞ"V9感aBݾj^HY9frZ4vVxsօkMua޺Mz7kq޸v)m1z2R
7bez"!yÑ P?!?l+v%_`26Y2֙eQp^|7ôIoke)Ur@GX5A'IfFC7Uv|V+_/fn83]%
VS<:%<zK빶;%'#Yu)-rP&ie0Q6rQ𴶰|EzFP%Uvxr%	S0n%w,Җ^unrw+pD7졦OfGtJ9ܣ8#h:)4xvwf{32IΘ8hs.@ZPtFY\Qsz5&E1O+70a/R*~FS娚Hoظwi-W%zHjD}.-$ V=gV]eG{77fS/|jw7sZpNƎU炬*̂ZS
ZoBb0zùe0!(78ZOA~5jcJ]9evVNU\;N3ۛCgiumK&Wy,miYxKgqxÍi+L;,ݯէ|:r-q-*Lu3˓Jɢq`( 	+F<%~ H3ikĩƂz[T	ue&Uޜ"	jA%AS2I<թ?PlfS} w %wb=Čeñ5ʑǹ<' OQG鉭SIA6<"_׫~`ϞKɀ%M_ŌPukWTnP9SU@ q=LEQ'\jjvNH0cIXC(=§A	*`}hrP~E[qA0߼z!>~G>;VK
j&Bb6=  ̲S@@$yQՅϏ&O٨љ>Lp%(ߕcVX/Z538uBt=Q|( !)-Qo~^gZN۷qHiη;o7kFu홷PH|f-?Va* {rTfպA;6;t*6$j~%a9IrܢėdL%=o	t<&!lʣ9GeNr6"e85"S͐),f[τ˛̧~bf&zggvýB0ˊ	(\7zJy4fKKJq܋/cj,otu#Oxk>K
i_WWG/mrJ`k9onXKMup{BB79o'w-A/ <WlwogO WْTl ,+N#<t̻OOQ^ea@fҖ݂|3G"3$Y4&\g8Ƭma7w	2|'O}ueM/J F[9WWE\9pSN>JroVJ"1ԿjE놸)>/оv0()x;*4GU$~ `Rf+vv.0-_gxϽ_&ɲD	2h4iKN]}p~K]M^(vI>f{='^yc\ȢC4uT*6%O4<&Ce7M )Ig>e\!l_>>*z.a{pp?G`DG )O/FΉ\Jp GjO#|f暦xF`T4}_)8KCIZwBlJP`U0!ܜ<a<7wdky|Kz[a	^y/Yi](N鵗FT /=?|]	YD<{M쪪aq_xDH0vД~c$udX#鋨EVILRq0H/-uSmocE -z^º΍ZǬꐞ+RG+c;x!}/R*Z``_p19*
&Ih%鈼LH4xp/WgL2^tk,iߌ3ifnZ70Vf/L:QGrs71z[c4Kk9NSXw݀ɵѩX8kB.(5PuPr$%.〤Bhq䚷Vj51}Fa%oC!V_X!ZRJ<n"XrA)Xb0:20E-QأZ?NB74sztYDlf &Z\> ۰^"Nf&\6nC>{zE6('bSG!**[FKgz9\fleX+ВFY(wrc[|eƷR	#.R	;*љ	0Ca4m@_&,/+AB4[AQSۨc\hHc'o ,B!}`}1]~F_JYͯ`yQQ%\)ˏfw|]s\ZTGt`$V5cPQA҅Ya:9	"x0XeN'6g 18G=yFS?S:']f9,b	j5H+],Zq,~z{df	[1Vq䁤5+]ZRGg@tR)ѱ%6vc{,uL0@!YY8][KYC[PФ6{^sEOcM26NG }O}FA3<WIH	Ņ\;b
G[)[g7"<~9י_9cy_$y8}p<		 y<IF
W|l>dRC%hcvE;Jzŧ#<^-(hVzq"'Gqj45O1c={ǅ3MǰѮdi[\o}cD"nBN姝)b9IHǭsoԡKzkšQr?Ƨlkހ>5)C1V#NIج'ոdxJ3ȱ^6ɗMzM rgMcgGΫgL]{YX*?i]vsmw<[Bf	υ  GLϣ-ET1	>Dk9k5|']u/e9ټ
1CSj#eJC_ib5aJ_$k3..3*+Z$|J7)_;CO>\<w\k*$ 
J,-J߇D&x|^5Zkc1[i a$!LJy=gLv'	4!Da6='`	!1{; 4#omo-HP|KvIVkq݉E=Ԧ@V˞irc>kx:hʰ`C*_acLlo{7j3Ld3
P	p?9odUΦ|C 7W8_Z>SeqMH7+I=>,尐YkQa(pb/~Rњ%2pG lMDNIo<]?govߌ 9w#&e>?=^ Qg FKwUT-hes]R˓zQڙjgͣb#dղ-X :ƴwaz,G^=mWHq$Sf=Co&Y]o'TbӠvQo*%ʟg'<y]u|A.#5Ġ,/HVfzc#].PAyXQA B[W\wR(朕2j&p,XY㶈ts,D2r#va09$t+%1v+L=qpgج/ʛ/9XMH$wn0%p;1'/^ 
`UE/,52!:)\e7,	=rsR.u[1tm,!V;{93rߢ-Aӝ!}2g jvh =A'A0t{l苋yY\>;=8ln	U"r>c7?~!cxo@N_Ak|7!k֮cDtG&ʔgQ%;Q eH(kS=2Y2H,K
dst*zІvRYuNC;"fŉfϬVO]gr?dyaRhYĕtU67t(!Z^rp̠f䉭EGrt^P"" &VeF%c-8lo`6.:/q/6NnXs]Ԃ~ZmfobflYn`%MqM>d3H~'Rpu\[K
YX;vݬcWӐVj?ϝz3G>|_*=|ȶzzE0e? /آFWZ^P1ĢiN*ra,`xD+CXItLGX4D`q}yJVة"'ᶓ^I=.1ԇ.g/}jж;#55A{O@6*Q&WN~\@N
{ka\W)-jmL$rlJ1s^+>Jp_ L/椄K-i|1)JZ'߸`Oa1XPcrDw^R	x¨/hX0vg'Sb=i#4{K	A^NF ]:H-=EdJ<;Qp	f@D	`3'W,g/.nMR\cc|zY^,NC/K^1*')HﷶMIdM]`)Ͼ/	"rL`ddAi	|mpfC~r#xqZ*܉0.-yA:Nsz)6;..n얘T1F].g&9ȐoAvluSgF4m;2(9T(t#ZE/MN.6JE1ju;Pͯ啛49lv&`:I$;iag*70~Gq>-25 	Nu &➶ԷlP7>?wޑ$SUΝxpǓ	ثixIy9/2!A&y?h4j{؍rnK%ĺ*h*b!Ir?qBA"o@kUWCw(|2 Fш[z|mX:f}<$t$+'ɂsSooכf_k]\_i >\SvgJP[4[o]]^HTO4v_Sת+XO<a̝D}hD2G-GQ+
ܑLOqș~#/EhؑrmAm횛I9v7ڬdwE;[_o׬ur|@˺ ?1-v^lnlmص:&8ЛFm!v!'Oh9l
WR/byTɗa@17[{-!y,dg/!۽=g8{GYf>@/z<0p;;ވWwgI3lg=<pXo4$/^oo>~jg˃ݗ;NO_r?cM? o'|Fp>%?~}O|_y}E0dRr;xPT$Iz͏ozvCɳ^fݴlw׶ki44-[{[{=Ɨ?m'kk+z=+wr͒Ӯ_NO-(g2?}[$2~2vf :y	@ GڵۿʔA=_(pF]o^n
]*L,Lao
`op_[o]\sҌqz+<=vu<+JN(\m<SJQС8dSlD^LʏLo8zLr̾Ԣ,OJ廊gL=fjWwqWl^/ã:A?D@]-DIV_rCLE]'=T?*#eu<s(^APi"M+Ȃח&tׂ/sxIrˁ톾3`_zVMyzY7Z߻.K,TkDۣ6H$P$OnmTϬ}Z2_׹O?Wjf?!=kAo?uNBd5\qP;=7[9:/7ֳپwqd\*3R!+VTbk5mǎ)QťJזzc8Lee2ϣi'GnVٺqW*DoyX{Y!y;tϓ.]@6i|lm̀1֪XPҮ5&bo '<h<cU^hR#ĥR<OW_ڥY_oO&v~'ד^ofa?-=^OKuOi`=#|๵Qb/OjO9H|(tI	W>ioicFlq{rBB*egMKQ%o?qq7>B8H?2?a0td((^(c(:vƁDg~OHޙ|?Gv.zѿQv4gFF=r1ħL	.[ezx0B `	wǐ<
8^jȪ̪ۻ+é띜Ʀ/$>zfmZdb}1GkeE5:;x62*zV9M;O٘x!|ȮW(b.N`J;FWfU@Pf{0!6719v|{"j͎[K:2knnN6򷏝4dq3_o$zݠ6r֬NcNiVu6lcY9tL9P믯y/[5( "ۏ"ljj׏5D"6סhzcvzhCV)HCʕӉcgpJ&+&aɝ7$y10\u1e5ӬbO,;NժfY;.EOw9.wA*X3=2%44tnM|w~)_;!A>$פ!{3r3:hc+ͥ`xgT,{"j / @zV2w
eH@cV3q.trFIg82 H63?l YzQ(nЛB460}	L _&YݐB8t|BB),WLB?|:Lia~9zTz!CÚw5]Wj Kl?#8ڳ1Usk#"LCw`LhHIUO|ySzr(To84t{J
Jk0i+P|<cB,˝:>/to잹~0P>4]6~k+llXiմכf^omA3Qߴk揵5HԘ,WsLExkˬz]kް7ZSOF_zno?
ЕXp/hmol<9&7zCvs}GY`G5V5V{݂ۃz4نݮd:Y%vh4ֺ^FHͪo؍vԁ,l5fjzmjlڝچլAUeuZ S]OBZ0 `ёOP:Q#	ZBteBaov́hYͦ]k5F޴5j
r69gdpyzh@
T/5MA : Ea;rւҽAO	 >-hh{i	l4jvgٰ[UlۭU
vNnBa|}l@b} zʅ>mBFvF~77Ss2hG8 V[Gofh4/a7ԁ)`A֡͆|ךvVѠנcc:Rw԰;Pɦn6kXO5mtFذXJ5W&XOw6X[$|NA_au8TO2UuӺO§Oht1%T@a+EC1<()<s#&Q4ٷm@Y1i,<̤7-ipRPKu~1CRP3U* oy/0I'a>/jZS0P`XjC>sbhkJyq쏃`rSȖ\j*#It(rKy>ړ}:f7kiǙ޺?GGNtZ*oKZf<"V9Ԯ+kS$96yԇk+j%d9>Fq񣒔GrpQ۟x-LD9|Sgb}Λd男k#s|>G.^÷9e}qN+9E-r
c )/sB\H;[QXzIOBh>0VGޙ8gJ1O?x>H{E<u'Iy5o{G/*I/~?g{_ROfLҷtcA]=?01&s23Jj^
>L;8<Fw߽*k	"!ъ-S7CǥKIGDx[ګ|D)0eLeb's=a`(Kq荳!f+qO|ջd}}U*+#5ec;%pt(#XFc]r?fdid]Q9ͨ^g^eMGٰRWы{+5+VYRXNJFlqI_ra<j(Db?Wj	LR1Э6%R<>zᇹpa̈fuܿBn$;ܳN-eiFB= 4TY/WDY0#q[	>FL30,W~SoU|\J2fae+
1X(P)D+25J'	'r<TyoXyY?⢈@Ky_.ޫkoͩᎌFЁ}<΀:hJ8 qORE)
YFfYHXPo}E-쭴g:16Uo]9 [qGz"stߕLuW+W; 1``g%wkdC􄽂TCTUV ګ\X;	{wAx)L;*?lE@)jX+`ed)z|Aʚ*SP87 j~$C_@ZZqS,V
KY
;O\cLDF q  XUȬ!ZT2z"
T.**.kkkI_]Q|ǧ!,rr<o~JAEȞ'WWU٧ʨIIdU+ Ψ_]sBހRі}#&T86@ Vu%+/8K\IjD'
^VBmSĴ"9YϟKy!#TRn<Rr?ջVJekk ZQ!t:	QU,S. =s^19蘙puKI4(H\Xe1B7> pBtLh/1Z ;PL-<zh'>c\GŲ9A&]R6#7K[@=R7`.C,Np۾+eG AC/.rTocčABQF5i">:ѩ5SErN[QߊE«KPb8VԶcdw\vDcf੔AzR|& J	P%_e*(KJ"#pk:q?bǭVTm9s0.`EP$RF  e:l<_F{P[y(OXShw (
;~ݨo^bV	ڄl5"P;{cL	 8LґL[BBmv|(5@4a~3	HM1,2ٹo(bN.i4(Ì%\%,f3ЇX)9ғ߈
'|wUV5)<0Zq2<]9Q"ӇY{A!(t9a(JucБݿ<S\jW2rE9iGPt5cjMb^$w%ťkNBO]iTy@0|RM}?]W UMr5G<gp4rE+fxQjdZ+Tx㮳j`#Y^(W`) 	mc(b^h=b֤ifB,aHPfy%V'^|:=IJiyAQu8ܪg2EG;hpO~_acV􆜎!#K%3rk}UU= AO3<sbWf^ߦd{)ԉ!,V+q$MveUfL2M0\$ɰH:؋1pY:+͡yD'ǃpwH9p ^6>ÀNaFv,SH&Y[xp8sli(N<Y\{,BDJvmnw,2;!y~u诬\}K턪vۯPxiR,gsq>pLɎpewvn/Qp&4thxFmZf/U}0pM3%r%&B79{Rz3c%mh<@t+hc7XH,Iyrܬh!1ra"F5U}ųd8rC(R1dhI/	/r/cPG~̌IfxePa-~%GB-d4!.\&$`.,Ҁ͛42Np/ʔM 1V䃇Tan zN/e&9GsOAu UdcI2r򐟿Dn	>t/cF/S{FrS0`,a+2gjVNViˑX-J4!	Svi 9%-tpJ #rE,r6$ex`KC	F	C[`(E}Nz*z*֊q<jT=1ݷ6ڧj`mF-?A\<`?SvNe#IBXhٞ+{X5%Khm1MJGY[h`hؘ1R71*$,qI#  c~Xl<>??LTmVԫlNNjJ
@)?Uq~,UU:!	O·r\5TpJoZ{*ڜTh:@.;|MN6q=%&S6:Vi呍Gr@ԷC,[CI(2YiTz4Jy p<
ƽŷyd&ņqň(sO@nh9](UDYu:N$`*%JwYbjVݐЬl4ْ!cavψ䮛l:$KJXhh$DhN6J/XQ4]	NPű?@tėS~AL>ri+T,AK&xx)9CeL0Մ)O!E_l_ʰT/j w|ig.-?`S`yq]8n>-ۙ֞qq-mYS^W$JP43ziuM9o>V;$dLFGi5֖-|sחh_ls?GZ"w^pF1^wzazܹ쥎LS9UoI/NzqNYd-n %W;:ny@:3
zBãt"Jٔ=âk$2F&-|u0f2DŃbA$cfg)e"Lnk$')F,˙x0C=G*aG8/#ǎw2eUضZM4IWS8@@2~Qb*f1h CY:^#F%kz9ά׽[<:ML}6vD'V6wCh&pM8"Jo+{VkϷ3"BkaLm_'h҈3v:NfQH17֬s[J#\R"7~37u,1׆Ws0s?zzqNw`#/X5j$Ɠ >3u-=2%V.~?<2ice%;sא0n_dv{v4Wv+÷Vǜo!_wr880IwB|qepiF{2p)jW~}4Gk2{ާbep7jcI,i%~BΟ J%4Z0AIT2B$a`XIotakvi 5v1V/z-}x_"+Ο
J߄ <q|WڢоrC3z{q67j\\mЂHM]2AxTd9Ɖ;3O0tY47 $ /m#v?1z\k9bVԤ
 }q9靹-B&ߋL`SF	 a?R"K/y!Ec6JfHJ́nR|c&Bz}`E'*:mӃLf"5{gk?~'Дf(ﴲ亃L<k,XR"9EK5}>[,yˤHO(e©Lv:0wVo6l@4Ѐ!{ :x~֋ȷds'ӡGX<Nq++|Iw79uC|l"x܋!| "7G?#%Y(Iڃao6>h&0C;I`n-`> KH.н&?ƠMЯMZ!gٽG hzh?&
&}`QbLMQpFԻJ,Xyd.SRS]	H z	MC%"PEP Ճ!atL`w
D1
Rиlf.,|BciXBѠsD2@mR<z\bM0-4i0N$@!* 9cWh<Z'gМk:$(ٱ|`Q0d m ` 