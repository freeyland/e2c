#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res res_count \
        error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    #if [[ -z "$(docker ps \
    #    --filter "label=com.docker.compose.project=e2c" \
    #    --filter "label=com.docker.compose.service=dnsmasq" \
    #    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
    #    if [[ -z ${ports} ]]; then
    #        ports="UDP 53"
    #    else
    #        ports="$ports and UDP 53"
    #    fi
    #fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
    darwin)
        if [[ ! -f /etc/resolver/test || "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]; then
            e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

            e2c_msg "Creating the resolver file.............................................  "
            e2c_loading
            sudo mkdir -p /etc/resolver &&
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
            e2c_result $?
        fi

        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up | down)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ̲] v(_*ћ,Iu/^MS޺pݢJiUe3H"{30gzZgZ0k?03kLD 2u!)ޛi  @ a>UVmF-+.Vo[vnYXm6ڟ^tM	*ǡ;pC $;>G#\6?',vywqQ7l$0gNiBꫝ}JV(,-~wqQO~~yh`!_CN.>OZAt^GIRzN|^/qއ%\coW]\|G#'wZ_EYg_1&l1;w	2`qB3"/Xa!;vƱ0/Xgn0ԋ((F+#wWg 	F#v,^d	>n	];#W/nݦWǌ0顸e0` (9Pev~O	I@q]q|˜ 1@kCSx(	iŀfnDFouz%[dzc7_ů-1k۫r;4=v&xۏËavٻiOF;7MĘlc*|)A7jexcHh{LlVw0rͅFv<xa{}{_@e#2|UFqY^CQR^ݝ21u7:Uaou4N~9i`olBd9+&jӀY.+֚wQ?80۹ݎ`&0Y7`i0'1|`x F|DK^4p4[!Ê9E=Αl+(rˮ+ЉbNt5ӱWoo6oohyAd@	d@	d{1 0 0 kwyWMjlj֤5	d@6	d@6FUX.Ϫl(̍{0zl>Q$$Snyie|>K$2`@uKJʪmYhϘZKXf_},W1/8LdjdrVm=ܳ?YٟX=廼׭~AIpy)_d]q4gT$UFS 9g>Y0N`+:hdcw$k*eDBL@2>pȑKvc/ۍ֋{Y&m`ׄʺZNhg&{̓!K8=˝Wot;hͫ7۽v4j"ޛ:noo9`os_z;88&8Rxe/ˡ.l6OgD-JBir]vr |tzrnEȉO<>2}sdɅЫrLAB!ts ,ʜ9Co Rg/`3U/Kuz$YM%Z
KW[ֶYfcisZOڋC}SI~$|shW2w\1/u9*E}tXwu>΢S8;1LKl%;qC߮$d1 Vw߾'& oK*-HL5ž2U 8-g&7vӢrX7P5D eccGo6|]r#mWݥOr~Fm~+6h2~0vgn'U^xմCy*C/1[
0u8)yzUOQa8b$gT]܍wمUX.;2F0"Y(0р9N.ąHMSC ^z¢eXnʌ~9\8@&ACemyӃ4P_S$Ò0>ZҕǬ^a_6vU*hOPdyQ[Dz1feUR/`̈́Pa\Y3!͘8kx!D8mF(cʀX'}c Y_ycY v-_fe~儞&l>n=wE #טqsl< 7g64ZԲ9x)`Rt%p<feb意tՕH)%X"Z̚0gWAڍ<OelN6 Ur`fuZk9oVwD'<%QQF	2-`y sOC*=siԘB~IxtcßYڍP
UJ*:vcF]?uw`3+0>,W*ʧ۲N!`e[U) x]x`q;K^jAL,Y:<lQq^;EM%YR/;]u5֤̙?egSn㛽V/76D`2U!:oQKZRY3{GpFsWeEe/ؿ3bϿ oPSdY#oZM*-߼z%dȤļs`ԕ֞v1VG$W9t2+7o|}w>iwn|	7,-G/v^ocuϻy*\Yc4df67HzEgVc2'oCZ$fZ_&OUGOBI)J6%Ks_@M#*:yBe:r5P<b=B%#|hCO.1ʡI ~~THʙ-Ѥ.L^ZA{z~ņ*')}8eHX!&)@
]',^'-Ru*HUjA :>Ȑh/x9q,Xו:@RӶ?ϜdBV?/}{&X__-=DBz²$-sJ󖒴oivR(Hi+]49=9>]R`z*PE[	0;ެj-Q?mIV`/-8Kɞ.\A%{bI@%
Iu13ʑj^enSvmIٚYӴ؋M3ˬ+NdG_*+>l%$'Q
1̱8L`<*s')ȉgSs|%G?ĉ)RdM7`?]NnIK폤6 ^ʐsD07q^c`@SN^f^-,_
_
_
^؝ŏ+KӠU1."`':yvZ0DʨT~͚R5ѡhiEG_HhR@+CAAus(19C1ݤ$1f%ݸ]E#MkVpSjvI#LmCA\O~.`tNg839͗$mƩ%a%*sNŔQP+f%-3l15} S}$mOG'83	gUyRo	HVd\,uBY彲 5rZъF̾2mLUCj>73OU/ط+t*LaLVb4I|p#oVX@! n8*j`^WER-d}|L5b:kDϙ[YzЯMXd=R {i5ɴ{a(V +()}.=̀6nqƃq8Kr1vWWNz{CW\,S
x,}WɏF$<g@_%ҪYD->;ϯ޼#:%*>%U3Œ߂^Z7+e7ogOm]E28 9%5{9ڏ|zX3ְ\Q󎓣zIWxtFh?k_]lbÆ+?9mѬjfSz-*ss5KZndf6F!rBcGƠl{7@J~4hWN%--rݢt&oVӷ/]9\eNܼ)o|{w-;s"HFU~C:0
̃ fpHxH>,5>4]!~!Ǘc1D9A|mq|Iw=Xtq#EATA7o^(Wjp3Ow0 d2łQ䥲"Ig^`ZLV mjJn_9+ʽWJmLԠZ5.r5lq+LVD[~+Nʼ~J5TYw
i[]XTae2F9.dXyJ&dөk|ܑrEg!;
bW,R26iܚô'GnϪ9D҆d҈1t&Gu#7
H&]C B?5Uf	bP<X'>[2KϩUH-:
BsI13]7ES0_C:֊;;#'9aN^d[;P~w`ԤZVN!ki͓1҈Q1f8>SPN?Y0) Jhhķ	4>u8x@oVUE6{~bPmfc79JL쭘m#*$#4	,'fTNւ(#M:] IONb$D4nWgE;Fb~.If@S>Wf1f(ʘvI^]Mq r:uę$UDC6AEruZ	A0.o:^klnj%^L%h:B)o.*e/<)Lge$OKS:jn#rtF-֋k#TER#%WBv^jiG)7~t{H,.<9fPD:SRU<QNȇ.<Skäq&lr$LFg3Ӱ_z
gq 
1$%|HEoڒލq\;٘wip=~~>KH[25攛f &JUsBBL O| &Jv@ȽvLIniY'Yrb:&.5PHFzX<\JaJZ@BMK(AQ5!LiΒP;OtYPxkTZoD0pZk@w
e)3h
oӖ{`~1G;>6nqg4?MMmo:&ii4lh	fCȋpsJƯ*L2i=`@vogNHq5O,oN򛦙4U?u:L$p Ǌ7qaiH=aCލg5N3LR	꘤.'o<!wzibPҤf	`O jPڈP(3(L1bnUd M^HFv]zxoYS?&1;	(P/)([L?8RsZR<V&OH(SVXA$.q&7!;KAx!	p>W%$4V?B!K(kxkB|zcN;e҄%o
S}#snB7/=ہB=X)ۗX;3P+" wCa i D}|J}3(3Ah5ԼB%, cRW*H 1nfPPA	^('aXMgL("(|c /Dw9BnE}
O$`XGG)aAE.Jz~&I~73ܮI/rLx$P>e5f{CZ(4Cφ!prIB|_)S`N5% X 	=JavOO4OO~pWZ*EQZ(JEi3QlziQ~i:2k(VMćʗFa7EЧA04a߶m_RJ@aFjVttM[޴MS4M]ޘϲY,C!K$ů	zMV&+_dk5Y|\|͖BdY, /~j1vՓ;I>q3pܭ%w]'k%wQ?IRPFk$mh$ E IzQZfN]AU3r	L˒|%-=NJM,KLZ$MhK,eJ!2&PY6[xv#Wy95Y5.␴9u&sb{XlW"-gF}z3b/>[`Y=m환L6TeƼ71'bm陼0Vj{J^g,:견>4Bj =K,PKreb4SQ@@ޘ^jhX2$۸7)NDI'.@\z2rkjU5L2ѽ.]OԦPUty%$d8#3BM.^xr#.eP.x;ƺrRӒ¨a;N2L3w	~X2V	So0<v@&TP۽DB,̽Jald+Bu}lߐxeZYܓ-*>&GDȴtL]p+anBR{9hK{bBHAO.@<`ͦ5M'q{si-'	*$dPYduF
&䡩.3"0*sd*,@2MH"̽YAƏ"5C!4lMè,x-R)PZ@0z1A<@7t2Wכzr#4C>2p~!}*jonB7BC~l^^݈Dm{"+B̵"ݩϼo}cؓN&O+7f>y?Og/Z,-lwg\EͩQn{?(W=~y;zQ$JkkSs<(LRcȨLv½C|{;:&hݘ81㙋f&y7k.к$v?lId*%FʆYHrV;#9'r`Rr\[S`ּ-z@`0:x-1;Weh0A05ơM#ji2N.Q?s{oޒjXJm8+\M*E2E͢N&kח4_x$t3U#D9g"YD.PW;C?加VicS4;G(:ӷq1*@ek2_<G0S$Xl# ⬅_vyylVj,ɡwY)'{!xχьm}VaҚ5S<E0E0Z\6jup1 dhM~PQĴF[[z,Bff7YoM
UY=HnzA wuIr˄tNŢ84Kꕸ'v95_Ѭ&!kPg5&Ky3is:eV0X20Tm3i6k:SF\`ޠ+3r(jyt62xRs/BH0?DQAKa4g4FM@AjE%!؜f6-)sh'\yp q@rf4/#ju<9cζ~KWվkx;dcpN
A18E!~",F8*W;vB䷲qZqWq迄tAߎ愔KER}e&͡14Ď\Xݹ	;?:im^*J2˨Dt)aYƤ9V]0IRu(IvKQ\nV?g^-ۋ JQ'̋%Y"3鮪xLAWcI;	ҫ1nENGEpud{__ol~}Ubr+1v<\f9'J8tIF1j<{agWN/v(3F.܆-^*πeyAqXXddԪxfkeA5ZBIvooO7r|Ϋ~˻$XN6Wq:~ԣ.zHUz=]2gvk9 @|]ԃus=ǻGcZ=_=!,XSw8欃V_94J}p/B# pI)D.r	ÝFcT5RWIA
!o8Eg`L b
C  ' CQ	:0"Rul]+^γƶ (zsy}1Qr{HK6_aVFYgr`r7)#ZbtOİ,qzD/.Г.(,b?/ݒ] ?]((Ѵ15Jsff4o0X:aXowX]s["'Tw 
o(/mZXNh&6[E NSjhE٤P.ڿD02V)LM
+}I`:` a[TQH|W疆'A0`#1VrȬ!6%AQ%Prj'sh |w*<
a值/آY=OH(WqtuWDԊѭLZ*Id<-}"@QE]crD"85F㤱NZpb;5S$#F<㼍
[YcVXi*$x=Am@Ku-(r!ә1B֟ʧJ61L4ɴr*8taKƍ鸿bSyM]Za- ĄI̬>ZxWMnT*9QDP0Ht$-߀e8S&jRjW#Q싨MISҰh0MLZĀHzu]Oh/RU[&$8F2h({FeS_6nRW(^{ŤNrcFY,c_zmF u_&󰢑G:gV5'gsӯ`7S6fF<BG%/7'X(k25ŢKՑ8Sf #Xy{<(z j-N&kfG`21E]n
sՙ7 vP<ƾ1,@iBR.D)KT}Jq^Q/ў:klSo>e9vRgb;y\gfCi._3s:bϹBJ(3װc]6E ndRL$m  ra\Ed@81NJQx,g'HϽFDFQ5D~&/,gy)1[5nH!5>)ĵO3qWңai2v{&㒑=jT<BL4}|)g8xjZN$N&5_iۮ=˕ƷlPE<>,)d5A@sv>DQ"8
{YRhl+5W}RurÞ6L$jdEʸTaO)IZ#N*j)nS6W]֌L%͞ҭZ:nV=1L-x=nhS!k9W-TC|W'u\V/!ICsK^eب`Zy̬8_8oS47*&{ ~\dn®cser49Cq:(jIȍpG2TO}hXc㇫u@~tndN EQekOL"i@cg0]]f ]bOo6A_mĔԛ
"_Q{x&H/ii[A;58[s$+K+!䓪Qū 
^W8.I"OOS}O;*pC2%ˏhrr98$RpKi^Rfi3\sssJeb!ef,UUN} ,
5ƔYAfʑ:mŝ4ŝ[r6	 TY?~~--4uS2vmA'ЬKwqWFUa4p}zC(V,.uLۈ[Wua13,G,a@}f)yJ&/4{sԯ Je4(oYLKy*b?{$3cyۑJ@\zu{[mJW(*"qT%dD7\YM陥<m⚍"_yަ1fuܸ-*sMd<*;H2L9A~b5̗[뽴ǵ܀twnSosaTt8L3L_)9+l\Wo5^o>ܨuasb]lnwsZe7n]ʤs[p3/YLl^<:|9{k0՗nM<?QBl!>6B(81ó2&-j<c	lhG$-IRw : ypOE+^ύʲ=tc\:ST%
c}:kݸ"usm`M6
dPbyZZ42J:19r]4#imagƙTz5sl¬ ~u*F0E@rRl@ׯAqN"?ɐ9=Pp(,N9>1{gd[C2/1d>ɖg7m4,NFZ{  b.^U/brYV۩A$v4ʗ,m`e	dd6q2))6@/BI9-\dӼ!>'$ZD#5"G&kl9&cOWWo^c_ݝ'#ef9,kcQ5-0U_3|ͱq%R*[hkH=.ㄳe,AײKrTUaϼkh.AI)
P2!ȜV=#UAfVY7;VkMw+ʾ~;i[,iW@|C'CPg6W/qF[6BqL {^bN513·:kB+fa"ffӦVb,˕L{eUH93,?/͙0\2b
  yAtUOJ?k	 0	Ѡe_3MKJm$~g}{}d};$89mZ$ᇜS%9 D#FkJ	7\(˦EL7.U/w *^}bSٗLr)_m/&)MbZ+.M;<cqChX?'V>s;Y0{q	
r6=:u<66zQ0b<冧z93-`1VVϚ:w7^r| +@A|f̓ODrlgYyQ'6187ݡՆ-Ԑ<ND<F=kl\.0HP~~ք[?bEbS`m7\dmbK-,*(*zpTP[hoat.drYJ.< @e\}gؒSn`<GRns آPRݨgS]qۙ>p%(ߥVAh/5Z6?uB=QP
eUzjiee,NfqHnη;o;mV\JܧfV3{ꊣrTfIs;?-	6߹eXrrnO2VG7P0Q:e{y6)룲Pm=[2VfHtKsNKg -sfBp130:Ǘz۵LlpDLZ5}VGn4y>v\@LW0&քYvq|&2(w4V)g%ڱ@$iYG!+zswG,ևBmo7n%s$80H|e=;ҷVfU4֧+)2 NRBiKW'C@͝a&\mSxƕ04]h}F}o̊܆|zsPYD/bl;?FIA'l =B~Uu@lT/d|\ŔpU#LroVJ"1ԿJuhߒ0o1 8JOy_ƘV PWHlSCdꖯESKsdYpZ4t4%>]M[f8&/;iW~uL?vޱG^fљlr):j*6b,`<FeHְ&k:	Fb䔈'g3Ha}.l>>*@=0|A=bhIaS.2CfN%Oi#֊JM"rj暦xGa*S,L4}_L8'׮:6\́!v%` y3{HLH:7' Oi:MZN!j
{0iژ](N鵗T /<?l]	YVBǦK^(̮;JX; o0#FsRul.k$}5*)rLQ0Vq$bӼxౢJІns!1Ӆ:g
-H .&G%_$	c2xVpEw^1xMvri(1i5:Z \krR6xBHTa&t~?Fokf~i-i #>v#:˙Gv]F P#8
 Ѭ5ovkZcZ(Kj5)߆VCڿVCj5$JE*d85R6m<RΣ%DM#ht19-nhvIqU.:8KE00ij6Ǻn)V\6ކ|0S[Cv[mP" 1ѩX#S&ѥ;ҙ\F/ˬ,-qm`J~r' 7'Qf|+=O \@Z4tO0nw
gz"vayQ]M}
ZMVJ'YOB1q֧Y|bb2t7xx#!zN{}*e5=DGW
c>M5$y7j<$*o(NeHୖkLϡ57>ʅYa2>	"x0XeN6c 18GF׈d?I_:']fȂcg=1NlonO5Fn5 KȴEG<xc,I)F]\k5X
ВD>D>rdN-Hٶ#]ۓeV+ +Y+5u M
i5W4-!ctAgaǞN`:;s3I_\x5#pm5AyxCo<)ϓ'cϑ=}w, qp<1Tx48<}Hʥ$'FSŀvE;WNzŧ#<0_- 4-85
B]r~1chW2´-aы7!q'$f9]u(}ޜDq@u&)קO$;8ѹTwu#Aج'ոdJ3{ȱn6QzM rgMcGL]{ٺ(E~Ҟ7U~N>Ϝo5	Qf<I\]=>Ddz:1QŜ'4ϟhAjh/c<%Nq7e9ټ
2CSh#eJC_;ibJk>3@_$k3..2*KZ$lJ7{)w;CM\_w\j*$V᥍rYD]6߇D&x|V1Zkm>i a f!L3FuuLGa6='B&c49o 4Cmw砺%cIP|vIVkqݱE]t@V˞irc>kx8[kʰ`C*_acLlm{7j6>SLd3&wP	p?9]UN|C 7W8[Z>UFoI=>LkerXU kX*JhXuZ_yʊ ' Lm"r,%N"v@t-}Sbj_W8Az
c~`<_?bdtW577jpesj?'XSxO	G
OG8ne[)0}A@e(ƴ0wEd#}x++Z$M3H	7yj,ծ*iGIѰ@\xǨ}xF<.>LqbPXl${Q+j.K/0`Нl(n*B[љW廝\wR(朕2j&p,`,p[DC9wEnGᨨFagU$[0"4|7ONcȍ]Wz[#x'YW/6_T7_%6riћH w`]%p;1'/^/P	HG%_?~_XjdVCt|[\|];nYǗ{ -6A]$bz)Hq2EKb^VɅ;93rߢ-Aӝ!}29z&FhvhQ?]A'~0pltyY\}>9=8lnE nB=I
gvB8	wC/f:(iKMDwTh")ܘX?8{dNTgAuYvz(ʚeqL`9y˶<AH$Ob&NVENJ4['ƅ;ӏrgV3Ojq0[Sh&+E
 U65lT'Q(B9@ '~A6[\!j ""UL6f#a%c9#Sl\6tO_ĭX-Y\urOO~jvoCF՛vlZmV?W%MpUU9F}(HɎH~ R=pefkZ]\jSPƼi[f~??]NUH?wjZOvk5r;RCyf.	;uqlmoUD0~A}Rq:~`pDah ,$:&C'+zG(P9.R)U]H~!-=< w1b$=]^97mwdu\hlħnxEd~B]%"vsrRcJXLiU[Pwma"H
\)`w t'tJNbFJHiҒ㢤uZ1J6aZQ+p zF}FGuǂ9wWx4=y͏}ZrZ\42dmvj5ߥQ>OғZDHpS(3P	ـ7K`x7LҹŭI5֠lǫW4ptE9/mm?ns/owK"t 4x7 Ky]IpcCc%#*hH+MeLeDm '9q/?ҎP/Ow41cwRo,Z}hw`
dN t7rm^hƷeWIA\zu	`apSgU_PMW%Gn~cZSsEy)ܾC@&MzsN80/:6N
b7p,BƯ(G1P_ =۩`0D%У=ؙg½;򚤠:u*vعOS |<8=z
]/O[.h2SFָwqmVnr$o'9E\-=\|>7 M`lZJvJc0CDcI7D{b}Ra	bƪO7R$+'fɂ3Sol6&Z~?*O#rcE]yzG܋鳕f~ڰv}
cOXsQQr,!eԊ3=6U<gȝZ`ŶCt?@[7ͤ2|ZHmVE^̜_nv]\ScZ9B>1hrs`gk{soci|b19?XorSL穄}%<F|t}+anfzi\+,ȵc$Sl>	Rh;{Gdyf>mC/@{ߞoΔG V3w7sh&_|u} zz˃WvWHv{?GM1m'h|Ɗ|JiA>MWf}}EuȤp?|i 4=դߦ9IFaj7<{;ϿkvM{wm֛)lmzO_m~v_Dѽf]3X?.h_[	0Azk?d4ߜ&ӷL)K,#g(rZwW(_7,20gN)k&gKѮ`EjX{ǿf[NFkmUwq39~>Z㑢n)RSQ5ك; 4&j	ocC60w
:K?ArcFX/fGx,S<GTrIٷy9QIpW򼟩G31yz]nX0͢apX/
܏s,V[.DFInrC,IvMc{~T6cG^;yfPF	`h1,sDV//MN?a!M$==O%vC
[/=_5S'o"ZѪw_bZ#25E"&yDxqcfR|}f%Ӓ5=y_ӯQ䚓%gll]P5u*jǴFDw^4vv?txYլn]\U"׼
5TXȂ߰6#ǇRkvg1hEdHk{4VHXU[Kl+5\,lftj{;
Iϋqw>LkKi$LckM'o䨌VڀvŪ_Hxtwƪx6J_ZJ8mN?]ckK)&o㿎>NA;>xfm@Oe/?+<tƎۃZY|x>Kc=7JF 瞣U&$nħ݁EOyqVy@7U`5`Ϲ?WI~ B;q;>G^^$a ̏m;/dc:

;Y^lQ_Ӡ?V?c#J	H}=074gEƑ{>e P{72[atՏ܁qC(`{C2n@_7_N]46}Aכ'a03o{j&I8\)L/㏣ᓯ[p֏fz>oAxRmcw@v_Ֆjnq08)_5*kaBlc6}_-9v<Ն='ZmRV̚kicg-͏g6˿>nZVoimu봦A; :08RVulmY_w5iHlW@h6gccm5DӞNM걆Hb} @V뵣5[M^ 	 ܕ+q)NlRLF;;q,c`fy` րOY4rCs?UMe;O
sr\z.>lho(
`J@ih=ݚl(FNrgYCg<5i L ?-w" 'Qi~;Hc Ӛsѧ'3o"pN0 H63?6HQ
YzFoQ(n@4ֲu>ųΙ ?d)"}q مRXLB?|:LIa~9zTj!CÚw5(0AF&#qPkIc:f/fGD"FHɑӪ؟Vb!3Rld1˩hԑp|iw
/_הa.1V<xcvB,˝2>/to잹~0P>]6~k-jlXiմWz^vc*xʳF}ݮ5?~/j21	7sCxk/ʬzݺXfZP?Y-lw~pҺK.R(nFkkmŌȴ/0}Ӯ;Tzn 8>> 쨦ݪjZj_oڝ&[U\cV8S}nMͺj:Ѷq=Rkvݰ u [޴m^[vf5kЪEEYԩ.sNn!Xm|][c֑O l}-!teBfV}Y5hpse5vմu{jר)xY@zA-C:w)RX;PPfcrzkCtAv-@Z	{kup/8FZզ%ѨٝoFgn:V}m֛V(:m	,)؀򠶫5W-|Z$uUwe/k6
@ɧF-fe0jqTYxޖWװ/`h_hYnB}S⦀[^kg
![-hD^ϿWHf_@!vM4۬5gmmU>a״";Doеk5Ś]_mR®B߶֑ڰxJ"a4gs

~AzmpvP<X|z>{Jg)ɠ Je]`yPSyeJGL2ho/b@5<Ю>%8N
 _g0W1>8)li/6OOza-!܁}/&OT*Y*؟k-w?`GԳmUp5G*PCֵ/9|'\eLolV^-zzȉNK%XaIˬ!0ڍrs |cieBV# 0opeVZ#gV(@07~TU.j{co1pѕ	=yv~S`vNaG}?ŵWmzNjx_d?yڋѼ-r.c\FnJIu!|J|fM;[RXzINb]>0Vޙ8HJq1O/{>H{E/=uILx5o{G/2I/~XU3=_/#;? %y8%H=?x1s23Rj^
>H;8<Fw߾*k	"!ђ-S7ǥKqGDv0ګ|)0eL2Ae}%8FX8^'y݃wd}U6W"Gj$!>v$J1fcmL,m|us>ǛRV(ϬLC7yewD5wjT,FdٔBPjyP>E#)'LC!'1Vs%mJܥ+y*}&sÀIm0#:#Drs&pDm0M#7`Bu9MCrEQ/zi8пlcQojQ%90cA򻟪{Cȯl>(cIz+eBKX@m.Stp"c@Ž񆕗 KuS]^/.dv!ݺڜJЈo$
?Oe:hJ8 qORE)
YFfYHXPw}E-.g81@mfvW*7h	H[S8d*m2Ќp {Lwݳ^e)zoZʹ܏nxXx'"5*BHW MWc?FHfnԌ.'l!#pVtVV'˹A6P'C heh*س?Xq+/e)o~>q	c/2ᓳPhb+M*++	Ǐ+J6> v^wyp	ȷK)m
r6=]Ut/ˎRB2ьCfHU{b֎抔Sl!}nJxBɀ6R&o/ϕ,<Iir%HΧQ8ɂҧB+={p"AFZ`}}9%y,PL_?7ʇWV8A<cJEB^fzrWϲ2Eм0YeVJՂzŊ%_c,tIZZNh.'~x!w̠
S1\
fg'ǬcXΊRb= l)Prn)VK^~͍)Ɉmq^sbMƸm_ⅲ#AC/.g:Tnc9*k ҄E|>uSCɒP0ox+^]G%YE59FwǰgND<F3J$!ω`'7l@	UQ62nAUcw#V{Z&so,2+g18`ݢ/^A481L'ѻ#wuhJ+/S
-rj;cfz[k5X˝̊*Ô[_lI_-;ar	,A2U2rgVRW2,|&!K(yuYe=;son?@w'PY[`lJdښe}(,ƻ!(cu"(,!xaq!g
-ô yT;96`dh:	?0 	u2WVp\|#W(3ɡ&)ND:vRnSOO3BoFBe%1=%tR	&3'^aK1Kv~~U٧d9$|վ)jW63i5Ӡmtܧ&k ݢ0P}I4JT-?6fWGʐSTJ{45jsl"HY,q܁x]>H* Eqg͞0; 3oyN]hz&i3?腬6~V8=*{1{#F:SGJ<|Iɇ/
Tĸ8#;IS $#{P)ɰի=H3"NΙM(DQ'0y*7 aPjƮ`؉뇑,ǍX&|EnfnV#KeSCw̭)0#xZ f'+:uGVU:/\}M-Aovw[Q q>}3Lv쇹;,sv{ Ӡk^&%L<Up[$IIF*riC3X$mz+B'Ž: )U/ ^ܸL鹺
/!2}dVr-NPETBrDp)-h,dp+R1/ ?xXY*VVNa39/Zk"/nnjWL|qR&y-r4v%Y 37h?1"[YJ^S2 4iX2YTV̔phr7Ź́CINPx%"qRr[]UIuJ]4цU~z}j,:jUE+%s.>!'+[VqP/|-9vŧ#I$AƀUQ=8)z|`Ѡꉏ6`5:1@zq9FvfZvՉA$:C]G=𣗩M
U^W[eȀ	q//3@e(VN苔9¥E	%&ġ3fJ;?$gRy,RL_$k^ȫ/299VGA5Ҏ,F[E*'/`7^cW7h#\݉2'<SrT=|WFZ]5ؽ{$h!B)SUQmpbMf{PV~3E ,̋\-y79{U,<LˉU9g)jbPsA}1~,s'?Px"?!6[+bzE'Sՠ9l^9N|n63|P/@cRmmIs-{C {Щ;6!SLlX~DQBy.,$%(ўp2'ۊ\!dHFY-1<cM0i)/YS	4/6dH&L9(jVnjs9(Uf$T)O%F0SC|IIGM%v̌𘖍O>[3+HYɦSLbrk2	eJhh$EqiNM)/g02p O8 Csk:Ѫ"b∎ %1N<Ô$P?cL5xB) U%m:eiZt2
Y^FY`T  Ys3p^ǜ+E3	̚r
%SbL
:(vh~a0'<!o0-}{3=<̏&MHv4XSYO~/DQ,5Wk|w/{{?lm6bبͽ3<w.7{?F1koxW*wqM&Ts(\сpb֩aEԻlaϦ!JQ4
1a5-!zDX,UgK3=>1D2dκu,,g)OO^|K0(\u]%Ugsq$ؑ!{ʺ<d.`'jIh4;juT"(I<1t-}Eʝm*40"͜d䝘	xe$4*d-/zƹVEMLB/JW
\ x8^$e!7L/L=ଡ$TO2u3Ѱkf[:[Ek30][,d*ƍ:nh&BѾ:
m74t<h/co8BG'H8#w}evsݬNcN!olR>31u}Ϥ凋Xi2KjPE!;pJIwI'-nV9ʘ7c?ŕa{a gf>\B%{Gȇ]֨J 1<A}4gn	]xd;mN="(yxSNJwLKo aW(m-<|iWoi7BZozww`HmmpHː%Z+R?=e8,-;z?ƥ:q{x@-GT0TRLŔ$V=X4%~DFO{5Z+HK%<`Ds(dTa4ab}'~˿MMGIi=8f㐛urx7=ǿ^KޗGxe:nBo08'FxZ=w}so}/FR> ZK9-48qzGi;k&$Q&>ҦN:bǕqL&nEM* ><^ޙ{k߲ d(MhS1e5 $#"(%ڋbٜQ@tO><VJ5@oWj3)hPR/J9Vnd2&C
gL=0Md:ЇeNIdӖo.KP
NOoK×g:[W /dfEY2I,4}t%=$!QDɇ^]`EDXۘ.+HyE#A]#DY8r׆inH"%>%:|1t pm07@ 1ۍ< fPsFKL*ZE1ԙRIKd̚M*l c[Z!;r=v6sx@jLD֫!cjٶo\Y{{:	,uK3ƹkqt2AxEj@I.<C X!&qVq"%]rc	#ע EBfCi">B<qP:=t~J\gYKaO/~?tX~Ӿ6k^ʗKE? g$|tk?jn5|MjRo7]ks b 