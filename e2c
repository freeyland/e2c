#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 &] vƲ x^"]7Y)Z%(Ijq:e
$U)Zd~yzzy5kΗLDd&	$PU$E{X%2222222WXvzhuXv:7vX3E,@9ݑz qI9䲱h9i`MvݾG~6X~wZ}E۸wrQ_}E?g |g0?<4ps>_^S-[fz@J	E?$k=hD~W}ɥ_eyoվzvE0c_ٹLΈxX(i d+ر7v7=yq"7<sÈŧ^DiG1.;ry|v}( dBޮūq0=;|g+ߴ51Ap2dz 6̸5J&O)!h9¡7v0g4X#pm|p23E3D8;؍(rG"
)YZMkd|u:no6]\#ؙ?/UOxZ}7T޹igSK9ѨCB0~OϘg*?V1!pxw#\idW_͟ޱ7t`нsd^P'1B,×QmaWEE.4Π8J
߫_sWFp~Ճaߤh$w׃hȉN+~c+'`^14QӐrYnk~nNp7-vn0gNx /Gw8㋯Ƅ(fثTF&+dؙ^t:ɶVڭ*vfM펝(C-Oހ<={ovoo6PEv.٥"9]*\-*EŴӂbr#/6MmdmME6٦"ۋBoGyVx0B#'D"6!pjүMGjDh+fꊒhۮVeVW}>V똗*	&2PGufO#cz&e.ouA43	./k+qߒBv
~DΙv, XJ$i?$/1 ٘5ŦZZ3̵ȍ%;	)[`U4V6M|kJ%<dd>N0f^o`Ϋ˝oFCM;hiD7{qg`f|{{[;wiF
,X:v`9lނȵE}\N\2yC/.Z_ Nx1,P^EN_Ƀi#_y~H>G6JqozuU)H"αbvQ%̙3F u6_irn<}P'jyM0*ru_־|XmYa=~OڋC}SQy$}wh׾uJmf!/M9,E}|XwM>ТS8;3WJ↾]IFj A*EO8M@ $&Heg9N0-T,N|ZVyC
e I5(jrX=hd0:p'H#ҥN>Jga{h_$'[;[{?m66WX9Y?@I:\e&+S/x|7mqpR`]݌A- [u[C1U!  d^}5xrj娱BU**|gFnE?r4KH,]Ԙh@EaߜbN'0G>BЋTX4KUqЯa8PIBP[]URL@) Ia|Wkklmc߰f}ͺT%*EȫH|'0ݏ17`U;ͦq! GgWBL7B1q
Bpڌpiª/9鋮/~a`\۴W0>W<7?)_e~鄞&n=a^!{ȋ
y?pmKA{ӼBvTQP76/\Բ~=xbR%pDfUbu意tŖ*%B
ub̚1g
2WAo+y~Nٜl x-@f5^k7GK	"ހj6<oscf=si:ԶB~xtc_ %MP %N;wCOjt̭q[֩;|/L$oj</l1wz0DW*09}ɢy&,|٢yqT&F7Y:HgK9 [ttBUT8ɭYu%3=MQ4ͦxo^=Cyup%GHwL>2?GFA/)?K1fQwT4F/s*,,\"
Lسx7J7qb&@K}ɯ7o,&>2iw.ƪQ	E髌: #
-[~o?[/^M(eQW;{}_xxRZ2J3$=\¢3y1ybYɷrXz![r-BNXu
E5-gKU"Q=rpҏ
z}\`u3juvǊ:)誐Cr56vπq;PwɈ6J!JO.1ʡI -@VHʙ-Ѥ.Ln^YC?} ')}X2c|j*!&)@]',^6-:t*Raz
dH4μ}O*%EtԴ-nA|o~p3'</+b/G#):B,a˰po0JI\i4"mcړݴMaiR紕XE`̜(eE8RE[މb޳wYLۢ%	/	~%ԕ_[YilW`D$KŒJ($=,@D9P@P|율-ǂyzծ(=Yb7],,2̯8"<VYa[.!I<jE`S^33-0w}8/}6e,9Wr
 #-!!,1@"+
wK.tCuks҉aүhɸT|PbHFFq0kH0eրR+e݅(,ΰ4r1maPvsWj%/OMZl,1%]ct-+	
hE|:( 7ـ3T#Mjc`n]"ݍU4Ҵf7_f9%i{hrSSxד2FKXK݂4lLS_aE5c2q{~,.iqjIw~.E}	ǜչBb(%zTAyS>g>OEqRNණ'l{<Y)7N+kbUY.b!Q^Yk9^hE#f_6JP,8(vuncA~Wj_L 	nDC
!"k?dȝFE/QuU$/e2Nנ}Ǥ1S̶Iw^˞z:蹂~unB$F/~COD|LNCKE2~T$)[mfAUHa6Hr&G9I<_`czug8%u;+i'yU3Лh$8^8rCzwU
Jɛ%),mH~j<铽+>_WZk99?*Q=S-<o~㨹YvpVk}DzUdFX$"8fFuaoVkj}qr/jb:=N.S28Ԑ&4lH_ı8ofUPs4m&.,iz- mB[BKcGƠl{7@Z~4hWN--rݢt&o^ӷ4/]9]eܼ)ew{g``k_uEZ;,+C ƨu
aA
4B	νc?4}0Y/k|-hfS[=EѸyCB/ɝr(/rt(zŠIw=Xb9 *WϟWkE?,̓{*L>Lf Ed!yHpeD2.H۩ole`ΊrR652V!ҽUR12m y}wB~+ ܞ/Xo``e2F9.dXyY&!dөk|	sMg!;	bW,R26iܚô'GnϪ9xiЂъ^0i:	L|L:׏9$Ůp!Q21(LF	$VPg]Q4_`٩4ĮOY{IYvFt릨sfkBZq`a~ΈIN9ߝ385%d-y2fQ14&z܊PWT?q8-ygED8sGp#S	)-P֫;Ko3@i|Ĺpp$UE6{~bPmaS79J+3[1FTIӻGhXMҩQF$t7 |H"iݮϯËtw$}.Yf@S>Wf\9(ʘvI^]M r:uę$UDC6AEruZ	A0.,tغ2KnOJԪ&So.2/H
P՗*VF;6[+=}@,|lԊjiQOџ
DJBv^
فi^ЏnՅy8l3HB$`t|(S*\Ӥ&83`s#d2:BDv>UUM!	8{=G-z|w^ ̀׶nڙƼOs쉈SYBڒ1400Pj'-X`ʔI_E?r:)zr謓WF91Y\L|	 ^%Z:CRFD!Bi&H% QŨIH!LiΒP;OtYl:5?`+ jJ=5P/,TXxL-oeKW't@{_z~#L783Orja
<mB-l޺!rH*>q2^!Rl'NE&^41c gw3'djN򛦙4u?k}:F"͙xMr%Nie804h0!FY\3ښaFp}&uLRxNx&B0'A=ĠҥI(*@&9$%*<ķQPg4R(S@n5E5'Do8,#augK0X
gMq4$ 3pwBHwFI9qp}#u=*8%c0)uT|d4DBа >mo &gR)}c<ɽhO3~s<6NGqኸ#6*KN#x,?ް[sĴs$CƘ&4-)SzOpy!X\gB$NUZaQ1Pa!'a r7T(Oow<1STH( ѰZ

0_-ep fe쎂q`8SEG5 
17rIDyǜ#v2 <bH0aMu(b~&$r&mxc{PɅ?4b3?әJof)i7/1Ӽu ;.)f(S9lH4\R9צd}a<;S{	@3@yBjHI?]?m?MӠwC+IQ`"0Su(>U6=N4~Zb\
фfim0-BFE(C@*+EX.~{+~;WːT-cj^$ɛțiɛ1X|Jd
Y )_JoH!oH!ooEV"UdI)V: pzfrG1n=%w䮝ܵ
OJk%嵒6ZE4$͢$$IÜd祻$]3ˏg`:%c-q1K[zLG{D{ǕɛIY<I4q%S-Jd
:6e±!m*Ge'|hGmBqѨ_5q[W;ji?3ԛ|˂oldJy.519ki\ѺRKW:cU˲
|АJ"e/LP@2,阊*DӫZ-)KKy/q%O:qQ4ȥ'c!J-ba	VtDmzop^EHWB"HoLF90(-X$| }u,=RUB0Ut+w)UdF{,p2a4X0L`!>HHz0;%߭g/z%be͍W
;dK%[B3;%]eīM.3"jlR)EѬ09r$B%+`z/%[ѕvPӵA[UZ@.G
~r	Bn6i:ܛkNkM=IP$!"{^4P7!M=uyid^AT#}Wa	-oBe͵"'0(R3!xHÖބ<˂"=P͑ēT{I'qu';rO3Ti#	' kAiǨF{
+-\y@qછ1,%0AݍHD'J;+o\+ߝ7V=rW4	/&]y1)v㗮?Z̃j2ڶaܕcisQ5FL _itxE7)_Èr&QZK$^D~Ń+5TaXК-ܻ0,|/"wG!{<s1lc⦛{-Pe2Zǘ-VHir\Օ5"N&d\G8nҨ]hCpn&:Vwiu_ :j;ܢ 0A:XP/6Wt$4LP3LqDeD-Me"56Y&Îo)Qd'}seK%er:"לsp,"@s+ⲅNi"ll}gE'~8N:
VQz-?[wjbm4W!/ϚJM%9.+%ّd/01mΫLZf@S%X	jfSxl-{0?Zt~_9-Rh3˪u92x[Ob6Guq)L&S.y->`pAoo\M_֬VKlp%qEp桓e0ꍊ9B\ʢ8	o!?Q_j>˭X\E*.-6;-J&NU9FQEƁ89`ӵ]U6SP)u'{)\@d߰:M97cN@<Mv`1>㇄
Wۀ5sGS^s1*ϩ0o1̭GLB}&P:2RsB<`iv,=L%JBBsd6T+sZ,|Yp AAr<QE֛tvDmI7>,Cך:w"<1Sj5*!iXp{Qfdʱc'O~'y-qlX>y \2 }Y^М|pi̤9v65ؑ˽sӆzHaBfLRQYʮ1%d	ŲJPd9_\^0kMŢ'ٝjy6%ً%zļ>\ }-]jsBMū3l@mt-ihwHbtl~d~QQ6T&)^g[[?l\5j.S'΃pfk߼{fΉrӓm-3y^řfݽ_ܨ林Ewɹ; l
Mw^},?C`ƾ+ x'3V%ǋ[/
%۽W?3-v_ׯ
j Y{z}mfΏ5g]kǡGº74t\wYyVo}i]EߦhѺ}8Hb^`zSw<A^&xPeDOB>\OzgE"ԄC}P!ܣn-4RIEI!oh4Eg`KQk>,$@H8HW`d2QV';XQ`ZK<49Fcˇ'@w~LFZ竣390+ԑ]1Ssbq>ye4,=La	_HRnFdB<hOU6=t|[\o WjCoX9[f~=rZu<gv-'ln nx2AWőGּ֣2KT)/gXmff &-Sk<D²lR$F02V浍LMYe}I` [_TQH\熱'A0b1rȬ1*6%w}8<*_s?k,/1za_Q^x1@C-5HT\꧜2k2)NϬ_ਿ&T0P-鏌cOT0.PT&sט׬e(N v<۠˵*n)gXƇq
jmx֬Yij1-){Vh1Tc8MIUIgvTIU-*W[2̹cx ×".EOn &bfYs݂j7tV3	曁jA"ي~68#t!HN7Y%QQb$G/[H
:OV~rq'Yl-Wn
8`(l*)U|Y~M

|_שVnq̩6k̕>e6mK73/tn0<4@;sKoUsZ˺9}Fk䧰L|W/07h:*yal9T.\%_l\N-XCq*+ogp<]i/d9lv`Cf1"NGFSn<*cU4!B^z"锕Z>8/ O5I"-k2(";eyMH<~"6<ug\	!%1.I"(ndRLh/m  ra\Edpb6vkIaPah	ESق/s' QaϩcޥE#୚MH#>gp*ĵO3aғi2v*)A=p"jT=Bw4Oɺ~鍞)jkh918HgԼձ']4WrвeaVkT8C͍/">1JFAP\)Ş썧	8IT<x"в>ؓLhTˠJVXP{BwR8諥ԺMm!|ڮBHYLÒ5gOVB¢˺^̓Cz@0xMN9r!(TC|W'0.SV!ICfX^eR5X)̬\iXҘb_ɞ_Yk}NN^@k1Ρ$Z$LbF8]ZGaAZ3 13tѲDƏdg><B t(rZAp7@/h{{I 0**Óϊ+^$Lm*
bSVrqDȢӛJʸ*J#I
D nY,,꯭o{OF Ax
Jq]0})E.1bd[<J]\+4E2%ˏ#hvr9:$RpKi^Rbi3MLeË9{%eBweKX,W,[pbRa2y\r9Rf2nkij*>M]5e+}h3rWs}^՘Un-5olx(5;?KYާ9Ҏi-®10jQku\w;2d=bybT7oN1,R4Q.6}Q`ט~eDQ*KA1?bZTy*0Jy\o>MdeKïۨߊm+T}GUdY{L-'<se52gT6k>N\zNU5H e_[0k2lRHt22_n}jraZ5wuiυQ+30!.B~Ystr^-J}Cd|޹Qȵ0oZ&˵8ozI=gf^_IYLlQ>:|9{k0՗P<?Qn}P}K(812&-j<c	lhG$-IRw :H28zoڅ4Zqo|qV{zJ.nM19	KuK81 u"smObKM6
dPb޼򭵲&ieuc$shF3;ЩR*k@؄YeթU312;@iI:b9\ŕc8p$C^|CFTd#:`zLQo<ĐLrJ&[ꎦKY|i(Ӏ`<*^B (sAS?*I"8i/Y`e	dd6q2)6C T/@_u2i戦ΐAZ@b՚OB#51ܧO+70ha/N*1ACըHoظwaִ5$qESkUm%u9~X(3})rpRlLhH63'xt9XS/ fGePk[\MHʠ[\XsZF^@bz>z/_3d8^#PQm8rv	K1vvv{9Xc3kyfxWt3fiS7+UBj1sCZAeo 3,?/*Ps˔jSPRbIDWM;S9[K0 J!0!Ԡ%]5d,&/JwF޷GڷMַC˓3ЦeIQTB4gԹyÅlZftZJ}7>jg6}ɤ,22LmZui*
kɲX _xdqǅg(,S`ʑPW9SRA)7<E_׫~Ϟnɀ%m zDչovGC#^
3s<'cH8EhtVl4^:PCnO
8QQpZ<a>e$]Ղa??k­")o@x~.@
1kTsU=:*-Z:VP3,l5o`@sl	./ A+U>-y%Ս.x65%ʯ&*l#l:u58~WX	lڷjT	GG#*)W땵&rj54CFpsyCݲ[gr)q5ZYc@)k*2QT'ͅgr&Ljaɩbtk}:z>:x޿!*ѮҒmyLCؔ쮏Bu9"e?4"S͐朾D[*Vbfa"t/BkݙHVLDžY+WɣY`7XE䁼xASw.@ kjQ[3tk,WHM|&2(w4V)gKcI<ԪnCW<E#YBl7n@P9[$Оe{l+q*#pʫf{-Ps{	W$ŕ047$+ߘ^cYF/bl;?F	 ٠6||!ꪾH 6$aPU~siBMjAV$_V)sڷ %y_Ƙ֐U  L
[IܹbSHqx0IV 
M?E=Ӥ.9mwgjz6=u5xNo`;=2d{'OQWxW`7jdhB`$FNqr>-$F8m/`]T)sAp_#>6 %:@=#z1vNltPRI?"TTdEgV34<<S`Mͧ"gy?(hM^*cbnWB4vb	Id5	3D-od+t!H icvETJz>:[D^DRǿ%b.wNs&d=X]ZJ>6]RK#6#몮ŝ#6B]ƒa$yCSn<Ea/Y%2Y.	;j*9ξDaO52x(iQ?tn4:<]CzKD^j]TFbrTLЊK>&/yK1lH	7iZ@^L2f/:_UvriNQ8cFe
- 5J~c|\a2=ހ?k	ߏYw_Zq"O݈Nr@Ǒ]CrAo〒#)qQ$:(DG#׼ePۭi5F.k5|/|ZjZjHTp3qj8l?y61GKXGШ?S-crZ:;jA.::7KeiՅj(>M| a%<Et&\6nC>{Eƶ(e܉QHF#Sfѥ;ҙ]F_Y;[Y%/F.dƵQ(q/ʝpV*EyT
et{q3PX(97JozSVBen46X="Ҳ0I;3["zWO//fcw7b焃W'aVU+1s1AxX}IEa,<Gr]nbw/kNVTjƴ|l*Q#*y3\0>+̦'3*Y>ɾ-RU.Oss)otHQEse殚lx`̲'ƩMmv&Rs¹ڍӣf~)^ȃYoUy )㨏w͕OѮ -)LJe$#t
`toI:ͶP؞</K_
&W 3$+kC'V2sKy)khu M
i5W4-!ctAgaǞN`:á;s3I_\x5#p|5Auxco<)/Gcϑ*{>E/׽03aŹGCFR$<1>bg^}'^|:; ꁂ/
<9S ԥy*w;.i:=v%#Lz{FXqw&?I>nESeH_[(hp,>e[7IYL
[GX@~zZ;ɺXlj\_2iyHjI}-Q?Ǐ(=pQ{Wr6ȱO	WUynm3&Ϯh,,JMqsmw<[igBυ  LO9#s3M5H5h.2olZ)wU2]~/xƝyJXҚ0%d/ڵ_^~}xj>%..5\h Euxic\xM
C"Z<f>VlaHҰ_e&3VuuL0Qq	0͎ʪgZñ7P{Pߖ$hQ%$5xԉ>:Sz eO4491IǸx9huʰ`C*_acLlo{7j!%&hl{@IBt?t._*˩8kGJ|j,
if%3 އ~_JR7ڪ+bѺwA/yʊP@,CAF!tCDYJD5sJJb/+jAz
c>P0@&F/,
2l]k[,`?'͢XqKBkcSNjgj,L_$
1l`]^2ˑ>tW{O5RG\.mm"(ɔD$fЄ}꼉k5Fj	4裤]d_"REk.}pMF<.>LqbPXl${Q+z.^(`;<(nU{!-r+};j
?
sa5E8eq[DC9wEnGr#va09$t'1v+L=qpgج/ʛ/9XMH$wn0%p;1'/^ 
`UE/,52!:=-\e7,=rsR.u[1Ttm)qђUra3N0~ܷ̄hKtgC;d:ngﯮrkvZ4n_nЉgk~#"~^?Ch7 3Ot:Fu<ۇ[AtB@{/xO=H}q:h^0buCQDRԹ92py
ȒZ겮P5),rmy%x:y :UZ=hC;)moZd(?Y=8>.1B*(,|'%L8W\xV٘zYEJ XSuF5ۨ'Ol-r=Q 1ٴL,k8ϸ( f㪡~PbPhj?_VZۯhw~{=m:W\v[vFZo>(kK] 8tGh0 $;>.)G#\JKɭױ`w۝:gwwq:un߼ws	&/kr?Ͻzָ5JG>z_<xyE0c?ΣD:E}b?EC:TtQNmbV񒰒48m;BYHb/:`UǠu\74:WDJ6Kgz3tenfu|^%lBW	;:[X-j*$Ĥu6&@T9vGBD/ WusRB^祖4%mo`fǰD9T;2˨2q>Z38̹lēdjZ?+F{)3h7qV͐k4$=K@|:'LᜧPrg<ݑ5ŵـ7]`|7܍ʹŭIkml@݀[/+܋ie	?iy?}SYʉݴ,YDiZ?V<"7ø/2lڭBN4pA~$3/NK;%2?4h=۩c쵥Y~?Ņ&&F&g&9ȈorAn
0L]1M00^RH
gՍH kg<=u6]%uu*ȍجKj^(%-XؤI3fiE&J\G}>Pe<NQnԗׯ!HOv0͆q6hdAvskt/&)(hEf2vӴ >|N^G^=LSLhy^	͹o4GVh^&nR!7QNBE$'I.tGa0`/%[,vAq.O8i髑;vO>Fth̏IK8t,  3^7]6ɊIhf5ۤofiޏǿ60,7UhZ77t{1vQ=}̯~}ϛVn_2x	kJ!@#q0:Jns<PZqnp;XBܗ0XvN'h릹Sx]QjwJlHZs]kt~9Fe]!La;/vwڴz'f8ӛǭB@8%!'Ph9tJW/cTP͗AחF1w]=:k4{neJ}aE.+bKHvEM<?43}{O;P_!=
O&7g٣"V3l{f|z{N۽W??K^_ߨ+|3p/
~gS4iS_}՛{WC&,Wݽ[/+MO5iiN('n<{[~7vM{;v]-LZӲ=}/Wk|33R^(^}A?&4⯭fkPo*[][PdRIP2~:qDy<ȄǷSL]٣ݴʔA|=_(7/<S]v._߱`0[@C/{;XDQHi)t܏H
Biwղ
z#gl
ȋ~wTY5FCu4²A]c6{g733;Yv+ϳ`*\3qnvۯ_=-8_A&yԲp?Q|'Kצ;Zs6 %ے%&oё;;x9Qsj#/Z (˂4dK{ӂasњxIee{SEm9r 9wzKO\O8olu3Vq'%^/jȴ`{J}༭JLK:\?jZd['=kAouzVƅGϸi4$QO캶K_7FC5MMOw|stœ_o0̳]_Uﶻ.2/~IńȵnBM.bEC!7!%N|m	bGk8Lݐ%2e^mOZ"a)WcA?m+\<ng%|V^3<$BdrkC#`[=y3 mut-׆V6C3VPf*Ji1B\*σ;tumK)&oSg~~ðןVRIէx:4Lؑc_}{ڨOݧi`'uFɈ_=s$Qׯ{?rQ#o6؊f5_ȍGR3JhOchd|Bg//X鏠̏m;/dc:
F
;
7d3tͧA$ٛ~?Gvև.zѿqni4{/>eJnU)pGǱ{yˣ Ioˬ}}|8uG,Fs|\L/fxJ3Gg'|}ކ[~_EۛudyzF6&^eH?`?n4Vn@`|qSڱ7Wn[];=?wYb1fGEl'_z^FqmEX=o^6w4dq;l$fۢ6qNY	f5^zlc[=|	rʐRo7y/4;("ۏǝ"ڽn95"EסhzfqN)HCӉcgxJ_Q0N2676t%x,o:#ιZ&&xlbSuR^V(ݤ(ǥiF@1siSBF0SЭ/ca'3<34A[pn['P?ZwO"Z#rOD-HJNSA8	p5O7(gOIs*	b:O%exgYGA:#o=|'\0|~dv#V%"}q مRXR=u0[sB,k6Q^i`\/=LFIc:/fGD"FHɑ؟b!̏36Sh1hđp|Ui
/_TaҮ
1V<xcnB˝:>/Wtoꞹ~0P>]6~kԯlwlXiӶ۝㞽7vk g<Yn?5_l7d"`!y>uaoVwtN>	6*!$@WZ`iEʿ7|NKdPB߶Al g&  ;mwqcw6v6ns7  z\@yl덞oum\4,@Vm?n[l[vaЪEUYԔSaw@NC.@76:<mx-!@ޱa!ڰnC	4ѱmi[6)x@6[,Fa)RX;PPcHz-Ri*7XH [{đ sg݂vۖFa6MZY]=4׵PXC4E[нX@ހrO!IF]GFA?7Sse0qT5YxoTޖ7/`j_hYn<yqSCcSцG$n?t-f:(O<6z^Dn[v*ylwDF66vM)G] (6zvi';h-F{>ѯo翹a`O'ge;iSQ'G'y*0]6E}Fٹ۶*sP}zj4ZF$\}~Q48)(%:h~-(^<|&05)t)1e`}u9pSOl<uµZ-Kż8a0)d{.5llk\M Ǒe:Puǋ<>Wx?4[zV*ÒY!'Ua[ ڌ(Na@?JvZ=GxӭQdn$\ި+_{u&979ȧ4"9!W<]7/	p%x^ "}|(EUUa"
B^^2'.$.Bي+"y \لb0]6ıQ
vq~Abfʱ畯(i4v),Z˗Ѵ/Go_:~¿KC/?;? %98%DI=? 1զs2Jj^lϏy1o4}t8IC%$=<Zfifyo	q1r$Z`)6fLeeB*'s?ˠ(KqMr/rO|mWل_) Q$JǑEd,did]Q9,32SЍflbx_ij1_('%U#pᤢ1Ter5L"M}ѹX)x	S&)ĠI ZQeڤu6tb%kd<b.|7
3]/2o9)2' MƙNQSU65|1b0#%_a`D{6/{~uWMs,률d#+`B3+XGRtq"wCFŃlUW KY*T/P|aY5(M4<PܱH1į2WyGznA\eyx|>αeWJGr挽C]Z-;`@S};:*&+Wk؝L[?v1DDDTA0J4mk:;d$ 8^&%H=w	Z
ZDơ% acfXd)foD֤pŧ8 iK݅3}$.{JӝŞAUT\eBjɄ;CC'c/hmBͦ[7d䄿|A]GV]wDvѡ*I33y" O0.j*<פL%5wTIt=QH킴	]I;ΘR"5
/x!)gb&(kؐ}x3䱪fbi5TDI)ءQ(;NO8*3[V5]mz	Ce`fl(Wff%\SoU@H ~*`ƳgNw.P~y!#7ǚTwۧ2~.HS;w=!f&8]-V=% vI^<ja 5ߦS3ɉCns_sbͦՊX # hĠnlWteSC飔P̍aBwQ45k->:ѩZKd)Dw Gؔ'܉hW%(H8ͤZ&@3J6@URǍQt[woCG#Dlu:mRv2ûp4sC
=&[A"8^F5ƠU:<tKPsW}aQXүSQ(8f`Fxbw`Ban縪BnByB{)լ	; #̮	+(IH,ʭl^zA> ;70Ĭ7+2TU7E.Yi]AC>~.⛯BD%c\!\`*2{2I*ь!TUTS!f$=p
}Xe-8"r7*lrKF+ٯ@8<UWBM-ܬ2H5.7Y!<.fEX3iHyY.v(n9,tJ<4wB02_vu)Y9Úr|5e4W՚&)6Ӡt=&k Ɲ0Øfhܕ ׾,~?6e6wȜ"=Rś
8DH$:a>yLUgq_Sx]{n?/
x]?k܏G)[-T?ņEO5p2J&tVG[0k,~|Kf^,פdY$v:wbUKf6@nJFߏ<<B+Z̰8ס_leF`n	ٟ#=$ y3猯rj*fSׇB؉뇑,ǍZT8f|zf]#KQBjN<m\!\"i,6m0ʊNȹ5OwA]4;+_S݃+"mcY	ü ·g:wX&oqgxJDDB7yLx:DWE3Sg!j1y쪾!jҟ+(syhd@莨P 2ӫ=Ćy_xG^ɽ: O/	v/qu,^
62`F'+4oa,4Q6-BpZbLlXK[ΨՋMQoe6zdz;L?x6_pdaw$β^wٹƛvAB>[&KaNM:Qd]~(8a66@wH[!+p&lSlfu!՗afs t
dL֜ղhFuGu̅G薓ԙS#;ʋH6R5d2>[QԀLtWyd-$	Z_0.U@aץeuRTkΌ.!! Kl%		\6ʘY/
8XrċOgGE[^(	oT>VGA<p&^g >ڱ'\;j%>v,`Q3QIfNYs6KeVݕz'ݱΘndk6@{Ȇ iN3B}!T,QM֦59,J+9-")Svy 9|#V`6<U8+	|ÐWH	8"ch1G:UaK{C%0P֋|fܮ  {F#w`]w5[c뫵=7;'QU:$OA:_;uP
3!ʒ@*vl
w%:|	yߴdPr%2:C;]~4aD݄kizbV
H{\cDu1dR??X5#G3?аx$?"7PlNNդJdŶ;MS Q=c#e2JyR f!1Bǻ7/|(/8N326Bh`m&$DӸ52e?F0w[2p;~=gbON{
LwH2>
U@'gU1k~ պpRQ4(3MM1áԥ(JmwM)yN(-R+("EЀ3#{s8ZN֔>cdyͦ(=zIp(Ob %̅:[wg%Z|.@K`r2$y9;xu9	/xyK:#?P
$e%
"z,~),Ӿ<@Y=g/,2-vUQ
$R_3J?̕fBb%jbӥY{ZE_ب?0vW?lzMkϤT HK%xzeTJxe𧩖ԅڱIDa>>&hv"qF^w?zܹr^DQG3;^a}ɒL.,Wwt!4EBă/"ٔ=d>FI@eCS a3DŃB1ӊ32uHٴJ#L=&E5K>~x&;R2"cX	vp겟f8M'th]J%8@2BB4~QbfjeHY
^~ 3EzI%ZRTcVRH
[1KstP-9` ou$!$:xIH0rIu4wM=c1k`Vx˜WR"շ¹yDHֿg@{CH6So<BG:4-movhZD!tU&ZNoq*TrE)ފJ'-n^9X0ŕa|a@l4v>\B)Gȇ}jt6* N1<A}2gn^yd<OZ:xtDXU^ *wL+!amڪlT-<|iWo9Az7t?t`HmopH˒Z
+0e8m;z?ƕ:sxP-t@EJE1o:X!`u,}TA!Y8#V?TX?	Y v.N?YM{ qmu!L`o>;Ku-v_ons8mnoh=ܑ85H|..F#hA <P{W6W=-,-c
3^
f桌=x%v;I^k zt;t:Y$3T* [\~;ȒK܋s Ͼ3:5	[s)鼏Y
"h6">QZ
03uMDA_A(!H7|HXp.Q]#_,zג%țPMC,A`HMܹ1FȜ]/ZMUAm0tA(T<↮d*ae*3.Q7eEbFP[DKK$e2'7<u40"rS,d׎,0ZFiݎJp?%ؠYgI$<5s &ڦM9cI%ZlE<c3Y~%h40`Y1Kl8Jȟ9Pɻv{_"$"[ cH>ny ܇_xLcVhǨOcaFV<m.T`2	!U*uZhԢd@KO;]M\pBH_XML~!2O']Vt/' +( .{!m2np=	3W7;&jYq0g9k~aj@A-k99]  h 