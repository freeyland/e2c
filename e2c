#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] vH(iZmwRRIrv֒{׶Y	Ih  %,uy9u50|MDDf@$%Z,⒗Ȉʨѯ×jZӡZvnwڵ6k?Ir8'psArD;Uᗤi[fn6.._fZYo5~_vEqq;_P[?xֺwr_G*Fz_k_r %y_k^4vN܏_JlGvW|X=}ɥ}^NZ~!;a|o%b1A,YVu~5pBxN%3'XzNܡ:Qz̍B:$G,:sCJ\/qر3/OA!G#%ϷxKq{O/v09%ۭW1:Lez(OѪ0` ( 28sg$B{ `é@39x(	xٙFV!ׅs,UJV7x/~+?.i^ntkؓaE[`vYKOKK$Ň%
rtYisV7@8}O>c6^0]AĄ5݉=sa%Bj\;A䞸}_@u#2|VFHѹ$9GI{kwwJ Q8kzkkN	9ó%~e˟zC`^34QӐrXl?mG8Ǉlpv;iןd߀gd8`ӟD*6#Ft.->MVs;9mwԮ4JԪKtjgh;ky:uөmmZ>6٦"T$ME+A4ӠbPL݁}|F_&7MI5&٤"TdsVȠuavo4%0'/Hfej$'A tK˫ADA"FY';;/?Sk	KA[RR?D
 ZՁs^&!k<Ck<7 gWW@5Gз=@E_eto{z!;?BBQߧ;)~ `z_}w_Z}lcSw-]H	H^rD슝Θnc
{JgM4:R	eǏj<DOc?Λ?_>}۩Do^}sFMzw{o̶W4!o_iZCN;pV>LUno;`Dt$2I٘pk{{o156eYmihZbNE4M-͗kn銅(Lk1ԣW#;>va*>t(
{o|}]*W,tLbx!
c/Ms{@s
\WpcuIekyTը.a
/|[*+_Yo7֯[ֿԬ8>?מtJGc\/WQ8$sr!|ˡF /S2.q'$a^_TaPv-j }$@M@@EE	R٧& SOz9L36	՘WBBһއF=ǂnfn;(BrLll Y82S¦|Op9Yθ/vܬm֯9 16}
"˂RpMi[cPiUuSsR29XmTN^c\ z\C 	8z9	w޼{{j(眠	K*,kFG7مoJq$_)Tc0"Y:+3р%sF;}O8/e^z'XwˌG^)3ŉT6RZqm0k$ҩ@rGQTҒe=f2#Xb*Eȫ2,v9"VIo.~O@*ҦqUGgWBL7B1qB\:P|ǅ^q]//9F_m !NiRk\rxVd/2>	{[;O+daN;{
3W{?N+dW9Ei|sjHUOy-W*(	~2  EWrЍ9\չCԼ(Ŝ,?cSneX*ZxY|]8 l\bdP7kB5C_S$9f1܂Qx|X;Ҁ9'!; 4%!?-=d0PY~FF[b@v#p̐]8gw*
lp*̭Kq[֙3,'WVZ36^x8^$c\NEsaP~U5`sEL,^Y-ٲE)sQ	Mlnt.jr|}A6
[r<gt𧗽wiNv [տln}u3\d4!A!zQKZY3{pKÑ
2(eݔ|TeܑcEc'Z*Y~a:dyȤrbޙv0J,Rt1VʔP(J_ed8W7wzCw>.znBXEY[	;/^gu}ѣ*[iHi+tnp:4geF$/
CZ$oZ&D.j'{H5겁%VKϡ&m+ґ\eҶr1P<bB%&#|kCҳ(r]C1#!/$A7FÆl3F^0e+[*o^TW+ BWE;
f|JiB"k,#⥡)@WARj !@D&x0ųl&^T^tJW IMۯ	?hp"VG0lv5&b&6I+U,ICh/)eSX@Z>T9m%+f!?C2b,)eC8RE[ދb>YLۢ%	/	~%ؑ_[YqTYl/nSK* b1f@9Am܋}qC(W]l?7z5r*ZЊ}dQk\ړG0TZeŇm$$,畂iLys(2O<4Oq
c1rٔ18_)lP qbx$.6C(9@kيNI'IwIKiz \eH+"+IF810 UQ`YWJK!WWWW	vgSqwuan8ZCbÐX"`M^fH[2mگJ<zD1ZZ&Њ6Pun&%6gF2$ԺD[+oioRM5SJSЦd.;"n&?,*簾ZݕB	^~eif<q^$.nqjwv.E[}ǔչBbȩzsTN;p痩[L9ue_8~7N:^,a쟳*WB#lUXH+PFW+2ZWfCB5#sx3)$.n;BL W*8Ie\ D}
>k|?y/Pf5V$53N71VqwJ{:虂~oB0A/~bCO\|ǿNCKu%e" JS[%q@$xT$> &!Y)k]3=_YAc	]qV?벁G#'<g@_9PIaID"V"ϟ+{;o^^_EU\hQ\
jɍCW>eZdC*[*vc+>୰7TqzE^	GUwT=;X)'ŸUl<#Wd"PCW[|Ӱ-}s#bl;{[4򙚣Y.E0o<]<S}b[$AiƎA	nhѮb=4{FɎMZu_9rP3(8Yf9Aoad/0K#)VwXGޡQ("h*]!,h<`^L[LDj99"%":'"𑷡ǵCABMQi޼VyT΃QYcBdR) Jey.3/$5ݽ42sAN}f,33uV;h+Cr!2oo)t\E@eB@`I_/`1`e2F90X9&/(d٩}KܯtYg!3#GSRiܦfô3GnO9xIЎ
_2iS&u!&FH&D B?;VUb)bP<LcH,3JxER~ퟍCLJU|M[MʲSS]7E?okE]07Kt(0TqjR+Z4biL!ΡD?q8ty'#ED8wp#3T9)-\k3WG&̎2šScI0K+Y!;@mgbodtR}$)fa`)F7KrD<yHz~~v#QX^_^oI"=]#+<MyJ2LQ2,`GE~et3KoqtVf݂uZ1A0,hYo:dklzj%^SRi	 h60y·xuʞ<-NEn6yDO9_"rvZχFԓEr@KA!;P#I;K=[EbuIV0T$η'.H^e\9%:d6974I+
|L,%fyP<=Ab,-&cH.jAϑh*ߦH2-})v&1＃3{"}dj)7% L(7ԪZ	f-3xg+`dqяNiG¤dF 6:$kՠQNW<W,S5]¥Fd|~廄N$åTQPZ	bu	%U1jeS`%ԄN D?wvF~ Fw
ZkzO.s,%F?0S˛^~5==?>b|{6Ӳt-5N@3E(MIs7pk	o 9$Qai4!R,JE^40e ;s;0ghJoO4U?w-eCL20ik2n+^VqaiH)=`Cލy_g5sHxLR	꘤Ƿt#LmNz:ҧAKQT31p֑)Qэ%YڃBYM,P@r_o(5?'Jދ~`d)K.<a_<q$b>#*G:5ˉ߈-hG檖$ QX		eRBÂ1Hz{qMȎD$w<QڄV8q"Ņ+OH,;G "n,4iͧ7Q,1)MhZR&'1ޗ2'V!tCx)-΀0_IayâB<cONn$*=U nyCl[P@h3Sa`,`[J	A8F((a?\L"rk 13bot;䓈(Yef'@x&:
L1$?*rQ"ԛM'3LIvM|B%^߈/4'*$ݼtORE츠Lφ!p|IB|_	S`N5% MY 	JQ:iipMӟZZQk:jRQ`tzkP(?4O2jM&bek#߃|Ȳ~wws*7*M)b5E`,C-U!D-jKےd8(]jKŊ^i˛iʛsⳬEV"UdqTzM_$5	|M_$5	||M _Zd%YAV/~jb*-NtWl&(n7n-w5rˏЈk564y$$8I͜d祻$k]=}di#%-5K[zI{LG{ǵIY!<4q%U-Jd
:GeM'ngehŇlB5r.3Ұ5WjYi3.|9넔1گӌJY_EU!=!khTAyW:eU˲r\А/A{)GILTіLE"OiU'r%ƕ'%(֓2K_͖W31J˻wye}6=|5xR<+&T@9&#zI|a-kUG]qyo%|-bCU2<Ha垦Lèa;92L3Ww7	~X2Dޗ1So0<@T仵
K2onERع'[*ي
Fa)*;$^mmrzV;dKJ)v$I-&]SW)qtې8ҞnDRbxRPUswiMI\epZKi:I*!	0Ci5DHyhꩫH#'40xYsyyHi$2onD==aP9X"ǛG6aTN_弿䨿	*!=mlP7 t[M:]쫛M=ݑ{Jff8;	LhJ/B
ڛ[c)D4Wpqn0*/<+û[-zO$xev<WހQ`;o{$h^Dn~cfS'U]>}|gmaø+:	gW1j^2G D\mno5\吢8ŉ87}cdN¡+5TbgXК-0,|7$G'co9ƀ<w0 d<{-qe2ZDΧbŒ-fHi_U"O&bG|IN\+_iCpn&&Vwau_ :j;ܢ ǑA?:XPϢ6WtĪ|<_oNA*8^:su&e=iOӴ}p?w (p<9i$UܔZtai3Ynd鄰.lzDUҢث4'?K|~ےF0KEeƩ+PŤOs5єʞ9e2ڬJ"Sp3@s"NB$Lidk{1%uLe@Ue)/ZVnږsRd$U|lɮ)FN&9t|,T'BS,gh>2iWOQyhR`3;{2q숭nrzy2i:ӈ]xݬmօ'~<G56(#),$f{Ĩy8j,X*'|uXsCڙJ,oSSE5qQg1ry):HFux=Uw7'C3HTSPURV9ü;a3urȜ;@: /xܜL-/CdtVrQ1`M\J-i:)P輧s* `ޠ!RrC]fpEE-!%t6epۥ*UQny"%
 /ŧ5aKIJ3(dU(	
yLUڏnRhdl?c~gGJZJL>yM)xE; b!-d;eIl^y\E;%cA8pCߔ]΍&0]f3+4	N[Dr|oKw7(^fAV
}4=0	bY% C[%&|pq׍c	=KƲJ ύs"mu
3K8j>sÙ0%6ZѫˋڊζA-Av1)=	rh{{4 Y&Y痉8E/gn`!_<^ec3/>*!@lvB:2ŷ1&G/	 c9bMm]@V|ozb~n[疅-&n4]͇ԎcE\hScIr,gpWR߮.vo3p#78Y'̍L4mӸ<]qź8ǟu)^W0AIHK)	wjpln^q^6@TO/{;[[o^BLw9v^ ?1D5&y	Ucf(L=bodGcn4m- ˢl)@X晧aI{ƾf	P9`r|c:Zޫy:9a襅ˎ5t#DT=ª;4=aXwig|n@BC'4@nxppMuxwp4h,RE/*]ř33 UK#9u.Onѹ他{[E"O2ߧ^hۦQܢ5PLsNYg;4+eD1t8	Ȳ1pΝwG`ΘE#:`_nbDI2.V4ؓȐoUO`.=1U/W##
Rۭ`rut!a6u/൩+sR`3ܡ1&+2ۋBO:p<|;%#zA}6WHߢ1ǭr'nWfꖺzÊY6['lk쭓&kF:s_ALq'cQON=:֣2KT)Nfв.y
m& &wfAzm1L$ z/?LYh=lX2~&SSfgjY@d(.1QL%g!U4L!Bcy?`#	,bfڑZ`͛'Cbl)Cg~,U $~2
Wܤ(uLWQ"f4/5P`3fv1T$쮊(ɑg~G2*;-r
jne:W*>INrl;NI})T&E9(*ee=f2&kL哒'XwYkH ՙq:paJ6t&U&OIUJU-$s끘o-],R-"&f_5Fb=X.x;DP0Ht,C݂ep"d 5] Ra)/!⦈9`iRVΓU+L	yF۪j˴ل80v_2Y撕ACӊ/+T~UpBE)g{ŤIrcJ*sQ*F=ڶt}#I%f5,PwA^֏Pj0r+Ir8]#MaNƆpqHee$;sFr-=tcSn$jm6!3Sk"l`gà`}k8$ 	q*h]SshT4u$^y=\x3$!Xy$N0@02Zww/)Gp
WBH	ejWwKܦ8'0q,D[3@5c&aGl!Fu ,7LGܕ)g'HC,D
;&0DL@/,𓦘1"+U⭚mHa) =+ą2QK?AiRv5=`jT=B@5?Z<Uf{[=S:Vrb&GϨfڕLm|A˖iJ'R!&hnx.fȇW\4֊q^̞u*cpt#5lKj&xty=²gZgb? yP̓*Ya@)L ⤢6 "i
bB8{Fh:nE

!fK!$3A
f:qRgLug}*.T7}fJ8oULg8ڝ]/f`M|PZau&",$f#': = ɏI%ġm/ux{PHf K:&=G5ʍGiqhRj"bQ$1̤=~<?3 HPVyKԦRW<y9'+&1egAk>{q<$ N-L$Jjv'jT	Qa0T)G	WP
;͢Qs?$^4p'W+ҘU$6HY8V5s\^*ppԔ|e'n-5	].3ׁzMi!uڞ;)JJ榦˜8n]FՇfn]@*v>yRiә\eۜN0YWa6w74p}~A(혖.uLΉ[uga13A#W0 >K|!udZ:n_c#SUD,6?i)+P%-~\e]S%^hL_ێd5#l)u,|J5ph(*L#q/[y>M3WVCzf<KuA\q$E::6`V]w̌<ב7Dƣ<}an-Qd'faHI!Q0_|KFv.7>[}vMH)}	w"#e>MjT[9{έzXFn<7ņykan17*㼱v)΢=gf^Mh٬N*	5t(u`/=l^ t!>6shcJ.eMLZTxjBERيюHZ$K	 mueq2\ǵ7T"X,Cv+)tF+p],{m1Mtsн5 7scǿs6rdPb޼*-
r)e	mh;.aW3;ЩR:m8CؘY.R12;@II:b9\;ŕm8p$C^|CΡEY*P?^<1{dÅ!2IQʖ.3/6p'#Gaj#@(WsK"vgP%I$'%K!>l,T&N&fD٩(+µNj<:]"!*$oeaRV*9?xb0P>\_3y!k"|vwWe	*դFHW>ecZ3UT֐{\ƉJ2LY%WJX<rωGգx׬GM]jgdBC:{#8#UAAV͛!A/um\֘sR[
Cb]
WV^x}9D+h]1.ӃObT\;װ	b::78ky|mE{/Nؔ68j-D0!!R92ӎc3	L?sv
G29x䔔Xu&c</DvLNVpGxɇ~oLeh[y64	K$YI{qh^IO@%Gx#'TIȥ\-/iӭk+>W_ڄ|񅓲hֺRae˩$꒴-2(`)g$~4X󽒈C<#}eG>(΂)k]3;Oci0>|?³nxлWBd_e%,vJU󎛿 pG!gfQ]L=)~p̊:p1ͭ6lLiX{79fq@MiQb蠃+=.2op6Zؔ5[-?f 9vZs姶rgTsVKrj&_cT-g{E9Ap (2ݗ@@]3yUչO{RVG՗}|fĴ`rNGr	 V~ʮWL =uO<T1?#c=7˫kuf˨FZ
lE{ЬRD5mʵ*sVWe+O#)"PneԷS6tH/e|stCU)bDnkD&!Q-:=7vF
LW
Ą"_k[DVLDƾY+En4Gy>&L@LW0:&܄YvqtN)رɘl;IF5IG6-26D,qO#!3+i~ɳFҟ(w n5r@PҲ9[l&Ԟ%! n0+8
JmW@I	>-]Ewp#R\M 3o2xMRٹѨOYߐoo=N#|r?ѭW/e~t
||!:K@6Y(jppY~IBMjAV$7<^n[V
Z s֧19F<քg%$)H @pV./$D|#R'83I 
?E=Ӥ.9mwj|1-u5ʸNo`wO\6Ne}{'QSKyW`7-iMhB`$FNyr:M8*FЧ
;EAGϧJ{H$ 24Ȁ$񥰭DW}>/ B	XЋ}ZaN>A܏4;p594M#O&oTgXSi<!!ϩp_$6
Z%|͓/SbLҙ9YxL<7ww鍜#Ӡ`NfAWփ4qLTqχgsˁˁ_*Cw瞟r`D܉{ʄKJƨy#&?JUTܲ_x1D8I0rДc$udX#鋨YVIL	h01KN/)-ufSmy /CºέZGuHO|Y<Hsf7(\LJIZqU2"x%F#:>)&I+(5܋ՂwVQYk
`N0M)
~33̨XCPFo`/L:Q['rs11v;g>([nڍL,grt5t.	(:(Ih9gq@RB~482͛G-L6r~\f]~M Eh5Ī+k5_Q!Q*R'שᨗ/lbt"-{c\&
pb@ޠKiD$,4pk9'[.Iϧat $|g؆X-{V L@sT`ι3f
۠y@2gb3[![**[MW+{rW_-meX˺ВFY>/w2c[|ƷR'
Ӄ3R	7;, ҙ)N1Ca4_O0,ͫ+OB4[Cw3^S[ckHKíǡx}wxE6_?>M}^rIͯj8QQ1]oJu{MޭZ>9[-s0x3DOr0`$6O**VSD4>M3MΑ/p"OGyqj
2E1ӞvjonO5BG5N5; KHE<xcI)]\kn.FvhIpd"U"/"褠S sAlۑ.`r8Eڷ#%k9>x/PФ6{pEOcM926NGN}M<F{Lwxxj?Of^a*LP|:!7HIx1X]2]qȓG0R׿d!#*/ő<1[<an}Tnt69#՜ ꁂ?
<9S#?Хi*{.i:}v%#LzNYqg"?NΎ?n]}kO_[0
lh㰕$:c[#'p/qYhm
_X@~fZ=M;Plj\_RiyhjM]9F=a7{(9pQ{Wr&Q3G+&Oi4,JMvSmw<[iBO  ˫GLO:#*szM5HU{G_q?&;'\f]fh]Umģ@E]i(rKw@:1rk:3<>Cɷvmׅy_yYkNن<%΃iW@Qa^VR.h I- n3VMZMրZ(HgiXωiA^s.hI;;Mio*CrHaN(|BHe'a.3y;n˘E0ߜ]w2\wla)=ֲij$O.(e2,搊W(#[ǍJdL4 To!:a\OkETm
57#Cc>`5Pfm4z[|cai/\%O[bKE)^z[mk~h];֗|En(' L m"2,%#vB)[~}1]3G7 }~rrQ{1_멑 #˥**nnrW`fd8I{)XOI=/ya<}{ZZ@Ts֑G#75msWKf9ҋ{zyLYͱ%4!3||OqRf;}Ks\ZҚ/1pyeGe'A	l4r?QC
Krz7aeV7e̻!t(T{j/$Zp_-7\{qu\M!GBaaY>*f"ǢUnhHW6NHtЂq 7b<nl^ÐCbAgﹿ|rcNt8Wny{ͺzb /HHێD|xLap>lB>M VE:j-ER#kio(Yq<_u[ފeOGۖ-yZ%>53fL}Mv6Nx:fw١}txQR.C<dfp=2ɊgCT lL}X0`7>}%cxo@N_	Fk|'pknbDt&鍕)SW@DuTv/-`gIOYd	l˲,ɟDIЩҪ
f=M׉qN⣿8qգc3#.d_"7HC7}PM q%/]NgIdP-͉e9_{0bPs䱭EG2tS"" ƛVӑeg%c9#S4l\2tO_
_
mV-q̰s^:jZӡZvnwڵ6ۍ?A^\('3@39 IA9R_jr^ǌZkZkk}ťen:}~wqeGW.G~;5F0
O>!:AgFBd<+#ҚaT,uImS}^c:KeX!qJ32DL%L#˃?T_C~Wqdxp+OK/1tă.gjЮt$8kkDgNp\:Hp
6W35Bv{rRi%X	1iѡD"73@9t~8唔z%.yI['8	,BBCQU+*e4?Yg=8̹]oZFԴXk~M	Bw!kSH0z<t<mKOj!RC9Op_8k+DGwL,oi ˞DgK&.u>^]lZ\N,NC.ap[:ś'om%( )uM{Rv_EИÒ4@xxe
uG{hȉzvԋOdFI ;p7C򿲓:NSm8wZk]\Ĥ6[d,$SMG:1`@+*IA#V˰3{UNj8v"(764+7jI7=$746nқrm/?d|ѱI^,Vq>SUo(Y'`;q&({/SzGU ;sz;ߵ~JxGސrN"٫]Q,)'!W(c?t?Y}tW?KF淚D#Ѩ5]\bkviiIrD>m%s
$Zȟ{Kn~@o@9[UWg*|2 ^ۤ|o[y":עfnwltS?d)֩7q; r-N$!)7O(nΚM]\mo@TO$^U׮a<vQ8w8Ƿr>RF8~Uyy~Bc̗ $Ms3)R[L|:7SFV܏
cZB61hrpo`wkMSY'cz;~ѨS2SL牄}%<F|t}+a/i?:=¸p.-[; ]{0r{GdmwRvڗݿ@w;W`w ZM}|upOowzf{n?u/^˛׻]ͪڹ5~u)ia6MWzaW~J%_yoKC/JMZm7lwgp	]Wo|]4{[;wJPA]%
ܤlmO^o}?u_DanOvxڣ?F4ozwP*Z']?QOeRJP2~<Dy\ȄL]٣~ݴNA|=_ȭ<]v߰Mu{'?7㟝+xu2)6JSS8QA5+{Ai£
H'*nv?n#?1Gm 7hUKufw!Ӈ{MG$Ldڭ<ό=$sy/ƹ߼~C[pL~Өe~	GvPjAˬMYw"tv+;AJ%iKM
'Ie~Tg=y
3qP#I+Hח$%knf0IZ-KD% w
K=%]]S?q6rNZ^bž8j4c{J7ඍJOK&T?tɗ:u)ּwqK}%|mHC*2YͶ՛u#Cd75ME8*4p]~WXQmgoksTn4S4ߵZZo7."/~Ne5>BM.UbE+!v7fAJ|c5f0=̔i-|/U͹	KjhSo?_CN}/%|Vn3<}$[DdO۷>cC0NuO9ZkJڵk¿>MǐA
L_%2-FK%xH=SI>]EQ<x#;;=y}]| vKWzo{ֳrwK_X%)r<	W(tKsBW$JລwuJ=<aZ!0[/e8a?p)|RVw_	_D?vJw?P
QpGpe~b`at)ױ?T^'Pub&4lzgI9PuOAZ;F~$aS<h	*ڻV؊^6L
	/(G׿Z<Z-MuqO"z=kIn2	>4>n7+͊V01
C"]n]~V[E)Li'p]lvHt
hV&f޷ѡռ;'-`}QZmԒ"̚i{=l͙}L(	:n7i%UTBiL)#)ӪFwxc:kS7NΑ*ZBU Xh촋Q_;)XIkB&!U, ܕq)Ev4&aɝ"67N6t%x4oس:GphbSjB^T$ݤ åg晟F@1>taT	4Ͻ[ϙ^cca#; 34W.{<4iC Tl94ZHJs䞈ZG틧ɥϝyY?P(j&EoQ?t!TF33iԦu)/8JӃ5 Dq+zMO8c2B4N
D1@sL11S'AfQ#k,YkylR{`cA.tTM_LX0	R!gU!?30?pYHaX,%3[~Ubgs-=TRP*|]SI$X1%+	/wzN\*ѽEsx``CvA٪ҜZfenmt*kuq]i<o7*FڟL$~jL9N%^5k%V)5hW[3OF_zVY+"Eӛ^_1%2L(oVA_Wk?n:  ;YiZzjYZ_oV:M^iXsZ@ӒOJh4Zev#5^idaѬl4fRYJn5kЪEUYTSVi!XF0 ]_gkޑOPQ#	ZBtUDc6D(ڭ>674hpse5Zi5]- gy6MXXtҁ&PKa@RCo(ۨ4 ;(?t@G(lgTZtoG@ϭ5^kZZuWZUhWZ~`v	5Y>;@S݋k5([IT5:0* .-64/ߐi,z=QUg޷:Pz[^[Ǿ5CeJOȋ4lhȧz	+kHjA#7t,PxuQGn6v*٨DZvM)C]^(+,%*5WXOw6X[$tNA_au8UOSUώh|6%T@a+EC1<()<s-&Q5޷m@I1i,<t-S+uz1S^7?g|05f)t)2e`}~wl)WNd8ɱr9Mż8?|nzK
BH{V2
yںE?Ǯ6T_VJi--oKZf<ʟ~WR+?7W'/lqxVkr&?=4ob9s?%)2f㢶7v]](}PٮɩI)oWG>%	fP}Gs%jroߊsU Wrj/GBw]\,2Լl-#/SBxA|*$/+,}IdÒ>3V8*I(O/HC3Xʢ|)+_C?_?~?{)_3#;? %9$!Hn8ð3!Srz^2lO0.p8~݇d8IC%$=:^vfIfyoǙqOFNu8:s81R6m͘Jzg&~Bq(_<!oK߈)ㄼ Q(LƑEfc]r;4sp./_ݜ
V)ca:2.׵H|rrC{K.)'!U#phI!cr~a5#jD_<ѹX	x	S)Ġ8qx\Qeڸuڷ#%kx<b.8
3]/29.2;MN9aSUKe|oxٻL?BR1Hƈl^`Cɯ	қiKA,mkW+;fRpQcNzCWN+-CO%vu<_	tcJendqu1&bwFN52$nq񼯡bB3^J"
$HI76t&\̾vv[ڗs{JoftW1z}RG& {|d]<؎0 2Gu4%)"2%%zzoPBI[:>kǑ27N/E0{]LrPDТ$ ꄤ5&f, 	c0 3ê KJ4s<*/>4]/mޢvN^ q89͈{vz2UR>#m	wPWT#xYnڜ+M%\b~u5)cVV2r{q iӆ 	5g쨕o#oEv2
i849@*`.*<W؝%
5賕T懕)M\jLZPJqƤ2I.Qxq1?30VJ0}^+8e%hIu1~,$oZk+px-6qN& Hӓ3̖dM׳d)X%a.Y	W͔
	#ď.hx֓5/7iY=*~cYȋ|k;rݡǬy/Jqb-NjAWECO	#]i dQ*9qmNKv0{~wcv 4҉*%<YPg(%g sB­P^!?pvpgvx&j4^
Q'!-"9%%r	(1+pD22<C	ΥBrfz\|A K	P%Oe3*(KZ,f[ш![=aV	k6k)lMfОif΀pHs+HDǡA"D'滀
Sݾs]tR70-DШa0{vs+sywpYQ13s\ 7tK<=wQjքcP{Je}$$)-JZC6jCMdy	Ċ<.45'o@
ZgoKg1CW]!.1Ya>djXl&$$B3.*k y/` BC IBl{)I׌ĖRpcX$PK 7K7R+,؛"p+-jVbfYO7R6(CHK{<'JB0/ 'NpD6&A_{=Kݝ^>ʂǬ]sT$ 3Ŧ.$<zĸK?]`qozӯcfmC<)푊D~"ѡӒSIJd{īA)@(xs>q'qt>S9CK|.f?(i:Z]rloUA$Xcq& s[2Gr8m P*%$%-f ^`rirDxxNh1æ>B~їG@,g&d.zO<≀	L=J
a6l'l;Ppf<ᛙ{Ǚ,zFaE!=qcvpQv\]ۀ[ ل}	˼F;%\/prV&vA7{(HV@b8ۜ餲c?a	CHonzb	quFfO\c|QRB?WrR"P@d-A5kV}vpYs?A\BY#^zqX/:EJ`FϞɦ24Ӓoa,4Qe6EtІL0ls[̨ՋqJ#mj^>Ftl"*AߩʂLLIyq-s'\V>|	սMPEW:H?d~kGu`xU6!%nMkhbEXCL0v0 ,Gę9-e̹̏'#3ZGzl,j29ec'|$3*脯)$B#lKB/:ar].	z6AnJ!蕨 B^z}6vx5.&LbVl!^pMQ)\?Q ߰:/<$9GLヸgVO|DvP9Q+fN6lWڵi*Fk^u=&}ʠ^&VR]sC6LtGiH6bARL6Q`QZiQ`{nYv)'3Ŭuwm\-q:3QdgP_O\8FJQlnǁF
aO]ۗ!`[0	u/hL2L+a}mtzcju]$*֑ɟ3u0m"7	"O`@W-AYA[F7䛷jSP^a̥Ў|!M99fd26Wf*Qm>2JΟ,%zhX<O...S(uzNtJ==w Ns[C!9eJ4YR '>	R%8؟xg>Μ g	]!40-bgt&6l%D;52zN0"%9Tw
Rs"',wFfx25n5nd N**uW N.rP" 钒PAk.'ajtJAߥuB9o0]N8f)x0aY^ߛђ5·)/c_k2B.Ћ;Fqz eW8ޯ1īo4	P #t.(!.}]7W`EW"BՈ(2*j@)a4LW&Tsjg:\@2"
H^: @Y X:T
a4ΔFcjM	,Wc6-͌u.Z߼VуQ e`kZ%Oy+	Ƴ+g+?MߤNܯK_4݊OdDЉsݮ;m[/{=mPi[]{xa_kAR*ۭb~הjoZ]CZq?*ps8Zщ1?8r&qJ!o6ը?BB^D7l?:69[Q7Ch7ٚl]<r,V2]>$Q4d*dzeMq'	F,ęZ纎s.|Bv0rGh>,ߕ^j57c;uSTH'7iE	J:>tξ6g1sdN?d>HvĄJX{29R4SIFk@(.,ӆ1> [W04eslr.tn:8:N◉O3Ff&Grh`Hf=1S0+NëHF[kJzC<^$B~VѾ:R}:D2áҁ+PX}
l7d0.ft3,ZqnY$>h8F*zIm*tVĘ_`|+,!门cJ6zWBNZk};/W vYZ_1t4<sޱ?O}X-iJC%͇l5sԏ$6#}q:Nuyh'+_K:	2=63=;7'f&D;̸ D6l3ή[<T Dy?>l%;]YsX"2ZDrE͜v3d1\/Z1K|qpĠYX[U1@2VpoT,܂Uy~#QiJp\*1$QHtL~Hc3qᡡ=-24`ۍVwJY)14 r];B瀞˵=[/^%_ڱS4wK4ۛ"ƟTtw#ׅDجq£c1vW dt,oBDbp0Hʂ5$y<2QS-$ip'|z8pͭ5EZWZM	S@S.DVg@#_`T,)>#1QAKYf!PN$gl  v8Pk?_~SPWU5y,ށܢgeX-#*}5QV&Nإj=򳎕ʟSG,#6>J6p:OOأy'|b!b6C[#, GemaemФuy	w 7uE	t %Ձ߫ɬnF1L dAwkȟ9PɻA/E:=ު~I c:i0R@я&ӱ4sW3qwITMՌB^T k.&$$;B+Cbu@ V$E 03&(سaş݇	>Be]˙&'OT5DhJW۲QȦ1TGd_].x29>.֚l5sU:dTyK:=7~o..|b x 