#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 Hc] r 4/(:dJ{"X$U>:բ:+$(3"+"Kd<<Ύ^`vkKD )qp8ޫݗZݦjjVVmWZիZ_/Q섀I},HNN&H~'E/3j5[hܷ]\zքoݪWkp;:FuwqQ_\\6\|Apo藯^G_k{N.!Od@vYZCk87 _)yv?tw޼{}j;\Ebvg<=s?(፽۹=nd;tE~d%ny3CY޹9σx}'vD3GyEa&gl]m?m7jC7W_N0Iʶ0\|7D{=QM;$ŪU~p;֯[?Wm׶>0't3nIE+"vq#O"a#Qtq\S?>e?kƽ__{}?uhwq?:/_[5_o;6(D:5moڙo;vY?Wbv0cl3+ТƽJFX*, u6\zN@}Nݘ^|CPzA/4F..(ΠcA](K~`" _P&]_⿝M*atPumhM̸I0- =wFD" Y`2yl-s}5b@׆8u?9@T
D ̎(sWCa/	
%kJomv,cZoh_kZvV]?/ޗxTz7*}XZz)>,1>ۘ
_~aj	8a1/?l60!Hxw"\hdǃ_͟މs}^P&	BtQŭ^Dʏe.(%說ܹ+c<___n/AIpzli;_g` 8v]e{g\V:6kO!Q/F80ڹ}ݎa0XgY0Ɍ{C˃X~bV[:n+dع^tٶZj+5ZM(z=-O^<m{o6ooVKH [E ["@	L	LLޡs|_*7¬A5d@6d@6f
_'oJӐ]"s㮰"g*T"!Hj)-.}U:ae%eEh]L%,>*
	%2Xf+}V|W(gꄙWW 5' p] EB_wo{z!? sﳍ? U0Ү6Iϛ/Kj?B6f*pG\B"4s1b;b+"דVLZ>DJ\-'y38d(>0f;o~{jͻNZUmyn÷Z5R>:1__Q~e}78oJ>Lj0SĻ:^Yc)I~H$jc{Լ(Re3s6OgD-ׁ):b䄧x\rEЉ;ϟ=3?15_<H>G6{o|}]*W(,|l.
}/˧ZRgrM$>5U!*q+q]*wYTV(/n*Kz8>?WkJGv1ŗ+ec/xL99QdN:RcvAx?μx0/Cl0$(}Td1@>V} * آ!ǄlSب'iJȉϊJ,*Ma!Q]rQCYc73WO"rllYw(62Sм׏p=Y/vܬn֮9	5a ǗBJmҨhE`v+xzATLԝApZhU\\fw3:9ԘXWO^bBE )8:_uWoQf9CC%R8T.Y܌0o	>|Ժ($HggI\Ч38N$8G'oY&E',Py̸yҌ0RN%dC֥`HSeDr$GQ\Ғe=f2P"WYb"En_$S'؍O1+ڤWpơ4jAӐaƯDI߈hƱ^rf@	 +/^^47B~k\
@a?MǷ˴̯Џo*m|?>:f;tT [~dW49Zdym}?M FN/#Po%Gj\!AjbNI֩)2]
MxS<P,n>= mt6*1sh ֪!*s^wm0:EA"4Σ`@9AxcK}(r3b7D2 :rzAbF];sSo230>,fSmYg Yj) xMxbq9K^9AL,Y<lQq^;EIM%YmRNf]uָ?efxeS:8wowP_v:$b<(ɻYFG;
(%+	~),`GY~@hDsG,,.?gS.=|L	ekŗ#7AZY~az:2|҈9	\=5%']r
YFN}Y={z˭?tKhßۭ/&Y岕b{QG=+5O]JKfifs3^t&o><,3yQ$_,lnaIMlDȅ{\8tqm»fRY6J)W9,0XؿmZY:݁Xt](!NQPƮ0#x'7uNPŌؾZBR.lYpe<Vd*o^ͫo6`XGcӄ#;߳	B2L(CQM%)C/?LAE	RZ0<:$z7_^cN@,^`b3ɺ	Etմz|~p3'<l/Gc')0;B8n˰p(pI\igI:4{)MiRἕE\t`^^R`C<.=5Ӷ(CKi_%3E I0rzpK2\BR%{jb%
Yy1ʑj^Sfxǋ %wVvIid}/j4iB+օIqB 23S'ʌrIqT.iLyp,(2}tOwI
cJٔ139_)|DUaEII]PrzKNI'IgIKiv BcHJ+b+I(o10U3`WJ!WWWW)ugBSqguVan<VCb(vbsW&/lUrJ%_c:qV4u>4l A6%>0,*iZүUcHcj07Tu'fSƣr]ɖA//T^f&ǒ풺D|b0yL+|*_+l1L#6w~XPXe.w.ďΪQ%d,IHU1ت":KM(E%VL5Vt̆NPۓt#%V@
5"R9o#\7վ0̊)yߍIqsb,  HF}wU0o")#qȾw`'wbNF^3dQŹmsY-z:s0&-,E\`KJDl5 K%A$ٸU$ l&%~`#V*nZL}Fȁ	xʁWRl7p8mC~70wS*Eh?Ϝ$l%?{;o^]_MH\Y\*b)C[<eZdC
[*gV?-vHTdizE^*
_;UWdbԪ@it6^:d2zp!-LiX9c+p^ͷ|h&wT-ߺIVFarZsߜ`G˄l}4@r7RoWNKZJ5t&kuNԮ\%_UݼCyo{MpkSre瑌q;L#0h{
A*4.b`1fTM~0X.EXUeB3j)&UߋrrrEJ#|ErPLEУhA[f&];`ηMwULm{ZŋRGKzre%i
L"$)NΔXwt
|Ry;5m]XrQQRjfbG*PFa*FV<	f2o\0/eQ ,C9!9]èp<;uoǕ."$tA=EFwTZ3mV(mlY3@/1ZK&]C>o|<	I1
JaeA!3jQ%f"Ńɵ1
k;l^dЖ3+jkloS45)agLKm`o.46vN|%s/b.w/0CWšIҧ'1Lcǭi%?0}aL?U?3ݾ	[	?"C쓢"-}r>6gNA-&)--;PBw3Ɇ8MNGbn1:rt('A)(.'|7`Evx펑dKZM<sm&:Uaqe	;dM(+g#P{Y{KRe5dXT)/'lJhœH,6Y[gJ〈\2!$d8dpHqèHc
V3R)õ\҆_9s:`KlT؈r2T0RR.	x,djhigc)[tH,.<9aPG2R`TYWN{.<:àq$br$Lf3ս_z	犋 W$%HEovږ1IR\=ј7Yp-z~J>Kh[25攋n &JUsBBFL Orl Jv W(zBIiю'Yzb2;&W.5=H(,#KL%$RFaP$Jb$$`S`%Tv ĿpG J}wXZC_nn0SC~5;=}#2 83"rk뻎)QܓoB-l޺!JHQzQ4̲^)UZ!IF
â"9=m	x8v%zi&ME/*?DoK ͙xI=V{#EۛEzB4rFa|Pv.A-Ͱ3$q}&mLRx[޸B6'N=>DҵI)*8H~rF߬B~_,<%aM=h<M7^}HAы6]z<~cvй9zBpdPNFl_%m1}XF;'W&EJĂ&OH)CZWƈ k-q&7;cKA=x!	pD+W$%DgYRvÏ<d	EcoYhӪOoiG[cRq)HLeIU<n^*{3`"ggx\!wC Ɖ`iA S)РDQ4`ʑ-E!S
mfn4̖',|aK\"2hAC$9sDh#Έ"RDQ. qfL򍁝n?a`|Q1"%M
O8[GG)GENJz~$I~3#\I/rBhq*+|Zl̶4".
	Ph2FCe6%SSq?j^K@ "ƕVO5<
~"4I
?FGGQkx(:c*凟:j.3	4*&VbK#߅|Ȳqww*vCb5XC,{%ڒGmöq[-]U7B`EM[޴MS4M],K2dY@_W%U|U"_W%U|U"_WWU["e"d	E{AMΚtWK|(n7n-k'w䮑'I
P'	zRz^$%&I$</$Y-j]H뎜bϴ,yܒXD7 g!tw
ɰeBˣmѡ-.bIL(D}T8hxx2#f/1QO+;F)FIݢ.QJÜQۧApK'd~&FWǚ(hB@X],/<,YЃw%3.^wYVAhRɁCieQ$S%Ň21$  roLq5\ V/)6MgBl.Q2иD\XmySbEgGCd(*"(^'fxxvkr:(=8Kq[E09A֗Ј+45)4O;SY{/0sexw`^n!r#ayj}v^ jUͭW*;lKWe[;e]e̫M27blmPE0ك$NRKXWFaʹnEW۰29ҞnTfSr2`~5&q{sa-cg	*%Y9Ț`۰f<߈52{ƠB_c}bg^ކ%2ɫܛEyThc91fXC&̑fz0
߈U
C0~mmo<ko5dV1n6VGy
-}1HPFcPz:"1⪽=CBW~θAqR\`dV,,3	^y?B+/`;׭omkY\$lf O']?waܩ;qF[6Iaj0F-Qny?(st:@=CQh-79lRI$Y1pJ=ZFP3x,h^Bߋ(I0Fw$ng@x x4k⪛[-Pd2zΊ%_u5L)đi\U(MvŜl3Œdq0.puZ^)ӂdMMtMjIk^-hh`n0vF<ؘ_j24ILMYfط)/؎<
ayzQ4FmHɡa~tv.ӼF8tIVz,%#CJKLf"Yd9VK4嫬YT\"Q}--3LO9Bd<d[P@O_4+hQ'M1)"MP_q ku~&˄
AiX(Eacɋ~1rs!դYÈRY13bn1E3^ŵiIʷx-e	%8#ݝý7o*Y.-簗[^$6dfM 2/~$|IoBѤTѓ*ah!nntדuS:l&	s7kЉ.Mv<;9&NMb6ɡ4^&58وI]Or72o󭔷0NL/1uȰc&E?o ]7LAe򐦋&Jqcti4[9r""s+-oWh_Bc(C<(5>)`
C_:tJeԴs5Qo$QRZTԙ0؏2h:xd<&b.h.H7;'o
#`Ǜ$3c1Etr 
rKSP{N#+yJTvwXp^){]B/r-M1/約lnܔ>Q2YAp<8el0@*-ȸdbE)gM"y}yf2'y
xe0Tį,	,+xV#g(3TIc2W?2I[l+^DԊ̄w*T	%	[Pd$tˁe\:2 `Z4׊ڸНTkyxQs^KZV6WػpSǏ*4f\HC:Fa9eC8?ñԂoRW~l[fǖ~l[uY[h@JA,h!0<e   :ϕ&i8F}0넙^r$4ݫ6o֌y<K",<WEfwqA3љ2nc4ZT2oʎb:#laNQqQ6\TO/;[[o^B\w9FN]a?{cΉQh!Us+<ŉFq|!埐[bZfO_Nʖ!XN+@ey{]ooa?*9^zY&w]*ɷɜ$k^% @ٸ؍:bmִTesLUGQMV΂[e'/8	RD75dbٹjzzSB<eͫWl,PϤFk*\޺J(xt:}Z"Z\;?iC[VVT|uxM<x*A
iAe#eTI"rndƁ>	܃ .[53QG}xYOB%t{ClXA0#)=^{ɝ	BT<E4C'j8,I=x	@ݨt:pUNgLl:'b	hH"8'@{<z<}΅|"Rg=غ;Y==*'Nm+ӏwnGl%\%]ȎaMY',S(FD'/Gp6"5 ]y 塔-m szgs5=]"2[ū8Iz&dL؂1_f1f5EȓO):;cIY09iZBy?@F1FEv7bBY֓OWL` iޚIbs
~$SUf*Bo2Lu4V gaUk#BAAgC׉@,ꑙ`ɛ'mJ
F@`s;ϠL8RՍGJZLԈ|"y	=LEZk2\s]&bJ,9Qg,NyM;wVrp˟	0NP01t]"tqfx~P3'`(gqp}ť\UǬVf߰d˴^@Ƨpe"ipLcTfVhֽ r*$deY8OuG,."C-R-%LP1zfj7\6n͸C=JD[9Dt"p!t!h,J"J苪jی&=&#&)A]e'w͔=<۪i˴[x<LVerx/d+
d_?e$Iñ[ηubrb9.cQpZ^mF`U$ҧA+i%eq6/rZT=st2-l3hlHv;Pc	8߸25av4;Y.sr\` (6o9n^4ת&u6]f6qzcչqPǾ51TERQ8*D(T}Ji^H4>u$>-swGNx:"9~^lӉG?Cr~40?!gc<8Z;~3:Z>K7CQL7BHeltN'0xEK35@c&>pb6pOv` ˋRp_rpy/ШRcBC{~,nj)H>TV6I*S=+̅ls-Th>\Xʉs53<dS-U(Zln<ϔVϔUI3j1ٳ]}+/9h211c=KZ );.,"J9#3Z
#Ugm{yHֆmḦ́"-lbaeZ&	#T<!˞ѡ)FURѪ6B>-W\	&qIbVbGƸYMC`0%JLXNpVI@[!IE3.$T_a3GQQq6rz_8Ɇ<EkՌQe%qPPE5B q|  <&|@Z3%u<'35Lv (覫%EOK.'C"N:6=xeqiS7 H|VbԀ!aj.rAVLb(evp<	R&ozޯ IљHD%E dOIUpt.^Gr]2}%E)[Γab HIgyuOW"^		s	ͫT]IV<-5-2TQj	́YO`'cgQ煚YQZϱ:-JōD^ssӄIĭ<Z@ S#򧅦ƙ\Unq-hxq5fEE9Ҋi9O¦1RQvRw;1f5bytRNf)U(._%_8"9%Q5AmPi
Ujw +И*bej^v$ѹMe/Kq$V̻GUd[0݂ܓunv3kydNӢyT]dtey̴-<{Cb<*;H9A~`T5̗$<rafa ٴBpq!?-%RsVp9_ݶ1o?ܪuec|MlֺAc|22,JsnK)4HC2{o2@'\@PMoo#MSSԥE5gV,TRp?!U'IJT
A_Yf'CxRNE+G]e[:cY'm}rL!S!oMC8n{jΧ{7^UN(co#cwA7bVFE*Tκ9 W",_r)c#!
d	֜LS+?(&SZ9z
w2de7l_4!)73s0'qF7\y~I!DKli8΂$bP`<tU6V" gbiSZO}dSiCD3%IΤ[،)^P_BI9-dӬ!032AZPJe5;O#535ÛxQ/N
1xCHv+_sj\{i8q ۦ2SbkI!UG%rTod+3})KAwRlLXH63;xoh9\d*ʺ$5Bʾy?IK[B%✖+DQ=*Y63d_#hzOvQ}Kاr)N9xq.{lY3/<n	&q<^$،5br	IoFKL+f({T\.7
K6 .xɡ
]~ne
  m߅a`e_sM:M2"|V3^k/3eIQ"(,hgCs.Ue4֥n|Rū/Tl*I4K]dibaʙ$Ҵ[/ Q \3Hchq.J"q}ix*lMv=8T-%d:^BR^}ԠK*ikuT̬'ˋ!Ke#~$<	S6,tbគ3SkmXRy1@;m
)Jrt0@WJx\Re$(,aU?ȭo")@[.@
5wmOK?.(vx-,vLXɅ[8Pr3`0	O-t_ ~ͼ兩VEnܡHXM_GЂe<*jQ'X^Y)^1;sB=PZJ|O,՘)6|py$j֕kyUl3S7符,E%VV}@]Dʦb0io(%>I/|srEUݜg0QS9)ד	=!S툨ٖN/7sΕªApOL!]h>'n!OdJYꛭrKy2fKhŞOcnjE0n>)1;|y+[NURuKCŰM>LK<҈$sZw좱':UջCćnwrHPҲ9[&2՞%e <`6F#>NyY cP[=|3rK :g`sŢQ<z,ؙG/t`XL\sOQ.Z,'^(9ĔpQ63'LroVJ"3Ծjv}\g߲09 4J;OƘ&+!KAr kd	ElZoĊ9+;̒%1COyxy̗775->X|ePym^Ͷz670y'EŠ#S@<PWDW`7-i@40X02#D<yrETG_6;	sAuD_P#>0 86sm:()~e+*i8(wbhs
MфϰsqS]CQP|H^o*Kjb-8Rbҹ1YtLenw=ۛLÂ՛%^bd1;#KI*R%-MO"<R邸?5bwSdкJ!>?j%DF3qa=*7fI$0G'Q̒R,w	z<jYr}91Ri^=\Yeh]XwԹUV˘BS_jho&OUJA3t `Z\>yȫ?^ވa+DJIӊJ"}e;XYk&`
~3shƀB@_Sn>1UFo蟈5݆h6׶r;߂u'7nDgb:S`ΡH [8 r$gq@Ra  z;mcՀfP+9?onՈ]~M`EX5Ĭ+[5_Ѫ!I*R'4֩a/t&ϳGюس eNcxwF9-8	;Q.?TSyix04|چTg[lj2eS6䃑Ӝ(lR퉉5o%ZTF51(fW*r2z"9X˺ҒAQ(w"r}[)|ex3mHLCC4e_WaXVz۝z趂f^UW\*|De
ǭ'Gn{O
żxnc`9ai|,Y J<*"Px&c~d[^wbkNaѾs	riXLFRgH970>*Gӟ0}m[dt̩{"CV$.(xp'OkGIj
1 q˘enO<vĪ6lZ5S1:QzcCAR$x21L-8@SQg˟Q]YRG'@tV9ƿ96v|YjhrEsb%k9s}n*/um>@vy=51vK"(8=Y<}6gO{0^J:]8svG6dk;Fa$x:A
G?`1uFW<Gxb/Σ0'ca'C䉧*Ń'܋ux̜JԋǸeR0@9 hRzG'Guj65)S{ϕ3ưɮda[\|hV܅Oc"s"ϩuІң/IqT
_Gɱ8>c[C7z/	tF_չDͬw$AX'չdlʙO Ď:<~ԥG64EK>7@Am|Vv^؏Vε;L^{;JY\"?kϛV:?b' t v(d3DWD6tL'Tǚ=D8h&~I76N6o:P*HGAxy]~/Yx&yfJXњo3)ڈ+tV?5}J_1xG;-U\UhExic\yM !A-n0VL\M@dZ$XGiIi蠯̂ajga7@!D9(̦lT\M> d2F㿰RMgzo>V޼VERTi3ߜMwrRwDQ)-'idON)e뭄3,搊W("[ǅ-:x.<ETo!9aO.jŕ8_NWknƆ&ĀP= ]'ǉ~)OJ`SE^[-[~nKXCY w4RB3ODN	㲞0#<?eor߄3]sn {~sQkg.) CWOy.fT,XqwB6^'q6M2~J=OjEgO<{Z)&e쵀3%/8|b)4rcZlcgU^rˑQt[e2G\̂mo,$@"zh">t&#OJjQ/r8qҒV]xGh}xf&}Onm>	Ls*b0Xl${Q3J.80`0lWwy7ȪRjm1<7>v~B|TBDUhHW6ΒH4Ђi07R+<.l~C"0_|rcn|;Wne{!Ͷzd /P$VdmxB"sq].pkQ~>!~zAwT' "@|"}ᩑppwլ<_XuxފeGJؖ	!Z5JL°s3-4];'\g߁ۑt}S͞r<&Kt\G^ԧ]g4;a}ÂqP5(V=WOx<vI&>8wC/F&iOM$wT")ܜ^Y7<kN\guv~(ʚeL9y϶AH8c~P *6iN=w2 &oŁFU\gxB
n(,|'5́+ \W٘zYG8*9,<JNZ
Q[$Q@1YNLxgg	\LߏƠF㒡~XjXhjH_x˨VfZM:[XkڵjZmY֮UDP9	>},HN&ׅ%=}ÇlW>Lqe0fgߡϸH`Dk\5$0>BPnf!-~?=;Ê,$:'N'S9L.R)
Z:TK/	6+*3DeVf/)5>WKzE4%=-,,ubfuM͵D.tI`+rg@ݾNi/2v))!iJK_nhq4Pd"aRQ+p:.'Tũ`aZR<LM貑q;zC=Y %=KNQ>OԓZHPq.S(3.̗p$6 !+}FoA.ý-g-]8^\\\}}z;zѽX^-=^z3C 7ۻO㻷K"d y3H~IHccKFTPV.3Ȭ]U$:q7?"PNnL/;WԮŗ~U8xj-[u[G%J1c7͵s}wqO/PƬnFۿVorf3k]_W󿻸?{?qp󿿑cj1eLk[w\BW%&GM
Mς!LJ>wq:5h38B|u%/"
N$t=ΜMfWloΕ
8vcʄPZLR+h{$7T6қ:n_~(S,f{}Q#\0S@U1>(;4g';Qǽ8G	UyG?qvyxſk8w+!+(pF"٪]8q,	īixQyйXru`_j7X^W..IJUZZCI]-]|a7 M$-!>rHAn}!d?d9l"O)髾;pO1IgDрANXʶ`ڞHIdS&K$+'v_S?ɀj?kkVڪ&cѦ9ɗrڬi=td$7賕f~ڴjvmex H$I8!;NvzEm6Qɧ(&:%羜X;M#u\M)b)n%_wD0	\'LL`Uo4Zfո䚨im? в(yAKݗ[{[?nZm{]cTg(~F:<;SɴB!Ju,+!cTPבA׻zb˘&v]m;R#)ҒL
qCϼpH18~DLv7i}Lx5{?7[/w; w_oyw<{o^vDkHԔ~:[	2тO	oӤU}vWog_T{^(UO-\ݝý7wPwO^mgͮ+yvԪv~ ӲibS
[[wOW?(u&M'_W5Uz VKjm5i6|oF?AhJ&)-(3I7oM]Yݴ ͊/s88S\u΃߰M"Ao^N)n?/6Gd4TL;mZkvC3|2Z<?v Yq0m:5~wq8j<JUKeҏvHG"a^Hάd5<ό$wx'1uvvo^_
i8s3kbz󊄢iN9PCMgws%lv+jk9@Q}tx'v_,wt|AYf4`^^Vs⧎]KB%
(ld'wC?ȯ=yMDЍz+37wrMÃZ5WmD룦6H$P$6OTJ/l}z2_7珿WU_uwr(+UWd7uLh@IuGN?tx-ikյj]\l9"׬3z5˂yXߴ6CǇ(Tzq^Ϣ'a>)c]j>^ͅdKi5[UlɕS1M7k?jq/1KDpi/yǅn{g$$yiOyx_C1OuYP^ƚ&kIpת6&<MpUx6JU<JOdG;t}wK)%Y_]n?Λß2lK)Sr%x:Աؑ}SzwZ/O*%HttHSYiFьq;RPߍz7BJ1`;W"&2hOqȸ:
Нc0	ޅAߑRV3N u&~4lZ{IPNA[HAӧG jmn'x&[a+:lL@W	hn_8pO OUyq0̽"ɬ}c}8sӳџ<jyrRL/`D3D秏?Oil-[?+EJz6&^a:+ oT+4v(\voziz+@DϏFk5[0 660Ⱦ6Xo8NZݞDv)M(:kl6-YO7ks_o4:j6Zu6Bu jm)v-iMmi:'B$"kk5
f 4S۱ќnMzmD# Jk jG!H.wr_ʎı;#I(]KG
'tedO2kV>;iس``BR5Չb}|Izyu9)=w6ςT7"zA	4^`Xߝ	A2EF*}87ӬC-Ǐz_i,<"@Oᩨ=z\Zi$ˊǤjXpifF'>RNk>OZT080:BPŭ{chzG`^<=	@S:B
\]$wc~d'ٚGE01Q~MJZ~g2fk6jjI<fG$iL+?YOo^,wz'`jb)U9;ݓN顒Ra%ƊTA},ت;Kzg*甏%l[d.<_wJMzl6FsѶjZˮ⌧<6jcvU&?U&aj>/^֋*fm#ޭuvUV\>Sj"Ӿ]k	Zn49=6j@ lݬ6lYPZWk[[5Xg@f4k7Smn4fZתmq_o8Zuު[@:ЅzhX]Y]]UUݢvp\] Vn!{l	m7B! Lך6L$ h5IԠhfêU-gy6jS܆*PMa@RE(۰P &:Q9
Y&L$luxD fAE[kKP^_lFnn4z*p0ԃ[vY>S͋kUWM|ڀ$5Mw6e/
 m˧zڱ5F7d(lWXt6Ѷֱ-`P_Yn >yqQAbuT63|~m&TNmSB_k5Fޫbk"mT&iZȑm7h*`n0жLn0钂z"Aꆁ?fF!(g5,ϟ<lF2(RpYS@Yc^Fٱ(|}ɺmG J27VI#2#̀AaX +u:d~) ÿWOFIgEMk~-y1e`~lǁ}/ƃOY.z)SؖgǗ셴Գ]Uh5
'ڳ
PC׶/~㗊ͯi"zcY_>}ieK1Yk65Awq=|@DgKK}eVHySK01 1YbGyz0w<&\]Wʹtn,JR~FwjY:,;HtV]9oS^Sޮҏ|JLϩ?̒gJz%o&甹+9$#3^fŶʹ"Q<Y.+UpeNIG^uJR3!qyf*&-+"}jRT%9x4Y;1	׍FZCN</?zuGj$h-_FrGʿ/
I/X=)'L_G?lLҷt|cI$}8{6k+4-/KO$< |Fp:kG˞naL!,M8(6	L#_K37g|ixМ	J=c]Ot2?pz<G43<?|Mru:#5e7 6$JFi?R}ڨb',,](W3#	eՊL+̔1t#e^vkHaW?p?yqgbûpIac(raU#jDqAj	S2LRN,ԤwMj(˫0WzwN#^)̈uܿBnN$;ܳ\ɜ#T1dmFN@s8Y+
e2ۊ(K(/#9`A*Cɯ⛤	қYKcp"<  Y2JeEs]~ddx;^iX~*+2<O(UjڛcMĸc Siz?K	CH
	z)e@8KU oLQЅ0ZgI,7/;1@owfvV>w{|I=?NL8+g۱;%!pwS?󸆮&ELDTAwJ4kJCc-5W&&(Fu'38Lbh	:eiM! Q:bf\bQxgVG!j/mܢz^ q9{Vv0,FUR>#kv\OPG#dY!hm̕&׉_]Ma?~JF{/:%mg $1:G]=MtfRzA2>BSE=EYŒTS!=~?I:Q킵A]KJ;.9T )5Y<Z31H	ceǵҌCQ^Ȩ4Wlllǒ%m&8smӪ]Rs`hp&Gw<E
XAUf4k:!%/O:zfF%5S*"kP?:H_}0tqj;z[K0BdlTP3'3̇#?:$͛!7;4^b-vBSIx ]OY&'^Q@dQ&9ImΔKv2A̢qvTҍ{N~p1sV<?o8yM3':0MfBՉ}"~~?Ȏ5ɉpK<M{#98=]8Q]3Z
%R#N-)VI ХL_nLHqk%KYiGVu2kY֫OXxjJV97pf兽 R07
Qdo a%<cPw͡h2WPA0wvs
3sywpYq17sZ 74K>-wUJ֔cPzFfJe}$4)5J_[C6jCN(dy	Ċ}-4Ӌۧ@ &LI ٖbn?ISe-ϺD!]Q	C=dQ*MHn5H
g|w=ɪV3¾Tq	@l{)숪UEלƖ1pc}$	0K7K723,OQ'
a)17ﬥ?Eĭ_@:	E״xN0`ֳ_RH%ΧNUpT/.Kݝn>'ƂǬӫ]sT4 3f*J1Uh1+m/t߁_GfIx4R#ߩNW5Ģ%:WYsÃtQF@q$r躟x䫉qx>f-XʆYO5I4Ln!^8909-{9
֑uivg|N^f ^{&I;"z_&\`I/<݋''0(z:)F0r} N]?f9nTo0A0d73xYE"&1Fƍ]%Q`FcHVun>WVt%LꭌF_XU޼V_"i*e ҼpɎ0se7vN&,Q#"q[Oke2&/"7qwnJҞ+)3<߷H!t%>R<Gm*/	/+t/{gSK5nТ멾`SKm.*H3-9V¾@Uk\K}-zτ317zrXYMm+YۇsF=DدAs+0:SZg^|o:|~w<m`U_taGTै2'BiQt]j~-Z()q߬|r?@g(V+d3,}IHl !
q&K**,9\ќ st$uTȎ"MTXf>턏fR>7>CeU=y
[.:p.@b7evJsaݜ^A)Sلzme,~gc4xJЖ$4
AwUU9)wa슏vh0VO04XL7RZgàO{P3G䭺)ZE[OHqhUBe=#P+'aQZ֢mBX0l0"Msr9XVJZE:#Ta%']qLqk]][k/dMLpc:$z;p,Zn/Ac^
n^CyGp%BB]5:ӠCJT9z_VzRY)GeG<&Hsٙ6XVD:8Q'c}WXs`hI
C[VЗы-Qyo!+'9'RY`b^f\!ǒXF3\$n=~"pdOz꓋'EmC	v$AWSd`j=%8(<PE;
 Ѹ׃9^J!ώ~]~N|ptb"oC?cpM G+Y-&Zǥ&(`܇.(J,/I/xkWк&q#82V·M7:H?
H'z1"5壘8tII04kRWS0cU6:7Kq vY@P3Hg 58|B^juy,^ݰ5&W)a@P^N
opmCJ
+Cr!
ܕ<|uJ|5;xu5y+4 ? (" AWp*yPL
[fE/ {uan$BEIlqFl
0g}VˑN5*eBKķMK3#?=2C7W3'< _0.w3h{!<&IA@SJ",ؙO7k?/QƴUo6Ykߟ}'׫v#m>_!}h Ǳ#z`8EZIԕ%EG6wD,`pHÙ`dL/&_/`6n~7{7v_5++m?^	 M.@q0h҉AGG.6g(5{~[&u*%gj¸U\¹N.W~@˥'Sle"HROlT'FF3p%@_%s=Lh*^GS$}A`X|oM{}(L>i[TS4$p(ޞW.JL.E-󁐤uݫ.VԄ*M3Sͺ^oTfYMf֣Swo("K9SV$-U8۶Ii{7C|^EL~hJaӂibE(0ڍu\mXtRD;-[^!2dK%W$EkV?w tPU7+7lZd翖9nCtG7:q5>'Aσb6Ĺ;k\-<eq @}kGL35;tGƐ0
 !m<{'<$Z+ie>­ef2aJ"	Ƅ!+@yX!MOKLZj/1I<)>A5&e<`E ENEћsgr'QpZV:,$QhXĥeC\=kn'!ڨA5d9Hh\@1LoE.|t%xNu?;Eh?|0=?vc'p:Lw9q17~*x6 RS5mƘq:_| d{n$?HŨu@NyyLctͥq̌XM* ̦9p)B5?$\Ԏ*Rv\Q 0B6DTHjcҨWX9ОWI!b$Ubz"8wCuMRl"Ȕe$ﶋzQMs,gIQK{gPMn	?0+ Dk+N`xĒg}˳ٱ>5с7O􂀈{/ބ0lM_Xa^x<x..m@ܦ(1gn9lrl9QаtP{3嚛J&#` ?o,m^Gz!WEUP
^\c`}=~HS:҆ٺ{ԑdlƤM/JYGhH/ykɂ[Y0*:XD_Y˼}Ǯ	-~u@ 	P:uZ5RV,gp|q,+YZ&N_ɘXGG??l%qUUsbN7p} {1h(  