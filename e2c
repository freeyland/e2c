#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8PdJ򞼔RU,nMR=S#jLD+X"9ggck{}5ۯ/Yw LQnBUL\n?|ޫZZ~m֛W\hVUmj֨k}fG('wC $;9PhG\6>'vl5jVqwqQ7l$0c֚^]\Ǟ;
oN.AkվA߄^G͵=co|u >g&Rz!E?$=hD~·?c\Z_:5moڙo;vY?Wbv1d g7UB7
D,_ >såOةǞʼ8baN`3/4\\>>K`8tzLo/ū\ۃ`>pBЕ/Nͦc0Ap:dz(:6_4&f%C@fg^Dag{ot6d><sP'Qx`vFTh.c$
T(YV_MZ|k`8X`FZUo4kW=qƃx׏7w80J޹iK6rtXisZ76 ^1T~l`B#DȎ?=7{/ȼNbY/[ٽ0.\QCqtw箌\|Dú5V]wq=|@?Nt`olBt;.k&jY.+Uwo!Q/F80۹}ݎa0YgY01|`p
r?z1-xKK}G2	}/:tdY-zvTΦvN{umCFEAF%v$F@"[TdlQٚ:SbTLC1vUܠ6A֠"TdlPY!	5ۦ4`ܸ;
@#'D"!pj)-.}-fҲhۮ^e؃IKKzLΊmg{^ǃ?Ck|7 gWW@5G p]@E_eto{z!;?B"Ug;)~ `z_}w_Z~laSw-]H1H^r슝n}
{IgM4:R	$vF5cY"uQlw/v_v^~{iWj/߼>txFK&BLۇ7[?+;^x~ȇI+fxC3k,E6ɏiS$lLv|ݽ7wE
,Xz4p`-ylȵE:|9q܎X8iu?:i\A=zA8tN'̏~Aု#(Bul&_!Gq:-(,
`ΝWrM$>5ϫ%9U:WP]G-*M`|e_W|XmYR6Óz_T}Ү]+Ǹ_.8tq31BDRC7(:a\fP.e~]V :NbIü=NZb [I&}/KBOM@`rfm#'>+6DwIAGezʏp?		eduHLE.BQ?st'9:8>iY &҇)0.K6iV^0r;gNBVO=Ȭbb^!:9ZzY
rm_U$XyrkU̞qjK$p.Taqe/_)C7F\ePEdD>}#NDNsO?ad'	z	#`-3n4#'S	@HajK˟$J
*ʑdX_GqIKV=B\er	 w"Y8чn~Y	&e0HU-H_	1Ҍ	sB9؀;)zy1rG_uoMycA~{
xӛeZN9;?6aoki}/*(bwg`Z檣"ji<(oNmj^e[?wOq#Hё\7#Wm5.#5/J1'|DԄ[.n<%sF(x}i7 6:9 M~}-@f5c5EBΛn-Fȷy}(h<Os=p^K}Q.ne )t> ǌ؅wn.eV`c/Van}X*۲`e{wRA"Fzw(Cz>C,gbʲloɗ-J'8/Νʢ&Kv)חdqIȺJlbrk\ZN̟`w_S<)ldívu+G_"20ˈG:%/ŘE9{KQAt`q,rY(M@J%YV|9rWv7ZV_L[4BN;F]ړ.JQ
E髌: #z
[~lه?[/^M(e+Qegޫwy?:zTV
KX<)-axaљUǘ<̈EcȖ\Kóݓ#VBMل*q>)Rufl`Rsh`
tde )躐Crhg6vπq?;PɼɈ6$ڐl%J>\P̈hIа!_+$ΖhsEvl/Z=O߼lovD1v?N1R+JH	e )D2C׉%Z]J-TBc! rixSBHj~ ?\~1XkeYHHOؤbVi$}ýMaiRᴕXE`^^R~p*żgxޫEJ>^^b/Y)J+ȷ0^Jl/iSK* b1f@9Ams"(W]l?7z5rָuqsa~ũʊrIqT.*Ә
XQ&0eh#y)cfq9Si	aYII]bPr0zJYNΒbIɷm 
!)殈$`$oT	SN^f^-,_	_	_	^؝	LǝZq4hUiCR5yazo"me˴unhfV*hiEG_Hh\@+CA؜nSSnݮ5+-
H5;L)I#LmC擝jċjvWgJ3U92|Ŧ$mƩ%a%o9TSV
)j.[LSuÝn15}(}$'x{<Y)7N˫bUY.b!QJ^Yk9^hE#f_6&t5ÛLI'uFwKbEr^Gƹn&}9<`LwcxY\+t{r  PF}w50")Üqʾu`:\X1[h'y#+sK4
չms~,ҿFF9NCKu%e" JS-8 l<*YIllb#V*nZL}WqFȁxJoWҢOl7Hpp:o, $P3+bU
Jy9),mH~J<铽s}HQ/Q,H9ȵU8tʷq\,{hYKn{"vu&ɑ,N+Q~T[~G󊕲Zw\LZ(FK?LF+5$y77~4tlcNٖۢͲt-Ҁ}♚%["	(DNۼ(|nctmh[YΏF*iIK@Pgd.kZڕ#?ñ7h?mtnvJ¹4Qn|y uO!< 2HFم7l0,ƣ&%|ϴxd$W}/"|_@y(%~A>=tЃ:?7{TQv+|K"nɝ>A+L&X"
TV$82SLRLJ3Tٷi6a2K0SgEK2tAB+[ɖ$BN9r{BپE}7XnOXhtX2d2,G%W+D)IRm4nSvraڙdgahhE/4e&f&D@+6bWΨUu&+@pyA]zN	BagUVKbW'Ѭդ,;Z:uSԹ?бVXع9ѕ<	sy3$[߽@WsC&վrYKqF2b9qr>n2σxHnTYnDx*9'Ek-ڀu6{| m(Ϝ8W:<v >
foAO
e/l&jse{+&ۈ#I1wK	Y: ʈQF@	Qd0z;HwHRLO%=2xhیw4^/˲vIQWNG8ʞkf5(Q^-Xk3ʂeC֭Y8e*S. <Na /|+)@W_ZPniïGc%Q+*bhD=PD*))50Ҵ{?U$Ved#|pB	)Ы,+LIraҊ86G9I&j/T=O3_OKcsڢwʷixmKG$i|l;,h??E%-sMs~	3 9VzBYKFL)q
+q\#oSڑ2'Q.G,/HN<p5h!ϕȔxM0p B!(_b.$ip))ijA"jD]B	UDDB&D	5aS%@'΂h ZoDwV Z3;|jp_Xe)1Z8'-_ӳߜ=´,qK>#L-7똼3i&n6"2*C/YN+_+TdܰH#><{OO~W9wB
3z߭d^4iISѫʯ3ްR6$}CL&p"Mq*u9N#!)#CG>LpȻQ 댶fؙsI\I*A87n͉pP<O41tiR3z28;"%*<7PW(C#@Λ5E5D{8,#au'L0'Nq449pzBHFI9q|cuH\ՒaD:*B\?!LJhXRն7F I_\op3	1^Z4ۃ'xJB
NpE\	Jp%y<CPd7-֜&1Ɯv4̐1&	MK$2G$*n^zH?/z#+3> /wXT'a TX `iAx
=SA-h-E!R
mfj4,|cK\ <hAC%G9ki#@Έ<RDQn`9"fBL򍁜n``|Q1%-O8`XGG)aGE.Jz~&I~73ܮI/TrLhq+~l4/Eh]D)Ȏ'B3oa6$N.^VkS2վ0es̩d <_i5Tͮa0(ii$iA0ŬQ5
F0(fwEOO5MJĪ"(V6b],qw0RznX!cna,{d-lKے[tvn,z+zn%o!o&ooϲYCV!k$_SU	|U_W%U	|U_W%U3U|ՖJd
Y )_"=JMNtWK|(n7n-k'w䮑OPOʫ'Փ6ԓEԒ$$$I՜d祻$k]-}diݑ:C%-5K[zI{LG{ǵɛIY!<4q%S-	t-wOfl%&)`N(ъ(19jBfQkG(vTb7g3\>&Rs9	cߦٕn&ы&л{"V&6uk.*pCC*	8 Y%2eX(S!F[2T<7WZ. +^dW37h?)EѸE\ly;SL`hyWT'jGg(*Bc2ćo°&Qu\";T+$σ-VijRi5lv"^iFc0B|#!y|v^ bUͭW
;dK%[B3;%]eīM27"jlR)E09$"%+c0%[ѕvPWӍA[UZ@/G
*sBqn7i:ܛNkM=IP$!c"4!M=uyid^A_#}b1/oCU͍"'0(R3!xHކ<髂7"=PǠ͑ē_{I'qu';rO3Ti#' AitEcTU{s+}=
<θAp\etEGyyexw+QEҎ07
w>;bO~2+?Sܘ~䪋v?f̃j3ڶaM:	gW1j^r9G D\no7\吢H8%87}cN¡+5TbgXК-0,|/"G'o!ƀ<w1 x4⦛{-uPe2ZǘbŒ-fHi\U"O&b|I8n\-_iCzrMMtMjQk=h n0z2:x-1;Ueh,'Q5kf&1n}v3G 5.IO`<J?f=ہTRA)(Ӏ)8tIT,Awf%56YYgvmE4AmbMShHDBG\COE(2-0'-owhJƦXjPRo$j* juk~.Bx/Ea.hJALY6!}դYCR21
/b!1F3&ĵiIȷxd$8#ݝýׯn*W.-砗[3dfM2~$|]IK2'5<8eպh='1[Muv1<\Mt%nV+[͹z+7s]Z񳍹EWowr&bQMelt^ͭ589uS@]O]2w8ڹW0NoL&1ntHZ&cE<?n o?JBAu(%Mg7xMf
&hszԦE"DV#~4PI%~ΦΟTwIy=*,O$D(S"li7`h|ZOE\~(vfaG#cL  8?ٜ6BP*twa욟ox<,ċDx g_;ĵGg'ȕ(NQrSz]TB/r-M%礄ln<>Y2YIp:8eo0T{[:MND2.RgM*c} N^&K-,Kg
^-3CڊfF*
p<U3a&KmXu֫WڊηA-Av1=	]r}4PK&Yױ*^|+ϼP[/ax[)|O_|{sQEBb;؍( })D}Zg86umZMj\4fuSfOX~>̇Vx?%OS6~)QQЍ@9J]*hYmM-95R$Ia	$֓&PYjyά&p.i\e
Ǹ|\Fmtih,RoJ6][qS\=l/>Ӌ[E$~aEAzupOw9QJ.2bnaŘ8(4<?8i17ZdLb\] Ťl=(@X晧aIƾ/ f1P`rޥ|cZyQfʏ5s!T]ׇ4]`PwY_|~@B972@nX xpp{xwp'Q_<^U\y3w0fA^Fjc;^{7[	Bw(E!d:*\raw{1l{wE#ܙt(LT;E5iٹe	>8$v@D=wF9>Oщˮr 
Lk5zwɪx>E`;crsy}1=μrYHHK67(CmȂ?!zզIK1:9EƢ1w61VQd{9塔-Y9Ns]v@Nx:{o6 'WXodV7)	5{%A#"{ΓGu~q-4GyelS@a:_(0ی=TL
GS􀹓Õ&G0 _O~~zJdzMղ
$0` [TўXy9ϤA]'&kGf-5o0٦oT	o3!Н,TW PUҏ`02d6Ky9 h#VkMF.Bw0	15qp}.ctDU;=VzYH?2>?Q@Q]crL*E'1lc:i.D@6CZQ$#?R.*[]cV+oXiV=-){|4'3JgCdIg|\`bHdZu/TZ$jn=ԥߓUSXǂQ b8fV,xحɫ|SOeY ov
FΗe[9G$EA*}eGQTz_4U;09<d1dpA.f̈́۪j˴ۄ80p]2AC/˟qB-{ŤIrcJ##9*sQ&D-ڶt}#Ӥt^jVò09-egFkǢojL(S#01:*yal9FPrM8+Z%zXȱ(\!Q(Ke
ǧ@DWo8n4jm6ǎ!3Sks"fބ\ugT4!BXͽtr-rR&"xH5Iעk2@9;evMa~<(Ct1Fb%#\W׃b(EJ)L{N@vIAq}&br^uhk{դۧ"\'PnREiq@_"rly|!RBaɽ{:]ZMO0J#ު$SIB\x/3u}̜&sag)aK3SN.SsΞٍgz0ۛ23	6zFQ4{ڲr--[Ƒ0fgQ+$Kug4 %^I}"Z,(Z+y.{ڶן%NSdkؖL Z@˺CeOZg%EP̓*Ya@)EL!⤢R6 "i
b"${JD:nAG
!`I!$3A
:q2HfILu'G*#T4JΪgfJCO𢡊%q	. `!|7cLEXH$nӥudzcsJ>C7I-^wz #O '3uLv(jeUyIӒ ɤDI'ГN;;L  1CexYbg/	SJ_催ĔGc=<2^BӠҶ8Egb",fHuVWӷ='UWA|N[tr]0}%E0z{G<&z).vw\d+WW|E"0WӼJߕafi3k\s.RrWW38 ND͖Tl5nԻڼq{eSsNsRq'e<`4w'	5[afYi~&{	;4uh2vmA'Ь9BKwWF0>=!vLy|vI:O&7e+亳 ˫`cBٿ:t2KDqAmmt1G)*	THb~^ŴRMHv_YsYYhTW#Y͈mrZ&s.[JKضRMe>?J%oܹBt2O/&ijyH,oÃ"k:N~䱺H̪뎙q[xTw/̭%rsJ56)$j:k/>{Iܧôv:wi߅Q+30!.B~Ystr^-J}C<g~޹Uȍ0o-ws-Ze7.eY,Ri-շ&eLcPO ny?'T
mLALIXvB*[1IKa)76N+v᝙Vc+e{~8}&
cu:|zLSoM]_gjt{7/-J˫FQFoY' FB8f<-l8
!Uf3+MU_r)##dTS?,&_)iT'2G
/R}蔚9ݣ8#.<ĐLrLMgAY|i(Ӏ`0*^B  ϼn訤S?*I"8i/Y`e	dd6q2)6C T/@^u2iF	V Q~c-z(cpRYͱPdd铽s}k>%݉2^aò6&oU	#n-"!𿥲D2NTaT}--" V='U*]eF7wI"NMV	f;ЃLY7;[Z7oBb4	zk[BzP̣J1FRʧOt@\%kAo{rh]1.OnT\;Mְ	b:68ky|mEz/n،6br	ÄnfKL;f 39,E/*PS˔qSPRbID;39[Q J!0-ܺ3kɠI~^_$JwFދ#EbHz~rڴ,I>9QJr@F.v7=%o|QO,n]^AAULզ</ESE/&V&MbZ.M;Yw5׏Ɓ1~lWaxw/<8CcY0`mz}iyl<m&axJ쳧:]2`I۫+bf8Q5[^7^rԼ/+@a|fO\rx	Ǭj͔Ƌɍ}SOaW
$ݔ%:8R( AfYCnMyZs͍nRP/i^~jqA;hoat:fr\j.<&@uh}X`IFT}(k=/TUr	d@jr.>OL.WQb]>a5$߲S=3'DOcU(+DZYj92␑Vow\w4o8Q͚r-cfa wʪ3wH9[l&ms~Tq1>><B#i7GiFCؔgnBdDn˘_5"S퐨F8o7sƕBp1331ȗzx&`<<B+Q4fo-,u|,M{C^ sz;&41:7a+|_{S|v2f#[^m&)hƺ%!V|ئC%iD"{|9;yvH#E|ݝ?wF[Z6gKRWӳ4fe4GW
()ړ[0.Q	`pMoI*;W4)1+ͽɲy"ONG,s >aG-+d#s)Kᨣ4W':O&nEb}JY/.>оe ()ذ?}cctcMX=VBz? 0)HlEdjoDg&ɒD	<h4iKN]}򙻚6op~O]M2^(>/n{='N`͢Sc F%4u&;Ul'2U9Xg5y~KZ!Yo,S"F|p#hf@C]T)sAt×_#>0%:@=&z1pNmu	~D8"ߡ1ɽfixz4y=ŚjMEN"Qxњ<g?,sdmXhŞj.fsqx~	4(XSY| F  M+"Ur :r ]ϵ.sp2!AR1bo^0̮[w@u~7SJC9pMqwJRA5ed&h	s$rZRi^<\n\QҬ2!juLx驂/u2s	\*
`V\1yȫd<^шa+DJIӊJ"}e;+ØYk&`RNfl$`EsC 7%2y|a2=ނ?kߏEѬ/8wH߃v'7nDgb9SȮH@q@IBˑ8
YǑk<ZmaZcZ(Kj5)/B!V_X!ZRJ<nNG}8d<&iIس 2QxPNK'"ay]S\w9Yǝj~I:/x>POy.mXIϏuBgV	p.
!=wUAc딲HLLt(y+BEexѡ)^`v匯"/K#|YZ2(8NAnl+V
DzpF*fR2:=f(lyu=Wf+xn2׫JqUx,
-iYz$qo}W//w9bgWa\R+s2AxTzIEaL<Gңɺ&V-Eלaѹs	riTFTgP9wa|VNC?a$H**VSD4>N3HLΑ/p"OGyIj
2E1ӞvĪ6lZ5S;A=zsCNHRĽx2ѡO-8@RQW˟]ZRG'@tR)96vC˃{,uD0@"Y^9	s[KYC[OPФ6{pEOcM926NGn}}F#<YIqK<DŅ\;b
G[1[7 )2~y9_9/cy?\&y8}p<
 y2IF
NW|b>dD$'FU~'܋wϜJԋxdR0@=PФO0uijʁc{ga]ӶFoV܄Oc"s[T8Cї$8C$lA0}KR?:#:>0Q?r3FfIh 6I5./<45&.r쨓G]r{CS8T+y'jeՁhE\}Wx"EiU3vy΀'x10T6 $qyHx@tDsn<C`苖8ǝycdˬMx+E>8xz.Hg03n3U|g(63|Ю:+/kóP)1]u7}pyyp1@ (*K+岈ϻ(mR01B0iԫdKNEdp(0.(5Y0[#lДfr0 G
K'Lh|V<Sއ뷝ʶY$9@%Y'+uGNuЩY-{_qHrتn	\FlJ(ÂaH~A2=eyܨ޲{ rL 0@c[\BL&\vy\T9^tfdhlX}[!ޮ$y_0_ӗBEj/ޭ5XQKEk"7PKQP69a'e;ot-}b/+nAz
c.( CW#O ,
2l]k8`?'yOGOG8neX 0:hƴwaz,GzNV_?kIq2$Sf=Co6Yl'TbӠvAgKKZs?B;7#_xh883]GjAa)Y^TE*zR,\yW?e󰢼jϻVSṡW廽\wR$j&p,X^嶈tes,D-Gr#Ӏva0=$t'1v+L=qpgج/ʛ/9XOH$wn0%p;'/^ 
`UE/,52!:=-\e7<}rsR.u[1,Hq2EKb^VɅ;;93rߢ-Aӝ!}2ιz&FhvhQ/A'^w;lyY\*=>: =8l
F|K< yAk/i5zA571EICXj"BIQʔ)+ Kv:k:3CQִ,{d[Y8TiEykOub\h)b_`_QuwZ/NW@f!>(fZR³8
EW2Ĳį2F=ybkD7ɦtdbY'mxYX~6iw0SBUKE\'7+h_|jubnobF]mڭjUkZXk1A%ׇtdB9Wr)/co5k͵5ZR2unFVrCOj|l?*ZV]G!:ABb98?Ҡa`(uH!P=Nc:NeX2J`<D H,#˃?P%P^Wpfxp7KK/R-zlCN5ghm	α꭪ /K rrMZ+bmp.!'^Zba,͐6mmL$rKs^+>p_ L{ױ^NI	I͗ZrTF@qC~s)BE1=L~I%GuFǂ9wjKpr25-bBk9hDfhWߥQ>OԓZDHpS(3n" l@I+Fh08w~ r҅ŭIC݀{[/>S;˥K/rߕN}z{[|fIdL:=`);?,	"r``Vqȃ
 q<Z2̺H٥m$D]'GOT _!SN_\LSZ!u͵..\bRsm]n2`LaPG-L }%ۑ>hDX+vke8љ슍ͩTPn%pf2˨.ʽJR	M<A;Qˏa0_tl㞴0^uuY#TK_}l2
gq^[@H`gnF֏sZ	R֩["{'p:dbDG+t.jV4=KllRnd4Mln*PdI/f)KI]PܿUу0-1}w(nSȷz`F'c~+&Y>I7uN2ZڭjUwqmpM9ri=dDJ3q?oZ5v'좹HA82j	$(~>oEr_Nx!H:fRNEM6+1"?uko5zfhߏ&Z32|#cВ)bOV^'cr-z;~Q3;
-S	AJ9x*2<rW8_l{'+u}9\Z)v^B/:N)?gُȘNf>B/:<v?p?:ހW`w Z||upOwZ|z{nW?w$/^WЩʽ5˟"u)-ia>MԗzaG~I%_yoC/:JSMZm'lwgp	ݓWo~zYJ:>tiմRa~;|Z˟b6lw)X_zT5UF VK6յ{ߝ\i'f3ԟdLXb?P?:Dy<ȄSL]٣ݴΔA|=_(pB]o^ny
*L?/LcMo^~N)n?;/VGd4TT; mZkvCS.֥%!ُd?dG(y{gz!gl
ȋ~wq8@kk *he%:Rl%#&ςՓn%g6fgFQM;<IBFHiݽW~pW{1X?{EBѵC'KE⦅;~6 ˘&o<y(bGeFH
Iai`ܨ=)7tf\"BG<-X@f#@}	}k'CF[Yb%(j4c{JzWJ_%uk*xZzjUoW~'׌3/̂,g10TMvSsй4	GMhRio_d70w[=k]?r^uE&zYVY*5X.kYDd4c'3e+Z4˔ys&D?9j@Rl?ZtC?4[{wr%/]ȡpuLZKj
ϋq[z>L[W$k]'oVfZ\浪*ߦSx,z*
L_"-FKyT9c>7l_E1yG[{?wr=}z7{SA?\l	޸NC7v>KSYiQ2"=I uJ^?>]<-zxț3"`8nVw^Q_ýϾ"u-y` 0A32	bކAߑR63N0zM6 9=|GjGc~Di;iG{/&{xrFMhmn'Sj&[a+zx0"`p
'<8^f̪773;=M_Qi}^6''bVK$8ӋJt~p62
:ެ s/vV01
C"!Yn]~Z]E)Li'`YިVH
hf&f޷Ѧ'/`}nXDviV@funzmZ։o4̿:ikumVkTڴӜTB֮O)#-ݬFyckS7znΑ)gjZ
%4@SќXDݚLMډHQ MZO.V+lp2p]r`:qHh0ܑI};͍2g	5[GNfn:|TYECg001D>|IzIA~Kͳ 퍀bEL	h껽{OA&;Nrgi/Bg45ϣ Ll9ԛPJsF䞈ZC틯ɥ̝yYq0PL>ݢAp<BΩFn$1RN>O(`2qau [3,@xzGlקau2A/:P
P<ߵa!}Fxk>VŰF-w&+UL6HTIҘ5q;p0AQ4Rr"Yzr9(To8J,tO:J
JkJ0i+P|<cVKB,˝:S>/Jto䞻~P>4.6~)l4mXYٰF^k-N3^۰O?UHT,7sFxkV[KrSثZכ3OF_zf?	ЕUYpϢhn?9&7ZMjvcm'Q`G5f95fk͂6ZZn7غݪ:d5ۀY)jkvh 4֚VmzHժVԁ,lFjZuͪoըBUe SMODu0[ ]_gkޖOPQ#	ZBtiBnmVXoZ]m6zްZUj
rֱ9g`pyy
dj)^j(evB9«CtFv,@z		{kmp/8 "|nYZبWzan7mѲ^
`݀,Zm)X ڵ*WM|ڀ$5Uw6e/
@m˧z-F7d0lpTXx6Tޖֱ/`P_hYn <yqSAcuT63|zm&4N}SB߆@k5Fޫbo"mT&kZHm7*@n갔@з,mH霂F¾憁q?ff)(g5E-7Ϟ:lJ2RtYSbfyPSyeJGL2io[/b@!5XjyJsAoE[ഠb>1U
 o~0J'a>/jZSh?QtaXj#8pSOx0ur9Kż8^0)d%{.5llk\ Ǒe:Puǋ=M>Wf3	l~.li	X2+D v X^Ӿ%)d:>\]WʹtyܸU
g<Жwx:\teN>F;cgs&&8]&S%C~=v1JM)sWs\IF#gȩH
mwsEh2ws<PW*LIS!a|YaK"*y[لb[aKBq~Abfȱ47^phY]߭0K+\||U/#ʐ?c?1J7QBNRhEҋ3Ym1'3+.׮Wi(Z^.cvO$<CFw߿N}4]BңeO_aݐfg&``"g:ZEihTV&q>7^ꏳ40AG?7߼{n06߿t]&FHM$]8Q:."hmԇg!`BFA.嫙aބjEyUfx+/;5-\RK
IIH:gA8\R_YH&?#_t.0V-aI
1h0s!VT6i]".XZ.9G!FM+AWǋxN=%̉>@Aӆnp9CRY\v/H{/|0/"C=l=X|m&q¹fRP2c@[Q!˕
0NeT\i:8!SxJː:s]])ϗĄc
	l:J7p
1;HTZ^eOx񼯡B^J	"
$RHIZ46t&\ȿvvڗsgJowfvV1w{|M=13$nCiRy`2w_^stFȰ6NA)mTSn~t{;"HdI-JNIZcbƒ̌^0Ҁ13
D<Y3R3NInf[ɋ@>]=bNŠ*_JR}>qg2sPcj/+,ZseD֯e?~JFN{:$mW 1F]=MtnRFA2?B&S=EYS!=n|?ɀ:QH킴	]KJ;Θ5T"5
/x!)gb&kd}ء?&%3OMvre Nπ&B) uzrWٲҬN:,43dCA33+᪙|B%1C7>0pti?FVK
u9>s{Aż?C2߼>`xډcoA0=X))WI-j`)ay+rQ6|65zINr]~h<X2@};tcĞ"jL`n25Ϗbg0n^n̉D\CX&+S!D0 =}_$ǚD8%~EHFF'NeND<Aӹ2BSKo9d)>lT%ueIIEݬ#x:Ѵ b'l<aF]%ms83)XЛdnH(2HdxY㲗|f<v @ͥ"	tAGaIPm~FYo7UX͋W̊ui[
	6蹛W:T&sd30&P2,|&!Li)'/VU.h@'ΛM%VuQT?E* f5aIuls904*{|%*Cy%P]@	LFed4!a$)ʟ$XL"R -<t
$Ȉ-dh2.? y{	fFJoppxSQn@mJ̭;kOFF ehRtI{D	Sf9yTD(Ƥ!kaiVاDYվ~ˮqz]*kb3E'=jia{Lb%N
˟Dw`ٿ!RHw*Us?iIFC%i=DpUUV ݔQ ?br瓉qx>S9Kb.g?'Qt4
޲{a,XL@dL;p@ֹ:UJINK|-;yXz	'	LS *&GwCPD6:L? b96!uѓ^8xO$O`RunP@M%`P;u0rQՆ k86YM<ld	3
[DS?O7fwEHiiZ0_YљC8;̫23aNjTywX~M|,+Z|OÙN&;[9^>Df}=I)rOg:.hf8<w]$t[Isp!e.->
Dja^#fq脗?3%5Т[AX	3TfZr-lc&<Ԧ(^.0S_@	gcnx'3j"8#尲HsEWq#F<ȯAs+0;Szg^xo;|}w܉m;נUCuAT॰R'Bi:Qd]~(8ar@wHf8CWxѫ(fO4̰]D9l: !2q&k
jY4sn :AH̩֑AE$HtN	-̨|f}J&:r{<d8[KN/A\K^MаR:z)*hF~^%S			T6ʀY/
8XrԋǨE[^(	oT>V圣GAuv+>ڱڧ\;j%>v,`Q3QIf>jS6KeV݈z'ݤJk@{Ȇ(-iG}!T,ZJTצ59,J+9-"Svy09#.w.qԗKEUX^Cp&0HiU#85 1Ca/򩼣[s4l&iPw%}WouV##DUu$	v~
й|~A,L+Mرپ+MP$KGVЖы--ay
!)'9'RY@b޳j\%ǒXF$=BO8_r2{'b?"qa
EN϶Tw$AWSx?b=%80WfT' hA@/]ώ~C~IlpvB"VoC?s5 g+,&ڙǭ&`܇!(ۊ@dPF{ߩHxGbY^~?z8yxa$s:`̩^trn2YC^KJBʦik8.)=/	倾YtE@p"y`e~o. GKߚg}!
GVBC/|nӫ0 (/߿~78wᇎ!^%qtsAqsLJ_c?1>tᕐ9P}叆W#`JWa4w5;U˴0?eYQV@*P.Rsuf`5hTElL`IضiifG枖xqo>j愧~i/?^ӂ4(}*R]I 5^=^i&uv}iVD~auLQE'΍VjDHw..b?lyo{#nvs}1Ko^S㿵V]WkkkR77Y#rNяς!ɖ3sVJTy^Ľ"Edȗ&E}3v#'b%!N2keLßH"Okj;H1bYS νFRGkaQDJ̹AqđXqWW7S3{KLM@#' `8ؤm %g6L(tza;ڜU`e9! E;1)auˈZh{J2zf&ӰN%uOBjGŢ2_xL\&@R@Xnmc$Mˉgαuȹ16J8I^>avL`"'Vvx{(5cv`Vx-WR;շy^1HdZut4tdj2 tWjq4щϰhǹf(]XV%58[`~t䆤*?[>]\v;5k5z_\{\ajs}	('?HmߗYhiGE%v<4#yJdK{6?O[<(,x-K#j*ڙ_I+ڤBwt:=|ش>5"b/Ŭ ak8tv|aXang+aywlt)?˞ bd5oerjE͜PMϐhD^j)N/,H9H+LfUH
e^ϰ*OT0u$*\A)=P<1: D'0@
IP2).,ұ3-n$CmZE<d"i\P3_rɻv兲ρ|.2 ۾+i{%M|Mj:NQ16Fcǡ'G4ݟ6%^"J5/`@>0:k)Ȑ8QjL%i-{o1a 4R.\ڪQ0 Bw|O¤74ssp 6XsF5T1g&*pI5kX"D)e$F۟.Hj?SP'.$JYrܒ?ܧodX#U#j}QV4aD't~ֱR:7h0±JkN	?d^_$R7]1K
4w▇
Ds<sAd^ֆ&K=QM)i;WI݌Va -dV8Ր?sPȻI]{"nU?$W䂂"`ؔL>q`N>o<L3w+w?>C:X*I+rQ,Z$@Bo*$j::!UM	~)@`UE9lQ%$_koiU{@4*:mStz7BS<ʭae=p*:ږ*FZK}Ue/Pc?_yݽ֬`c]+bLZ'̙y}/~4s..» ' v 