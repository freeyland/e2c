#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 '] rH(د_JLI@ޓ)UŢ*N&5Y`&H	dHR,c>cv^`vkK# y!)xxxxxxxۣF/{jvoCF՛v}Xm_.&Q q,HɎ#ڑN.?_VIYo?#Q]\GJ7۵{'o5]\à|A	`oxc//CטW[N.>OZAR^o"_m6j_; ^4q_JlߏFNWuo\Z_Ӛ5k;6]\1&l1;w	2`qB3"/Xa!;vƱ0/Xgn0ԋ((W"eG08<Ϯ$\%?x%5&C't\Y~v6>:f!NL]wͦ-7@?%$z -Aw.s5b׆.s?9P4* ݈̎r!׹{KnUUޤmvXǬnl7:z~5p0b7|]|FQCMS|(1>ۘ
_qe卵Zڀh/t~l>SQV	kŻcgJ#;FBjl0L/_":fnoø,R~t/r	ǡwQR^ݝ2:N5Z\wq=|@?GNtZ*y06+[;Gΰxl4`ʇf}i>:9>gf;wL&K,:&$O/PQ'/fұW*>MV3'贇9mwܶeVnr%:Q#	Zy:*6m&m:١3/ 	lSm*MErPTd{"TLiP1*:GG^<Emr$ȚYlRM*IE6*_#Vo˳-qoG2[T#D?	C[^Z*}-f򒒲hۮVe#ك.iUKLΪmՁ{V'!k<ck|7 g@G0p=@E_eto{z!;?B"Ug;	~ `z_}w_Z}lcSw-]H	H^r쒝-vc2{Iv&Xiu5aVIj<DO ً[m~s;yAS޾}`WK&BLs6_Ác#wXbx[:ft6JoAڢ.V^,'.k-/''<scG"GN-o<?m$#M.^]+f
2u4)s؅{ gIE sH=̀_vOBTA ɮ|^.em+\^o7;֯?׬8>T>מtWJʷv1s*`t|aŀ0t.28
z1$a\+v%1'ѷLP6[tZT e84Wmp;5jV(C pM8}hDQy,axZhc#`⮟.uQ:	sEg9Im?qQ $G	J*4XQ?]n`m*'f<rh1ڨR
zY
qYh$X|ΛޛW=/(G=-VRd[s7wd._)C7Ʊ\dPEd邦DJ
;]w"m79z_pg0@/%^z¢Xʌ~9qO6*Im0r$Wa\֒%=f
Y<RITW|HNbV1Go.~v&Bd΂ii)\!i3¥6N
+/^^rB
q"Ӵ70>懝74w×Y_;	{;/UȞ;"_*/\RP_68mg͙"?lw^yJ1n)^yH"21R:snbKIMfUhh:1fM3 `Ƨ2C6'_jb"!`R7`縚*j(:AF,@iǓY\ |No0]pg(r,?#t#TH	c8feS?qv9}srb>eܖu+KਇJIǋ}ݩ^h.կ
pN_h%Ƃ~$_(V8w*r[,Kڥ__w;Ge!**өɭIy)3޻=MQ4ΦǷ{/_^ll~3\d4!A!QKRY3{GpKá
2(忈?){=/0RI5F_h/ꍗ˒i"x#Fȉy+X{X9W>/(}@'`dV_޼Ej-
:m~D\U_ly}x?чGra!%34A/,:P'9|[(%,t$UPTӢ:x6xJ=FnNQaQ.XbknߴB.PQ#]rH.SƮ#x7DDQ\ 	r1kٲMzyT+߼Wl >Uю3)3F_|ʦiB"k,ubm)@WARj !AD x1g9?K4蔮-}'0=yßm7hp"VGD0lv&V)i+UƔmLs!\ -YKЃ!1%wRh{Q7냚iKԡ58O[v"$|#k4Rhd{IX4P	u13ʑj^eX/B/=ڵ%g!1ӴM37ˬ+N$UV|ؖKHOJQ)ƔW02)Gng8,̝0f#'.KM3c& uHK@HnK'J4݀XʌtbtKZ2n$U'O x*CR]I\H(yC2Z
y%X8L;ŏ+KiЪ*Fe':y6^0DʨTv~S5K'Ҋ2ФVps(19C5ݤ&1f%ݸ]E#MkVpSjvQFھ6-&;uىq=)c-IɞA/T0e7_[3&ǒ쒶}bZ<f:SFAݯכ\X
~!C~XP8e.귓]=T'K$,VJYa$p"]ZrarTf\jEF+a0lh1UȂ`ʺ>_,o\W1yUѺh1Fdw#6?C@qT)[t~t! bٖ:kSϙ[Y=W/MXd=wR {i5wɴ{a(VPVPR\&ҏd9em,()CQ(+,6bb얯t~Xzv%-ZY,*zSnHoN`5TJA):y -0/[#'>w^\]1yGtuuKT}RK"r-'G%p9f%^7+e7ogOm]E28 9%5{9ڏ|zX#\Qc~IWxtFh?/61aCGml7[4򹚣ٔn4`n6ywfImafc")01vd:OȶGpG#vT"G(-Jj4}Ke_͛2]_v{6egx\Dyɨ
ϼ?`ZFy@#?6CQƧڂf2Sˁ>/ y,? J<tЃ
!N7RD2F9ZrGyrO%i!,,$/	N̔utbRi;UmWrYQRjf]D*PA*fV<D[~+@'u^l=hfE}XnOXo``e2F9.dXyY&!dөk|	sEg!;
bW,R26iܚô'GnϪ9xiЂъ^1i:	L|	L:׏V9$Ůp!Q*31(LF	$VPg]Q_`٩4ĮOY{IYvFt릨s
&kBZq`a>`gDW$'Alk}UT)d-y2fQ14&z܌PaA<"~"eS4TrBr?TlP:q8 y \7IAiށrßMʌ&VLGbtt*'kA&.G''|a1`E"#I1y?MO$FE
)n33{xeL$/.Q&nt_9:[*{!ՠFy9nw:D^QniYo:^klnj%^L~q*e@)7lx@a$(@?+#yZڝQp-m>wD6jE^'O"%!;/@4|prc/GcI$dJ=%`t| 3UιI?LZqgb(G"dt630|	R`i|9CrQpzT[>Q6@-Hy'ϵ3y賄%ScNi/a`BV5'JO<Z0o	)%<h?_%; ~uF;R&$7iY'Yrb:&.5@($#K,%t$-.2%P-BBMK(AQ5(C(s%&,v$9 xk 7"V Z3Еzjp_Xe)3hZ$-ް!󋻧c`0-Kw|lP4?MMmo:&)h4{mCx!ȋpsJƯ*d$,z-Ҽ{,,sVϜbrƣ٢=ofTUx4g5ח?V)0.Z.i!A#edЇ	y7䪜;u0z3I%c\#LaNzҧAKQT'Ѓ)>LrIJTCyh#Boޣ`PA	8tS=:-T=6%[<&j6zO"qYF.2ϖ`|+Ϛi0I@Af|Hʑr7z?9bG0z!UprsUK`RI*
ir2)aA|JU$}MrgR)}c<ɽhO3~u<6NGqኸ6*KN#x,⯯Y9MbZ9x!|cLJ)HLeIUݼn^
pG3`!W_^b-ﰨØ@0 *I
Nzǧ7;[Dѐ)MVC*hX-a/XƖ2RAyt3
JrvG8	F01rD	9|$cr;JV[	I$zƁS:Ƀ\H1zLr?ff]6_=DI+~zk4/Eh]D)ȎB3oa6$N.^VkS2վ0es̩d <Gi5$Sݮc$6i&i::]J*`bT+XLi"0bl'O:BӃ#凟Z.3=(WrDl|m4!YvSjQM4
JwMߎmߖD2$UX:+:n:-oZ)o.oůϲYCV!k$_S5	|M_$5	|M_$535|͖Jd
Y )_"%=J-NotWO|f2&v=[KVNrJ]$IFR^#iC#)QT@=IR/JRKIx^+H*zՓxF;3iY2ĸ7tgIw\霼ɐe	AˣK'Z2KRLAǦI8q?dV^fU䜏Y5.␴9u&sj{XmW"-gF}z3b/>[`Y=u환L6TeƼ71'bm陼0ZWj{J^g,:견>4B%Q(S%92b4SQ@Cxcz[7exIq)oSpN\;r)Xe͖W0+vEe}6=|5R"+!L7&pI|a/Di>G]pqo}-CUL<Ța.%Q^iw&2ef.5+?,d/70`x*LNwkw{nxXr{s#=UV'NIW!jk7ڹ'[TJ}4+Li	J7K	Vteì݄$t-rЖ@ˑ\xMkN2ZFqOTiIȠ9 4MCSO]fE=aPUBUX(dp˛DF#y{s-9	*- $i<^8Ұ7!rH@}O0Tifsddhb\_]oUZ4x	H`ZsP61ઽ>BJWP f	2mGyyixw#QEҎ
0׊w>;bO~:+?[ܘ~v?Z̃j2ڶaM/gW}/jNr9wG  D<n^SLH6%87}+5TaXК-ܻ0,|/"wG!{<s1d<c⦛{-Pe2Z-VHar\"N&dG\G8nT\-WhCzzMtMjQk=h ^0z2:x-1;Weh,'Q5ͧaajC'Fd?\i-{K)Rc)lÉ^jnoR9()jon,p}@7@BN0Su8Bs.EhynuE<m!xS?3ZjEm66ŊM3{?}['SYP[tY(|-;sd9
s1Eҏ6b+Zh琗gVl&͒zq|͘gU&Y3 `))X	rF]xl{0?Zt~_9-2fZUW3dBl5)RM\f) *ܚbXF@r˭ n<jTI(Nc/qq-NLsڐ	O;CQkRUmښ9&Ӕt܅>`d9M*1ԩۀ5sUi,R\G77WyNYyh~qϩ ÙjLyTj;
G( asFcԴT-'Qo1(QR͹ ڏfGJ<YFWEM`/s_N rƔ[Q|}oT}$Xz]k?S$߉8(!wr{(WSbׯiThrZʔcNhZ6N49n[<ي0}\s /Ad 1龵p9!erT`Is:dl?#~.~'oÎq
9:1KEIf(B;Ņ,|UX,cK
%IƐc%I
N;p)Ϋ}3oL'̋G[῅6
|+i\]U\ jLD+;7Vc@#0tBr_?<~s(FzWcDyrv7sN$9bna՘:(4^P)Q#h̍Y]th˹-^VΪπeyAq,XXdԪxvkU|$zf'sZ~8fXS6q:~ԣ.zH"Uz=L[2gv0Ч;ok@?\48I,}c1Bq0hSI@hzGA	BמHP|<;a0PA}-\s.-TLpv[t`x
"O0t0	ҥ;0(,l((0u^ޥ`{,\01'Rlˋyn#-|هQXeyȁaXޤ\Dbk#]tXFbCObtiGy(eftKăNt(GX"^iUW6a1uav:i@xܵ3eIO<#3Bc^MQ^%*PXNhw'6tU NSjFiE٤PI?aeʭSko52?W*:UhPoRE"r.\L[ɵ#736۔G_F@']
|Bj/\Ep$;vQk a-ӑ8ϡd\reL]oXjHϭQwEfKT+Gg*(kLEV}Z&ld;NZ뤭E,6g2sʙd0aSYYa+K{k#MX%eJR9(L݄! VS%ۘt&GU
JdZuBr*8taKwby<ND.]Z㉥- ĄI̬>Z}WMnT*}<l3B"(QR$:[ޛo2R'su.0&$jSҔ45CDS5ã1;i2{ΓU\$	EV=[j˴ۄ8N1A*
i$+g_?Ue&qeJWLʯT+8fT52^9YۦoR_&^aJ:<2[՜nњ^5#Nnr06ܜ`цsS]*A)&_\-FCq=*+ogSOTr<]id9lv1Cf>"ba:طC(MH{ޅH:eʹO)΋C4e4SgMXxu[^lSß!9JýUb"-Cb;epkvN\GWBH	ef4sKҦ0;|I[3@5\W7Y"]' HnREiq|yDnxar6y5HTaD)#CLrvlji6ŉ:xfMiQ=Agrs)r&KzCv@9MRd|<gA](56=[3`wLqP[MˉQG=O=k۵-o
36:E&hnxZWR!4
"TR$c=O
ְMAÞ5L$ZU"2>Z3
BIE_-m*hsDv@b"4{F:n\Z
m!$sA
:q2HgI0\u'*PUJJNdfJM	cq	B`!#LEXH$Fnӥuez(,sJ>C-KtlHVz*ȏN1	h8LWa"%aH	B^$Pb UR0tIqv󗄩M`/y@JAVLbcWnxzSIg2ii[A;58[s$+K+!䓪Qū ^\8.I"ӯOSY{*D2%Ohrr98$RpKi^Rbi3uLË9{9T%e+eKX,V)[pT`RN2-L_9Rz2kaj.9D$hD,Hh?^ӝVbrW㶠he+@,\dyJ;<>Eo'78ryXdLU0S!쿕:t2OD:Eko\c#SUD,6?i)/PZ=d.+*90hjv䑗6-no~+TS5WYd7Btd_Lt̕մY*S߆ 8-rm%3`V]w̍"_4Dƣ"}an-ÔS'faI!Q1_|K{\OwiV-=FEL3̔eΑrrͦzh*=|yF=#מbüukn07,*qR&by})f1Ѳy=jQT_:CD ٖC|Bm,W̎
n'$Ir:hp0>UQ7V>?+Ѝ=z	pzJ.nM19	Ku81 u"smObM6
dPb޼򭵴"ieuc$shF3;ЩR*k8G؄Yeũ312;@iI:b9\;ŕc8p$C^|CFTd#:`|Qo<ĐLrR&[ꎦ{KY|i(Ӏ`8*VB 8`^S?*I"8i/Y`e	dd6q2)6C T/@]u2iNAZPja劚OB#51΋+7o0a/N21AC娚Hէ_sl\;x+q8}CY)KPqX*xX=wrr>xe9`8v6ZJ&4$ׂs<r fGӠ{V!M^npYc!i䍼@|^'C3Pg6WگpF[6BqL S_bN513:kB+fq"f!M` W	 5Y,+6AH9frY^T>6g)E%#Ē6/
04I)7vrB<T#a4B~;paB4A8tYdoᒒ~d>/yi6YI/N@%GF^QIȟRBB.ʲi%Ӎk+<?W_ڔ|%\zˤI,gj֪KN4Xfܐ,|ω܎<G}<x\x¢8Mu=8ND?'䄞r:O)BB^3}LwK,itX쯕ճ&}+<26Gt
Px(Du><ѧ?Y1/F=Ơ;4ڰe3bՁrcxRǉ(]t͑FE	*s`ϚpGHl,кmtzALyZU}RU
}qt-ΥL.XͅQ[rs@0Ous_ͼ煒FUVn<HW=d$x+(qD1.՞:`E{`jTO	GGC#*)W:r*4CFpsyCiϼR>5kĵ"ǀsVWe2VO!8nMԴ-ÒSt</c|}tCU]Sgg0aS>*%#oDMd0}&z`28gV)3c<s|]'bGh%&,ZRY(Z'"=Gs1]]È6ޚ[fqBڍ7Ûܡ X!khQxe!3YɣFП(w:xS7o*%s$80H|e=;wVfU4GW
')+ړ[0)<JES.4Ie>>7fEnC>X%t>9;+㏲8Q@65GﷸB7,rTea}ӷoP7We~<Gb)Uc2$I!Bbw$T|-R8<~^r$Zg&؟EТӤ.9mwjz6-u5xNo`=2d{'OQWxW`7-kdhB`$FNqr6-$Fاm/`#]T)sAp_#>6 %:@=!z1tNltPRI?"TThEgV34<<SaM"gy?(v&/%ձb+C!;_ĄssD-r7+t7!H icvETJz>:[D^DRǿ%b.wN3&d=X]ZJ>6]RK6yUUWqHÿ?cI0a<)U7VI"ȰFQR,5acg_
O"V[0͋ښ+@O6u3ai.!=SVvn4E^h]T4FbrTLЊK>&/yK1lH	7iZ@^N|eS=|XK3©ߌ3ёhnZ70V/L:Q'rs71z[c4nkk9NQw݀ɵѩX8kB.(5PuPr$%Ϋ〤Bhq䚷Vj51}Fs5oC!V_Y!ZRJ<n>N}c<hI 1Q`]xLNK'"`q]R\8YGZ~I(x:PSO-y.mXI/uBgSV	p.	!=sּUAcHDLt(y#BEexё)^ҝ`vL.#ˬK#|IZ2(8NAnl+OV
<wzPF*zGR2:=f(,f؅Eu7=Wf+xn2jJqk5xiYz$-g}WO//&Cw7b焽7'aRV+1s1AxT~MEa,<G"F-Gל_ѩ3	ri9TFTgPpa|VOBg0e$H**VSC4<3HΑ/p5"GyIj2E1³vj6jWFHz
j7N]{d#f	[1Vq䁤.57>#G82*O#褠S cҁmȇzyY`r8Cwb%k%>xIS!;m択ƚ%3dl>H,>v	Lwx:xf?OfwnO&(6oH=P8ysL39r_{HBq%yc x48<}Hʥ$'FSŀvE;WNzŧ#<0_-(hZzE'Gqj45K1c{υ3MǰѮdi[\|H+nBN	b9IsP%I9ЁF(	WLS9rCOءiLՏ\Oy'Y7:z|RK&-I1	d>9ø;fQ"j/WJz9I:Z~f~,ϭmyٵ7{xEaծ3vy΀'x10L6 $quH8lDsn<C`8ݔycdV*Mx!+E.Hg033U|g(&3|Ю,iÓP)1\u]7}ty|Ep1@ (*K+岈ǻ(mR01B0Y4jdoKΧEdp(0.(5Y06ڝ#lЌfr0 G
K'LhrWVn<wݝꖌU$9@-%Y7+uNuљY-{_qHrԮ	b\DlN(ÂaH~A2=iyܨڴ rL!0@c[\BL&\|vyBT9^lzdhlW=[!ެ$y_8_*BgEj/5XSKEk"7PQP69a'e;ot-}Sb/+jAz
c>P0@FFY.dT<Pqs6\I֗u2~J-OȨ*\7bpV^&<ScaSHO6v܅+%C;^y]!u<F̃LiADbM>ѧΛVcdvPM>Jڥ_b-(:܇o_`䰏<ɣ2> ̄wy!fyARE2kIp]Ê=XRLr_-7.CC0Q3QcQ
E4sgQ$:q 7b<knl~ÈCbAa{|rcGn|Wny{ͺzb /HHێބD}x].0kQA>!~zIwP& "@|"}aYpp7wݬ$/ I[lI,oRӑeļDusvvsf&E[;y'qC<dxusL^;Т~0vrN<[`vk(1D3UdE}s!{p6f>2E nJ	2'n֬]0%a
M$E+S'|,ى9._ZAEYӞ,,'oٖg9XR0Ǔ	SUу6=M։qNGqY93SƧe5[ȿ8YE^od?	gJQ*SϚ?6(^Z^r`Ġf䉭EGrt^P"" &Ve%c9#Sl\6tO_
_
mV-qܰuŵ _GV[mv:[kXn7vfzZk>(ki 8th $;>RhG;[co6[UjR"ei[f~??]NUH?wjZvkL=C!<FwB4d:<+*at+uIP}&[#:eXFcJ`2D,K%E#?Ru\CvWqfxpKNK/u1Xć.g}jж;#55A{jM>ܹ5j.VS#!&m;][H["W|
u N闉^H	I;Zb\N@ﺡ`Oa\PtDӪw^S	h̨/dX0v'Sb=oI,4	LPApNF ]:d-=EdJ<;ap1@D1`3z,g/.nMR\cm||]^,NCKG^0D--*H7n$L'
@Jcwߗg9A04fkP2r>׿ &Rh/9Qω{q,8-@~DxPӠAWvdoӔdnnTF|=؟S z!Agh#u4F?+r_@{M")^HG:"p82`vԌV#7~cZ*UyFy+8ǂ&Mz{N80/:6PZlo:Y
9_rhL}AzS`ҏ2-G{$\3Ǐ	]ǅ{Aw5IA)GM6{s'p:ebD'+tKw5Lon,~`O?7Z%v6Xi˥Ⱦy*DIr?p񥻉4E)	b0ת<?%=Qe@ҍ!?·;d߱sAt>E4y!
IVOD7gZ$lMV~U<)5t#ʁp[rACg+懝7a,Ǟ04"XߘZʨǨld8+M'4z}9Dn tnI9Ov7ڬE09WF܏Z/s2|#cВ)b֏V^'cz3~ި3;
-S	AJx*:<zW8:fVM_bzn\+țf$Slx	:g޿?f?"co/7i}+L{Tj?{?[$/mnE`?}^oOQSiϯ(,	2ЂO	{oӤM}ޏoݷ{WC&,Ww*MO5iiNѻ('v%vnۮeٴlmzO_m~?w_D{*5W?W_{~kk+ffk;Ӯ_LO)g2?}[$2~<r :y	 Ga	)z6+,QXᔺv_oy
]*L(Lao
`o6j\Z_`wr39~>Z㑢n)RS踟QӁ5+ك;@i3բ
:'l
ɋ{[~,P,cȍ*aQ1=}IHxH<䙙y癳gw.87Cݽ۽o^o,jG(6EBzԥDk؝H-ɂ9]~NnmI~lԏHٝzG<()-FeNH
ia\9XPyVɲ=⩤9n;Ca=k'uD7ڙUbFd=jjcDM+ pFJߧ%uk&zZW5'7غz=PBDIg\jW?d'^ЊSMv]ͅP6_7FC5MMOw|stţ_n0̲]_Uo7.i_v	k^݄\'dŊBloXMCJ(TrqĎ<q2瓙2!eʼ>ۤERڜZ Cݸq'W7oYXKg:xIsԟrm}#`[k=y3 pj-kׄ-V}!pUx6JRZJ=xN?]۬c㩏zۭv3A?]o\gֳ;rw^Zke)<;(tg{BW$Jsov.J=<aZ0[/Q?(RV
{]>/y`0AbE	#sGl,^GBagxCaֱ3lA4v|G'c~Bi;iG{?{x|?MChml\sj[fzx0#`wǐ<
8^j̪77S;9M_IL|^ZǅbW$8Ӌjtvh22zި"sϛvT012C">]n]~V[E	Lip]lvH
^oV&:f޷ޡբ:ǎ/`maYDqkiV@f54Z}Vo6W̿>nZVoTZӚVBi(#-Ӫzuxc:37nƑ)gj:z%4@3ޚZDӞNM걆HQ* MZmL/^)jr2p]r`:qOIk0ܑI=ކγcg?7X>M+΢3TZm*[V$ݠ ǥiF@1"lL	4~[ߝ]cca#'3,34!apn[GP?-w"ZrOD-HJNSA8	pLk&EoP08	{l!TF37ifu৔RT08K(:
BŭxZF ࣏^<;	@а:"B\](I(ZG>	#O5G
Y-dabXλf&d$j4iLG̚H: ()9R~V*_ޔ\,wC
G-b992;nR2Le!Ɗ@|,خ7_Yȝb3Ss2vV-RW3Cʇ/x͖KsV;mjZث5qm7pS5vb&ej7oZeU{5kZu
IVKVW5GҺK.RE>3Z"ӾĄ]owzn8>> 쨦ݪjZj_oڝ&[U\cV8S}nMfZWkqh۸Y5nX:F^oZͶ]ZuS[5hUâN`\S[H Va!{kkl:	
[_%j>ABlXH4!BnޗAk-ٴkըVFM[@6כ.oF݁&PKa@RCo([u^K:Rn*j-XH [k{đ skՂWFfwڿ5XZo[5`h&g Mt/Ю֠\:|l:$ۨkt(|YkaT :gu}M>5ZЏml<7h^.XV{Κ{ouU}kFBvOȋ4l[_oȧz	+kH^oz:(O<:z^]#u7~{6lU]FA׮ 5ڀ]zm#a}mEh4W7Y$3LQUGy8+j9(|1SA˺R43σ2(;W:bQ[}F|enWbPCpڕgn	N^󯳋藂b^zUyc|·qR?	~QӚ_plBAB$ZW+7č_Nß\'\TT̋c㋧L![~.Kgd[j,8gU.ӡk-^sh꘾߂mY]VqNT
y>Ůs(g?7V&/lEIwWjJ.08r=nb2sD%)ࢶ7]v]h{47ɩ~/)oWG>	fP}G]m57osU W9rj/GB[t]\,2dP-!)/3BLH;[RXzIVO>0Vޙ86I(O/{>H9FC3Xʢ|+wW'Ke.>>Tʪ!40@͘o(!q)A4G")7~6W$--U0=e}~c}>\KǁN.!ђ0nH3˳extN0w-0s$ihTV&`s>7^ꏲ4(AG?7߼~06>|xtU&FHM$]8FQ:."h6ﲐ{q0%K K0oJ]<*3eh2FݥQO^]jhoڒRR5Y~J
CU)W$ԿUK0eBGUMZK+}'VV*pN#Q}0#J"s
9prp.s`鴑E09u\NPe\+l/8^@F$FdG`ͼT?M~$N8Ȳ^
Jfa k+
1X )4u+25M'r{<dTzvo^y	Y*Kb=\QB[AS	QA&E!0*H@o-|W,"//o"97R3]ji_Μ7pb(m|߃]d	{*+lGq<]Cyre1`2^_=e=hIDdKHK@^#ޠLӶvk)s?}Ne]l^#zj:AU4%Q$q(cIf. HiVYrʡٛ,')\,F7ȧxipf~cei?3]1ʗ߼`L1R5pY{qduE5MTU"c`WVҲ?f%#']6'=r&P ˞geM(H&qyP\2u8d֠ϖoP'葷MBjLJPNqƤ/rI.Qxq	?30VF90{^+9ņK]SXKI?3	\߰W*W"$Z(L@JR'w|-+͚6=無s2@36h]+3.)SF5]?/1$Y-_&^HH96ͱz*Uk֩L-á>NyCYE/Ib,aAWv CO÷]i dzQ&9q-Nv2TA̢ZKv 42{l`3}sV<?ᐟ&zMS':Aa,;D7u9v8"Y;};a2*e)T+$sR}&TɣFJ1ʒnuhD՞VIj69Ydxf΀pH$s+HDǑA"¨tLỀ7ij._*+5
K%sj34jv7jƛW;o*s<UrCjms׮NufM1 	gavMdX'LBbQne"`fa^nb߬PUqT cxM
,s`h wQ|"*
VK\@	L hV	f:ﮦO5bKB H7'UPd!B)qMN|h%0 Hcuu+r%r5HJҰi[SY&ߌԉȝޑbω▘B+:[DC3g{Q*,i\^#eEWecVU{
h\ծM0SlAOMÛlA;a
1xhܕ ׾,~?:fWdNSXMy"$0݃<,/Iʮj^WϚ=1-*hyiV[bѼ4J&tVE[v?k	ѽkI:7TJI|qi/܉q֞24rS2~ZbMŹ|/3wXΰML]=gx8PS1#>N\?f9nhw2A0d7sxY}Ƶ]%R`F9pvmnWVtyF_YZT߾TޠiJy pɎ0wewv'n/DDJ$tysˤ!J93
Lt^43En#Ǯ-'\2	
"C=ClYw:EOEye{ō;cz34(ˀ:{l;4JӿMp,DڴEk]>3ܳaq,tF^d*+=W{x%;aC0}$s3#owڽw75޴s
%4y@E^
 }v/Dn׹"RCBmC
)_\JuT_a dQ(XF3YsVVˢs	2[LFRgN*/"DJՐesʀ,lIgFsT2	_34!I$Rjev	¸Rm]BkQ5:3lj\L.NYMHgVzU}'^|:9Bm,G!N0~ 8g=2E3tZ=ю>Q+cfN7t̚ٵY*ꮜk~u=ut^&C]sC6LtGy	HvzbArB6Q`QZiq茙O;nYbY*Ik@J94Gƈ=ԩ,[*i/@8^vW7vh @4rT=|_FZ]AaW<CsLةVAQ:8V'c=W(nSI*ʗ aMK)(;,3s7HFM6'naļ75JT[CF!3U#=?O8r<'b"q	EyN϶TM$AWl˽?e<C?0;P&Ty' hCC/~;xCNq"B3 VoC0 '&,&ژ-%.p2!(ۊ액dPF;܉+9xGpbV^|djܼk0@9T0U横 :9X}]Q|/WEPAk.էFQjlJAKepB9o0]A8)d0Y~ߛђ7v·C'c_k2D.葕K:*& .q_\ux]uGBP
ʹ&w)\.O_#WRkǣ10BPKR&])]N2+$=|2"bG^@Y U:[\ivI)/4X/.`Q)X&6]Z9鑹%\~;9	y-iwßAO״L*JMrT@gWFWjI]{D/cbV:mv-@{wqa^~Uo{/;[w`sϝ>*쥎L|T4 _kZ/7Y#Ʌe.}?N*.Bf<~6e00QPEAДc~:@aIyEx^!˘i	DH$SGZ	%CrƞDwpZ"YU%Oq_j)1!;8uُ>)h6NZ&}O%Ba !!(Q15I҇^PS}t/Il? A׉X_FrB[@PG`aKI$tr)P+E$e%lٹaz9uP-8` ou$!g$:xIH]3bIU4wM=c1S50+e«HF@[kJz8m"$߳kCgC$Sױ7#dk77d0D!tU&ZNoq*TrI)ފJ'-n^%3ŕa|a@gf>\C%){Gȇ]֨J 1<A}4gn^xd<OZ(yxDX^ JLJo!am(mT<|mίWoi7BZozww`HmmpH˒%Z+R?e8,m;z?ť2q{xP-GERI1o:X!`u,}A!Y8#V?,X?	I v.N?tYN{ qmu!+`oz>|(;Ku%-v߆ap}79O67z@^͍|>Y RSsZhq8&x,I_	^kD1"Ú4o2;OWl15n_0|zwΧkmbo%dmC0Pj.nCT!G.i׌dItѕeK*iEHeَt:&Rq_A+!D2R粰&jjbGi4B'--oBM㴓M*bon sv5#\-_p] LY`qG ]FԾǪTf]g}93"QBm%]Fk/:ґd#ȫF,c?C5T?h1"\mK2<YSrur{/vX3`41~%/ `s3'+TLz</ŮO̘J$'yoU^Gx }"d\ka&2WJN.z[#O5Q_kPDiC'䓇4?}EzX)z('"rRy$֊خД@ҝP#R5~p,Z..{zVV8صĹk#BBɅ:/ӻGЗx	*	9"$U]kOg~/ΓRn۳8߾A|YBэ]?hoNpΜdyX?N+8j|8:3={5M_ss_|Caoτ, f 