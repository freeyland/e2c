#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 %] vH(iZmwRRIrv֒{׶Y	Ih  %,uy9u50|MDDf@$%Z,⒗Ȉʨѯ×jZӡZvnwڵ6k?Ir8'psArD;Uᗤi[fn6.._fZYo5~_vEqq;_P[?xֺwr_G*Fz_k_r %y_k^4vN܏_JlGvW|X=}ɥ}^NZ~!;a|o%b1A,YVu~5pBxN%3'XzNܡ:Qz̍B:$G,:sCJ\/qر3/OA!G#%ϷxKq{O/v09%ۭW1:Lez(OѪ0` ( 28sg$B{ `é@39x(	xٙFV!ׅs,UJV7x/~+?.i^ntkؓaE[`vYKOKK$Ň%
rtYisV7@8}O>c6^0]AĄ5݉=sa%Bj\;A䞸}_@u#2|VFHѹ$9GI{kwwJ Q8kZZfv?zvli=_g ?=M4dg>V:5O!a?p8E09ݎa'0Y7`?G'|`x
r>/KKO0<7<td]-++*R9aCZNet*kCEAVbGbO $,ME6AmSlP1*A4iw`Mjl kdM*IE6&ٜ2|@X.Mv(̉z>j}I$bI /bP.-wȀ>`	+-+)vK@Z{eVTżT1?HV*yuWpP8,͸)Ha*Օ|-u<APW[^N>w΂{ +^lA3F!#]KW.!":b3f+mҪYl+ͶƬTjc%1O,"f{{{v߼;vj55Wo~<<|Q!ۭ{WZ.\/nøSU5"$ɩLj6&;}[LͻCqY,=#x[ڰ낼X*(:SBSKwb
d!pZrUȎϟ]3?k'|5簂"-.__f}8'yKө y{|.A⁼?\c*]cZ^%su5Kߖ
WVu/5k<i/ϵ'Q啲qN4	<&Ɯ\(_rz=;ā9|gIDw<cח)Uv"]K@}@}+D>ew1ihQcT	ԓ^LMaolGgy5զ.)QO[:H=g4Ĕ`"4 C\.3˭ýݭ7kkjM,}d \jfE+c+x|,Z`U̪A- VUט*P%H^Nŝ7^^oڽ}A99'hDJ%ߚ'Mv2eRi>th=W
X$HL4`I'+8N0k>,N<lp2F	2WJ2Lq8ֺA\t, "qeQtlueY̾am5V.ǬJ </%~EΧ@lқK_
i\ՂљSfL`5"8m qaWEKW[?FHu0d=}ק"^Ƿ9˴̯wm
wnSUG9Eyk
UyFNQߜ,RռS^˶~՟
qBHѕ\?tc#Wmu.#5/J1'|&XԄ[.n<%(x}i7G. 6>9 MZPkk	9oY6`"#4`p{7 >~pcwK/Y0<Lw3DDб3dN:J)}
sRl>aܖu+ɕง5	6׻SD\"ԫ_A>g<W9es}KlQ
\T8w*r[4Kڥ__w:%!**֤ϙ?exS:87;V/;[[oW"q0gDs,%tcޱ? /}GE#k҆9p²"e/7b;o )dY#wX؉J_x,&w2iw]2>Wt: Ff]/^f/zo^VQV׻هG]_}xt
䖬xRZ2J3$=\¢3~1YbɋB9,Ɛ-g'	F:7	ǅ*:I>)Rufl`Rsh`w
td;Ce ):Crm{hg6rπq?=qPɼɈ6ڐl%J>\P̈xIѰ![+$̮"Ѥ.Lาjo~7
P9Uю3#;߳xP2Ka;pHxi5?a
( UԂ@H5)=!Ѻ	^2q3b,6-:@R>ztBG?/wsO<>3H&![{MR-Jjv>KЧ9KJ:,UN[IYHn*KJNTі=o5ӶCkq_+E@?vFhUeD$ۋŒJ($=,@D9P@Pbh-ǂw
j.)=^b_8Y$x.2̮8"<VYa[ I4	y`S^307w}8?/}6eL-9Wr
#-!9,1@!+)	s}JtZci⻫S҉a]ҒqC,:y+W`H
F?jH0eeրR+Uݙ(~]]gNVP60d(;ֹ+1Xv&VFL[kf1^:QVt&9>T䀛l@6510.iZ/Ts͔4=in>٩NO)9`w%{4P_.ozoOܮIfZbiQV~C1euЩ2r~ſޮܺ4S8eScN݇`ٗ;o:ߍ,zb?:NƩKX8㕲PHD*&[`+fՊ7`hP`J>	K'v[bx-b/ȕ
=2uRY+!''m߱(<et;pa^TYIM)S >C@̅vܝ7Ҟ1Dz_n<ﺟX(h0ﺓiAR]%,IsH?n䔭AII`6DIHbCVnZLO<qF؆xB!oWܢl7Hpp:o, 8P3WNĪ<sRX3>y5Û }GD? $"ײ3TjZrUO~㨹Y|ʩX.ʳx+cM#i^QWjQoU+Vj}I|r1jn4>.U28Ԑ&4lKȮpͶ|hm&O,iߺI6F!r-o#cyB=me9;iXOf%-9BQcֺ|i]WT|*
&N֠Yh|v{zwwp-2HJ~wC=0
 fpH> *?,5:4qE=E%Q!CBNNC|(	|mql${.1bqSEAT7}o^( 'wV2bA(BRYLvIMw/0'+\eߦل%3.L,6ny\Ǯb.n[E : yswBپE}7Xn,4XrX2Q)F
Yvz+]YHȑg"$喝e);s0Qj^0cL2E&f&DE@6	#GΨUu&G+c^QԲ_g#4R8FVjTMQO[@Zoa>`DW<',l=])9UT6=)(e=nEs0e},eH?2Νķ4U|NrZ*ķ	4:Lqo*
{~lV-~fc'>P)3[1݆TI3hX͒lQF$t7}H"i-VgחE;FbHO$BE
)nSީS{x$/K/Q&nG_:[*}!ՠFn`Vk~EP/(kY[gI┩T/vdH8(3L %^}'f$OKSkn#rguF@@\<RPHRfeVX]p36:	-	RWY<WNgɇ<raҊ86G9bI&j/T=τs_OKc~s$ڢʷixmKG{$n|l;̿i??A%-sMs~	3 9VzBYKL)q
(q\#oSڑ0'Q.G,/HN<p5h!˔xM0p B!(_b.$Ip))ijA"jX]B	bUDDB$D	5aS%@'ϝƣ_3 h֚܂(Kя&W~tOφߞ=´,qK>#L-76y>J@gҜMh%ܚm['@IeTGnد|g9}Ho~RqFrâ"r9?=m(Y4~.zi*MU*OyoKE3Å[ǊW UrFB4RF`<w,AmͰ38T:&)p-'o<!w΀ibPҤfdpu$?EJTCyt#Do`Pv8t=:-T=7<,j6zω"qYJ.2O`|+O?ةOqs<HʑNr7z?>h0ڑ*8%0	uT<4BBа >mo &g\)}c4ݤhO=tu<6NHqኸ6*KN#x,m[9MbZ9x"|cLJILeIUݼf^
pG3`!Wg}@^b-ﰨOØ@*I
pOz<CA[)![VC*hX-a9.XƖ2Ayd3
JrvG81F01yrD9~$c1r;JVY	I(zðǾS:ɏ\H1fLr?ff]4_Pɥ7b?Jo'	i7/1Ӽu ;.(f(S9lH4_R9צd}a<;S{	@S@yBjz!\$F(tZàTX+uޥ5?S?Lfb$z4EXڈ _$lܤJJSjXMtCgU6x-hKڒd-p+%Jaҡ'x#o%o!o\,k:dYA\5^$5	|M_$5	|M_3_*YCV!k_$Z逘J&;$I0ۍn=[:]+kw$9 4qyF^8I=/I-NR3'Yy.'ɚ~WCYZolGeɀCpKl Ҟq-t&ER%f-v4G/MqIUK,QY`,􀛮D;l5Z!>F=[?9PLq4|%ڮjV>qr8_b6:!e4c41m$zDzorO<aynPfAwNxﲬ>4CeQ(S%2b%SQ@SxczՉexIq%oDII.-LWaLLR.]^YMu+I$PɈ^GfgGQW`Gox2C.vP0<ҶFX$0j<NEf9̕ݍƂaxeFL!P1)n}rA+Ē̛[vɖJ/QgwJʎ-W[\oD=RR죝a|IDRIWzaJ\+}6$,NԽ'40*^TUnZtW77R{JsHB:̐EZM=i$oCz*|#H)	*!2CD!c^ކ$Rɫ̛EFyOTia9VHC&đD3yW9oD*9{JsFA!='VNj*fSOfwfҼGN@7ċǨV{
+\yqછ1% xV$l	^Y!7`nN}}[wĞ|1+W?ߘ~~qysןO_A5_m[04r(Ug~Q*4:@=Q<}[forD9(%b7Nq"MX1pJ-2U,f/Kщ?As؛EN1 @3i%^Kt̆%)XdK&)8lWiyœ>ɮ}|&_,.+eڐ..ܰ۽ɾ	o]X]W5ZAC7 1qdϦ7!h*Cc9)_439OpSw/\ryIYOzq4G0݁Ce2H/,eAaI?74]FL۽w{;m:!l&ÔO ETiN u%#\RIe,3;7ˌMEWSI&kJ)<s4_x$d4XSW#Dj<"VáP1Ej۝Ere)3#}JF(ʁZ5R!f뵬'ʥ0ȄI>[Lhe]MmRb&M:;먁)}a4e]VN|
[)Ay}{P8jVwn9<4in;Sn6{gcvߝY#Z |]h]U붊SPƳz<p5Y>,jribf=Z[!wqhOfط_k))Ģ8Ѣs-E鼔Sbklq|F$./ɛA$e)qS(uf{)Μaޝް:M9cNǝd	<bNa!2_]~93Fb.ɖ4U(Mӹlg97(DԭG 0܏JQzH~	ME\u	KU|[H0{@K1i4FM;GEjFJX%JBBsX;dc;:7#8O9mVs|gI|i&SQG 'gfٹkǎX<W^ W;EnIUvP!>б7Eҹ_flfe&i04HPR?mF|L9J;A,ad8k..q<xU0q	_uY">XV๱MSNaf| @Ocuq8fކUW+zAxvQ[16ߠ=NO؂:&E'\mo 5k$+Z2qŷ1:q'?Sll7اV%$mn\HGV6d:!`#BKhԊoV9qRf7c|*ĺo_od>)~JąLn4w]ݷTH\hkj~ȨCIr\r@OMf̫x"Zr2&Oh00}Lqy*B{q=Sh!;`PTD+8erS)DBݼhld{^v:ؽ˅>\vss0A&ۭzcΉWrh"EsܑɉQ|W!/Ȏh1-f29wER{Pi3Or̍}0ʧV%7[/sֲK%?3 t~=ýWuN;.7rn={Lvkܓ&%zԅUw iz<ðJ^ݲ<K"Nh>	ܺ4
.
hX<^U\3g8gA^Fgxc;~s7[	w(E!d:*raw{1oE#t(T;ŠiW2d(Bpcp!@9w>9sm7eU&ػd>`OXRh$T=|W]Ni^9+HKnnQҙԑ ئIJ1ZrbpcI,dK2=kP\ч?8 ;y l'<jv7EU70Vf0:a=_fo$]3Z[dAD<#b EBzWf6ɬZA>@aάp45Ho\\n^69@%g)@Ưdj_-+L#0Рr,4Z'5~~l!0EL;Rkydab6%w<x̏|J+O氄݂P][BοJ?킡KD,值lqƬ.FCw
1uf`!#U0=9Vz]Ÿ?R?S@Q]crLG`E'ɡtC:iqy D@M:Q8(:J䫫lueY̾am+Ii>l'ZCӁ[}UYĤ3901~"M2P\
_,l!	gx`[|3ufy:oy,>Ǳ`0g50n)4rh.nG!%EeUl/'I^G
Oyo7Et!0MՎ7}pL2pu.DОwv`[Um62P uU&C\2hlxZeyʯ
nRW(]](8l_7VnqL6}d$C|.JgYۖoRt;Ĭa6/HsϔTfF*QG4`kD)"tTpsy.Srdg}~,ah].(ףgSp[ZM֘H?8dfcxpRD8,ݘ{ogT4!BXͽwr-2
f<PΚ$k15;vN\?BA~<Z,u3	"2ƶ#\W|I{I9J($TvBJ(SԲ]6P9$ښ;|5;bC10eaRЗ?8L9[<Dz
$ P1!B|r_O|aG4oyY'SooDZM虤\tV\!.<ݗ	4P}fN P]TkiJYg*z0Rۡ3	CzFͭ7{֮Ԟgj[ZgHV:fx5A@sKv1@Dl_QVDRbSY;Ma[:P3k-=kVR=/ɃjT
 JJe(Ni'}XOUxP3Ш'oq:RPp8e!	
P01jG=C}HlLGg;>lWz V|V=5+Wн0>~bҮAZ84(nzZ3a!19!Nq!H~L*'?l{#Cȏ<1	 o8aMWn%ENY"T&B1@w9uU@bsO+^69Y1)k@Hfm>{q<O$ N-L$ajv'jTʉa0*G	WPq,
}J;qK2Oxrz58"Jp+i^%J|i3u
K){EbKMYW,9]p]mR(2sΩTRz)Rknj*p{eP`}hbS'&Un5x鮫J)5fCYҎi9ܮ10R^䔝u\w;3d=bybT7RNfU(.M_5f_8"9%Q%AbiPi󳘖Uwx\V#1U<ռHV3bp_ʖR?{R~˷TSfҫr4w{!'4se5<gʳTAy5y1ZX]ffu̸xyCd<;HLAvb5̗Y$hdraZgw ޴pq!,9RsZt9_Mݾ!o?ܪuas|]lֻIs|2o2,snK	4[PCRgo1Ŋ\ PMoc	96DS&ĤEUv,TTp;!툤%IF[IYf'Cx\LU+̌=tkB7B߶+D=[rSWI=7W<Ǚxi. G%͋AK qR[։;І31O[Fp8*!Uf3+U_r)##TS?,&S\نzO27_4"	5?GqJ6\y~!EKl;8bPp2rT66": y5׽)QIm~UDq(_FIldR\QY?-l@^`_BI9⛍-\Ӭ!U+AZPFLec'[5Û](hw'zY6KۘRXMj$zS96E=<CXKeme,Ô%8ZR[xE@ʣ*xT=wJ|>x%9`8v6ZJ&4$7s<+Xd*ȺQԚzo!ku߼	RR׶e0'G9(a(Zݕϟ:pl%zїC%Sr9={FťAYx;Y s`JXv-ЖY~A"褊Mi#.BAq[,s*3m>6,3g=@}N-S*MNI9%^`h2RNdTowG|(ivhPugoAH2Gڋ&ŐiY|7rN\o({%Jr,Y8ݺVRω.ZxMx_8)l^,V&MbZ.I[\,c;rFG?6+0<;\H{	,r69>S<6szʁ#<g	Kz%OU:]2`I۫bj8Q5[^7n|| +@ᡯ|f6O\rxg	Ǭj͔Ƌɍ}OaW
$ݔ%:8R( AfiCnMYZs͍nS/i5^~j+_qN;hont:-fr\j=&@uh}X`"#X>}	5[U[jW U`uT}gFL&x(q.מ:`Y{`zTOSCC)z8J*=փVgZN(` ζ;k[ /NTӦ\˫☙z=gu]f),j9̜"R[I}y>,>?_nOR7G>7PHQZ=<oQ.F䶌Fd5ݒscg톬}pƸRh5.fx&&DR/X7'bGh%&4Z,vӎi8bO~D1~N~gby5A&xkwOyÎ]OldߩM5I>nv4Ї%b{p50_qNN]4D&_;Dx(aogowOݬ Tl`0,	`$vYtQ8UjJJhAmx(=̄yjy[hF}o̊|{s8vlgi>nR~) OT\Y\FpUc+3'LroVJ"1Կjvgh߲R`r poX>11:`&>+!IAr k$s~%&<g%ǙIuQhit8-豘&ti3OpWoVĞwl-{ⒷYt*;ܓ?yĨdGX;/?&OoI+$m@#1rJȓәnbQ1>m|U!.(B:E~|>U
uC%A$./m%;y rOĂ^
s*u	~D$$߁1ɽfixz4y?ÚM9yN"Qx՚<g?,sdmXhcj.f*湱?u{Oolu7"H czET{><[g7^R?%b.wNS&d=h]RJ6F]\K6yU] :)%I3pmT[% I_DͲJJdL@xԄ9Yr~9-LXm4+jk7xiVun5:<^CzK@k]T4AbrTLЊ+>&y+1!lH	7IZ@^L2f:_U viJQ8aFEf
- n4J~cx|a2=ނ?kߏEѴٯ8wD߂v'7ngb9HsH@q@IB8
YǑi<ZmaZcZ0kj5)/B!V_Y!ZRJ<n&NG}8d<&iq32Q]xPNK'"ay]S\89YZvI:/x>P'<6Ǻn߳d˦m35tΝa5kUs9
iފPQ)bth$r& ]ٓо*mi+_օԸ60
%?ycnJ05g=QJa4pN1~w
)z"ai^]mO~
Rz˥\GDZگn=E<pxds[/
,dl0G?t4?Kj~%V{A&J(xzcPzTkދmnYtqVjQ>[-טA%jD%o|
sg4'ٷyJW`Pʜ%imʞAlr|;o~Z?ʳuUS.YxcVvNzgT?]qvpi _o@=/:`੸c.HJ0]ps3rk@K#y	d@'*fێlwypO/+ )վ)Y˩05{:&M+zkbHϑq:r hy0+Ϟ`3ƓSq_\x5-
Tgֹt@
G?O£`	W<6xzXqb^ N0\ <@L<';Qy)Qb`f	;wC3Z=u1PT^QQ.MMS9pLsL1s+a;p͊8iwXwvq+t[u(}ޚQ`Cu<'9ۧOG{lS$T7
#7jiڑbTbJCSclʩO0!<^#G14KU7A@*$A><Z'v_0yz>H+aQ=oZ:o3	jL;x2 ]^=^Ddz:1Q'4כhAjj/c<%q7a922CSj#e(JC^[y|5aJ'k3.3Z,tJ6)=GMgw\Lk* 
𲂕rYD睗6.Ljtjl'BA28KRNMCls,FN6hJ{S9BCJtzNF9%B*c89+UtwAincͻau[,F쒴濛c;O遴=NS8$9|j6pD1/Chǔa0T$ D2<nloU grf-.
&}	.~2^\o.,lC 7W8]Z+2o+ە$O݂뜸K<}9,*yZkX*Jj._ETk(-rC=a%nf)qa\*,OO++隁>w/?q\󓓋e+̏x`\O_ Y.dT,Pqs6\'IڛM2~J,Oy1y#'#jM81l`]^2ˑ^tܓeRG\mm,(IDfИ}꼍s5Fj7	4裤]h؝#Ғ\xQΛMF.<.>L`qbPXlջa+j.~(`C,(nU{!ԂbtnhUދ;j
?
sQ	5y8e,r[DC9wE`{ipd:|;v8Vwt3flՋUx,EBEv'$];7-e[dtg l*Qk	/_?Os?|sG:rܜT&KVL/K|:RܶhKT*pa'a7cfB[%hw27ĳOW5-c+7ĳNr?!K4\OVԧ={<acÂaP=0$+',{ē~ gvJp6Z;XvP4&;5unNoLynd'fs~i;=eMzʲG&Ke[`I$O"(NVEV6kiN-wREŉfϬU{qq!tARh*+yr
=lL=mجN@|%sjiN,)Oڃ+'m-2=Q 1޴L,?t8+ f㒡~PjPhj)d?_0֢/Zn3th_qzݩ۝vjvcxPW I6cN:HvrRPhG;ꑅ1c֚kswq2ۭv__]\BQ5viriNQk-S>,-=|ȶNإ?ag6?rCEճ4b?jE;}RTd#ryhbV̟8Z=FHO/:`QU8U\%7CG+F#xs@ڕav 	.ܐK rݭZ+dm/!'rZa٫,͐jmL$rM|s^+:pLg闉\NI	I;WZrN@uu)D1=UUＢјQ_K#uccƫhTLMǢ>/>|-tG6;sGMӶ)54Jn3Ƹ2 !~ttv˂IttaQ~kP7֫4jFs>9i_}߽]YXݴ,e%YD?,yPNDZ9n|l_Y){1gG(Dn
 C<5w3d~i +ۣc_4Yv?ŅKLBMMς)Lr<ʙ~x]b	D/`Bo;ҫH k{8>7YZTSVc'~cZ-[9 rcAzCc& xCO
()bwy1_qr/gL|AzS`ҏ҉K0-G{$cY3ϒ]ǹ{AwIA)G-l؅ϒxp8{z{u2O1CKw5TDmn}`O?7Z%6YYid|Mԕ,PI/gf')|KISܿUa )1y5pΩ(n7ҡ"`FЋS+Y>N7uN2kz"w_kObrآri]#dDJ2a?oZJ}cWXZs	aq|,)eԊ3MxM;%@|9	|
^	@m47r
+JN,YW_(|3>0uo4Aha7p~>Fe!dLa/vܴ:uOLp2&gL@8!#Ph9tHWcTPA׻Fb[NS;\+,ȵҒL
ٵ#KpH?KDLv|'i}|ӑyũzvǷ[f7o^v
_n}SNpy.OQO/)F[1RМO1of$M}vWo_T\m4{p4=Ѥev3vw޼N>E=~ǷݵJCɻ}^$%tەZR0kMSWOD1J{l~ǯ=**itI#JiY'zڽNIT!'oK[,g#HɅLxR;ݕ=MK0TYen
zj3yݥhW0<PayakO~T +)hpZQYk wrMs39~>Z'㑢mZ45	5~QXB=}&d_;1qlB1yo6s:?rcFXPgv(18}(\dyzMN֬سJ;B}lno{?tkh`7Zf|} ʟP~du6ڴpu'RK`Ngd[ߤxTGe{vpcg>ʠx4e>Dx}IrZroZָmS<Ho.iUݲDlxZR@r'조$S5U',o#N[Ѫ忻.XbֈL3GMmlHInۘڨ__XdnrMCכ|YzSk{׌߸DзPA׆d? pl]]70TMvSsйTBšwv66M}|F_n1L]v}*TF\#R%!+Vb7jV@DNJ7Zc8L)ݐ9Reޜ+Z-6v݀?VqNS:o.iXK\g$8c=OB\DR<
?Zɛ9jcUk6]k&k$nXU@iDq>S*ɧ{n3_:O0:O}ݸ?u'׳;oz˰ן/=nJϗcz6r"[nk$>En4t'1U%#rnu.P*D	\tAӢ'C+tlA'.VJ `;ܟ+RYCɸJ;#7
.OO]l;.ec:
;
N;d#ñwfӠ?MV?#J)H}=6Ó$iFms9HS%P{7
[ƃ ]89<5E(WeV]@ݾn?9YdGOgz:9M&`Z"^TǟF'4vWfcYjF6&^aH+`oj+4w?<)+4W A5jÄl6:WzĶ5*3QmtZR!Yscu:^}b'͵9OIz%V6cJ;)Et`p$EtZuhoLgmJfI9R!__^jPBD>"v155k'"EkP4iQ\@^;^Wha 
R9;.fa!̹#zZ)ކγc{87Y>{VgMBpVV֋ʷ$dL|<(].,*tk9Kyl,ld [|E`Ǚ&x| -F_i. ã<bրQK}4=T /+@*EĹ-sw.DhfF#ڴ|A E GizFֱ(n@40t	gL _ƟX݀I!F_ptv)&Tcc*$1?=*|d-!az;MWj sl?#8EҘ5q31AQ4R2*gUYzr9)6Dfo8J,pNJ
JkJ0i+P|<c%!wTT)KY%H]]ry(.5^5[XYլ5[ۭNe. +uFhX3]O25ċaĪ7zuIVK* tu54\(}z3Z/D}	%J!JsmGQ`G5+ZkXoUZ5ZkJ+k3@VuZViMfZ:Ѯzf+vԁ,l5lW5Q֭fZհ*2x*-$ը !{l;	
X#j>AB*hW6ֆEF_nfRk5Fakcs Fɠk4W:dj)^j(efcrzN訃[Zu½xH fACkMK`QtۿJձJkoՀӮ4>ˇvh>6{>vBc6 IFvF~6Ss2Zo8 V[Cokfh4/Qi<yqSAcT53|zW6Z-hD^Ͽ6Hf_@%vhYk|®i#Evޠkk zրD
}@k	+1~ќ)h+NijApVWr|cqcϦ$
(5Luh(fe>Eaz$*C>( Z#Š4V~^%8Os
zſN/f_r_ޫ~5,>+V17ʩ?9vZ.ǗOB-_RSvɶVXpiϪ\C!_[[hІKQߪZ?{;>?ó%XaIˬ!J Tjg0NAa@?r|R=#ѭRdn$塻l\c+_uQ{8u6979*ȧ$,9C[M[qNjx3<CNEhVh󮿫+Eo[e9"eJR]/H#Oe/8qogcƊqsY=GE)=c!ÞPp8c_Y/Źqwu/Go'߯pRVߕ!_4wco4ǝ$xgk{8dvjV\_ P\xm0p,:iGˮL!,ϖM987"d=YNuXa!e1ЌT8}f')i8
Q:(#~oy&al~tNH2N; 
pd)]D>m6Fߥ!w K3'K0z^i2N8r]'7.7TR5Y2,V3RIUK0eBǜUf[˫};Rp#Qqvc0#J"s
9prp.ÏD광09u\NPeTt/(^@/CP{y-}0t*Ip.f¨V`tShf(%jN1vxȨ7t4޼2d).+TbWWe깘pLA:M=TVFWn!{JkT#)Cv z f(Ĉ>륄 -@/ycCgj պKjgw}9}n&Nwc' udk社'wK&Jߕʳ)ßyTG]""^BZ ;%d[Kv/{dR#ѻ-E-JNHZcbƒ̌^0Ҁ13
D<Y3R3NInOS!-jwE_	 GÞӌhh'|P/%)za^3Fpǹ1xuE5͹Tu,`WW?fe%#']6m+ b˘@]#x{ƞɎZ&<Vd7) ƁsNSk좬BIsU	^Y>[yIo~XɎx@OȥvA%gL*S?Z31HcҌSQVHTWlllǒ^JMPUV2	'@bGLd:=9lYIdAz=;K\O虚pLI0BA"1I&j	m=Y2q:j1B]NxϜ>Fej1x7o#}Zb+tX00<9(@V?<MD9dC=G,q71A` ЀA/RbϓOuRB}0')
녑=g7@	|fg"!F㕩uBBr/c]R"GcjG$##;$L\
_K)D!G
aƩ7@	UQ6:nŢnV5hZj5f֩¶dFyh{M<D$hq$2,|qKtbx<;wqڅK7/Ex
ܒ~IT	޺o7k2Ǜ{3<U	rCjms7NufM1H	azMdX'LBbRN_T5d۫67=>]Д|OvۻK3BS(
T ̪`Iutsx04*{|%*Cy%PC	L
ViBpIR(?"XMMR -<t{
$و-dx~Hl)E<6EX]pTN}#%7bL(X6l%f֝D'y#%hc24d)s) <@*Q|"TG
kcTð4{s,xO9jO5.?׮KeM2SlA"OM#7lAĉ@\axhܵ 6?:f67OSNdy'z0-=h$MָJJ$2jXWϛ=|RG3s<YhVj	U%VD5gB?%}t.gځR_OrZkmb%&7&GTG3l*#tg}}rmBg'`s.H̠āHvxAh3vF	plƳ[xgPDS/K7fwyHiiڵ0_YM8ؗkSR'anbT}wX~dXZ0/͙N*;ʛ^>Df}=I)pWg:.hf
$<w!%t[s%w!e.,
Dja^#f՗q`?:3%5м~ҠSKml*L3-9N6±@UjZKm/ 3φ17ŌZw94Ҧ\^C`ԋG&|,Δ俹ޙ_2;wby5hU×PkdUt5x)TCvwھ}Y
NPjRY~F-^58T/ͤ3ll  2zLɚBZۨ͜.N`|2:sugPyR,3S<vgK?3*p=Nܞ,M"4$!RK&咠h4^
p!4gc'W#brɔ.`5!f@Z2eO<hc ;CҪs=>{hiJd_Q`~=aHlFy]2ynD
PדlҧZeb%E5wiH=dt
Y@whs *[+ńHkӚuZ)Mawfo"?SZ8z%٢,!8cEFącj4*vK`ԡmٰT-ܹ}	 PB4(ԻVFG￭7>VW9n~ObI}?/	;Q&r@'*v*lo-qEđetCyˠ60\˷Ҕ͜cVNV_)c, 1Yp5ncI,	n
R`'?9x}	0Q犡Dw$AWSx?b=%8q13PfD% pC@/]3xǎ~C~mpvB"V_\FjbAVYHM3[MP#|zd CP:ʯ(Y^⑟C5q u;L/A qҋqgd~pmg S]F餂Rz^D벺 g{*R.)	U*P~b;J]z^'fi"h -Y/|kJ22&+Y	iaoW1a P^`p
دCF
+>Br!
ܕ|s58:&^t%"^^]+!s^B6Ht++hjLE?wj_n~vˬH/,2ʬ䕫R(	$5R3X@JLyjt9vШJt|5mHO=-P/ly=NL^v
6Oi\Qb? j<KRz&RM9EӭTIK1-G87z_ ݽ0/|w݃;vصe/u"*zM֩55t^uNoN7G^#>-gfQc.$EtC
cC#E}3v#'b%!N2keLßH"OWwB`Ĳ챫<AyQI]G}(1'd/wĉ[b]^L/Vs3S7LE$Z{p_鸡CQksVi>:I8CvmGLձ'#j#YL:=1i]lp	2mxIa"uCn^9F!BHs($~1hTjfA>.kC0 k4d*	ة7:E"$g5C(էC$S;-է0vNbF'
=â6E8vcYi2ئ@7oE׺ɒ~:flëwq_=/4l}aIpޱri5j%CGmÐ*		iU&,1ZHJ_ߝW~|>laN kw)NyWK7LyLٷ}k=ɳCDb^ [	tʸwwwnuV$N]]ߛ͟ bd=oXnĻ92K-DI唎Đ[,U9 (*Yrfe>Ū<S?",seR}!  IN($#fS\iur͇Nh!<Zbb4. 菩,jp!hqs:-p9N
\Lcgh+Uh?	T~RIZ<5˱EDG58I_)q
DCiCE\~E	y]c-tSU}Y~ٶ|$|'Q3-@ɸBVUs˸
#+ÛEVM	3 qx-78 *ɪ30Ql.Z1,)>1QIKY
"JXϸ^ջ>Y٦y:s81	w:z@e
H;(y3yZ}zV)Q=чNEkEFZIԺ+?A幣 +RZpewLwɼ#9O=R=5SK
 pJFc8@ݖd_ֆ&UKy{zVqʨM)w~F
9ƨ;@a[37]K|">wmCSlU
15(P}|x<̙fYb]{t24UjVܓq)/Q,Z%$@B?VH:ۊbu Д 
o,/U<˰\cxK?_	ӶLg2\&O\XDx~J/eJg9*_2(?ۻۭ7	<Zkj/Y/։sfz^f,| zn}[UXU x 