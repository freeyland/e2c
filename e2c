#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8Pd=y)XUiݚzFd V& IDsalk__@@fUMTK\<<<<<<<qsP{NoKf5ZnvVo4Z`](vB 8tn>d%v$礁9tڝVi..a0Z]o7_NE~~w(8QX?־wrꍆG.fv_k_| ywZ_K^4qKߏN|X=}ɥ_EYwy?`ʆsǏ ,t!Q0:#`A.=d}N8#vczaXjXcz{,^|wƮ,6>f!NFL]oݦmC@78%$z -A8p k N]~tƓh&T	gA0Z}Csa/{5JVk4xn_q0bFZ64=vxǏË7w8T3*޹iK6rXes^76 A1T~naBEȎG?7co{/ȼNbY/؃0܋\IAqWtw箌:JslZN]wq=|@?GNt`֯lBd9>+&jӀY.[woZ &80۹Cݎ`0Y7di01|`t
r?z1k,{KKCw@2	}/:td[tfUvRͦvGN{ukCFCEAv(F@";TdPY&ӤbTLiB1vёQܢƶA֢"[TdlQy!	5ۥ,`ܸ?	@#V'D"6!pjҫ,N·}-fʲhۮVeV؃
ATa&gͶ=ш55pyY˛q]3LKZ 늣y8>"2=D!sﳝ? V0ү>Iϻ/Kf?@6fM)pG򻖮ZA$$s/9rcvNBwVu~C=ͤUsM4:R	$vF5<Dꮏ ٳoyu?}A[_|z-1f?llohC޾2D6NxI#&|3:ސYS1(I~H$fcԼ$Re3kȋ6OgD-׃Vˉ5oI	O"&ѫ±*>y0g~d+7>|5Fr*U3
>	^l=DaeT s挼!}z΀_ A`|^|ȱl-չzեlqGo*U+;unJITЮ~kJ8C7>cN.D/9tEU}]we>S8;kח)Uv"]I@}@}Dѻew	YhQcT	^\MQħE5զ.)QOkA7s7!9!l6xaEh>a[$gܝ[;[{?n7WX9&eA|!&͊V4&nO4l۫3X;UZA5kD'^cB \G 	8z9)~jU_QeO9AC8T*Y܍0o/^T*@X2"aDtuVeK
>]w"m/9zWŧ0`q_`HE	O7Jf ũm 0֕O`HSeDqH2,{ø%]]e5+A\gj	 w"Y8ч~~Y&E0HU-H_	1eiƹ^!rfl@VyI_t}HT:E7ߤW?YMAv2+K'g6aow
s^TPγY
ޫg򌂢49Yym}?F '`%G\!Fj^bNKԩ	2]"
-xPK<LP$n~_y8 tRadP7kB5C_S$9f1܂qt|X7Ҁ9O4!?-=`1PYFƨ[@'p̈Jf6<Rbևj|ʸ-V+Q_-%oh</l1wz0DW*09}y&,|٢GyqT&F7Y:HgK9 wt*BUTBɭie93Ӌ=M4ɦxO![տ<:~kGgx;C$C&f(\$(gy]*Y#9C_eQ.?){=/0RI5Ʈ_LhdM%DG&εQWbvX%W>C(}@'S`d@޼bm:7;v`el%=yjg{5OCJKfXifs+^Xt&o1<O,s"PK1dKYINEulqJ=E`OTa]Y-XbknߴB.H,@
*\l;> ]3 F܏=+T2o26$;[);F93:a"iA~4l
I9e5)\z˫V`_ǯ^~_WE;;Kf?UL%$ӄ2E֔Y"ۡĒKCS@QT BLOM7crixR	{)]$5m^[	Od.{w?loE
P5`2,kL$'Llj1WZY>nZʦց|fqJ{W,"w#@0b` `/)eE8RE[މb޳wYLۢ%	/	~%ĕ_[YIl/%pI4%M`QHzXXW13s69Q[ۏ?"(W]l?7z5r*[Њ}tQk\:8@0TLZeŇm$4iLys,(2O}4OwFI
c	rٔ18_)lP䆰 qbt".1C@MkH'IoIK6 ^ʐsD07I^c`@)P/B^	///~/S@׽Fq4hUiCR5yazo"meTunhfV*hiEG_HhZ@+CA؜nR3nܮ5+)
H5;(I#LmCċ\dϠgse[/M3cIvIیSK¾s1-J<f:SFA/כ\X
~&w~XP8Xy.w]=TK$,VJYa$p"]^ra4JTa\jEF+a0lhQ|dof0]ׅ;-{Wy纙x1ЍIdq;p ʱ6?#@ITa^cERS9}|Osalt絬-Ѭ+},kg)=4ddZ=Tik	(+XR\&d9em2")ƣ"6	,6bbVt~giNXv%-Z]$ﯪz{HoN`5TJA):ϳ -0/[#'>}w]]1yGtuuKT}RN"r-'GUp%e%7~o5W".oJ5۞ȰۺbHE앨f?-ayJU;NN.&]T&3{J&䛆m?;mljfYz-Ҁy⹚%[oEQyK(|actmh[Y͏F*iIKsx(ݱj]Ӵ.KG*~S7o,4>;{o=x?;Uѹsi$*K??BxAdPEso4"`Y GLjV{OQI/^DKPJ|B>6vh>hҽCV_9 *xWϟWE?*ғ;+}LVLf Ed!yHpeD2f.H۩ole`fΊrRm7e"V!cWR1-2 y}wB~+ ܤ/Xho`ʱ`e2F90dX9&/(d٩}+ܯtUg!;bW,R2iܦfô3GnϪ9xiЎъ^0i:	L|ӣ)L:׏mt$Ů"Q01(L	$VPg^Q_`4ĮOYIYvFt릨s
-tc8s3+y~ftA{w*NM}e	YKqF2b9qr>n2ςtHgTYnDx*9'Ek-ڀu6{| m
(O8W:<r !
foAO
el&jse{+&ۈ#I1w+	Y: ʈQF@o	Qd0vx/%=2xhیw4^/˲vIQWNG8ʞkf5(Q^ݲN+5?"f[kY[ZdI)S_jq
4Pf|[IJ2POHvt"7rK~<뀅/ZQ5?C#ɀ"SHIy@@!;P#M;K?[Ebuq^1L4η'.I^e\9%d6L94I+L,H$fyP<O=Aj,-/H.j^ϑj>*fH3-})v1{"}dj)7% L(7ԪZ	-!0x+`dqяhGʤF 6:$kՠQNLV<W"S5[¥Fd|~廄NåTQPZ	u	%HT1jeS`%ԄN Ŀ?wvF۟ FCw
ZkzO.,F?0S˛~~;9?ޗb|s:Ӳt5N@3c"|&ϤgFK5ۄnʨh`9}Ho~QIFrâ"?=m	)i<}-zۓi&MM*xmKE3Å[&WUrFB4RF`}w,AmͰS>T:&)p'o<!wyibPҤfdpw$?CJTCyt#BopPv	&8tS=:-T=7%k<,j6zω"qYF.2O`|+Oi0I@qs|HʑNr7 9hG0z&UprsUKaRIx,
ir2)aA|JU$}Mr=ΤR&dx*{il<g*ymB+:ql,UF# YBX[sĴs8CƘ&4-)SzOpy!X\gB$N1ZaQ1Pa''a r7T(OŃ<SBTH( ѰZ

0_-ep fe쎂q`8HG5刘
17rIDyǜ#v2 <fH aMu(b~&$r&mxc{PɅ?0b3?Jo)i7/1Ӽu ;.)f(S9lH4\R9צd}a<;S{	@3@yBj`P??-I҂`SYQk:jBGaP*
:F#:凟&iz.31=XEP|m/YNaRAZ",VK2Y%mP[2ؖ%n%!D2VX:/VtMG޴MK4MCޘe-YB +H.K.Kf-k:dYARE{ۜ4鮑$-Qn$wZrM]+k$) Lk&mh&4
h$IEII9:KwIDFr't82-K[bk,k7,1Chy9ziKZb)%tʚ#-wOfl&)`N(ъ(19鑅jBfQkG(Tb7g3\>&Rs	c_gٕn&ы&#{"&6uīe!^ L,S@2,?-*DӫN\-x/KKy+%OJrQ4nѥ'c2J-bgb	,Vt-Dmzg^EHWB"rLF90-8_$ =8_q[|pey%4=M%Qio&2|ef.5+?,d70`x*LNwK޷{/nxXr{s#=EVP0NIW!jk7ڹ'[TJ3L Hj	J"LVte݄$t-rЖ@Fˑ\xMkN2ZFqOTiIX9Ȫ 4BMCSO]fE=aPWB߀X(d˛DF#y{s-9	*- ?'i<^8h7!rH@}O0Ti1hsddhb\_]oUZ40	H`ZsP61ઽ>BJWg f	2:mGyyixw#QEҎ0
w>;bOM˟HW+n|
t?Og/Z,⌶-lweQgCX9a3FQn{?(W(}k-u9R$xI8{QUZE8cMc7g.NRtsN
LfCSX%Qw̔\R6MCOɞd9V>/IWի*mHnd_E7.@Gy[$6Syp^D4is*ud#ϟ~&WzP5泜t&9ɺёणXř7tlyDL'	m qVaowR,*Bb8] )لڋX7i1K+h
< D|[120KMU;.\=XsCQAhg!,dMS5ikoZm6mqH5\$z  L7xX3Z]^66CP5{KR0SYPtY]| F.Ŝ;bYqMn(cYCrq7tcZt>f*o0[-8'g_T&?<ŹSA/Hf/͆p)ڜ_ͳ	4WMۼDPPFtY#̃SVPX`ĬYdY*Ԓd9M
 ץE<?[\p,jT/c2u jhN搔wT~良uywv4<9ĴOh%;ٻK_F4O~i"6`M\F/i6kz}sTۊ(A^$Bdn8ˀmCl*?L
DK _
;1j*(7hU(	
͋\Pbhv4r:1ؑR߁:#B)&&Ɍ'Lѣg G&/.bgxl)ȕ\Tٙra"=^Z⛲щf|fe&Y04$!(I#J/a3xXVc3d
<\ '0ks	_mY">XfZPC)^|M+E8|H})\G/SX&]񣚄Ă)sps4QocO^jZg<58ո`~P~"ӍvBJܚYBȤ[{Nf-v`3RɤJY9jy *Y̼>\cM9ܭlW>yY 0i_xS9	Ep3g$Z)TCMQ_G9 eCOzuUQ.tzWcDyslg朸v3r0f{aguw(IvX3Y]˹(˖A`zgg2<˰ZqIcc <r)P`r|ΫcZ˝yQɏ5ol!T}74}|TwYCVuY]("gFfӝ
ifۇt? >8uG`NuiD*]dz4WG)E!d:> {rKx\s.U+ª4Dp	"Pp':dWg(``2N|Cw2
.6
yw{yi\6A>j0Nj|,*瑉dZl<0ܤ,%s6*J)F@ˣP8)=|L	_KɔRVoFdJ<hN
Y6-4lY]o W<MoX9Ðpvb횿uqviKbn 3d~ɥ3}{-4GyelS@a;_s70L6TL^jVeH t/Q'?Lz*LMe}I` [Tq7XYŜ][͵#7GlSrcߨ(79V$Җ,TW 虓ҏ7~`}E9 [4r	ktʑO8gseLC]n QoU N;bj˟`\F1y[S]"UfFϿT&C90>+䫫luc_F}:HuViIc@xRtnfE HmL:ӣG$ӪJU˅-$ἕqXl(/,R-%V1fL^fj2SfMRxprlB3"(QR$:[Bn2?>(ru.0ISDGcCT8<"2MƔNyjZ{=t[Um6rP )FJtUE1ͦAyT*,Te&qejWLʯT+8fT58Q2.yֶTF/L;/g`Yi9-ePFkSjL(fn
2 06ܜ`цT.\%'ـO[8by|
tT5`n9x"^sAJF?1甇%c[e&$Uw!NY.JSJ)ҌIvY]3?nˍßmKv3$yßN1<d,2Zls7-GnP3ldM7ta2)&փfj G._MC*u"&AY^)"/,W<O}8*(%vD`u}	_XLIcޥE᭚MH '\p<7*ągCr1S/i2v71==PbjT=Ba4/ɚz)jk91pg<ղ'4Wrвe<bfXT͍.<J*FZ5K8ٓ4G?r/[ötZZ#{Ҳ2=~/jT
 xcO(^
'}ZOUxD$!MШ9qǻ3Pp8R!
P0	iGⶏ=A}Hl\;9fWtԨ Vr13+W4>~b:E&Z3(NӁZz3a!	NQ|QWH~L*ݧl}~l8=+GȇP4ȯ0"%ZIew op{{K 02:*Óϊ=<6IT
6d$< E/7qSF5)z/ܲ#Y[]^Mߎ$T*^2l
h$aR\bby4I-ZedKWrxtI"0ӼLߥafi3\sDʔssx@M˄̖TYl5g7ϢCez-ResNsJq'eTy8ĺl8,ugh?^ngN+M=2q[	4kXҽQj .Osj]c`ҕ70qYc
<,v:a&{*穐oJb:VixKmot71G)*	THb~NŴRMHv{沲tRmGF\:[m|84O^Kf߸kݒy12WV.Bzf<Ou7of(@ӀYu17n]RSnNi!c&DM'3|-z/qF~.7>[NM{.Xg)}	w"#>g堛MjT[{΍zXF=7-ņyz77`nXUyۥL:97nDFGS}VE. (f[	շC3(ljҢ3;**VvDҒ$EXMpp䠭,g <] =geIND[|V]V޴#Tr]Gi=vdi.ް@%͋AK IQ[ֱ7FΑ;1Ok#8[4@FfHJ`f-Zh`Y-'U;	pW^*zoR}蔚s0GqF65$C3	2Rw4[MCUo  F\.0TIiI|f-K`'>'IIEUQvz}
%슯7pO4G4qhW򧇲0 T?x0P>}w]]1y#c|vw~V尬	DFH_}5ƕHgko!aD6eg_+j/	f?qωx׬$GM]jgSdBC9{-8'c* 3A͎ʠ{V!A/um71@|'CPg6W/pF[́6BWpL UCxbN513"<n	"pxF7SlFQvy"qߐbZPilk3)L?vы
G2dTXU</TNVrx)FAo.Leh[E64)/JImiY|7rN\){.$Jp,Y8ݸVRߍσZxMyg_8)|X*Lb9SĴV]yw5׏Ɓ1`Waxw/<8CSY0`mz}'iyl<m&axJg:]2`I۫+bf8Q5[nP9W@ >yQ'187ݑՆkԓ<H,7+Atpv%QA.vA+fz"^n^kaVAL?WãjB{i5Vs1Fs=â Rs خPUݨʍ'Tk9V>1bZ0L'7\E#w5 &~îVLN=uO}T1?xrZ^]]k0K-ZEuP2ҊΛ>@Kլ)8fbOYCqY*>i<sCŖaRF^<KO!ѹ!T9v}l~"`2¦<kw}T*-#joDMd0}&s>8g\)3<|]ǲbGh%&,Z<vi8bO~ȋD1~N~by5E&x_WyȖSk_}4c+Y>lӡK
4"=sj`<h$"L|{Pݽ{?F[Y6gKRWڳ4fe4GW
()ړ[0.Q	`pMoI*;W41+ͽɲE"ON',s >aG-jd#s)KᨧFeV':O&nEbh|׫2q_\|}JyQR^a_44G耕ǚ$~ `RJEdjE&ɊD	g"hr4%>]Mf8&[/{iWuL?qޱGfѩlrO1:j*6c<FiMt)#Of>De\ Q1t.| G/CH]N]Jtw 䞒9'6sm:xxpI?"TTxEטg^34<=	S`M"y(hM^T926ܮhŞj.f*繉[<u{\^?2
VToDx=>@>H,EH|t7N02qs-fK\*gLzк|8lGfTM;G m0)%I;x[% I_DͳJJe\@xԄ9Yr}9+LXm4/jk7x(i^un4:<^CzKD^h]T4FbrTLЊK>&/yK1!lH	7iZ@^L2f;_UviFQ8cFe
- 5J~c|\a2=ހ?k	ߏY_Zq"O݈Nr@Ǒ]CrAo〒#)q^$:(DG#׼EPۭi5F.k5|/|ZjZjHTt3uj8l?!y61HKXGШ?Q-ƃrZ:	;A.:<KEi݅j(>M| a%8E,t&\6nC>{zy6)e#ܙQHFCSѥ;ҙ^F_&YK[Y%/F.dƵQ(q/ʝpV*F<Tet{3P(81+JozSV\eוXZ>"Ҳ~pI(;#3[ zW//#w9bW'aZQ+s2AxTyIEaL<Gʣr]nbwϣkNV\jƴ|l*Q#*y3\0>+L''3,Y>ɾ-RU-O3s9otQEse殚lxd̲'ƫMm;Rt¹ڍáf~)^ЃYoUy )ţwOѮ -)LJe$#t
`toA:Ͷ<1K_
&W S$˫'VV3asKy)khu M
i5W4-!ct@gaϞ`:;SI_\x5#p|5Aux#o<)ǘcϑ"{>E/׽ϓ0 SaCFT^J"ybT7}μz̩NtzGk~xrAKST8&޳w\8t{JF04z&$T~ڙ"D܊<Aʀ$Q:(|%a+i|ʶn_љ88չRwu$Aج'ոdj3ȱ^6QzM Jjg-c3gG+ΫgL^{'*YX*?iϛV*?c'gxN(h3@WtFT1	>Dk95}']u/e9ټ*1CSj#e(JC_[yb5aJ_$k3..2Z,lJ7);CM\gw\j*$ 
kJ,.J߇D&x|V5z{}>[j a f!LJy=gLN74!Da6='`	!1Uj{; 4#omo-cIP|vIVkq݉E=t@V˞krc>vx:[ovʰ`C*_acLlo{7j%&hl{;@IBt?t._*˩8kGJ|j
if%S އ~^JR7ڪ+bѺwN/ʊPr_,CAD!tCDYJD53JJb/+nAz
c>P0@ƞF/,
2l]k4`?'KBkcSNjgj,L_$1l`]^2ˑ^tW{O;URG\mm<(ɔD$fЄ}꼉s5Fj	4裤]x[ Ғ\xOPכ\/<y]i}A.#5Ġ,/HVfFs=].PAyXQA B[W\wR(
j&p,X^嶈tUs,D2qFag{`{H,4|WONcȍ]Wz[#x'YW/6_T7_%6r	iџH w`7tK nwcOȧ_ӝ	HG%_?~_XjdVCt|;\|S;nYϗ -6A]$bzYӑⶥEKb^VɅ;{93rߢ-Aӝ!}2ʹz&Fhvh =A'A0t{lyY\j>;=8ln	5"r_|O< yAk/I5z1EICXj"BIQʔg	+ Kv:k:sCQִ,{d[YL4TiMykOub\h)/N\0Dxfv:;ƈ'+xM@3-@\)JWPpYecYfm"+*bYNyl<UHJDC[ dj62ȓ6{<DX`r,gd~?+)CAAͪ"VEH-qNoKf5ZnvVotk`%Mq	>d%v$KK:Z^[ou..)Pgcv:NXk]\ B=ۅď4s֬oQ/-=|ȶ&zjE0e?ͣl.ӢVSP1ĢC*r`xD+HBXItLGXC`q|}yJa.]n&iʣA#QM}rާ+9rYSd~qpɔ$>Tk|E$䤸V5,9bv}KݵD.8)6S`+rŧݡP.2uË)!iRK_L67nhq0cX-E9ݗTe4v>Z38̹{h\ԴX+~ْӿgBo!k[H0z|GDt<m[Oj!RC9OhCkkoB,oy˙ƧK&)u>^^o\^,NC//cxU:Som%( )uMR}$81	1[%#*hH+M g0"evq<RNGlnL;e/v17-)w@hmwq&hoCw`
d7N t7&lm.&h#eQsh/P$3F$v^3:̮:qPolj%N>5o]Wnv{,H@ohlҤٙL_~$c椅Y>EJRUs(7> '`;I8RzG,U ;s5zHߵ~\JxG^rN"nW;wiZ O>'xO#`A)&A}B|^	?͜o4GfYo&NeiID2mfr
1$ZȟnA"Po@[MZi髡;rO>FthďO:{6p,D 3^75;]6ɊIhf_6Z8;]ۭ6z^s'W׆`הM&.p/F?$Vyj؍+XO<a]D}hD2G-Q+ =LOq~#ChrEAm47rPin"Yɞ_{=>0soo@hw`:t~1Fe!La;/vwܴ'8gϛf}.~(b:O%+1@`]y#vn[;\'̛ҒL%$x`{GdYf>@/z<0p;;ވWwg Z||Of+֋C{{;<}/_?+p/
h~gS4iS_M=՛{WC&,Wݽ[/)MO5i\g_Hx잼zޚTn=רiAI]O+6iڼ݃5(FivG]3X?/h_[	0T__UO~1?7 m-de<Bd씉 :y	5 Gi	)z6+,QXaI]o^ny
]*L(Lao
`o5\i6w֛\3~_dv@r۴얦q?"
k0W({[;w߅҄OE'%f?l#?@k/7jhe%:FlϤ%#?%#Փ`gfvVgΞU/ܹ<gcuw_zC[pL~e~-	N9PjAˬMYw"$lv;AJ%YKM
'=T?*۳#ewv<QoY8(˜$KӒ{ӂ5msxsI%"d{Ӓr%ٗ8x9pdvq/woFd=jjcDM<;pFJߧ%uk&y5݆X@Qo%rz2$!,f[N冡j뚃.2~WXQmgoksL:GG^<S,ߵZV:.2/~Ae5>BM.UbE+!v7!%rrUj\tךhXĞOf膴/h)\r	K;hw?J_zpC-1k/z^Kng:x{Is|Կ E4>{f@^k۬(ԛڬMg&ʹU*bT꫞u?vja/hSLf㿁>2iޟɃg~zðן.=^+Oz2vcG^sk">^<rӞ%#r^sQ誐D	\rEӢǌ8#+|AC7UJ!`ϸח['o?qq=B8Hb?2?a0td((^(c(:vb?&&lFwQQN@ZF>FA;0hG1)ڻV؊^6L'G1/8ƹ׿Z<^*MuNNcyS=7qa2
	|q<zUknQo}Ro֐9-;OjM٘x!| Q|ځ"&co4|l5;Ng0X$z~otXbkRZQcִ,^K :vl1+YOZk_&J.kt:M*i}mV	miht3Ha]ޘڌs$d)CbShסV|f?67ڥErjj6֎5D"6֠hZF~FA$!wj~\ʁı38%ͬ(CsGr'Mdx:<kN!FdMTViEcg421sz)[/+ynRLtwsyg4HE{#ۃ)!SMCCwp)wg򵱰\odЙLrM`&@8#7ӭc([Ͷ;ֿ\jǑyF!'Piw|a%s A^VLT8ʚsѧ3
N8[9ʍ1FY'A
<`_ Q
7iga>ųΙ L>d!B8t|BB),WLB?|:Lia~9zTZ!CZw5(1AF&#qPowʤ1U3k#"LCw`LhHIMOj|yb!36Q e1+hđp|Ui*
/_T`Ү1V<xcN*B˝:>/W*to➹~0P>]6~kثlmXiݲZF^kN3ذ֏?uHԙ,WsDxk;+v]YSOF_zf?
ЕYpϢho?9&зFK7vkmG `Gv=jvg͂:Fغi:dY-kvh4֚VfHjNԁ,l5[FjuF}jnժCUeu SCOݺFM0; ]_gkޕOPQ#	ZBtmBnmNZo[]ofް:uj
rֱ9gbpy5[@.4Y Z
kxCنjnPNzmuP^oBZ['܋'k4ֲ6uuvjltFkЮC;Xc&>ˇNh>6{>vB5c6 IF]KzA?kن~`DL;#UjխuX34Zִ[ xB^ak`FS>5-_^DFhR4б@y1Fj]dtf[&'RdvPۍ&,%:+m{i';h-Fk6ѯo翺a`Oj'ge9iCQ'G'y:*0]6y}Fٹ76"sPyzj4ZF<\}vQ48)(%:h~)(^8|$05)t(/e`}g9pSOt4uj5Kż8A0)d{.5llk\M Ǒe:Puŋ<m>WFӾ#':]Z
y9]d?7W/lEIrXWիj.(8rF}m	s?%)sࢶ?=0]8q7ɩ~/)oWG>	fP}G]m-7o9e}qN+9y-rc\nJIu!$qx>Ζ$'M+eL M<$f{^~@INj&Օ/
I/ǇJY5=ߍWwDk,b`wj9YqqNB@rSaA<6Ut!-{
34<[7I\߈8W`-O|@32eP88j'y݃wdU6W"Gj$! *H1qtAM9^.%YZYWaGy%u5̪̔1t(^Z,T?p?zqojt8p1Ter5L"M/\`Z<)b`$$@2WmҺD]^8ZՇs21BJ WWd{֐Kt}&L(ɩr
*_?_d{1đ)_a,]D{6/{^O5WMs,률d`#+`B3XG
Ptq"CFlU!KX
T/2Ąc
	l6J7p
1;HTZ^e7`x	C!F	^-hx$-:SF[n_R;{m˙3Nwp3u{A0#_OeD;[2PYRglxǀW04%)"2%%zzoPJi[{$27N/E0{UNrPFТ$ ꔤ5&f, 	c0 3ê KJ4s<*/>TM&9^ڼE.+ uS-dX"EW'.6W{Q&qjL<C=QeEksl6p!մ쯿fU%#'=6m+ b˘@]#.{ȎZ*:Wd7) &{FSƾEUS!n|?ɀ9QH킴	]I*;Θ5T"5
/x!)gb&fk9d}xF7L+z)ig&6AVJ@$$AM29)R@䎒2eY0t.Xhfx>gfVU3%FzG+bn<}VOatGo早Q,~pMpJr}0,Sy'Kdyȵ{Gȃ`V{ыJRXCZbSoj0 Y=Mj`(86';w fte;}v=M?E04>J	9dp+kh]&MVBԉ`}"zHIqJ= Ν0ys|-e)T+$sR}&TFJ1ʒnuhDӂvZnso5G3g@8`Co$"A eac^=؉w5W_&%B5cflae7/vv^1+.!y
n)'ڠ_"P͚c̑j0@ɰL2<\[[kȦWmoz|춷l/b߬͌)(P0%۲Y=@ nUd+E@Q0vY C&0Umr҄FP(wWeZeM y@[x$I(mo1ųa[>xQ2.? yl{	fFJppxSQn@mJ̭;OFF ehRtI{D	Sf9yTD(Ƥ!kaiv߯OkUI@f4h]dIx15q81+0l^$w%N2nG*SnDG>LKrO%5H5!馌Z 90൳V=r\/mjl8Z.hBk5tɱeXL@gd\;p@ֹ:UJINK|-[@,w&ݐ3bME}|/3wXΰMD]xcc=gt8PSI#>N\?f9nt2A0d7sx3YTCwi)0M2\++:uGCyNFp#y~u/R{KjvjۯPe@r88dc?aŝ	(]g2)R錂3]ǅL;:.c+I.9áE;Bp[^!6k׬;
Gbp<UۿؽZԱx}4+:{={4JӿMp,DڴEf3ܳaq,o9V/s:]+=W{x%{;bCj0*s3#owڽw7ΝX޴sZ9T4y@]^
 ~/DnsE֥љh/|TmV>9Q3vFs"5*siE4< Ȧb#gE360?d.<XΜjT^D!LْόʧO{d*gh Co!Iu".(\kft\2e-YMHgVFzQ'^|:=B,G!N0~08jg=2E3v}ю>Q+cfN7tWٵY*Fk~u=&}Ơ^VR]sC6LtGeH6!bAJB6Q`QZiqLϻɑ^Yv)SŬuwm\-s:3QdP_M=8FJQlaǁ F
{QO=ۗ!`[0	u/hL2L+Q]}|FsZmZ=$*ב$1B)Su0"7	tp"O`f{~[hI*ʗ -[)([,3#.CHSN4sNX9Y'&ļgոJT%9'Ǹ)KI=z,6sx~DFmCIѩTI<{'>~=znKpa($wPF;O
@ t09^Hwa{S̇ҩ;8%+Eކ\FjbAVYHM3[MP#|tCP:ʷ,C//wSWs& 8aŸ3 67qpb IlRTSX/wcuUdR)N*
MCp(uQ?5S]<WeS
z^.;}T
4O4E$3\ 5|B^%Juy포^4ܰ7ӫ0 (/g8~	78sᇎ!^&it%Ay+ܥ|s9<<	~|)"^^]K!s^ҟ/'B6/It+KhrD?wi_a~vˬHd/,2έUR$5R3J?̕fיBbQ*%jbۦ{ZE_?0v;lzMҤ~ Hu%xzeLxe۱s|[ɆIs1+G8:F_ ݽ0/^[vwsFEJ.ug"(z&֭7;ut^ouNon7G~c>-g笒fY.$EtC
@#E}3v#'b%!N2keH"Olkj;H1bYS νFROkaQDJ̹gD#e\ofڗvةb"GO<AxI@/JlP(w94T܋4sC!@vb&Sؗԕze,LaJꞄ4՞XEU6 B`6HФguyc$q9k$	qL}i6EOʭm5ԌRYt^E2JT
\WYm"$gКkC(gC$S7#5f0NMrF'
L<â6Dq-eʠ^Rcݼ	_J'KnH93ŕa|a`g7ߍV>\BK+<K{Yo/:#)m~ÒOq"ϾX,Ѳci9א0n.mɴ-<|iίWZ3i㿍Ѿn'ߥ3[h𖯨m<
ܒs
Yɒa<[M\9$Ǻ];ѓutOS^ Әz	,L/˥9n02SSn3 d	oz32êܖinpazKm\,>j1 ;` $R"\\0XeC\Z6xGn]:BVK-0+y W0jeY;R焮b(ɽ!tHƁǂG\ϤPYEAfsnh	Jŷ7@2%eAYn>@F]Z8DNUtΣ=/Ja.E@ٴ*,x XhM%gwU 0M(@(dM|{!d;ۢ#dk%G!ٿլQ!'3vz7-5{g?]Ծf#A]]O1|YVR(-FO+u>aVta2\ebY@<h`E8HnS&rFѼ	_ Xĸ2}(z*C)p616#@hoM`O-F_dY62CC}j2[!fd|	Aw9OOK`\{pagGUfX
CP0R8GN#oPλo!+6F7U3.>kI 	~S!Z+Cb<X%HI$N\9J]湼I\ [*p vxu}nḒaexfUe4>*mӱ"}8L/?{{^%lsU5:b̛׏17xۦmڦmo/" r 