#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 b] vƲ x^"]7Y)Z%(Ijq:e
$U)Zd~yzzy5kΗLDd&	$PU$E{X%2222222WXvzhuXv:7vX3E,@9ݑz qI9䲱h9i`MvݾG~6X~wZ}E۸wrQ_}E?g |g0?<4ps>_^S-[fz@J	E?$k=hD~W}ɥ_eyoվzvE0c_ٹLΈxX(i d+ر7v7=yq"7<sÈŧ^DiG1.;ry|v}( dBޮūq0=;|g+ߴ51Ap2dz 6̸5J&O)!h9¡7v0g4X#pm|p23E3D8;؍(rG"
)YZMkd|u:no6]\#ؙ?/UOxZ}7T޹igSK9ѨCB0~OϘg*?V1!pxw#\idW_͟ޱ7t`нsd^P'1B,×QmaWEE.4Π8J
߫_sWFp~[u4f8WsDwcYO@qp0ZiOfzh5m7'8GЛlpv;i7d߈El<b~;WT`cGыYrU*#wH2	}/:td_vVU;vZ˦vN{u¡go@N{K;M[IUv(F@"TdR.]ӢbZTLiA1vёO~Uܦƶ	6A֦"TdlSE!7uۣ<`+Dan<_jH"85~WW֦ZBA"FYuEIYWwm??	Sk	>weuKLκm{Vg1k=Sk|7 g@G8pF@E_eto{z!;?B"Ug;	~ `z_}w_Z͘|l̚bSw-]HH^r쒝Nk{*{Iv&Xiu5aVIjox2d]Agigobw`^&~Oo4j"ԛ}0xuS\4}ÁcM#wXbx[;ft6JoAڢ>V].'.k-G'<sSG"'Nܯ~ٯ<?m$#7[\$dhRJX(ϒ {#:|49
B7>kT ]a5&]QP/kms߶۰'š׼Rվ;k:wZ3FW
ʗYx	C">sa>;&hѩwO̙+t%{qC߮$#d5 Vw߿'& sKBJL@`rmS'>-Qüf2 $Fo9,oPK@il]e`R'0׽\4|΋6+ZM,}$_I<H>[`ֶ88snF s:uטWPF2^Ng_nzs5rS*hJV3w#}7]v"uju9th`%KX$H.hjL4oοE1p|'wW|V	 ][!EG,MQށ̸yWӌ0($hy譮|*&TST_US$Ê0>Zҵ5oXƾf]Ւe"Un_$R}ǘUAћK_	fӸY+!!͘8kx!DV8mF4TIa՗EKї[?ZHa0Sd}mZ+\xWd/2tByCav0=wEE<ݟW_li^!;*((JsEڍ.j?sI1n)^yH"*1R:s~bKIMfUhh:1f͘3 7<MOUlN6 y Z3/5EBΛo	q5UԂIt|X7Ҁ9Og1n4Wj[!?`<`1/PYA&@p̈ˆjfa5:RbZ|ʸ-VV _U75	6׻SD\"ԫ_Ad<KesHlQ
\V8w*r[,Kڥ__v-:FGU!**̙֬?Ξ(fS7![տ<:akGgdC$C&f#\U(gy]*Y#9C_eQ.O\@J%YěV|1uWv7]V_L[4BN;F]ec\UF|YCzыW?샟ۭ/&Uըlw>y/?<|XWKX<)-axaљUǘ<,B9,Ɛ-gk'	F:	ǥ*sYv8GAfb`jKh`
tdcEtU!LQv|ܚGng@{@W;dD_%ڐl%Jާ\P̈tIM _+$ΖhsEvntdZ}s럾~~>c|,1RV5LAXSfd lK/m?LE
RZP0=2$_gCA>YuSBHj ?8XkeY7HHOXbViS1nZʦ0p|fsJ{W,"wc@0fp`W"J-D1;ެjmQׄ?mMV`/-4+~0\A%{bI@%X UL"(G~ {>vNԖcϼ
jVMƬFNeZ.jZghoYWJI}A-$ER0)`eS晏x\;Ia>EN\>2fǜ+9M  NOT;%fUhcmX90WdvINnUI1wI$q	#~85Jr
2k@h)`RR`R2B`
_[igXNVP60d(;ѹ+v&VFF[k1^:QVtf>Tl@&510.*iZ⯀Ts͜4=in9٩NO#%nNJ6~?)/^ؚ1=?d8$;?Ӣc\S1eYͅuig<[LuX8~'IpIu6͌Dٿ`UF'ҕ51٪,KSFUV{,5{Vd̆Fj(]GfSIb};B@ ?ΫȌd/&cGn 7"ءkvN(*2l'k>c҅)f[;eO`nf\A:7c!]x?t?KQ"`?t'RH[E@YAEsH?*m䔭q*r0u$G9V$/؈U[u3U:u`R`ەhm哼M~4/N!Jk;Ƀ}R*͒L$l5v@}vuHa/Q+I-ȵը|q\,hY>{"o*x#,csY^RW7?qO5>89tj1PN'h)jHbo6t{E*_9MHmGqjlI6F!r-o#cyB=Ue-?iXOg9BnQWշ|[T.2gnޔYzw?z{zwЯ:s"HFU~c:0
̃ fxLx>,5>4h\!~!Ǘc9D9P|mqbФ{HQv+hϫ"n=AL&X"
TV$82SLRLJTͷi6^2K0sgEJVtAB*[frȉVN>r߻hfE}Xnϗ,t{X2dM2,,5UН+OC)IRm4nMvraړd7gahhE/4bs&f&D@bW8OͨUUu&+@peA]zNBI0bTVKb'Ѭ,;Z:uSԹ?5tc8sbgDW$'Alk}UT<(e=nňs+qA<Ƴ"~"e#Sodi~hķ4>u\qFo*"a?1(6q͕L쭘m#$#4	&fTNւ(#M:] IOONb$D4nWgE;FbLO,FE
)n3s{xeL$/.Q&nt_9:[*{!ՠFy9nw:D^QniYo:^klnj%^L~ujU@)7l|@a$(@?+#yZڝQp-m>wD6jE^'O"%!;/@4bpTrc/GcY$dJ]]r:E>vm)siVƙX9ʑH2\~y"L;*z*X_Φ\#|T;/fk[z7RIsLgcy9DD),!mԘSnKPnU	b,ZB0eJ	$/VLFӎI=ʍr9byAZmtIֆAyDkɅK|
Hw	-!IKLI#TP$Jb$B$
4BgI	˝':x,lt?@F t\DY~,<Z7+wr: ؽ/=t
ejii\r0MFs6ph	o9$Qx8/r^)UZ"EEw13~nRLx2n5[w'ML^U~ݟ5۾J[#CL&p WUrFB4RF`}w,AmͰSw>T:&)p'o<!w{ibPҤf	UO jPڈP[(3)qP)bnUd M^HF³%,ʳbvP_;Rjr;8>Lbё:I\Ւ1D:*
B\?"LJhXRն7F I_\op3	1^Z4ۅ'{JB
pE\Hp%y<CPdoX9MbZ9t!|cLJ)HLeIUݼn^
pG3`!W_^b-ﰨØ@0 *I
Nzǧ7;[Dј)MVC*hX-a/XƖ2RAyt3
J؏rvG8	F0)rD	9|$cr;JV[	Y$zyS:Ƀ\H1zLr?nf]6_=L7W@֘i^кRB3oa6$N.^VkS2վ0es̩d <Gi5$Snb$.6i&ic!ܕUĨVN):E`ZN*uGG|?-?\fb1zPjRhBP!"h! ",]=+QeHt@5/VtMWtM[޴MSޘ,>Zd%YAV/~M7$	|Cߐ7$	|Cߐ77["+u*d|@+cw8]3#HɘFrNrNZ'I
@h%嵒ZIZIIfQFaN]Au3r		L˒%-=NJM,KLZ$^8ђXJI%2fXY6[yv#Ws>Jk#

z~vdָCh/8-J`}Պ؟}WIleAygb2ۼSItĜyxgh]+y*ueY>|hH%@U{V(GULTtLE"eUo
ܔ%ƥ8'(wR֓^͖W0+vEe}6=x7R"+!L7&pI|a[,Di>G]pq:_q)[Cp!*k:h*K2\d80\]k,&aW~Xwo`$$OUPֳ@o^
2F+{닒OC&knfsOT"hV9!ҕn0uʆY	I(KZ-u*- #U?!y74e5$Asd=/Ai(ě<_42
{ J̑Q7!F2ZdsUZ@IxqaKoBFekJ`уF}ѤŸ̿ԓh4mcTU{s#}=
<Ap\e dF$l	^y7`N}}wĞ|9+?_ܘ~~yEKןF^A\hm[0g4(UߋS~Q&4:@{<Q"OCW픯aD9(%MI"MAar͕CFeFϰX,h]`֍|Ϗ=if6]ԱJqͽ(2KbcLAaɖDMFRh$J49I?s'{D]2[D#Ys7\[iԮVk!]^a{}`үk nуn bؠ_Lo,C+EUrUb1~J}6Fg3~QБ5[l$8p\*A5*V>#trDZ%*{{vY!aˢ(!T.?R~ԑMJprЉX4gH~ỪWI%]j*hyvjqD8a&kJ9LK4_x$4hsg#Dj\"Q,PAej۝FareR)#]XF!(r*Z5X2(뵼g)(EI?[ŌhS̷u#ΒV븑+a4cpޜW΀|JkG얅p7[Kq,G_ԓ[WHʹ.M笈G$fE%(f72Q
Y`nY,!uiϑV7_:.Ţ8USD鼌Ka+lqr#(1O)u2(U{)\`߰:M9cN]
f< NHa1?ǖ*`Ʃۀ5s-L멭ZC-PyN_yκhFqe[yjTіZ;D
Ǉ( QvNcԴKT-gQLoЩ(QRم fakYFW5P`ςs_NWr>[C)*ެק#:oGHQ~Hq>(UQ	9H0گ_ӨE5k%S;}[8[:mg+qCJ@ed 10Ȅt9!erTwxIs:lj?#z.G}$n$n곑q
9:1zKEIfk]lno˂kE$r$Ia֒x'ٽjyƗB&ًrļ>\ }v]jBMKǫ3n@mtvihwHbtKl`~dߑ~QQ6\+^g[[?l\Bx.S'΃pfk߼{fΉr!v-3^řfݽ_uܨzEι; l!w^},?C`Ԝu'3V%ǋ[/
%۽W?3-v_ׯ
j Y{zOmfΏ5!h}ǡGº74u\wYwyVo}6n]EߦhѺ}8Hb^`zSw<A^oxPeDOB>\OzgE"ԄC8QAjnw/"gӐ7Cwآ30K%(C5p`` Kw`I0Z2](ȝM(0uQ%c`{\1o J|Oyd8b#-|QՙME.Ῡ9wWJ1Zʟb2SzĐEE˰/GC)k7[2!4tKE*sBG:+t@ZxC|>{67 ث7-`0uav-:i2|ܧ3yIO<#M+c}^MQ^%*PXǋNhW-63t	U 疩h5HVaY6)T_O~~rT[dzM,ղ
$P^0b J/BC$B߀sSݓ `P{kvdX~f>]F@>]
|"c/+g2.y$=/آNY[Di~*B+c<JKz*k"azѭLMՒȸ[DE71wɟ
ٚRl:ikeM_2L؟r&1a|-SڊǾau&F%ӒxCtnu,ZmL::&M2oTZ\ؒ=؀DzWN`m05du0U-ߴҍZ͸'oB}F#JDg+[^CdlPӅ dDmJmG{hfxTOm#&w(n<Y5Eλ^dճL\M(w$@F2h0qVe/7)+/#bR~]Z1ڬ1W
\q̳-]μХi!GFY3]z^M3ZS5J P}gz仒-|پ&Qc	m8B2Ub]%Ά`ed_܂547V|)PXz[RM֘f8dcx-`,"n;GF%c;ա&$UPKB$R@Kܧ!2&ZGu]id4)8/Gaq1F$2Z5n#+!27=%iSōcL@6@.PNƮa/7)86>N\9[<Ezv$0P!BC|a9?;u̻HcUIiQl'rTS)w&pQzvC@9MR7e|'D](5=YO3`7?3e<$Bm-'fG{<k7j[Z5ʢV@Lu ;_K^I}"f(Pj+^ؓ4G?([ötZZK{Ҷ3=+jT
 $bO( P
'}Z-OUh)tXG	JhTX2yph(8?)P.j(eʴ#q&Ğ>$ic՝0ӫPYjH +9E+XLW13"kwv-<㘁Bh-F^ԙDQILK(>o$?&|S';Z6==Zc@pTϙtENKđ"TygH	`xVT'>hxIT
6@d$<& E1/7qZ)ıoܲX Y_[YKߎ$T*^a2l/h$aR\bbGWy4:o+WdKWGrttI"0ӼLߥafi3\sseK˖TYl5*Yԍ̲e:XP~rNsjq'ezT19Dj[,gh?^zCL+M1q[	4k}Qj ,v~.OrZ]c`բ7!qYc
",v6e&{*oJb:YVixKm]lP71G)*	THb~^ŴRMHvxK沲
ƯmGin;sR6bJ5n_#<QzU.GV^(DwK:D7\YM陥<m
⚏"gyަ#2fu¸-EsMd<,;H*L9A~b5̗[뽴ǵ܀twn͛&]70*be:c&DE/tn6].׫ESou;7a]ܴ\[ܤwaV[o2,+)4-чPC2go'\ Pͷoc	6W&ԤEUgv,TTp;!툤%IA[IYf'CxRFU+a/ʲ=tc^RVŭi=&'az	\7NzIl3F]:ܽQJ̛CV9M߲q6vq͈yZ[٢qf:u2C_e(W0l:jF#FcG" m9B6~YL WrRd˞o(8h{DLo=3!2INPTdKo36epgWak#@(Ws5HxVvgP%I'%K l,L&N&%fDٙ(+µNf<-:rBU H_[+>DZSsI(@ydVc2}vu:%݉}2Zeò6&o	#A-W".!՚D2NhTaT}-$ V=']eF7wU"NMV	fN;kŴdjMw+ku_	RRv+aN}C(QTGq2>ufsk!j-tǔ\"<^38Uq)FP4YnO9p4'aKp,by-o/n،<m`JH-aobZ+̴W`a&WEcsnR\T\2b
J*@,i C)rcgx*'y+tC5@I #&Dġ23fxܗ%$EIHvHzyrڴ,I>7Jr@Fה:"opQM,n\^AAULզ</R^&V&MbZ.M[^_eCs͸!Y6زٟy,x=Eq
L9R>u<66zQ0b<冧z5s-`1VUϚ:w7^r|$+@A|fܓDrl	Ǣ\jÖ͜ƋUjȍ}SIa'
"
Nʾkl4.0HP~~ք[?bEbS`m7\dmbk-*ztTP[hoat.frYj.< @u\}ؒ7]^ 2W>}[4JU]XljK _MTz9'FL&tk(qD14&`M{boժRGTeS+kkMfjh6|eϼR>5kĵ&ǀSTeV*VO!8nMԴ-ÒSt</c|}tCU]%3N)O]jrDnwhD!Q-9}/qCΙU
OD_n׺3-㑬Z5}VGn4y>v\@L0fքYvʛME#ϗFᰒ5\goXKDQMVup{BK'// <plwog VWْTl`,+NgcXC7UO_S^e65@줄fՖOx:<L +`MoI*W91+r%ͽ2edOt[Y) p#\_]	Fp! SQ_94Ot0M[7(݊o5eNᾹ@VbÃ1V*$I!Bb+OW7]a)8Ͻ_&ɪD	2hr4%>]M[f8&[/;i~uL?uޱGhlrOQ:j*6e? <GUMt&)#Sg>ՑD=f\F!lᡋ?>*z.ab~lpG]DG gdA/Ή\Jps!Gj"r:o暦x'HaTܴ}_t8OKCEuClJP`XI1!ܜ<ar_+Ӡ`NQWi4̮RTIGsˁˁc*Cm?r`D{΄KKǰK~`f|dv]UܰsFS"$#ρ{hJݍU2E"T&<AHMØ&ٗՖ:L⩶OE -OCº9ύZGGuH|[<HK(\LJIZqe:"/x)F#:?)&M+(5܋wQQEkJ`N8)
~3s̨XPF`/L:QGrs71z[c4Kk9NPx݀ɵѩX8kB.(5PuPr$%.〤Bhq䚷Vj51}F%oC!V_X!ZRJ<xP# 8e<&skIX 6Q G}xNK'"e]W\8YGGF~I,xP%<6Ǻn_dm35vqhU,r;9:
iވPQbtx,tg ]:ȹ2k+_х̸60
%?EnJ(3=wJޑ4tO0w
K9g"auY]Mχ
[̍RFkBHDZ=	U<rxzKc/)<ln0HlC0p$>Ԫj~%{΁&/(cT}XkM,nEtIVjQ>[-ט_@%jD%o|Kg$tF%'ٷEJW`Pʜ5jcΞAb|;~^?uNUs-Y	xSְNۤ?7Z@W8WqzZ/E܋7 ~0KT\⍱#$xqA	9%ő|TrdN.Iٶ#^jK
 qdemJZM4x/QФ6{^sEOcM26NG}|F餦3S<IqM<۟Dƅ\;b
G[[g7&-2y9fי_9cy?\$y8}p<) y<IF
W|d>dJ.#vE;ܧN~ŧ#<X_/(,85	B]r~1chW2´-7!qgzz+u(CޚEq@uf)ۚ7OMGgPx4?J#jDIbTbICWckO8 ǎ<~4 Ha5ګuA@m|΢Vڷm;1y[faQ=oZ|;o3	jL;;x~ I\b=Fdz:1QŜ'4ϟiAji/7x@FKt7ycdjMx+E.Hg03n3Z|g(&3|ЮhS)1]v]<}pyep1@ (*K+岈(mR01B0yմdKαEdp(0.(5Y0K$lМfr0 G~
K'LhvWV<݃i$9@-%Y?+uNY-{_qHrm<ȹFPR
ezd{QeA(!0@c[]\BL&\|{yRTYN nhpXs=2|V#VeqXH7+I=>kmrXUL(ְTB?V]uj}h#QV䆒b
t5
&"'R$lTXWW5}n_q'˰WX2|5|	`dtWQe@M
,^"pgY7)<i</]R\7(bpV^N<Scau'ʍie;Y{ڭ:juhl#AI4 "1{&SM\1TNĦA%/&1*Zs?E^o2rGvppfBRd ދ"X՛vYV~aEy՞w)n/&g^Gvs!WSHPXs(±(ce"̹(t8
'E57H?qDN$0x>9#7>w]aꉃ+ou7OW<`f]|QU|1R$TmGC"sq].0kQQ>!~zNwP& "@|,}aYqmo(YgI_)uXފ§#mKļDu"j93rߢ-Aӝ!}29&Fhvh0}A'a0rlyY܀C>8=8[ln	u"r_|q@< yAk/I5z1EICXj"BIQʔg	+ Kv:k˺CQִ,{d[Y,Ti]ykO_vb\h)/N\0Fxf~:Ƹ'xM@3a/@\)JWPpYecyf}"$,ԫKbYNyMl<UHJDC[dj>2ؓ6{<DX`r,gd~?;)CAAͪ"V9/ZsjoF2_qfmNnk{.Շtюr)/5^ǂYow;}ť?u,nm7n\!e]|:oG׀_o5:AwG+1Zp#/"f'y,q+[J*SXԑ;$CE1$&y#aE+N#,T//B+ua]ǅN!~í'-=< z4_b$]^:k$8G.ku6̯S7<".|բjM>ܹEj>>VSY !&41){
yE;j}0ʯ37:/Ŵ(i~0;>a%B=U콤ɔQ_F:uű`gfe%'Sb=#4}K
A_^A ]:L=EdJ<;qp)h@D)`3W,gV/.nMR\kc|zY^,NC/+&^L0d+)HΣ훊RN]`)~"rL`lbAi	|4mxfCОr#xqZ*܉@.-yA<Nsf-.-{..rܬ0f6r0r7?0AF|BwS=Άfhm|R&>
ERп=cDX+h8e8驳캍/SGn%pf^TEy"~&Mz}Nn40M/:6NZlo:Y'_\rdL}gAzSh6--G{$;T3wi?]ǥ{Aw5IA)G-6{s'p:dbDG+t+w5LHkn}`O?ZF%vd6YmwPjh*&Ir?pC4Eq)	b0wuyN LKL_ܱ{1ʀEc~؂o񽶡c)_2y? 
IVOD7F&n7mN~U<5fEzɠ܋㏈鳕f~޴vs
SO1s Qr,o@$eԊB6w&WrSwECt?A[7ͤwRHmVE"^̝_m]\1-!d
yӦճ74>1ɘތ<n5)9B)TBо{	
jܕ0ny%k^׾wqR_CJEz{wFϼ@18~DLߞnTWcyřzw7[3j'_zw}( yvooϒ/wW;}}=5˟)-iA>Mԗ~3A_^I%_ewC/JSMZmd>ɫ7?-%ֳ͆vγ~neдlmzO_m?_L=x4~{#<~;~\Ј`.o6S_c^w'W?d4߂&ӷL%ӉS&ʃA&<`E%U٬0Ga%uy癢R+v00'k.+9jp, 5/
hO'jDMHM~FMK`P(gv`JPЧ8dSxD^<O#<<TύIZ[y{VIt򼟩s3=}3~}n
X0ͣat\_$8@]M6-\݉Ԓ,/()ٖd-7)xHlώٱw̡
yrAY4 ^_ߛ,5yěHgU,/#*jˑȁ톾3c_zMyfY:;.+,TkDۣ6H$P$OmmTϬcZ2_׹>Wv!ǝ\׳
5.D>z2$1GlIM5u5BSn`;jj|.5ёO~0wU%"ע	5TOȊߴ6Ǉ8QRfZD4NF2|2SF7|ILg4VHXXODt[?J_{C-1[/FN.B8"wC'!!S)	?ɛ@c˻.h6i8/4WJRg{駫3o۬|7Gws=탟0'ү~i޸)'7vW<6Sci^IQ2"W<*I (>\<-zxț3"`8nY4raQ]})|;*a(7߃P)ċË$#(#{#GXх:¬cg/6$hoi&k]i`q3%ycOlet
$ܑqC(`{ţ2nD_7_N]46}A'a03o{&Y8^L/7'G_Wуf}޶ނW*p+*կ;P4_vկ[VDϏu~ـ=QzQc޲,xsiV@fkcg#n/{N7[(	tzy%t\SVBk)#-i.oiGB2$MNJhckqv[NMHQu(*/lm( d
j-?.ta!̹#M3g	5[c\n|*+ɢ3TF<Jo7);qyPg\Z);tkKX	A2yL&x 	-Vǝ_i. Ó<bֈQK}4;T /+@*eĹ'So-DhF#Ƽ|I E Yz&oQ(nțAϴ60}	L _Y݈q!F_:>p!tv+&T{kC&,0?=*|d!af;MW Kl?#8hteҘ5q;v0AQ4Rr.'u<AX#vYj*?q7_Uv%5UB(>XElῪ;rgU*[gF<m_/qvgg77ͮ Oyj>OH4,7s\Exk4ϫ~]ݰ7:SOF_zno?	Е5Xp/lol<9&зfG7v{}'	j۝Fg؝mwͶk\g 1^G>5v1h[z'[]#a-PjۏVk7VklXeQUV05e.k$Ӳ㐽oЍO==^'j>ABwlXH6ccPnotvntVi?j
r69q͠kn=h@
T/5vrz7^訇lZʍF6H^<q$ DY%jؽoVotzVq<n;`hu6gMt/Ю7\&|cHҴQuQ6¨ t@?vEnycLmtcUMnޛCխX3ZZֲ xA^a`-l3|zۏ;hDـϿM7ְ݃J.lu]EAn4 ނ z<F	+1~ў)h+onIfApTr|cQ	c.$
(5LMh(fe>EQvt$*&! TZ#Š4F~_%8N

zɿ/f_yƿW-I$gEMk~5y
C
kX_axg7~>vpVR1/iL/e
r#vtKM=!ZWS!q=s<Tni]#GUG^vOo}fFlݟWGNtZoKZf<*V9nU+k3$97yԇk+j-d9FuGrpQ;z>/LT9|Tgb}Λd男k#s|>Ç.^÷2w8'd?yڋ]W9W1.qw&+s
Ezy˜^@<	cg+
KImgƊ!i;F)d<DS)ǞWuֿIy5_sG/*I/~g{.)GL_G?dLҷt j{`VF̊+ͫUxuVVjj>?B18ҥH'AhWi72I:'FDƙN k?`0|;1	LM/,ǡ7ƛuPxQ>zIf?^e~-?xLD	(GJ߶[ﳐ{qP]ewE|dWRW(ϼLC71eENWZ[TyBPF04>Ech)'L.'\Ej%Љ>pb(̈tuܿAn$;ܳ\˜41g:mFLN} S8T٬ִ
"ۋ4lcwjؼ`3w?n_7Υ7YيB/4V w
ͬ`JM)ƉƞƛW],Ug՟RyC={eT77GTBqF#h@VK ^	MqOREEBZD:F_i_R;+˙3FNwp3sk a0"_OeE4;`|_-2pcw2L˫o&b=PW7(%ӴF܏u0xxx'["޽*'h*(#hQuJ2d
1aU%9rYNbt6/mRvL o)Mw{nv+URrΫg	٫=F&8k5F¢	U6JJdlZZ7߰>It9Xu eOQ_G&e$4th所<U7P\2u8dhVmRW'e&G!&t%a8cH$(LLiʧDr+?UbCF.柒Ǫ^JMPռR2	'@bFLlR:=lYit'^	F\pILIU!a^GcB5R8f@ut4ܞcSkRVmCbɺ o^3<Oޑ7^b+tXa0<|%y񨙆@H>|ZO=$'͉r|]Jz?Y4V+bb f_]eOӕMMRB}07r
ݙG3d@	|D"h!,5eu"Bq.cSR"GG$#cgs'"L]\_#E04jdYJτ*y([ UI7FYRnQh7#*.9Yfxf΀pH$s+HDA"¨tJ7ij^*/5
K5sj34jzlho^bV\ MWUR(Oa]:Eԡ5aǘ#$Ԟa5a~3	E]Ӌ0C/d}ff_p%K4+hg{ρ@EQ|Ud+[Ef/Q0qY C&0iZ% 71*ӟj*A8nVOCRn##FMN|h%0'#V%Z5k7D>'ҥa,k0MCq;#K]-1'tRBTX(r/Ffγ>%+oX[Ʒ5\Z3fΠ$<yĸp߬|ׁߦf2VGxSaD>Gr 5J,{jk Eg(e9;^ڢp(i[FIфn|b{`噀πol܋sCu8W®\N,v&MGhE6:􋍾LM> b96!uѣa8~$`FUnP@MŌ`P;q0rQۃ /7Y,<kd	3
[(#Pމk"K4srcF0_YѩC89iu3R3fGe~jS{P~RM|,+Z| L'a-O^>@H}=ICrOg
hf,U-F2]O$t[Mspe.,
D:zz0/x_(t?S57Т[AXp3af^r-lc&<ԦE(^.ZR_A	cixz),\QltC`|&|ݺÒ,Μ俻Yk_0;wx5(TckU5x)C~w_>K37r+|rX⚭uӬ.2l  B2zLɚBZۨ͜.Nr2:sudgPy&R,3S<`gK?3*p?נNܞ<b47$!RkKŵh4^
p!ԙх?dS7Wbrɔ-d5!f@Z3EKxh ;GҪq>dG;vB7?kGߎ,j&;)߬I0bt2knfLުrB;MzQ#t]h03{b -uF//6	!ڴ&GEi%Vġ3eJS?$ydJ̆g"op)GdT<#HS<liox  zр}lU VuhD̲Q]crfk[z}Vf}$*W$)B+s0c[a;DYXE\DT/A@>/⛖jSPnYQgh6+o&hpm2MOLݪ9Zyokls9B'GF=z$6~qx>GDmCIѩTIw ؖ{'>	~*;$9x~a|wLF:O
@ l89^xwf>;Sw<=%ǉpFF̀X^dhcFF,n+W^_@5r'o `L#qq[Ax]ޞ7qpb I|RT*wcuMOZQN*JBv)f8TE.)=|	倾EtE@Zp"y`d~o. GK	ߚg}!GVBC/|nUL 3]xCg.,DY뒏Хqs	LRƞ]3?a7/'t.'//Q|O'S`JLDaRDOs=eWH2'R{eE&Ŏ
=*U$rAꫲuP)R^h_L]4R6]#$_Ml4CsOK<4h}F5sZSiT
>i$RJ	4ՒP;43?6Gļtv^Wt?(6?x֋_vw[o1A;}K_7^sks?=փ޻r7WY/7Y#Ʌ`.}?a	AxuE]W?gbl(	ahʀ1~r sbaaxp^W2fZ1{&{QƼ.9ABɐbĲ<q>{apwfG#rĹcGJFd+ayN]zLBiDN;KP$@HFH/JlpMR)w94TT܋4sC@ub&"֗!TXX/R42	Dk}\jltJj| Ia` f	wn^%L=伡$TO2u3	ղf[<)殷׼gL3fTv
o*Q4PVZ^87Ϛcz,"VzyԆuAHǡ8湢źn>MK($BβDk-_@q4[`~1^+?GT?v}ϻ/o5n]"8ZF4'?HOF-+#gɣS_ϟT*ًDΜ}5$LM[W"J^݃/?y1gw{v:;כ{\N:An] >sYBYx\|e[\|U/Ǹ2_g E qX(xY(FZb\+e
?($O{JǕ
g0A T2BN`XIotӑ>ki 5m4vci /҇r^9pθMy~~-Ǟ;Ҿ9㷾w}i@=!h5MHeTFGC5!K	"Tg;14	?>_|w|>'-xdyqLdvmuƘPʍcYS<v'T{KU2iNݞѩjX_ʾ%R]@̂
a%ղI? ,ݰܴ|XH@F請8ù:c5wE8^4&V́-oV&&ɿE֤B`Xd|Nwz9Ȝ]V{̦L%1:\G2KwGЕ,]xlWʊY᲍Q''J#e]*t$򪣑C7q0rEmdy,X,XAHuMOۛ99vqʄ
%,M̈8Z%y麟;ZCh:FqUȬ84ϔϔš]\hQ@jkP*B/OhcfV)Ҧ0S^<u/G"hIBk$uZ̢uYlҧ%l;J.&8>KPw)#]׹pu3}E;P4!:?VH'~pgJ_5Xm wIEGcj^\+<oYDCUsswqd0 h 