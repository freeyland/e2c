#!/bin/bash

declare -r e2c_version="0.5.0"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" || "$res" = "" ]]
        then
            res="Y"
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443, 33060 and 53 availability check.........................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi

        if lsof -PiTCP:33060 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 33060"
            else
                ports="$ports, 33060"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service(s).\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"
chmod 775 "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] rH(8Pd=y)XUiݚzFd V& IDsalk__@@fUMTK\<<<<<<<qsP{NoKf5ZnvVo4Z`](vB 8tn>d%v$礁9tڝVi..a0Z]o7_NE~~w(8QX?־wrꍆG.fv_k_| ywZ_K^4qKߏN|X=}ɥ_EYwy?`ʆsǏ ,t!Q0:#`A.=d}N8#vczaXjXcz{,^|wƮ,6>f!NFL]oݦmC@78%$z -A8p k N]~tƓh&T	gA0Z}Csa/{5JVk4xn_q0bFZ64=vxǏË7w8T3*޹iK6rXes^76 A1T~naBEȎG?7co{/ȼNbY/؃0܋\IAqWtw箌:JslZقi]\ϑ.-y06+[?GΨx4`*V]Vc|s|4	n1vg#v)L8YtLGC1~q?i8?]<c>܏^Ko;sBߋN8#V+YaݨTݑ rp됧k.6m&mz>١";T$CEv+I4&ӤbPLݡst_&-E٢"[Tdk^Ƞuavo2%07O/HfUj$a*˫aDA"FYǬ;ڶUvcya`"`Ym6tjt4bͧh`z^f\$L0RȺhΰHn-yO/dQH䜹lg;LkOKRYl
ܑV	q0\Kܘ]Нin_aO3iUn+ͷ&Tj9ɣQM5O,$cw/vw^v_~{j/߼xpFK&BL{;7[?+͡{~ȇI+fx7dTl$'2I٘`oko056eYmeZ(:krz=pr ~t	`-9z*pĽʧO̙ʍσ>_MG9Q}%૫JLBt[sQ{Y:9#o"o3 :H|7+,W+r,[˫DuFu)[QxJU꿮~α~ݲnm'š۸RU=_Z|R5ЍĘKC,<sA|0gWtY;'pJoW+PG*2Qx]tZT }j;84Wmpԟ8iQE)$$*K
:쿯jSZeHN-$;Fb*Blti.g?w`5&>vN@	pY_.I<M>[`(8qjnFf skט>Q%H^Ng_nzsrTSNPm%J5w##nE?b$H,]Uh9OWpHK`_'X2A/R=fteCf8@q*A)CueӃ65RTY QA\E@90hIWWǾf*u#Yb*Eȫ*H,NcVIo.~LA*ҦqUGgWBL7B1qB\:P|'U^r]//9F_n k!N7i!`p},(yVo~|S	=MzBܡlwV檣"jwY<(olj^e[{O%Ÿ3HI.4y	瑫|>g"uj­LHBAT9>_W 69T9 MZPkk	9oY6` #4`Γh{g?>AxcwK.X8}Lw3DDß1Љ3 3bn㟸CYԾXaZ52n:uGjxWKIǋ}ݩ^h.կ
qN_h%+˂%_(.+Qq^;EM%YR/;]ãuiirkZYN̟vgOS<M)lgV/϶Dp: ɇYFG=
(%-	~),ʙ`4D^nFsWeE_DanŞ}LTek7Z*Y~a'zote4I#ļs`ԕX]v1VɕP(J_e85P7wzCo>zn"XEY.[jv{?wG5dӐҒV [ui(˜H-oْkix{`ĪS(i<p\9wj;."UXljXڿ7PKG;R6
9$)*ێvmc@cc
̛hAV}uQŌ(NFؿHZBRlY&pa<WdG*_=_Wm >Uю3ǒ#ϾgS	4L5eHv:dPkqPA U5jS Cue>l&^T^tJW IMۯ>s)6ۛb}4<b|#TM#;		Z̕*|Ok)u -YjKȃ!3 1KJoNTіwo{5ӶCkq_&+E@I0qFxK2\A%{bI@%X UL"(G~ {>rNԖcϼ
j.)=^b_8]4x.2̯8"<VYa[.!I<E`S^3SӝѨ0w}8/}6e,9Wr
#-!!,1@"+s}K*.tCe{3҉a[ҒqC,:&W2$%%$`*a)0ˬ+WKKKs)PuouQaa8ZCb(D"`M^H[*mگJ<zD1ZZW&Њ6PuP n.%6gF2$̺Dhi
nR53JSЦd.;"'?e,*+3h*v?x֋bdX]6Ԓ\L7*sNŔQPKf5-Ýn15} }$mWOG'$3	gUyRo	HWd\,BUX 5rZъF̾2mt5ÛLE'uFwKbEr^Gƹn&}1<`L>tcxY\+tr PFCw5DEXԔa8e_:1:\X1[h'y-+9sK4
ŹisY=rs0;=,EZ
>(f@Nj*H
Hr@d%9 MBX+]3=_YA)F]IV?G#'<g@_5RP,HaiD"VbOgWWo^]]U~\iQ\jjɍC_}G͕Ȳ5R'2lﶮ"7>D 9R%5{%ُj|vXw^RU󎓓IWvd|ǞhE//0a[OƎml7[4򹚣Yn4`n6yxfImafc"m
_;2'd#VVFtvZ"G(3JwlZ4Ke_4ޟww[o^zgt\Dy(
ϼ?`F|@#Tg6}@QƧڂf:STˡ>/ <,? P=tЃ:?W=n(J;rj
J~ӠB&Y,HYH^*+t)~&dv4f%܁FDUؕT~ŭdKDg~+@'u^l]P
Ȣ,7 [Xr,XrQF
Yvz
+]YH莃ؕg"$oe);u0Qj^0cL2ι}h
3cdthD+DggԪ*:Aic v8٢.=WT!82*+%khjRQ-)ܟ_]X+,J焹_]+E9Sj_YBҦ'cLcǭq5?0}š̳`4+'Rƙ;4FJIQnZ6`ݡ^:@|JS'N-k&),-[Bnw3Ɂ\qފ6HR̝=BJnNd32"y[/FBLvuvx}~^c$)&tILc4^ 6*0CWKnR&~#,%Y
,jvJpϵeC֭Yu{T*Z1$xFw&_VRT3)ݵ҆_9s:`KdVTOЈz2T RR>2PHRnVX]xs66-	KRWY<WNgG.<r5aҊ86G9I&i/T=OS_OKcsڢwʷYxmKG8i|l;o48Ǟh??E%-sMs~	3 9VzByK&L)q
*q\#o3ڑ2ǹQ.G,/HN<p5h!ϕȔx͖0p B!(_b.$ip))ijA"jD]B	UDDB&D	5aS%@'ϝ'_3 h֚S(Kя_{~NNGߜN=´,qC>#L-7똼3i&n6"2jc/ǣyN+_kTdܰH#!<{OO~[;sB
3zG߮d^$iISӫʯ3ް{R6$CCL&p"h!C&8(KuF[39À$$I
o~|O7DD8G;$}T4Ee=ϐP݈P@3*]	bNpUd M^sHF&LcvP_8=RjrS8>Hb:I\ՒaD:*B\?&LJhXRն7F I_\op3	1^Z4ۅ'yJB
NpE\1Kp%y<CPd7-֜&1Ɯv2ΐ1&	MK$2G$*n^zH?/z#+S> /wXT'a TX `IAx'
=SA-hĔ-E!R
mnj4,|cK\ <hAC%9ki#@΄<RDQn`9"fBL򍁜n``|Q1%-4<`XGG)aGE.Jz~&I~33ܮI/TrLdi+~l4/Eh]D)ȎKJTl0'T/+D)j_29T^2ЌiЯea70tOO4k b(tZQkkeѻHNLD&Vhbu+_>EmST)iDPA0tCh@[2Ԗ%mɀ[I-Q4=F7]yӑ7myӒ7MyӐ77gYD!5
ů.K.K nZd%YAV/~jb6'Mk$wI>q`zruvrJ'I
@h&5II͢IFQznN]A5>	1L˒ؚ%-=ZM,KZh^8⒩XJI%2HݓY7[yv3X?Jk#
|{~zdni+-Jc=լ}ImuBYhbvۼI*䞈5y `͂+y1*eY}hH%@ =˔"PKe*hK
4xWC`lRJ|s\[t)ɘef˫ؙze]F˻>Q><CW啐H&n$>0x58HG\1ߡ*\&axdm	rOSeIfa԰yڛsxKûkv?,"7C
Szދ["^!\܈psOt}Q}!:þSUvoH2|-ͬvɖ*R 3H"ZB;S]k7!	eqz=]=1PĀQr2 GfӚ̽洖tܓUZ@2a,jH#xSkFFuOTia97  
&$H^\,rz{ Jω"5C!4Mè,x-R)PUZ@0z衾A<7t2Wכzr#4C>2p~F'}*jonB7BN~l^^݈Dm{"+!D̵ݩϼo}cؓ/'qE'ҕ3</h7~`<8m]Y?FN>Qr?Fh'J_xp{˼u](D)IĹ+&w^eTjt;łla|{?:hx1䙋hy=7kӀ.к$v?+lId43%GM,"xg6%s?OK(8wzjJv7WK+jQk=h ~0z2:x-1;Weh,'Q5ͧaܦJ8F3{<eM,'a0INnt$8(Vq]*AQtb8843asl1Hff@yoog.ʣNHAGJ6"+AZC'*Ҋp0,3VLjRA`N,WsPT%Y7YThuZZ !VM[!R3^e4<7$*-4VÌ+kM<TRA9TVԪu]qW1_ȼK1'Da.Nlf.fFӟbw\_+Ƭʤw<EVrˀ>	bW7Olu{OqTs#RFK4f}!\6EGU86/)1]U3uza<b+-p5c
$YfN@,!uiϏ7W ))Ţ8UE鼌d+lqrp%ü)9$e)({)ccޝݰ:M9dN=1"d	<Nb2͓_=~;FXS1%Kn}E"
0oм[92`|sDC=tP:2S#&p?Bm<`hv4=a%JBB;d6TZ\ǟNa%'vrp|wNAic9p~I2cD'	,/r 'đ	ؙ$a<W^"W3C^E{vQK?	ȵ7e;"'%ds)z07Mai.WIò'C+ѿІN	bY% clI(|pK+[%|elc]k5CՊrz6A,^y!pLaݛ88wǏj[mnDٶoQ<zBkC[h̊V~PAԊO7NhO	*rkfYM"knR};IRDMH%*fN̫&&" di:1bpb5pi\e(m~]ML&-l3ih,RmJ6E}YW|xTJ?E[;WEp9^aEA8zOsڝ913?Qi&	>?%qc͘fev1vB. ,[B	U<,,jZ!,&}W O@J^J{{;2g j/w w [^FF>'?ָsM0SkSQeZ[6gvaOw7*8zaC|;8ep4oD/<&Bc9aЪץſNt?\UOzgE"r^`<w/[ysT]Xv
Ӑ7s%(C5p``]- b螹 ^g˔:(*Za]2k\Yq(\>8b-g_򱨜G&6Ғ7ka}:*:ð/p:(-Cx0&F)*2Uh'|/'SJYݒ	+38](f٘㶰O[Vf٫fUvX^u4anC٭kI;5-σp@ē1&<дYMu<oP~l3EP0iX>xY#vKZMN`"D02V䃒"k25e~Uu&C@hPoRXb-fx??sC6vg~co5׎Z k<acM]/|JOH[H[P]gNfJ?
WÊ值lu')G^?^ϕ1qrv)DU8=pVId.qqnNusT	َuۓf<R<L2bD0䒯e}U MY:%eJ-r7ә]6p J61LjLIL[(UV/V<VƍbtJzktX2
@Lƚ<2yՒoL5I9xm8ψ`DIlY
@ARjW^oD'M%ES5P4S:wCɪij.h"mUemB9+Up75TxR1R嗍^1)SQm8G|.ʸoYۖoRtf0Ԟea6Zݒ洰sCbL2=5G4`gD) tTpsE.NRr4*fgnT|2w</nק)PXzV[RM֘8dcxq*G*ƄSo*PT!ޅH:e*O)+H3&Zeu]FHf?/7).ϐ@qP&:ZvjzgCݴ%Y@%bϸBJ(3/c]6EP=[ښ|5'f#׉0֦eyQZW0Њ\9[<Ez$0P!q%|a3E$yiSHcj7I"-pDR.xLt@_`t8>3\YJČpCSӼL'kvi7z/bLQT˞t\m|A˖dYcRP47`+ODEkE8/dOȽlҁ<[khYI^LrEP%+,(={)DTRjݦ6@>mWiYLÒ4aOVB¢^͂C@0DLH9r.(TC|W'0.RV>!ICs䀛^eӹR6XI̬8\i _:Yk8yHNBk1$Z$LbF8]ZGaAG]5 13tӲf8#>c@pT#hKDh%E&"Kc9áE/}/5O>+n%ajS)K{Zp G8TRMaPV&TpbdQouy5};ޓ|R5x˰UP(풄Ka(rᣋ]JP&jIY/_]~Gӓ%\jL2~OAlpe)S[\^5)/3[jReقS<͖YHfz͑:m5*ŝ^SSOD!\C0%^x)w842vmA'ЬybKƊWF0>=!vLy|vIW:O&?e+鄙 ˫`cB+udZ-uݼ+G$$$RY";m~R^J5[ 1J]/jFnsRXoŶj*<QzU.EV!/DwK:D7\YM陥<m߼⚍ӢyަwOfuܸ-vMd<*;H
L9A~b5̗[뽴ǵ܀twn:_70*be:a&DE/tn6].֫ESoou;7a]ܴX[ܤwaV[o2,Ri-3eL[9O my?'T
mLIXvB*[1IKa)76N+vۓV+e{^'8n[uYyzL,S#ou]\gjt{7/-*˫&QFoY(FB9Gf<-l8!ծfs+MU_j%##dT3?,&S\9zO2de7m4KE=Sj&O֐K$'(ZdKn36epcWaj#@(aWsOdTvgP%I'%K#l,L&N&%UfDٙ(+µNf<;pBU H_Y˟> RUsI(@ydVb2}vu:%݉}2Zaò6&o	#~W".!񿕪D2NTaT}-$ V='k]eF7wE"NMV	f;ЃY7;*ZS
ZoBbTԵ
BzPČJ1FʧOt@\%kAo5rh]1.OWT\;Mְt>Έ4lpW%2"n"^LmDy[aBj73CvjAeͯ 39,E/*P3˔qSPRbIDWN;S9[=Q J!0-%n]5dФD(&KwF޷GڷMַCҋ3ЦeIȉ:UB4ri칐(y勲xZdtZJ}7>jg6},b2LmZuiI0׌3F_?^IĆޑಏG OQdgѮESTAY7<K_+~Ϟtɀ%m ]zDռovGC戎_
3sg??K8EntGV6nf4^=POn
R 馲ܬ=tٕD	s`rHlʛ-lnt3zALyS[U3}\U
}vt-NL>[ͅQrs@PfKէρbfBUu+7PM

/[Ĉi2Lp%(cրAj/Z138uB=QPj
AUzjyuu,jAqH+nη;o[ /%NT\˫☙z=e]f%j9̝"R[I}y\>,9?U\nO2G7PHQZ=<oQY.G䶌Fd5ݒghyqj0\LLL.^vm<KB0ˊ	(\7kh:>=!/^9=FT0n~_y3|v2f#[NmMRuKCgM>,+ӈD!sw좑G0C!vv^
 (oeٜ-Iņ_YjΒ Fc7OOS^e+@fԖjOo;LG)&Y4&\h4fƬoȷ7c'vX>9ݟ8+㗲8Q@65_GB7,Ya<a+~ӷoPW_֪l7}qy-+- GIyņ9Vk
$I!Bb+?W]a]).w^r$+Zg&؟EТiL63w5m>^lePy}^z7N0xyE=@JhMvOerjVB4_Y0#D<9&F#ƗpDR/ G2 	w9}t!l+UAKt{J&b̵n$PQMiDοC]c{\4/h&Lu{55S
Ebz5y~XR.p0y3{JLH:7' O&n}s-g{%4(XSy| F  M+"Ur :r ]ϵ-sp1!AR1b_8]S57,: o0'sRsol.k$}5*)rMQ0fq0%bӼx๢yehCX7ԹV(x陂/u2s{uRQW0IB+.LGe2/hDG"%ܤi{V20J=|W	,	Eovkt(* (rR6xBHTa&t~?Fokf~i-i c >v#:˙Gv]F
JZyuT8:\j@mP8毯Ո.VCmh5Īk5_P!Q*R'שᨗ/lbt"-	{`\&
pb9@GiD$,4pCk> W/Iϧat4b؆X-{VL@sL`F;
ۤE@rgbSG!**[MFKgz9\f-meX˺ВFY(wrc[|eƷR'
Ӄ3R	;,љ	0Ca4__0,+OB4[Cws^W[cRhHí'oxe6_!?>M~F_jEͯj9QQ%1\]o+uͻMލZ>9[-sg0xsDϠr0ΰd$H**VSD4>3HLΑ/p5"GyIj2E1Ӟv6twFHz
j7N{dCf	[1Vq䁤57?!G82*@tR)6vC˃{,u)\ N,XZ̈́-奬-K4i*d͞\XsDrpӑ; iS߇nc<{:OVRRO'q)쎘mw֙㍈t@
?Oßc)u&W<GxXIb^ N0\><O`@O}c';Qy)Q``f1;"3V;PT^QQ.MR9pLxqL1q+a[p͊SigXwNq+u(ޚFq@u)7OIGgP4T?J#jDI֑FbTbICScl滋O(#ǎz<~'G14+5@@m|ΠVڷȓk;1yzHdaQ=oZ|9o3	jL;x2 I\^=^Ddz:1QŜ'4ϟjAjj/xEKt׽ycdVMx+E.Hg03n3U|g(&3|Ю.kóP)1\u7}pyEp1@ (*K+岈ϻ(mR01B0Y4doKNEdp(0.(5Y06;ݬ#lЌfr0 G~
K'LhzV<뷽݃ڶY$9@-%Y/+u'NЩY-{_qHrةo	b\DlI(ÂaH~A2=eyܨ޲ rf-.
&}	.~r^<!,|C 7W8[Z>+2o+ћ$O݂{JK:{9,*yZkX*JhXE9Tk(+rC}anf)qa\*,O++隃p8qRӓe+,z@ {90\+Ȩy&wmGӬ7eZ4b.	GOG8ne[0}A`:hƴwaz,GzW_=TIq2$Sf=Co&Y]o'TbӠvQoKKZs?AÃ^o2rGv1ppfBRd ދ"XvYC~aEy՞w)n/g^Gvs!WSHPXsV+(±(cy"U͹(t8
E57H?QD!0_y`>9#7>w]aꉃ+ou7KW<`f]|QU|1R$TmGB"sq].0kQa>!~zNwP& "@|,}aYpMo(YgI<_uXފeOGۖ-yZ%>33L}Mw6Nx*fw١E`xճQR."c<dfp}2ȊL&#T lβ}eD'p4~nB	>2'nC֪_0%a
M$E+SF'|,ى9._ZAEYӞ,,'oٖg9XR0'Ә
S5у6=M׉qN8qکS#._"/B7}P q(]AggidP,e9_g8fPz"W#9:/(oMĲ#Oaɱ)lo`6:/q/6VNnXb"0U:F.֛m+.huN۩wXi5un5% rC4P#ڑN..똳kZ{mֽ@y;cqwq 	/kbn?:ZV5JG>|!:FwBa:6tNzZiOA0~.:ruBc#f2#	a%i0aq"w2Ճő^(u
AktI3<od(ID-6Kgz3teNfu|^%SS	;[X-pjHI.u6&@L9vBB/ /fK-i|1)J ߸`Oaʪjt_R	gԗhX0Nr)'Sb="4fKNA6\nN ]:m=EdJ<;Qp	Q@D	t`3Q,g.;^\ܚ:xyr{18\z8"gUPLAwǷoDr 4y7Ky,"$Fl<"7.2}ANw~~$ /NK;92>4h۩c趤Yv?ŅKL*MIMς)Lr!;A(ߏ	DaBoϤ 
xhrl2fjTđC	\Y8ԼuQ^UHڹ I^#fg2~!Mf1|*I}WyDϕ/SoX&a0l"?K}ɲTy!q^P+yMRP:u ^e܉i|<8=z
y_&47sd0fy{,Ҳ;%L|˴)T8j!Kwpi CRalo5i%=Qe@ҍ?>7-tBz<t$+'fɂ3htAn8{ϝ\_i=\Sn?P7j9>[iW?Ma7֮`<Y2w18%r24RF8 ds0=f|FqPm;I#uL)Cէf%{_g-F!݁괺._uNcdZ2A?qdL=o6>pJCNr<^Ǩ/Ã/w?ۭco7n{2p0o"?KK2ֳދ3PN1ӷgվdx#^q=*h5?{?6[/vz$/vY`ο~jOQSiO/([	2ЂO	{_ӤM}7_Wo^e_T\wn04=դrv~~ ὇{͏ozkvSɻ^n%:v=T؀ek~zow^'
V?ww͔a4m%,j4R_}^w'W?d4ߜ&ӷL%S&ʃA&<֜`E%U٬0Ga%uy癢R+v00'k&+lrZ Yowr39~>ZǓmZ[B(\Pm<cJ>PK8cdSC^<ѻ#<<TOIɚ[y9{VIp򼟩s3}~=n
X0͢axXg_$;@]M-6-\g݉Ԓ,/()ٖd-7)`xPlّw,Fe1,sGV/MNKMaG4%-[OK*A3d_zJf8MYFY7ƽwKA,i-	6m33+9~ukhwbS Fu⚓J5ʐLd2mk3:FɮkpTjz{(]aEMm3yLkY"׼5TIȊߴZ6cǇUrq]k#'a{>)Z^s%Q[$,@7Oi+\,jet{N.B"w'!!S;<	?Zɛy5c]oSo¿k7i
/4WGRzԍ駫^:O1yunyN'>^@Ozׯ<]73|J؍9{ϭ{}L{RoAz3=GB%Hpʹ7O{C%O3f㌬kThz@W)+=__
oA0vJ T
}6"!ކБB6`x30{M6 8|GGc~Di;i}G &{x|LhmnSj&[a+zx0clwǐ<
8^jxj7WS;9M_OIL}ިǅbV+$8ӋZtvWmepGIYCh <5adcD}

FUkҎѨU8`1YcLoKkEw'_ZӞz}".ZmƬcg=j-sJ7(	4Y%]]VBm(#-nFwyck3nΑ)MZB]ZM \hvʩX;)XIkѺB!S, Uq)4&aɝ7elnm<KY:qr5SYjl|qzI1aK 퍀b"lL	4A[ߝ]NrgYCg25iȃ Ll94XJsG䞈Z:@틯̝yYq0P(k&EnP(8	zl!TF+7iguK)*((҃5~Dq+tzN8g2"4KD1A\1	z]2٧aQ#k,Yk5ylR_x`cA)tTͬ_̎D0ݑ	2#'5!?0?`DXG~Ua{ܫ<TRP*|]SI"X;&R,wfzN\ΪнE{phCvaնaiv^k]{. nt:xʳfcî7[?_le"Sg_͑yX<uafg^oO>	6*!ښ(@WZWgiE?g7|FKdPB߲.AhحgFղѶ۝5^-bvZb gݶ|j٭6blXkZ+#un7;MPl-ձ5awVjZTmLK<uv	j7m8d[ t}zW>AakD'hA9 ҵ溽6B(:6>64hpkmZvݲ{ԩ)xY@FA-l!]dj)^j(evB9C	tEv6,@z	{kmp/8 "|nYZhzqn]ѱA`ݎ݂,:])؄ ڵ:׀m|ڀ$Uw.e/
@m˧f-V7d0pT5X	xo.Tޖֱ/`l_hYn<yqSAcMԨ3|z64I}ӨC_@kV9cow!m՛&k:H]7:@n7֚@з,mHٜF¾ꆁq?df)(E-7O:|J2RtPbyPSyeJGL2ho/b@5XjyHsAoE[ठb>1g{5@aO|_Դ\a0ྰ*}M>q'	W,-w?dGԳUp5GړPCֵ/9|\uv6O󎮇ti	#X2+qD
v X^Ҿ%)b9>\]WV'yضU&<Εx8\te^>D:cs$&8]&S'C~=v1J甹k9$#s^慶ʹ"YdsZ=^FS(+_f$ՅLH;[VX
|6ad3qTc~4|ry%F;aMǫ2;VWw+7'
*e/]RgL_G?7_Fw@:JHsqJz~y߽c0M"df
:	EUNنi!cdhWqKHzx+̴l$Lr}#cLL'_I0R>m͘ʄN&~AQg#:(_<!wm*Wل_) Q8JǑE7x,did]Q9(32SЍlT_x[nhPŽ]ROJF<BPF04sj	S4LRA \IwyuJjUx\8
1(mf_	:^d_!7sYC.eN26v&)lTZ`Glctjؼ`3{w?n_7Υ7YيB4V w
,c*BM)Ɖ>GƛWY,c*Ry<)(B'ٰW*ڛ#M*ĸ#c Qizi?cHy_C$'{EH"26phlLMZoI-/g:11Vc|M=!S8nCeJu	`2v^^}w7tFȰ2NA)mSn~t;"HU9A˅CAS֘$3W $4`,9+A̪S7xip򢯀ceOiF?ta1ʗw^=c^1Fpǹ1dD5͹TU"`WWӲUw8Hڴ /cu	{";j_ݤd~MN
ZcUJbRNʻMJ~$z&G!&t%a8cP$(LLi򧄟Dr+?=U朊EF4bcc1y襤jlZ++px
-6qN Hӓ;J̖fMwй`XcY	W͔F5=?毈14Y=mk_^HGM<6F*U	;L-,>#Ny#YE/*Ib-NjAWEx CO	#]i d7գLrۜ(GeE	"&9 2h4]`(% s#gPy~;?pvpϧNt*j4Y
Q'!-"96$%r	(1+pD22<v.;w"1eArfFR|A K	P%O_es*(KJ]͋;M"^cjջuRvZ9s3(/͜ᐂuIV-N"D1.{N o6c'n߹\~)@OtK
gh(
;~^9޼?yŬP9*PPk~uC5k1GH=k%2>gˌrrmo!^ٿ!f{>{	Ċ}.43h@JZgof1CW].0YEedjTAIMB	]i5jfbA8!nS$FUn$GkNb(b !,&^(%j)ezME'a+1l?A?H$K%]%L!q RBg
8TX>γ~>%ʂY7
W&)6Ӡt=&k ] zhܕ ?:a67OSNey'0-=h"MָJʪ2jXZ}#|Rgss4ry-x^jf	%=c3ߒ>siYpV)'9-l6
N%LS *&wCPD6:Lލ? b96!uA8z$aRUnP@M%`P;q0rQӅ k86Ym<ld	3
[(#Pމk"K4ʴsrC!X5;pEӣJu/~=mBA&>->y |pɎ0wewv'n/DDz3ttˤK93
Lt^43E`
Ǯ$R2	
"m	z0x_(t݋TmcҋwhQ~ҠSKmn*L3+9N6±@UjZm/ τsφ0Zw9,f\QC`ԋ&|ܚê,Ό俹Yk_0;wby5hUPkUt5x)TC~w־}Y
FgnXjRY~F-^58Ԩ̥3ll  2zLɚBZۨ͜.N`b2:sudgPy&R,3S<vgK?3*p?Nܞ<Oc4$!RK&Պh4^
p!4х?`7Wcbrɔ-d5!f@Z1EKN<xh ;jGҪq}>xmG;vBW?kG_,j&;)߬q0dt^mffLުB}VzZIQ#t]2h0{be -v//+	!ڴ&GEi%Vġ3aJS?$Gzydۥ8N%޵rItF1C}q4`)M*bD$u(`[`6E}>twn_ m$ԽP1@0DwomvNkjr_ē\G` `N´2r$<Bm%(_8^7oԦfo	̣Ў|[!M99adşUr6W*Qm>2J,%z?hX<S(uzU'ES%	>пb;l[gh-ܡ2C<) D Zx!M}v3Jhrsb㔌zr9[f!5<n5A^F!A(V$#j4:N_Avϙ_ă@8℥Ȃ@ͻƋ$ISeN
cߍUuAJM8YR4(T6M[áE8Lmw\M)yN(S+(<EЀ3;,{s8ZF_֔>ceyM'(?zIp(Ob %̅:x%
`|.@KK`r2$Pz9;xu9/y
K2 #?P
Eؼ$% .Ei8ܩZ}y-"=8WH"d8H%V*0W]gmV㋉F5XTʦ䫉mfNzzdi~aèfNxB^`]gSy5-HRܧ"ՕPY3oRWoޗ/nE'&QǬuttnGt_(F?x֋ޟww[o1TA;Zг+v5c<[х{mޏ;⿹:N}Wwtb~|NiJvțf-LP-*0 ۏfVM&_,b'hW;ɬA1"<a!Z#ňe9Oy8I=G}*1璏Gd/ǎŊrk_fbnI>&m(?qCI34S}p/Il? )ډO	c_FBSW30u*{҈V{b-UŃe"DpkCn^F!筎MQ$TI2u	cٴf[A>)׼R3f7`JfYx(US}+p-^Iogӷ"BkvTLm_&ht
֘ ;-6N(0|ۨonY8F*zIm*tV$_`|+,!cJzW󭆁7Zwr_/	?@.fbxÓ$CxKC,ˣâǒ_K?<cGˎwL^Ct/
^${;_9Hpkun6F^s'׻Cj{>@*/\n]E4<.]k0yfO%JC%%xrf˥ٯIuIv'Nwd$5S^ Әz	,L/˥9n02SSn3 d	oz32êܖinpazKm\,>j1 ;` $R"\\0XeC\Z6xGn]:BVK-0+y W0jeY;R焮b(ɽ!tHƁǂG\ϤPYEAfsnh	Jŷ7@2%eAYn>@F]Z8DNUtΣ=/Ja.E@ٴ*,x XhM%gwU 0M(@(dM|{!d;ۢ#dk%G!ٿլQ!'3vz7-5{g?]Ծf#A]]O1|YVR(-FO+u>aVta2\ebY@<h`E8HnS&rFѼ	_ Xĸ2}(z*C)p616#@hoM`O-F_dY62CC}j2[!fd|	Aw9OOK`\{pagGUfX
CP0R8GN#oPλo!+6F7U3.>kI 	~S!Z+Cb<X%HI$N\9J]湼I\ [*p vxu}nḒaexfUe4>*mӱ"}8L/?{{^%lsU5:b̛׏17xۦmڦmo/i"N r 