#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 Qc] vƲ x^"]7Y)Z%(Ijq:e
$U)Zd~yzzy5kΗLDd&	$PU$E{X%2222222WXvzhuXv:7vX3E,@9ݑz qI9䲱h9i`MvݾG~6X~wZ}E۸wrQ_}E?g |g0?<4ps>_^S-[fz@J	E?$k=hD~W}ɥ_eyoվzvE0c_ٹLΈxX(i d+ر7v7=yq"7<sÈŧ^DiG1.;ry|v}( dBޮūq0=;|g+ߴ51Ap2dz 6̸5J&O)!h9¡7v0g4X#pm|p23E3D8;؍(rG"
)YZMkd|u:no6]\#ؙ?/UOxZ}7T޹igSK9ѨCB0~OϘg*?V1!pxw#\idW_͟ޱ7t`нsd^P'1B,×QmaWEE.4Π8J
߫_sWFp~[uhw{^??+9rJ;' 88rWM4d\V=l߶aMqvasG8`oĢ`61?b+*1#ŬY9*;
v愾p:GUvʪYeSc'a:Pӳ7 O^=ۥۦ-ۤ*;} a]*KEvHj.WdiQ1-*EŴ\Cȋ'MnScY kSm*MEA:nu07LHfk5j$ga+kQZ ZYǬ;ڶUvٟUU:
GATQ&gݶ=񘵞5pyY˛q]3LKZ 늣y8"2=D!sﳝ? V0ү>Iϻ/KfL>@6fM)pG򻖮VE$$s/9rcvNBwVe=~`=ͤUsM4:R	$vF57<Dꮏ ٳ7~`prۃ~Pm~ৃ7Z5b>:)j.1;,V1XAdy: rmQCj.L틵WDL˹)ԣW'W?}`Wn|6ϑR-.^]Ukf
2u)s؅]x gIE s挽H̀_WB5TA ɮ|^e(\]69o[ֿmXÓz_xk^)jڵopR[G+|KS,<s|0E;'̕q=oWC}@}Dѻe%@gE%	RY& z9L6ǃըaPBk}M#7n7Z%l 46.2tY^.W>IjO`-&>qN`P/W٤Ċ$a0rk[g9Xu?|7#iC9VVkBU+E#@/'/v_^mܹ}A9j)PmdJ%+ߙ.pr:OA0%j,F$K45&PQ7颇8i	ѻ+>a O|"#ͦ(RUf<iF P<TVW>}A*)k
*)Ga{uU-[[7Yc_.jɲJ |/)߉>bc̪ %/`΄@i\,YSfL`5"+6#\`擄KN%˭AX~-0)6-Eq?+Oo
×y_:<	{[~WȞ;"v+/\RP_^4g͹"?lv^7r退}Ʌc/<\$FYy9c?]%¤&t*@Af̙pv`ߦ*C6'?^jb"!`R7`縚*j$:AF,AiY\|No0]p(r, tTH	Sg8feS?qGv5}sjf>eܖu++h*Iƛǋ}ݩ^h.կ
LpN_h%Ƃ~$_(.+aq^;EM%YR/;]uiirkV]I̟bvgOSM)l{ϐ_ml3\l2!A!QKRY3Gx.K
2(忈?'S.^` ,kM\+	R_+;͛|/K୏L!'kbj|_BQ*#ǁNf>Ȭy֫tov֋p*rjT|;a>%k,̰IWLުcLCyXDmcȖ\Kóе#VBQMلRȹ{T,tq; e^_1z5%40X̿iZ]:ݱG
*\n;>n#]3 F?=+o2ͯmHv%Svr(fDqu:E҂$hrfgj4S"[7:WPO_zfovD1v>)JH	e )D2C׉%M]J-TcB3o! n`,J	{)]$5m[[	OfdazloE
P5`2,L$'Rj1WZ4Hۘd7-eS@Z>9m+f?ñC 3g8b+JoNTіwo{5ӶCkq_&+E@I0uFdەd?. =ui,
I*&cf#?=;'jxg^^p{dk+J&C|cV#M37ˬ+N$UV|ؖKHϢZQ)ƔW02)Gng<.̝0f"'.KM3c& uHK@HnK'ƧJ4݂6P]ڜtb+Z2n$U'f*T$DQLR%L9z5 xeJ|)p|)0|){bw!0鯭43,Ab\LE2\x;Ӄ|i+V#-C5KLIטG/(FK+:DBZ
e6Hv[Hwv4YMW@ٹfNIaj4e'^䧌R`'%{?SÔzQl͘LܞKKfZiQF~_B1guЩ2
~ɿެº4UP3q-ƂYSwtT$:f^"a_*OVB#ʚlUXHT*WFW+2ZWfCR5#r3$
~ľp]![XUydFf1H#7vmеBw Yt;rQQKy]K5b1B@-uҝײ^0Dz_ɮ{<@(_k0i)RQ"L6rV۸YPG9R:QmXlĪح^]:*l	r:N)0JZI_&?	Nܐ`%ĝ>jj@RtfI
K[`&_;G O|d>bx
0ƗDZNNJjTTK>z[8jD]4ܬZf=^uYɹ,N/٫Q~X}՚ZwKZNOg4LF5$y7~:qlcۢY/ͦv[sɣ5KZn$s9mP7ؑ1<!Ъ4USEKsx(ݫ[-KG*~F37o,t=;{l=x=?;Wsi$*K??1jBxAdPBso<`<GeLjV{OQF4.G^DKrJ(>^h1h]CVkdX=n(J;drZ7J~ӠB&Y,HYH^*+t)~&dv4f%{FDUtoT~ŭd3D[~+@'u^l]P
Ȣ, [X=,XrQF^et*w\YHNؕ!$oM&;u0Qhj^0`L1ι}h3cdt}ND+iDfԪ:AQc v8ٲ.=~WT!$1tv*+%h^RQ-)ܟٿбVXع_3+y~ f|A{~w*NMee	YKkYF2b98} }KD?2ܑ74TrBr?Tl P:q8 y \#7IAiނr_Mʌ&VLGbVtt*'kA&.'''|a1`E"#I1y_Kzd"tДUWNi9=2]e(wr7q:ȯ@qf-I=ѐjP`QeVk~EP/(,75n7̒ SRi:	 h60xeʟ<-NEnM6yDO;_"Z~Z/FԓEBvFv18*?Cbuq^1L,ni%.I.XD9"d6J94I+L,H$faP<O~=Aj,m/gSH.j^ϑj>*H3-)v1{"}dj)7% L(7ԪZ	G-!2x+`dqя\iGʤF 6:$kՠQNLV<W"S5_¥FdWy~廄ΐåTQPZ	u	%HT1jeS`$ԄΓ <Gv:۟Nx F#
ZkRO.,UF?-S˛~~;9?ޗ_|s:Ӳt}5N@ӴܴFcr{&OgFK84ۄnʨOhh9wHnISIFr"ͻG?7]	)&i<-zi&M]*m_Hs&^y\x}ɆSE+q*u9N#!)#C>LpȻQ W匶fةs;\I*A87k;̉pP=wD41tiR3'I5Ix(mD(-z8(njGg2ۦzDQF	Q[$N#EXv]zoYS?f1;	(Ȍ/)P9ҝQRNF\&Gl1HFϤ
NnjIL
"i_Y!MP&%4,Oj[#I7ǙTJ߄Dr/-猽\%MhSQ\".M$`ʒ~!K(7,֜&1Ɯv:ɐ1&	MK$2G$*n^zH?/z#+St//wXTga TX z`IAx'
=SA-h̔&E!R
maj4,|cK\ <hAC%G9ki#@Δ|QDQn`9"BL򍁜n``|Q1%-,<`XGG)aAE.Jz~&I~73ܮI/TrLtY+~zk4/Eh]D)ȎKJTl0'T/+D)j_29T^2ЌiУi71rOtOO41J*`bT+XLi"0cl'O:Aӣ#凟iF.3=(Wr5Dl|m4!YZv[jQm4
JwCߞߎD2$UX:+:nz+o:-oZ)o?e-YB +H!oH!oHf-k:dYAREJz;讙$dLn#[Oz]'k'w$ ZIyVQ$I(I#I0'y ɺ~L9`Ge?pK\ ў'qs&CR%&-vG/MhTK,MYp~,tuD;呫|95ZF[=G?;Pk\!is4|M%ھjEZό>f$_j}Ĳ c{<31mީ$D`bNZ<<3yaDAҕXt:견>4B*=+*PKre*h:
2xVC`nlRKpN\;r)Xef˫kze]FC>Q<\@W啐H&Qn$>0Jm-4	.8H_}-CUL|54]J%Q^i.2ef.5+?,d70`x*LNwK޷{/nxXr{s#=EV'NIW!jk7ڹ'[TJC4+Li	J7K	Vteì݄$t-rЖ@ˑ\xMkN2ZFqOTiIȠ9ꞗ 4MCSO]fE=aPUBUX(dp˛DF#y{s-9	*- $i<^8Ұ7!rH@}O0Tifsddhb\_]oUZ4x	H`ZsP61ઽ>BJWP fK	2mGyyixw#QEҎ
0׊w>;bOM˟IW/nb
t?Og/Z.-lwee3X\EͩQn{?(W=(}'+v0Iצ$_0oJ!2Ug,f.Kߋq0Cyn\43.X^K}t̆%1dK&U)y4l$Wue=.s~"ב,4jW5ڐ./ܰ۽ɾn]Z]W5ZAC7 1il/7!h*Cc9i1Sf?LS^>LaB?uި
dͪy[0M$'իܠ*gȥYkPM'G-Řq^ĽQķow,*Br8C G)لڋ ?0Kx4'Tԥ悦iY9hKop]ɴD7@BN6Wy<Be.5hynU'T
Zi$9-W*Em/Bg?BэnbUc%,b^ˋybN^\Tc<]̸>|[1r,ɡe1bF3FyI{7xDÖK}4oY7M$rd=]OE* e!LjpΪx|AOb6k\DjYbb~1c:PǐUK.r],in|R,SŸ8	N˸ց'>r*)N_@RGR=][Ӕ<tm>qajCd-ƨl~9<~t9iXS1Kn𚻎z57譋f̭Gl0P8(~MEmSTt|XXHx@KQe4FMDEp%!U]2`v9ÖetEu,8dx d54_z}:;S~KkMx;gct@[cpCUX8ZV2ر'UͼCzb,L<TᱛK3MXKR!Mu4ǮϦH!;raAJ~iTdAg,XV\	J!Kf-{)}[0o~Hd+G̋[ץ6
y+iu;)F&Vp$voJ GyBe~1xuUQ.ԏr+1u<G\og(Afº13?5xQi&_o=?%Qh̍y]t˹(˖AXzg2< 	#8hl,,MYǎ2jUrx L5=Poy9CM_-`ο}fX^6w:~4.{#H3Quzu L_1gv0Ч;o@?\mVۇ$zƩ8u`A	UVN$ { wkOJQ$rpAM(>3*0Xk\>
l9]}SN*xn8yC;t-:d0\2\	f!Y "@tߚ%Cߕ:8*Z#n]2Xyb8z\><bd_6G#6Ғ͗}0>_UyȁaXޤ\b?w#). ,a1eM+PTdK@q<v3%ACgxTd1ǭtB7Wmz;zY6['lk⭓&˷k}:stē1
:$ߒ<дYMu脖oP~l3CP0iX>xnf^aeB%i5
)ZO5mEƯdj_-L#ЙР$
":Db- x?7=	VkGf-5oQgl)c局oT	cݥ |(26ҏ&[`<y1@C-5HTg2nt2)⨿&G!T0Q-鏌OT0.PT{sט|꬐(N v<qa%㓐)gCkƇq2emx֬Yij`2-)k=ȮLg&Yµ*Ƥ3;S0a$ӪJU˅-|]No<HPweIF	YC\X%M+Ռxf gDP0Ht"=߀e8)N )5]RaMVIԦ)ivjG1Ֆ1;i2{ΓU\	EV=۪j˴ۄ8N1G*
&k$+
g__qB2jn-+&u[ss娀E<k@]:ސvyd49ӥ9-e95U#PՏqG+nr06ܜ`ن.T.\%F_l\N-XCCq*+ogp<]i/d9lvCf1"zHFS~jT2ƾ3X,@iBRW.D)+T}Jq^/:klTo>eFvJy$&tiN._3y=bϸBJ(s#@c]6EP=܁cښ¸
l:r ,/JÀ˕3_A
#J	"|?XSǼK)61ƫ[5$F~")O?Ukg燡/0Ltd.,%SƯ){ANکzڅRi/ٓu4Sf{=SK"rb&qWϨcOvi6eXÌ,j	dN[	_E<u'f!ƹR)=OpӁ5lKj!xlEe=E'm{=39"A_"qRWKu
B ]6H%qΞЭFE?+s8ar	BPN`\L;B	C`;:̰P3kS$Yq1`p=SL?.v7a;,D9bEIIčp,@f.@cRg>uecJѣ:&;G5*KWQ$T)B5,4O~t>y@ hEexYqڋM`/yZAVLbR.cYqxzSIJi%i[A_H-ExOIըU/VAi#K/%Ʊ,vvGCbOpHf~uqN.GG$"^
s1˔]JV<m65I/yx1goqyoL@lKV#eN,[j,[f.G=׬wR樷z-MM%>3I \x}U@qGĴ;-`@#/O^bgi" P1Y5&]-xC?< 5.bgSf,G,a@}
f)Ej&Ŧ/
|sԯ Je4(YLKy*ndd.+*90hjv6?-no~+TS5Wyd7Btd_Lt̕մːY*S߆ 8-rm:"3`V]w,"_4D"}anS'faI!Q,0_|K{\Owiּ{ҥxӞ"V9fJaB]HHY9frZ4~VxsօkMua޺Mz7kq޸v)m1zͼMh٢}5t(s`/x~ |!>6Pphc{~eMMZTxfBERيюHZK	 ueq2\'iT:X,C7%)n(p]ܪ;crꠗpuc@D,ڞĖ8S>mԥȠļy1[keM4(-Hhcь-gvS'3Uqr%	Sf4bd0w,Җ*tnr~+pZ/IQCfȾGtJ9ޣ8#y~!ELM8lPgx6qU66": x5WɁgUm~UDq(_	FɤldRRQM?-l@^`_BI9-\dӢ!M!'$ZD#OĪ55"G&kl5&cOgWWo^a(_ݝ'#Uf9,kcQ=022|ͱq%R:[ikH=.ㄋMe,AתKb5sa'5QfyS|W k(АlfN^ıs^LA͎ʠ{V!A/um7䍼@|^'CPg6W/pF[6BWqL 5S_bN51Gsb :kB+f"f!ӦnVb,L{eߘAH9frY^T>6)E%#Ē6/
04I)7vrB<T#a4B~;raB4AK,3kpI}YRM2_ooo'gM˒x#$hhaMs)!eٴ̒Ƶn|ZūTm>IY.keRie˙$ҴU=0׌e.9ۑ'Ȳ PX#顮S?cis09 SnxпW#L=ݒK.]3kUsm p%Gg Q=yO)p,:p1ͭ6liXu7q പ>FZ0gM#V$6hvE6HA ݼzy>~GG>;VK
j&T{-9Ap (3S@@E3yQՅϦ&RDs~bĴ`rMnGJk ִ-V]:!\~ uDQ6*=рdZNfqHnη;o[{z[.%SF\+k’z=eMQf5j̝RۄIM\2,99U\nO2VG7P0QZ=<oQY.G䶌pFd5ݒ7yYj0\L4L^v;B0Ɋ	(\7k*y4f]Khq</cjtM#xknM
i79[:|i;P+?^Õ}6%ڱD$njUG!+txG@C!
vv^
 (ouŜ-IF&_Yϲlt6;tYeQ9UfSNJhQm
d=̄Kn
Bϸ2pє2}Eќ"W"ܻ,,sZF/)A_q )l
=BU}m2I0eC*KDӄ\=xҭHͯf^SoE)0oY 8J+6<>1:h(!"IAr +$t~%:kbEqajA`.Cz,I3]r,մEym{jB3ywY8Sw{.O1j6١bC?Qޯ:ɓq[
@Є~MgH12|[IԌpHc6;e&R炀/ G6 	wI}t!l/ѕAKt{Fb̵	7~D,"ࡋ3fix4y=OM)EN$Qxњd?TT9:6ܮhŞj.f*繉[<u|^_2
VtoEx=@>H,EH|t7N002`s-K\*LzP|8	FlGfU];G m(9%M;x;[% I_D-JJe\Ԅ9ir}9/Xm4/jkdlQҢ4!huyP\:Z۹SԺJh}+$|L^#2b4CnҴRýH_/|e^tƫӜp7c;ǌʀ5:Z \kJHTez$*0w:5Fni4	EwX\[L#.R#P%	-GR:H*tPޏfGyh5[j\jDp_R!H6b/Ր(Dϓgp L1Slb1:E0n@QԧZt"RuՀ\uto䗤˂0P|h9s lJzyXE+[M& l.܆|0S[c;VmQ"G!3ѩX-Fx͢Kw٥3˿N/J^,]hɌkP,_;T>2[)xs)HLC{gdsp bVՕ|^!Ѽh(m4V-DeؓP#wkD<2˰rsX_&O?c	NCWbh(y9FՇrF-_Dלi3	riTFTgPta|VMOBgT|}[t̩+]6$<Z]5"`ePg;etMS{A={sGHͮHRĽx2O-8@RQW+]ZRGH G:)xt`m;!>yL gMVֆNdJsKy)khu M
i5W4-!ctAgaNj:á;It`\x5#p|5Auxco<)/Gcϑ*{>Eژ/׽03aGCF\$>1>bg^}'^|:; ꁂo<9S ԥy*w;.i:=v%#Lz{n]qw&?I"ϩqP2/IY4
_GIX`zCפt7NCy#,T?r=FdMh,6I5./<t5.r쨟GrVS8Z+Y',j٫}<߶g^ṵjOո6;#
ڌG %CkDcU̹qBvΚ}dIO7vN6oДڈGx.Pltc<<s%Xigx|o2	ڌڊ><15yJg]
4	:R.h&!I-n3WMXL΀[$HgiX/yA^sϙh˺Dio&CrDQMɨ|BdfGe3~~=o˘F4ߒ]r\wDQ)=ղ'i$c\<Qm	eX0!ɯ01QG=5[d\4E To!:a\Oη/ETo
5#Cg%>b5P4z\|cCii/\%dbKE)^mk~h]֗<eEn(y  LWm"r,%N"v@9[~}%1_sG?N }~zrQ{1ao( W#˗ FKwUT-xys]R˓fQx%!ŵ1~)'mu35/^ZGZ~ܘPq.]Q/H_;ګ#V6bdJ"~h>u#KJlQ.b2/5^@S>8x&#~1Omq\a&tиH1(,E6(YHjKo0`lVwPy7bbrfh}pn>r5T
9g"2Vָ-!]͜;"ApR{y^sd;0GD:;rs8Vwt3	flՋUx,EBEv:$];7[tg l*Qk	Ϣ_?.~掲uB9xMP:存^*|:RܶhIKT*2oO8̰33!-4;'Chb݁fۗt#FQ׏%>$+꓁3Q݃5aP=("G%',ē~ gvBpZ㻡XqP4&;*4unoLy6od'i =eM{ʲG&Ke[`I,bNNENJ4e'ƅ;"ʏjgV맮3Okkːq0)~@	4ĕtU67lgQ(B9@$'~фA6[\%j輠D?D%@L6#=i3.J&rFh1H;ٸjr8ĭڬZ-:ah4.^~kVt֛Jb@9\}(HɎKH~ Rpu,vgY]\jSPǢv;vy?L_.G)~{Vqk\z}Rym;b!`N~ʛ)^Eb?ECҜ:TaY=bV48;BiHMb/:`Ru\7v2G%FB3|OvOsVa3:>us/	Ȇ\%ICϝI-BXc5bNqk\ RWO#! ӫ:sË9)!iRK_L6	7nhq0cXV"ԘCYUK*LeT8SיZ}m^VIy25-6BЛhe5ߥQ>OѓZDHpS(3Țj l@ґ(Fh0>s~rrfi$ŵ66nˋ4`rEõ񙂴_m<ak޾,DHimn쇊,"4l+FT Vӆ`6D '8 ?!ϝw4ʮ1goR,Y
*ho'#w`
dķ	O t7lmΌhw.eQsh/P$3,F$C^3:̮ڿ:qPol%@5^Wn*,H@ohlҤٙN_~4c<줅YF>EtRUǥ(HFo'`;if8{RzGAU ;s6Rߵ~\JxG^rN"nW;wiZ O>'xO#`A)A}BrW?˄7T#j]\b7fUvZ䛨mON"f$W _+0HS-cWg´'
HQ4-g:r`hA/. d$O4p3Ypom7v4]\_i>\SnJP[4[o;>[iW?Mi7ׯ`<3wF8%r3IRF8*dsG2}!gaGqPTn;IuL)(f%_-v~U:k}#в.yAK0[;[{?mZ={C3Vc!~(b:O%+鿗1@`]y#v]F5z{+!yTdg/!۽}g4{GdYf>@/<(p?8ޘWwg Z||o^=v;}ׇov^m,yyr߾~QSy/([	2ЂO	{_ӤM}7^Wo^e_T\_vn04=դߦ9IFzӛRn=li7<wFZ0
M֦?s_D
ۃJ?|kk+f35{(7wrӮ_NO-(g2?}[$(Y`P?8e<Nd)&QnZ_e ͊/sVXRכ[|).Ei
/X{ǿ[ۭߝ\sҌq_tv@۴@:G`tDa
r`ok?v4}j	yH6FE{;~*Pˍ:aQ1=kIHxZH̘䙙EYgKw.87C݃g;ׯ<jYFG(>EBzԥDk؝H-ɂ9]~NnmI~BˉlԏHٝ{G<ʨI-GeAH
ii\9xGyVɲ=⩢9n;ca=k'.DoӸbKFdZ=jjcDM;pFJ?%uk.{5[kɵ 7غ~=PBDI+C3~ɖT]^s)4vɷ^syL׹W=ˮ_R1!r-PKXPmMm?q|H*5_[.nv{EDd4,c'3etCZ˗4˔y}J?9ju\t@\oNuN7orkt>+>/~Ǚ{y܅2o!C03:Jkÿ9A(B3m|
!.z~.:O}d{7ד>^Zy? H'WV댞z2qcG~sk*>^<v՞%#r~sQ誒D	\zEӢG8c+|A#7UJ!`ϸؗ¯] o?qq=BM8H?2?a0rd((](c(:v&bM?6lfoQQN@ZF>A!>02hG1)ڻV٪^6L E1i/8&׿Y<*MuNNcy3=7qa2*	|q2~u{nQWo֑9m;O-٘x!|XEL	Lix_nup
H
~]g.Lǘx;v|-{"=ad~zh=v674@ǚnJXWBu:e%4֜"z08"z&=oLo}Nnp$d)CbK4v|n?6wJhjkE<^IцB;mB Y RL'))~MF;;o4y10\u0&kbO,8㱉Ni4JzYΣv^;A*XƥEL	hÀ{OA&;oMz potk҈=n@rhu܉R0<3*h=t_OW +;M	`
$QL>ݠqp<&BΩvn$1j>RTPQkf!V茼Lk##/peE ۍhXbš BgJabJ,?doѣGYnfDy	r=32F[&騚[`cdE#%GOB`R˛0?pL!XG~Ue{ܯ>PRP*|]SI*XU
Z,wfzN\ΪҽE{hdCvQݱaiN^ow;{zsC@ڭgcjݐO23TċAׅZ{9$`lw~p ]i])"Jߌ9-icB	}nv{}i7~] 쨶it͎[zwl۽6۰u`N8uSsnwm汵n7zյq=Ұv۲ u [mvn۽Ɔn@ZUe: SSOA:-0ٻ `ѓOPuF  zǆDk^>F(>%hFjFmc۠- gy7.oV݃&PKa@RCo({l[A(wPx#y赀zHQΦht`!atooG@ϝu]o[6i6Ng5w 
v^nCa-|}lAb} zʅk>=$MUwe/.
@?ސOc[?i,F;Qd9zP:z[^5Ce-M=~ܒOF>WӁFoX<yqn=Ͷ-XO5]tFذ-XJWc.,mHF¾憁q?df)(ME-7O:bJ2RtTbyPSyeJGL22io/b@5XjyIsAoE[ठbF>1g{u@_aO|_Դ\Q00}M>qg	j,؟[-w?bGԳUp5Gړ:PCֵ/9|4\uweWal4;;|ED
,ưeV#҉HmUCV59 6}a+JbSls7O}Ҩ]ryO3 okw['*IyD,7rDW|0u,vINM{qNyF?)M0?H#>|ȟbh镼1|+)ss\IF#ȩH.
mwsUȰ2wg<PW*I%0v|6a3qlcA4|ٟry+J]w`We8w4߭2_K-W@)_Ґ_4Ot+}NHG	i;N	=aFO1wfiĜ̬ҼZW'!hea)( d|aM}*]:tt	IV<}vCY-ÛsioD$x^+	CʧMcSYIOx2?pzlY勇5<?_wdëU6"j$! *H1qtAm5Y>%YYWiGy%u5̫̔1t8^WZT?p?zqj+
IIH:gA8(dUYa\HS?C_t.0V-aI
1h0rUT6i]"XZ9G!M+AWǋxN=k%̉>@q&np9CjM_.LH{_>Fu6,_}so6U|8\z3z)((Jc
Q.4bQ`)iyRe}V./93wXjM%
~S{sO%wlD=Rg`Uޑބ[*)uYD^^*(;Es,a-odYv%Ѿ9coPz~ 73V 73)5TF_DNxỊ	"7v'Sd8콼O,n].&a/!-{exR2MoY7	wwEx)Rݫr2%Q$q(cIf. HiVYrʡٛ,'5)\*F7o3a&%jwD_	 Ʈ˞tgfgbP/U)Wz>qcj2ᎳPj/+,ZPeD֯e)9>s9AUW0 ]=utnRFA2LCfS}
%15)SxCfl&տ~5?~]FmbpR m`BWj3&}HrA,Fk|JI$2ʁZu(/6dn_"?~n)yꥤjnZ++px
-vhf %ӓ;N̖fMW?pй`X`l>ʕY	Ĕ[F5}?毊1,Y#m_g^HH96ͱf*Uk;L->NycYe/ƪIb,aAWv CO÷]i d÷Lrۜ(eE)n"&V8 1hU4]d(% s#gНy~;1?MvpϧNt*R3Yv
Q'!o"96%%r	(1+pD2;v.;w"1eU 
9R3N3VI LGPqc%%.шvh<baϙ㍝ewh{M2D$hq$2,jA׫txy;KZ_S=6?CQp̬7͍,+fŅ
4qU-ZܵSDYv92@BF](VQ>X[5#9|@vgo6aYoVeo*1\DӺ|6]7_JƸBUd=d6UpCN?ừ2BpI{#)f:
`[Lq8D(6>22nT>ėV_p2ynZYe:k\n0\&~CSiy"]6rf*䛑:1;]9QsY|Ag!(t9yhl/J"-2`dݿ<Sr5j|h\55M0SlA;zHMÛlA;a
1'Ѹ+,}X~mʬm9)OaEJ{7p扐Ht|$wR4&**~P _~R89[-Zm1'Vke4M'aX	XhI:7TJI|qi/uҫ8kl2Mܔy(yVaSqqCˌ 3l?Q=G{H@fD_%T#Y=pr3=F@=2yڸ6+BD
LӨY:.m<`:skV7#<?hvWV0oW(EǲŇy9@t2ٱLH.oz4D)tFfB\b$UDBդ?WWP"Q@dW{5B'{1<u@_@Y^zq-XlxeH7Vi%&X8hCmZuᢵ.pٰ?Q9"mn^F7w~l":Э;>,\Ievsw7\B>|=MPEQ:H<~)uȺPp0>s:mlP*B'5WhL\/Z:B/	0 (,'ę9+e̹̏-'#3ZGvl"j29e|$3s*脯,Fsc[HB)6a\\
z6AîK!襨 B]C6uCx5.&LbKVl1^pl߉ΎP) Qߨ>
}$GL1xLF@|c'O~CvJ|Y f:#F'vm䭺+'Z?@]Oc1ݤ5Bem 9#'fQ]Ң^gBXl"Mkr9XVrZhE:S4ArGlxpV*!!pD`M̃1bj4uÖJ`,]-Ͷ]@ b?P F$(,5&k=WkznvOruH t.b?3v꠺fC%U	lJt*IE9"iɠ66{Keuvni	&ԭ3&6WjPc(~:?jأGbgᏎgaH#>:??D$n>!(6TI$~@mw৲9@B{qGd* ͆Cch܏wG_1,`o_P:u_=pgdlې/1L%ȉI66qK	jd˂o=8`J"{e%T.w{>"n',}7/6d|'L9*NΪb~7V_9A(߫ueᤢ$TiPhgbCKQi)R)P[:LWPEg."7Gp䍝)}M/Q+zd%4ΧᆽQ^ń@y9%K`?t2ϢK.]
[W9.eI8KvrBwr^
u͗tr9F
!yIʤK/EY8SX}y$z"^FYd[ȫPݣBQH2+*[gxB+.)kE,*e5KĦKK ==4CoQaT3'<!%0|H{)<֞IE@SJ,ʨOS-cO@3c|9|L̋@'nuEHw..b?lew{gzlsGu5gwڽ6`=/wsr%9\XB#1`oiPq0]a_Du){&ɦ1|(
'0+,f&y\/cg'e"Lik$)F,˙z6k-L> g}W	k|t?"pL=vdDưe?IA$qf_O컔JqdhD$zr_JCLH3g?$ ]'f/",`}	-nB2,%I#K˥F@=		b1~eZrdAIC:IBu$/S70Z-a&G˓rhzx{4c1Le9"JEo+s;"BkuLm_xti+ZѴB/,MfUGS	3NZܼsԱ`O%c^+VÀ΍h};ޅ+S<lT@Lcxd"2nyF;<:(:uP,L剰>8AT*̙W^Ct۴U~/[x=_Zsm㿃ٹn$ߥ3%+xWaHp\unw\+3uZ逊Rbߨu*BXBp$G 1@4 -\<$@%($A5]-6A7v ^ۆNCn71V/z-}x_!w,+Ο
+[߄ <q|7:z#wum@N2F0P.n؃g+XbX#\k zt:d[rY&$ˋc +vZ ,:j	܈9:EAˣyAhwr9@T%*{u[r)~1Z,V"[-TY
PuM;6F+!HWBZu&k.(qhLJEely2P$ȚTR;>Sŝ2Zo3/>jԘ`4&YYfbR@+bJ.(}r<9]Fk/u,k#FW!T>x퍃C.r>ný$Scb!dĢTuDb7fhb|-D ͱ;OV&$UWt/FWdY7mbFĉג.{?UF12'k-Dfš!D}.:D;I{AM3N
A<PL>_YcXǚMcaxҽF"o'K N4ic0t0fAHI
*ᄐPr7<-k#sq.9)uWG:yJWOJUOll<;U_hO8gowtPTp4k<L6@wNtNߦ_< h 