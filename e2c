#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner & e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]
    do
        for i in "${sp[@]}"
        do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]
    then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
          noexit=$2 \
          error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]
    then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]
        then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
          only_y=$2 \
          opts \
          res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]
    then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :
    do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" = "Y" || "$res" = "y" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" = "N" || "$res" = "n" ]]
        then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
          default=$2 \
          error=$3 \
          error_info=$4 \
          validate=$5 \
          validate_value=() \
          res res_count \
          error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}; TERM=vt100;

    while [[ -z ${res} || -z ${valid} ]]
    do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]
        then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]
        then
            error_count="$(echo -en "$(e2c_error "$(printf "$error" "$res")\n"; \
                [[ -n ${error_info} ]] && e2c_error "$error_info")" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && (( res_count++ ))

        while IFS= read line
        do
           res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $((( res_count + error_count )))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]
        then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"
        then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while (( count > 0 ))
    do
        tput cuu 1 && tput el
        (( count-- ))
    done
}

e2c_in_array () {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
        darwin|linux)
            e2c_result 0
        ;;
        *)
            echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
            e2c_result 1 1
            pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1


    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 and 53 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=traefik" \
                    -q)" ]]
    then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1
        then
            if [[ -z ${ports} ]]
            then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
                    --filter "label=com.docker.compose.project=e2c" \
                    --filter "label=com.docker.compose.service=dnsmasq" \
                    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1
    then
        if [[ -z ${ports} ]]
        then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]
    then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]
    then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true
    do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]
    then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]
        then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]
    then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]
        then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 && \
        openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
            darwin)
                sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
                sudo security add-trusted-cert -d -r trustRoot \
                        -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
                test=$?
            ;;
            linux)
                if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                    test=$?
                elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]
                then
                    yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                        /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust >"$e2c_log" 2>&1 && \
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                    test=$?
                else
                    echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                    test=1
                fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
        darwin)
            if [[ ! -f /etc/resolver/test || \
                "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]
            then
                e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

                e2c_msg "Creating the resolver file.............................................  "
                e2c_loading
                sudo mkdir -p /etc/resolver && \
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
                e2c_result $?
            fi

            if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || \
                "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]
            then
                e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
                mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
                curl -L \
                    "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" | \
                    tar xzf - -o -C "$e2c_global_dir"/mutagen/
                chmod 0755 "$e2c_global_dir"/mutagen/mutagen
            fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]
    then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]
then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]
    then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]
        then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]
    then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]
    then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]
        then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
        global)
            shift
            e2c_log="$e2c_global_dir"/log
            e2c_global $@
        ;;
        init)
            shift
            e2c_init $@
        ;;
        sign)
            shift
            e2c_sign $@
        ;;
        --version)
            echo -n "$e2c_version"
        ;;
        --help)
            e2c_help
        ;;
        *)
            case "$1" in
                up|down)
                    e2c_local_project_check_dir
                    e2c_local $@
                ;;
                add|info|remove|restart|start|status|stop|update)
                    e2c_local_project_check
                    e2c_local $@
                ;;
                bash|cli|composer|db|grunt|magento|m|magerun|mr|mutagen|node|npm|pull|push|redis|share|sync|varnish|urn)
                    e2c_local_active_project_check

                    e2c_res=$1
                    shift

                    if [[ "$e2c_res" == "m" ]]
                    then
                        e2c_res="magento"
                    elif [[ "$e2c_res" == "mr" ]]
                    then
                        e2c_res="magerun"
                    fi

                    [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
                ;;
                *)
                    if [[ "$1" != "" ]]
                    then
                        e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                        exit 1
                    else
                        e2c_help
                    fi
                ;;
            esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ib] vƲ x^"]7Y)Z%(Ijq:e
$U)Zd~yzzy5kΗLDd&	$PU$E{X%2222222WXvzhuXv:7vX3E,@9ݑz qI9䲱h9i`MvݾG~6X~wZ}E۸wrQ_}E?g |g0?<4ps>_^S-[fz@J	E?$k=hD~W}ɥ_eyoվzvE0c_ٹLΈxX(i d+ر7v7=yq"7<sÈŧ^DiG1.;ry|v}( dBޮūq0=;|g+ߴ51Ap2dz 6̸5J&O)!h9¡7v0g4X#pm|p23E3D8;؍(rG"
)YZMkd|u:no6]\#ؙ?/UOxZ}7T޹igSK9ѨCB0~OϘg*?V1!pxw#\idW_͟ޱ7t`нsd^P'1B,×QmaWEE.4Π8J
߫_sWFp~[;4fՂo._ϑV*1fV>!N3hb0h!;<a~ݜCo[;`%~#A_܏p'_Q	QG/fʱW!MV3't9mڵ[UVj-;Q#	Zyz:.6m&mT١s/ 	R]*KErPTdw"[TLiQ1-*:GG^<Umr&YlSm*ME* ov`G2[OT#Dl8C_]Yj
}-W:f%e]Ѷ]
'L%ߕ}1/U8
Ld29͞GYݟǬOMC]ތ낄if\^YW 	~-% 
3W},Xx'~I~}I^j4c1kM;ߵt*"!f kxɑKvS/;i&m`ׄJX-'y30ɾɐ%Rw}a̞ݝWݗ;{h7w?ҨSo^OVsv`	6aYmur"(kP[udn_]ܿ:@$b.XM 8qGfr |lvlq!Z3SEH)c.£?K*3g@l(xR Ov`,uU.kGAڿ}α~۲mzڧƣ^JITЮ}ܕj8B4])+_rXd1'̅/|EqLw<70g|ӕ	} [U&}p(-:-*IL2saZY8LF \0kQԾp{B-fatNF0wqחK|\rѬINR;/vwll68 k	6s~t|!&M$V4n_ lo0X:1OZA凷^cB \A6@-z9)~jj@QcO9j$UT*Y܍wمi,,Tc0"Y1р¾9N=HO`5_Y%w}lh6Ey2_M3p
桢髤6RNYSPA|UM9+0jIڊǾauY<VKTW5|HNacV1Go.~v&MBd΂o4cY P|'U_r]//9F_nk!Ni!`p},(Տy^o~zS	=MzüBܑlw^ږ"jwy<(omi7^e[?{%Ÿ3LK.4{	"1
8̪H8	-&5UKV
Ę5cd(W 6=V9 TZPkk	9o;D#'<TQ&	2m`yJ<Ǹz#\um|肅3t@AKd9:@J :1#v.:;H5[Tk53)㶬SwXY^.FG|UI26x8^$c\NEsaP~U5`sEL,Y0#E)sY	,Mlnt.jr|}AUpNK[J2g;{hMfk߼{lUl`뇭J$f|eTpU^R~b̢98
#vhd ^:0}UXYD,E?rg?o )dYoZM_ot[|Y2Mo}d91\;u%k]UsW9t2Ff[D/^f/~~o^VQV绯vޱݿ<|a_-,Yc4df67HzEgVcĲ oCZ$jZ_&Dݣzg)%֫/fM+ґu>RU!2Euqkm(1w]xm~hC(yr]cC1#1/$A7E[|3;[VI/\2ݺёj5@O~S#dHXTB2M(SaM%N,YmZ0u*HUjA :>Ȑh/y9q,gUJ؋N
 i[܂gNx2#_V?f{3_FG/R`uYÖag `"!=aVZiLEƴ'i)i+]49=9!]Q~p*żgxޫEJ>^^b7Y)J+ȷ0&خ$pI4%M`QHzXXW13s69Q[ۏ?"(#][Qz69-h>n5.hYYfe_q*E&yö\BxՊJ49g	Lg>Zt;qa$19qq^lʘYs6GZBrCXb81>EVRpT]bä_ђq%:6W2$%%$`*a)0ˬ+WKKK)PMmYai8ZCb(D"K^H[nگYbJ<zD1ZZW&Њ6PuP n.%6gF2$ܺDhi
nR5sJSЦd.;"'?e;)3h*?x֋bkdX]6Ԓ\L7*9sNŔQPKf5-󐟧n15} b}$mWOG'43	gUyRo	HWd\,MBUY 5rZъF̾2mt5YLU'qP%
"Ƃ8#3Z7վA0&܈lcCD6Ȣۑ;^H^ʰeAIb.m=%usܴHv^9,ҿFZ9NНLK"mee"HS͂8ʑl<ԑXMrlxlb#V-nJI|Wq`KԁwJoWҢOf7Hpp:+- $P3WK7KRX39y'{ÛW }DWW1D寸'$"rr:TWzZy02Qs%f2ڿ2-6HEdqzI^:;==_ժ@uz:\8d2p!ˋ-Liؐ>Ӊcp-ͪ|h6"M]YҲv[$Ai9ƎA	nVhѮb=*Z[ŻE^MVoi^>rP38ySf`Aϝ(O#VwXWAQ(3"h{1h<*`_T[̦{2q9"_;P_@6QBAzB_#;rq#EAT!ׯ察?֊ X'T;}2bA(BRYL^3IMw/0-'+e\S5ߦx%7,.̝+6Zm&jeB{b/n%e '[:`}2V@]`=_
ad5r 7]Ȱ0L.CȦSVBBwĮ<Y$yKelҸ5٩iODUs҆`҈1tfG3u#s
H&]LC B?5VUe	bP<H Ùϖu9
iO'SYi.]8FjDMQЅ]ɓ01s;(;g0TqjR-+KZZd̢4biL#ΡLǩ~(q[,&qL%GR[Wwdfԉsš#I
0HlĠ¦nr6Wf0b2>sw$S9YH7$ot$=N?9E(]^_oI2=]#+|͸rJ3Q1풼,`GA~t3KoI쉆lV-\-zaF]fYxuexݞ2JթUM 	@߰] e^ī/UiiwJG-rm"W#z܁X٨z14(?50ҴQɍ2pf2gtN+!wI
t'%#QTιI?LZqgb(G"dt6s0|	R`i|9BrQpzT[.Q6@mHy'ϵ3y賄%ScNi/a`BV5'JO<Zh	)%<hX3%; ~uN;R&(7iY'Yrb:&.5@($#K,%t$-.2%P-BBMK(AQ5(C(%&,w$9 tk 7"V Z3Еzjp_Xe2hZ,˖{O`)G;>6nqgն7r4y=ۄ6Z¡&uCTF}ECdȹCzvWOjL2i=b@vgNH19Olѫߝ7M3izUu`o*u<lE3K6*^	VqaiH=aCލ*g5N3LR	꘤7\#LaNz#ҧAKQT'W%>LrIJTCyh#BoѣhPA	8tS=:-T=6%k<&j6zO"qYF.2ϖ`|+Ϛi0I@Af|Hʑr709bGG0z&UprsUK`RI*
ir2)aA|JU$}Mr=ΤR&dx&{il<g*ymB+qGl"UF# YBa,4iͧ7I,1)MhZR 1ޗ92'V!tCx)-΀0_I~yâ"<cCO n$*;QqRnyEc7)ZP@hSa`,`[J	A8F*(a?\$Lp"rk &bot;9G(Yen'@xfa :>
L	$*rQ"M'3LIvM|hg3vR^n^[cy)B"JAv\R
Prgÿِh8zY!rMTyϩw0f,HՐLMA?pWVZ:E`ZLic;Q|l	zi5(?O4rA!bKk	AҲ"`T[jQTVw]oWvįG%J!ZռXItӓ7]yӑ7myӒ7Myc.,k:dYAR5ސ7$	|Cߐ7$	|C07lYD!5
/Rt@Fw 'n'cn'wzrK:];k$) Jk%mh%
h&IEII9KwIEfrS't&82-K[b,8+7,1!hy8ziDKZb)%tlʚc-CflU&)\N(ъ((09ّZ"IQk0(vU+bf73\-&R%۳ٞɔnN%]&jcs"Ṟu&
uƢQe!D^ WYU2eX#(S!F1T<7WZ. +pSd_KthܑKYOB.{6[^^+2aJ.D2ޘus$aQZhoIuA/X{ĥl`o竬VR,<JsYd/4sixw`^a!C}<cTaBwJ[^{qK+Ēܛvɖ/J/>QgwJW[\fE=RRYarHLKHW^J +f&$,N/kԽ'0]TlZt7ל2{JHB5̑EVioBz2|-(	*- 2GD![ބ$2ܛkENyOTia%QfHC:đ-	yӗE*{JF6#=5'FNf2zSOnwfҢGO@ך0ķQW͍1WZ(U7cXJpao<Kû-zO$xv<VހV;o{$h^L~qcSU/]>{remaø+/gW}/jNr9wG  D<n^SLH6%87|C7Wj=.`5[waX:^DZ7&=?vCxbtQ*M7Z#d6.ݏ1%[u7Jɣ(e,$+kD̝Mvɜldq0pmQZцtyMutJtԚwEaLc^1u^Dl̯UITMi4c*dcϟ}c30ϼ!Z֬V>R$=fZP܌h͔Ĺ=x,eQylF0?&^dE0HtqDeXZ3_>?]dv-3( rjEMX|5mҜ뚡%er"U%sp>@s2N'i(j{i'ukLe@Z`,eZ^3jBM[bm4)ۺ1{gI"ȍQF0oΫLag@Sc%jXYBl
ůh#IW]~-Z+fZU6s23z-"R3,K./]r+ֻ{躴n@sKݛytbQMjuRt^89S][Mq|'Քz:W+.0oB1㾆I
S3&O0FAwy-NTm$_|vu<}/A\4#gn8-U{1Al*!K	=
MDK _
;1j%*և(&7(CU(	
OBPǯ,+rsg/'ĝy˭xGaoշ}#$Xè]k?S$߉=DCxݪ֨S$bׯiTlD՚)ǎ>jh-rܶxճca ^@^:+s 4cfatk{BsB5"~2uރbG.,\H;)H?"r\crҜ2J#*׊+AI1|qyI¬%c7qU/xOX+>Luy1|  s+?ԎUn4s_Wug:%_ 4$
MOyB!"lWy/϶~߹*ʅ\;{9N(y̜":'c[X7fG03{$; Q8/s9w e2C@Xa$!d9Of@J^J{{;6g[_ B<bVyg̜kܵ&zCǏԅuoiܥN~ɻ+.t'0(ǻM3*up2Pa8#x,VBqʉ7|p/$ pI)D.	Ň as*w-4R'IE!oh4Eg`4KQk>,$3@H8Y`d2QV';XQ`ZοKV<4
Gcˇ'@w.FZ竣390+ԑ=]|Sʮb?9e4,=t La	_H狔RnFdC<hO
U6i2|m_o W}']oX9[a~넍rZudbv-Ogn nx2B鼽֣2KT)/Ymf &-Sk<²lR$F02V浍LMYe}I` z [_TQH6'A0bh1rȬ1*6%w}]<*`s?t,/1za_c/_x1@C-5HT2o2)⬴ᨿ&"T0PQ-鏌OT0.PT{sטᬐ(5N v<&%H)gaƇq2emx֬Yij2-){hhX=M?JUIgvTIU-*W[2b=mx s"	ѓ8ݷf1nJ^VSx@ψ`DIlEpRiARjWcMISҀh1M-cv$dM'f?wڋzUՖi+	pb܍DWUHVF'*,Te&qeZWLʯT+8T5Q2qyֶTCיt!<4h6sKoUsZ˺sFkL|W/07:*yal9\\Jِl̝L[TVފ<>
Kx~_s0bL,Eȏb4ըd}g:TY҄
cz]SV
h88^FS?u$^ڨ|\/6E59Iܭ/<2B$#\Wf{Ğq%Pmb $m{	H1S´5Tȅqq*u"&AY^Q'+ggHDF
;"0D~/,QyiS@c2j7I"-8DR.}>DJB_`l>3\YJԥ3R#SќV'vi7zkCLLQs|Ǟt\m|A˖q[YRBQ47`狸+OB*Bsн{ҳ7&ekؖB Z@˺wbOzgszEP-*Ya@gB	EI!⤢R6 "i
m e1K!=[	
~Vz7q-9ʅP]LYv$^ԇ$v,tafz*K`%H2bpKÓ7*&{~\dn®K30Xr59yŐ:(j0tiY\Ǥ}G&?3zGuLv(j8UKiI|7Rj"bY<41f3Ny|R3 -/	SJ_ȅĔ\|=<x2^ IҶ8E48[$k+k1䓪Qū ^ҸCm$L_
CK>Y*Rk
Vz	=\.IDRc)<x"mfk.[brjIy(`R3*˕X4YB5A]i{Y-QoZJ&gpYM6Kǫ\7i6&wp[<n:fͱ^s72_EAcZ㳰kLZ~2-$.kl]!]ΦY~X^À"[SL'*MoM_c5_8"9%Q%AiPk󳘖Ua\VW1Ur`ռCmr' s.[J~FVl[k䕧?J%o܋n<Y+i!=TWaA\qZ8tDfXEhEz)Z)74O\Ð1`BY`rcV#?pڭySK=FELs̔>ÄeΑrrͦzh*=|yF=#מbüukn07,*qR&by}%f1ѲE=jQT_:CD C|Bm,̎
n'$Ir;h )ld" Oj~Өj߿YYnKS*QUw`7$,A/ƀ\׉XZϵ=-q6|ڨK7*Aybȷʚ iQ[ֱ7Α;1Ok#8[4@NfHJ`f-WVh`Y-'U/:	pW^*zoR}蔚s0GqF65$C3	*l;-qfq٦L΂l7l{mEt jiϪN$Qdi3%Iɤ~Z(;Sr~[ɌEC#:CNH
kkGSUkj<	E(LjLp>ٻϮ޼SWW1D;qOF^WWrXUzZ#ad0׿ecJ3uZ֐{\	2LYUjTֹaOkVhAI)
P2!̜Ӊc`MAnp7!C*^npYc!ioy%<NV':l_xZC9DmRA'k*.۝&k	b:.,tb	V<%-#E\CM` W	 5Y,Vk61r,`@}l-SKFLAI%m^]`h6œRnO$o.yF(ivhP8tYfoᒒ~d(yi6YI/O@%GF^SIȟRRB.ʲi%Ӎk+<?Wڔ|%\zˤ$3ILkեi,2{(`7$FI6sb<#O|e(N)GjC]_ۧ`rBO9JA!_F>{%],fתYU۾AKd#:x(<:{S"Xubc[mزx@o
<),DADiUW}t͑FE	js`ϚpGHl,кmtzALyZU3}\U
}vt-ΥL.>[ͅ/P[r@PfJէρbfBIu+7MMv	J/[Ĉi2Np%(ߕ#քAi/[-Z53<uB=Q@
lUzzemm,Z:␑>owPlV\JܧfV3{ʚjTe5Is;?-	6߹eXrrZe=oa룴d{y6)룲Pm]mTw3$j%9%n39J`iKZw&6`<<B+Q4foUhͺ<Fp=y /^9=FTݚ0n~_ysu2(w4V+lKc(IԪnCWu<?E#Bl7@P9[L e{l+v鋣rʫ̦/P{	qe)4Ieޣ98fEDwYaY洌_41Sn2~+ % dSQ.z".d`ʂ9+FU	z8}[_Z̉#7hߊR`޲ pWlx?}c#tcQXCVEz? 0)WHl%K2Lu"$Y:(4<:\XNfYǟidKbg<׳qW;-:\<
bBSGmC_ņ~,_u`'跪5	΄9%bd:ᐶlv(M#<tSP?"_~Ȁm@B^+ !19k#BIn.$PQMYDC]g\4/i6Lu{55SIbz5y~stm]	
<=)&$\'Tsqx~3e">{#|&YR*on9^{9a`Le-Z̗U8qϙvi)vI/q웏̮w@uQ7sJw9pMwJRA5Zdd'h	s8r^Ri^<\٢EihCX7V(鹂/u2s{uRQW0IB+.LGe2/hD"%ܤi{^2.0J|W	,	9Eovkt8* (rR6xBHTa&t~?Fokf~i-i >v#:˙Gv]F
JZEuT8:\j@mP<毯Ո0VCmh5Īk5_P!Q*R'@b lctn-	`&
b9@OiD,4qC늫 /IOa4r؆X-VL@s\`;w
ۢEBr'gSG!**[OEKgv9^fqeX+ВFY(wrc[|eƷR׃7R	;Rљ	0Ca4,@8.+PB4[yPhcZhHñ'GCoxea!?>M~ƞ^ZUͯr9Qa%1\]suͻލZ9[-g0xDϠr0Ψd$H**VSW4Fm3Hӑ/p5"Gy"Ij2E23v6vFHz
j7N]{df	[1Vq䁤>57W>!G82*@tR)%6vC}\-u)\ ΚXZR% 4fki["98Ch1=tCw/)gkvGL6hk;Cax:XS_f/0ǌ:S+#U|,$1/^{a0 g>IH]1_Ӈ\I"}b7}μzԩOtvxr&AKST8&޳w\8t{JF04z&$L~ڙ!XOoESeH_[(h,>e[7IYL
oGX@~zZ;ɺXlj\_2iyj]}-Q?Ǐ)=pQ{Wr6ȱOYWUym3&ϸsk,,JMqsmw<[igGϏ  K׈LO>#s3M5H5h.2olZ)wU2T]~/xyTKXҚ0%d/ڵ_^~}xbj>%.û.5\h Euxic\}M
C"Z<f>Vla9HҰ_e&3VuL0Qq	0͎ʪgZñ7P{Pߖ1$hБ%$5xԉ>:Sz eO4491IǸx9huʰ`C*_acLlo{7j!%&hl{@IBt?to/_*˩8kGJ|j,if%ɳ އ~_JR7ڪ+bѺwA/y$ʊP@,CAF!tCDYJD 5sJJb/+~Az
c>P0@&F/,
2l]k[,`?'͢KBkcSNjgj,L_8$Z1l`]^2ˑvW{O5RG\.mm"(ɔD$fЄ}꼉6Fj	4裤]d_"&SEk.}pMFc<.>LqbPXl${Q+z.*`<(nU{!-r+};j
?
sa5E8eq[DC9wEnGr#va0ȉ$t'1v+L=qpgج/ʛ/9XuH$wn0%p;1'/^ 
`UE/,52!:=-\e7,=rsR.u[1Ttm)qђUd߼p@͙a?gfB[%hw27ĳOWW95-S/7ĳ5Fnr?!K4\}HV'g:ak- :{QDKv=OX<'$>h8	wC/v:(iKMDwTh")ܜXl8<{dNTg-@uYvz(ʚeqL`9y˶<Y<< *6oiN-w2EŉfϬO]gr!dyaRh&+E

.<lL=oجϢP%szuI,)O:	mԓ'JyA(~|KlZG&5{fg\LLgcv~qw?~q([1(YZur -]_GXvzhuXnefֽ}Pם qzCA:Hv|\RhG
[c﬷;uzR"uv;vy?L_.G)~{Vqk\z}Rym!;b!I`N~`$aiA0~:ru!FB'2a%i0cq"DwՃő_(u^J3<odVP;6Kgz3tenfu|^%3vU	;1[X-Wj*$Ĥu6&@̥Q9vGBC/ WusRB^祖4%mo`fǰD|9T;2˨2q>Z38̹lēdjZ?tɑ3h7qp̐k4$=Kg2|:'LᜧPrg<ݑ5Ņـ7U`|7ʹŭIkml@݀[/+܋ie	F~8iy?}SYʉݴ,YDiZ?V<"7c/2l:BN4pA~$/NK;녻2?4h۩c쵥Y~?Ņ;&&ߙF&g&9Ȉ8An
0L"MJo0^RH
gH kbg<=u6]%u*ȍجK<j.(ܟ$XؤI3fiE&9I\G}>P<LQԗ!HOv0͆q6wڥhdΪviotkt/&)(hEf2vӴ >|N^G^=LSLhy^mo4GVh&nRq7QM;BE%I.ta0.%[,vAq.i髑;vO>FthlAe7t, 3^7]6ɊIhf5ۤofiޏǿ6,ohZw6t{1vQ=}̯~}ϛVn_2x	[h @#q0:Jn}l<ݤZq>io9<Bܗ0 vN'h릹S@QjwJHZ`s]kt~9Fe]!La;/vwڴz'f8;ћǭB@8%!'Ph9tJW/cTP͗AחF1׻{vk..W*r>Y[^B{/hw(?ُȘ۳|ځj_
yQ~2q18SAfk߼{?6[[/v$/vY`ο}j/8_烟x_P4e>#0͟^>ȧIo??޼˾"2dza(vE_izI˿MsG=y7uzCٰnyڍla_M뽭~=xZ˟0Powo~/=~\OVfkPo*[][PdRIP2~:qDy<ȄgSL]٣ݴʔA|=_(7/<S]v._߱`0[@C/{;XDQHi)t܏|
Biղ
lȋ~wTY5Cu4²A]c6{pڒ333;Yv+ϳ`*\3qnvۯ_=-8_A&yԲp?Q|'Kצ;Zs6 %ے%&Eoё;;x9QCc#/Z (˂4dK{ӂasᡓxIee{SEm9r 9wzKO\O8olu3Vq'%.(jȴ`{J!z༭JLK:\?j5;dսkAouzVƅGWd?f(-i&Rh*,PGPQo9:ɯ7s*w{W]bBZT7&	YV'
Uj\[hXƞOf膴/i),r	K@nǝ\IKq߼:vk=%|V_^3<]$7@drogC#`[=y3 Wju`yt-׆V63VPf*Pi1B\*u#;tptb6(M<\Ozz7;{i	 _}Z73zJč9շϭ{}Fi{RoA3=GJ%Hp7O#%O1f㌭oVhzW)+=g_
vA0vJ T
}6"	\ކȑB6`t30ؙxM6	 :C|GɚGc~Di;i}G0&{p|FM#hmnSj&[ezx0	`@
wǐ<
8^f j7S;9M_9I|lt:ǅbת$8ӋztvmepGUtYGh <`dcUDC


Fc1'0{qVu* c(qwu0!c6}{^TFqlh4FZ#YZl9/HKJkv-*ic}^	锕lZsHu66z19n)-zBӀ- x)-SS~!RxJ&h6G
-<9d8dZˏK908v5qesH-csoCYp֩3Pʊ=mh&~.8U(ee;M
r\z!>lho"a{0%dJih=ݚR16qB->ý}:iI#Agfueq'WK-$2ϨX5"D!j_|=_A/d4$ˊ)
GY3q.trIԛd82ڹ H13_R6HQA9GqIu [3f3,@Gx~Gl7au\"B\](I(ǞZG>#O5G
Y/dabXλf&d$n4jnMbvD$iLi)?I/o*OP.;c1EocOWq@IApuM&cG >VQ|6[*jܙ9r;J!CeFvǆ9kv:m{<qk6pSFS/vC&?&/ޚ*_ku7Nm#ޭ Otu6\(}~3:D}	%mͦ^	pv}|<nv7;vnA[;aml6Y{:=@בOuAֺVHjnحnԁ,lƺzlVjYT LMK<v	l8d[ tcFO>Aa׉OЂr {v:~<Aݶjڏnlyl3hZmdv,B-Ken=A:!Ea;rсҽAO	 >w-hhwm	lvoۤ۰;|ܵ;N(z]Y>t{@S݋(	;4mTݵzlt0* xC>:Џ]l<[h^X SGU[Aumy}6#z7,h:40qK>5m_^{DNѢi6coMv5l`ovK4ngcc]>at"{Doеbn`)a7^o;ƺxJ"as

~A~mpvP<6X|r>}B똧)ɠJeS)YAOa+1 ɾmkH 27էHc1e+n	N^ׂbzyc|iR?	~QӚ_plBG"
ZWk75č]'\ղT̋cӋoB-]RSvȶVTpiO\C!_Z{hsQ߁][_Y4[zV*ÒY!n'Ua[ ڌ(	Naa@?JvZ=GxcŭQcn$\ިϣ+_q{u&979ȧ4"9!W<]7/	p%x^ "}|(EUUa"#xޝ
B^^2'.$.Bي+"y[لbd[6ıQ<q~Abfʱ畯(i4v)o^͗Ѵ/Go_:~¿KC/?;? %98%DD,=?h1զs2Jj^FllϏy1n4}t8IC%$=<Zfifyo	A1r$Z)6fLee's?ˠ(KqMak/rO|mWل_) Q$JǑEd,did]Q9,32SЍfl(ax_ijX('%U#pᤢ1Ter5L"M}ѹX)x	S&)ĠITXQeڤu6tb%kd<b.	7
3]/2o9)2' MƙNQSU65|1b0#%_a _D{6/{~uWMs,률d}Ô+`B3+XGRtq"wCFŃlUW KY*T/P|aY5(M4<PܱH1į2WyGznA\eyx|>αeWJGr挽C]Z-;`@S}::*&+Wk؝L[?v1DDDTA0J4mk:;d$7^&%H=w	Z
ZDơ% acfXd)foD֤pŧ8 DLK݅3}$.{JӝŞAUT\eBjɄ;CC'c/hmBͦ[7d䄿|A]GV]wDvѡ*I33y" O0.j*<פL%5wTIt=QH킴	]I;ΘR"5
/x!)gb&(kؐ}x3䱪fbi5TDI)ءQ(;NO8*3[V5]mz	Ce`fl(Wff%\SoU@H ~*`ƳgNw.P~y!#7ǚTwۧ2~.HS;w=!f&8]-V=% vI^<ja 5ߦS3ɉCns_sbͦՊX # hĠnlWteSC飔P̍aBwQ45k->:ѩZKd)Dw Gؔ'܉hW%(H8ͤZ&@3J6@URǍQt[woCG#Dla
?g7vޅ3 R7
id01]q>yħ;_ڇ/E
k~MG1xo67ƛ;*s<UrCjms׮NufM1 	gavMdXGLBbQne"`aoل!fžY񗡪)" pM
,s`h wQ|"*
VKL\@	L hV	f:
1%!ytU*(mo1ȸQd_2Z	.~$橺jj	fFqp͚QOti4-,LoFP\hCRtsDqK̉fT䡹(\`Yvl0O-,q׸4qL3!5	o^=1%)7+Du`)ٿC<)*Ti'B"ѱ=Hc8BītA-}QY{~>>JlrƎh,6,
~ZQ|4[::޲a,Xcy& 3[2b&m P*%%+׹K]24rS2~ZbMŹb/3wXΰMD]h##=g|8PS1#>N\?f9n2A0d7xYTCwi)0Mf\nWVtFyZ݌F_YZ_Է_iJ< q>t8d~X2y;;nP""%v_eg&/"w8qUcW	]V\-\AsF#BwD^!6׬;
OyeM{ō;cV?ghP%#u6:LwXi`X*iֺׅCggXrF^l*+=W{x%;aC0C$s3'wڽw75޴s
94y@E^
 }v/Dn׹"RC봱BmC
)_3qfkb4{'4< ȦP gE360?d.<BΜjT^D!LXْόʧ5d*gh C&͍o!Iqq*.(\kuft\2e-YMHVzQ}'^|:;Bm,G!N0~(8g=2ŀ3:ю>Q+cfN7t̚۵Y*ꮜk u=ut^&C]sC6LtGuHvzbAjB6Q`QZiqLϻ~YbYH@J4G3ƈ=ԩ*[*i/@8w^4v_7vh @4jT?|טV^_Aa_<!	v~
йةVAQ:8V'c=W(n+ѩ$K0Іϋ%-ayڹ
	#&\LSjΰV@bޛ\%CE!	n`G?:C#<gPuRt&U  +މOl 	u2{)QΓ@4r?}ŰCOIq"B3 VoC0 '&,&ژ-%.x6!(ۊ액dPF܉9xGpbV^|djܼk0@9T0U横 :9X}]S|EPAij.էFQjlJA+gpB9o0]A8)d0Y~ߛђ7v·C'c_k6D.葕K:Fyz F8/g.ٺo<.Qֺ#t)(oB\\g.GG'̏/E	Ix)K5_!R(%).Qؿ.g\sOa>{eIn#Bu
EU ɬ\l-T
a4SgM,W.-͂M.Z_FQ͜/ `kZ{&OEZ*	Ƴ+R+?M.Ԏ=L"11/Cf? ݽ0͏/^b[uwwEtoR&׍b>לiOc`UM`ra9fǏĀAEXl"t}AϦ&1J*(h2`̯\<,!zDX.WrV̞ɞ@1D2dΦuP2,g)OO^|0(]%Yg3qؑJXStp'm46i}=QFR"(I<!3\.CEʝm*U0"͜dt	e$'d/z˰$LB/Z_,] x_$@R:X&Yjuy'q9o$	LL@j솙E.Oʭm5ӌ0][<d*ͳ&&B=ս:{:D2zq:q(Nyhn{ۮFR&
I6њwzWi2+jM!.V$ؾ_̨W:iqQǂ?]xu.lk[:7gn[zN98@>VQqp2<s#xACx0'JhQ3gz_y	mVeHoiK#~eǿb^ku^f^{'׻Cj{k>@*/\bW-_V!m<'/q-h%qK1|י;"h@\*J-^V*֩?W
y c&
 ҀqbLh/ ̢   v9ttڽnCxoF;(Xe k~3p}ܱ8(\3n:|g?thsK|C玴oܨAsqwum@N2F0Pj.n؃g)Xb[;}ǲ]3ѓORs;cn:j<uBO ;X~;R\s Ͼ3:5ѷfB>(Y
"j6<š?ɴ֊0d91v\M$;PBmPő?ι0:V.I :pƣhV]I{YjI- ŪPedF"srgCk5_:(.R@}TĸD݌}1Q@m.-V_eG?ò1^)m&r!nyIl[R.R"^+t!,M\UlwC v5au2 Awq:U?]^%L$~tnE0 >d|VCd6%dK]HaFXWk@`SJ#K'aE;}%~=yvZ=fҊSFowI<`AIN( RX%RUap8@-JTyZq+['y.3[bď!tRu.\LB_y`e {xķ۲&sGwz#_爅PǟL9d4 hwUʷĆ9=[cSkzn_  h 