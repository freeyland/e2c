#!/bin/bash

declare -r e2c_version="0.3.2"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res res_count \
        error_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        read -r res
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80, 443 availability check................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    #if [[ -z "$(docker ps \
    #    --filter "label=com.docker.compose.project=e2c" \
    #    --filter "label=com.docker.compose.service=dnsmasq" \
    #    -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
    #    if [[ -z ${ports} ]]; then
    #        ports="UDP 53"
    #    else
    #        ports="$ports and UDP 53"
    #    fi
    #fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi

    e2c_msg "Password required to trust the CA certificate and create symlinks......  "
    e2c_loading
    e2c_result 0
    tput cnorm
    while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
        exit 1
    done
    tput civis
    e2c_erase_prev_lines 1
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        sudo ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c

        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Trusting root CA certificate...........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates >"$e2c_log" 2>&1
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust enable >"$e2c_log" 2>&1
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi

    case ${e2c_os} in
    darwin)
        if [[ ! -f /etc/resolver/test || "$(cat /etc/resolver/test)" != "nameserver 127.0.0.1" ]]; then
            e2c_info_bold "\n[Configuring .test domains resolver]\n\n"

            e2c_msg "Creating the resolver file.............................................  "
            e2c_loading
            sudo mkdir -p /etc/resolver &&
                sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/test'
            e2c_result $?
        fi

        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c

    e2c_global_load_env

    e2c_sign "e2c.test"

    e2c_global up

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log

    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up | down)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ] v8(د_U-dSrJ%Um[jIk[YT&%IfL*K{30gΜa\`f֚_2H0/,WuUV@ "Q_jjӡZvnwVVo6`\/&QPPL#ڑN.?VIYo͇?g#Q=}\ǞJ7۵/o5<}\à|F	`odc/C7W[^.>OZAR^o"_m6jJw{A[hǡx>p^}q/\}{v?5ukiw2Ym4vL cv1d 3`U7WC7
D,_ >scvݧԍc?e^0b'a0bQQ W"e0<Ϯ@`	F.X|ˡwF_ݺM5a&cq]?Ena P2r= xlg95b׆̇g.s?:P4
 ݈̎@9Vߐ=K`Jɪ*o6_;F;,coWi_mz0'doqxx>.{W>q)ߨTz)ޗSmL/8Zo	m@=}O?c6^	~-jbBcFȎ/?}7{/˗ȼLbY/0.\q8J
_sWF2FNa;Y`֯lBt;k&jY.+՚wo!Q?80۹ݎa&0Y7`Y0'1|`x F|DK'^4p4[!Ê;Eg=Αl+(rˮ+ЉbNt5ӱWoo6oo̎hyAd@	d@	d{1 0 0 kw{Mjlj֤5	d@6	d@6FUX.Ϫl(̍{0+>J}I$bI/bP);HdhV1넕UuGv2.1uٿNXb^*p$Ԫ?6{^U2?ֱ^{wy3nZ%L0JȺhΠHn-yO/d$r]}`a
W5'Iy%yuЌƬ16H~Uʈ8d}#7fW4tl_[?LZ?w4J󭣯	+uQM5O,8cbwOW;o{;wv;hkv=-1[-onSogG
,X<t`9lނȵE	](XN\2y}+.Z_ Nx1Q/X΍ 9qGfq p|lv6z}])H<αbvQ%Qsg@l
ewNB7>DS]c)"
]cV0/+ns_7YI{qd|=ԯDo׸],WD+e|K],<無sA|0VtE;'̥poגCy@}+Dѻe%u$b_*}s3WIp;YQi9JVBTDq{_ eccGo6|]r#mWݥOr~ypuFm~+SK6h2~0vgnU^zմCy*ѝC/1[
0u8)_y{z娰眇BeJ*.}kFne?b膪q,T#H,]Th@I	N&u_!w|lj/R=ed2,7eƍ#f.~桲QRpT(S)Ga{}e-
[Y׬^a_6vU*hOPdyQ[Dz1feUR/ä́Pa\Y3!͘8kx!D8mF(cʀX5'}c 
I
uoI ěv, {?d/2vBy}aw6_|?Ⱦ;/vfטgVyF(oli(^esSOJ.z	r-Jy8Hk1	+5SK$OE굘5a!J_ 6>9 TZ֚!i)9ZJDE-Eȷyy<q3/Qc
&%'~@Kd9k7B*T) 7tYO݁]άj_\+2n:sgpW$`uE>T/Cz>#3dW 8y'yqT&F7Y:HgK9 wtBU0gS[R2gtWgMyp/_^ln~y3\d4!C&fu\ߢ(g yK
2_f^|&ߠɲFȵ˱TZ*>~azoK4Ic͉y+=b:H 2rtCWjoy{}6|
n"XEY.[/_?w'UiHi+lnp:4eN$a7lɵ4<}9I0b)ʹ	M8p۟.niSlTKX-ڿ-P+KG;TtHAׅ-u䶱kxĈ{ މtJF(цdg+r]C1#!/$A7|3;[I/\2jW/~W`hGc#/gedP2K$a+tXxi8aJUA U5jS CQe?ݳc%^W^tJW IMۦ>s	Y6۟b}48f|#TM"; 		˒X̕*[JҾ9Il#Hg*w,|?`C@vI@my'gxޫDJ>^^j'Y)J+ȷ0F.%{pI4%M ($= UL"(G~ {9tNՖ#^@/Mڵ%gkgFNb/6]$f,2̯8I}A-W$D"(ƔW02)Glg8,̝0f#'.KM3cb_uHK@HnK'gJJ4݀P|weF:1L%-?o x*CR]I\H(yN9z5 xeJ|%p|%0|%{bwj
]YgXp1ma ;ѹ+Ӓv&VFBWk֔1(FK+:DBZ
l@6%10,*iZ⯀TsHaj4Te'fSƐp;u=Ɖaë7_[$&ǒ쒶}bZ<f:SFAٯە\X
~!4~XP8Oy.ⷓw]<T'K$,VJYa$p"]ZrarTf\jEF+a0lh1U
`ʺ>WXb-b,ȏ<2u3Y$c;ȾZGdci~ ,㨨Sy]K >BԘ)f{;od=gnf9@8c!ݠyu?KQ"`u'RH[E L6rV۸YP1:f$1[$ۯl-__:"]	r;N)0JZI_W&?	jHoN`5TJRtzfA
K[`&_; O|dＸfx(ƗDZNNJrTK~zj8jE4ܬJf=^wuY	bCWj?;Q[rE-;I%]Zgѥ3yJ& 5$}77xxE*9MݶH&,iz-Uiw
/s *+H]z:;4wwҽ;MRr}gpWq8qBsa/(O#VwXWGaQ(3"h]x!!}h<*`^L[Lƶ{2v5"\KP_.QB&5`BvӱǍQiw(w_,Wjp3Ow0 d2łQ䥲"Ig_`ZLV mjJn_9+ʽWJmLԠZ5.r5lq+LVD[~'NʼyJ5TYw
i;]XTae2F9.dXyJ&dөk|ܑrEg!;
bW,R26iܚô'GnϪ9D҆b҈1t.S&u#7
H&]C B?5Uf)bP<X'>[2KϩUH-6
BsI13S]7ES0_C:֊;;''9aN^d[;P~waԤZVN!ki͓1҈Q1f8>SPN?y0) Ihhķ	4>s8x@oVUE6{~bPm~fc79JL쭘m#*$c4	,'fTNւ(#M:]IONb$D4VgE;Fb~.If@S>Wf1f(ʘvI^]Mq r:uę$UDC6AEruZ	A0.o:^klnj%^wL%h8B)o>*e/<)Lge$OKS:jn#rtF-֋k#TER#%WBv^jiG)7~t{H,.<9fPD:SRU<QNȇ.<Säq&lr$LFg3Ӱ_z	q 
W1$%|HEoڒލI\;٘wYp=~~>KH[25攛f &JUsBBL O| &Jv@ȽvLiniY'Yrb:&.5=PHFzX<\JaJZ@BMK(AQ5!LiΒP;OtYPxkTZoD0pZk@w
e)3h
oӖo؏`~Ž1G;>6nqg4?MMmo:&Gii4|h	fCȋpsJƯ*L2i=`@voNHq5,oO󛦙4U?wu:L$pǊ7qaiH=aCލg5ΜsLR	꘤'o<!wzibPҤf	hO jPڈP(3(L1bnUd MɵDQF	Q[$N#E.l	<)(RtgIވ-TU-)IHZGWAVHk$I	)Um+c kk8B雐H<yUڄV8uŅ+OHVWYw%Y5K5gILk>12doIiBӒ7̑9	
RKnu,JKE?D?04w> LQRRkj^@MPol)+$M73({ gw\p0m&Ѐ3&_}[GPI1O";#J"s>Ql^0qN"%RLt0<$Dnפol
Fg<Qiwo
(v=͡x
Lpfÿِh8zY!rMTy<̩0f,HհJuяF?wM+IQ-`(RU(T6=N(?4Or聵jX&CK	AҰ"SS}jORkwUvo[į)%˰R#t@5+:n:-oZ)o.ogY,D!%&+_dk5Y|MVf|MTfRd!Y,AHI5$	]O֒䮓ܵfr($)B#H564 " $I(I-IR3'Yy ɪ~WO9XoGe >pK\ ў'qs&CR%&-vG&Nd%2MYp~,tu-D;呫<䜏|D}VO-qH_E	x=,Z3Oj1ɗZ-,؞:LLtw*2Qc6L^q+5Qнt%3]SuYVRId%Q(S%921(  PoLzk5\TM^m\ɛ'\qG.e=5*^^EЮ'j'](*BDkc2ćFi&sң#^K"9$Σ頱ܥԴ$0j+Df9̕ݍƂa{x凅UFBP	+nxvKronERy [(يDa+*$^mmryfV;dKJ)fɑ#2-!]S{)܊lې8ҞnDRbw9RPwiMI\pZh:H
- 	0GYByhꩫH#z *0xY
nyh$ronD9=aPD!ǛG6aTN_
- =ll7 l[M:]M=ݑBfO8?	LhJ߅>F\7<P^hW݌a!U!H6/nE"ʶWX_xFUg޷zGO'qE'ҕw3<ϟ^tnQ볗yP-ZF6ie3|.}v(sw	+O@_	pʼM=(gD)IĹ#&w\1dTj;łlޅ!t>nL{~H3UnG@Alh]c

K$n2ZG#e,$K+D̝MvŜldq0.peV^ІtUtMjQk=h ^0zFB<ؘ_Ϋ24ITMifЉ4'E?s{oޒjXJm8+\M*E2E͢N&kח4_x$t3U#D9g"YD.PW;C?加VicS4;G(:ӷq1*@ek2_<G0S$Xl# ⬅_vyylVj,ɡwY)'{!xχьm}VaҚ5S[<E0E0Z\6jup1 dhm~PQĴF[[z,Bff7YoM
UY=HnzA wuIr˄ۯuNŢ8,Kꕸ'v95_Ѭ&!kPg56Ky3is:V0X20Tm3i6k:S7F\`ޠ+3r(jy%t62xRs/BH0?DQAKa4g4FM@AjE%!؜f6-)sh'\Ep q@rf4/#ju<9cζ~KWվkx;dcpN
A18E!~",F8*W;vBײqZqWq迂tA_O愔KER}e&͡14Ď]Xݹ	;?:im^*J2˨Dt)aYƤ9V]0IRu(IvKQ\nV?g^-ۋ JQ̋%%Y"3<]W<(iLD+w:7WUcc&t8\?<~`(z{_cDEr6qw9'J8tIF1j<xagWN/w)3F.܆-^*πeyAIXXdtԪx|W$zf's
p?)(pgE..ɵ96?ָU caeOsvYZD:Ч{߅*xBl\јV׃djK19{WͫRo {{K's\ER"\B!pgjQ@}Uy/FslR3iۡ;l")>$$c@ȉ0A``ԮiBN|w<.7y] {󬺧-c2:J\?zb.e_vG6ҒptQ֙m-vAV+:941,}tы@/:C)Kd@<
J4mqk-ܻٳ٫{}8zæ9fN(,֮['oל;n>i'c Hnx»ki=DaɼZA>w	BaӔ-G=s~Q6)_O~~rz;dzIUX$00b 
JC$BsK `LȻ{+vdXU}f cߨ(P59ZAwJ	TW PiJMr@^IluǬޞD~l$+c8RC:Z+"ZjVZ*Id<-}"@QE]crD"85F㤱NZpb;5S$#F<⼍
[Y׬^a_6dU*Iz=ڀZPJ\C3uc?WOlbҙW)*ii}PjUpq÷Ŧ 44B!è;F	Y}V_$M#ݲT;rz:/`DI|I:[pLդ#t!HF6QaѲa ML<Y5^dL\M(FHtUEq0dePQ0*lܤ PYIubǌbfY89<k@ѿ>LZIaE#,^utjN{YOhMU'_uolvh7ynJ^nNhùQekEs4;sӫcq|y Gx)P8 [RM֘f8dcxa,Lܼso x}kTY҄iw]S
h82^F=u$^]|\(s6v8 2ܹ<,5$#\W˿a+u^p%Pfa;' $m =YIښ¸
pb6t	0E)8<4X&<O|{*(% ;jL(_X%M.iSXj$Ck|&)5>WBg⮤G/0td.,%L%#{ҩxڅRChسU<SfqOϔqմIL3jس]{+o9h20c#Zy|0YS>j憗b'x%剐?H BEq.:9b::>Wj`ųU-=kګIjT*qQ<FTRjݦVm
Qi
%HK'=[Y.uܬzcdZzЦBrZNL;_(C`;:0W1 3ʰQsR#A YqzqަioUL@0݄] 0irZt&Q"0ti	@\e 13tѲDW'\ =t-֞QEҀ"`&ɻ4I 0$.$hk=?$Lm*Y1)+7DnM2_P1Ҷ8Ewj"qf,HuWVҷC='UWA[Sp]0}%E0_<*vbUງd+WWjp|E"0WӼJߕaŕ fֹ2	?$!-p+BBX,[ Xj);ztӕ#uڞ;IYqgi;4m@.C0~^xM6ә[Zhꦊ\eۂN0Yso
W|'ai"8P1Y5&].xC?5b'cfY~X^À<;)SL'*M鶴M_i%_8"9%Q%AiPi󳘖UH{HfXYT?W#1l)6bJ5n_#<QzU.EV.~/DwGznv3Kyu5E\XK/b̪뎹q[UxRw/̭ersJ56)$j:9k/>{ik5s0󻧺޴¨pgq!,9RsVtXMݾk`~޹Uȍź0oY&[8oyI=gf^_JMhټy5t(s`/ݚx~ȅ
ٖC|BmPphcgqeMMZTxfBERيюHZK	 uE#Ve{־DuJ.Աm1Ju׺uEn,->8S>mԥȠļ9򒵴"ieuc$shF3;ЩR:k8\YلYeATa 
yg1_1KE8~!sT/{P]Y*Rs0{b(Ȇwd_b|&9AQ)-uGӽ#,n>4iy0\VB İ]^䊳S?*I"8i/YFɤldRRPE?-l)^`_rv7[ɌyC#;}NH
+kcGY+j<	E(LrLp>;/޼(<G1D;q@F^rXjZ"a׫VacZ3U\֐{\	g2LYeWTj?rωGգy,'GM]jgSdBC9{zGЃ̬nv4֚zN*}&$vHj/umwRqYbarȯx%<NVw':l_x}9Dm.RA'+*.۝&k	b:fo+tb	V<%-"E\̀!MZ W	 5Y,+66W!<`>6gj"pɈ)TXu&c<)NLNV蒯i$? H &DtCEf~6.)/JwIݑ]ݐiY|rN-o(u.$Dr,Y2ݺTPߍ/ZxMyg_2)˥|wLZr4i4J
kɢbX_xdqǅ'(,S`ʑPף#OsxLN)G "/H?gtdKWZY=kq۷r7#x!lsD 9@T3O?}ʱe=EhxtVlf4^:PCnO
8Qle9qe( AfYnMyZsn RP.i/\~^qA/ҹeg+ }s9ʞaKN55fJŧρbfBIu7MMv	mg2pd<v8~jOY	l7zTN	GGc#*)W:T8
u!#}9[gr)q5ZZc@9+2QUT'ͅgr&Ljaɩb0>X=<Bh7GmYCؔnBtDnXukD!Q-9}/qCΙU
OD_ֺ3-SY0Gh%&,ZRY(Z'"=Gs1]]È6ޚ[fqBڍko7cϗ@CAB5H?,ю&M:Bg!\	כG?Rdo>zbg{pwn޸UTْTl ,K'CXC7UX8lV8I	;-]ў5wpMaW,
I*3W>1+rͽB]rLgYᓳ2(%\yQrSQW9Ot0Mվ[7(݊PꫯWe~<GyQؠ24xǘ$~ʤ5Fbw$T|#R8<~^r$Zg&؟EТӤ.9mwgjz1-u5xNo`僱N<2d{'OQWxW`7-k@4I0#D89F#Ӷqy`#]T GK/CsH]M_
Jtwp 䞐:6smw:()~MVThEV34<<SaI"gy?(&/%ձbw+̓CbBҹ9YxLyn"77r7VVLoCx=6@>H,EH|t7n02qs-fK\*gLzJ>6]GM쪪%ÿ?cI0a<)U7VI"ȰFQR,5acd_
O"V[0͋ښ+4mf:j<]CzKiкJ)h}brTLЊ+>&y+1lH	7iZ@^N|eS=|הh'f©ߌ3VY#PFo`L)7_*e~aL DnCchr;oAk73)qdЅ\Pj$ -u Ih98 q :\j@iwP8oՈa.VC]h5Īk5D-VCT=OSA/es_()ϳ!<Z,xL:vFAJ1҉Xhf=^催n-$]x:P	S*&Z|PmJzq;Ro5e3m35ta5oQ,r ;9
iފo1:2k]̮U\u|Er4t%3Bɏ|QƶR$ʌo	Ӄ2H+љ)0Ca4_O.,/+O@4[#ws\)jX)="Ҳ0I;3~[ 4^sX_Lo>C	{oNCWbc(@a,<G"V-Gל_ѩs	ri9TFTgP00>+LƧ3|}[t̩!]f$Sg<Z]5Yx`̲'ƩMm:Rsƹڍӣf~)^ȃYoE{ )èwK]ZRGȧ@tR)ѱ6vCc{,ujr8Cwb%k%>xIS!;mኞƚ%sdl>H,>v	Lwx:xf?Ofwn폶&(6oH=P8ysL39r_{Gx_&!9@>80\<`<$#u'|+u>5O2r)є0 {SzWf( MK/((NPf8qLgp9ڕ0maibMH܉=A,;'yNuAJ$7'Q:(|%*I|6Gn_X
[`~fZ;ͺPlj\_2iyHjI]%=Q7Ǐz(=pQzWr&ȱO	7eynm&Ϯhl]"?iV:?c'gx΄(h3$"2=瘍b΍O4} sVk<%Nnʼsy+eWF<
t"Wb}3w*IŊ|g|Hhf|]x]dUIٔo.Sw><"pUI*(
K岈ǻ(mLj!tb|%"A28KRABl@yͽ`Lv'4a#JߏlzNF%'LhrWVvAi^Cumw簺%cIP|vIVkqݱE]t@V˞irc>kx8[kʰ`C*_acLlm{7j6>SLd3&wP	p?9]UN|C 7W8[Z>UFoI=>LKerXU kX*JjXuZ_yʊ ' Lm"r,%N"vBt-}Sbj_W8Az
c}`<_?bdt_577jpesj?'XSxO	G
OG8ne;)0}A@e(ƴ0Ed#}x'+o+^$M3H	7yj,n*iGIѰ@\xǨ}|bw>'O0:h}"I^ʬZo%K̻!t'+;ʪbbtnh}pnr5T	9g娌"K+ѐbΝE;Q8*{YVa09$:;v8Vwt3	flՋUx"kEv&$];7kr	-\r	K3Tl(Qk	Ϣ_?.~掲u@9xMP:存^J|:RܶLqђUra3N0nܷ̄hKtgC;d:ngﯯskvZnWnЉgn-2~^=Ch#3jO{x<Du,ۇ;*F9PcxoP=NCYa(JRH27f7V<7N^YYsP]5=eY#%XN޲-rR0Ǔ	SUу6=M։qN8qգ3-_."/֔od?	gJQggIPdP-/e9_g0bPz"W#9:/ȷ@MDX'mxyXa6i70Sq/VmV-qܰhaEÝ_Zmfobfh6ۭVj}U_\AUNBwQ
A)pD;ɥTyskZmbV;s31owVY?r#Okbj?ϝjY\z}Tzm;b!`~q[Eի4 0DPnTc<*|?EaE΂1-T#}˃?RʀEEGWq5fxpHK/mIOlCN3펬α n|^īK qݥZ+bmp.!'0X`ŔHI[u&@`K9vBwB/L/gk-i|9.JZJ﹡ūjU&gԗQi|\glq,swYx]Gӓi7Xڧ%zϡE,CfV*]:-=EdJ<;ap1.;>xc:d.ÏX$>+]8^\ܚ\cm|9|]^,NCKG^0^*s)Hrwk[zWY ƻiXʋK 5~(yPADZ9nG,_f*&Rhc9Qω{qv8
U~DxjӠAW歷ӔdnF|7؟S w!h#:4F4(/a&H
ҫH k39̮j*8vc.+wH=746iVv`2N$W8)0uC#:T^@}:l:gqX[@HƢ`gnF֏ZGM]*cN?Kp:dbDG+t.J5L<in|`O?7Z%M6Xi˥bڟ*Ir?p,4Ei)	"@*bjSQ$(|oK9B%><vJex9n'NIz٬8kxk?kʍwM.p/? V;oiêkX=ai̽D=hD2-KgQ+KW~#wBhrAm07rin"Y6_{3>0sfyqM_hYd<FƠ%S̓Ý7	Nv`Qg
w	ZN1U 0ex<p~ef-Z2pX"׎L5$xK3_Rβ1ӷž؃txC^p܃}Ayp/z|j  yvOݷ/;yvWHq/z?GM1?o$h|Ɗ|Ji{O6z?vW{WTL*	W÷`^u4']ѓW{?uW톒ggzNiAmRz3M9|Z럈0٬k%+fz=;(VrM[]SdRI0ee<BxLAt TN`E%ulV|Y)eLQw)LH0ukO~LV 3ishj>a??/VGd<RT; mX Ej
#0j:sB9{rO&D_/:-qlȦ?lo!?@.:̗CU4²Am6qʒ=H8@sD(䐙}y;癳w%z8Cٽ۽7/w~r{7nm@P~䄞eڰpu/2J<ftdI{ߠom;8Vb132Jx kEe&Ҵ,xyirZmoXi;<o"Ullx*-G P؊}IJ8ax9phgVa^K<,i-	6#33+9~MkU~}ZA{/ל,9fcXnjPP;5&vɷ~{s|ţ_n1̲]fve/VɥB,6մA9>D*5X.;yDd4,b'3eEZ49CRڜZmh?J_:eC17/Z^.Bx"w'!}!Sl	?Zɛ9*cUk6]k&k7i4ݝ^hR#ĥR<NOɻ,c㩏zO{{y vˮ_~^73xNȍ9巇/{}@{VoAsϽ@L%Hp7Ϻ%O2fۭn=Jk^pFe㓼A0v v|*@_8L?082w_u.v	 N7`wɧA$?GvS.zѿan''i,4ދVc#=|@neƃ==<5q(W@eV]@ݾn?Yl7O`gz:9)L&pR&^Tӯ?Ojn-[?.*2Gii#/3$eVU0k寚 b/OaJ;Wfe@ xZmxzW uN'`ma	V[︵ա*tl>+YK㙍Oiz%VAZ[:iNcDUg6[[tVgo4{#!gj:z X[oM촧SSz!RX_Фt zxMVW!H!wJ~\ʁı?#Q0Nilnm<KY:vr54gu/jjS4v;gA*+A=2h{OA&;F`#'3,34Ipn[G [;ҿ\jGyFEրQK}4;Hc Ӛsѧ[so"pN0 H63?6HQ
YzFq(n@4ֲu>ųΙ ?d)"}q مRXLB?|:LIa~9zTj!CÚw5(0AF&#qPkIc:f/fGD"FHɑ؟Ub!sRld1˩h̑p|Ytˏ
/_הa.1V<xcvB,˝2S>/to잻~0P>]6~k-nlXYմWz^vc*xF}ݮ5?_ld"Scx<_YuF{^kΠ~b[XWKVW5GQuu56\>3Z"ӾĄMPu#Xv[vjA[[~iwlnWYsZ@ӒOUB46֪ZFHٍͪvԁ,l5zjzmj۝ښլAeuZP%:5b6`-TtmZG>UF PՖƚ:Z[-|leՠ͵lڵVju]- gyMDfw)RX;PPfcrzkCtAv-@Z	{kup/8FZզ%ѨٝFgn:V}m֛V(:m	,)؀򠶫5W-|Z$uUwe/k6
@ɧF-fe0jqTYxޖWװ/`h_hYnB}S⦀[^kg
![-hD^ϿWHf_@!vM4۬5gmmU>a״";Doеk5Ś]_mR®B߶֑ڰxJ"a4gs

~AzmpvP<X|v>F)ɠ Je]`yPSyeJGL2ho/b@!5<О>%8N _g0/W1>8)li/6OOza-!}/'OT*Y*-w?`ǗԳmUp5Gڳ*PCֵ/9|'\eLol?r=~DDg,eVCǉjeCF99 2}a+JSr7O}T\/WryO3Hl+ ?*Iy*7pʄ~W|sw=MNM{qNyB?)M0;0O#>yV+yc6=]5/	J2<GNEd]W91_.eFKs
Ezyˌ>%qx>&/),$|'M+ƍe}\$=$fʢhck$&7ýqwenJ_oE
*~+C/	ߌW<wEs$b^awl9q~NC@RD~cf_wNxז)囁M%8#"X;tu>tO|2&@I|O2>Βnzl,XŊ'/<?_}ѻxu:+5ec;%EQjM1Z.[s?	did]Q9M)^gVaMTWыK5^*YRXNJFlQI_(ra<j(Db?Wj	LR6%RJ߉<>zᇹpa@٤6e"s
9npr8Nrж`馑E0uz"(˴ςq[RO1¨t nOUkWM6sUR1$[QQF2N!%,\6Q:I81SxK̺]V̮E2NrEwn]{smNwh7^7S
?4G%'{]J"rJiq#U$L,̾vZsgo{p3q+4$l	-Xљw}W2_^\ghhG|&ǻy\2R=PYyn-\GIjLHKYDX
!i+@ ī#$37VjFxQœysMK+Z:JL+R@DY Kc}!z4YYʗ߼`3yqd4uE1&KpH_Wl| <
,БoSl{&j_d92R!Z;b+R.N*}r~%HIb|n?ײr$ɕ 9FIbఊ'bSK&VJ~Usɋiٗt䱬CI;3}	
T߰*^Y*
yM'~&_E>[0{N::@K6 f]	33.[)V25+(YЍ'ji8zet3Ccc2*>pe*G~"'CN{CYE/	\gz8A&}R|5h#KR7=Q7d.Cݹ,q۾eP^]fu:K"!9W7r,
UG3]7@	|Dg" ,%`"$
=V$90QKj4sN`.0xfj<2HBQOo#>IlT%ee	/:nM"GlZM;Yd WbpE_L#hp)b1yNwG6Og'Թ.V^,8Z_*v'6j
ƛW;ogU*) ÅZv(Y deeάdXߧLBPneO7y.f#zv8>%߾hc
ρdO cٔɴ5$XbWY9wEC|QKDf!Q0rY C&fdCB	]*5[iAƋ Hwr7&3 mm2Ȱt֟2+.<>a X]?
eFFJ߯Pg %COMSt
ʟ4fD=R<(z;<'J<bz2Kz9@MfN*hZ^ceEWeF&MqT.WLm>5	5ް=1%YKDEeqicfmE~9EUGJSYf8>&RɞZwWuTK /[z3:?p0wZa"F?^Ȫak`3y>7bs?u×4|"@eMo14BN2~ձ_4  لO1O^<5y
s` ~9rܨ@q`Wo`52 T&005x~,n܊P.32*m.kp`v3p4p.aP5x`.sXzMŇ8;dc?aŝwˇ(]ܸg2)aRᥬ"OB\Nb$U0BWM"y@ ,Tmӫ}Ā/_Yw:eOeIzp	0Fؕ֝g@Ie4Ux	Y~NF# |na-u
. sOiyDpf\&cԆ[YL픢Ix`%U}r
sȟ!ъ|uܵM{ΠsVb/eb7yo~S.ȚԽ 0atd|@|	URbIX/NtɢbC.1/.e<NN~v(-5?zn@rJSjjI6W۬N/S+ePkݬ,"^(]t8\Y ݲS:N~ekS/>O AD2:.|9ǁLVO|an
_OЋ@o(0:3ײN"	:ьLmR*kF$N=k@~y	(* EArB_.-J(4!1Si09c	ޖ`?SJ%Y@^}̱b?x0rv4e1:.P9y	30 6-0Q/߿Ǎv@N<	ږѻݷ6gr@#AˏA:O9b&?tdmk-6w)<afa^fo	̣^ЬCzfi0`XN9{LQ(tG$ǍQw5`3?=}S)Qj\ӳm(:$a{@ͱw_t9@ }'zqjkt M}hv؟g>d	`m`bmt%rBRQ=)['xEbIƻd4
_Au/C8ք㞖ۼ?@bØHlTaE늪6S\nOKJBZh$xS95ɗtTj̈i!ih%|?cb^ψl:$&K&cPP䈆H]4,tj۔r(G! [`*:YOh14W
0+ &]1#|;LH3Tc>o'" bPU(i_ɠ[ưܭS5Iw)PKmeF
,p5'0xhϸ_]4)PY;%8Z)=ĤQbsS swG?ܓX Nm҄d@`A5,_oID~a:e_N[t(&?~U`{/;[ͷ6ps/a^D~U?1[͆ҩ{j!\?:J&{=Wwt ܬuji.a?Dn){&ņ1|`-| aGM,e%/gYŒA*fϴ.`"Lnk$4)F,{6Rj-L> W]W	k|t?"|B<qDHƞ.~<<ܣ	F6Ms'jh<Jtqdh`n$]Kzr_JLL3g?$ y'f/}JBˋaq.UQK+@=,ΆI%)lg,acx˩jux'q8k$	L@j4욙ENVѨ.h:Le78"Jo+q㼎w"Bko입Lm_ptT%%&ӉT}s˺!4R%5Tx+>WI~2këqe_Xișku=o}xX.ty_lw|eZkhÓ$GxХG!#/'qo,=uYڡTzg	ӽFiHݷs;_1+2fvLj]I߁!KMK g.hh1KlKᰄВ%&	 .RRIo2SX!`u,;	?j4 ?,8	IRA&]-6A7%f ^ۚCn1V/z-}x_"?Ο
K	{ap}79O67>z@^͍|>Y RSs$Zhq8'hGӤ/]wj/M5H}	IaM}7Mtn'F+6tL܊TRdy{}y>N;#3eA{Q:bb(k H8FEPJŲ9ģ>e}xj4vWj3)hPR֮gtE2}j@_Av_)(Pieux>Y8tDrV\>,yˤHO(e©o
Z}Bv]
Jq VOcd[b-1hN4|Ik`ʼbka(+9e}n5z]ot\hV5Bo_r1
:p֜`n$ڎ%2ۊjϑܘu!J˼laj %9,)`|1ȫ\XՒEՉ#D7mszx@jȜLf0s@}N@L>ENUɎޞN>GVqt-WP ^$Hu8Ԍ`1>sQ`;XGbXኔvcΛ+y-S !s3&ұ^cBsTA:L0,R:?yxO_pg<5Rh䪢'YVe>Em_צ6M6}\ b 