#!/bin/bash

declare -r e2c_version="0.3.1"
declare -r e2c_os="$(uname -s | awk '{print tolower($0)}')"
declare -r e2c_global_dir="$(echo ~/.m2c)"
declare e2c_loading_pid=

e2c_logo() {
    local logo='
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #######################################
                  #########         #####         #######
                  #######    ####(  ###    ####    ######
                  #######    #########    #####    ######
                  ########       #####   **      .#######
                  ///////////       //        ///////////
                  ///////////////    /    ///////////////
                  ///////  .////    ///    .////  ///////
                  ///////          /////          *//////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
                  ///////////////////////////////////////
    '

    echo -e "\033[1;34m$logo
                                Emma2click
                              Docker Magento
                          environment and toolset
                                  v$e2c_version
\033[0m"
}

e2c_loading() {
    tput civis
    e2c_start_spinner &
    e2c_loading_pid=$!
    sleep 0.1
}

e2c_start_spinner() {
    local sp=('⠋' '⠙' '⠹' '⠸' '⠼' '⠴' '⠦' '⠧' '⠇' '⠏')
    #local sp=('/' '—' '\' '|')
    #local sp=('◐' '◓' '◑' '◒')
    #local sp=('◢' '◣' '◤' '◥')

    printf "\033[1;33m"

    while [[ "$(ps a | awk '{print $1}' | grep $$)" ]]; do
        for i in "${sp[@]}"; do
            echo -en "\b$i"
            sleep 0.1
        done
    done
}

e2c_stop_spinner() {
    if [[ -n ${e2c_loading_pid} ]]; then
        kill ${e2c_loading_pid}
        wait ${e2c_loading_pid} >/dev/null 2>&1
        e2c_loading_pid=
    fi

    printf "\b\033[0m"
}

e2c_trim() {
    local var="$*"
    var="${var#"${var%%[![:space:]]*}"}"
    var="${var%"${var##*[![:space:]]}"}"
    echo -n "$var"
}

e2c_msg() {
    echo -en "\033[0;32m$@\033[0m"
}

e2c_info() {
    echo -en "\033[0;33m$@\033[0m"
}

e2c_info_bold() {
    echo -en "\033[1;33m$@\033[0m"
}

e2c_error() {
    echo -en "\033[0;31m$@\033[0m"
}

e2c_error_bold() {
    echo -en "\033[1;31m$@\033[0m"
}

e2c_result() {
    local res=$1 \
        noexit=$2 \
        error

    e2c_stop_spinner >/dev/null 2>&1
    tput cnorm

    if [[ $1 -eq 0 ]]; then
        e2c_info_bold "\b✔\n"
    else
        e2c_error_bold "\b✘\n"

        if [[ -f "$e2c_log" ]]; then
            error="$(echo $(cat "$e2c_log"))"
            [[ -n ${error} ]] && e2c_error "$error\n"
        fi

        [[ -z ${noexit} ]] && exit 1
    fi
}

e2c_ask_bool() {
    local message=$(e2c_msg "$1") \
    only_y=$2 \
    opts \
    res

    tput cnorm
    stty echo

    if [[ -z ${only_y} ]]; then
        opts="[Y/n]"
    else
        opts="[Y]"
    fi

    while :; do
        read -n 1 -srp "$(e2c_msg "$message $(e2c_info_bold "$opts")") " res
        e2c_erase_current_line
        if [[ "$res" == "Y" || "$res" == "y" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=1
            break
        elif [[ -z ${only_y} ]] && [[ "$res" == "N" || "$res" == "n" ]]; then
            e2c_msg "$message $(e2c_info_bold "[$res]")\n"
            res=
            break
        fi
    done

    e2c_res=${res}

    stty -echo
    tput civis
}

e2c_ask_text() {
    local message=$1 \
        default=$2 \
        error=$3 \
        error_info=$4 \
        validate=$5 \
        validate_value=() \
        res valid error_count res_count valid=1

    shift
    shift
    shift
    shift
    shift

    validate_value=("$@")

    tput cnorm
    stty echo

    temp_term=${TERM}
    TERM=vt100

    while [[ -z ${res} || -z ${valid} ]]; do
        valid=
        error_count=0

        exec 5>&1

        message=$(e2c_msg "$message")

        if [[ -n ${default} ]]; then
            echo -e "$message $(e2c_info_bold "[$default]")"
        else
            echo -e "$message"
        fi

        if [[ -n ${res} && -z ${valid} ]]; then
            error_count="$(echo -en "$(
                e2c_error "$(printf "$error" "$res")\n"
                [[ -n ${error_info} ]] && e2c_error "$error_info"
            )" | tee >(cat - >&5))"
            error_count="$(echo -en "$error_count" | awk 'END { print NR }')"
        fi

        res="$(read -er 2>&1 | tee >(cat - >&5) | tr -d '\r')"
        res_count=$(echo "$res" | awk 'END { print NR }')

        [[ ${error_count} -eq 0 ]] && ((res_count++))

        while IFS= read line; do
            res="$line"
        done < <(printf '%s\n' "$res")

        e2c_erase_prev_lines $(((res_count + error_count)))

        res=$(e2c_trim "$res" | tr -dc '[:print:]')

        if [[ -z ${res} ]]; then
            res="$default"
        fi

        if ${validate} "$res" "${validate_value[@]}"; then
            valid=1
            e2c_res="$res"
        fi
    done

    TERM=${temp_term}

    exec 5>&-

    echo -e "$message $(e2c_info_bold "[$res]")"

    stty -echo
    tput civis
}

e2c_erase_current_line() {
    echo -ne "\033[999D\033[K\033[999D"
}

e2c_erase_prev_lines() {
    local count=${1:-1}

    while ((count > 0)); do
        tput cuu 1 && tput el
        ((count--))
    done
}

e2c_in_array() {
    local entry match="$1"
    shift
    for entry; do
        [[ "$entry" == "$match" ]] && return 0
    done
    return 1
}

e2c_requirements() {
    local test pass=1

    e2c_info_bold "\n[Checking requirements]\n\n"

    e2c_msg "OS compatibility check.................................................  "
    e2c_loading

    case ${e2c_os} in
    darwin | linux)
        e2c_result 0
        ;;
    *)
        echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
        e2c_result 1 1
        pass=0
        ;;
    esac

    e2c_msg "Docker installation check..............................................  "
    e2c_loading
    hash docker 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    e2c_msg "Docker-compose installation check......................................  "
    e2c_loading
    hash docker-compose 2>/dev/null
    test=$?

    [[ "$test" == "1" ]] && echo "Docker-compose command line interface was not found." >"$e2c_log"

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    test=0
    e2c_msg "Ports 80,443 and 53 availability check....................................  "
    e2c_loading

    local ports=

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=traefik" \
        -q)" ]]; then
        if lsof -PiTCP:80 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 80 is already used by some other service." >"$e2c_log"
            test=1
            ports="TCP 80"
        fi

        if lsof -PiTCP:443 -sTCP:LISTEN -t >/dev/null 2>&1; then
            echo "Port 443 is already used by some other service." >"$e2c_log"
            test=1
            if [[ -z ${ports} ]]; then
                ports="TCP 443"
            else
                ports="$ports, 443"
            fi
        fi
    fi

    if [[ -z "$(docker ps \
        --filter "label=com.docker.compose.project=e2c" \
        --filter "label=com.docker.compose.service=dnsmasq" \
        -q)" ]] && lsof -PiUDP:53 -tn >/dev/null 2>&1; then
        if [[ -z ${ports} ]]; then
            ports="UDP 53"
        else
            ports="$ports and UDP 53"
        fi
    fi

    if [[ -n ${ports} ]]; then
        test=1
        echo "$ports already used by some other service.\n" >"$e2c_log"
    fi

    e2c_result ${test} 1

    [[ ${test} -eq 0 ]] || pass=0

    if [[ ${pass} -eq 0 ]]; then
        exit 1
    fi
}

e2c_install() {
    local archive test

    e2c_info_bold "\n[Installing commands]\n\n"

    e2c_msg "Locating archive.......................................................  "
    e2c_loading
    archive=$(awk '/^__ARCHIVED__/ {print NR + 1; exit 0; }' "${0}")
    test=$?
    e2c_result ${test}

    e2c_msg "Extracting data........................................................  "
    e2c_loading 2
    tail -n+${archive} "${0}" | tar -xzp -C ~ && >"$e2c_log" 2>&1
    test=$?
    if [[ "$test" == "0" ]]; then
        ln -sf "$e2c_global_dir"/bin/e2c /usr/local/bin/e2c
        if [[ ! -f "$e2c_global_dir"/ssl/config/v3_ext.conf ]]; then
            mv "$e2c_global_dir"/ssl/config/v3_ext.blank.conf "$e2c_global_dir"/ssl/config/v3_ext.conf
        else
            rm -f "$e2c_global_dir"/ssl/config/v3_ext.blank.conf
        fi
    fi
    e2c_result ${test}

    case ${e2c_os} in
    darwin)
        if [[ ! -f "$e2c_global_dir"/mutagen/mutagen || "$(echo "$("$e2c_global_dir"/mutagen/mutagen version)")" != "0.10.0" ]]; then
            e2c_info_bold "\n[Installing Mutagen for docker sync performance]\n\n"
            mkdir -p "$e2c_global_dir"/mutagen >"$e2c_log" 2>&1
            curl -L \
                "https://github.com/mutagen-io/mutagen/releases/download/v0.10.0/mutagen_darwin_amd64_v0.10.0.tar.gz" |
                tar xzf - -o -C "$e2c_global_dir"/mutagen/
            chmod 0755 "$e2c_global_dir"/mutagen/mutagen
        fi
        ;;
    esac

    if [[ ! -f "$e2c_global_dir"/ssl/certs/rootCA.crt ]] || [[ ! -f "$e2c_global_dir"/ssl/private/rootCA.key ]]; then
        e2c_info_bold "\n[Installing CA certificate]\n\n"

        if [[ "$e2c_os" == "darwin" ]]; then
            pass="e2c"
        else
            pass="e2c0"
        fi

        e2c_msg "Generating private key for CA certificate..............................  "
        e2c_loading
        mkdir -p "$e2c_global_dir"/ssl/{certs,crl,new,private,serial} >"$e2c_log" 2>&1 &&
            openssl genrsa -aes256 -passout pass:${pass} -out "$e2c_global_dir"/ssl/private/rootCA.key 4096 >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Signing CA certificate.................................................  "
        e2c_loading
        openssl req -new -x509 -nodes -sha256 -days 825 \
            -passin pass:${pass} -subj "/O=Emma2click/OU=IT/CN=e2c.local" \
            -config "$e2c_global_dir"/ssl/config/rootca.conf \
            -key "$e2c_global_dir"/ssl/private/rootCA.key \
            -out "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
        test=$?
        e2c_result ${test}

        e2c_msg "Password is required to trust CA certificate...........................  "
        e2c_loading
        e2c_result 0
        tput cnorm
        while ! sudo -p "$(printf "\033[0mPassword:")$(printf "\033[1;31m%s" " ")" true; do
            exit 1
        done
        tput civis
        e2c_erase_prev_lines 1

        e2c_msg "Trusting root CA certificate ..........................................  "
        e2c_loading
        case "$e2c_os" in
        darwin)
            sudo security delete-certificate -c 'e2c.local' >/dev/null 2>&1
            sudo security add-trusted-cert -d -r trustRoot \
                -k /Library/Keychains/System.keychain "$e2c_global_dir"/ssl/certs/rootCA.crt >"$e2c_log" 2>&1
            test=$?
            ;;
        linux)
            if [[ -d /usr/local/share/ca-certificates ]] && [[ ! -f /usr/local/share/ca-certificates/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /usr/local/share/ca-certificates/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-certificates
                test=$?
            elif [[ -d /etc/pki/ca-trust/source/anchors ]] && [[ ! -f /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt ]]; then
                yes | sudo cp -rf "$e2c_global_dir"/ssl/certs/rootCA.crt \
                    /etc/pki/ca-trust/source/anchors/e2c-root-ca.crt >"$e2c_log" 2>&1 &&
                    sudo update-ca-trust && sudo update-ca-trust enable
                test=$?
            else
                echo "Currently we are not supporting $e2c_os based OS yet." >"$e2c_log"
                test=1
            fi
            ;;
        esac
        e2c_result ${test}
    fi
}

e2c_on_exit() {
    e2c_stop_spinner
    stty echo
    tput cnorm
    echo

    if [[ "$(basename "$(test -L "$0" && readlink "$0" || echo "$0")")" != "e2c" ]]; then
        rm -- "$0"
    fi
}

trap e2c_on_exit EXIT

e2c_log="$e2c_global_dir"/log
touch "$e2c_log"

if [[ "$0" != "/usr/local/bin/e2c" ]]; then
    e2c_logo

    if [[ ! -f "$e2c_global_dir"/build ]]; then
        message="Install Emma2click Docker Magento environment and toolset to your system?"
    else
        e2c_is_update=1
        e2c_res="$(e2c --version 2>/dev/null | tr -dc '[:print:]' | sed 's/\[0m\[?12l\[?25h//')"

        if [[ "$e2c_res" == "$e2c_version" ]]; then
            message="Hooray! You have the latest version of Emma2click toolset. Reinstall?"
        else
            message="Emma2click toolset v$e2c_res is found on your system. Update it to v$e2c_version?"
        fi
    fi

    e2c_ask_bool "$(echo -n "$message")"

    if [[ -z ${e2c_res} ]]; then
        exit 0
    fi

    e2c_requirements
    rm -rf "$e2c_global_dir"/{bin,completions,dnsmasq,docker,functions,local,traefik,www,build} >/dev/null 2>&1
    e2c_install
    . "$e2c_global_dir"/functions/e2c
    e2c_global_load_env
    e2c_sign "e2c.test"
    e2c_res="$(pwd)"
    e2c_global up
    cd "$e2c_res"

    e2c_info_bold "\n[Installation finished]\n\n"
    e2c_msg "Emma2click toolset is successfully installed! \n\nRun \`e2c --help\` command for usage information. \nVisit local https://e2c.test to check useful links to included services.\n\n"

    if [[ -z ${e2c_is_update} ]]; then
        e2c_ask_bool "Initialize new project in the current directory?"

        if [[ -n ${e2c_res} ]]; then
            e2c_init
        fi
    fi
else
    . "$e2c_global_dir"/functions/e2c
    declare -r e2c_project_dir="$(e2c_get_project_dir)"
    e2c_log="$e2c_project_dir"/.m2c/log
    e2c_load_env

    case "$1" in
    global)
        shift
        e2c_log="$e2c_global_dir"/log
        e2c_global $@
        ;;
    init)
        shift
        e2c_init $@
        ;;
    sign)
        shift
        e2c_sign $@
        ;;
    --version)
        echo -n "$e2c_version"
        ;;
    --help)
        e2c_help
        ;;
    *)
        case "$1" in
        up)
            e2c_local_project_check_dir
            e2c_local $@
            ;;
        add | down | logs | info | remove | restart | start | status | stop | update)
            e2c_local_project_check
            e2c_local $@
            ;;
        bash | cli | composer | db | grunt | magento | m | magerun | mr | mutagen | node | npm | pull | push | redis | share | sync | varnish | urn)
            e2c_local_active_project_check

            e2c_res=$1
            shift

            if [[ "$e2c_res" == "m" ]]; then
                e2c_res="magento"
            elif [[ "$e2c_res" == "mr" ]]; then
                e2c_res="magerun"
            fi

            [[ $(type -t e2c_${e2c_res}) == "function" ]] && e2c_${e2c_res} $@
            ;;
        *)
            if [[ "$1" != "" ]]; then
                e2c_error "Unknown argument \`$@\`. Run \`e2c --help\` for usage information.\n"
                exit 1
            else
                e2c_help
            fi
            ;;
        esac
        ;;
    esac
fi


exit 0

__ARCHIVED__
 ٯ] rH(د_JL',XUiݚzFd V& IDggck{}5ۯ/Yw 䅤nBUL\n>UmF-+.Vo[vnYXo6ڟ.Q q|(HɎg#ڑN.?Ffټ~6XvU4[}Eþ\_]\翅W~E?
g | ?<4!'h |tZYz] _oj;旆8tc 17..Vvwqi/~Aj׼dl]S6՘;~8`YՍЍB,Oݰ{#1;qOG,r37qY|Ey~ck#wWgׇB`	.TX|wƮ,{u5Wǌ?(顸mOѲ[qk8 zSBroapFڐeGg<fBpvD1ٱQQ7:w8vIثRjΛt׎7uktk;QśaػiOʏF;7MĘlc*|)A21$^=x}lVטw(r͕Fv<xa{{_>Gu#2|UqY^NB;we? 1s7:uo4Nlwr=|@?GNtZ*y06+[?GΨx4`ʇf]f}|s|4	n1vg#v)L8YtLGC1~q?i8?]<kc>܏^cT!`gN{is$Zm7ʬܲJ6;rD<{tuۡmۢM۠u[+C1^ ٦"Td䠶rE6ӠbTLɵ;tx&5I5	&٤"Tdl.
TA m["
s$
dVaF`K69V%0Z:f%eUѶ]GL%,=>*	&2PUfOCOG#x:e.ouA43	./k+QߒBv
~DΙv, XJ$i?$/1 ٘5ZJS̵ȍ%;		[vU4V6M|kJ%<d_d>N0fؾ7{agf<\A"Ix˂5[o#1=lF+\[Ѓą7p{bšŁ'p"lU؉{O<l>2}sdfWW効߅$-B (Nm l`Μ7YϗJ]#/fj
K5֎յYα~ݲfm'šSRU=+_tZ1rg5NmRW%f}'Lԅ u>"S8;kVyE"qC߮$Ǆd5 Vw߽'& JBId 9N,T4'N|lm
%JI*__ $6vnQ#旯u|DM\p᧷IN;/vwֺ+Z,}_%VmE` գ3
Nx4ȡjJ}wx+p5f*UP}SѬb[^\JLRǲŕo<ڍ]8~\^ Z?rQA5	#K
()|3tYA߉]0 y'Vz1M`1(3vr8qJ6 ʧImSIک nIa|kklmc_z}ڬT$7"Un_$r}ǘA$ћK_	k\j$Y3!͘8jx!D8mF(|cʀ擄KN%˭v^Y|
ǂ"^7˼/s}_؄ݭg+dzQA{;v((/[{vWȎ3
f埋Z/<7r退=Ʌ#/<\EYy9c/]%R&lt)ݴ@̙0]u| 0oI!@Mhc)A0ts\` #4`Γhg?>͕AxLϷ.X8}Lw3DDß1*<Љ3 3bn㟸CYԾXaR12n:uGJgxW$`uE>T/Q4W}"Ѳ%S%{c,gbl%ɗ-Jg8/IEaMvgXxO|(rNG +ɜ_앙5ɾ!3ֿ<:~kGgӒA7dt<4|xfU:RPG
R5GhSĻ]*9>HLC_],\"
o\@J%YV|1q>v7YF_L[\;ukϺ+G*/rd(Л^l^@gfnx7,-Fg;w_cϻy*ZX6spђ B[uh(˂H-oْ#ix~bZIq<p<SsU#w0]G'dV+Y-ڿb	7PKG;R
9$hێ{mc@pc
]F Qdg"Q>`(^cF'#_$-HoFZ!)gvF$g+|#{e%믞_˯+6`(}c#ϾgeS	4L5eHv:d(jyPAkVUjS %e>%^W^tJW IM>s)6ۛbه`чZiÖag$`"!=aΒVZMMI4ǻi)]aiR崕XqFF`Ĝ .)eE8RE[މb޳wYLۢ%	/	~,%ĕ_[YIl-iD$KŒJ($=,@,D9P@(5*5 7!ҏ{髆#DE GEPwV)@M B֨nr^8KzrޙڳeVURdG_t+Rl%$QLc+xhqFyŸ!(dy)cf'%^$9"X1:ESp8] bWҒq(8&	W*(%%8`j*a)Yˬ+IWKKK)Puom^ai8Cbv)D/$ԆL^H9
نگYzJ<zD1ZZW&Њ6P{P n.%6gF2$ܺDhi
nR5sJSѦD.b"'fe,02]jfvDlY3^~Ed2i{~,I.iqZIXw~u}	ȜBb(%zSTAYS>>OESqRNණ'֣tyt3=YLw XYnaېrTfLc\lYr\ 2e-/	|UqyL6b<y>t-sDbeP$I35:tZ~3j't-ssK4
ř]u^9,ȿF1Z9L~םLCK&CYAIsH?m䔭q#,N0ό$'EV"$/؈[SE:q`R`ەhm哼M~4/!
+;Ƀ}*$RtgI
K[`&_;G &|d>bx
0ƗKDZNN
rTTKj8jD]5Jf=;{uƼə,N/٫Q~TyՊZwKZ(ON'g8LF 5$yɻ?;Dfh5G3iܼm|B͒Ƹ"	(DN3(|ictmhZɏF*٩EPœnd%i#?ifBQew{gu`kWvFE6;KC F.
a1A
4BsνшNc?45t0Y.k|-h[=EPzCB/r(/t(
ŠIO=n\(J;yrJ
wFH~Q*rq\&Z2
XV$9BSLbKL	K$TA5[䦙EӢ1FDUtzTLdxȉVN>rzBA~+ TЪ
bl6 78Ȱ0LD`SWkBBwĮ<Y%yKeθة˭i'Ds҆y`B1tGSu#{1r!:bWxx
$Vf	"Q<` éϖ5䚵DІ_`	3ĮOYsHYvFt{
kBZq`a>`gDY)LqLg}VT-p2L94&܊PQ"ʩ<Fӱ""aCSodiᙯ\h$)4>u\q#*"y?&o? ΕL쟘i#ܙ#+'fdNƀ(&[N:] IF#D4nWmWE;Fb~.iV@S>f\<ʘdIV]M!rjuę$UB6AErZ	A0,tz3fE=^JL:l! #4R:ȡ!ai$/9=#ty03sr6p8W6HZ}X?vxOm=Aj)9/H.ja^ϑj	>*]ـږxq\;S;o48Ǟh7E%XsR~_9VzB젹% OLbL8>ߓ9HşǹA)?F Y\ |K .%VmZ:RF(E!b&HVɔ YI_!
i	Ŀ?v֟ FC׊|gct=cEHYП{~NNG?gI{s:tƇGIn	k{C1_=LAܳ.ARձ"Gb_UU*2HBZ!<"{Ə}[=sBxG߮f^$WISիʯ2{WZkh(Ҝd-оd"̀q*u1N#!)#C>oȺQ Ռ9HTz)o'o< wyt(bP¤f^`jPG(-znjEq2z'PB?#jˈEXv]z9 oA61;	(/(P9NRNFE$&1HFϤEiIBr)^qIϢރBnF+%cCH
>	h荱O73I߄OEr/-猼_]%]hӦbf(=V
9?fc\Iml~6CPd77,֜'|9dF|cLJ)HL-"Z_\u{R""zX~)zX;,*0T*,}0$@ڇ@eSz_hĔEk0Rsa"6ѰI|EYwhdޜ
JR@y	WV\!F3!}Zh,G8PI1͗)NX}ǜ#d2 <F{y 7&rZ±9>'IRlv?Omq~j[Jvɑd>H턞<u1tF?wC8HYH`Su#b\1zFi(4Or9j&k#6fiM:)5E Ch"0DX.~;-~[W&Dcj^$țiɛiț1)>Zd%YAV/~M$5	|M_$5	|M_5["+u*d|P+c8]=#Hɘn#[O:]+k&w$ 4IyFQ$I(I-IR3'y ɺ~WO9XGe2pK\ ў'HdHʲĄю_襉cj̨D24ic)]f+/3Ny&_vrCiV|Da:O,qHz_E	x}Z{ON,ɗ-!Cg~gm$&S{	D/@ЎXCz. '.,
$NdgrʔaI.{LTP!oL4\ VP
/6.Mo$~҈q;.e=5*^SEѴOԦzg=Uty%$dا#3&BL¼K%҃C?`Edl
pI\Yc1#Ϭ$0jEf;0̥ݵƂax凅FB̩|}█W%77"\)ܓ-]_lE_ΰt6<_p3{J9@䐉핐tX뽔@cEW6MHBY^jO"m{OTi1`)%vٴ$.so9e4$A#y	HC݄<4eZQxUZ@{U'}Wa	AoBe͵"'0(R3!xHkބ<˂"=PE͑{ēzI'qu';rO3Ti#' kAiǨF{
+-\ykછ1,%pٷAݍHD'J;o\+$۝7V=$h^D^qcS.ڍ_4z2傀hq7+~K#G{r]umd"J/r?padި>%Z"ӓ$;x*S5]bAkpt>SnL<{~Ÿ ɢ4nA@Alh]cI$n2ZQJ"+kDMvɜldq0
pmVZІ]UtjQk=h ~0z2:x-1;\Teh,'Q5-aZajC'Edj0]i--{K)Rc)ly^jaA9(jon,p}D7@BN0Wu<Bs.EhynuE<k!|SsZjEm56ŊMs36}['SYP[KtY b-;sd9
s$ҏ6b+Zh琗gVl&͒zЍqb͘U&Y3 `)`s@ukݺp1X\~ W26X(Z(cbV#-戁F{m=َkS33ff$pXr 
{$coew:hgbQMj9[]%3u ŉ{Nq5wW4=ӣϚoylĭ}良Jfk~49ҲOz+яQmSogn6`M\f/i>k6SFU\`ޠ+3r(ju;Tв<*,O$XDs]"liu0`l|"IEl.~0J2"?i:{r2HܲM:[NGݏcy:p3 O|'"\}μɛm\rN`_
Q:k%S;}k8[-mf+qthBW҅愔kȅ*R=e&͑Ӊ>Ď\Xݹ6?-}XMran2a`2˂g&uџŞ$Yg{Ugp#y"̼>\ }@%to)~BQw*GoWB5YY7<*2wra\;{9&N0?{fΉ"La̾#DұFq|i|woȎ6cnTw\ Ŭlw^},B?C6*Мu'SJ%ǋ[/
^%۽W?35v_W5 =؅/1=tѓp:~ԧ.zCH~GUz=n[1gv0Ч;o@?\ʬ,8	f1BqF0hSX$@>yk	Byh21G7ܵ<0LˀA]xb3.ԚTLpvN[tF*`x"fO0t0ɚ ;
08.JiԨН.VAֺbcfr0σ}-#94F?c'^_wՕ~+1m#-|?[eyȁaXlݤ\Xb]uR8Xab_.+/*2]$|/QJY:dQ{AgpTYc[ HghnHo7g,S(:aA\o4HX]n[<F'^-nu'u_pB7(~#ab44,<w6d^45%lRhF02V)FfƯdj_-LFSQ)I͈5TQ]GK禀'A0dc0}1rȬuqfcߨ(y'59@oF0Y{ɷWߗfх?.US.y$=^E#םz{6N+	5ꭉ5[FS$q
jaey֣	lIknxņ%gT&M9+0>F kklmc_z}H5V$!ũ4%*2[d
ydsJ)m⎸꾅RjUpoЦ7Ŷ򸙈Fq˥[F	ӘYV_$M#ST[fgDP0Ht"!߀e8%N )5]RaM@Ԧ)i$`4=j6>5-c#du'6\ڋhUՖi)p/DWUHVE(,M

ųKcZIujǜjvS9ǝ<k@ԃ%:MZI!G&Y3]z^3ZS9W}fz=#MUƆ,pn5ekq4;pۨ#I|qP\̙ǧ@Jo84jm6!Skb`0WyC`c[!96!"	F.D)+T}Jq^/U:klESo>fA+ßm
SHgh._3Jr6:bϸBJ(sCc]6EP=aFښ¸l:Fq ,/JHc
˕S_nA
#J	jšM:]ZMA1ު$(IxB\X8$=}!0̜&sag)a]2>N.kDǞۍz0ۛ2ؠ|gG.mמj[Z&ȢVKr ;_ ^I}"(PjK^ؓ4G?{'[ötZZ{Ҵ3=+jT
 <aO(H
'}ژ-OUhn(tXG	JhTXc)yps^(8?)P.jeʴ#qV>$ics՝UFdZ,5̊F-EIW1"kwv-<oBӞ!h-3әDQIK(>R$?&|S'Z6=>^c@pT[Γ"4һ8Gu!y# Z</	SJ_hĔ塘~E0w.ǃ-^Oo*)%#2f&qcdqMO"dx$bN`)SV ;L(%U]YSz&*
¿e ;L'X޴
|Q]R/y]..EW]jpR"x"mkh!sv%FR^8f,r+[%l3eKMBe,tӠ^sF&mCŝh4ï\r7dTQ
haD#>"n{95,&A\<zÀo^-2nFaE\㳰k9oƐm5ᚏ;{(XJO6oͮpU2]ٗ3Y4ϤhHkPjXDDN.OlE*F9RUR[(k1mDrJpڄ|&_
>_Ĥ;*wg\V}1Urlcs`!s.g~.NVl䕧?J8oܗn1;V]̫<m8̻⚏"yަ;>fUqag&22L9]~b拊Tik/{i+sosaTt8ǜ3Lۗ_)9+l\Wn/7wnú0ri.6[ֻIsr2.eҹ-F/BF^_JYLlQ'W:$9#o8R#y~ 'dmNUs\+,7=S&B&KA\:`4
΋f6m6Wn(4K&9h')chf*.RJ,clwc gDW|VݴT'ӻr]'}i=ԷAd$k.ް@CV9MF7FΑ;h\d{Xn/P6|"~q*íD0E@rҫmS@WNq ?9=T	,N9>1{g['eώьboUfq:i`_Y+(+jԗWf8YdVc2}vuI:%]}2ZeòoU	#~W".!劶@ܣD/w\YejTUakVhtEۂ/^mR2fNp_رs\uCYPkj[\MHlfA/u87@|t'C9(`6W/pF[6qL+ BΊK1vrfz{sﱶTtP%xګ<4f,<ӥ>3ԸRƴCESeIdQQ80RHRѕ#	{scgpʇ ]Ӓko|?RFLۙ5[lcAJ-*]B:o2o*oNQ T)U$tTg
ƟC(6JJy~@Hޞ`	bȲZΚX \xǓqg(	#^yփCOCQQH) /H?gd/bF^VX5+7^r|(ѩ*@A|fcr&g	Ǣ
{.AwdnA5;BDMo
$,!ADiكFu Q0lf>sE4w9I([-z}׸^o^kaRAD?WãjB{X5?VsU1}cJqfQs @ܨʍGŧlӨLMN&nGJ1ԗV]:!:(>
hr7ZY[[3K-R8d촁?۝K[($Q+k0zv=euf9*jݠ:PDH5
?ג0ߜ$9nQ\nKa2G7PQ:c{ky6ќ룲P'92RbfH-K|g	sSBp13A=߳`ztV\^!ePuMYU=<v%8QNŋD15L7ba'5E%xݯ+o#ϗ8AB5H77,ю%&qE:B=W!\כ󜷓?RƗo+}z^ވM Ay+lI*6t`B{~d{'um'(20 NRBciKBHnyMAW,
@Tf3sxcV6䰛XrLgY'2&% d#JQs-zz"Q.d|`B8)'TV	7}[_}ZuChߊR`~;pW[?c#HXVFz? 0)WHl3;;dꖯE3/JdYpZ4l4%>]MXf8&/iW~L?qޱG.dSlrC:}}'Y|E߲VHv&kz Fb䔈$3HB].6/OB=0|A=baIa0^# Sڔ#fN%Oi#BE5y]wyF>3sMH}E0	T*nOa/w%z-\;!v%`(Dsf*vtnNVs0l_w2͵<pA
=-,[ˮRTIGsˁˁY*C?r`D{΄GKKK~`Ȧ_dvUUܰsF@Q"F$Cρ{hJՍU2E"T&E)A8M@$ٗbՖ:L⩶71"=\aLFCXcxuH|[<͐ZW)-0Q|$⒏tD^&RF~Z}$RMV<Pj3&Ef/:_5Դov437ThpQ+GJ_x(#Q1Q)[nڍT,g
t5t!	(:(Ih9q@RB~48r[FݚVCm򘿾V#ǰZAʷ/P|ADH%z7Sǈ	i \t1^TJblXGШ?Q-I'[qV\9YGZ~I,x	CP3O-y.mXI/uB'I3V	p.!=sG֢UAcr1ѩX-FxMKw
٥3˿N.vJ^,]hɌkP,_;T>2[)xHLCrgP6/Օ̠^!灅ܨ)mR.{De1ԓCwfDY_!w>.]O?#	NCW(@wGuͻEލZ9	[-Cg0xDϠr0pImU<T2nhXg#_<k׏)j.3wddc[1lmuSIx.-X\8^?=]Ľx2KO-8@RGQWݕOѮ -)LJH G:)ߒt`m;q=y^&\ ΐXZĮ-奬-ghTN=&n#w > t	`NBS1l磭	
Ň3`}O^F??SLįxW/xļ@>xa}x<$#u|+u>6O2Lr)	ω`e1;"Z=P4+8ϓ85B]r~1chW2´-1E7!q$V97P%I5ЁF(ELS5vCo@ġi]ԏ\Oy'~FHlj\_2iyi]%}Q/Ǐ&=pQ{Wrճ&ȱOWUynm3&Ϯh,,JU6;r!ڌB ď#Bі"sSM5H5h.2olJ)wU2Z~/xmqJXҚ0%d/ڵ_^~}xj>%읡'..5\h EUxic\M
C"Z<f>FlaHҰ_e&3FuL0Qq	0M׽g7P}{PݖN$Q%$5xĉzjSz eO491I۵M\<Qm4	eX0!ɯ01QG=5[ d\&hl{{@IBt?t72_*gSq!+/\-p쩁&ћ$܂{fKerXU(ְTB?V]uj}hPV䆒bApa&"'R$lTX7soF }|2H\T/^aq
ը3 #˥*[*nnrW`x4.XOI(X@3ckcQSNjBbgj,L_VwfiImcZC0wEd#}xk+Z]ۈEP)M3H	7yj,ծ*iGIDL\xOP]F<.:>LqbPXl${Q+j.^(`[<(nU{!-r+};j
?
sa5E8eq[DC9wEnG{{y^sd;0E:ޒ;rs8Vwt3	flՋUx,EBEv&$];7[tg l*Qk	Ϣ_?.~掲u@9xMP:存^J|:RܶprO]bcg`	oіΆvt>_Ɉl 5;hLܞܠ Z6Ez,OfpYQdy*FH|O< yAk/I5z5k1EICXj"BIQgw~ceʳ{
ȒZAP5),$|%x2y:UZ=hC;),:!˝LjgV3Ojןq0)~@	JQ*Sϛ?idP-/e9_g8fPz"W#9:/(o	MĲ#Oaɱ~6i70SBUE\'7pZޛgjzӡZvkZoZݬڷJ@9!U}(HɎg#ڑN.jF;3ԱhwVY.\qoG*~;5FV5f\z}Tzm;b!㰋`N~Q]E4b?ER:T cY7bVa48;BHb/:`AR:SŕL~ý%-=< yOb$y]^:mw$8G.kk6̯S7<".Y jM>ܹjVSZ !&m6;]ۘH5"W|

 N闩^I	I;ZbRN@qCÊZfUUＤQ_F:uű`cze)Nz^#Ehۖ>zcMYZ@tZ"ʧi[zRɔy
%wFZ\>x:dFg.ÏX4>-;^\ܚxyY^/cM:#Som훒2( )MR}_EȘCȃ
 q<"̆H٧MD}'GT [[ SN_Z:NSm8wZ]\-1G|8]ς)Lr!<
 &hƷ'eQsh/P$3F$n~^3:]fWmoI_8rc(7.+wIY=$746isL&/?t~ѱInt,f{CQ",o`*R} Cek $AMio=#*o}~&Z?.j%#I
J9Zn`٫;4-'W  >Zs^esMh..e.J2Ru̴)T<j!Kw4Eqm)	b0ת<%=Qe@ҍ?Mf.tB,y!
IVOD7Z߮7z֪ߏǿ6h{ζhZ׺9>[iW?UWxJ{Јd[`9|)Vu3Fz#8(57r
$Jn"Y_{=>0wށl7;.Y_uA~cZ2??kuMLq.&?7cB@73CNr<^$򀩒/À/z?ۭcoڙ	..[	k'rY*[^B{/zFϼ@!8~DLߞnTWcxřzw4?{	F3I֋C1{{;<}ϯ_􄓥+0/r~gS4ik_M=՛{WC&,Wݽ[/)MOiiN{('n7<{[ϾkvM{;v{m-?ӲY>}/Sk|F~b+~_Ј`.׳m^w',?4߂&ӷLK,'cg,s
+{]KLѳYea
gaKѮ`e֞ fCX_o@o[{4_kxu<+ȏFN(\Pm<SJ.Pi8rdSC^<ʏپLo#<)EyJ#$[-ډ<ς$^+yԣƙ>o~||,0<ZD/
܏s.Y]Zw"$lvJ7!I$Y.Eoᑲ;x9Q[C/Z (˂4dK:kB[9FhVee{SIm9r 9wFVKOzWr͕ěȁF;ows]XbֈLGMmlHIo^ܘۨ_Yds#ϟ~^zB{ׂ,9fcXɮkPT;f5&v$!{n|st_n0̳]gv}e/VɥBV,j RK-۝"q21蓙2"e^GOZ"a)Wmi/vu.C7xrҩ..Bx"w$'!!S!l	?ɛ99cUk6]kMŪߤLxdxƪ
N_/-FKy7cn۬c7a_z]_?aOKO)WvqSXOn1+=xnmŧ؋G4~ړ*dD+y9
]e(AϽa|(yZ7gdEp^/hFУxJY)R8oT6>O#hd܎Bgc//⏡̏m;/dc:

;
7qӠ?.w&]i`]8Ɗ@vc)SV٪^6L'?*G1/8ƹ׿Z<|*.Jpz'<	YxV0X_LZgzQN8=n.UdyjF6&^eH{5kfUsҎѨUh;`1^g6LMoCElt'_z^Zm"̚icg#l/}L(	:n7y%\5zӘSDGZDUg6to64{#!S,$6uVJh6ccc5f=cu(ޘ]@^;Pha d
r%?.tM(CsGr',676t%x,o8Cbe4:hdbSjl}VK!aK/iF@1`"lL	4A[ߝ_NrgyCg25ic Ll94ZXJsG䞈Z:@틯+̝yYq0PL>ݠQp<BΩfn$1Ҩ>(`6Gqqu [33,@Gx~Gl7au<C/:P
P<ߵ`!}Fxk>^Űf=wM&d$j,iLGܚH9 ()9R~R*_ޔ\,w#,b982;^R2Le!Ɗ@|,خ7;rge2[.g<m_/-vj5fkٱznl<k7Zc/vM&?5&8/ޚ2^k7Vm#ޭ tu56\(}~3ZD}	%M\pv}|lQMUk-^޴;Ma묹 Y piɧl! ͦn:Ѷq=Rvݰ u [ٴm^[va5kЪEUYTSf@VC6@76:<mtN} ]oٰhl#jcss A77ZViZMQ7vl٬74\bab s,B-Keln66A(wPx-y4:HQκܨ`!atooG@ϭu^oZh:nt6Vc7vk9hՀӶPXC4EнX@^rOnѡle݆Q蠟hA?ElLc6Z:k6 Ձ-kMG<u /n
Xаuh0`ls!&|@"q{ՂF4o5X<y}l65TiDZ66vM)C]Q(6zv4ֆVb	9SW7_00'Փl2EUᴮⓣZ<]LIPj.JP"|>\ITMmPA(?=_FA-#%i.>(tKp_4F{
[>LIk`:2Z'n|::Zb^ \|n=zC
&BH{R2
yҺE?GdZΊV>\P9i,is"[P^~oMi_؊@S*W\ޓQp<ƏJREm{<~.2aU/1]9oS^Sޮя|Jϩ?,gjz%of甹9$#^ʹ*Ydsi5^AS(+_$Յ0v|6as3qbc~4|*^y@Nxj&_U+C?_*!*eU40@͘o(!s)Q4")}6WW$Tx<aA<6UYNx	iV<}m"_J=.$]Lr="cpL^þHw/c*(p8I	^GYҍCo#X?|端=x%Wل_)A(cGfc]r?fdid]Q9ͨ^g^eMGؾRW"ы{+5*VYRXNJFlqI_ra<j(Db?Wj	LR6%R<>zᇹpa0̈fuܿBn$;ܳN-eiFB= 4TY/WDY0#q[	>F130,W~SoU|\J2fae+
1"(P)D+25J'	'r<TyoXyY?⢈@Ky_.ޫkoͩᎌFЁ}<΀:hJ8 qORE)
YFfYHXPo}E-쭴g:16Uo]9 [qGz"stߕLuW+W; 1``g%wkdC􄽂TCTUV ګ\X;mwAx)L;*?lE@)jX+`ed)z|Aʚ*SP87 j~$C_@ZZqS,V
KY
;O\cLDF q  XUȬ!ZT2z"
T.**.kkkI_]Q|ǧ!,rr<o~JAEȞ'WWU٧ʨIIdU+ Ψ_]sBހRі}#&T86@ Vu%+/8K\IjD'
^VBmSĴ"9YϟKy!#TRn<Rr?ջVJekk ZQ!t:	QU,S. =s^19蘙puKI4(H\Xe1B7> pBtLh/1Z ;PL-<zh'>c\GŲ9A&]R6#7K[@=R7`.C,Np۾+eG AC/.rTocčABQF5i">:ѩ5SErN[QߊE«KPb8VԶcdw\vDcf੔AzR|& J	P%_e*(KJ"#pk:q?bǭVTm9s0.`EP$RF  e:l<_F{P[y(OXShw (
;~ݨo^bV	ڄl5"P;{cL	 8LґL[BBmv|(5@4a~3	HM1,2ٹo(bN.i4(Ì%\%,f3ЇX)9ғ߈
'|wUV5)<0Zq2<]9Q"ӇY{A!(t9a(JucБݿ<S\jW2rE9i?Pt5cjMb^$w%ťkNBO]iTy@0|RM}?]W UMr5G<gp4rE+fxQjdZ+Tx㮳j`#Y^(W`) 	mc(b^h=b֤ifB,aHPfy%V'^|:=IJiyAQu8ܪg2EG;hpO~_acV􆜎!#K%3rk}UU= AO3<sbWf^ߦd{)ԉ!,V+q$MveUfL2M0\$ɰH:؋1pY:+͡yD'ǃpwH9p ^6>ÀNaFv,SH&Y[xp8sli(N<Y\{,BDJvmnw,2;!y~u诬\}K턪vۯPxiR,gsq>pLɎpewvn/Qp&4thxFmZf/U}0pM3%r%&B79{Rz3c%mh<@t+hc7XH,Iyrܬh!1ra"F5U}ųd8rC(R1dhI/	/r/cPG~̌IfxePa-~%GB-d4!.\&$`.,Ҁ͛42Np/ʔM 1䃇Tan zN/e&9GsOAu UdcI2r򐟿Dn	>t/cF/S{FrS0`,a+2gjVNViˑX-J4!	Svi 9%-tpJ #rE,r6$ex`KC	F	C[`(E}Nz*z*֊q<jT=1ݷ6ڧj`mF-?A\<`?SvNe#IBXhٞ+{X5%Khm1MJGY[h`hؘ1R71*$,qI#  c~Xl<>??LTmVԫlNNjJ
@)?Uq~,UU:!	O·r\5TpJoZ{*ڜTh:@.;|MN6q=%&S6:Vi呍Gr@ԷC,[CI(2YiTz4Jy p<
ƽŷyd&ņqň(sO@nh9](UDYu:N$`*%JwYbjVݐЬl4ْ!cavψ䮛l:$KJXhh$DhN6J/XQ4]	NPű?@tėS~AL>ri+T,AK&xx)9CeL0Մ)O1E_l_ʰT/j w|ig.-?`S`yq]8n>-ۙ֞qq-mYS^W$JP43ziuM9o>V;$dLFGi5֖-|sחh_ls?GЉ+k5 ?ŅQL~xnbب3:w.{7{?F1ko[KSikV'7Y#@su?3-e0<í~6eİÇ(	QI1~t sYѣ$u"<XɘYvJEH$SGZ	Ir&D=PwOkaQJX9gH#]2La٨u V{gҕheT.2_p"@PksV>i%;`6Fc^Τ%3uV47N*&/S~@]3wr0I<-5ЌM7Yp^E2JFS
\Wano	!YgEh_B>"N(g.j7fu:d;c:onY璷8~F*-s3oEoJg8n89X4c?ŕaxa f>\B%G^kZI'1<A}<gnZzdJ8\](yd'҈d	KVץwLK!a(m-<|iίWo9i7B~]\N:~n] >sD+_x\|\ўG%\J|U/Ǹ4_nMځ(xY*)ZbX>,eA{'=jiR	LhL IV? v9ptXǚvCxokF;r&x7}ǿ^KޗȁGxe:n7ap79O(7yP^͍|>}[! RSsYjq8hӤ/]wj/MH}I"H29 oK1;Ol1y5v_0|zwGzg}|˂v4%XŔQB HƮEes^GQ{RxRsߘIA$^k~Qx|Nw 'd͞+O	4;,#4'HNR?qߤK2)
zhp)][~2$ <4``;p$}b,-( {t/vFx
CMN-x8'bwoHGJҾ,o囍(	N={|:{60d;-t	9|&1hkvVX+i	-t^A2Zl~>
])
ΈzWЁ6xJj7Y`9 +	^Ob At7xi@D@ 
P(
z3$lÁI.UH>]A^
L6 tTuu -|`[(x{R<? MGKI98 ŕ&ƉT1?#C Z$u
G+t@Ds`-@D` Ԑ\8;voQ0
,  L - ` 